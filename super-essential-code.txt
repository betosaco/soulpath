# WELLNESS MONOREPO - SUPER ESSENTIAL CODE
# Generated: 2025-09-15T17:30:13.465Z
# Export Type: Super Essential Code Only (20% smaller)
# 
# CORE FEATURES ONLY:
# - Authentication & Authorization
# - Payment Processing
# - Booking System
# - Admin Dashboard
# - API Routes
# - Database Schema
# - Core Components
# - Essential Hooks
#
# EXCLUDED:
# - Documentation files
# - Test files
# - Debug code
# - Media files
# - Configuration files
# - Utility scripts
# - Non-critical components
#
# FOCUS: Business logic and core functionality only

============================================================
# START OF SUPER ESSENTIAL CODE
============================================================


============================================================FILE: frontend/add-vercel-env.jsSIZE: 3.72 KB============================================================
  1 | #!/usr/bin/env node  2 |   3 | import { execSync } from 'child_process';  4 | import readline from 'readline';  5 |   6 | const rl = readline.createInterface({  7 |   input: process.stdin,  8 |   output: process.stdout  9 | }); 10 |  11 | const ENV_VARS = { 12 |   RASA_URL: 'https: 13 |   OPENROUTER_API_KEY: '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' 14 | }; 15 |  16 | function runCommand(command, description) { 17 |   try { 18 |     const output = execSync(command, { encoding: 'utf8', stdio: 'pipe' }); 19 |     return output; 20 |   } catch (error) { 21 |     throw error; 22 |   } 23 | } 24 |  25 | function checkVercelCLI() { 26 |   try { 27 |     execSync('vercel --version', { stdio: 'pipe' }); 28 |     return true; 29 |   } catch { 30 |     return false; 31 |   } 32 | } 33 |  34 | function checkVercelAuth() { 35 |   try { 36 |     execSync('vercel whoami', { stdio: 'pipe' }); 37 |     return true; 38 |   } catch { 39 |     return false; 40 |   } 41 | } 42 |  43 | async function addEnvironmentVariable(key, value, environment) { 44 |   const command = `echo "${value}" | vercel env add ${key} ${environment}`; 45 |   return runCommand(command, `Adding ${key} to ${environment}`); 46 | } 47 |  48 | async function main() { 49 |  50 |   if (!checkVercelCLI()) { 51 |     try { 52 |       runCommand('npm install -g vercel', 'Installing Vercel CLI'); 53 |     } catch { 54 |       process.exit(1); 55 |     } 56 |   } 57 |  58 |   if (!checkVercelAuth()) { 59 |     process.exit(1); 60 |   } 61 |  62 |   const environments = ['production', 'preview', 'development']; 63 |  64 |   for (const [key, value] of Object.entries(ENV_VARS)) { 65 |     for (const env of environments) { 66 |       try { 67 |         await addEnvironmentVariable(key, value, env); 68 |       } catch { 69 |  70 |       } 71 |     } 72 |     } 73 |  74 |   try { 75 |     const output = runCommand('vercel env ls', 'Listing environment variables'); 76 |     } catch { 77 |     } 78 |  79 |   '); 80 |   '); 81 |   '); 82 |   '); 83 |   rl.close(); 84 | } 85 |  86 | main().catch(console.error);
============================================================END: frontend/add-vercel-env.js============================================================


============================================================FILE: frontend/app/(admin)/admin/live-session-config/page.tsxSIZE: 28.04 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Input } from '@/components/ui/input';  7 | import { Label } from '@/components/ui/label';  8 | import { Switch } from '@/components/ui/switch';  9 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 10 | import { Badge } from '@/components/ui/badge'; 11 | import { Video, Settings, Save, TestTube, CheckCircle, XCircle, ExternalLink } from 'lucide-react'; 12 | import { toast } from 'sonner'; 13 | import { useAuth } from '@/hooks/useAuth'; 14 |  15 | interface LiveSessionConfig { 16 |   id: string; 17 |   name: string; 18 |   provider: 'zoom' | 'meet' | 'teams' | 'weebly' | 'custom'; 19 |   apiKey: string; 20 |   apiSecret?: string; 21 |   webhookUrl?: string; 22 |   isActive: boolean; 23 |   settings: { 24 |     allowVideo: boolean; 25 |     allowAudio: boolean; 26 |     allowChat: boolean; 27 |     allowScreenShare: boolean; 28 |     maxParticipants: number; 29 |     recordingEnabled: boolean; 30 |     autoStart: boolean; 31 |     waitingRoom: boolean; 32 |     muteOnEntry: boolean; 33 |   }; 34 |   weeblySettings?: { 35 |     siteId: string; 36 |     appId: string; 37 |     clientId: string; 38 |     clientSecret: string; 39 |     redirectUri: string; 40 |     scope: string[]; 41 |   }; 42 | } 43 |  44 | const PROVIDERS = [ 45 |   { value: 'zoom', label: 'Zoom', description: 'Zoom Video Communications' }, 46 |   { value: 'meet', label: 'Google Meet', description: 'Google Meet integration' }, 47 |   { value: 'teams', label: 'Microsoft Teams', description: 'Microsoft Teams integration' }, 48 |   { value: 'weebly', label: 'Weebly', description: 'Weebly API integration' }, 49 |   { value: 'custom', label: 'Custom', description: 'Custom video conferencing solution' } 50 | ]; 51 |  52 | const WEBEBBLY_SCOPES = [ 53 |   'read:site', 54 |   'write:site', 55 |   'read:blog', 56 |   'write:blog', 57 |   'read:store', 58 |   'write:store', 59 |   'read:user', 60 |   'write:user' 61 | ]; 62 |  63 | export default function LiveSessionConfigPage() { 64 |   const { user } = useAuth(); 65 |   const [config, setConfig] = useState<LiveSessionConfig | null>(null); 66 |   const [loading, setLoading] = useState(true); 67 |   const [saving, setSaving] = useState(false); 68 |   const [testing, setTesting] = useState(false); 69 |   const [testResult, setTestResult] = useState<{ success: boolean; message: string } | null>(null); 70 |  71 |   const [formData, setFormData] = useState({ 72 |     name: '', 73 |     provider: 'zoom' as 'zoom' | 'meet' | 'teams' | 'weebly' | 'custom', 74 |     apiKey: '', 75 |     apiSecret: '', 76 |     webhookUrl: '', 77 |     isActive: true, 78 |     allowVideo: true, 79 |     allowAudio: true, 80 |     allowChat: true, 81 |     allowScreenShare: true, 82 |     maxParticipants: 10, 83 |     recordingEnabled: true, 84 |     autoStart: false, 85 |     waitingRoom: true, 86 |     muteOnEntry: false, 87 |  88 |     siteId: '', 89 |     appId: '', 90 |     clientId: '', 91 |     clientSecret: '', 92 |     redirectUri: '', 93 |     scope: ['read:site', 'write:site'] as string[] 94 |   }); 95 |  96 |   const loadConfig = useCallback(async () => { 97 |     if (!user?.access_token) return; 98 |  99 |     try {100 |       const response = await fetch('/api/admin/live-session-config', {101 |         headers: {102 |           'Authorization': `Bearer ${user.access_token}`,103 |           'Content-Type': 'application/json'104 |         }105 |       });106 | 107 |       if (response.ok) {108 |         const data = await response.json();109 |         if (data.success) {110 |           setConfig(data.data);111 |           setFormData({112 |             name: data.data.name || '',113 |             provider: data.data.provider || 'zoom',114 |             apiKey: data.data.apiKey || '',115 |             apiSecret: data.data.apiSecret || '',116 |             webhookUrl: data.data.webhookUrl || '',117 |             isActive: data.data.isActive || false,118 |             allowVideo: data.data.settings?.allowVideo || true,119 |             allowAudio: data.data.settings?.allowAudio || true,120 |             allowChat: data.data.settings?.allowChat || true,121 |             allowScreenShare: data.data.settings?.allowScreenShare || true,122 |             maxParticipants: data.data.settings?.maxParticipants || 10,123 |             recordingEnabled: data.data.settings?.recordingEnabled || false,124 |             autoStart: data.data.settings?.autoStart || false,125 |             waitingRoom: data.data.settings?.waitingRoom || true,126 |             muteOnEntry: data.data.settings?.muteOnEntry || false,127 |             siteId: data.data.weeblySettings?.siteId || '',128 |             appId: data.data.weeblySettings?.appId || '',129 |             clientId: data.data.weeblySettings?.clientId || '',130 |             clientSecret: data.data.weeblySettings?.clientSecret || '',131 |             redirectUri: data.data.weeblySettings?.redirectUri || '',132 |             scope: data.data.weeblySettings?.scope || ['read:site', 'write:site']133 |           });134 |         }135 |       }136 |     } catch (error) {137 |       toast.error('Failed to load configuration');138 |     }139 |   }, [user?.access_token]);140 | 141 |   useEffect(() => {142 |     if (user?.access_token) {143 |       loadConfig();144 |     }145 |   }, [user?.access_token, loadConfig]);146 | 147 |   useEffect(() => {148 |     setLoading(false);149 |   }, [config]);150 | 151 |   const handleInputChange = (field: string, value: string | number | boolean) => {152 |     setFormData(prev => ({ ...prev, [field]: value }));153 |   };154 | 155 |   const handleScopeToggle = (scope: string) => {156 |     setFormData(prev => ({157 |       ...prev,158 |       scope: prev.scope.includes(scope)159 |         ? prev.scope.filter(s => s !== scope)160 |         : [...prev.scope, scope]161 |     }));162 |   };163 | 164 |   const handleSave = async () => {165 |     setSaving(true);166 |     try {167 |       const response = await fetch('/api/admin/live-session-config', {168 |         method: 'POST',169 |         headers: {170 |           'Authorization': `Bearer ${user?.access_token}`,171 |           'Content-Type': 'application/json'172 |         },173 |         body: JSON.stringify({174 |           name: formData.name,175 |           provider: formData.provider,176 |           apiKey: formData.apiKey,177 |           apiSecret: formData.apiSecret,178 |           webhookUrl: formData.webhookUrl,179 |           isActive: formData.isActive,180 |           settings: {181 |             allowVideo: formData.allowVideo,182 |             allowAudio: formData.allowAudio,183 |             allowChat: formData.allowChat,184 |             allowScreenShare: formData.allowScreenShare,185 |             maxParticipants: formData.maxParticipants,186 |             recordingEnabled: formData.recordingEnabled,187 |             autoStart: formData.autoStart,188 |             waitingRoom: formData.waitingRoom,189 |             muteOnEntry: formData.muteOnEntry190 |           },191 |           weeblySettings: formData.provider === 'weebly' ? {192 |             siteId: formData.siteId,193 |             appId: formData.appId,194 |             clientId: formData.clientId,195 |             clientSecret: formData.clientSecret,196 |             redirectUri: formData.redirectUri,197 |             scope: formData.scope198 |           } : undefined199 |         })200 |       });201 | 202 |       const result = await response.json();203 | 204 |       if (result.success) {205 |         toast.success('Configuration saved successfully');206 |         setConfig(result.data);207 |       } else {208 |         toast.error(result.message || 'Failed to save configuration');209 |       }210 |     } catch (error) {211 |       toast.error('Failed to save configuration');212 |     } finally {213 |       setSaving(false);214 |     }215 |   };216 | 217 |   const handleTest = async () => {218 |     setTesting(true);219 |     setTestResult(null);220 | 221 |     try {222 |       const response = await fetch('/api/admin/live-session-config/test', {223 |         method: 'POST',224 |         headers: {225 |           'Authorization': `Bearer ${user?.access_token}`,226 |           'Content-Type': 'application/json'227 |         },228 |         body: JSON.stringify({229 |           provider: formData.provider,230 |           apiKey: formData.apiKey,231 |           apiSecret: formData.apiSecret,232 |           weeblySettings: formData.provider === 'weebly' ? {233 |             siteId: formData.siteId,234 |             clientId: formData.clientId,235 |             clientSecret: formData.clientSecret236 |           } : undefined237 |         })238 |       });239 | 240 |       const result = await response.json();241 |       setTestResult({242 |         success: result.success,243 |         message: result.message || (result.success ? 'Connection successful' : 'Connection failed')244 |       });245 | 246 |       if (result.success) {247 |         toast.success('Test connection successful');248 |       } else {249 |         toast.error('Test connection failed');250 |       }251 |     } catch (error) {252 |       setTestResult({253 |         success: false,254 |         message: 'Test connection failed'255 |       });256 |       toast.error('Test connection failed');257 |     } finally {258 |       setTesting(false);259 |     }260 |   };261 | 262 |   if (loading) {263 |     return (264 |       <div className="flex items-center justify-center min-h-[400px]">265 |         <div className="text-center">266 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>267 |           <p className="text-[#FFD700] text-lg font-semibold">Loading configuration...</p>268 |         </div>269 |       </div>270 |     );271 |   }272 | 273 |   return (274 |     <div className="space-y-6">275 |       <div className="text-center mb-8">276 |         <h1 className="text-4xl font-bold text-white mb-4">Live Session Configuration</h1>277 |         <p className="text-gray-400 text-lg">Configure video conferencing and Weebly API integration</p>278 |       </div>279 | 280 |         <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">281 |           {}282 |           <div className="lg:col-span-2 space-y-6">283 |             {}284 |             <Card className="bg-[#1a1a2e] border-[#16213e]">285 |               <CardHeader>286 |                 <CardTitle className="text-white flex items-center space-x-2">287 |                   <Video className="w-5 h-5 text-[#ffd700]" />288 |                   <span>Video Conferencing Provider</span>289 |                 </CardTitle>290 |               </CardHeader>291 |               <CardContent className="space-y-4">292 |                 <div>293 |                   <Label htmlFor="provider" className="text-gray-300">Provider</Label>294 |                   <Select value={formData.provider} onValueChange={(value) => handleInputChange('provider', value)}>295 |                     <SelectTrigger className="bg-[#16213e] border-[#0a0a23] text-white">296 |                       <SelectValue placeholder="Select provider" />297 |                     </SelectTrigger>298 |                     <SelectContent className="bg-[#16213e] border-[#0a0a23] text-white">299 |                       {PROVIDERS.map((provider) => (300 |                         <SelectItem key={provider.value} value={provider.value}>301 |                           <div>302 |                             <div className="font-medium">{provider.label}</div>303 |                             <div className="text-sm text-gray-400">{provider.description}</div>304 |                           </div>305 |                         </SelectItem>306 |                       ))}307 |                     </SelectContent>308 |                   </Select>309 |                 </div>310 | 311 |                 <div>312 |                   <Label htmlFor="name" className="text-gray-300">Configuration Name</Label>313 |                   <Input314 |                     id="name"315 |                     value={formData.name}316 |                     onChange={(e) => handleInputChange('name', e.target.value)}317 |                     className="bg-[#16213e] border-[#0a0a23] text-white"318 |                     placeholder="e.g., SoulPath Live Sessions"319 |                   />320 |                 </div>321 | 322 |                 <div className="flex items-center space-x-2">323 |                   <Switch324 |                     id="isActive"325 |                     checked={formData.isActive}326 |                     onCheckedChange={(checked) => handleInputChange('isActive', checked)}327 |                   />328 |                   <Label htmlFor="isActive" className="text-gray-300">Active</Label>329 |                 </div>330 |               </CardContent>331 |             </Card>332 | 333 |             {}334 |             <Card className="bg-[#1a1a2e] border-[#16213e]">335 |               <CardHeader>336 |                 <CardTitle className="text-white">API Configuration</CardTitle>337 |               </CardHeader>338 |               <CardContent className="space-y-4">339 |                 <div>340 |                   <Label htmlFor="apiKey" className="text-gray-300">API Key</Label>341 |                   <Input342 |                     id="apiKey"343 |                     type="password"344 |                     value={formData.apiKey}345 |                     onChange={(e) => handleInputChange('apiKey', e.target.value)}346 |                     className="bg-[#16213e] border-[#0a0a23] text-white"347 |                     placeholder="Enter your API key"348 |                   />349 |                 </div>350 | 351 |                 {formData.provider !== 'weebly' && (352 |                   <div>353 |                     <Label htmlFor="apiSecret" className="text-gray-300">API Secret</Label>354 |                     <Input355 |                       id="apiSecret"356 |                       type="password"357 |                       value={formData.apiSecret}358 |                       onChange={(e) => handleInputChange('apiSecret', e.target.value)}359 |                       className="bg-[#16213e] border-[#0a0a23] text-white"360 |                       placeholder="Enter your API secret"361 |                     />362 |                   </div>363 |                 )}364 | 365 |                 <div>366 |                   <Label htmlFor="webhookUrl" className="text-gray-300">Webhook URL</Label>367 |                   <Input368 |                     id="webhookUrl"369 |                     value={formData.webhookUrl}370 |                     onChange={(e) => handleInputChange('webhookUrl', e.target.value)}371 |                     className="bg-[#16213e] border-[#0a0a23] text-white"372 |                     placeholder="https:373 |                   />374 |                 </div>375 |               </CardContent>376 |             </Card>377 | 378 |             {}379 |             {formData.provider === 'weebly' && (380 |               <Card className="bg-[#1a1a2e] border-[#16213e]">381 |                 <CardHeader>382 |                   <CardTitle className="text-white flex items-center space-x-2">383 |                     <ExternalLink className="w-5 h-5 text-[#ffd700]" />384 |                     <span>Weebly API Configuration</span>385 |                   </CardTitle>386 |                 </CardHeader>387 |                 <CardContent className="space-y-4">388 |                   <div className="grid grid-cols-2 gap-4">389 |                     <div>390 |                       <Label htmlFor="siteId" className="text-gray-300">Site ID</Label>391 |                       <Input392 |                         id="siteId"393 |                         value={formData.siteId}394 |                         onChange={(e) => handleInputChange('siteId', e.target.value)}395 |                         className="bg-[#16213e] border-[#0a0a23] text-white"396 |                         placeholder="Your Weebly site ID"397 |                       />398 |                     </div>399 |                     <div>400 |                       <Label htmlFor="appId" className="text-gray-300">App ID</Label>401 |                       <Input402 |                         id="appId"403 |                         value={formData.appId}404 |                         onChange={(e) => handleInputChange('appId', e.target.value)}405 |                         className="bg-[#16213e] border-[#0a0a23] text-white"406 |                         placeholder="Your Weebly app ID"407 |                       />408 |                     </div>409 |                   </div>410 | 411 |                   <div className="grid grid-cols-2 gap-4">412 |                     <div>413 |                       <Label htmlFor="clientId" className="text-gray-300">Client ID</Label>414 |                       <Input415 |                         id="clientId"416 |                         value={formData.clientId}417 |                         onChange={(e) => handleInputChange('clientId', e.target.value)}418 |                         className="bg-[#16213e] border-[#0a0a23] text-white"419 |                         placeholder="OAuth client ID"420 |                       />421 |                     </div>422 |                     <div>423 |                       <Label htmlFor="clientSecret" className="text-gray-300">Client Secret</Label>424 |                       <Input425 |                         id="clientSecret"426 |                         type="password"427 |                         value={formData.clientSecret}428 |                         onChange={(e) => handleInputChange('clientSecret', e.target.value)}429 |                         className="bg-[#16213e] border-[#0a0a23] text-white"430 |                         placeholder="OAuth client secret"431 |                       />432 |                     </div>433 |                   </div>434 | 435 |                   <div>436 |                     <Label htmlFor="redirectUri" className="text-gray-300">Redirect URI</Label>437 |                     <Input438 |                       id="redirectUri"439 |                       value={formData.redirectUri}440 |                       onChange={(e) => handleInputChange('redirectUri', e.target.value)}441 |                       className="bg-[#16213e] border-[#0a0a23] text-white"442 |                       placeholder="https:443 |                     />444 |                   </div>445 | 446 |                   <div>447 |                     <Label className="text-gray-300">OAuth Scopes</Label>448 |                     <div className="grid grid-cols-2 gap-2 mt-2">449 |                       {WEBEBBLY_SCOPES.map((scope) => (450 |                         <div key={scope} className="flex items-center space-x-2">451 |                           <input452 |                             type="checkbox"453 |                             id={scope}454 |                             checked={formData.scope.includes(scope)}455 |                             onChange={() => handleScopeToggle(scope)}456 |                             className="rounded border-gray-300"457 |                           />458 |                           <Label htmlFor={scope} className="text-sm text-gray-300">459 |                             {scope}460 |                           </Label>461 |                         </div>462 |                       ))}463 |                     </div>464 |                   </div>465 |                 </CardContent>466 |               </Card>467 |             )}468 | 469 |             {}470 |             <Card className="bg-[#1a1a2e] border-[#16213e]">471 |               <CardHeader>472 |                 <CardTitle className="text-white">Session Settings</CardTitle>473 |               </CardHeader>474 |               <CardContent className="space-y-4">475 |                 <div className="grid grid-cols-2 gap-4">476 |                   <div className="flex items-center space-x-2">477 |                     <Switch478 |                       id="allowVideo"479 |                       checked={formData.allowVideo}480 |                       onCheckedChange={(checked) => handleInputChange('allowVideo', checked)}481 |                     />482 |                     <Label htmlFor="allowVideo" className="text-gray-300">Allow Video</Label>483 |                   </div>484 |                   <div className="flex items-center space-x-2">485 |                     <Switch486 |                       id="allowAudio"487 |                       checked={formData.allowAudio}488 |                       onCheckedChange={(checked) => handleInputChange('allowAudio', checked)}489 |                     />490 |                     <Label htmlFor="allowAudio" className="text-gray-300">Allow Audio</Label>491 |                   </div>492 |                 </div>493 | 494 |                 <div className="grid grid-cols-2 gap-4">495 |                   <div className="flex items-center space-x-2">496 |                     <Switch497 |                       id="allowChat"498 |                       checked={formData.allowChat}499 |                       onCheckedChange={(checked) => handleInputChange('allowChat', checked)}500 |                     />501 |                     <Label htmlFor="allowChat" className="text-gray-300">Allow Chat</Label>502 |                   </div>503 |                   <div className="flex items-center space-x-2">504 |                     <Switch505 |                       id="allowScreenShare"506 |                       checked={formData.allowScreenShare}507 |                       onCheckedChange={(checked) => handleInputChange('allowScreenShare', checked)}508 |                     />509 |                     <Label htmlFor="allowScreenShare" className="text-gray-300">Allow Screen Share</Label>510 |                   </div>511 |                 </div>512 | 513 |                 <div className="grid grid-cols-2 gap-4">514 |                   <div className="flex items-center space-x-2">515 |                     <Switch516 |                       id="recordingEnabled"517 |                       checked={formData.recordingEnabled}518 |                       onCheckedChange={(checked) => handleInputChange('recordingEnabled', checked)}519 |                     />520 |                     <Label htmlFor="recordingEnabled" className="text-gray-300">Enable Recording</Label>521 |                   </div>522 |                   <div className="flex items-center space-x-2">523 |                     <Switch524 |                       id="autoStart"525 |                       checked={formData.autoStart}526 |                       onCheckedChange={(checked) => handleInputChange('autoStart', checked)}527 |                     />528 |                     <Label htmlFor="autoStart" className="text-gray-300">Auto Start</Label>529 |                   </div>530 |                 </div>531 | 532 |                 <div className="grid grid-cols-2 gap-4">533 |                   <div className="flex items-center space-x-2">534 |                     <Switch535 |                       id="waitingRoom"536 |                       checked={formData.waitingRoom}537 |                       onCheckedChange={(checked) => handleInputChange('waitingRoom', checked)}538 |                     />539 |                     <Label htmlFor="waitingRoom" className="text-gray-300">Waiting Room</Label>540 |                   </div>541 |                   <div className="flex items-center space-x-2">542 |                     <Switch543 |                       id="muteOnEntry"544 |                       checked={formData.muteOnEntry}545 |                       onCheckedChange={(checked) => handleInputChange('muteOnEntry', checked)}546 |                     />547 |                     <Label htmlFor="muteOnEntry" className="text-gray-300">Mute on Entry</Label>548 |                   </div>549 |                 </div>550 | 551 |                 <div>552 |                   <Label htmlFor="maxParticipants" className="text-gray-300">Max Participants</Label>553 |                   <Input554 |                     id="maxParticipants"555 |                     type="number"556 |                     min="1"557 |                     max="100"558 |                     value={formData.maxParticipants}559 |                     onChange={(e) => handleInputChange('maxParticipants', parseInt(e.target.value) || 10)}560 |                     className="bg-[#16213e] border-[#0a0a23] text-white"561 |                   />562 |                 </div>563 |               </CardContent>564 |             </Card>565 |           </div>566 | 567 |           {}568 |           <div className="space-y-6">569 |             {}570 |             <Card className="bg-[#1a1a2e] border-[#16213e]">571 |               <CardHeader>572 |                 <CardTitle className="text-white">Status</CardTitle>573 |               </CardHeader>574 |               <CardContent className="space-y-4">575 |                 <div className="flex items-center justify-between">576 |                   <span className="text-gray-300">Configuration</span>577 |                   <Badge className={config?.isActive ? 'bg-green-500' : 'bg-red-500'}>578 |                     {config?.isActive ? 'Active' : 'Inactive'}579 |                   </Badge>580 |                 </div>581 |                 <div className="flex items-center justify-between">582 |                   <span className="text-gray-300">Provider</span>583 |                   <span className="text-white">{formData.provider}</span>584 |                 </div>585 |                 <div className="flex items-center justify-between">586 |                   <span className="text-gray-300">API Key</span>587 |                   <span className="text-white">{formData.apiKey ? 'Set' : 'Not Set'}</span>588 |                 </div>589 |               </CardContent>590 |             </Card>591 | 592 |             {}593 |             <Card className="bg-[#1a1a2e] border-[#16213e]">594 |               <CardHeader>595 |                 <CardTitle className="text-white">Test Connection</CardTitle>596 |               </CardHeader>597 |               <CardContent className="space-y-4">598 |                 <Button599 |                   onClick={handleTest}600 |                   disabled={testing || !formData.apiKey}601 |                   className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"602 |                 >603 |                   {testing ? (604 |                     <div className="flex items-center space-x-2">605 |                       <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-black"></div>606 |                       <span>Testing...</span>607 |                     </div>608 |                   ) : (609 |                     <div className="flex items-center space-x-2">610 |                       <TestTube className="w-4 h-4" />611 |                       <span>Test Connection</span>612 |                     </div>613 |                   )}614 |                 </Button>615 | 616 |                 {testResult && (617 |                   <div className={`p-3 rounded-lg flex items-center space-x-2 ${618 |                     testResult.success ? 'bg-green-900/20 border border-green-500' : 'bg-red-900/20 border border-red-500'619 |                   }`}>620 |                     {testResult.success ? (621 |                       <CheckCircle className="w-4 h-4 text-green-500" />622 |                     ) : (623 |                       <XCircle className="w-4 h-4 text-red-500" />624 |                     )}625 |                     <span className={`text-sm ${626 |                       testResult.success ? 'text-green-400' : 'text-red-400'627 |                     }`}>628 |                       {testResult.message}629 |                     </span>630 |                   </div>631 |                 )}632 |               </CardContent>633 |             </Card>634 | 635 |             {}636 |             <Card className="bg-[#1a1a2e] border-[#16213e]">637 |               <CardHeader>638 |                 <CardTitle className="text-white">Actions</CardTitle>639 |               </CardHeader>640 |               <CardContent className="space-y-3">641 |                 <Button642 |                   onClick={handleSave}643 |                   disabled={saving}644 |                   className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"645 |                 >646 |                   {saving ? (647 |                     <div className="flex items-center space-x-2">648 |                       <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-black"></div>649 |                       <span>Saving...</span>650 |                     </div>651 |                   ) : (652 |                     <div className="flex items-center space-x-2">653 |                       <Save className="w-4 h-4" />654 |                       <span>Save Configuration</span>655 |                     </div>656 |                   )}657 |                 </Button>658 | 659 |                 <Button660 |                   onClick={loadConfig}661 |                   variant="outline"662 |                   className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"663 |                 >664 |                   <Settings className="w-4 h-4 mr-2" />665 |                   Reset to Saved666 |                 </Button>667 |               </CardContent>668 |             </Card>669 | 670 |             {}671 |             <Card className="bg-[#1a1a2e] border-[#16213e]">672 |               <CardHeader>673 |                 <CardTitle className="text-white">Documentation</CardTitle>674 |               </CardHeader>675 |               <CardContent className="space-y-3">676 |                 <Button677 |                   variant="outline"678 |                   className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"679 |                   onClick={() => window.open('https:680 |                 >681 |                   <ExternalLink className="w-4 h-4 mr-2" />682 |                   Zoom API Docs683 |                 </Button>684 |                 <Button685 |                   variant="outline"686 |                   className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"687 |                   onClick={() => window.open('https:688 |                 >689 |                   <ExternalLink className="w-4 h-4 mr-2" />690 |                   Google Meet API691 |                 </Button>692 |                 <Button693 |                   variant="outline"694 |                   className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"695 |                   onClick={() => window.open('https:696 |                 >697 |                   <ExternalLink className="w-4 h-4 mr-2" />698 |                   Weebly API Docs699 |                 </Button>700 |               </CardContent>701 |             </Card>702 |           </div>703 |         </div>704 |     </div>705 |   );706 | }
============================================================END: frontend/app/(admin)/admin/live-session-config/page.tsx============================================================


============================================================FILE: frontend/app/(admin)/admin/page.tsxSIZE: 1.65 KB============================================================
  1 | 'use client';  2 |   3 | import { useEffect } from 'react';  4 | import { useRouter } from 'next/navigation';  5 | import { useAuth } from '@/hooks/useAuth';  6 | import { AdminDashboard } from '@/components/AdminDashboard';  7 |   8 | export default function AdminPage() {  9 |   const { isAdmin, isLoading, user } = useAuth(); 10 |   const router = useRouter(); 11 |  12 |   useEffect(() => { 13 |  14 |     if (!isLoading && !isAdmin) { 15 |       router.push('/'); 16 |     } 17 |   }, [isLoading, isAdmin, router]); 18 |  19 |   if (isLoading) { 20 |     return ( 21 |       <div className="flex items-center justify-center h-screen"> 22 |         <div className="text-center"> 23 |           <div className="w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 24 |           <p className="text-[var(--color-text-secondary)]">Loading...</p> 25 |         </div> 26 |       </div> 27 |     ); 28 |   } 29 |  30 |   if (!isAdmin) { 31 |     return ( 32 |       <div className="flex items-center justify-center h-screen"> 33 |         <div className="text-center"> 34 |           <div className="w-16 h-16 border-4 border-red-500 border-t-transparent rounded-full mx-auto mb-4"></div> 35 |           <p className="text-[var(--color-text-secondary)]">Access Denied</p> 36 |           <p className="text-[var(--color-text-secondary)] text-sm">Redirecting...</p> 37 |         </div> 38 |       </div> 39 |     ); 40 |   } 41 |  42 |   return null; 43 | }
============================================================END: frontend/app/(admin)/admin/page.tsx============================================================


============================================================FILE: frontend/app/(admin)/admin/payment-methods/page.tsxSIZE: 26.08 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect } from 'react';  4 | import Image from 'next/image';  5 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  6 | import { BaseButton } from '@/components/ui/BaseButton';  7 | import { BaseInput } from '@/components/ui/BaseInput';  8 | import { Label } from '@/components/ui/label';  9 | import { Textarea } from '@/components/ui/textarea'; 10 | import { Badge } from '@/components/ui/badge'; 11 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 12 | import { BaseModal } from '@/components/ui/BaseModal'; 13 | import { Separator } from '@/components/ui/separator'; 14 | import { Plus, Edit, Trash2, CreditCard, DollarSign } from 'lucide-react'; 15 | import { toast } from 'sonner'; 16 | import { colors, spacing, typography } from '@/lib/design-system'; 17 |  18 | function safeParseJSON(value: string) { 19 |   try { 20 |     const parsed = JSON.parse(value); 21 |     return parsed && typeof parsed === 'object' ? parsed : {}; 22 |   } catch { 23 |     return {}; 24 |   } 25 | } 26 |  27 | interface PaymentMethod { 28 |   id: number; 29 |   name: string; 30 |   type: string; 31 |   description: string | null; 32 |   icon: string | null; 33 |   requiresConfirmation: boolean; 34 |   autoAssignPackage: boolean; 35 |   isActive: boolean; 36 |   createdAt: string; 37 |   updatedAt: string; 38 |   providerConfig?: Record<string, unknown>; 39 | } 40 |  41 | export default function PaymentMethodsPage() { 42 |   const [paymentMethods, setPaymentMethods] = useState<PaymentMethod[]>([]); 43 |   const [loading, setLoading] = useState(true); 44 |   const [isCreateModalOpen, setIsCreateModalOpen] = useState(false); 45 |   const [isEditModalOpen, setIsEditModalOpen] = useState(false); 46 |   const [editingPaymentMethod, setEditingPaymentMethod] = useState<PaymentMethod | null>(null); 47 |  48 |   const [formData, setFormData] = useState({ 49 |     name: '', 50 |     type: 'custom', 51 |     description: '', 52 |     icon: '', 53 |     requiresConfirmation: false, 54 |     autoAssignPackage: true, 55 |     isActive: true 56 |   }); 57 |   const [providerConfig, setProviderConfig] = useState<string>('{}'); 58 |  59 |   useEffect(() => { 60 |     fetchPaymentMethods(); 61 |   }, []); 62 |  63 |   const fetchPaymentMethods = async () => { 64 |     try { 65 |       const response = await fetch('/api/admin/payment-methods'); 66 |       const result = await response.json(); 67 |  68 |       if (result.success) { 69 |         setPaymentMethods(result.data); 70 |       } else { 71 |         toast.error('Failed to fetch payment methods'); 72 |       } 73 |     } catch (error) { 74 |       toast.error('Failed to fetch payment methods'); 75 |     } finally { 76 |       setLoading(false); 77 |     } 78 |   }; 79 |  80 |   const handleCreate = async () => { 81 |     try { 82 |       const response = await fetch('/api/admin/payment-methods', { 83 |         method: 'POST', 84 |         headers: { 'Content-Type': 'application/json' }, 85 |         body: JSON.stringify({ 86 |           ...formData, 87 |           providerConfig: safeParseJSON(providerConfig) 88 |         }) 89 |       }); 90 |  91 |       const result = await response.json(); 92 |  93 |       if (result.success) { 94 |         toast.success('Payment method created successfully'); 95 |         setIsCreateModalOpen(false); 96 |         resetForm(); 97 |         fetchPaymentMethods(); 98 |       } else { 99 |         toast.error(result.message || 'Failed to create payment method');100 |       }101 |     } catch (error) {102 |       toast.error('Failed to create payment method');103 |     }104 |   };105 | 106 |   const handleUpdate = async () => {107 |     if (!editingPaymentMethod) return;108 | 109 |     try {110 |       const response = await fetch(`/api/admin/payment-methods?id=${editingPaymentMethod.id}`, {111 |         method: 'PUT',112 |         headers: { 'Content-Type': 'application/json' },113 |         body: JSON.stringify({114 |           ...formData,115 |           providerConfig: safeParseJSON(providerConfig)116 |         })117 |       });118 | 119 |       const result = await response.json();120 | 121 |       if (result.success) {122 |         toast.success('Payment method updated successfully');123 |         setIsEditModalOpen(false);124 |         resetForm();125 |         setEditingPaymentMethod(null);126 |         fetchPaymentMethods();127 |       } else {128 |         toast.error(result.message || 'Failed to update payment method');129 |       }130 |     } catch (error) {131 |       toast.error('Failed to update payment method');132 |     }133 |   };134 | 135 |   const handleDelete = async (id: number) => {136 |     if (!confirm('Are you sure you want to delete this payment method?')) return;137 | 138 |     try {139 |       const response = await fetch(`/api/admin/payment-methods?id=${id}`, {140 |         method: 'DELETE'141 |       });142 | 143 |       const result = await response.json();144 | 145 |       if (result.success) {146 |         toast.success('Payment method deleted successfully');147 |         fetchPaymentMethods();148 |       } else {149 |         toast.error(result.message || 'Failed to delete payment method');150 |       }151 |     } catch (error) {152 |       toast.error('Failed to delete payment method');153 |     }154 |   };155 | 156 |   const resetForm = () => {157 |     setFormData({158 |       name: '',159 |       type: 'custom',160 |       description: '',161 |       icon: '',162 |       requiresConfirmation: false,163 |       autoAssignPackage: true,164 |       isActive: true165 |     });166 |     setProviderConfig('{}');167 |   };168 | 169 |   const openEditModal = (paymentMethod: PaymentMethod) => {170 |     setEditingPaymentMethod(paymentMethod);171 |     setFormData({172 |       name: paymentMethod.name,173 |       type: paymentMethod.type,174 |       description: paymentMethod.description || '',175 |       icon: paymentMethod.icon || '',176 |       requiresConfirmation: paymentMethod.requiresConfirmation,177 |       autoAssignPackage: paymentMethod.autoAssignPackage,178 |       isActive: paymentMethod.isActive179 |     });180 |     setProviderConfig(JSON.stringify(paymentMethod.providerConfig || {}, null, 2));181 |     setIsEditModalOpen(true);182 |   };183 | 184 |   const openCreateModal = () => {185 |     resetForm();186 |     setIsCreateModalOpen(true);187 |   };188 | 189 |   if (loading) {190 |     return (191 |       <div className={`flex items-center justify-center min-h-[400px] text-[${colors.text.secondary}]`}>192 |         Loading payment methods...193 |       </div>194 |     );195 |   }196 | 197 |   return (198 |     <div className={`space-y-[${spacing[6]}]`}>199 |       {}200 |       <div className={`flex items-center justify-between`}>201 |         <div>202 |           <h1 className={`text-[${typography.fontSize['3xl']}] font-[${typography.fontWeight.bold}] text-[${colors.text.primary}]`}>203 |             Payment Methods204 |           </h1>205 |           <p className={`text-[${colors.text.secondary}] mt-[${spacing[2]}]`}>206 |             Manage payment methods and their associated currencies207 |           </p>208 |         </div>209 |         <BaseButton210 |           onClick={openCreateModal}211 |           variant="primary"212 |           size="lg"213 |           leftIcon={<Plus className="w-4 h-4" />}214 |         >215 |           Add Payment Method216 |         </BaseButton>217 |       </div>218 | 219 |       {}220 |       <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-[${spacing[6]}]`}>221 |         {paymentMethods.map((method) => (222 |           <Card key={method.id} className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}]`}>223 |             <CardHeader className={`pb-[${spacing[3]}]`}>224 |               <div className="flex items-center justify-between">225 |                 <CardTitle className={`text-[${typography.fontSize.lg}] text-[${colors.text.primary}]`}>226 |                   {method.name}227 |                 </CardTitle>228 |                 <Badge229 |                   variant={method.isActive ? "default" : "secondary"}230 |                   className={method.isActive ? `bg-[${colors.status.success}] text-white` : `bg-[${colors.status.error}] text-white`}231 |                 >232 |                   {method.isActive ? 'Active' : 'Inactive'}233 |                 </Badge>234 |               </div>235 |               {method.description && (236 |                 <p className={`text-[${colors.text.secondary}] text-[${typography.fontSize.sm}]`}>237 |                   {method.description}238 |                 </p>239 |               )}240 |             </CardHeader>241 | 242 |             <CardContent className={`space-y-[${spacing[4]}]`}>243 |               <div className={`flex items-center space-x-[${spacing[2]}] text-[${colors.text.secondary}]`}>244 |                 <CreditCard className="w-4 h-4" />245 |                 <span className={`text-[${typography.fontSize.sm}]`}>246 |                   Type: {method.type}247 |                 </span>248 |               </div>249 | 250 |               {method.icon && (251 |                 <div className={`flex items-center space-x-[${spacing[2]}] text-[${colors.text.secondary}]`}>252 |                   <Image src={method.icon} alt={method.name} width={16} height={16} className="w-4 h-4" />253 |                   <span className={`text-[${typography.fontSize.sm}]`}>254 |                     Icon available255 |                   </span>256 |                 </div>257 |               )}258 | 259 |               <div className={`flex items-center space-x-[${spacing[2]}] text-[${colors.text.secondary}]`}>260 |                 <DollarSign className="w-4 h-4" />261 |                 <span className={`text-[${typography.fontSize.sm}]`}>262 |                   Created: {new Date(method.createdAt).toLocaleDateString()}263 |                 </span>264 |               </div>265 | 266 |               <Separator className={`bg-[${colors.border[500]}]/20`} />267 | 268 |               <div className={`flex space-x-[${spacing[2]}]`}>269 |                 <BaseButton270 |                   variant="outline"271 |                   size="sm"272 |                   onClick={() => openEditModal(method)}273 |                   className="flex-1"274 |                   leftIcon={<Edit className="w-4 h-4" />}275 |                 >276 |                   Edit277 |                 </BaseButton>278 |                 <BaseButton279 |                   variant="danger"280 |                   size="sm"281 |                   onClick={() => handleDelete(method.id)}282 |                   leftIcon={<Trash2 className="w-4 h-4" />}283 |                 >284 |                   Delete285 |                 </BaseButton>286 |               </div>287 |             </CardContent>288 |           </Card>289 |         ))}290 |       </div>291 | 292 |       {}293 |       <BaseModal294 |         isOpen={isCreateModalOpen}295 |         onClose={() => setIsCreateModalOpen(false)}296 |         title="Add New Payment Method"297 |         description="Create a new payment method with its associated currency"298 |         size="lg"299 |         variant="default"300 |       >301 |         <BaseModal.Content>302 |           <div className={`space-y-[${spacing[4]}]`}>303 |             <div>304 |               <Label htmlFor="name" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>305 |                 Name *306 |               </Label>307 |               <BaseInput308 |                 id="name"309 |                 value={formData.name}310 |                 onChange={(e) => setFormData({ ...formData, name: e.target.value })}311 |                 placeholder="e.g., Credit Card, PayPal"312 |               />313 |             </div>314 | 315 |             <div>316 |               <Label htmlFor="type" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>317 |                 Type *318 |               </Label>319 |               <Select value={formData.type} onValueChange={(value) => setFormData({ ...formData, type: value })}>320 |                 <SelectTrigger className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}]`}>321 |                   <SelectValue placeholder="Select type" />322 |                 </SelectTrigger>323 |                 <SelectContent className={`bg-[${colors.semantic.surface.secondary}] border-[${colors.border[500]}]`}>324 |                   <SelectItem value="stripe" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>325 |                     Stripe326 |                   </SelectItem>327 |                   <SelectItem value="izipay" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>328 |                     Izipay (Peru)329 |                   </SelectItem>330 |                   <SelectItem value="paypal" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>331 |                     PayPal332 |                   </SelectItem>333 |                   <SelectItem value="bank" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>334 |                     Bank Transfer335 |                   </SelectItem>336 |                   <SelectItem value="crypto" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>337 |                     Cryptocurrency338 |                   </SelectItem>339 |                   <SelectItem value="apple" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>340 |                     Apple Pay341 |                   </SelectItem>342 |                   <SelectItem value="google" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>343 |                     Google Pay344 |                   </SelectItem>345 |                   <SelectItem value="custom" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>346 |                     Custom347 |                   </SelectItem>348 |                 </SelectContent>349 |               </Select>350 |             </div>351 | 352 |             <div>353 |               <Label htmlFor="description" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>354 |                 Description355 |               </Label>356 |               <Textarea357 |                 id="description"358 |                 value={formData.description}359 |                 onChange={(e) => setFormData({ ...formData, description: e.target.value })}360 |                 placeholder="Optional description"361 |                 className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}] placeholder:text-[${colors.text.tertiary}]`}362 |               />363 |             </div>364 | 365 |             <div>366 |               <Label htmlFor="icon" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>367 |                 Icon URL368 |               </Label>369 |               <BaseInput370 |                 id="icon"371 |                 value={formData.icon}372 |                 onChange={(e) => setFormData({ ...formData, icon: e.target.value })}373 |                 placeholder="https:374 |               />375 |             </div>376 | 377 |             <div className="grid grid-cols-2 gap-4">378 |               <div className="flex items-center space-x-2">379 |                 <input380 |                   type="checkbox"381 |                   id="requiresConfirmation"382 |                   checked={formData.requiresConfirmation}383 |                   onChange={(e) => setFormData({ ...formData, requiresConfirmation: e.target.checked })}384 |                   className={`rounded border-[${colors.border[500]}] bg-[${colors.semantic.surface.primary}]`}385 |                 />386 |                 <Label htmlFor="requiresConfirmation" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>387 |                   Requires Confirmation388 |                 </Label>389 |               </div>390 | 391 |               <div className="flex items-center space-x-2">392 |                 <input393 |                   type="checkbox"394 |                   id="autoAssignPackage"395 |                   checked={formData.autoAssignPackage}396 |                   onChange={(e) => setFormData({ ...formData, autoAssignPackage: e.target.checked })}397 |                   className={`rounded border-[${colors.border[500]}] bg-[${colors.semantic.surface.primary}]`}398 |                 />399 |                 <Label htmlFor="autoAssignPackage" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>400 |                   Auto Assign Package401 |                 </Label>402 |               </div>403 |             </div>404 | 405 |             <div className="flex items-center space-x-2">406 |               <input407 |                 type="checkbox"408 |                 id="isActive"409 |                 checked={formData.isActive}410 |                 onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}411 |                 className={`rounded border-[${colors.border[500]}] bg-[${colors.semantic.surface.primary}]`}412 |               />413 |               <Label htmlFor="isActive" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>414 |                 Active415 |               </Label>416 |             </div>417 | 418 |             {}419 |             <div>420 |               <Label htmlFor="providerConfig" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>421 |                 Provider Config (JSON)422 |               </Label>423 |               <Textarea424 |                 id="providerConfig"425 |                 value={providerConfig}426 |                 onChange={(e) => setProviderConfig(e.target.value)}427 |                 placeholder='{"merchantId":"...","username":"...","password":"...","publicKey":"...","currency":"PEN","environment":"sandbox","supportedCountries":["PE"],"returnUrl":"/payment/success","cancelUrl":"/payment/cancel"}'428 |                 className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}] placeholder:text-[${colors.text.tertiary}]`}429 |                 rows={6}430 |               />431 |               {formData.type === 'izipay' && (432 |                 <p className={`text-[${colors.text.tertiary}] text-[${typography.fontSize.xs}] mt-1`}>433 |                   Required keys for Izipay: merchantId, username, password, publicKey, currency (PEN), environment (sandbox|production), supportedCountries, returnUrl, cancelUrl434 |                 </p>435 |               )}436 |             </div>437 |           </div>438 |         </BaseModal.Content>439 | 440 |         <BaseModal.Footer>441 |           <BaseButton442 |             variant="outline"443 |             onClick={() => setIsCreateModalOpen(false)}444 |           >445 |             Cancel446 |           </BaseButton>447 |           <BaseButton448 |             onClick={handleCreate}449 |             disabled={!formData.name || !formData.type}450 |             variant="primary"451 |           >452 |             Create453 |           </BaseButton>454 |         </BaseModal.Footer>455 |       </BaseModal>456 | 457 |       {}458 |       <BaseModal459 |         isOpen={isEditModalOpen}460 |         onClose={() => setIsEditModalOpen(false)}461 |         title="Edit Payment Method"462 |         description="Update the payment method configuration"463 |         size="lg"464 |         variant="default"465 |       >466 |         <BaseModal.Content>467 |           <div className={`space-y-[${spacing[4]}]`}>468 |             <div>469 |               <Label htmlFor="edit-name" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>470 |                 Name *471 |               </Label>472 |               <BaseInput473 |                 id="edit-name"474 |                 value={formData.name}475 |                 onChange={(e) => setFormData({ ...formData, name: e.target.value })}476 |                 placeholder="e.g., Credit Card, PayPal"477 |               />478 |             </div>479 | 480 |             <div>481 |               <Label htmlFor="edit-type" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>482 |                 Type *483 |               </Label>484 |               <Select value={formData.type} onValueChange={(value) => setFormData({ ...formData, type: value })}>485 |                 <SelectTrigger className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}]`}>486 |                   <SelectValue placeholder="Select type" />487 |                 </SelectTrigger>488 |                 <SelectContent className={`bg-[${colors.semantic.surface.secondary}] border-[${colors.border[500]}]`}>489 |                   <SelectItem value="stripe" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>490 |                     Stripe491 |                   </SelectItem>492 |                   <SelectItem value="izipay" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>493 |                     Izipay (Peru)494 |                   </SelectItem>495 |                   <SelectItem value="paypal" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>496 |                     PayPal497 |                   </SelectItem>498 |                   <SelectItem value="bank" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>499 |                     Bank Transfer500 |                   </SelectItem>501 |                   <SelectItem value="crypto" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>502 |                     Cryptocurrency503 |                   </SelectItem>504 |                   <SelectItem value="apple" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>505 |                     Apple Pay506 |                   </SelectItem>507 |                   <SelectItem value="google" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>508 |                     Google Pay509 |                   </SelectItem>510 |                   <SelectItem value="custom" className={`text-[${colors.text.primary}] hover:bg-[${colors.semantic.surface.tertiary}]`}>511 |                     Custom512 |                   </SelectItem>513 |                 </SelectContent>514 |               </Select>515 |             </div>516 | 517 |             <div>518 |               <Label htmlFor="edit-description" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>519 |                 Description520 |               </Label>521 |               <Textarea522 |                 id="edit-description"523 |                 value={formData.description}524 |                 onChange={(e) => setFormData({ ...formData, description: e.target.value })}525 |                 placeholder="Optional description"526 |                 className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}] placeholder:text-[${colors.text.tertiary}]`}527 |               />528 |             </div>529 | 530 |             <div>531 |               <Label htmlFor="edit-icon" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>532 |                 Icon URL533 |               </Label>534 |               <BaseInput535 |                 id="edit-icon"536 |                 value={formData.icon}537 |                 onChange={(e) => setFormData({ ...formData, icon: e.target.value })}538 |                 placeholder="https:539 |               />540 |             </div>541 | 542 |             <div className="grid grid-cols-2 gap-4">543 |               <div className="flex items-center space-x-2">544 |                 <input545 |                   type="checkbox"546 |                   id="edit-requiresConfirmation"547 |                   checked={formData.requiresConfirmation}548 |                   onChange={(e) => setFormData({ ...formData, requiresConfirmation: e.target.checked })}549 |                   className={`rounded border-[${colors.border[500]}] bg-[${colors.semantic.surface.primary}]`}550 |                 />551 |                 <Label htmlFor="edit-requiresConfirmation" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>552 |                   Requires Confirmation553 |                 </Label>554 |               </div>555 | 556 |               <div className="flex items-center space-x-2">557 |                 <input558 |                   type="checkbox"559 |                   id="edit-autoAssignPackage"560 |                   checked={formData.autoAssignPackage}561 |                   onChange={(e) => setFormData({ ...formData, autoAssignPackage: e.target.checked })}562 |                   className={`rounded border-[${colors.border[500]}] bg-[${colors.semantic.surface.primary}]`}563 |                 />564 |                 <Label htmlFor="edit-autoAssignPackage" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>565 |                   Auto Assign Package566 |                 </Label>567 |               </div>568 |             </div>569 | 570 |             <div className="flex items-center space-x-2">571 |               <input572 |                 type="checkbox"573 |                 id="edit-isActive"574 |                 checked={formData.isActive}575 |                 onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}576 |                 className={`rounded border-[${colors.border[500]}] bg-[${colors.semantic.surface.primary}]`}577 |               />578 |               <Label htmlFor="edit-isActive" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>579 |                 Active580 |               </Label>581 |             </div>582 | 583 |             {}584 |             <div>585 |               <Label htmlFor="edit-providerConfig" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>586 |                 Provider Config (JSON)587 |               </Label>588 |               <Textarea589 |                 id="edit-providerConfig"590 |                 value={providerConfig}591 |                 onChange={(e) => setProviderConfig(e.target.value)}592 |                 placeholder='{"merchantId":"...","username":"...","password":"...","publicKey":"...","currency":"PEN","environment":"sandbox","supportedCountries":["PE"],"returnUrl":"/payment/success","cancelUrl":"/payment/cancel"}'593 |                 className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}] placeholder:text-[${colors.text.tertiary}]`}594 |                 rows={6}595 |               />596 |               {formData.type === 'izipay' && (597 |                 <p className={`text-[${colors.text.tertiary}] text-[${typography.fontSize.xs}] mt-1`}>598 |                   Required keys for Izipay: merchantId, username, password, publicKey, currency (PEN), environment (sandbox|production), supportedCountries, returnUrl, cancelUrl599 |                 </p>600 |               )}601 |             </div>602 |           </div>603 |         </BaseModal.Content>604 | 605 |         <BaseModal.Footer>606 |           <BaseButton607 |             variant="outline"608 |             onClick={() => setIsEditModalOpen(false)}609 |           >610 |             Cancel611 |           </BaseButton>612 |           <BaseButton613 |             onClick={handleUpdate}614 |             disabled={!formData.name || !formData.type}615 |             variant="primary"616 |           >617 |             Update618 |           </BaseButton>619 |         </BaseModal.Footer>620 |       </BaseModal>621 |     </div>622 |   );623 | }
============================================================END: frontend/app/(admin)/admin/payment-methods/page.tsx============================================================


============================================================FILE: frontend/app/(admin)/admin/telegram-config/page.tsxSIZE: 0.28 KB============================================================
  1 | import { TelegramConfigManagement } from '@/components/TelegramConfigManagement';  2 |   3 | export default function TelegramConfigPage() {  4 |   return (  5 |     <div className="min-h-screen bg-gray-50">  6 |       <div className="py-8">  7 |         <TelegramConfigManagement />  8 |       </div>  9 |     </div> 10 |   ); 11 | }
============================================================END: frontend/app/(admin)/admin/telegram-config/page.tsx============================================================


============================================================FILE: frontend/app/(admin)/layout-new.tsxSIZE: 2.53 KB============================================================
  1 | 'use client';  2 |   3 | import { AdminDashboard } from '@/components/AdminDashboard';  4 | import { useAuth } from '@/hooks/useAuth';  5 | import { useRouter } from 'next/navigation';  6 | import { useEffect } from 'react';  7 | import { Button } from '@/components/ui/button';  8 | import { Shield, ArrowLeft } from 'lucide-react';  9 |  10 | export default function AdminLayout({ 11 |   children, 12 | }: { 13 |   children: React.ReactNode; 14 | }) { 15 |   const { user, isAdmin, isLoading } = useAuth(); 16 |   const router = useRouter(); 17 |  18 |   useEffect(() => { 19 |  20 |     if (!isLoading && (!user || !isAdmin)) { 21 |  22 |       router.push('/account'); 23 |     } 24 |   }, [user, isAdmin, isLoading, router]); 25 |  26 |   if (isLoading) { 27 |     return ( 28 |       <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e]"> 29 |         <div className="text-center"> 30 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 31 |           <p className="text-[#FFD700] text-lg font-semibold">Loading...</p> 32 |         </div> 33 |       </div> 34 |     ); 35 |   } 36 |  37 |   if (!user || !isAdmin) { 38 |     return ( 39 |       <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e]"> 40 |         <div className="text-center max-w-md mx-auto p-8"> 41 |           <Shield className="w-16 h-16 text-red-500 mx-auto mb-6" /> 42 |           <h1 className="text-2xl font-bold text-white mb-4">Access Denied</h1> 43 |           <p className="text-gray-400 mb-6"> 44 |             You don&apos;t have permission to access the admin dashboard. Please contact an administrator if you believe this is an error. 45 |           </p> 46 |           <div className="flex gap-4 justify-center"> 47 |             <Button 48 |               onClick={() => router.push('/account')} 49 |               className="bg-[#FFD700] text-black hover:bg-[#FFD700]/90" 50 |             > 51 |               <ArrowLeft className="w-4 h-4 mr-2" /> 52 |               Go to Account 53 |             </Button> 54 |             <Button 55 |               onClick={() => router.push('/')} 56 |               variant="outline" 57 |               className="bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]" 58 |             > 59 |               Go Home 60 |             </Button> 61 |           </div> 62 |         </div> 63 |       </div> 64 |     ); 65 |   } 66 |  67 |   return ( 68 |     <AdminDashboard isModal={false}> 69 |       {children} 70 |     </AdminDashboard> 71 |   ); 72 | }
============================================================END: frontend/app/(admin)/layout-new.tsx============================================================


============================================================FILE: frontend/app/(admin)/layout.tsxSIZE: 2.60 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { AdminDashboard } from '@/components/AdminDashboard';  5 | import { useAuth } from '@/hooks/useAuth';  6 | import { useRouter } from 'next/navigation';  7 | import { useEffect } from 'react';  8 | import { Button } from '@/components/ui/button';  9 | import { Shield, ArrowLeft } from 'lucide-react'; 10 |  11 | export default function AdminLayout({ 12 |   children, 13 | }: { 14 |   children: React.ReactNode; 15 | }) { 16 |   const { user, isAdmin, isLoading } = useAuth(); 17 |   const router = useRouter(); 18 |  19 |   useEffect(() => { 20 |  21 |     if (!isLoading && (!user || !isAdmin)) { 22 |  23 |       router.push('/account'); 24 |     } 25 |   }, [user, isAdmin, isLoading, router]); 26 |  27 |   if (isLoading) { 28 |     return ( 29 |       <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e]"> 30 |         <div className="text-center"> 31 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 32 |           <p className="text-[#FFD700] text-lg font-semibold">Loading...</p> 33 |         </div> 34 |       </div> 35 |     ); 36 |   } 37 |  38 |   if (!user || !isAdmin) { 39 |     return ( 40 |       <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e]"> 41 |         <div className="text-center max-w-md mx-auto p-8"> 42 |           <Shield className="w-16 h-16 text-red-500 mx-auto mb-6" /> 43 |           <h1 className="text-2xl font-bold text-white mb-4">Access Denied</h1> 44 |           <p className="text-gray-400 mb-6"> 45 |             You don&apos;t have permission to access the admin dashboard. Please contact an administrator if you believe this is an error. 46 |           </p> 47 |           <div className="flex gap-4 justify-center"> 48 |             <Button 49 |               onClick={() => router.push('/account')} 50 |               className="bg-[#FFD700] text-black hover:bg-[#FFD700]/90" 51 |             > 52 |               <ArrowLeft className="w-4 h-4 mr-2" /> 53 |               Go to Account 54 |             </Button> 55 |             <Button 56 |               onClick={() => router.push('/')} 57 |               variant="outline" 58 |               className="bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]" 59 |             > 60 |               Go Home 61 |             </Button> 62 |           </div> 63 |         </div> 64 |       </div> 65 |     ); 66 |   } 67 |  68 |   return ( 69 |     <AdminDashboard isModal={false}> 70 |       {children} 71 |     </AdminDashboard> 72 |   ); 73 | }
============================================================END: frontend/app/(admin)/layout.tsx============================================================


============================================================FILE: frontend/app/(client)/account/ClientLayout.tsxSIZE: 1.17 KB============================================================
  1 | 'use client';  2 |   3 | import { useEffect } from 'react';  4 | import { useRouter } from 'next/navigation';  5 | import { useAuth } from '@/hooks/useAuth';  6 | import ClientSidebarNav from './ClientSidebarNav';  7 |   8 | export default function ClientLayout({ children }: { children: React.ReactNode }) {  9 |   const { user, isLoading } = useAuth(); 10 |   const router = useRouter(); 11 |  12 |   useEffect(() => { 13 |     if (!isLoading && !user) { 14 |       router.push('/'); 15 |     } 16 |   }, [user, isLoading, router]); 17 |  18 |   if (isLoading) { 19 |     return ( 20 |       <div className="flex items-center justify-center h-screen bg-[#0a0a23]"> 21 |         <div className="text-center"> 22 |           <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#ffd700] mx-auto mb-4"></div> 23 |           <p className="text-gray-400">Loading...</p> 24 |         </div> 25 |       </div> 26 |     ); 27 |   } 28 |  29 |   if (!user) { 30 |     return null; 31 |   } 32 |  33 |   return ( 34 |     <div className="flex h-screen bg-[#0a0a23] inner-page mobile-scrollable"> 35 |       <ClientSidebarNav user={user} /> 36 |       <main className="flex-1 overflow-y-auto p-6 mobile-scrollable"> 37 |         {children} 38 |       </main> 39 |     </div> 40 |   ); 41 | }
============================================================END: frontend/app/(client)/account/ClientLayout.tsx============================================================


============================================================FILE: frontend/app/(client)/account/ClientSidebarNav.tsxSIZE: 3.80 KB============================================================
  1 | 'use client';  2 |   3 | import Link from 'next/link';  4 | import { usePathname } from 'next/navigation';  5 | import {  6 |   HomeIcon,  7 |   PackageIcon,  8 |   CalendarIcon,  9 |   UserIcon, 10 |   LogOutIcon, 11 |   PlusIcon, 12 |   ShoppingCartIcon, 13 |   HistoryIcon, 14 |   VideoIcon 15 | } from 'lucide-react'; 16 | import { Button } from '@/components/ui/button'; 17 | import { sidebarButtonStyles, combineStyles } from '@/lib/styles/common'; 18 | import { createClient } from '@/lib/supabase/client'; 19 |  20 | interface User { 21 |   email: string; 22 |   access_token: string; 23 |   role?: string; 24 |   id?: string; 25 | } 26 |  27 | interface ClientSidebarNavProps { 28 |   user: User; 29 | } 30 |  31 | export default function ClientSidebarNav({ user }: ClientSidebarNavProps) { 32 |   const pathname = usePathname(); 33 |   const supabase = createClient(); 34 |  35 |   const navigation = [ 36 |     { 37 |       name: 'Dashboard', 38 |       href: '/account', 39 |       icon: HomeIcon, 40 |       current: pathname === '/account' 41 |     }, 42 |     { 43 |       name: 'Book a Session', 44 |       href: '/account/book', 45 |       icon: PlusIcon, 46 |       current: pathname === '/account/book' 47 |     }, 48 |     { 49 |       name: 'Purchase Packages', 50 |       href: '/account/purchase', 51 |       icon: ShoppingCartIcon, 52 |       current: pathname === '/account/purchase' 53 |     }, 54 |     { 55 |       name: 'My Packages', 56 |       href: '/account/my-packages', 57 |       icon: PackageIcon, 58 |       current: pathname === '/account/my-packages' 59 |     }, 60 |     { 61 |       name: 'Live Sessions', 62 |       href: '/account/live-session', 63 |       icon: VideoIcon, 64 |       current: pathname === '/account/live-session' 65 |     }, 66 |     { 67 |       name: 'My Sessions', 68 |       href: '/account/sessions', 69 |       icon: CalendarIcon, 70 |       current: pathname === '/account/sessions' 71 |     }, 72 |     { 73 |       name: 'Purchase History', 74 |       href: '/account/purchase-history', 75 |       icon: HistoryIcon, 76 |       current: pathname === '/account/purchase-history' 77 |     }, 78 |     { 79 |       name: 'My Profile', 80 |       href: '/account/profile', 81 |       icon: UserIcon, 82 |       current: pathname === '/account/profile' 83 |     } 84 |   ]; 85 |  86 |   const handleSignOut = async () => { 87 |     await supabase.auth.signOut(); 88 |     window.location.href = '/'; 89 |   }; 90 |  91 |   return ( 92 |     <div className="flex w-64 flex-col bg-[var(--color-sidebar-800)] border-r border-[var(--color-border-500)]"> 93 |       {} 94 |       <div className="flex h-16 items-center justify-center border-b border-[var(--color-border-500)]"> 95 |         <h1 className="text-xl font-bold text-[var(--color-text-inverse)]">MatMax</h1> 96 |       </div> 97 |  98 |       {} 99 |       <nav className="flex-1 space-y-1 px-4 py-6">100 |         {navigation.map((item) => {101 |           const Icon = item.icon;102 |           return (103 |             <Link104 |               key={item.name}105 |               href={item.href}106 |               className={combineStyles(107 |                 'group',108 |                 sidebarButtonStyles.base,109 |                 item.current ? sidebarButtonStyles.variants.active : sidebarButtonStyles.variants.inactive,110 |                 'text-[var(--color-text-inverse)]'111 |               )}112 |             >113 |               <Icon114 |                 className={combineStyles('mr-3 h-5 w-5 flex-shrink-0', sidebarButtonStyles.icon)}115 |               />116 |               {item.name}117 |             </Link>118 |           );119 |         })}120 |       </nav>121 | 122 |       {}123 |       <div className="border-t border-[var(--color-border-500)] p-4">124 |         <div className="mb-4">125 |           <p className="text-sm text-[var(--color-text-secondary)]">Signed in as</p>126 |           <p className="text-sm font-medium text-[var(--color-text-inverse)] truncate">{user.email}</p>127 |         </div>128 |         <Button129 |           onClick={handleSignOut}130 |           variant="outline"131 |           size="sm"132 |           className="w-full border-[var(--color-border-500)] text-[var(--color-text-secondary)] hover:bg-[var(--color-sidebar-700)] hover:text-[var(--color-text-inverse)]"133 |         >134 |           <LogOutIcon className="mr-2 h-4 w-4" />135 |           Sign Out136 |         </Button>137 |       </div>138 |     </div>139 |   );140 | }
============================================================END: frontend/app/(client)/account/ClientSidebarNav.tsx============================================================


============================================================FILE: frontend/app/(client)/account/book/page.tsxSIZE: 0.22 KB============================================================
  1 | 'use client';  2 |   3 | import { CustomerBookingFlow } from '@/components/CustomerBookingFlow';  4 |   5 | export default function BookPage() {  6 |   return (  7 |     <div className="container mx-auto p-6">  8 |       <CustomerBookingFlow />  9 |     </div> 10 |   ); 11 | }
============================================================END: frontend/app/(client)/account/book/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/live-session/page.tsxSIZE: 19.32 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Badge } from '@/components/ui/badge';  7 | import { Video, Calendar, Clock, Users, Mic, MicOff, VideoIcon, VideoOff, PhoneOff, Settings, Share2, MessageSquare } from 'lucide-react';  8 | import { toast } from 'sonner';  9 | import { useAuth } from '@/hooks/useAuth'; 10 |  11 | interface LiveSessionConfig { 12 |   id: string; 13 |   name: string; 14 |   provider: 'zoom' | 'meet' | 'teams' | 'custom'; 15 |   apiKey: string; 16 |   meetingId?: string; 17 |   meetingUrl?: string; 18 |   isActive: boolean; 19 |   settings: { 20 |     allowVideo: boolean; 21 |     allowAudio: boolean; 22 |     allowChat: boolean; 23 |     allowScreenShare: boolean; 24 |     maxParticipants: number; 25 |     recordingEnabled: boolean; 26 |   }; 27 | } 28 |  29 | interface UpcomingSession { 30 |   id: string; 31 |   title: string; 32 |   description: string; 33 |   startTime: string; 34 |   endTime: string; 35 |   duration: number; 36 |   status: 'scheduled' | 'live' | 'ended'; 37 |   meetingUrl?: string; 38 |   meetingId?: string; 39 |   participants: number; 40 |   maxParticipants: number; 41 | } 42 |  43 | export default function LiveSessionPage() { 44 |   const { user } = useAuth(); 45 |   const [config, setConfig] = useState<LiveSessionConfig | null>(null); 46 |   const [upcomingSessions, setUpcomingSessions] = useState<UpcomingSession[]>([]); 47 |   const [currentSession, setCurrentSession] = useState<UpcomingSession | null>(null); 48 |   const [isInSession, setIsInSession] = useState(false); 49 |   const [loading, setLoading] = useState(true); 50 |   const [sessionSettings, setSessionSettings] = useState({ 51 |     videoEnabled: true, 52 |     audioEnabled: true, 53 |     chatEnabled: true, 54 |     screenShareEnabled: false 55 |   }); 56 |  57 |   const loadConfig = useCallback(async () => { 58 |     if (!user?.access_token) return; 59 |  60 |     try { 61 |       const response = await fetch('/api/client/live-session/config', { 62 |         headers: { 63 |           'Authorization': `Bearer ${user.access_token}`, 64 |           'Content-Type': 'application/json' 65 |         } 66 |       }); 67 |  68 |       if (response.ok) { 69 |         const data = await response.json(); 70 |         if (data.success) { 71 |           setConfig(data.data); 72 |         } 73 |       } 74 |     } catch (error) { 75 |       } 76 |   }, [user?.access_token]); 77 |  78 |   const loadUpcomingSessions = useCallback(async () => { 79 |     if (!user?.access_token) return; 80 |  81 |     try { 82 |       const response = await fetch('/api/client/live-session/upcoming', { 83 |         headers: { 84 |           'Authorization': `Bearer ${user.access_token}`, 85 |           'Content-Type': 'application/json' 86 |         } 87 |       }); 88 |  89 |       if (response.ok) { 90 |         const data = await response.json(); 91 |         if (data.success) { 92 |           setUpcomingSessions(data.data); 93 |  94 |           const liveSession = data.data.find((session: UpcomingSession) => session.status === 'live'); 95 |           if (liveSession) { 96 |             setCurrentSession(liveSession); 97 |             setIsInSession(true); 98 |           } 99 |         }100 |       }101 |     } catch (error) {102 |       }103 |   }, [user?.access_token]);104 | 105 |   const loadData = useCallback(async () => {106 |     setLoading(true);107 |     try {108 |       await Promise.all([109 |         loadConfig(),110 |         loadUpcomingSessions()111 |       ]);112 |     } catch (error) {113 |       toast.error('Failed to load live session data');114 |     } finally {115 |       setLoading(false);116 |     }117 |   }, [loadConfig, loadUpcomingSessions]);118 | 119 |   useEffect(() => {120 |     if (user?.access_token) {121 |       loadData();122 |     }123 |   }, [user?.access_token, loadData]);124 | 125 |   const joinSession = async (session: UpcomingSession) => {126 |     try {127 |       if (!config) {128 |         toast.error('Live session configuration not available');129 |         return;130 |       }131 | 132 |       if (!session.meetingUrl) {133 |         const response = await fetch('/api/client/live-session/create-meeting', {134 |           method: 'POST',135 |           headers: {136 |             'Authorization': `Bearer ${user?.access_token}`,137 |             'Content-Type': 'application/json'138 |           },139 |           body: JSON.stringify({140 |             sessionId: session.id,141 |             title: session.title,142 |             duration: session.duration,143 |             settings: sessionSettings144 |           })145 |         });146 | 147 |         const result = await response.json();148 |         if (result.success) {149 |           session.meetingUrl = result.data.meetingUrl;150 |           session.meetingId = result.data.meetingId;151 |         }152 |       }153 | 154 |       if (session.meetingUrl) {155 |         setCurrentSession(session);156 |         setIsInSession(true);157 |         toast.success('Joining live session...');158 |       } else {159 |         toast.error('Failed to create meeting');160 |       }161 |     } catch (error) {162 |       toast.error('Failed to join session');163 |     }164 |   };165 | 166 |   const leaveSession = () => {167 |     setIsInSession(false);168 |     setCurrentSession(null);169 |     toast.success('Left the session');170 |   };171 | 172 |   const toggleVideo = () => {173 |     setSessionSettings(prev => ({ ...prev, videoEnabled: !prev.videoEnabled }));174 |   };175 | 176 |   const toggleAudio = () => {177 |     setSessionSettings(prev => ({ ...prev, audioEnabled: !prev.audioEnabled }));178 |   };179 | 180 |   const toggleChat = () => {181 |     setSessionSettings(prev => ({ ...prev, chatEnabled: !prev.chatEnabled }));182 |   };183 | 184 |   const toggleScreenShare = () => {185 |     setSessionSettings(prev => ({ ...prev, screenShareEnabled: !prev.screenShareEnabled }));186 |   };187 | 188 |   const formatTime = (dateString: string) => {189 |     return new Date(dateString).toLocaleString('en-US', {190 |       weekday: 'short',191 |       year: 'numeric',192 |       month: 'short',193 |       day: 'numeric',194 |       hour: '2-digit',195 |       minute: '2-digit'196 |     });197 |   };198 | 199 |   const getStatusColor = (status: string) => {200 |     switch (status) {201 |       case 'scheduled': return 'bg-blue-500';202 |       case 'live': return 'bg-green-500';203 |       case 'ended': return 'bg-gray-500';204 |       default: return 'bg-gray-500';205 |     }206 |   };207 | 208 |   const getStatusText = (status: string) => {209 |     switch (status) {210 |       case 'scheduled': return 'Scheduled';211 |       case 'live': return 'Live Now';212 |       case 'ended': return 'Ended';213 |       default: return 'Unknown';214 |     }215 |   };216 | 217 |   if (loading) {218 |     return (219 |       <div className="flex items-center justify-center min-h-[400px]">220 |         <div className="text-center">221 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>222 |           <p className="text-[#FFD700] text-lg font-semibold">Loading live sessions...</p>223 |         </div>224 |       </div>225 |     );226 |   }227 | 228 |   if (isInSession && currentSession) {229 |     return (230 |       <div className="min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e]">231 |         <div className="container mx-auto p-6">232 |           {}233 |           <div className="flex justify-between items-center mb-6">234 |             <div>235 |               <h1 className="text-2xl font-bold text-white">{currentSession.title}</h1>236 |               <p className="text-gray-400">{currentSession.description}</p>237 |             </div>238 |             <Button239 |               onClick={leaveSession}240 |               variant="outline"241 |               className="bg-red-600 text-white border-red-600 hover:bg-red-700"242 |             >243 |               <PhoneOff className="w-4 h-4 mr-2" />244 |               Leave Session245 |             </Button>246 |           </div>247 | 248 |           {}249 |           <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">250 |             {}251 |             <div className="lg:col-span-3">252 |               <Card className="bg-[#1a1a2e] border-[#16213e] h-[600px]">253 |                 <CardContent className="p-0 h-full">254 |                   {config?.provider === 'zoom' ? (255 |                     <iframe256 |                       src={currentSession.meetingUrl}257 |                       className="w-full h-full rounded-lg"258 |                       allow="camera; microphone; fullscreen; speaker; display-capture"259 |                       title="Zoom Meeting"260 |                     />261 |                   ) : config?.provider === 'meet' ? (262 |                     <iframe263 |                       src={currentSession.meetingUrl}264 |                       className="w-full h-full rounded-lg"265 |                       allow="camera; microphone; fullscreen; speaker; display-capture"266 |                       title="Google Meet"267 |                     />268 |                   ) : config?.provider === 'teams' ? (269 |                     <iframe270 |                       src={currentSession.meetingUrl}271 |                       className="w-full h-full rounded-lg"272 |                       allow="camera; microphone; fullscreen; speaker; display-capture"273 |                       title="Microsoft Teams"274 |                     />275 |                   ) : (276 |                     <div className="flex items-center justify-center h-full text-white">277 |                       <div className="text-center">278 |                         <Video className="w-16 h-16 mx-auto mb-4 text-[#ffd700]" />279 |                         <h3 className="text-xl font-semibold mb-2">Live Session</h3>280 |                         <p className="text-gray-400">Video conference will start here</p>281 |                         <p className="text-sm text-gray-500 mt-2">Meeting ID: {currentSession.meetingId}</p>282 |                       </div>283 |                     </div>284 |                   )}285 |                 </CardContent>286 |               </Card>287 |             </div>288 | 289 |             {}290 |             <div className="space-y-4">291 |               {}292 |               <Card className="bg-[#1a1a2e] border-[#16213e]">293 |                 <CardHeader>294 |                   <CardTitle className="text-white text-lg">Session Info</CardTitle>295 |                 </CardHeader>296 |                 <CardContent className="space-y-3">297 |                   <div className="flex items-center space-x-2">298 |                     <Users className="w-4 h-4 text-[#ffd700]" />299 |                     <span className="text-white text-sm">300 |                       {currentSession.participants}/{currentSession.maxParticipants} participants301 |                     </span>302 |                   </div>303 |                   <div className="flex items-center space-x-2">304 |                     <Clock className="w-4 h-4 text-[#ffd700]" />305 |                     <span className="text-white text-sm">306 |                       {currentSession.duration} minutes307 |                     </span>308 |                   </div>309 |                   <Badge className={`${getStatusColor(currentSession.status)} text-white`}>310 |                     {getStatusText(currentSession.status)}311 |                   </Badge>312 |                 </CardContent>313 |               </Card>314 | 315 |               {}316 |               <Card className="bg-[#1a1a2e] border-[#16213e]">317 |                 <CardHeader>318 |                   <CardTitle className="text-white text-lg">Controls</CardTitle>319 |                 </CardHeader>320 |                 <CardContent className="space-y-3">321 |                   <Button322 |                     onClick={toggleVideo}323 |                     variant={sessionSettings.videoEnabled ? "default" : "outline"}324 |                     className={`w-full ${sessionSettings.videoEnabled ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'}`}325 |                   >326 |                     {sessionSettings.videoEnabled ? <VideoIcon className="w-4 h-4 mr-2" /> : <VideoOff className="w-4 h-4 mr-2" />}327 |                     {sessionSettings.videoEnabled ? 'Video On' : 'Video Off'}328 |                   </Button>329 | 330 |                   <Button331 |                     onClick={toggleAudio}332 |                     variant={sessionSettings.audioEnabled ? "default" : "outline"}333 |                     className={`w-full ${sessionSettings.audioEnabled ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'}`}334 |                   >335 |                     {sessionSettings.audioEnabled ? <Mic className="w-4 h-4 mr-2" /> : <MicOff className="w-4 h-4 mr-2" />}336 |                     {sessionSettings.audioEnabled ? 'Audio On' : 'Audio Off'}337 |                   </Button>338 | 339 |                   <Button340 |                     onClick={toggleScreenShare}341 |                     variant={sessionSettings.screenShareEnabled ? "default" : "outline"}342 |                     className={`w-full ${sessionSettings.screenShareEnabled ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-600 hover:bg-gray-700'}`}343 |                   >344 |                     <Share2 className="w-4 h-4 mr-2" />345 |                     {sessionSettings.screenShareEnabled ? 'Stop Share' : 'Share Screen'}346 |                   </Button>347 | 348 |                   <Button349 |                     onClick={toggleChat}350 |                     variant={sessionSettings.chatEnabled ? "default" : "outline"}351 |                     className={`w-full ${sessionSettings.chatEnabled ? 'bg-purple-600 hover:bg-purple-700' : 'bg-gray-600 hover:bg-gray-700'}`}352 |                   >353 |                     <MessageSquare className="w-4 h-4 mr-2" />354 |                     {sessionSettings.chatEnabled ? 'Chat On' : 'Chat Off'}355 |                   </Button>356 |                 </CardContent>357 |               </Card>358 | 359 |               {}360 |               <Card className="bg-[#1a1a2e] border-[#16213e]">361 |                 <CardHeader>362 |                   <CardTitle className="text-white text-lg">Quick Actions</CardTitle>363 |                 </CardHeader>364 |                 <CardContent className="space-y-2">365 |                   <Button366 |                     variant="outline"367 |                     className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"368 |                   >369 |                     <Settings className="w-4 h-4 mr-2" />370 |                     Settings371 |                   </Button>372 |                   <Button373 |                     variant="outline"374 |                     className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"375 |                   >376 |                     <Share2 className="w-4 h-4 mr-2" />377 |                     Invite Others378 |                   </Button>379 |                 </CardContent>380 |               </Card>381 |             </div>382 |           </div>383 |         </div>384 |       </div>385 |     );386 |   }387 | 388 |   return (389 |     <div className="min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e]">390 |       <div className="container mx-auto p-6">391 |         <div className="text-center mb-8">392 |           <h1 className="text-4xl font-bold text-white mb-4">Live Sessions</h1>393 |           <p className="text-gray-400 text-lg">Join your spiritual guidance sessions</p>394 |         </div>395 | 396 |         {}397 |         {config ? (398 |           <Card className="bg-[#1a1a2e] border-[#16213e] mb-6">399 |             <CardContent className="p-4">400 |               <div className="flex items-center justify-between">401 |                 <div className="flex items-center space-x-3">402 |                   <Video className="w-6 h-6 text-[#ffd700]" />403 |                   <div>404 |                     <h3 className="text-white font-semibold">Live Session Ready</h3>405 |                     <p className="text-gray-400 text-sm">406 |                       Provider: {config.name} • Status: {config.isActive ? 'Active' : 'Inactive'}407 |                     </p>408 |                   </div>409 |                 </div>410 |                 <Badge className={config.isActive ? 'bg-green-500' : 'bg-red-500'}>411 |                   {config.isActive ? 'Connected' : 'Disconnected'}412 |                 </Badge>413 |               </div>414 |             </CardContent>415 |           </Card>416 |         ) : (417 |           <Card className="bg-[#1a1a2e] border-[#16213e] mb-6">418 |             <CardContent className="p-4">419 |               <div className="text-center">420 |                 <Video className="w-12 h-12 text-gray-500 mx-auto mb-4" />421 |                 <h3 className="text-white font-semibold mb-2">Live Session Not Configured</h3>422 |                 <p className="text-gray-400 text-sm">423 |                   Please contact your administrator to set up live session capabilities.424 |                 </p>425 |               </div>426 |             </CardContent>427 |           </Card>428 |         )}429 | 430 |         {}431 |         <div className="space-y-6">432 |           <h2 className="text-2xl font-bold text-white">Upcoming Sessions</h2>433 | 434 |           {upcomingSessions.length === 0 ? (435 |             <Card className="bg-[#1a1a2e] border-[#16213e]">436 |               <CardContent className="p-8 text-center">437 |                 <Calendar className="w-16 h-16 text-gray-500 mx-auto mb-4" />438 |                 <h3 className="text-white font-semibold mb-2">No Sessions Scheduled</h3>439 |                 <p className="text-gray-400">440 |                   You don&apos;t have any upcoming live sessions. Check back later or contact your spiritual guide.441 |                 </p>442 |               </CardContent>443 |             </Card>444 |           ) : (445 |             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">446 |               {upcomingSessions.map((session) => (447 |                 <Card key={session.id} className="bg-[#1a1a2e] border-[#16213e] hover:border-[#ffd700]/50 transition-colors">448 |                   <CardHeader>449 |                     <div className="flex justify-between items-start">450 |                       <CardTitle className="text-white text-lg">{session.title}</CardTitle>451 |                       <Badge className={`${getStatusColor(session.status)} text-white`}>452 |                         {getStatusText(session.status)}453 |                       </Badge>454 |                     </div>455 |                     <p className="text-gray-400 text-sm">{session.description}</p>456 |                   </CardHeader>457 |                   <CardContent className="space-y-4">458 |                     <div className="space-y-2">459 |                       <div className="flex items-center space-x-2">460 |                         <Clock className="w-4 h-4 text-[#ffd700]" />461 |                         <span className="text-white text-sm">462 |                           {formatTime(session.startTime)}463 |                         </span>464 |                       </div>465 |                       <div className="flex items-center space-x-2">466 |                         <Users className="w-4 h-4 text-[#ffd700]" />467 |                         <span className="text-white text-sm">468 |                           {session.participants}/{session.maxParticipants} participants469 |                         </span>470 |                       </div>471 |                     </div>472 | 473 |                     {session.status === 'live' && (474 |                       <Button475 |                         onClick={() => joinSession(session)}476 |                         className="w-full bg-green-600 hover:bg-green-700 text-white"477 |                       >478 |                         <Video className="w-4 h-4 mr-2" />479 |                         Join Live Session480 |                       </Button>481 |                     )}482 | 483 |                     {session.status === 'scheduled' && (484 |                       <Button485 |                         onClick={() => joinSession(session)}486 |                         disabled={!config?.isActive}487 |                         className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"488 |                       >489 |                         <Video className="w-4 h-4 mr-2" />490 |                         Join Session491 |                       </Button>492 |                     )}493 | 494 |                     {session.status === 'ended' && (495 |                       <Button496 |                         disabled497 |                         className="w-full bg-gray-600 text-white cursor-not-allowed"498 |                       >499 |                         Session Ended500 |                       </Button>501 |                     )}502 |                   </CardContent>503 |                 </Card>504 |               ))}505 |             </div>506 |           )}507 |         </div>508 |       </div>509 |     </div>510 |   );511 | }
============================================================END: frontend/app/(client)/account/live-session/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/loading.tsxSIZE: 0.21 KB============================================================
  1 | export default function Loading() {  2 |   return (  3 |     <div className="flex items-center justify-center h-64">  4 |       <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#ffd700]"></div>  5 |     </div>  6 |   );  7 | }
============================================================END: frontend/app/(client)/account/loading.tsx============================================================


============================================================FILE: frontend/app/(client)/account/my-packages/page.tsxSIZE: 8.97 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Badge } from '@/components/ui/badge';  7 | import { PackageIcon, CalendarIcon, ClockIcon, ShoppingCart, CheckCircle, AlertCircle } from 'lucide-react';  8 | import { useAuth } from '@/hooks/useAuth';  9 | import Link from 'next/link'; 10 |  11 | interface UserPackage { 12 |   id: string; 13 |   packageId: number; 14 |   packageName: string; 15 |   packageDescription: string; 16 |   sessionsRemaining: number; 17 |   totalSessions: number; 18 |   expiresAt: string; 19 |   isActive: boolean; 20 |   purchaseDate: string; 21 |   price: number; 22 |   sessionDuration: number; 23 |   status: 'active' | 'expired' | 'completed'; 24 | } 25 |  26 | export default function MyPackagesPage() { 27 |   const { user } = useAuth(); 28 |   const [packages, setPackages] = useState<UserPackage[]>([]); 29 |   const [loading, setLoading] = useState(true); 30 |  31 |   const fetchMyPackages = useCallback(async () => { 32 |     try { 33 |       setLoading(true); 34 |       const response = await fetch('/api/client/my-packages', { 35 |         headers: { 36 |           'Authorization': `Bearer ${user?.access_token}`, 37 |           'Content-Type': 'application/json' 38 |         } 39 |       }); 40 |  41 |       const result = await response.json(); 42 |  43 |       if (result.success) { 44 |         setPackages(result.data); 45 |       } else { 46 |         } 47 |     } catch (error) { 48 |       } finally { 49 |       setLoading(false); 50 |     } 51 |   }, [user?.access_token]); 52 |  53 |   useEffect(() => { 54 |     if (user?.access_token) { 55 |       fetchMyPackages(); 56 |     } 57 |   }, [user?.access_token, fetchMyPackages]); 58 |  59 |   const getStatusColor = (status: string) => { 60 |     switch (status.toLowerCase()) { 61 |       case 'active': 62 |         return 'bg-green-500/20 text-green-400 border-green-500/30'; 63 |       case 'expired': 64 |         return 'bg-red-500/20 text-red-400 border-red-500/30'; 65 |       case 'completed': 66 |         return 'bg-blue-500/20 text-blue-400 border-blue-500/30'; 67 |       default: 68 |         return 'bg-gray-500/20 text-gray-400 border-gray-500/30'; 69 |     } 70 |   }; 71 |  72 |   const getStatusIcon = (status: string) => { 73 |     switch (status.toLowerCase()) { 74 |       case 'active': 75 |         return <CheckCircle className="w-4 h-4" />; 76 |       case 'expired': 77 |         return <AlertCircle className="w-4 h-4" />; 78 |       case 'completed': 79 |         return <CheckCircle className="w-4 h-4" />; 80 |       default: 81 |         return <AlertCircle className="w-4 h-4" />; 82 |     } 83 |   }; 84 |  85 |   if (loading) { 86 |     return ( 87 |       <div className="flex items-center justify-center min-h-[400px]"> 88 |         <div className="text-center"> 89 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 90 |           <p className="text-[#FFD700] text-lg font-semibold">Loading your packages...</p> 91 |         </div> 92 |       </div> 93 |     ); 94 |   } 95 |  96 |   return ( 97 |     <div className="container mx-auto p-6 space-y-6"> 98 |       <div className="text-center"> 99 |         <h1 className="text-3xl font-bold text-white">My Packages</h1>100 |         <p className="text-gray-400 mt-2">View your purchased spiritual consultation packages</p>101 |       </div>102 | 103 |       {packages.length === 0 ? (104 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">105 |           <CardContent className="p-8 text-center">106 |             <div className="space-y-4">107 |               <PackageIcon className="w-16 h-16 text-gray-500 mx-auto" />108 |               <h3 className="text-xl font-semibold text-gray-300">No Packages Yet</h3>109 |               <p className="text-gray-400">110 |                 You haven&apos;t purchased any packages yet. Start your spiritual journey today!111 |               </p>112 |               <Link href="/account/packages">113 |                 <Button className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90">114 |                   <ShoppingCart className="w-4 h-4 mr-2" />115 |                   Browse Packages116 |                 </Button>117 |               </Link>118 |             </div>119 |           </CardContent>120 |         </Card>121 |       ) : (122 |         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">123 |           {packages.map((pkg) => (124 |             <Card key={pkg.id} className="bg-[#1a1a2e] border-[#16213e] text-white hover:border-[#ffd700]/50 transition-all">125 |               <CardHeader className="pb-3">126 |                 <div className="flex justify-between items-start">127 |                   <div className="flex items-center space-x-2">128 |                     <PackageIcon className="w-5 h-5 text-[#ffd700]" />129 |                     <CardTitle className="text-lg">{pkg.packageName}</CardTitle>130 |                   </div>131 |                   <Badge className={getStatusColor(pkg.status)}>132 |                     <div className="flex items-center space-x-1">133 |                       {getStatusIcon(pkg.status)}134 |                       <span>{pkg.status}</span>135 |                     </div>136 |                   </Badge>137 |                 </div>138 |               </CardHeader>139 |               <CardContent className="space-y-4">140 |                 <p className="text-gray-300 text-sm">{pkg.packageDescription}</p>141 | 142 |                 <div className="grid grid-cols-2 gap-4">143 |                   <div className="text-center">144 |                     <div className="text-2xl font-bold text-[#ffd700]">{pkg.sessionsRemaining}</div>145 |                     <div className="text-xs text-gray-400">Sessions Left</div>146 |                   </div>147 |                   <div className="text-center">148 |                     <div className="text-2xl font-bold text-white">{pkg.totalSessions}</div>149 |                     <div className="text-xs text-gray-400">Total Sessions</div>150 |                   </div>151 |                 </div>152 | 153 |                 <div className="space-y-2">154 |                   <div className="flex items-center space-x-2 text-sm text-gray-300">155 |                     <ClockIcon className="w-4 h-4" />156 |                     <span>{pkg.sessionDuration} minutes per session</span>157 |                   </div>158 |                   <div className="flex items-center space-x-2 text-sm text-gray-300">159 |                     <CalendarIcon className="w-4 h-4" />160 |                     <span>Expires: {new Date(pkg.expiresAt).toLocaleDateString()}</span>161 |                   </div>162 |                 </div>163 | 164 |                 <div className="pt-4 border-t border-[#2a2a4a]">165 |                   <div className="flex justify-between items-center mb-3">166 |                     <span className="text-sm text-gray-400">Purchase Date:</span>167 |                     <span className="text-sm text-white">{new Date(pkg.purchaseDate).toLocaleDateString()}</span>168 |                   </div>169 |                   <div className="flex justify-between items-center">170 |                     <span className="text-sm text-gray-400">Price:</span>171 |                     <span className="text-sm font-bold text-[#ffd700]">172 |                       ${typeof pkg.price === 'number' && !isNaN(pkg.price)173 |                         ? pkg.price.toFixed(2)174 |                         : <span className="text-red-400 text-xs" title={`Raw value: ${pkg.price}`}>175 |                             {pkg.price !== undefined && pkg.price !== null ? String(pkg.price) : 'Contact for price'}176 |                           </span>177 |                       }178 |                     </span>179 |                   </div>180 |                 </div>181 | 182 |                 {pkg.status === 'active' && pkg.sessionsRemaining > 0 && (183 |                   <Link href="/account/book">184 |                     <Button className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90">185 |                       <CalendarIcon className="w-4 h-4 mr-2" />186 |                       Book Session187 |                     </Button>188 |                   </Link>189 |                 )}190 |               </CardContent>191 |             </Card>192 |           ))}193 |         </div>194 |       )}195 | 196 |       {}197 |       {packages.length > 0 && (198 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">199 |           <CardHeader>200 |             <CardTitle>Package Statistics</CardTitle>201 |           </CardHeader>202 |           <CardContent>203 |             <div className="grid grid-cols-1 md:grid-cols-3 gap-6">204 |               <div className="text-center">205 |                 <div className="text-3xl font-bold text-[#ffd700]">206 |                   {packages.filter(p => p.status === 'active').length}207 |                 </div>208 |                 <div className="text-sm text-gray-400">Active Packages</div>209 |               </div>210 |               <div className="text-center">211 |                 <div className="text-3xl font-bold text-white">212 |                   {packages.reduce((sum, p) => sum + p.sessionsRemaining, 0)}213 |                 </div>214 |                 <div className="text-sm text-gray-400">Sessions Remaining</div>215 |               </div>216 |               <div className="text-center">217 |                 <div className="text-3xl font-bold text-green-400">218 |                   {packages.reduce((sum, p) => sum + (p.totalSessions - p.sessionsRemaining), 0)}219 |                 </div>220 |                 <div className="text-sm text-gray-400">Sessions Used</div>221 |               </div>222 |             </div>223 |           </CardContent>224 |         </Card>225 |       )}226 |     </div>227 |   );228 | }
============================================================END: frontend/app/(client)/account/my-packages/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/packages/page.tsxSIZE: 7.56 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { PackageIcon, CalendarIcon, ShoppingCart } from 'lucide-react';  7 |   8 | import { PackagePurchaseFlow } from '@/components/PackagePurchaseFlow';  9 |  10 | interface Package { 11 |   id: number; 12 |   name: string; 13 |   description: string; 14 |   price: number; 15 |   duration_minutes: number; 16 |   is_active: boolean; 17 |   features: string[]; 18 |   created_at: string; 19 |   updated_at: string; 20 |   packagePrices?: Array<{ 21 |     price: number; 22 |     currency: { 23 |       symbol: string; 24 |       code: string; 25 |     }; 26 |   }>; 27 |   sessionDuration?: { 28 |     duration_minutes: number; 29 |   }; 30 | } 31 |  32 | export default function PackagesPage() { 33 |   const [packages, setPackages] = useState<Package[]>([]); 34 |   const [loading, setLoading] = useState(true); 35 |   const [showPurchaseFlow, setShowPurchaseFlow] = useState(false); 36 |  37 |   useEffect(() => { 38 |     fetchPackages(); 39 |   }, []); 40 |  41 |   const fetchPackages = async () => { 42 |     try { 43 |       setLoading(true); 44 |       const response = await fetch('/api/client/packages'); 45 |       const result = await response.json(); 46 |  47 |       if (result.success) { 48 |         setPackages(result.data); 49 |       } else { 50 |         } 51 |     } catch (error) { 52 |       } finally { 53 |       setLoading(false); 54 |     } 55 |   }; 56 |  57 |   if (loading) { 58 |     return ( 59 |       <div className="flex items-center justify-center min-h-[400px]"> 60 |         <div className="text-center"> 61 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 62 |           <p className="text-[#FFD700] text-lg font-semibold">Loading available packages...</p> 63 |         </div> 64 |       </div> 65 |     ); 66 |   } 67 |  68 |   if (showPurchaseFlow) { 69 |     return ( 70 |       <div className="container mx-auto p-6"> 71 |         <div className="mb-6"> 72 |           <Button 73 |             variant="outline" 74 |             onClick={() => setShowPurchaseFlow(false)} 75 |             className="mb-4 border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white" 76 |           > 77 |             ← Back to Packages 78 |           </Button> 79 |         </div> 80 |         <PackagePurchaseFlow /> 81 |       </div> 82 |     ); 83 |   } 84 |  85 |   return ( 86 |     <div className="container mx-auto p-6 space-y-6"> 87 |       <div className="text-center"> 88 |         <h1 className="text-3xl font-bold text-white">Available Packages</h1> 89 |         <p className="text-gray-400 mt-2">Choose the perfect package for your spiritual journey</p> 90 |       </div> 91 |  92 |       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> 93 |         {packages.map((pkg) => ( 94 |           <Card key={pkg.id} className="bg-[#1a1a2e] border-[#16213e] text-white hover:border-[#ffd700]/50 transition-all"> 95 |             <CardHeader className="pb-3"> 96 |               <div className="flex justify-between items-start"> 97 |                 <div className="flex items-center space-x-2"> 98 |                   <PackageIcon className="w-5 h-5 text-[#ffd700]" /> 99 |                   <CardTitle className="text-lg">{pkg.name}</CardTitle>100 |                 </div>101 |                 <div className="text-right">102 |                   <div className="text-2xl font-bold text-[#ffd700]">103 |                     {pkg.packagePrices && pkg.packagePrices.length > 0104 |                       ? <>105 |                           {pkg.packagePrices[0].currency.symbol}106 |                           {typeof pkg.packagePrices[0].price === 'number' && !isNaN(pkg.packagePrices[0].price)107 |                             ? pkg.packagePrices[0].price.toFixed(2)108 |                             : <span className="text-red-400 text-sm" title={`Raw value: ${pkg.packagePrices[0].price}`}>109 |                                 {pkg.packagePrices[0].price !== undefined && pkg.packagePrices[0].price !== null ? String(pkg.packagePrices[0].price) : 'Contact for price'}110 |                               </span>111 |                           }112 |                         </>113 |                       : 'Price TBD'114 |                     }115 |                   </div>116 |                   <div className="text-sm text-gray-400">117 |                     {pkg.packagePrices && pkg.packagePrices.length > 0118 |                       ? pkg.packagePrices[0].currency.code119 |                       : 'USD'120 |                     }121 |                   </div>122 |                 </div>123 |               </div>124 |             </CardHeader>125 |             <CardContent className="space-y-4">126 |               <p className="text-gray-300 text-sm">{pkg.description}</p>127 | 128 |               <div className="flex items-center space-x-2 text-sm text-gray-400">129 |                 <CalendarIcon className="w-4 h-4" />130 |                 <span>{pkg.sessionDuration?.duration_minutes || 'N/A'} minutes</span>131 |               </div>132 | 133 |               {pkg.features && pkg.features.length > 0 && (134 |                 <div className="space-y-2">135 |                   <h4 className="text-sm font-medium text-white">Features:</h4>136 |                   <ul className="space-y-1">137 |                     {pkg.features.map((feature, index) => (138 |                       <li key={index} className="text-sm text-gray-300">• {feature}</li>139 |                     ))}140 |                   </ul>141 |                 </div>142 |               )}143 | 144 |               <div className="pt-4">145 |                 <Button146 |                   className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90"147 |                   onClick={() => setShowPurchaseFlow(true)}148 |                 >149 |                   <ShoppingCart className="w-4 h-4 mr-2" />150 |                   Purchase Package151 |                 </Button>152 |               </div>153 |             </CardContent>154 |           </Card>155 |         ))}156 |       </div>157 | 158 |       {}159 |       <div className="mt-12">160 |         <Card className="bg-[#1a1a2e] border-[#16213e]">161 |           <CardHeader>162 |             <CardTitle className="text-white">About Our Packages</CardTitle>163 |           </CardHeader>164 |           <CardContent className="space-y-4">165 |             <div className="grid grid-cols-1 md:grid-cols-3 gap-6">166 |               <div className="text-center">167 |                 <div className="w-12 h-12 bg-[#ffd700]/20 rounded-full flex items-center justify-center mx-auto mb-3">168 |                   <PackageIcon className="w-6 h-6 text-[#ffd700]" />169 |                 </div>170 |                 <h3 className="text-white font-semibold mb-2">Flexible Sessions</h3>171 |                 <p className="text-gray-400 text-sm">172 |                   Choose from various session lengths and types to suit your needs173 |                 </p>174 |               </div>175 | 176 |               <div className="text-center">177 |                 <div className="w-12 h-12 bg-[#ffd700]/20 rounded-full flex items-center justify-center mx-auto mb-3">178 |                   <CalendarIcon className="w-6 h-6 text-[#ffd700]" />179 |                 </div>180 |                 <h3 className="text-white font-semibold mb-2">Easy Booking</h3>181 |                 <p className="text-gray-400 text-sm">182 |                   Book sessions at your convenience with our flexible scheduling system183 |                 </p>184 |               </div>185 | 186 |               <div className="text-center">187 |                 <div className="w-12 h-12 bg-[#ffd700]/20 rounded-full flex items-center justify-center mx-auto mb-3">188 |                   <ShoppingCart className="w-6 h-6 text-[#ffd700]" />189 |                 </div>190 |                 <h3 className="text-white font-semibold mb-2">Secure Payment</h3>191 |                 <p className="text-gray-400 text-sm">192 |                   Safe and secure payment processing with multiple payment options193 |                 </p>194 |               </div>195 |             </div>196 |           </CardContent>197 |         </Card>198 |       </div>199 |     </div>200 |   );201 | }
============================================================END: frontend/app/(client)/account/packages/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/page.tsxSIZE: 5.18 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { CalendarIcon, PackageIcon, ShoppingCart, Settings } from 'lucide-react';  7 |   8 | import Link from 'next/link';  9 | import { useAuth } from '@/hooks/useAuth'; 10 | import { BugReportButton } from '@/components/BugReportButton'; 11 | import { CustomerDashboard } from '@/components/CustomerDashboard'; 12 |  13 | export default function AccountPage() { 14 |   const { user, isAdmin, isLoading: authLoading } = useAuth(); 15 |   const [loading, setLoading] = useState(true); 16 |  17 |   useEffect(() => { 18 |     if (!authLoading) { 19 |       if (user?.access_token) { 20 |         setLoading(false); 21 |       } else { 22 |         setLoading(false); 23 |       } 24 |     } 25 |   }, [user, authLoading]); 26 |  27 |   if (authLoading || loading) { 28 |     return ( 29 |       <div className="flex items-center justify-center min-h-[400px]"> 30 |         <div className="text-center"> 31 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 32 |           <p className="text-[#FFD700] text-lg font-semibold">Loading your account...</p> 33 |         </div> 34 |       </div> 35 |     ); 36 |   } 37 |  38 |   if (!user) { 39 |     return ( 40 |       <div className="flex items-center justify-center min-h-[400px]"> 41 |         <div className="text-center"> 42 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 43 |           <p className="text-[#FFD700] text-lg font-semibold">Loading user data...</p> 44 |         </div> 45 |       </div> 46 |     ); 47 |   } 48 |  49 |   return ( 50 |     <div className="container mx-auto p-6 space-y-6"> 51 |       {} 52 |       <div className="flex items-center justify-between"> 53 |         <div className="text-center flex-1"> 54 |           <h1 className="text-3xl font-bold text-white">Welcome to Your Account</h1> 55 |           <p className="text-gray-400 mt-2">Manage your spiritual journey and sessions</p> 56 |         </div> 57 |  58 |         {} 59 |         {isAdmin && ( 60 |           <Link href="/admin"> 61 |             <Button className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90"> 62 |               <Settings className="w-4 h-4 mr-2" /> 63 |               Admin Dashboard 64 |             </Button> 65 |           </Link> 66 |         )} 67 |       </div> 68 |  69 |       {} 70 |       <CustomerDashboard /> 71 |  72 |       {} 73 |       <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> 74 |         <Card className="bg-[#1a1a2e] border-[#16213e] hover:border-[#ffd700]/50 transition-colors"> 75 |           <CardHeader> 76 |             <CardTitle className="text-white flex items-center"> 77 |               <PackageIcon className="w-5 h-5 text-[#ffd700] mr-2" /> 78 |               Buy Packages 79 |             </CardTitle> 80 |           </CardHeader> 81 |           <CardContent> 82 |             <p className="text-gray-400 mb-4"> 83 |               Explore our spiritual consultation packages and find the perfect one for your journey. 84 |             </p> 85 |             <Link href="/account/packages"> 86 |               <Button className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90"> 87 |                 <ShoppingCart className="w-4 h-4 mr-2" /> 88 |                 Browse Packages 89 |               </Button> 90 |             </Link> 91 |           </CardContent> 92 |         </Card> 93 |  94 |         <Card className="bg-[#1a1a2e] border-[#16213e] hover:border-[#ffd700]/50 transition-colors"> 95 |           <CardHeader> 96 |             <CardTitle className="text-white flex items-center"> 97 |               <CalendarIcon className="w-5 h-5 text-[#ffd700] mr-2" /> 98 |               Book Session 99 |             </CardTitle>100 |           </CardHeader>101 |           <CardContent>102 |             <p className="text-gray-400 mb-4">103 |               Schedule your next spiritual consultation using your purchased packages.104 |             </p>105 |             <Link href="/account/book">106 |               <Button className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90">107 |                 <CalendarIcon className="w-4 h-4 mr-2" />108 |                 Book Now109 |               </Button>110 |             </Link>111 |           </CardContent>112 |         </Card>113 | 114 |         <Card className="bg-[#1a1a2e] border-[#16213e] hover:border-[#ffd700]/50 transition-colors">115 |           <CardHeader>116 |             <CardTitle className="text-white flex items-center">117 |               <Settings className="w-5 h-5 text-[#ffd700] mr-2" />118 |               Account Settings119 |             </CardTitle>120 |           </CardHeader>121 |           <CardContent>122 |             <p className="text-gray-400 mb-4">123 |               Update your profile information and manage your account preferences.124 |             </p>125 |             <Link href="/account/profile">126 |               <Button className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90">127 |                 <Settings className="w-4 h-4 mr-2" />128 |                 Manage Profile129 |               </Button>130 |             </Link>131 |           </CardContent>132 |         </Card>133 |       </div>134 | 135 |       {}136 |       <div className="flex justify-center">137 |         <BugReportButton />138 |       </div>139 |     </div>140 |   );141 | }
============================================================END: frontend/app/(client)/account/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/profile/page.tsxSIZE: 10.89 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Input } from '@/components/ui/input';  7 | import { Label } from '@/components/ui/label';  8 | import { Textarea } from '@/components/ui/textarea';  9 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 10 | import { toast } from 'sonner'; 11 | import { useAuth } from '@/hooks/useAuth'; 12 |  13 | interface ClientProfile { 14 |   id: string; 15 |   email: string; 16 |   fullName: string | null; 17 |   phone: string | null; 18 |   birthDate: string | null; 19 |   birthTime: string | null; 20 |   birthPlace: string | null; 21 |   question: string | null; 22 |   language: string; 23 |   role: string; 24 |   status: string; 25 |   adminNotes: string | null; 26 |   scheduledDate: string | null; 27 |   scheduledTime: string | null; 28 |   sessionType: string | null; 29 |   notes: string | null; 30 |   createdAt: string; 31 |   updatedAt: string; 32 | } 33 |  34 | export default function ProfilePage() { 35 |   const { user } = useAuth(); 36 |   const [profile, setProfile] = useState<ClientProfile | null>(null); 37 |   const [isEditing, setIsEditing] = useState(false); 38 |   const [loading, setLoading] = useState(true); 39 |   const [saving, setSaving] = useState(false); 40 |   const [formData, setFormData] = useState({ 41 |     fullName: '', 42 |     phone: '', 43 |     birthDate: '', 44 |     birthTime: '', 45 |     birthPlace: '', 46 |     question: '', 47 |     language: 'en', 48 |     notes: '' 49 |   }); 50 |  51 |   const fetchProfile = useCallback(async () => { 52 |     if (!user?.access_token) return; 53 |  54 |     try { 55 |       setLoading(true); 56 |       const response = await fetch('/api/client/me', { 57 |         headers: { 58 |           'Authorization': `Bearer ${user.access_token}`, 59 |           'Content-Type': 'application/json' 60 |         } 61 |       }); 62 |  63 |       if (response.ok) { 64 |         const data = await response.json(); 65 |         if (data.success) { 66 |           setProfile(data.data); 67 |           setFormData({ 68 |             fullName: data.data.fullName || '', 69 |             phone: data.data.phone || '', 70 |             birthDate: data.data.birthDate || '', 71 |             birthTime: data.data.birthTime || '', 72 |             birthPlace: data.data.birthPlace || '', 73 |             question: data.data.question || '', 74 |             language: data.data.language || 'en', 75 |             notes: data.data.notes || '' 76 |           }); 77 |         } 78 |       } 79 |     } catch (error) { 80 |       toast.error('Failed to fetch profile'); 81 |     } finally { 82 |       setLoading(false); 83 |     } 84 |   }, [user?.access_token]); 85 |  86 |   useEffect(() => { 87 |     fetchProfile(); 88 |   }, [fetchProfile]); 89 |  90 |   const handleSave = async () => { 91 |     if (!profile || !user?.access_token) return; 92 |  93 |     setSaving(true); 94 |  95 |     try { 96 |       const response = await fetch('/api/client/me', { 97 |         method: 'PUT', 98 |         headers: { 99 |           'Authorization': `Bearer ${user.access_token}`,100 |           'Content-Type': 'application/json'101 |         },102 |         body: JSON.stringify({103 |           fullName: formData.fullName,104 |           phone: formData.phone,105 |           birthDate: formData.birthDate,106 |           birthTime: formData.birthTime,107 |           birthPlace: formData.birthPlace,108 |           question: formData.question,109 |           language: formData.language,110 |           notes: formData.notes111 |         })112 |       });113 | 114 |       if (response.ok) {115 |         const data = await response.json();116 |         if (data.success) {117 |           toast.success('Profile updated successfully');118 |           setIsEditing(false);119 |           fetchProfile();120 |         } else {121 |           throw new Error(data.error || 'Failed to update profile');122 |         }123 |       } else {124 |         throw new Error('Failed to update profile');125 |       }126 |     } catch (error) {127 |       toast.error('Failed to update profile');128 |     } finally {129 |       setSaving(false);130 |     }131 |   };132 | 133 |   const handleCancel = () => {134 |     if (profile) {135 |       setFormData({136 |         fullName: profile.fullName || '',137 |         phone: profile.phone || '',138 |         birthDate: profile.birthDate || '',139 |         birthTime: profile.birthTime || '',140 |         birthPlace: profile.birthPlace || '',141 |         question: profile.question || '',142 |         language: profile.language || 'en',143 |         notes: profile.notes || ''144 |       });145 |     }146 |     setIsEditing(false);147 |   };148 | 149 |   if (loading) {150 |     return (151 |       <div className="flex items-center justify-center min-h-[400px]">152 |         <div className="text-center">153 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>154 |           <p className="text-[#FFD700] text-lg font-semibold">Loading your profile...</p>155 |         </div>156 |       </div>157 |     );158 |   }159 | 160 |   if (!profile) {161 |     return (162 |       <div className="container mx-auto p-6">163 |         <div className="text-center">164 |           <p className="text-gray-400">Profile not found</p>165 |         </div>166 |       </div>167 |     );168 |   }169 | 170 |   return (171 |     <div className="container mx-auto p-6 space-y-6">172 |       <div className="flex justify-between items-center">173 |         <div>174 |           <h1 className="text-3xl font-bold text-white">Profile</h1>175 |           <p className="text-gray-400 mt-2">Manage your personal information</p>176 |         </div>177 |         {!isEditing ? (178 |           <Button onClick={() => setIsEditing(true)} className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90">179 |             Edit Profile180 |           </Button>181 |         ) : (182 |           <div className="flex space-x-2">183 |             <Button onClick={handleCancel} variant="outline" className="border-[#0a0a23] text-white hover:bg-[#0a0a23]">184 |               Cancel185 |             </Button>186 |             <Button onClick={handleSave} disabled={saving} className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90">187 |               {saving ? 'Saving...' : 'Save Changes'}188 |             </Button>189 |           </div>190 |         )}191 |       </div>192 | 193 |       <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">194 |         {}195 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">196 |           <CardHeader>197 |             <CardTitle>Basic Information</CardTitle>198 |             <CardDescription>Your personal details</CardDescription>199 |           </CardHeader>200 |           <CardContent className="space-y-4">201 |             <div>202 |               <Label htmlFor="email" className="text-gray-300">Email</Label>203 |               <Input204 |                 id="email"205 |                 value={profile.email}206 |                 disabled207 |                 className="bg-[#16213e] border-[#0a0a23] text-gray-400"208 |               />209 |             </div>210 | 211 |             <div>212 |               <Label htmlFor="fullName" className="text-gray-300">Full Name</Label>213 |               <Input214 |                 id="fullName"215 |                 value={formData.fullName}216 |                 onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}217 |                 disabled={!isEditing}218 |                 className="bg-[#16213e] border-[#0a0a23] text-white"219 |               />220 |             </div>221 | 222 |             <div>223 |               <Label htmlFor="phone" className="text-gray-300">Phone</Label>224 |               <Input225 |                 id="phone"226 |                 value={formData.phone}227 |                 onChange={(e) => setFormData({ ...formData, phone: e.target.value })}228 |                 disabled={!isEditing}229 |                 className="bg-[#16213e] border-[#0a0a23] text-white"230 |               />231 |             </div>232 | 233 |             <div>234 |               <Label htmlFor="birthDate" className="text-gray-300">Date of Birth</Label>235 |               <Input236 |                 id="birthDate"237 |                 type="date"238 |                 value={formData.birthDate}239 |                 onChange={(e) => setFormData({ ...formData, birthDate: e.target.value })}240 |                 disabled={!isEditing}241 |                 className="bg-[#16213e] border-[#0a0a23] text-white"242 |               />243 |             </div>244 | 245 |             <div>246 |               <Label htmlFor="birthTime" className="text-gray-300">Time of Birth</Label>247 |               <Input248 |                 id="birthTime"249 |                 type="time"250 |                 value={formData.birthTime}251 |                 onChange={(e) => setFormData({ ...formData, birthTime: e.target.value })}252 |                 disabled={!isEditing}253 |                 className="bg-[#16213e] border-[#0a0a23] text-white"254 |               />255 |             </div>256 |           </CardContent>257 |         </Card>258 | 259 |         {}260 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">261 |           <CardHeader>262 |             <CardTitle>Additional Information</CardTitle>263 |             <CardDescription>Help us provide better service</CardDescription>264 |           </CardHeader>265 |           <CardContent className="space-y-4">266 |             <div>267 |               <Label htmlFor="birthPlace" className="text-gray-300">Place of Birth</Label>268 |               <Input269 |                 id="birthPlace"270 |                 value={formData.birthPlace}271 |                 onChange={(e) => setFormData({ ...formData, birthPlace: e.target.value })}272 |                 disabled={!isEditing}273 |                 className="bg-[#16213e] border-[#0a0a23] text-white"274 |                 placeholder="City, Country"275 |               />276 |             </div>277 | 278 |             <div>279 |               <Label htmlFor="language" className="text-gray-300">Preferred Language</Label>280 |               <Select281 |                 value={formData.language}282 |                 onValueChange={(value) => setFormData({ ...formData, language: value })}283 |                 disabled={!isEditing}284 |               >285 |                 <SelectTrigger className="bg-[#16213e] border-[#0a0a23] text-white">286 |                   <SelectValue />287 |                 </SelectTrigger>288 |                 <SelectContent className="bg-[#16213e] border-[#0a0a23] text-white">289 |                   <SelectItem value="en">English</SelectItem>290 |                   <SelectItem value="es">Español</SelectItem>291 |                 </SelectContent>292 |               </Select>293 |             </div>294 | 295 |             <div>296 |               <Label htmlFor="question" className="text-gray-300">Spiritual Question/Preferences</Label>297 |               <Textarea298 |                 id="question"299 |                 value={formData.question}300 |                 onChange={(e) => setFormData({ ...formData, question: e.target.value })}301 |                 disabled={!isEditing}302 |                 className="bg-[#16213e] border-[#0a0a23] text-white"303 |                 rows={3}304 |                 placeholder="Your spiritual questions or preferences..."305 |               />306 |             </div>307 | 308 |             <div>309 |               <Label htmlFor="notes" className="text-gray-300">Additional Notes</Label>310 |               <Textarea311 |                 id="notes"312 |                 value={formData.notes}313 |                 onChange={(e) => setFormData({ ...formData, notes: e.target.value })}314 |                 disabled={!isEditing}315 |                 className="bg-[#16213e] border-[#0a0a23] text-white"316 |                 rows={2}317 |                 placeholder="Any additional information you'd like to share..."318 |               />319 |             </div>320 |           </CardContent>321 |         </Card>322 |       </div>323 |     </div>324 |   );325 | }
============================================================END: frontend/app/(client)/account/profile/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/purchase/page.tsxSIZE: 32.98 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import Image from 'next/image';  5 | import { motion, AnimatePresence } from 'framer-motion';  6 | import {  7 |   Package,  8 |   User,  9 |   CheckCircle, 10 |   CreditCard, 11 |   ShoppingCart, 12 |   ArrowRight, 13 |   ArrowLeft 14 | } from 'lucide-react'; 15 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; 16 | import { BaseButton } from '@/components/ui/BaseButton'; 17 | import { Badge } from '@/components/ui/badge'; 18 | import { Input } from '@/components/ui/input'; 19 | import { Label } from '@/components/ui/label'; 20 | import { Textarea } from '@/components/ui/textarea'; 21 | import { toast } from 'sonner'; 22 | import { useAuth } from '@/hooks/useAuth'; 23 | import { StripeInlineForm } from '@/components/stripe/StripeInlineForm'; 24 | import { ChevronDown, Check } from 'lucide-react'; 25 |  26 | interface PackagePrice { 27 |   id: number; 28 |   price: number; 29 |   packageDefinition: { 30 |     id: number; 31 |     name: string; 32 |     description: string; 33 |     sessionsCount: number; 34 |     isActive: boolean; 35 |   }; 36 |   currency: { 37 |     id: number; 38 |     code: string; 39 |     symbol: string; 40 |     name: string; 41 |   }; 42 | } 43 |  44 | interface PaymentMethod { 45 |   id: number; 46 |   name: string; 47 |   type: string; 48 |   description: string; 49 |   icon: string; 50 |   requiresConfirmation: boolean; 51 |   autoAssignPackage: boolean; 52 |   isActive: boolean; 53 | } 54 |  55 | interface PurchaseStep { 56 |   id: string; 57 |   title: string; 58 |   description: string; 59 |   completed: boolean; 60 | } 61 |  62 | interface PurchaseFormData { 63 |   selectedPackage: PackagePrice | null; 64 |   selectedPaymentMethod: PaymentMethod | null; 65 |   quantity: number; 66 |   notes: string; 67 |  68 |   clientName: string; 69 |   clientEmail: string; 70 |   clientPhone: string; 71 |   birthDate: string; 72 |   birthTime: string; 73 |   birthPlace: string; 74 |   question: string; 75 |   language: string; 76 | } 77 |  78 | export default function PurchasePage() { 79 |   const { user } = useAuth(); 80 |   const [packages, setPackages] = useState<PackagePrice[]>([]); 81 |   const [paymentMethods, setPaymentMethods] = useState<PaymentMethod[]>([]); 82 |   const [loading, setLoading] = useState(true); 83 |   const [processing, setProcessing] = useState(false); 84 |   const [currentStep, setCurrentStep] = useState(0); 85 |   const [showPaymentMethodDropdown, setShowPaymentMethodDropdown] = useState(false); 86 |  87 |   const [formData, setFormData] = useState<PurchaseFormData>({ 88 |     selectedPackage: null, 89 |     selectedPaymentMethod: null, 90 |     quantity: 1, 91 |     notes: '', 92 |     clientName: '', 93 |     clientEmail: '', 94 |     clientPhone: '', 95 |     birthDate: '', 96 |     birthTime: '', 97 |     birthPlace: '', 98 |     question: '', 99 |     language: 'en'100 |   });101 | 102 |   const getSteps = (): PurchaseStep[] => [103 |     { id: 'package', title: 'Select Package', description: 'Choose your spiritual journey package', completed: !!formData.selectedPackage },104 |     { id: 'details', title: 'Review Details', description: 'Confirm your information and preferences', completed: !!formData.selectedPackage && !!formData.clientName && !!formData.clientEmail },105 |     { id: 'payment', title: 'Payment', description: 'Complete your purchase securely', completed: !!formData.selectedPackage && !!formData.selectedPaymentMethod }106 |   ];107 | 108 |   const loadUserProfile = useCallback(async () => {109 |     if (!user?.access_token) return;110 | 111 |     try {112 |       const response = await fetch('/api/client/me', {113 |         headers: {114 |           'Authorization': `Bearer ${user.access_token}`,115 |           'Content-Type': 'application/json'116 |         }117 |       });118 | 119 |       if (response.ok) {120 |         const data = await response.json();121 |         if (data.success) {122 |           const profile = data.data;123 | 124 |           setFormData(prev => ({125 |             ...prev,126 |             clientName: profile.fullName || '',127 |             clientEmail: profile.email || '',128 |             clientPhone: profile.phone || '',129 |             birthDate: profile.birthDate || '',130 |             birthTime: profile.birthTime || '',131 |             birthPlace: profile.birthPlace || '',132 |             question: profile.question || '',133 |             language: profile.language || 'en'134 |           }));135 |         }136 |       } else {137 |         }138 |     } catch (error) {139 |       }140 |   }, [user?.access_token]);141 | 142 |   const loadPackages = useCallback(async () => {143 |     if (!user?.access_token) return;144 | 145 |     try {146 |       const response = await fetch('/api/client/packages', {147 |         headers: {148 |           'Authorization': `Bearer ${user.access_token}`,149 |           'Content-Type': 'application/json'150 |         }151 |       });152 | 153 |       if (response.ok) {154 |         const data = await response.json();155 |         if (data.success) {156 |           setPackages(data.data || []);157 |         } else {158 |           }159 |       } else {160 |         }161 |     } catch (error) {162 |       }163 |   }, [user?.access_token]);164 | 165 |   const loadPaymentMethods = useCallback(async () => {166 |     if (!user?.access_token) return;167 | 168 |     try {169 |       const response = await fetch('/api/client/payment-methods', {170 |         headers: {171 |           'Authorization': `Bearer ${user.access_token}`,172 |           'Content-Type': 'application/json'173 |         }174 |       });175 | 176 |       if (response.ok) {177 |         const data = await response.json();178 |         if (data.success) {179 |           setPaymentMethods(data.data || []);180 | 181 |           const stripeMethod = data.data?.find((method: PaymentMethod) => method.type === 'stripe');182 |           if (stripeMethod) {183 |             setFormData(prev => ({ ...prev, selectedPaymentMethod: stripeMethod }));184 |           }185 |         } else {186 |           }187 |       } else {188 |         }189 |     } catch (error) {190 |       }191 |   }, [user?.access_token]);192 | 193 |   const loadData = useCallback(async () => {194 |     setLoading(true);195 |     try {196 |       await Promise.all([197 |         loadUserProfile(),198 |         loadPackages(),199 |         loadPaymentMethods()200 |       ]);201 |       } catch (error) {202 |       toast.error('Failed to load data. Please try again.');203 |     } finally {204 |       setLoading(false);205 |     }206 |   }, [loadUserProfile, loadPackages, loadPaymentMethods]);207 | 208 |   useEffect(() => {209 |     if (user?.access_token) {210 |       loadData();211 |     }212 |   }, [user?.access_token, loadData]);213 | 214 |   const handleInputChange = (field: keyof PurchaseFormData, value: string | number) => {215 |     setFormData(prev => ({ ...prev, [field]: value }));216 |   };217 | 218 |   const handlePackageSelect = (pkg: PackagePrice) => {219 |     setFormData(prev => ({ ...prev, selectedPackage: pkg }));220 |     setCurrentStep(1);221 |   };222 | 223 |   const handlePaymentMethodSelect = (method: PaymentMethod) => {224 |     setFormData(prev => ({ ...prev, selectedPaymentMethod: method }));225 |     setShowPaymentMethodDropdown(false);226 |   };227 | 228 |   const handleQuantityChange = (quantity: number) => {229 |     if (quantity >= 1 && quantity <= 10) {230 |       setFormData(prev => ({ ...prev, quantity }));231 |     }232 |   };233 | 234 |   const handleNext = () => {235 |     const steps = getSteps();236 |     if (currentStep < steps.length - 1) {237 |       setCurrentStep(prev => prev + 1);238 |     }239 |   };240 | 241 |   const handlePrevious = () => {242 |     if (currentStep > 0) {243 |       setCurrentStep(prev => prev - 1);244 |     }245 |   };246 | 247 |   const handlePurchase = async () => {248 |     if (!formData.selectedPackage || !formData.selectedPaymentMethod) {249 |       toast.error('Please select a package and payment method');250 |       return;251 |     }252 | 253 |     setProcessing(true);254 |     try {255 |       const response = await fetch('/api/client/purchase', {256 |         method: 'POST',257 |         headers: {258 |           'Authorization': `Bearer ${user?.access_token}`,259 |           'Content-Type': 'application/json'260 |         },261 |         body: JSON.stringify({262 |           packagePriceId: formData.selectedPackage.id,263 |           paymentMethodId: formData.selectedPaymentMethod.id,264 |           quantity: formData.quantity,265 |           notes: formData.notes266 |         })267 |       });268 | 269 |       const result = await response.json();270 | 271 |       if (result.success) {272 |         toast.success('Purchase completed successfully!');273 | 274 |         setTimeout(() => {275 |           window.location.href = '/account/my-packages';276 |         }, 2000);277 |       } else {278 |         toast.error(result.message || 'Purchase failed');279 |       }280 |     } catch (error) {281 |       toast.error('Purchase failed. Please try again.');282 |     } finally {283 |       setProcessing(false);284 |     }285 |   };286 | 287 |   const handleStripeSuccess = () => {288 |     toast.success('Payment successful!');289 |     handlePurchase();290 |   };291 | 292 |   const handleStripeError = (error: string) => {293 |     toast.error(`Payment failed: ${error}`);294 |   };295 | 296 |   if (loading) {297 |     return (298 |       <div className="min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e] flex items-center justify-center">299 |         <div className="text-center">300 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>301 |           <p className="text-[#FFD700] text-lg font-semibold">Loading packages...</p>302 |         </div>303 |       </div>304 |     );305 |   }306 | 307 |   return (308 |     <div className="min-h-screen bg-gradient-to-br from-[#0a0a23] via-[#1a1a2e] to-[#16213e]">309 |       <div className="container mx-auto py-8">310 |         <div className="text-center mb-8">311 |           <h1 className="text-4xl font-bold text-white mb-4">Purchase Packages</h1>312 |           <p className="text-gray-400 text-lg">Choose your spiritual journey package and complete your purchase</p>313 |         </div>314 | 315 |         {}316 |         <div className="mb-8">317 |           <div className="flex items-center justify-center space-x-4">318 |             {getSteps().map((step, index) => (319 |               <div key={step.id} className="flex items-center">320 |                 <div className={`flex items-center justify-center w-10 h-10 rounded-full border-2 ${321 |                   index <= currentStep322 |                     ? 'border-[#FFD700] bg-[#FFD700] text-black'323 |                     : 'border-gray-600 text-gray-400'324 |                 }`}>325 |                   {step.completed ? (326 |                     <CheckCircle className="w-5 h-5" />327 |                   ) : (328 |                     <span className="text-sm font-semibold">{index + 1}</span>329 |                   )}330 |                 </div>331 |                 <div className="ml-3 text-left">332 |                   <p className={`text-sm font-medium ${333 |                     index <= currentStep ? 'text-white' : 'text-gray-400'334 |                   }`}>335 |                     {step.title}336 |                   </p>337 |                   <p className="text-xs text-gray-500">{step.description}</p>338 |                 </div>339 |                 {index < getSteps().length - 1 && (340 |                   <ArrowRight className="w-4 h-4 text-gray-600 mx-4" />341 |                 )}342 |               </div>343 |             ))}344 |           </div>345 |         </div>346 | 347 |         <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">348 |           {}349 |           <div className="lg:col-span-2">350 |             <AnimatePresence mode="wait">351 |               <motion.div352 |                 key={currentStep}353 |                 initial={{ opacity: 0, x: 20 }}354 |                 animate={{ opacity: 1, x: 0 }}355 |                 exit={{ opacity: 0, x: -20 }}356 |                 transition={{ duration: 0.3 }}357 |               >358 |                 {}359 |                 {currentStep === 0 && (360 |                   <Card className="bg-[#1a1a2e] border-[#16213e]">361 |                     <CardHeader>362 |                       <CardTitle className="text-white flex items-center space-x-2">363 |                         <Package className="w-5 h-5 text-[#ffd700]" />364 |                         <span>Select Your Package</span>365 |                       </CardTitle>366 |                     </CardHeader>367 |                     <CardContent className="space-y-4">368 |                       {packages.length === 0 ? (369 |                         <div className="text-center py-8">370 |                           <Package className="w-16 h-16 text-gray-500 mx-auto mb-4" />371 |                           <p className="text-gray-400">No packages available at the moment</p>372 |                         </div>373 |                       ) : (374 |                         <div className="grid grid-cols-1 md:grid-cols-2 gap-4">375 |                           {packages.map((pkg) => (376 |                             <Card377 |                               key={pkg.id}378 |                               className={`cursor-pointer transition-all duration-200 ${379 |                                 formData.selectedPackage?.id === pkg.id380 |                                   ? 'border-[#ffd700] bg-[#ffd700]/10'381 |                                   : 'border-[#16213e] hover:border-[#ffd700]/50'382 |                               }`}383 |                               onClick={() => handlePackageSelect(pkg)}384 |                             >385 |                               <CardContent className="p-4">386 |                                 <div className="flex items-center justify-between mb-2">387 |                                   <h3 className="text-white font-semibold">{pkg.packageDefinition.name}</h3>388 |                                   <Badge className="bg-[#ffd700] text-black">389 |                                     {pkg.currency.symbol}{pkg.price}390 |                                   </Badge>391 |                                 </div>392 |                                 <p className="text-gray-400 text-sm mb-3">{pkg.packageDefinition.description}</p>393 |                                 <div className="flex items-center justify-between text-sm text-gray-300">394 |                                   <span>{pkg.packageDefinition.sessionsCount} sessions</span>395 |                                   <span>{pkg.currency.code.toUpperCase()}</span>396 |                                 </div>397 |                               </CardContent>398 |                             </Card>399 |                           ))}400 |                         </div>401 |                       )}402 |                     </CardContent>403 |                   </Card>404 |                 )}405 | 406 |                 {}407 |                 {currentStep === 1 && (408 |                   <Card className="bg-[#1a1a2e] border-[#16213e]">409 |                     <CardHeader>410 |                       <CardTitle className="text-white flex items-center space-x-2">411 |                         <User className="w-5 h-5 text-[#ffd700]" />412 |                         <span>Review Your Details</span>413 |                       </CardTitle>414 |                     </CardHeader>415 |                     <CardContent className="space-y-6">416 |                       {}417 |                       {formData.selectedPackage && (418 |                         <div className="bg-[#16213e] p-4 rounded-lg">419 |                           <h3 className="text-white font-semibold mb-2">Selected Package</h3>420 |                           <div className="flex items-center justify-between">421 |                             <div>422 |                               <p className="text-white">{formData.selectedPackage.packageDefinition.name}</p>423 |                               <p className="text-gray-400 text-sm">{formData.selectedPackage.packageDefinition.description}</p>424 |                             </div>425 |                             <div className="text-right">426 |                               <p className="text-[#ffd700] font-semibold">427 |                                 {formData.selectedPackage.currency.symbol}{formData.selectedPackage.price}428 |                               </p>429 |                               <p className="text-gray-400 text-sm">per package</p>430 |                             </div>431 |                           </div>432 |                         </div>433 |                       )}434 | 435 |                       {}436 |                       <div>437 |                         <Label className="text-gray-300">Quantity</Label>438 |                         <div className="flex items-center space-x-2 mt-1">439 |                           <BaseButton440 |                             onClick={() => handleQuantityChange(formData.quantity - 1)}441 |                             disabled={formData.quantity <= 1}442 |                             className="px-3 py-1"443 |                           >444 |                             -445 |                           </BaseButton>446 |                           <span className="text-white px-4">{formData.quantity}</span>447 |                           <BaseButton448 |                             onClick={() => handleQuantityChange(formData.quantity + 1)}449 |                             disabled={formData.quantity >= 10}450 |                             className="px-3 py-1"451 |                           >452 |                             +453 |                           </BaseButton>454 |                         </div>455 |                       </div>456 | 457 |                       {}458 |                       <div className="grid grid-cols-1 md:grid-cols-2 gap-4">459 |                         <div>460 |                           <Label htmlFor="clientName" className="text-gray-300">Full Name</Label>461 |                           <Input462 |                             id="clientName"463 |                             value={formData.clientName}464 |                             onChange={(e) => handleInputChange('clientName', e.target.value)}465 |                             className="bg-[#16213e] border-[#0a0a23] text-white"466 |                             placeholder="Enter your full name"467 |                           />468 |                         </div>469 |                         <div>470 |                           <Label htmlFor="clientEmail" className="text-gray-300">Email</Label>471 |                           <Input472 |                             id="clientEmail"473 |                             type="email"474 |                             value={formData.clientEmail}475 |                             onChange={(e) => handleInputChange('clientEmail', e.target.value)}476 |                             className="bg-[#16213e] border-[#0a0a23] text-white"477 |                             placeholder="Enter your email"478 |                           />479 |                         </div>480 |                       </div>481 | 482 |                       <div className="grid grid-cols-1 md:grid-cols-2 gap-4">483 |                         <div>484 |                           <Label htmlFor="clientPhone" className="text-gray-300">Phone</Label>485 |                           <Input486 |                             id="clientPhone"487 |                             value={formData.clientPhone}488 |                             onChange={(e) => handleInputChange('clientPhone', e.target.value)}489 |                             className="bg-[#16213e] border-[#0a0a23] text-white"490 |                             placeholder="Enter your phone number"491 |                           />492 |                         </div>493 |                         <div>494 |                           <Label htmlFor="birthDate" className="text-gray-300">Birth Date</Label>495 |                           <Input496 |                             id="birthDate"497 |                             type="date"498 |                             value={formData.birthDate}499 |                             onChange={(e) => handleInputChange('birthDate', e.target.value)}500 |                             className="bg-[#16213e] border-[#0a0a23] text-white"501 |                           />502 |                         </div>503 |                       </div>504 | 505 |                       <div className="grid grid-cols-1 md:grid-cols-2 gap-4">506 |                         <div>507 |                           <Label htmlFor="birthTime" className="text-gray-300">Birth Time</Label>508 |                           <Input509 |                             id="birthTime"510 |                             type="time"511 |                             value={formData.birthTime}512 |                             onChange={(e) => handleInputChange('birthTime', e.target.value)}513 |                             className="bg-[#16213e] border-[#0a0a23] text-white"514 |                           />515 |                         </div>516 |                         <div>517 |                           <Label htmlFor="birthPlace" className="text-gray-300">Birth Place</Label>518 |                           <Input519 |                             id="birthPlace"520 |                             value={formData.birthPlace}521 |                             onChange={(e) => handleInputChange('birthPlace', e.target.value)}522 |                             className="bg-[#16213e] border-[#0a0a23] text-white"523 |                             placeholder="Enter your birth place"524 |                           />525 |                         </div>526 |                       </div>527 | 528 |                       <div>529 |                         <Label htmlFor="question" className="text-gray-300">Spiritual Question</Label>530 |                         <Textarea531 |                           id="question"532 |                           value={formData.question}533 |                           onChange={(e) => handleInputChange('question', e.target.value)}534 |                           className="bg-[#16213e] border-[#0a0a23] text-white"535 |                           placeholder="What would you like to explore in your spiritual journey?"536 |                           rows={3}537 |                         />538 |                       </div>539 | 540 |                       <div>541 |                         <Label htmlFor="notes" className="text-gray-300">Additional Notes</Label>542 |                         <Textarea543 |                           id="notes"544 |                           value={formData.notes}545 |                           onChange={(e) => handleInputChange('notes', e.target.value)}546 |                           className="bg-[#16213e] border-[#0a0a23] text-white"547 |                           placeholder="Any special requests or additional information..."548 |                           rows={2}549 |                         />550 |                       </div>551 |                     </CardContent>552 |                   </Card>553 |                 )}554 | 555 |                 {}556 |                 {currentStep === 2 && (557 |                   <Card className="bg-[#1a1a2e] border-[#16213e]">558 |                     <CardHeader>559 |                       <CardTitle className="text-white flex items-center space-x-2">560 |                         <CreditCard className="w-5 h-5 text-[#ffd700]" />561 |                         <span>Complete Payment</span>562 |                       </CardTitle>563 |                     </CardHeader>564 |                     <CardContent className="space-y-6">565 |                       {}566 |                       <div>567 |                         <Label className="text-gray-300">Payment Method</Label>568 |                         <div className="relative mt-1">569 |                           <BaseButton570 |                             onClick={() => setShowPaymentMethodDropdown(!showPaymentMethodDropdown)}571 |                             className="w-full justify-between bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"572 |                           >573 |                             <div className="flex items-center space-x-2">574 |                               {formData.selectedPaymentMethod?.icon && (575 |                                 <Image576 |                                   src={formData.selectedPaymentMethod.icon}577 |                                   alt={formData.selectedPaymentMethod.name}578 |                                   width={20}579 |                                   height={20}580 |                                   className="w-5 h-5"581 |                                 />582 |                               )}583 |                               <span>{formData.selectedPaymentMethod?.name || 'Select payment method'}</span>584 |                             </div>585 |                             <ChevronDown className="w-4 h-4" />586 |                           </BaseButton>587 | 588 |                           {showPaymentMethodDropdown && (589 |                             <div className="absolute top-full left-0 right-0 mt-1 bg-[#16213e] border border-[#0a0a23] rounded-lg shadow-lg z-10">590 |                               {paymentMethods.map((method) => (591 |                                 <button592 |                                   key={method.id}593 |                                   onClick={() => handlePaymentMethodSelect(method)}594 |                                   className="w-full flex items-center space-x-2 px-4 py-2 text-left hover:bg-[#0a0a23] text-white"595 |                                 >596 |                                   {method.icon && (597 |                                     <Image src={method.icon} alt={method.name} width={20} height={20} className="w-5 h-5" />598 |                                   )}599 |                                   <div>600 |                                     <p className="font-medium">{method.name}</p>601 |                                     <p className="text-sm text-gray-400">{method.description}</p>602 |                                   </div>603 |                                   {formData.selectedPaymentMethod?.id === method.id && (604 |                                     <Check className="w-4 h-4 text-[#ffd700] ml-auto" />605 |                                   )}606 |                                 </button>607 |                               ))}608 |                             </div>609 |                           )}610 |                         </div>611 |                       </div>612 | 613 |                       {}614 |                       {formData.selectedPaymentMethod?.type === 'stripe' && formData.selectedPackage && (615 |                         <div className="bg-[#16213e] p-4 rounded-lg">616 |                           <h3 className="text-white font-semibold mb-4">Secure Payment</h3>617 |                           <StripeInlineForm618 |                             amount={formData.selectedPackage.price * formData.quantity * 100}619 |                             currency={formData.selectedPackage.currency.code}620 |                             description={`Purchase of ${formData.selectedPackage.packageDefinition.name} (${formData.quantity} ${formData.quantity === 1 ? 'unit' : 'units'})`}621 |                             customerEmail={formData.clientEmail}622 |                             onSuccess={handleStripeSuccess}623 |                             onError={handleStripeError}624 |                           />625 |                         </div>626 |                       )}627 | 628 |                       {}629 |                       {formData.selectedPaymentMethod?.type !== 'stripe' && (630 |                         <div className="bg-[#16213e] p-4 rounded-lg">631 |                           <h3 className="text-white font-semibold mb-4">Payment Information</h3>632 |                           <p className="text-gray-400 mb-4">633 |                             You have selected {formData.selectedPaymentMethod?.name}.634 |                             Please complete your payment using the selected method.635 |                           </p>636 |                           <BaseButton637 |                             onClick={handlePurchase}638 |                             disabled={processing}639 |                             className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"640 |                           >641 |                             {processing ? 'Processing...' : 'Complete Purchase'}642 |                           </BaseButton>643 |                         </div>644 |                       )}645 |                     </CardContent>646 |                   </Card>647 |                 )}648 |               </motion.div>649 |             </AnimatePresence>650 | 651 |             {}652 |             <div className="flex justify-between mt-6">653 |               <BaseButton654 |                 onClick={handlePrevious}655 |                 disabled={currentStep === 0}656 |                 className="bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23] disabled:opacity-50"657 |               >658 |                 <ArrowLeft className="w-4 h-4 mr-2" />659 |                 Previous660 |               </BaseButton>661 | 662 |               {currentStep < getSteps().length - 1 ? (663 |                 <BaseButton664 |                   onClick={handleNext}665 |                   disabled={666 |                     (currentStep === 0 && !formData.selectedPackage) ||667 |                     (currentStep === 1 && (!formData.clientName || !formData.clientEmail))668 |                   }669 |                   className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"670 |                 >671 |                   Next672 |                   <ArrowRight className="w-4 h-4 ml-2" />673 |                 </BaseButton>674 |               ) : (675 |                 <BaseButton676 |                   onClick={handlePurchase}677 |                   disabled={!formData.selectedPackage || !formData.selectedPaymentMethod || processing}678 |                   className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"679 |                 >680 |                   {processing ? 'Processing...' : 'Complete Purchase'}681 |                 </BaseButton>682 |               )}683 |             </div>684 |           </div>685 | 686 |           {}687 |           <div className="space-y-6">688 |             <Card className="bg-[#1a1a2e] border-[#16213e]">689 |               <CardHeader>690 |                 <CardTitle className="text-white flex items-center space-x-2">691 |                   <ShoppingCart className="w-5 h-5 text-[#ffd700]" />692 |                   <span>Order Summary</span>693 |                 </CardTitle>694 |               </CardHeader>695 |               <CardContent className="space-y-4">696 |                 {formData.selectedPackage ? (697 |                   <>698 |                     <div className="flex items-center justify-between">699 |                       <span className="text-gray-300">Package</span>700 |                       <span className="text-white">{formData.selectedPackage.packageDefinition.name}</span>701 |                     </div>702 |                     <div className="flex items-center justify-between">703 |                       <span className="text-gray-300">Quantity</span>704 |                       <span className="text-white">{formData.quantity}</span>705 |                     </div>706 |                     <div className="flex items-center justify-between">707 |                       <span className="text-gray-300">Price per unit</span>708 |                       <span className="text-white">709 |                         {formData.selectedPackage.currency.symbol}{formData.selectedPackage.price}710 |                       </span>711 |                     </div>712 |                     <div className="border-t border-[#16213e] pt-4">713 |                       <div className="flex items-center justify-between">714 |                         <span className="text-white font-semibold">Total</span>715 |                         <span className="text-[#ffd700] font-bold text-lg">716 |                           {formData.selectedPackage.currency.symbol}717 |                           {typeof formData.selectedPackage.price === 'number' && !isNaN(formData.selectedPackage.price)718 |                             ? (formData.selectedPackage.price * formData.quantity).toFixed(2)719 |                             : <span className="text-red-400 text-sm" title={`Raw price: ${formData.selectedPackage.price}`}>720 |                                 {formData.selectedPackage.price !== undefined && formData.selectedPackage.price !== null ? String(formData.selectedPackage.price) : 'Contact for pricing'}721 |                               </span>722 |                           }723 |                         </span>724 |                       </div>725 |                     </div>726 |                   </>727 |                 ) : (728 |                   <p className="text-gray-400 text-center py-4">Select a package to see order details</p>729 |                 )}730 |               </CardContent>731 |             </Card>732 | 733 |             {}734 |             <Card className="bg-[#1a1a2e] border-[#16213e]">735 |               <CardHeader>736 |                 <CardTitle className="text-white flex items-center space-x-2">737 |                   <User className="w-5 h-5 text-[#ffd700]" />738 |                   <span>Your Information</span>739 |                 </CardTitle>740 |               </CardHeader>741 |               <CardContent className="space-y-2">742 |                 <div className="flex items-center justify-between">743 |                   <span className="text-gray-300">Name</span>744 |                   <span className="text-white text-sm">{formData.clientName || 'Not provided'}</span>745 |                 </div>746 |                 <div className="flex items-center justify-between">747 |                   <span className="text-gray-300">Email</span>748 |                   <span className="text-white text-sm">{formData.clientEmail || 'Not provided'}</span>749 |                 </div>750 |                 <div className="flex items-center justify-between">751 |                   <span className="text-gray-300">Phone</span>752 |                   <span className="text-white text-sm">{formData.clientPhone || 'Not provided'}</span>753 |                 </div>754 |                 <div className="flex items-center justify-between">755 |                   <span className="text-gray-300">Language</span>756 |                   <span className="text-white text-sm capitalize">{formData.language}</span>757 |                 </div>758 |               </CardContent>759 |             </Card>760 |           </div>761 |         </div>762 |       </div>763 |     </div>764 |   );765 | }
============================================================END: frontend/app/(client)/account/purchase/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/purchase-history/page.tsxSIZE: 13.17 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Badge } from '@/components/ui/badge';  7 | import { Input } from '@/components/ui/input';  8 | import { Label } from '@/components/ui/label';  9 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 10 | import { 11 |   ShoppingCart, 12 |   CreditCard, 13 |   PackageIcon, 14 |   Search, 15 |   Filter, 16 |   Download, 17 |   Eye 18 | } from 'lucide-react'; 19 | import { useAuth } from '@/hooks/useAuth'; 20 |  21 | interface PurchaseRecord { 22 |   id: string; 23 |   packageId: number; 24 |   packageName: string; 25 |   packageDescription: string; 26 |   quantity: number; 27 |   totalAmount: number; 28 |   paymentMethod: string; 29 |   paymentStatus: string; 30 |   purchaseDate: string; 31 |   currency: string; 32 |   transactionId?: string; 33 |   notes?: string; 34 | } 35 |  36 | export default function PurchaseHistoryPage() { 37 |   const { user } = useAuth(); 38 |   const [purchases, setPurchases] = useState<PurchaseRecord[]>([]); 39 |   const [loading, setLoading] = useState(true); 40 |   const [searchTerm, setSearchTerm] = useState(''); 41 |   const [statusFilter, setStatusFilter] = useState('all'); 42 |   const [dateFilter, setDateFilter] = useState('all'); 43 |  44 |   const fetchPurchaseHistory = useCallback(async () => { 45 |     try { 46 |       setLoading(true); 47 |       const response = await fetch('/api/client/purchase-history', { 48 |         headers: { 49 |           'Authorization': `Bearer ${user?.access_token}`, 50 |           'Content-Type': 'application/json' 51 |         } 52 |       }); 53 |  54 |       const result = await response.json(); 55 |  56 |       if (result.success) { 57 |         setPurchases(result.data); 58 |       } else { 59 |         } 60 |     } catch (error) { 61 |       } finally { 62 |       setLoading(false); 63 |     } 64 |   }, [user?.access_token]); 65 |  66 |   useEffect(() => { 67 |     if (user?.access_token) { 68 |       fetchPurchaseHistory(); 69 |     } 70 |   }, [user?.access_token, fetchPurchaseHistory]); 71 |  72 |   const getStatusColor = (status: string) => { 73 |     switch (status.toLowerCase()) { 74 |       case 'completed': 75 |       case 'success': 76 |         return 'bg-green-500/20 text-green-400 border-green-500/30'; 77 |       case 'pending': 78 |         return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30'; 79 |       case 'failed': 80 |       case 'cancelled': 81 |         return 'bg-red-500/20 text-red-400 border-red-500/30'; 82 |       default: 83 |         return 'bg-gray-500/20 text-gray-400 border-gray-500/30'; 84 |     } 85 |   }; 86 |  87 |   const filteredPurchases = purchases.filter(purchase => { 88 |     const matchesSearch = purchase.packageName.toLowerCase().includes(searchTerm.toLowerCase()) || 89 |                          purchase.transactionId?.toLowerCase().includes(searchTerm.toLowerCase()); 90 |     const matchesStatus = statusFilter === 'all' || purchase.paymentStatus.toLowerCase() === statusFilter.toLowerCase(); 91 |  92 |     let matchesDate = true; 93 |     if (dateFilter !== 'all') { 94 |       const purchaseDate = new Date(purchase.purchaseDate); 95 |       const now = new Date(); 96 |       const daysDiff = Math.floor((now.getTime() - purchaseDate.getTime()) / (1000 * 60 * 60 * 24)); 97 |  98 |       switch (dateFilter) { 99 |         case '7days':100 |           matchesDate = daysDiff <= 7;101 |           break;102 |         case '30days':103 |           matchesDate = daysDiff <= 30;104 |           break;105 |         case '90days':106 |           matchesDate = daysDiff <= 90;107 |           break;108 |         case '1year':109 |           matchesDate = daysDiff <= 365;110 |           break;111 |       }112 |     }113 | 114 |     return matchesSearch && matchesStatus && matchesDate;115 |   });116 | 117 |   const totalSpent = purchases.reduce((sum, purchase) => sum + purchase.totalAmount, 0);118 |   const totalPurchases = purchases.length;119 |   const completedPurchases = purchases.filter(p => p.paymentStatus.toLowerCase() === 'completed').length;120 | 121 |   if (loading) {122 |     return (123 |       <div className="flex items-center justify-center min-h-[400px]">124 |         <div className="text-center">125 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>126 |           <p className="text-[#FFD700] text-lg font-semibold">Loading purchase history...</p>127 |         </div>128 |       </div>129 |     );130 |   }131 | 132 |   return (133 |     <div className="container mx-auto p-6 space-y-6">134 |       <div className="text-center">135 |         <h1 className="text-3xl font-bold text-white">Purchase History</h1>136 |         <p className="text-gray-400 mt-2">View your complete purchase history and transaction details</p>137 |       </div>138 | 139 |       {}140 |       <div className="grid grid-cols-1 md:grid-cols-3 gap-6">141 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">142 |           <CardContent className="p-6">143 |             <div className="flex items-center space-x-4">144 |               <div className="p-3 bg-[#ffd700]/20 rounded-full">145 |                 <ShoppingCart className="w-6 h-6 text-[#ffd700]" />146 |               </div>147 |               <div>148 |                 <div className="text-2xl font-bold text-white">{totalPurchases}</div>149 |                 <div className="text-sm text-gray-400">Total Purchases</div>150 |               </div>151 |             </div>152 |           </CardContent>153 |         </Card>154 | 155 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">156 |           <CardContent className="p-6">157 |             <div className="flex items-center space-x-4">158 |               <div className="p-3 bg-green-500/20 rounded-full">159 |                 <CreditCard className="w-6 h-6 text-green-400" />160 |               </div>161 |               <div>162 |                 <div className="text-2xl font-bold text-white">${totalSpent.toFixed(2)}</div>163 |                 <div className="text-sm text-gray-400">Total Spent</div>164 |               </div>165 |             </div>166 |           </CardContent>167 |         </Card>168 | 169 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">170 |           <CardContent className="p-6">171 |             <div className="flex items-center space-x-4">172 |               <div className="p-3 bg-blue-500/20 rounded-full">173 |                 <PackageIcon className="w-6 h-6 text-blue-400" />174 |               </div>175 |               <div>176 |                 <div className="text-2xl font-bold text-white">{completedPurchases}</div>177 |                 <div className="text-sm text-gray-400">Completed Orders</div>178 |               </div>179 |             </div>180 |           </CardContent>181 |         </Card>182 |       </div>183 | 184 |       {}185 |       <Card className="bg-[#1a1a2e] border-[#16213e] text-white">186 |         <CardHeader>187 |           <CardTitle className="flex items-center space-x-2">188 |             <Filter className="w-5 h-5" />189 |             <span>Filters</span>190 |           </CardTitle>191 |         </CardHeader>192 |         <CardContent>193 |           <div className="grid grid-cols-1 md:grid-cols-3 gap-4">194 |             <div>195 |               <Label htmlFor="search" className="text-gray-300">Search</Label>196 |               <div className="relative">197 |                 <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />198 |                 <Input199 |                   id="search"200 |                   placeholder="Search packages or transaction ID..."201 |                   value={searchTerm}202 |                   onChange={(e) => setSearchTerm(e.target.value)}203 |                   className="pl-10 bg-[#16213e] border-[#0a0a23] text-white"204 |                 />205 |               </div>206 |             </div>207 | 208 |             <div>209 |               <Label htmlFor="status" className="text-gray-300">Payment Status</Label>210 |               <Select value={statusFilter} onValueChange={setStatusFilter}>211 |                 <SelectTrigger className="bg-[#16213e] border-[#0a0a23] text-white">212 |                   <SelectValue />213 |                 </SelectTrigger>214 |                 <SelectContent className="bg-[#16213e] border-[#0a0a23] text-white">215 |                   <SelectItem value="all">All Statuses</SelectItem>216 |                   <SelectItem value="completed">Completed</SelectItem>217 |                   <SelectItem value="pending">Pending</SelectItem>218 |                   <SelectItem value="failed">Failed</SelectItem>219 |                 </SelectContent>220 |               </Select>221 |             </div>222 | 223 |             <div>224 |               <Label htmlFor="date" className="text-gray-300">Date Range</Label>225 |               <Select value={dateFilter} onValueChange={setDateFilter}>226 |                 <SelectTrigger className="bg-[#16213e] border-[#0a0a23] text-white">227 |                   <SelectValue />228 |                 </SelectTrigger>229 |                 <SelectContent className="bg-[#16213e] border-[#0a0a23] text-white">230 |                   <SelectItem value="all">All Time</SelectItem>231 |                   <SelectItem value="7days">Last 7 Days</SelectItem>232 |                   <SelectItem value="30days">Last 30 Days</SelectItem>233 |                   <SelectItem value="90days">Last 90 Days</SelectItem>234 |                   <SelectItem value="1year">Last Year</SelectItem>235 |                 </SelectContent>236 |               </Select>237 |             </div>238 |           </div>239 |         </CardContent>240 |       </Card>241 | 242 |       {}243 |       {filteredPurchases.length === 0 ? (244 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white">245 |           <CardContent className="p-8 text-center">246 |             <div className="space-y-4">247 |               <ShoppingCart className="w-16 h-16 text-gray-500 mx-auto" />248 |               <h3 className="text-xl font-semibold text-gray-300">No Purchases Found</h3>249 |               <p className="text-gray-400">250 |                 {purchases.length === 0251 |                   ? "You haven't made any purchases yet. Start your spiritual journey today!"252 |                   : "No purchases match your current filters. Try adjusting your search criteria."253 |                 }254 |               </p>255 |               {purchases.length === 0 && (256 |                 <Button className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90">257 |                   <PackageIcon className="w-4 h-4 mr-2" />258 |                   Browse Packages259 |                 </Button>260 |               )}261 |             </div>262 |           </CardContent>263 |         </Card>264 |       ) : (265 |         <div className="space-y-4">266 |           {filteredPurchases.map((purchase) => (267 |             <Card key={purchase.id} className="bg-[#1a1a2e] border-[#16213e] text-white hover:border-[#ffd700]/50 transition-all">268 |               <CardHeader className="pb-3">269 |                 <div className="flex justify-between items-start">270 |                   <div className="flex items-center space-x-2">271 |                     <PackageIcon className="w-5 h-5 text-[#ffd700]" />272 |                     <CardTitle className="text-lg">{purchase.packageName}</CardTitle>273 |                   </div>274 |                   <Badge className={getStatusColor(purchase.paymentStatus)}>275 |                     {purchase.paymentStatus}276 |                   </Badge>277 |                 </div>278 |               </CardHeader>279 |               <CardContent className="space-y-4">280 |                 <p className="text-gray-300 text-sm">{purchase.packageDescription}</p>281 | 282 |                 <div className="grid grid-cols-1 md:grid-cols-4 gap-4">283 |                   <div>284 |                     <div className="text-sm text-gray-400">Purchase Date</div>285 |                     <div className="text-white font-medium">286 |                       {new Date(purchase.purchaseDate).toLocaleDateString()}287 |                     </div>288 |                   </div>289 |                   <div>290 |                     <div className="text-sm text-gray-400">Quantity</div>291 |                     <div className="text-white font-medium">{purchase.quantity}</div>292 |                   </div>293 |                   <div>294 |                     <div className="text-sm text-gray-400">Total Amount</div>295 |                     <div className="text-[#ffd700] font-bold">296 |                       {purchase.currency} {purchase.totalAmount.toFixed(2)}297 |                     </div>298 |                   </div>299 |                   <div>300 |                     <div className="text-sm text-gray-400">Payment Method</div>301 |                     <div className="text-white font-medium">{purchase.paymentMethod}</div>302 |                   </div>303 |                 </div>304 | 305 |                 {purchase.transactionId && (306 |                   <div className="bg-[#16213e] p-3 rounded-lg">307 |                     <div className="text-sm text-gray-400">Transaction ID</div>308 |                     <div className="text-white font-mono text-sm">{purchase.transactionId}</div>309 |                   </div>310 |                 )}311 | 312 |                 {purchase.notes && (313 |                   <div className="bg-[#16213e] p-3 rounded-lg">314 |                     <div className="text-sm text-gray-400">Notes</div>315 |                     <div className="text-white text-sm">{purchase.notes}</div>316 |                   </div>317 |                 )}318 | 319 |                 <div className="flex justify-end space-x-2">320 |                   <Button variant="outline" size="sm" className="border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white">321 |                     <Eye className="w-4 h-4 mr-2" />322 |                     View Details323 |                   </Button>324 |                   <Button variant="outline" size="sm" className="border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white">325 |                     <Download className="w-4 h-4 mr-2" />326 |                     Download Receipt327 |                   </Button>328 |                 </div>329 |               </CardContent>330 |             </Card>331 |           ))}332 |         </div>333 |       )}334 |     </div>335 |   );336 | }
============================================================END: frontend/app/(client)/account/purchase-history/page.tsx============================================================


============================================================FILE: frontend/app/(client)/account/sessions/SessionReportButton.tsxSIZE: 1.53 KB============================================================
  1 | 'use client';  2 |   3 | import { useState } from 'react';  4 | import { Button } from '@/components/ui/button';  5 | import { DownloadIcon } from 'lucide-react';  6 |   7 | interface SessionReportButtonProps {  8 |   bookingId: number;  9 | } 10 |  11 | export default function SessionReportButton({ bookingId }: SessionReportButtonProps) { 12 |   const [isLoading, setIsLoading] = useState(false); 13 |  14 |   const handleDownload = async () => { 15 |     try { 16 |       setIsLoading(true); 17 |  18 |       const response = await fetch(`/api/client/bookings/${bookingId}/report`); 19 |       const data = await response.json(); 20 |  21 |       if (data.success && data.data.downloadUrl) { 22 |  23 |         const link = document.createElement('a'); 24 |         link.href = data.data.downloadUrl; 25 |         link.download = `session-report-${bookingId}.pdf`; 26 |         document.body.appendChild(link); 27 |         link.click(); 28 |         document.body.removeChild(link); 29 |       } else { 30 |         alert('Failed to download report. Please try again.'); 31 |       } 32 |     } catch (error) { 33 |       alert('Error downloading report. Please try again.'); 34 |     } finally { 35 |       setIsLoading(false); 36 |     } 37 |   }; 38 |  39 |   return ( 40 |     <Button 41 |       onClick={handleDownload} 42 |       disabled={isLoading} 43 |       className="bg-[#ffd700] text-[#0a0a23] hover:bg-[#e6c200] disabled:opacity-50" 44 |     > 45 |       <DownloadIcon className="mr-2 h-4 w-4" /> 46 |       {isLoading ? 'Downloading...' : 'Download Report'} 47 |     </Button> 48 |   ); 49 | }
============================================================END: frontend/app/(client)/account/sessions/SessionReportButton.tsx============================================================


============================================================FILE: frontend/app/(client)/account/sessions/page.tsxSIZE: 5.36 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Badge } from '@/components/ui/badge';  7 | import { CalendarIcon, ClockIcon, PackageIcon, ShoppingCart } from 'lucide-react';  8 |   9 | import SessionReportButton from './SessionReportButton'; 10 |  11 | interface Session { 12 |   id: number; 13 |   date: string; 14 |   start_time: string; 15 |   end_time: string; 16 |   status: string; 17 |   notes: string | null; 18 |   package: { 19 |     name: string; 20 |     duration_minutes: number; 21 |   }; 22 |   created_at: string; 23 | } 24 |  25 | export default function SessionsPage() { 26 |   const [sessions, setSessions] = useState<Session[]>([]); 27 |   const [loading, setLoading] = useState(true); 28 |  29 |   useEffect(() => { 30 |     fetchSessions(); 31 |   }, []); 32 |  33 |   const fetchSessions = async () => { 34 |     try { 35 |       setLoading(true); 36 |       const response = await fetch('/api/client/my-bookings'); 37 |       const result = await response.json(); 38 |  39 |       if (result.success) { 40 |         setSessions(result.data); 41 |       } else { 42 |         } 43 |     } catch (error) { 44 |       } finally { 45 |       setLoading(false); 46 |     } 47 |   }; 48 |  49 |   const getStatusColor = (status: string) => { 50 |     switch (status.toLowerCase()) { 51 |       case 'completed': 52 |         return 'bg-green-500/20 text-green-400 border-green-500/30'; 53 |       case 'upcoming': 54 |         return 'bg-blue-500/20 text-blue-400 border-blue-500/30'; 55 |       case 'cancelled': 56 |         return 'bg-red-500/20 text-red-400 border-red-500/30'; 57 |       default: 58 |         return 'bg-gray-500/20 text-gray-400 border-gray-500/30'; 59 |     } 60 |   }; 61 |  62 |   if (loading) { 63 |     return ( 64 |       <div className="flex items-center justify-center min-h-[400px]"> 65 |         <div className="text-center"> 66 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 67 |           <p className="text-[#FFD700] text-lg font-semibold">Loading your sessions...</p> 68 |         </div> 69 |       </div> 70 |     ); 71 |   } 72 |  73 |   return ( 74 |     <div className="container mx-auto p-6 space-y-6"> 75 |       <div className="text-center"> 76 |         <h1 className="text-3xl font-bold text-white">Your Sessions</h1> 77 |         <p className="text-gray-400 mt-2">View your spiritual consultation history</p> 78 |       </div> 79 |  80 |       {sessions.length === 0 ? ( 81 |         <Card className="bg-[#1a1a2e] border-[#16213e] text-white"> 82 |           <CardContent className="p-8 text-center"> 83 |             <div className="space-y-4"> 84 |               <CalendarIcon className="w-16 h-16 text-gray-500 mx-auto" /> 85 |               <h3 className="text-xl font-semibold text-gray-300">No Sessions Yet</h3> 86 |               <p className="text-gray-400"> 87 |                 You haven&apos;t booked any sessions yet. Start your spiritual journey today! 88 |               </p> 89 |               <Button className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90"> 90 |                 <ShoppingCart className="w-4 h-4 mr-2" /> 91 |                 Book Your First Session 92 |               </Button> 93 |             </div> 94 |           </CardContent> 95 |         </Card> 96 |       ) : ( 97 |         <div className="space-y-4"> 98 |           {sessions.map((session) => ( 99 |             <Card key={session.id} className="bg-[#1a1a2e] border-[#16213e] text-white">100 |               <CardHeader className="pb-3">101 |                 <div className="flex justify-between items-start">102 |                   <div className="flex items-center space-x-2">103 |                     <PackageIcon className="w-5 h-5 text-[#ffd700]" />104 |                     <CardTitle className="text-lg">{session.package.name}</CardTitle>105 |                   </div>106 |                   <Badge className={getStatusColor(session.status)}>107 |                     {session.status}108 |                   </Badge>109 |                 </div>110 |               </CardHeader>111 |               <CardContent className="space-y-4">112 |                 <div className="grid grid-cols-1 md:grid-cols-3 gap-4">113 |                   <div className="flex items-center space-x-2 text-sm text-gray-300">114 |                     <CalendarIcon className="w-4 h-4" />115 |                     <span>{new Date(session.date).toLocaleDateString()}</span>116 |                   </div>117 |                   <div className="flex items-center space-x-2 text-sm text-gray-300">118 |                     <ClockIcon className="w-4 h-4" />119 |                     <span>{session.start_time} - {session.end_time}</span>120 |                   </div>121 |                   <div className="text-sm text-gray-300">122 |                     Duration: {session.package.duration_minutes} minutes123 |                   </div>124 |                 </div>125 | 126 |                 {session.notes && (127 |                   <div className="bg-[#16213e] p-3 rounded-lg">128 |                     <p className="text-sm text-gray-300">129 |                       <span className="font-medium">Notes:</span> {session.notes}130 |                     </p>131 |                   </div>132 |                 )}133 | 134 |                 <div className="flex justify-between items-center">135 |                   <div className="text-xs text-gray-500">136 |                     Booked on: {new Date(session.created_at).toLocaleDateString()}137 |                   </div>138 | 139 |                   {session.status === 'completed' && (140 |                     <SessionReportButton bookingId={session.id} />141 |                   )}142 |                 </div>143 |               </CardContent>144 |             </Card>145 |           ))}146 |         </div>147 |       )}148 |     </div>149 |   );150 | }
============================================================END: frontend/app/(client)/account/sessions/page.tsx============================================================


============================================================FILE: frontend/app/api/admin/bookings/[id]/report/route.tsSIZE: 3.43 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | export async function POST(  6 |   request: NextRequest,  7 |   { params }: { params: { id: string } }  8 | ) {  9 |   try { 10 |     const user = await requireAuth(request); 11 |     if (!user) { 12 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 13 |     } 14 |  15 |     const supabase = await createServerClient(); 16 |  17 |     const { data: booking, error: bookingError } = await supabase 18 |       .from('bookings') 19 |       .select('*') 20 |       .eq('id', params.id) 21 |       .single(); 22 |  23 |     if (bookingError || !booking) { 24 |       return NextResponse.json({ error: 'Booking not found' }, { status: 404 }); 25 |     } 26 |  27 |     const formData = await request.formData(); 28 |     const file = formData.get('file') as File; 29 |     const notes = formData.get('notes') as string; 30 |  31 |     if (!file) { 32 |       return NextResponse.json({ error: 'No file provided' }, { status: 400 }); 33 |     } 34 |  35 |     const allowedTypes = ['application/pdf', 'text/plain', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document']; 36 |     if (!allowedTypes.includes(file.type)) { 37 |       return NextResponse.json({ error: 'Invalid file type. Only PDF, DOC, DOCX, and TXT files are allowed.' }, { status: 400 }); 38 |     } 39 |  40 |     if (file.size > 5 * 1024 * 1024) { 41 |       return NextResponse.json({ error: 'File size too large. Maximum size is 5MB.' }, { status: 400 }); 42 |     } 43 |  44 |     const timestamp = new Date().toISOString().replace(/[:.]/g, '-'); 45 |     const filename = `session-report-${params.id}-${timestamp}-${file.name}`; 46 |  47 |     const { error: uploadError } = await supabase.storage 48 |       .from('session-reports') 49 |       .upload(filename, file, { 50 |         cacheControl: '3600', 51 |         upsert: false 52 |       }); 53 |  54 |     if (uploadError) { 55 |       return NextResponse.json({ error: 'Failed to upload file' }, { status: 500 }); 56 |     } 57 |  58 |     const { data: { publicUrl } } = supabase.storage 59 |       .from('session-reports') 60 |       .getPublicUrl(filename); 61 |  62 |     const { data: report, error: reportError } = await supabase 63 |       .from('session_reports') 64 |       .insert({ 65 |         booking_id: params.id, 66 |         file_path: filename, 67 |         original_filename: file.name, 68 |         mime_type: file.type, 69 |         file_size: file.size, 70 |         notes: notes || null, 71 |         uploaded_by: user.id, 72 |         uploaded_at: new Date().toISOString() 73 |       }) 74 |       .select() 75 |       .single(); 76 |  77 |     if (reportError) { 78 |       return NextResponse.json({ error: 'Failed to create report record' }, { status: 500 }); 79 |     } 80 |  81 |     await supabase 82 |       .from('bookings') 83 |       .update({ 84 |         status: 'completed', 85 |         updated_at: new Date().toISOString() 86 |       }) 87 |       .eq('id', params.id); 88 |  89 |     return NextResponse.json({ 90 |       success: true, 91 |       data: { 92 |         report, 93 |         publicUrl 94 |       }, 95 |       message: 'Session report uploaded successfully' 96 |     }); 97 |  98 |   } catch (error) { 99 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 });100 |   }101 | }
============================================================END: frontend/app/api/admin/bookings/[id]/report/route.ts============================================================


============================================================FILE: frontend/app/api/admin/bookings/route.tsSIZE: 21.99 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 | import { replacePlaceholders } from '@/lib/communication/placeholders';  6 |   7 | interface BookingWhereClause {  8 |   userId?: string;  9 |   status?: string; 10 |   sessionType?: string; 11 |   createdAt?: { 12 |     gte?: Date; 13 |     lte?: Date; 14 |   }; 15 | } 16 |  17 | const createBookingSchema = z.object({ 18 |   userId: z.string().cuid('Invalid user ID format'), 19 |   userPackageId: z.number().int().positive('User package ID must be positive'), 20 |   scheduleSlotId: z.number().int().positive('Schedule slot ID must be positive'), 21 |   sessionType: z.string().min(1, 'Session type is required'), 22 |   notes: z.string().optional(), 23 |   otpCode: z.string().optional(), 24 |   phoneNumber: z.string().optional() 25 | }); 26 |  27 | const updateBookingSchema = z.object({ 28 |   id: z.number().int().positive('Booking ID must be positive'), 29 |   status: z.enum(['confirmed', 'completed', 'cancelled', 'no-show']).optional(), 30 |   notes: z.string().optional(), 31 |   cancelledReason: z.string().optional(), 32 |   reminderSent: z.boolean().optional() 33 | }); 34 |  35 | const querySchema = z.object({ 36 |   userId: z.string().cuid().optional(), 37 |   status: z.enum(['confirmed', 'completed', 'cancelled', 'no-show']).optional(), 38 |   dateFrom: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(), 39 |   dateTo: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(), 40 |   sessionType: z.string().optional(), 41 |   page: z.coerce.number().int().min(1).default(1), 42 |   limit: z.coerce.number().int().min(1).max(100).default(20), 43 |   enhanced: z.enum(['true', 'false']).optional() 44 | }); 45 |  46 | export async function GET(request: NextRequest) { 47 |   try { 48 |     const user = await requireAuth(request); 49 |     if (!user || user.role !== 'admin') { 50 |       return NextResponse.json({ 51 |         success: false, 52 |         error: 'Unauthorized', 53 |         message: 'Admin access required' 54 |       }, { status: 401 }); 55 |     } 56 |  57 |     const { searchParams } = new URL(request.url); 58 |     const queryParams = Object.fromEntries(searchParams.entries()); 59 |     const validation = querySchema.safeParse(queryParams); 60 |  61 |     if (!validation.success) { 62 |       return NextResponse.json({ 63 |         success: false, 64 |         error: 'Invalid query parameters', 65 |         details: validation.error.issues 66 |       }, { status: 400 }); 67 |     } 68 |  69 |     const { userId, status, dateFrom, dateTo, sessionType, page, limit, enhanced } = validation.data; 70 |     const offset = (page - 1) * limit; 71 |  72 |     const where: BookingWhereClause = {}; 73 |  74 |     if (userId) where.userId = userId; 75 |     if (status) where.status = status; 76 |     if (sessionType) where.sessionType = sessionType; 77 |     if (dateFrom) where.createdAt = { gte: new Date(`${dateFrom}T00:00:00Z`) }; 78 |     if (dateTo) { 79 |       where.createdAt = { 80 |         ...where.createdAt, 81 |         lte: new Date(`${dateTo}T23:59:59Z`) 82 |       }; 83 |     } 84 |  85 |     const select: Record<string, boolean | object> = { 86 |       id: true, 87 |       userId: true, 88 |       userPackageId: true, 89 |       scheduleSlotId: true, 90 |       sessionType: true, 91 |       status: true, 92 |       notes: true, 93 |       cancelledAt: true, 94 |       cancelledReason: true, 95 |       reminderSent: true, 96 |       reminderSentAt: true, 97 |       createdAt: true, 98 |       updatedAt: true, 99 |       user: {100 |         select: {101 |           id: true,102 |           email: true,103 |           fullName: true,104 |           phone: true105 |         }106 |       },107 |       scheduleSlot: {108 |         select: {109 |           id: true,110 |           startTime: true,111 |           endTime: true,112 |           scheduleTemplate: {113 |             select: {114 |               dayOfWeek: true,115 |               sessionDuration: {116 |                 select: {117 |                   name: true,118 |                   duration_minutes: true119 |                 }120 |               }121 |             }122 |           }123 |         }124 |       }125 |     };126 | 127 |     if (enhanced === 'true') {128 |       select.userPackage = {129 |         select: {130 |           id: true,131 |           purchase: {132 |             select: {133 |               id: true,134 |               totalAmount: true,135 |               paymentStatus: true,136 |               purchasedAt: true137 |             }138 |           },139 |           packagePrice: {140 |             select: {141 |               id: true,142 |               price: true,143 |               pricingMode: true,144 |               packageDefinition: {145 |                 select: {146 |                   id: true,147 |                   name: true,148 |                   description: true,149 |                   sessionsCount: true,150 |                   packageType: true,151 |                   sessionDuration: {152 |                     select: {153 |                       name: true,154 |                       duration_minutes: true155 |                     }156 |                   }157 |                 }158 |               },159 |               currency: {160 |                 select: {161 |                   code: true,162 |                   symbol: true163 |                 }164 |               }165 |             }166 |           }167 |         }168 |       } as Record<string, boolean | object>;169 |     } else {170 |       select.userPackage = {171 |         select: {172 |           id: true,173 |           isActive: true,174 |           packagePrice: {175 |             select: {176 |               id: true,177 |               price: true,178 |               pricingMode: true,179 |               packageDefinition: {180 |                 select: {181 |                   id: true,182 |                   name: true,183 |                   description: true,184 |                   sessionsCount: true,185 |                   packageType: true,186 |                   sessionDuration: {187 |                     select: {188 |                       name: true,189 |                       duration_minutes: true190 |                     }191 |                   }192 |                 }193 |               },194 |               currency: {195 |                 select: {196 |                   symbol: true,197 |                   code: true198 |                 }199 |               }200 |             }201 |           }202 |         }203 |       } as Record<string, boolean | object>;204 |     }205 | 206 |     const [bookings, totalCount] = await Promise.all([207 |       prisma.booking.findMany({208 |         where,209 |         select,210 |         skip: offset,211 |         take: limit,212 |         orderBy: { createdAt: 'desc' }213 |       }),214 |       prisma.booking.count({ where })215 |     ]);216 | 217 |     const totalPages = Math.ceil(totalCount / limit);218 | 219 |     return NextResponse.json({220 |       success: true,221 |       data: bookings,222 |       pagination: {223 |         page,224 |         limit,225 |         total: totalCount,226 |         totalPages227 |       }228 |     });229 | 230 |   } catch (error) {231 |     return NextResponse.json({232 |       success: false,233 |       error: 'Internal server error',234 |       message: 'An unexpected error occurred',235 |       details: error instanceof Error ? error.message : 'Unknown error'236 |     }, { status: 500 });237 |   } finally {238 |     await prisma.$disconnect();239 |   }240 | }241 | 242 | export async function POST(request: NextRequest) {243 |   try {244 |     const user = await requireAuth(request);245 |     if (!user || user.role !== 'admin') {246 |       return NextResponse.json({247 |         success: false,248 |         error: 'Unauthorized',249 |         message: 'Admin access required'250 |       }, { status: 401 });251 |     }252 | 253 |     const body = await request.json();254 |     const validation = createBookingSchema.safeParse(body);255 | 256 |     if (!validation.success) {257 |       return NextResponse.json({258 |         success: false,259 |         error: 'Validation failed',260 |         message: 'Invalid booking data',261 |         details: validation.error.issues262 |       }, { status: 400 });263 |     }264 | 265 |     const { userId, userPackageId, scheduleSlotId, sessionType, notes, otpCode, phoneNumber } = validation.data;266 | 267 |     const targetUser = await prisma.user.findUnique({268 |       where: { id: userId }269 |     });270 | 271 |     if (!targetUser) {272 |       return NextResponse.json({273 |         success: false,274 |         error: 'User not found',275 |         message: 'The specified user does not exist'276 |       }, { status: 404 });277 |     }278 | 279 |     if (otpCode && phoneNumber) {280 |       const otpVerification = await prisma.otpVerification.findFirst({281 |         where: {282 |           phoneNumber,283 |           otpCode,284 |           isVerified: true,285 |           expiresAt: {286 |             gt: new Date()287 |           }288 |         },289 |         orderBy: {290 |           createdAt: 'desc'291 |         }292 |       });293 | 294 |       if (!otpVerification) {295 |         return NextResponse.json({296 |           success: false,297 |           error: 'Invalid OTP',298 |           message: 'OTP code is invalid or has expired'299 |         }, { status: 400 });300 |       }301 |     }302 | 303 |     const scheduleSlot = await prisma.scheduleSlot.findUnique({304 |       where: { id: scheduleSlotId },305 |       include: {306 |         scheduleTemplate: {307 |           include: {308 |             sessionDuration: true309 |           }310 |         }311 |       }312 |     });313 | 314 |     if (!scheduleSlot) {315 |       return NextResponse.json({316 |         success: false,317 |         error: 'Schedule slot not found',318 |         message: 'The specified schedule slot does not exist'319 |       }, { status: 404 });320 |     }321 | 322 |     if (!scheduleSlot.isAvailable) {323 |       return NextResponse.json({324 |         success: false,325 |         error: 'Slot unavailable',326 |         message: 'This schedule slot is not available for booking'327 |       }, { status: 400 });328 |     }329 | 330 |     if ((scheduleSlot.bookedCount || 0) >= (scheduleSlot.capacity || 0)) {331 |       return NextResponse.json({332 |         success: false,333 |         error: 'Slot full',334 |         message: 'This schedule slot has no remaining capacity'335 |       }, { status: 400 });336 |     }337 | 338 |     const userPackage = await prisma.userPackage.findUnique({339 |       where: { id: userPackageId },340 |       include: {341 |         packagePrice: {342 |           include: {343 |             packageDefinition: {344 |               include: {345 |                 sessionDuration: true346 |               }347 |             }348 |           }349 |         }350 |       }351 |     });352 | 353 |     if (!userPackage) {354 |       return NextResponse.json({355 |         success: false,356 |         error: 'User package not found',357 |         message: 'The specified user package does not exist'358 |       }, { status: 404 });359 |     }360 | 361 |     if (!userPackage.isActive) {362 |       return NextResponse.json({363 |         success: false,364 |         error: 'Package inactive',365 |         message: 'This user package is not active'366 |       }, { status: 400 });367 |     }368 | 369 |     if (userPackage.userId !== userId) {370 |       return NextResponse.json({371 |         success: false,372 |         error: 'Package mismatch',373 |         message: 'This user package does not belong to the specified user'374 |       }, { status: 400 });375 |     }376 | 377 |     const totalSessions = userPackage.packagePrice.packageDefinition.sessionsCount * (userPackage.quantity || 1);378 |     const remainingSessions = totalSessions - (userPackage.sessionsUsed || 0);379 | 380 |     if (remainingSessions <= 0) {381 |       return NextResponse.json({382 |         success: false,383 |         error: 'No sessions remaining',384 |         message: 'This user package has no remaining sessions'385 |       }, { status: 400 });386 |     }387 | 388 |     const result = await prisma.$transaction(async (tx) => {389 | 390 |       const booking = await tx.booking.create({391 |         data: {392 |           userId,393 |           userPackageId,394 |           scheduleSlotId,395 |           sessionType,396 |           notes,397 |           status: 'confirmed'398 |         }399 |       });400 | 401 |       await tx.userPackage.update({402 |         where: { id: userPackageId },403 |         data: {404 |           sessionsUsed: (userPackage.sessionsUsed || 0) + 1405 |         }406 |       });407 | 408 |       await tx.scheduleSlot.update({409 |         where: { id: scheduleSlotId },410 |         data: {411 |           bookedCount: (scheduleSlot.bookedCount || 0) + 1412 |         }413 |       });414 | 415 |       return booking;416 |     });417 | 418 |     const completeBooking = await prisma.booking.findUnique({419 |       where: { id: result.id },420 |       include: {421 |         user: {422 |           select: {423 |             id: true,424 |             email: true,425 |             fullName: true,426 |             phone: true427 |           }428 |         },429 |         userPackage: {430 |           include: {431 |             packagePrice: {432 |               include: {433 |                 packageDefinition: {434 |                   include: {435 |                     sessionDuration: true436 |                   }437 |                 }438 |               }439 |             }440 |           }441 |         },442 |         scheduleSlot: {443 |           include: {444 |             scheduleTemplate: {445 |               include: {446 |                 sessionDuration: true447 |               }448 |             }449 |           }450 |         }451 |       }452 |     });453 | 454 |     try {455 | 456 |       const bookingTemplate = await prisma.communicationTemplate.findFirst({457 |         where: {458 |           templateKey: 'booking_confirmation',459 |           type: 'email',460 |           isActive: true461 |         },462 |         include: {463 |           translations: true464 |         }465 |       });466 | 467 |       if (bookingTemplate && targetUser.email && completeBooking) {468 | 469 |         const templateData = {470 |           userName: targetUser.fullName || 'User',471 |           userEmail: targetUser.email || '',472 |           bookingId: completeBooking.id.toString(),473 |           language: targetUser.language || 'English',474 |           adminEmail: 'admin@soulpath.lat',475 |           submissionDate: new Date().toLocaleDateString(),476 |           birthDate: targetUser.birthDate?.toISOString().split('T')[0] || '',477 |           birthTime: targetUser.birthTime?.toString().substring(0, 5) || '',478 |           birthPlace: targetUser.birthPlace || '',479 |           clientQuestion: notes || 'No specific question provided',480 |           bookingDate: completeBooking.scheduleSlot.scheduleTemplate.dayOfWeek,481 |           bookingTime: completeBooking.scheduleSlot.startTime,482 |           sessionType: sessionType483 |         };484 | 485 |         const userLanguage = targetUser.language?.toLowerCase() || 'en';486 |         const translation = bookingTemplate.translations.find(t =>487 |           t.language === userLanguage488 |         ) || bookingTemplate.translations[0];489 | 490 |         if (translation) {491 | 492 |           const subject = replacePlaceholders(translation.subject || '', templateData);493 |           const content = replacePlaceholders(translation.content || '', templateData);494 | 495 |           + '...'496 |           });497 |         }498 |       }499 |     } catch (templateError) {500 | 501 |     }502 | 503 |     return NextResponse.json({504 |       success: true,505 |       message: 'Booking created successfully',506 |       data: completeBooking507 |     }, { status: 201 });508 | 509 |   } catch (error) {510 |     return NextResponse.json({511 |       success: false,512 |       error: 'Internal server error',513 |       message: 'Failed to create booking',514 |       details: error instanceof Error ? error.message : 'Unknown error'515 |     }, { status: 500 });516 |   } finally {517 |     await prisma.$disconnect();518 |   }519 | }520 | 521 | export async function PUT(request: NextRequest) {522 |   try {523 |     const user = await requireAuth(request);524 |     if (!user) {525 |       return NextResponse.json({526 |         success: false,527 |         error: 'Unauthorized',528 |         message: 'Authentication required'529 |       }, { status: 401 });530 |     }531 | 532 |     const body = await request.json();533 |     const validation = updateBookingSchema.safeParse(body);534 | 535 |     if (!validation.success) {536 |       return NextResponse.json({537 |         success: false,538 |         error: 'Validation failed',539 |         message: 'Invalid booking update data',540 |         details: validation.error.issues541 |       }, { status: 400 });542 |     }543 | 544 |     const { id, ...updateData } = validation.data;545 | 546 |     const existingBooking = await prisma.booking.findUnique({547 |       where: { id },548 |       include: {549 |         userPackage: {550 |           select: {551 |             id: true,552 |             sessionsUsed: true553 |           }554 |         },555 |         scheduleSlot: {556 |           select: {557 |             id: true,558 |             bookedCount: true559 |           }560 |         }561 |       }562 |     });563 | 564 |     if (!existingBooking) {565 |       return NextResponse.json({566 |         success: false,567 |         error: 'Booking not found',568 |         message: 'The specified booking does not exist'569 |       }, { status: 404 });570 |     }571 | 572 |     if (updateData.status === 'cancelled' && existingBooking.status !== 'cancelled') {573 | 574 |       await prisma.$transaction(async (tx) => {575 | 576 |         if (existingBooking.userPackage) {577 |           await tx.userPackage.update({578 |             where: { id: existingBooking.userPackage.id },579 |             data: { sessionsUsed: { decrement: 1 } }580 |           });581 |         }582 | 583 |         if (existingBooking.scheduleSlot) {584 |           await tx.scheduleSlot.update({585 |             where: { id: existingBooking.scheduleSlot.id },586 |             data: { bookedCount: { decrement: 1 } }587 |           });588 |         }589 |       });590 |     }591 | 592 |     const updatedBooking = await prisma.booking.update({593 |       where: { id },594 |       data: {595 |         status: updateData.status,596 |         notes: updateData.notes,597 |         cancelledReason: updateData.cancelledReason,598 |         reminderSent: updateData.reminderSent599 |       },600 |       include: {601 |         user: {602 |           select: {603 |             id: true,604 |             email: true,605 |             fullName: true606 |           }607 |         },608 |         scheduleSlot: {609 |           select: {610 |             id: true,611 |             startTime: true,612 |             endTime: true,613 |             capacity: true,614 |             bookedCount: true,615 |             scheduleTemplate: {616 |               select: {617 |                 dayOfWeek: true,618 |                 sessionDuration: {619 |                   select: {620 |                     name: true,621 |                     duration_minutes: true622 |                   }623 |                 }624 |               }625 |             }626 |           }627 |         },628 |         userPackage: {629 |           select: {630 |             id: true,631 |             sessionsUsed: true,632 |             packagePrice: {633 |               select: {634 |                 packageDefinition: {635 |                   select: {636 |                     name: true,637 |                     sessionsCount: true638 |                   }639 |                 }640 |               }641 |             }642 |           }643 |         }644 |       }645 |     });646 | 647 |     return NextResponse.json({648 |       success: true,649 |       message: 'Booking updated successfully',650 |       data: updatedBooking651 |     });652 | 653 |   } catch (error) {654 |     return NextResponse.json({655 |       success: false,656 |       error: 'Internal server error',657 |       message: 'An unexpected error occurred'658 |     }, { status: 500 });659 |   }660 | }661 | 662 | export async function DELETE(request: NextRequest) {663 |   try {664 |     const user = await requireAuth(request);665 |     if (!user) {666 |       return NextResponse.json({667 |         success: false,668 |         error: 'Unauthorized',669 |         message: 'Authentication required'670 |       }, { status: 401 });671 |     }672 | 673 |     const { searchParams } = new URL(request.url);674 |     const id = searchParams.get('id');675 | 676 |     if (!id) {677 |       return NextResponse.json({678 |         success: false,679 |         error: 'Missing ID',680 |         message: 'Booking ID is required'681 |       }, { status: 400 });682 |     }683 | 684 |     const existingBooking = await prisma.booking.findUnique({685 |       where: { id: parseInt(id) },686 |       include: {687 |         userPackage: {688 |           select: {689 |             id: true,690 |             sessionsUsed: true691 |           }692 |         },693 |         scheduleSlot: {694 |           select: {695 |             id: true,696 |             bookedCount: true697 |           }698 |         }699 |       }700 |     });701 | 702 |     if (!existingBooking) {703 |       return NextResponse.json({704 |         success: false,705 |         error: 'Booking not found',706 |         message: 'The specified booking does not exist'707 |       }, { status: 404 });708 |     }709 | 710 |     await prisma.$transaction(async (tx) => {711 | 712 |       if (existingBooking.userPackage && existingBooking.status !== 'cancelled') {713 |         await tx.userPackage.update({714 |           where: { id: existingBooking.userPackage.id },715 |           data: { sessionsUsed: { decrement: 1 } }716 |         });717 |       }718 | 719 |       if (existingBooking.scheduleSlot && existingBooking.status !== 'cancelled') {720 |         await tx.scheduleSlot.update({721 |           where: { id: existingBooking.scheduleSlot.id },722 |           data: { bookedCount: { decrement: 1 } }723 |         });724 |       }725 | 726 |       await tx.booking.delete({727 |         where: { id: parseInt(id) }728 |       });729 |     });730 | 731 |     return NextResponse.json({732 |       success: true,733 |       message: 'Booking deleted successfully'734 |     });735 | 736 |   } catch (error) {737 |     return NextResponse.json({738 |       success: false,739 |       error: 'Internal server error',740 |       message: 'An unexpected error occurred'741 |     }, { status: 500 });742 |   }743 | }
============================================================END: frontend/app/api/admin/bookings/route.ts============================================================


============================================================FILE: frontend/app/api/admin/bookings/stats/route.tsSIZE: 3.31 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | export async function GET(request: NextRequest) { 11 |   try { 12 |     const user = await requireAuth(request); 13 |     if (!user) { 14 |       return NextResponse.json({ 15 |         success: false, 16 |         error: 'Unauthorized', 17 |         message: 'Authentication required' 18 |       }, { status: 401 }); 19 |     } 20 |  21 |     const today = new Date().toISOString().split('T')[0]; 22 |  23 |     const [ 24 |       groupBookingsResult, 25 |       sessionUsageResult, 26 |       todayGroupBookingsResult, 27 |       todaySessionUsageResult 28 |     ] = await Promise.all([ 29 |  30 |       supabase 31 |         .from('group_bookings') 32 |         .select('*', { count: 'exact', head: true }), 33 |  34 |       supabase 35 |         .from('session_usage') 36 |         .select('*', { count: 'exact', head: true }), 37 |  38 |       supabase 39 |         .from('group_bookings') 40 |         .select('*', { count: 'exact', head: true }) 41 |         .eq('session_date', today), 42 |  43 |       supabase 44 |         .from('session_usage') 45 |         .select('*', { count: 'exact', head: true }) 46 |         .eq('session_date', today) 47 |     ]); 48 |  49 |     const [activeGroupBookings, activeSessionUsage] = await Promise.all([ 50 |       supabase 51 |         .from('group_bookings') 52 |         .select('*', { count: 'exact', head: true }) 53 |         .eq('status', 'confirmed'), 54 |  55 |       supabase 56 |         .from('session_usage') 57 |         .select('*', { count: 'exact', head: true }) 58 |         .eq('status', 'completed') 59 |     ]); 60 |  61 |     const [completedGroupBookings, completedSessionUsage] = await Promise.all([ 62 |       supabase 63 |         .from('group_bookings') 64 |         .select('total_cost') 65 |         .eq('status', 'completed') 66 |         .not('total_cost', 'is', null), 67 |  68 |       supabase 69 |         .from('session_usage') 70 |         .select('cost') 71 |         .eq('status', 'completed') 72 |         .not('cost', 'is', null) 73 |     ]); 74 |  75 |     const groupRevenue = (completedGroupBookings.data || []) 76 |       .reduce((sum, booking) => sum + (parseFloat(booking.total_cost) || 0), 0); 77 |  78 |     const sessionRevenue = (completedSessionUsage.data || []) 79 |       .reduce((sum, usage) => sum + (parseFloat(usage.cost) || 0), 0); 80 |  81 |     const totalRevenue = groupRevenue + sessionRevenue; 82 |  83 |     const stats = { 84 |       totalBookings: (groupBookingsResult.count || 0) + (sessionUsageResult.count || 0), 85 |       activeBookings: (activeGroupBookings.count || 0) + (activeSessionUsage.count || 0), 86 |       todayBookings: (todayGroupBookingsResult.count || 0) + (todaySessionUsageResult.count || 0), 87 |       totalRevenue: totalRevenue, 88 |       groupBookings: groupBookingsResult.count || 0, 89 |       individualBookings: sessionUsageResult.count || 0 90 |     }; 91 |  92 |     return NextResponse.json({ 93 |       success: true, 94 |       data: stats 95 |     }); 96 |  97 |   } catch { 98 |     return NextResponse.json({ 99 |       success: false,100 |       error: 'Internal server error',101 |       message: 'An unexpected error occurred'102 |     }, { status: 500 });103 |   }104 | }
============================================================END: frontend/app/api/admin/bookings/stats/route.ts============================================================


============================================================FILE: frontend/app/api/admin/bug-reports/[id]/archive/route.tsSIZE: 1.61 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 |   4 | export async function PATCH(  5 |   _request: NextRequest,  6 |   { params }: { params: { id: string } }  7 | ) {  8 |   try {  9 |     const supabase = await createServerClient(); 10 |  11 |     const { data: { user }, error: authError } = await supabase.auth.getUser(); 12 |  13 |     if (authError || !user) { 14 |       return NextResponse.json( 15 |         { error: 'Unauthorized' }, 16 |         { status: 401 } 17 |       ); 18 |     } 19 |  20 |     const { data: profile } = await supabase 21 |       .from('users') 22 |       .select('role') 23 |       .eq('id', user.id) 24 |       .single(); 25 |  26 |     if (profile?.role !== 'admin') { 27 |       return NextResponse.json( 28 |         { error: 'Admin access required' }, 29 |         { status: 403 } 30 |       ); 31 |     } 32 |  33 |     const { id } = params; 34 |  35 |     const { data: bugReport, error } = await supabase 36 |       .from('bug_reports') 37 |       .update({ 38 |         status: 'ARCHIVED', 39 |         archivedAt: new Date().toISOString() 40 |       }) 41 |       .eq('id', id) 42 |       .select() 43 |       .single(); 44 |  45 |     if (error) { 46 |       return NextResponse.json( 47 |         { error: 'Failed to archive bug report' }, 48 |         { status: 500 } 49 |       ); 50 |     } 51 |  52 |     return NextResponse.json({ 53 |       success: true, 54 |       bugReport, 55 |       message: 'Bug report archived successfully' 56 |     }); 57 |  58 |   } catch (error) { 59 |     return NextResponse.json( 60 |       { error: 'Internal server error' }, 61 |       { status: 500 } 62 |     ); 63 |   } 64 | }
============================================================END: frontend/app/api/admin/bug-reports/[id]/archive/route.ts============================================================


============================================================FILE: frontend/app/api/admin/bug-reports/[id]/assign/route.tsSIZE: 1.66 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 |   4 | export async function PATCH(  5 |   request: NextRequest,  6 |   { params }: { params: { id: string } }  7 | ) {  8 |   try {  9 |     const supabase = await createServerClient(); 10 |  11 |     const { data: { user }, error: authError } = await supabase.auth.getUser(); 12 |  13 |     if (authError || !user) { 14 |       return NextResponse.json( 15 |         { error: 'Unauthorized' }, 16 |         { status: 401 } 17 |       ); 18 |     } 19 |  20 |     const { data: profile } = await supabase 21 |       .from('users') 22 |       .select('role') 23 |       .eq('id', user.id) 24 |       .single(); 25 |  26 |     if (profile?.role !== 'admin') { 27 |       return NextResponse.json( 28 |         { error: 'Admin access required' }, 29 |         { status: 403 } 30 |       ); 31 |     } 32 |  33 |     const { id } = params; 34 |     const body = await request.json(); 35 |     const { assigneeId } = body; 36 |  37 |     const { data: bugReport, error } = await supabase 38 |       .from('bug_reports') 39 |       .update({ assignedTo: assigneeId }) 40 |       .eq('id', id) 41 |       .select() 42 |       .single(); 43 |  44 |     if (error) { 45 |       return NextResponse.json( 46 |         { error: 'Failed to update bug report assignment' }, 47 |         { status: 500 } 48 |       ); 49 |     } 50 |  51 |     return NextResponse.json({ 52 |       success: true, 53 |       bugReport, 54 |       message: 'Bug report assignment updated successfully' 55 |     }); 56 |  57 |   } catch (error) { 58 |     return NextResponse.json( 59 |       { error: 'Internal server error' }, 60 |       { status: 500 } 61 |     ); 62 |   } 63 | }
============================================================END: frontend/app/api/admin/bug-reports/[id]/assign/route.ts============================================================


============================================================FILE: frontend/app/api/admin/bug-reports/[id]/comments/route.tsSIZE: 1.88 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 |   4 | export async function POST(  5 |   request: NextRequest,  6 |   { params }: { params: { id: string } }  7 | ) {  8 |   try {  9 |     const supabase = await createServerClient(); 10 |  11 |     const { data: { user }, error: authError } = await supabase.auth.getUser(); 12 |  13 |     if (authError || !user) { 14 |       return NextResponse.json( 15 |         { error: 'Unauthorized' }, 16 |         { status: 401 } 17 |       ); 18 |     } 19 |  20 |     const { data: profile } = await supabase 21 |       .from('users') 22 |       .select('role') 23 |       .eq('id', user.id) 24 |       .single(); 25 |  26 |     if (profile?.role !== 'admin') { 27 |       return NextResponse.json( 28 |         { error: 'Admin access required' }, 29 |         { status: 403 } 30 |       ); 31 |     } 32 |  33 |     const { id } = params; 34 |     const body = await request.json(); 35 |     const { content } = body; 36 |  37 |     if (!content || !content.trim()) { 38 |       return NextResponse.json( 39 |         { error: 'Comment content is required' }, 40 |         { status: 400 } 41 |       ); 42 |     } 43 |  44 |     const { data: comment, error } = await supabase 45 |       .from('bug_comments') 46 |       .insert({ 47 |         content: content.trim(), 48 |         authorId: user.id, 49 |         bugReportId: id 50 |       }) 51 |       .select(` 52 |         *, 53 |         author:users!bug_comments_author_id_fkey(id, fullName, email) 54 |       `) 55 |       .single(); 56 |  57 |     if (error) { 58 |       return NextResponse.json( 59 |         { error: 'Failed to add comment' }, 60 |         { status: 500 } 61 |       ); 62 |     } 63 |  64 |     return NextResponse.json({ 65 |       success: true, 66 |       comment, 67 |       message: 'Comment added successfully' 68 |     }); 69 |  70 |   } catch (error) { 71 |     return NextResponse.json( 72 |       { error: 'Internal server error' }, 73 |       { status: 500 } 74 |     ); 75 |   } 76 | }
============================================================END: frontend/app/api/admin/bug-reports/[id]/comments/route.ts============================================================


============================================================FILE: frontend/app/api/admin/bug-reports/[id]/status/route.tsSIZE: 2.02 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 |   4 | interface BugReportUpdateData {  5 |   status: string;  6 |   resolvedAt?: string;  7 | }  8 |   9 | export async function PATCH( 10 |   request: NextRequest, 11 |   { params }: { params: { id: string } } 12 | ) { 13 |   try { 14 |     const supabase = await createServerClient(); 15 |  16 |     const { data: { user }, error: authError } = await supabase.auth.getUser(); 17 |  18 |     if (authError || !user) { 19 |       return NextResponse.json( 20 |         { error: 'Unauthorized' }, 21 |         { status: 401 } 22 |       ); 23 |     } 24 |  25 |     const { data: profile } = await supabase 26 |       .from('users') 27 |       .select('role') 28 |       .eq('id', user.id) 29 |       .single(); 30 |  31 |     if (profile?.role !== 'admin') { 32 |       return NextResponse.json( 33 |         { error: 'Admin access required' }, 34 |         { status: 403 } 35 |       ); 36 |     } 37 |  38 |     const { id } = params; 39 |     const body = await request.json(); 40 |     const { status } = body; 41 |  42 |     if (!status) { 43 |       return NextResponse.json( 44 |         { error: 'Status is required' }, 45 |         { status: 400 } 46 |       ); 47 |     } 48 |  49 |     const updateData: BugReportUpdateData = { status }; 50 |  51 |     if (status === 'RESOLVED') { 52 |       updateData.resolvedAt = new Date().toISOString(); 53 |     } 54 |  55 |     const { data: bugReport, error } = await supabase 56 |       .from('bug_reports') 57 |       .update(updateData) 58 |       .eq('id', id) 59 |       .select() 60 |       .single(); 61 |  62 |     if (error) { 63 |       return NextResponse.json( 64 |         { error: 'Failed to update bug report status' }, 65 |         { status: 500 } 66 |       ); 67 |     } 68 |  69 |     return NextResponse.json({ 70 |       success: true, 71 |       bugReport, 72 |       message: 'Bug report status updated successfully' 73 |     }); 74 |  75 |   } catch (error) { 76 |     return NextResponse.json( 77 |       { error: 'Internal server error' }, 78 |       { status: 500 } 79 |     ); 80 |   } 81 | }
============================================================END: frontend/app/api/admin/bug-reports/[id]/status/route.ts============================================================


============================================================FILE: frontend/app/api/admin/bug-reports/route.tsSIZE: 3.06 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import jwt from 'jsonwebtoken';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';  6 |   7 | export async function GET(request: NextRequest) {  8 |   try {  9 |  10 |     const authHeader = request.headers.get('authorization'); 11 |  12 |     if (!authHeader || !authHeader.startsWith('Bearer ')) { 13 |       return NextResponse.json( 14 |         { error: 'Unauthorized - No token provided' }, 15 |         { status: 401 } 16 |       ); 17 |     } 18 |  19 |     const token = authHeader.substring(7); 20 |  21 |     let decoded: { userId: string }; 22 |     try { 23 |       decoded = jwt.verify(token, JWT_SECRET) as { userId: string }; 24 |     } catch { 25 |       return NextResponse.json( 26 |         { error: 'Unauthorized - Invalid token' }, 27 |         { status: 401 } 28 |       ); 29 |     } 30 |  31 |     const user = await prisma.user.findUnique({ 32 |       where: { id: decoded.userId } 33 |     }); 34 |  35 |     if (!user) { 36 |       return NextResponse.json( 37 |         { error: 'Unauthorized - User not found' }, 38 |         { status: 401 } 39 |       ); 40 |     } 41 |  42 |     if (user.role !== 'admin') { 43 |       return NextResponse.json( 44 |         { error: 'Admin access required' }, 45 |         { status: 403 } 46 |       ); 47 |     } 48 |  49 |     const { searchParams } = new URL(request.url); 50 |     const status = searchParams.get('status'); 51 |     const priority = searchParams.get('priority'); 52 |     const category = searchParams.get('category'); 53 |     const search = searchParams.get('search'); 54 |  55 |     const where: Record<string, unknown> = {}; 56 |     if (status) where.status = status; 57 |     if (priority) where.priority = priority; 58 |     if (category) where.category = category; 59 |     if (search) { 60 |       where.OR = [ 61 |         { title: { contains: search, mode: 'insensitive' as const } }, 62 |         { description: { contains: search, mode: 'insensitive' as const } } 63 |       ]; 64 |     } 65 |  66 |     const bugReports = await prisma.bugReport.findMany({ 67 |       where, 68 |       include: { 69 |         reporter: { 70 |           select: { 71 |             id: true, 72 |             fullName: true, 73 |             email: true 74 |           } 75 |         }, 76 |         assignee: { 77 |           select: { 78 |             id: true, 79 |             fullName: true, 80 |             email: true 81 |           } 82 |         }, 83 |         comments: { 84 |           include: { 85 |             author: { 86 |               select: { 87 |                 id: true, 88 |                 fullName: true, 89 |                 email: true 90 |               } 91 |             } 92 |           }, 93 |           orderBy: { 94 |             createdAt: 'desc' 95 |           } 96 |         } 97 |       }, 98 |       orderBy: { 99 |         createdAt: 'desc'100 |       }101 |     });102 | 103 |     return NextResponse.json({104 |       success: true,105 |       bugReports106 |     });107 | 108 |   } catch (error) {109 |     return NextResponse.json(110 |       { error: 'Internal server error: ' + (error instanceof Error ? error.message : 'Unknown error') },111 |       { status: 500 }112 |     );113 |   } finally {114 |     await prisma.$disconnect();115 |   }116 | }
============================================================END: frontend/app/api/admin/bug-reports/route.ts============================================================


============================================================FILE: frontend/app/api/admin/communication/config/route.tsSIZE: 3.40 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { createAdminClient } from '@/lib/supabase/admin';  4 |   5 | export async function GET(request: NextRequest) {  6 |   try {  7 |     const user = await requireAuth(request);  8 |     if (!user) {  9 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 10 |     } 11 |  12 |     const supabase = createAdminClient(); 13 |  14 |     const { data, error } = await supabase 15 |       .from('communication_config') 16 |       .select('*') 17 |       .single(); 18 |  19 |     if (error) { 20 |  21 |       const defaultConfig = { 22 |         email_enabled: true, 23 |         brevo_api_key: '', 24 |         sender_email: 'noreply@matmax.store', 25 |         sender_name: 'MatMax Yoga Studio', 26 |         admin_email: 'admin@matmax.store', 27 |         sms_enabled: false, 28 |         sms_provider: 'labsmobile', 29 |         labsmobile_username: '', 30 |         labsmobile_token: '', 31 |         sms_sender_name: 'MatMax Yoga Studio' 32 |       }; 33 |  34 |       return NextResponse.json({ config: defaultConfig }); 35 |     } 36 |  37 |     return NextResponse.json({ config: data }); 38 |   } catch (error) { 39 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 40 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 41 |   } 42 | } 43 |  44 | export async function PUT(request: NextRequest) { 45 |   try { 46 |     const user = await requireAuth(request); 47 |     if (!user) { 48 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 49 |     } 50 |  51 |     const body = await request.json(); 52 |     const supabase = createAdminClient(); 53 |  54 |     const { data, error } = await supabase 55 |       .from('communication_config') 56 |       .upsert(body, { onConflict: 'id' }) 57 |       .select() 58 |       .single(); 59 |  60 |     if (error) { 61 |       return NextResponse.json({ 62 |         error: 'Communication configuration table does not exist. Please run the database setup first.', 63 |         details: error.message 64 |       }, { status: 500 }); 65 |     } 66 |  67 |     return NextResponse.json({ config: data }); 68 |   } catch (error) { 69 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 70 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 71 |   } 72 | }
============================================================END: frontend/app/api/admin/communication/config/route.ts============================================================


============================================================FILE: frontend/app/api/admin/communication/templates/[id]/route.tsSIZE: 7.80 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const templateTranslationSchema = z.object({  7 |   language: z.string().min(2, 'Language code is required'),  8 |   subject: z.string().optional(),  9 |   content: z.string().min(1, 'Content is required') 10 | }); 11 |  12 | const updateTemplateSchema = z.object({ 13 |   templateKey: z.string().min(1, 'Template key is required').optional(), 14 |   name: z.string().min(1, 'Template name is required').optional(), 15 |   description: z.string().optional(), 16 |   category: z.string().optional(), 17 |   isActive: z.boolean().optional(), 18 |   isDefault: z.boolean().optional(), 19 |   translations: z.array(templateTranslationSchema).optional() 20 | }); 21 |  22 | export async function GET( 23 |   request: NextRequest, 24 |   { params }: { params: { id: string } } 25 | ) { 26 |   try { 27 |     const user = await requireAuth(request); 28 |     if (!user || user.role !== 'admin') { 29 |       return NextResponse.json({ 30 |         success: false, 31 |         error: 'Unauthorized', 32 |         message: 'Admin access required' 33 |       }, { status: 401 }); 34 |     } 35 |  36 |     const id = parseInt(params.id); 37 |     if (isNaN(id)) { 38 |       return NextResponse.json({ 39 |         success: false, 40 |         error: 'Invalid template ID', 41 |         message: 'Template ID must be a number' 42 |       }, { status: 400 }); 43 |     } 44 |  45 |     const template = await prisma.communicationTemplate.findUnique({ 46 |       where: { id }, 47 |       include: { 48 |         translations: { 49 |           orderBy: { language: 'asc' } 50 |         } 51 |       } 52 |     }); 53 |  54 |     if (!template) { 55 |       return NextResponse.json({ 56 |         success: false, 57 |         error: 'Template not found', 58 |         message: 'Template with this ID does not exist' 59 |       }, { status: 404 }); 60 |     } 61 |  62 |     return NextResponse.json({ 63 |       success: true, 64 |       template 65 |     }); 66 |  67 |   } catch (error) { 68 |     return NextResponse.json({ 69 |       success: false, 70 |       error: 'Internal server error', 71 |       message: 'Failed to fetch template' 72 |     }, { status: 500 }); 73 |   } finally { 74 |     await prisma.$disconnect(); 75 |   } 76 | } 77 |  78 | export async function PUT( 79 |   request: NextRequest, 80 |   { params }: { params: { id: string } } 81 | ) { 82 |   try { 83 |     const user = await requireAuth(request); 84 |     if (!user || user.role !== 'admin') { 85 |       return NextResponse.json({ 86 |         success: false, 87 |         error: 'Unauthorized', 88 |         message: 'Admin access required' 89 |       }, { status: 401 }); 90 |     } 91 |  92 |     const id = parseInt(params.id); 93 |     if (isNaN(id)) { 94 |       return NextResponse.json({ 95 |         success: false, 96 |         error: 'Invalid template ID', 97 |         message: 'Template ID must be a number' 98 |       }, { status: 400 }); 99 |     }100 | 101 |     const body = await request.json();102 |     const validation = updateTemplateSchema.safeParse(body);103 | 104 |     if (!validation.success) {105 |       return NextResponse.json({106 |         success: false,107 |         error: 'Invalid template data',108 |         details: validation.error.issues109 |       }, { status: 400 });110 |     }111 | 112 |     const updateData = validation.data;113 | 114 |     const existingTemplate = await prisma.communicationTemplate.findUnique({115 |       where: { id }116 |     });117 | 118 |     if (!existingTemplate) {119 |       return NextResponse.json({120 |         success: false,121 |         error: 'Template not found',122 |         message: 'Template with this ID does not exist'123 |       }, { status: 404 });124 |     }125 | 126 |     if (updateData.templateKey && updateData.templateKey !== existingTemplate.templateKey) {127 |       const keyExists = await prisma.communicationTemplate.findFirst({128 |         where: {129 |           templateKey: updateData.templateKey,130 |           id: { not: id }131 |         }132 |       });133 | 134 |       if (keyExists) {135 |         return NextResponse.json({136 |           success: false,137 |           error: 'Template key already exists',138 |           message: 'A template with this key already exists'139 |         }, { status: 400 });140 |       }141 |     }142 | 143 |     if (updateData.isDefault) {144 |       await prisma.communicationTemplate.updateMany({145 |         where: {146 |           type: existingTemplate.type,147 |           isDefault: true,148 |           id: { not: id }149 |         },150 |         data: { isDefault: false }151 |       });152 |     }153 | 154 |     const template = await prisma.communicationTemplate.update({155 |       where: { id },156 |       data: {157 |         templateKey: updateData.templateKey,158 |         name: updateData.name,159 |         description: updateData.description,160 |         category: updateData.category,161 |         isActive: updateData.isActive,162 |         isDefault: updateData.isDefault163 |       },164 |       include: {165 |         translations: {166 |           orderBy: { language: 'asc' }167 |         }168 |       }169 |     });170 | 171 |     if (updateData.translations) {172 | 173 |       await prisma.communicationTemplateTranslation.deleteMany({174 |         where: { templateId: id }175 |       });176 | 177 |       await prisma.communicationTemplateTranslation.createMany({178 |         data: updateData.translations.map(translation => ({179 |           templateId: id,180 |           language: translation.language,181 |           subject: translation.subject,182 |           content: translation.content183 |         }))184 |       });185 | 186 |       const updatedTemplate = await prisma.communicationTemplate.findUnique({187 |         where: { id },188 |         include: {189 |           translations: {190 |             orderBy: { language: 'asc' }191 |           }192 |         }193 |       });194 | 195 |       return NextResponse.json({196 |         success: true,197 |         template: updatedTemplate,198 |         message: 'Template updated successfully'199 |       });200 |     }201 | 202 |     return NextResponse.json({203 |       success: true,204 |       template,205 |       message: 'Template updated successfully'206 |     });207 | 208 |   } catch (error) {209 |     return NextResponse.json({210 |       success: false,211 |       error: 'Internal server error',212 |       message: 'Failed to update template'213 |     }, { status: 500 });214 |   } finally {215 |     await prisma.$disconnect();216 |   }217 | }218 | 219 | export async function DELETE(220 |   request: NextRequest,221 |   { params }: { params: { id: string } }222 | ) {223 |   try {224 |     const user = await requireAuth(request);225 |     if (!user || user.role !== 'admin') {226 |       return NextResponse.json({227 |         success: false,228 |         error: 'Unauthorized',229 |         message: 'Admin access required'230 |       }, { status: 401 });231 |     }232 | 233 |     const id = parseInt(params.id);234 |     if (isNaN(id)) {235 |       return NextResponse.json({236 |         success: false,237 |         error: 'Invalid template ID',238 |         message: 'Template ID must be a number'239 |       }, { status: 400 });240 |     }241 | 242 |     const existingTemplate = await prisma.communicationTemplate.findUnique({243 |       where: { id }244 |     });245 | 246 |     if (!existingTemplate) {247 |       return NextResponse.json({248 |         success: false,249 |         error: 'Template not found',250 |         message: 'Template with this ID does not exist'251 |       }, { status: 404 });252 |     }253 | 254 |     if (existingTemplate.isDefault) {255 |       return NextResponse.json({256 |         success: false,257 |         error: 'Cannot delete default template',258 |         message: 'Default templates cannot be deleted'259 |       }, { status: 400 });260 |     }261 | 262 |     await prisma.communicationTemplate.delete({263 |       where: { id }264 |     });265 | 266 |     return NextResponse.json({267 |       success: true,268 |       message: 'Template deleted successfully'269 |     });270 | 271 |   } catch (error) {272 |     return NextResponse.json({273 |       success: false,274 |       error: 'Internal server error',275 |       message: 'Failed to delete template'276 |     }, { status: 500 });277 |   } finally {278 |     await prisma.$disconnect();279 |   }280 | }
============================================================END: frontend/app/api/admin/communication/templates/[id]/route.ts============================================================


============================================================FILE: frontend/app/api/admin/communication/templates/route.tsSIZE: 5.16 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | interface CommunicationTemplateWhereClause {  7 |   type?: string;  8 |   category?: string;  9 |   isActive?: boolean; 10 | } 11 |  12 | const templateTranslationSchema = z.object({ 13 |   language: z.string().min(2, 'Language code is required'), 14 |   subject: z.string().optional(), 15 |   content: z.string().min(1, 'Content is required') 16 | }); 17 |  18 | const createTemplateSchema = z.object({ 19 |   templateKey: z.string().min(1, 'Template key is required'), 20 |   name: z.string().min(1, 'Template name is required'), 21 |   description: z.string().optional(), 22 |   type: z.enum(['email', 'sms']), 23 |   category: z.string().optional(), 24 |   translations: z.array(templateTranslationSchema).min(1, 'At least one translation is required') 25 | }); 26 |  27 | const querySchema = z.object({ 28 |   type: z.enum(['email', 'sms']).optional(), 29 |   category: z.string().optional(), 30 |   isActive: z.enum(['true', 'false']).optional(), 31 |   page: z.coerce.number().int().min(1).default(1), 32 |   limit: z.coerce.number().int().min(1).max(100).default(20) 33 | }); 34 |  35 | export async function GET(request: NextRequest) { 36 |   try { 37 |     const user = await requireAuth(request); 38 |     if (!user || user.role !== 'admin') { 39 |       return NextResponse.json({ 40 |         success: false, 41 |         error: 'Unauthorized', 42 |         message: 'Admin access required' 43 |       }, { status: 401 }); 44 |     } 45 |  46 |     const { searchParams } = new URL(request.url); 47 |     const queryParams = Object.fromEntries(searchParams.entries()); 48 |     const validation = querySchema.safeParse(queryParams); 49 |  50 |     if (!validation.success) { 51 |       return NextResponse.json({ 52 |         success: false, 53 |         error: 'Invalid query parameters', 54 |         details: validation.error.issues 55 |       }, { status: 400 }); 56 |     } 57 |  58 |     const { type, category, isActive, page, limit } = validation.data; 59 |     const offset = (page - 1) * limit; 60 |  61 |     const where: CommunicationTemplateWhereClause = {}; 62 |     if (type) where.type = type; 63 |     if (category) where.category = category; 64 |     if (isActive !== undefined) where.isActive = isActive === 'true'; 65 |  66 |     const templates = await prisma.communicationTemplate.findMany({ 67 |       where, 68 |       include: { 69 |         translations: { 70 |           orderBy: { language: 'asc' } 71 |         } 72 |       }, 73 |       skip: offset, 74 |       take: limit, 75 |       orderBy: [ 76 |         { isDefault: 'desc' }, 77 |         { name: 'asc' } 78 |       ] 79 |     }); 80 |  81 |     const totalCount = await prisma.communicationTemplate.count({ where }); 82 |     const totalPages = Math.ceil(totalCount / limit); 83 |  84 |     return NextResponse.json({ 85 |       success: true, 86 |       templates, 87 |       pagination: { 88 |         page, 89 |         limit, 90 |         total: totalCount, 91 |         totalPages 92 |       } 93 |     }); 94 |  95 |   } catch (error) { 96 |     return NextResponse.json({ 97 |       success: false, 98 |       error: 'Internal server error', 99 |       message: 'Failed to fetch templates'100 |     }, { status: 500 });101 |   } finally {102 |     await prisma.$disconnect();103 |   }104 | }105 | 106 | export async function POST(request: NextRequest) {107 |   try {108 |     const user = await requireAuth(request);109 |     if (!user || user.role !== 'admin') {110 |       return NextResponse.json({111 |         success: false,112 |         error: 'Unauthorized',113 |         message: 'Admin access required'114 |       }, { status: 401 });115 |     }116 | 117 |     const body = await request.json();118 |     const validation = createTemplateSchema.safeParse(body);119 | 120 |     if (!validation.success) {121 |       return NextResponse.json({122 |         success: false,123 |         error: 'Invalid template data',124 |         details: validation.error.issues125 |       }, { status: 400 });126 |     }127 | 128 |     const templateData = validation.data;129 | 130 |     const existingTemplate = await prisma.communicationTemplate.findFirst({131 |       where: { templateKey: templateData.templateKey }132 |     });133 | 134 |     if (existingTemplate) {135 |       return NextResponse.json({136 |         success: false,137 |         error: 'Template key already exists',138 |         message: 'A template with this key already exists'139 |       }, { status: 400 });140 |     }141 | 142 |     const template = await prisma.communicationTemplate.create({143 |       data: {144 |         templateKey: templateData.templateKey,145 |         name: templateData.name,146 |         description: templateData.description,147 |         type: templateData.type,148 |         category: templateData.category,149 |         isActive: true,150 |         isDefault: false,151 |         translations: {152 |           create: templateData.translations.map(translation => ({153 |             language: translation.language,154 |             subject: translation.subject,155 |             content: translation.content156 |           }))157 |         }158 |       },159 |       include: {160 |         translations: true161 |       }162 |     });163 | 164 |     return NextResponse.json({165 |       success: true,166 |       template,167 |       message: 'Template created successfully'168 |     });169 | 170 |   } catch (error) {171 |     return NextResponse.json({172 |       success: false,173 |       error: 'Internal server error',174 |       message: 'Failed to create template'175 |     }, { status: 500 });176 |   } finally {177 |     await prisma.$disconnect();178 |   }179 | }
============================================================END: frontend/app/api/admin/communication/templates/route.ts============================================================


============================================================FILE: frontend/app/api/admin/communication/test/route.tsSIZE: 6.14 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { createAdminClient } from '@/lib/supabase/admin';  4 | import { z } from 'zod';  5 |   6 | interface TestEmailData {  7 |   to: string;  8 |   subject: string;  9 |   content: string; 10 | } 11 |  12 | interface TestSmsData { 13 |   phoneNumber: string; 14 |   message: string; 15 | } 16 |  17 | const testEmailSchema = z.object({ 18 |   to: z.string().email('Invalid email address'), 19 |   subject: z.string().min(1, 'Subject is required'), 20 |   content: z.string().min(1, 'Content is required') 21 | }); 22 |  23 | const testSmsSchema = z.object({ 24 |   phoneNumber: z.string().min(1, 'Phone number is required'), 25 |   message: z.string().min(1, 'Message is required') 26 | }); 27 |  28 | export async function POST(request: NextRequest) { 29 |   try { 30 |     const user = await requireAuth(request); 31 |     if (!user) { 32 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 33 |     } 34 |  35 |     const body = await request.json(); 36 |     const { type } = body; 37 |  38 |     if (type === 'email') { 39 |       return await testEmail(request, body); 40 |     } else if (type === 'sms') { 41 |       return await testSms(request, body); 42 |     } else { 43 |       return NextResponse.json({ 44 |         error: 'Invalid test type', 45 |         message: 'Type must be either "email" or "sms"' 46 |       }, { status: 400 }); 47 |     } 48 |   } catch (error) { 49 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 50 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 51 |   } 52 | } 53 |  54 | async function testEmail(_request: NextRequest, body: TestEmailData) { 55 |   try { 56 |  57 |     const validation = testEmailSchema.safeParse(body); 58 |     if (!validation.success) { 59 |       return NextResponse.json({ 60 |         error: 'Validation failed', 61 |         details: validation.error.issues 62 |       }, { status: 400 }); 63 |     } 64 |  65 |     const { to, subject, content } = validation.data; 66 |  67 |     const supabase = createAdminClient(); 68 |     const { data: config, error: configError } = await supabase 69 |       .from('communication_config') 70 |       .select('brevo_api_key, sender_email, sender_name') 71 |       .single(); 72 |  73 |     if (configError || !config?.brevo_api_key) { 74 |       return NextResponse.json({ 75 |         error: 'Email configuration not found', 76 |         message: 'Please configure your Brevo API key first' 77 |       }, { status: 400 }); 78 |     } 79 |  80 |     const emailData = { 81 |       sender: { 82 |         name: config.sender_name || 'SoulPath', 83 |         email: config.sender_email || 'noreply@soulpath.lat' 84 |       }, 85 |       to: [{ email: to }], 86 |       subject: subject, 87 |       htmlContent: content 88 |     }; 89 |  90 |     const response = await fetch('https: 91 |       method: 'POST', 92 |       headers: { 93 |         'Content-Type': 'application/json', 94 |         'api-key': config.brevo_api_key 95 |       }, 96 |       body: JSON.stringify(emailData) 97 |     }); 98 |  99 |     if (!response.ok) {100 |       const errorData = await response.json();101 |       return NextResponse.json({102 |         error: 'Failed to send test email',103 |         details: errorData.message || 'Unknown error from Brevo API'104 |       }, { status: 500 });105 |     }106 | 107 |     const result = await response.json();108 |     return NextResponse.json({109 |       success: true,110 |       message: 'Test email sent successfully',111 |       messageId: result.messageId112 |     });113 |   } catch (error) {114 |     return NextResponse.json({115 |       error: 'Failed to send test email',116 |       details: error instanceof Error ? error.message : 'Unknown error'117 |     }, { status: 500 });118 |   }119 | }120 | 121 | async function testSms(_request: NextRequest, body: TestSmsData) {122 |   try {123 | 124 |     const validation = testSmsSchema.safeParse(body);125 |     if (!validation.success) {126 |       return NextResponse.json({127 |         error: 'Validation failed',128 |         details: validation.error.issues129 |       }, { status: 400 });130 |     }131 | 132 |     const { phoneNumber, message } = validation.data;133 | 134 |     const supabase = createAdminClient();135 |     const { data: config, error: configError } = await supabase136 |       .from('communication_config')137 |       .select('labsmobile_username, labsmobile_token, sms_sender_name')138 |       .single();139 | 140 |     if (configError || !config?.labsmobile_username || !config?.labsmobile_token) {141 |       return NextResponse.json({142 |         error: 'SMS configuration not found',143 |         message: 'Please configure your Labsmobile credentials first'144 |       }, { status: 400 });145 |     }146 | 147 |     const smsData = {148 |       message: message,149 |       tpoa: config.sms_sender_name || 'SoulPath',150 |       recipient: [{ msisdn: phoneNumber }]151 |     };152 | 153 |     const authHeader = Buffer.from(`${config.labsmobile_username}:${config.labsmobile_token}`).toString('base64');154 | 155 |     const response = await fetch('https:156 |       method: 'POST',157 |       headers: {158 |         'Content-Type': 'application/json',159 |         'Authorization': `Basic ${authHeader}`160 |       },161 |       body: JSON.stringify(smsData)162 |     });163 | 164 |     if (!response.ok) {165 |       const errorData = await response.json();166 |       return NextResponse.json({167 |         error: 'Failed to send test SMS',168 |         details: errorData.message || 'Unknown error from Labsmobile API'169 |       }, { status: 500 });170 |     }171 | 172 |     const result = await response.json();173 |     return NextResponse.json({174 |       success: true,175 |       message: 'Test SMS sent successfully',176 |       result: result177 |     });178 |   } catch (error) {179 |     return NextResponse.json({180 |       error: 'Failed to send test SMS',181 |       details: error instanceof Error ? error.message : 'Unknown error'182 |     }, { status: 500 });183 |   }184 | }
============================================================END: frontend/app/api/admin/communication/test/route.ts============================================================


============================================================FILE: frontend/app/api/admin/content/route.tsSIZE: 11.22 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 | import { revalidatePath, revalidateTag } from 'next/cache';  5 |   6 | export async function GET(request: NextRequest) {  7 |   const startTime = Date.now();  8 |   9 |   try { 10 |  11 |     const authPromise = requireAuth(request); 12 |     const timeoutPromise = new Promise((_, reject) => 13 |       setTimeout(() => reject(new Error('Authentication timeout')), 5000) 14 |     ); 15 |  16 |     const user = await Promise.race([authPromise, timeoutPromise]) as { email?: string } | null; 17 |  18 |     if (!user) { 19 |       return NextResponse.json({ 20 |         error: 'Unauthorized', 21 |         message: 'Authentication required' 22 |       }, { status: 401 }); 23 |     } 24 |  25 |     let content; 26 |     try { 27 |       content = await prisma.content.findFirst({ 28 |         select: { 29 |           id: true, 30 |           heroTitleEn: true, 31 |           heroTitleEs: true, 32 |           heroSubtitleEn: true, 33 |           heroSubtitleEs: true, 34 |           aboutTitleEn: true, 35 |           aboutTitleEs: true, 36 |           aboutContentEn: true, 37 |           aboutContentEs: true, 38 |           approachTitleEn: true, 39 |           approachTitleEs: true, 40 |           approachContentEn: true, 41 |           approachContentEs: true, 42 |           servicesTitleEn: true, 43 |           servicesTitleEs: true, 44 |           servicesContentEn: true, 45 |           servicesContentEs: true, 46 |           createdAt: true, 47 |           updatedAt: true 48 |         } 49 |       }); 50 |  51 |       if (content) { 52 |         .length, 'fields'); 53 |  54 |         const { updatedAt, ...cleanContent } = content; 55 |  56 |         return NextResponse.json({ 57 |           success: true, 58 |           content: cleanContent, 59 |           timestamp: new Date().toISOString(), 60 |           fieldsCount: Object.keys(cleanContent).length 61 |         }); 62 |       } 63 |     } catch (dbError) { 64 |  65 |     } 66 |  67 |     const defaultContent = { 68 |       heroTitleEn: 'MatMax Yoga Studio', 69 |       heroTitleEs: 'MatMax Yoga Studio', 70 |       heroSubtitleEn: 'Your journey to wellness starts here', 71 |       heroSubtitleEs: 'Tu camino al bienestar comienza aquí', 72 |       aboutTitleEn: 'About Us', 73 |       aboutTitleEs: 'Sobre Nosotros', 74 |       aboutContentEn: 'We are dedicated to helping you achieve your wellness goals.', 75 |       aboutContentEs: 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.', 76 |       approachTitleEn: 'Our Approach', 77 |       approachTitleEs: 'Nuestro Enfoque', 78 |       approachContentEn: 'We use a holistic approach to wellness.', 79 |       approachContentEs: 'Usamos un enfoque holístico para el bienestar.', 80 |       servicesTitleEn: 'Our Services', 81 |       servicesTitleEs: 'Nuestros Servicios', 82 |       servicesContentEn: 'Professional wellness services in a peaceful environment.', 83 |       servicesContentEs: 'Servicios profesionales de bienestar en un ambiente pacífico.' 84 |     }; 85 |  86 |     try { 87 |       await prisma.content.create({ data: defaultContent }); 88 |       } catch (createError) { 89 |       } 90 |  91 |     const processingTime = Date.now() - startTime; 92 |     return NextResponse.json({ 93 |       success: true, 94 |       content: defaultContent, 95 |       timestamp: new Date().toISOString(), 96 |       fieldsCount: Object.keys(defaultContent).length, 97 |       isDefault: true 98 |     }); 99 | 100 |   } catch (error) {101 |     const processingTime = Date.now() - startTime;102 |     :`, error);103 | 104 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';105 | 106 |     return NextResponse.json({107 |       error: 'Internal server error',108 |       message: errorMessage,109 |       timestamp: new Date().toISOString(),110 |       processingTime: `${processingTime}ms`111 |     }, { status: 500 });112 |   }113 | }114 | 115 | export async function PUT(request: NextRequest) {116 |   const startTime = Date.now();117 | 118 |   try {119 | 120 |     const authPromise = requireAuth(request);121 |     const timeoutPromise = new Promise((_, reject) =>122 |       setTimeout(() => reject(new Error('Authentication timeout')), 5000)123 |     );124 | 125 |     const user = await Promise.race([authPromise, timeoutPromise]) as { email?: string } | null;126 | 127 |     if (!user) {128 |       return NextResponse.json({129 |         error: 'Unauthorized',130 |         message: 'Authentication required'131 |       }, { status: 401 });132 |     }133 | 134 |     let body;135 |     try {136 |       body = await request.json();137 |     } catch (parseError) {138 |       return NextResponse.json({139 |         error: 'Invalid request format',140 |         message: 'Request body must be valid JSON'141 |       }, { status: 400 });142 |     }143 | 144 |     const { content } = body;145 |     if (!content || typeof content !== 'object') {146 |       return NextResponse.json({147 |         error: 'Invalid content data',148 |         message: 'Content must be a valid object'149 |       }, { status: 400 });150 |     }151 | 152 |     const requiredFields = [153 |       'heroTitleEn', 'heroTitleEs', 'heroSubtitleEn', 'heroSubtitleEs',154 |       'aboutTitleEn', 'aboutTitleEs', 'aboutContentEn', 'aboutContentEs',155 |       'approachTitleEn', 'approachTitleEs', 'approachContentEn', 'approachContentEs',156 |       'servicesTitleEn', 'servicesTitleEs', 'servicesContentEn', 'servicesContentEs'157 |     ];158 | 159 |     const missingFields = requiredFields.filter(field => !content[field] || typeof content[field] !== 'string');160 |     if (missingFields.length > 0) {161 |       return NextResponse.json({162 |         error: 'Missing or invalid required fields',163 |         missingFields,164 |         message: 'All content fields must be non-empty strings'165 |       }, { status: 400 });166 |     }167 | 168 |     const sanitizedContent = { ...content };169 |     Object.keys(sanitizedContent).forEach(key => {170 |       if (typeof sanitizedContent[key] === 'string') {171 |         sanitizedContent[key] = sanitizedContent[key].trim();172 |       }173 |     });174 | 175 |     let result;176 |     const existingContent = await prisma.content.findFirst();177 | 178 |     if (existingContent) {179 | 180 |       result = await prisma.content.update({181 |         where: { id: existingContent.id },182 |         data: sanitizedContent,183 |         select: {184 |           id: true,185 |           heroTitleEn: true,186 |           heroTitleEs: true,187 |           heroSubtitleEn: true,188 |           heroSubtitleEs: true,189 |           aboutTitleEn: true,190 |           aboutTitleEs: true,191 |           aboutContentEn: true,192 |           aboutContentEs: true,193 |           approachTitleEn: true,194 |           approachTitleEs: true,195 |           approachContentEn: true,196 |           approachContentEs: true,197 |           servicesTitleEn: true,198 |           servicesTitleEs: true,199 |           servicesContentEn: true,200 |           servicesContentEs: true,201 |           updatedAt: true202 |         }203 |       });204 | 205 |       } else {206 | 207 |       result = await prisma.content.create({208 |         data: sanitizedContent,209 |         select: {210 |           id: true,211 |           heroTitleEn: true,212 |           heroTitleEs: true,213 |           heroSubtitleEn: true,214 |           heroSubtitleEs: true,215 |           aboutTitleEn: true,216 |           aboutTitleEs: true,217 |           aboutContentEn: true,218 |           aboutContentEs: true,219 |           approachTitleEn: true,220 |           approachTitleEs: true,221 |           approachContentEn: true,222 |           approachContentEs: true,223 |           servicesTitleEn: true,224 |           servicesTitleEs: true,225 |           servicesContentEn: true,226 |           servicesContentEs: true,227 |           createdAt: true,228 |           updatedAt: true229 |         }230 |       });231 | 232 |       }233 | 234 |     try {235 |       await triggerRevalidation();236 |       } catch (revalError) {237 |       }238 | 239 |     const processingTime = Date.now() - startTime;240 | 241 |     const { updatedAt, ...cleanResult } = result;242 | 243 |     return NextResponse.json({244 |       success: true,245 |       content: cleanResult,246 |       timestamp: new Date().toISOString(),247 |       processingTime: `${processingTime}ms`,248 |       message: existingContent ? 'Content updated successfully' : 'Content created successfully'249 |     });250 | 251 |   } catch (error) {252 |     const processingTime = Date.now() - startTime;253 |     :`, error);254 | 255 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';256 | 257 |     return NextResponse.json({258 |       error: 'Internal server error',259 |       message: errorMessage,260 |       timestamp: new Date().toISOString(),261 |       processingTime: `${processingTime}ms`262 |     }, { status: 500 });263 |   }264 | }265 | 266 | async function triggerRevalidation() {267 |   try {268 | 269 |     revalidatePath('/');270 |     revalidatePath('/admin');271 |     revalidatePath('/api/content');272 | 273 |     revalidateTag('content');274 |     revalidateTag('translations');275 |     revalidateTag('sections');276 | 277 |     try {278 |       const revalResponse = await fetch(`${process.env.NEXT_PUBLIC_APP_URL || `http:279 |         method: 'POST'280 |       });281 | 282 |       if (revalResponse.ok) {283 |         } else {284 |         }285 |     } catch (revalError) {286 |       }287 | 288 |     } catch (error) {289 | 290 |   }291 | }
============================================================END: frontend/app/api/admin/content/route.ts============================================================


============================================================FILE: frontend/app/api/admin/content/seed/route.tsSIZE: 9.44 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { z } from 'zod';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | const seedContentSchema = z.object({ 11 |   content: z.record(z.string(), z.any()) 12 | }); 13 |  14 | export async function POST() { 15 |   try { 16 |  17 |     const defaultContent = { 18 |       hero: { 19 |         en: { 20 |           title: "Discover Your Soul's Path", 21 |           subtitle: "Professional Astrology Consultations", 22 |           description: "Unlock the secrets of your birth chart and find guidance for your life journey through personalized astrology readings.", 23 |           cta: "Book Your Session" 24 |         }, 25 |         es: { 26 |           title: "Descubre el Camino de tu Alma", 27 |           subtitle: "Consultas Astrológicas Profesionales", 28 |           description: "Desbloquea los secretos de tu carta natal y encuentra guía para tu viaje de vida a través de lecturas astrológicas personalizadas.", 29 |           cta: "Reserva tu Sesión" 30 |         } 31 |       }, 32 |       about: { 33 |         en: { 34 |           title: "About Soul Path", 35 |           subtitle: "Your Journey to Self-Discovery", 36 |           description: "We are dedicated to helping you understand your unique astrological blueprint and navigate life's challenges with confidence and clarity.", 37 |           features: [ 38 |             "Personalized Birth Chart Analysis", 39 |             "Life Path Guidance", 40 |             "Relationship Compatibility", 41 |             "Career Direction Insights" 42 |           ] 43 |         }, 44 |         es: { 45 |           title: "Acerca de Soul Path", 46 |           subtitle: "Tu Camino hacia el Autoconocimiento", 47 |           description: "Estamos dedicados a ayudarte a entender tu único plano astrológico y navegar los desafíos de la vida con confianza y claridad.", 48 |           features: [ 49 |             "Análisis Personalizado de Carta Natal", 50 |             "Guía del Camino de Vida", 51 |             "Compatibilidad de Relaciones", 52 |             "Insights de Dirección Profesional" 53 |           ] 54 |         } 55 |       }, 56 |       session: { 57 |         en: { 58 |           title: "Astrology Sessions", 59 |           subtitle: "Transform Your Life Through Astrology", 60 |           description: "Our personalized sessions help you understand your unique astrological makeup and provide practical guidance for your life decisions.", 61 |           types: [ 62 |             { 63 |               name: "Birth Chart Reading", 64 |               description: "Comprehensive analysis of your natal chart", 65 |               duration: "90 minutes", 66 |               price: "$150" 67 |             }, 68 |             { 69 |               name: "Relationship Compatibility", 70 |               description: "Understanding dynamics between partners", 71 |               duration: "60 minutes", 72 |               price: "$120" 73 |             }, 74 |             { 75 |               name: "Career Guidance", 76 |               description: "Astrological insights for professional growth", 77 |               duration: "60 minutes", 78 |               price: "$120" 79 |             } 80 |           ], 81 |           price: "Starting from $120", 82 |           deliverables: [ 83 |             "Detailed written report", 84 |             "Audio recording of session", 85 |             "Follow-up email support", 86 |             "30-day consultation access" 87 |           ], 88 |           cta: "Book Your Session" 89 |         }, 90 |         es: { 91 |           title: "Sesiones de Astrología", 92 |           subtitle: "Transforma tu Vida a través de la Astrología", 93 |           description: "Nuestras sesiones personalizadas te ayudan a entender tu composición astrológica única y proporcionan guía práctica para tus decisiones de vida.", 94 |           types: [ 95 |             { 96 |               name: "Lectura de Carta Natal", 97 |               description: "Análisis completo de tu carta natal", 98 |               duration: "90 minutos", 99 |               price: "$150"100 |             },101 |             {102 |               name: "Compatibilidad de Relaciones",103 |               description: "Entendiendo la dinámica entre parejas",104 |               duration: "60 minutos",105 |               price: "$120"106 |             },107 |             {108 |               name: "Guía Profesional",109 |               description: "Insights astrológicos para crecimiento profesional",110 |               duration: "60 minutos",111 |               price: "$120"112 |             }113 |           ],114 |           price: "Desde $120",115 |           deliverables: [116 |             "Reporte escrito detallado",117 |             "Grabación de audio de la sesión",118 |             "Soporte por email de seguimiento",119 |             "Acceso a consulta por 30 días"120 |           ],121 |           cta: "Reserva tu Sesión"122 |         }123 |       },124 |       approach: {125 |         en: {126 |           title: "Our Approach",127 |           subtitle: "How We Work Together",128 |           description: "We combine traditional astrological wisdom with modern psychological insights to provide you with practical, actionable guidance.",129 |           steps: [130 |             {131 |               step: 1,132 |               title: "Initial Consultation",133 |               description: "We discuss your goals and what you hope to gain from the session."134 |             },135 |             {136 |               step: 2,137 |               title: "Chart Analysis",138 |               description: "Deep dive into your birth chart to identify key patterns and themes."139 |             },140 |             {141 |               step: 3,142 |               title: "Guidance Session",143 |               description: "Interactive session where we explore your questions and provide insights."144 |             },145 |             {146 |               step: 4,147 |               title: "Follow-up Support",148 |               description: "Continued guidance and support as you implement the insights."149 |             }150 |           ]151 |         },152 |         es: {153 |           title: "Nuestro Enfoque",154 |           subtitle: "Cómo Trabajamos Juntos",155 |           description: "Combinamos la sabiduría astrológica tradicional con insights psicológicos modernos para proporcionarte guía práctica y accionable.",156 |           steps: [157 |             {158 |               step: 1,159 |               title: "Consulta Inicial",160 |               description: "Discutimos tus objetivos y lo que esperas obtener de la sesión."161 |             },162 |             {163 |               step: 2,164 |               title: "Análisis de Carta",165 |               description: "Inmersión profunda en tu carta natal para identificar patrones y temas clave."166 |             },167 |             {168 |               step: 3,169 |               title: "Sesión de Guía",170 |               description: "Sesión interactiva donde exploramos tus preguntas y proporcionamos insights."171 |             },172 |             {173 |               step: 4,174 |               title: "Soporte de Seguimiento",175 |               description: "Guía y soporte continuo mientras implementas los insights."176 |             }177 |           ]178 |         }179 |       },180 |       contact: {181 |         en: {182 |           title: "Get in Touch",183 |           subtitle: "Ready to Begin Your Journey?",184 |           description: "Contact us to schedule your personalized astrology consultation and start your path to self-discovery.",185 |           email: "hello@soulpath.lat",186 |           phone: "+1 (555) 123-4567",187 |           cta: "Contact Us"188 |         },189 |         es: {190 |           title: "Ponte en Contacto",191 |           subtitle: "¿Listo para Comenzar tu Viaje?",192 |           description: "Contáctanos para programar tu consulta astrológica personalizada y comenzar tu camino hacia el autoconocimiento.",193 |           email: "hello@soulpath.lat",194 |           phone: "+1 (555) 123-4567",195 |           cta: "Contáctanos"196 |         }197 |       }198 |     };199 | 200 |     const validation = seedContentSchema.safeParse({ content: defaultContent });201 |     if (!validation.success) {202 |       return NextResponse.json({203 |         success: false,204 |         error: 'Validation failed',205 |         message: 'Content data validation failed',206 |         details: validation.error.issues,207 |         toast: {208 |           type: 'error',209 |           title: 'Validation Error',210 |           description: 'Content data validation failed. Please check the data format.'211 |         }212 |       }, { status: 400 });213 |     }214 | 215 |     const { error } = await supabase216 |       .from('kv_store_f839855f')217 |       .upsert({218 |         key: 'website_content',219 |         value: defaultContent,220 |         updated_at: new Date().toISOString()221 |       });222 | 223 |     if (error) {224 |       return NextResponse.json({225 |         success: false,226 |         error: 'Database error',227 |         message: 'Failed to seed content',228 |         details: error.message,229 |         toast: {230 |           type: 'error',231 |           title: 'Database Error',232 |           description: 'Failed to seed content. Please try again.'233 |         }234 |       }, { status: 500 });235 |     }236 | 237 |     return NextResponse.json({238 |       success: true,239 |       message: 'Content seeded successfully',240 |       toast: {241 |         type: 'success',242 |         title: 'Success!',243 |         description: 'Website content has been seeded successfully'244 |       }245 |     });246 | 247 |   } catch (error) {248 |     return NextResponse.json({249 |       success: false,250 |       error: 'Internal server error',251 |       message: 'An unexpected error occurred',252 |       toast: {253 |         type: 'error',254 |         title: 'Unexpected Error',255 |         description: 'An unexpected error occurred. Please try again.'256 |       }257 |     }, { status: 500 });258 |   }259 | }
============================================================END: frontend/app/api/admin/content/seed/route.ts============================================================


============================================================FILE: frontend/app/api/admin/conversation-logs/route.tsSIZE: 12.03 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 | import { z } from 'zod';  5 | import { ConversationLogsResponse, ConversationLog, ConversationStats } from '@/lib/types/conversational-orchestrator';  6 |   7 | const querySchema = z.object({  8 |   userId: z.string().optional(),  9 |   dateFrom: z.string().optional(), 10 |   dateTo: z.string().optional(), 11 |   intent: z.string().optional(), 12 |   confidence: z.string().optional(), 13 |   hasFeedback: z.enum(['true', 'false', 'all']).optional(), 14 |   page: z.string().transform(Number).default(1), 15 |   limit: z.string().transform(Number).default(50), 16 |   enhanced: z.enum(['true', 'false']).optional() 17 | }); 18 |  19 | export async function GET(request: NextRequest) { 20 |   try { 21 |     const user = await requireAuth(request); 22 |     if (!user || user.role !== 'admin') { 23 |       return NextResponse.json({ 24 |         success: false, 25 |         error: 'Unauthorized', 26 |         message: 'Admin access required' 27 |       }, { status: 401 }); 28 |     } 29 |  30 |     try { 31 |       await prisma.$connect(); 32 |       } catch (dbError) { 33 |       return NextResponse.json({ 34 |         success: false, 35 |         error: 'Database connection failed', 36 |         message: 'Unable to connect to database', 37 |         details: dbError instanceof Error ? dbError.message : 'Unknown database error' 38 |       }, { status: 500 }); 39 |     } 40 |  41 |     const { searchParams } = new URL(request.url); 42 |     const queryParams = Object.fromEntries(searchParams.entries()); 43 |     const validation = querySchema.safeParse(queryParams); 44 |  45 |     if (!validation.success) { 46 |       return NextResponse.json({ 47 |         success: false, 48 |         error: 'Invalid query parameters', 49 |         details: validation.error.issues 50 |       }, { status: 400 }); 51 |     } 52 |  53 |     const { 54 |       userId, 55 |       dateFrom, 56 |       dateTo, 57 |       intent, 58 |       confidence, 59 |       hasFeedback, 60 |       page, 61 |       limit, 62 |       enhanced 63 |     } = validation.data; 64 |  65 |     const offset = (page - 1) * limit; 66 |  67 |     const where: Record<string, unknown> = {}; 68 |  69 |     if (userId) where.userId = userId; 70 |     if (intent) where.rasaIntent = intent; 71 |     if (confidence) { 72 |       const confValue = parseFloat(confidence); 73 |       where.rasaConfidence = { lte: confValue }; 74 |     } 75 |     if (hasFeedback === 'true') { 76 |       where.feedback = { some: {} }; 77 |     } else if (hasFeedback === 'false') { 78 |       where.feedback = { none: {} }; 79 |     } 80 |  81 |     if (dateFrom) where.timestamp = { gte: new Date(`${dateFrom}T00:00:00Z`) }; 82 |     if (dateTo) { 83 |       where.timestamp = { 84 |         ...(where.timestamp || {}), 85 |         lte: new Date(`${dateTo}T23:59:59Z`) 86 |       }; 87 |     } 88 |  89 |     const select: Record<string, boolean | object> = { 90 |       id: true, 91 |       userId: true, 92 |       userMessage: true, 93 |       botResponse: true, 94 |       rasaIntent: true, 95 |       rasaConfidence: true, 96 |       rasaEntities: true, 97 |       timestamp: true, 98 |       feedback: { 99 |         select: {100 |           id: true,101 |           rating: true,102 |           comment: true,103 |           createdAt: true104 |         }105 |       }106 |     };107 | 108 |     if (enhanced === 'true') {109 |       select.apiCalls = true;110 |       select.errorDetails = true;111 |       select.context = true;112 |     }113 | 114 |     let totalCount: number;115 |     try {116 |       totalCount = await prisma.conversationLog.count({ where });117 |       } catch (countError) {118 |       return NextResponse.json({119 |         success: false,120 |         error: 'Database query failed',121 |         message: 'Unable to count conversation logs',122 |         details: countError instanceof Error ? countError.message : 'Unknown count error'123 |       }, { status: 500 });124 |     }125 | 126 |     let logs: Record<string, unknown>[];127 |     try {128 |       logs = await prisma.conversationLog.findMany({129 |         where,130 |         select,131 |         orderBy: { timestamp: 'desc' },132 |         skip: offset,133 |         take: limit134 |       });135 |       } catch (logsError) {136 |       return NextResponse.json({137 |         success: false,138 |         error: 'Database query failed',139 |         message: 'Unable to fetch conversation logs',140 |         details: logsError instanceof Error ? logsError.message : 'Unknown logs error'141 |       }, { status: 500 });142 |     }143 | 144 |     let stats: ConversationStats;145 |     try {146 |       stats = await calculateConversationStats(where);147 |       } catch (statsError) {148 |       return NextResponse.json({149 |         success: false,150 |         error: 'Statistics calculation failed',151 |         message: 'Unable to calculate conversation statistics',152 |         details: statsError instanceof Error ? statsError.message : 'Unknown stats error'153 |       }, { status: 500 });154 |     }155 | 156 |     `);157 | 158 |     const response: ConversationLogsResponse = {159 |       success: true,160 |       data: logs as unknown as ConversationLog[],161 |       pagination: {162 |         page,163 |         limit,164 |         total: totalCount,165 |         totalPages: Math.ceil(totalCount / limit),166 |         hasNext: offset + limit < totalCount,167 |         hasPrev: page > 1168 |       },169 |       statistics: stats170 |     };171 | 172 |     return NextResponse.json(response);173 | 174 |   } catch (error) {175 |     return NextResponse.json({176 |       success: false,177 |       error: 'Internal server error',178 |       message: error instanceof Error ? error.message : 'Unknown error',179 |     }, { status: 500 });180 |   }181 | }182 | 183 | export async function POST(request: NextRequest) {184 |   try {185 |     const user = await requireAuth(request);186 |     if (!user || user.role !== 'admin') {187 |       return NextResponse.json({188 |         success: false,189 |         error: 'Unauthorized',190 |         message: 'Admin access required'191 |       }, { status: 401 });192 |     }193 | 194 |     const body = await request.json();195 |     const { action, logIds, feedback } = body;196 | 197 |     switch (action) {198 |       case 'mark_for_training':199 | 200 |         const updatedLogs = await prisma.userFeedback.updateMany({201 |           where: { conversationLogId: { in: logIds } },202 |           data: { reviewedForTraining: true }203 |         });204 | 205 |         return NextResponse.json({206 |           success: true,207 |           message: `Marked ${updatedLogs.count} logs for training`,208 |           data: { updatedCount: updatedLogs.count }209 |         });210 | 211 |       case 'export_training_data':212 | 213 |         const trainingLogs = await prisma.conversationLog.findMany({214 |           where: { id: { in: logIds } },215 |           select: {216 |             userMessage: true,217 |             rasaIntent: true,218 |             rasaEntities: true,219 |             rasaConfidence: true220 |           }221 |         });222 | 223 |         const rasaFormat = convertToRasaFormat(trainingLogs);224 | 225 |         return NextResponse.json({226 |           success: true,227 |           data: {228 |             format: 'rasa_nlu',229 |             content: rasaFormat,230 |             count: trainingLogs.length231 |           }232 |         });233 | 234 |       case 'bulk_feedback':235 | 236 |         const feedbackUpdates = await Promise.all(237 |           logIds.map((logId: string) =>238 |             prisma.userFeedback.create({239 |               data: {240 |                 conversationLogId: parseInt(logId),241 |                 sessionId: '',242 |                 rating: feedback.rating || 1,243 |                 comment: feedback.comment || null,244 |                 ...feedback245 |               }246 |             })247 |           )248 |         );249 | 250 |         return NextResponse.json({251 |           success: true,252 |           message: `Updated feedback for ${feedbackUpdates.length} logs`,253 |           data: { updatedCount: feedbackUpdates.length }254 |         });255 | 256 |       default:257 |         return NextResponse.json({258 |           success: false,259 |           error: 'Invalid action',260 |           message: 'Supported actions: mark_for_training, export_training_data, bulk_feedback'261 |         }, { status: 400 });262 |     }263 | 264 |   } catch (error) {265 |     return NextResponse.json({266 |       success: false,267 |       error: 'Internal server error',268 |       message: error instanceof Error ? error.message : 'Unknown error',269 |     }, { status: 500 });270 |   }271 | }272 | 273 | async function calculateConversationStats(where: Record<string, unknown>): Promise<ConversationStats> {274 |   try {275 |     const [276 |       totalLogs,277 |       lowConfidenceLogs,278 |       highConfidenceLogs,279 |       logsWithFeedback,280 |       topIntents,281 |       averageConfidence282 |     ] = await Promise.all([283 |       prisma.conversationLog.count({ where }),284 |       prisma.conversationLog.count({285 |         where: { ...where, rasaConfidence: { lte: 0.6 } }286 |       }),287 |       prisma.conversationLog.count({288 |         where: { ...where, rasaConfidence: { gte: 0.8 } }289 |       }),290 |       prisma.conversationLog.count({291 |         where: { ...where, feedback: { some: {} } }292 |       }),293 |       prisma.conversationLog.groupBy({294 |         by: ['rasaIntent'],295 |         where,296 |         _count: { rasaIntent: true },297 |         orderBy: { _count: { rasaIntent: 'desc' } },298 |         take: 10299 |       }),300 |       prisma.conversationLog.aggregate({301 |         where,302 |         _avg: { rasaConfidence: true }303 |       })304 |     ]);305 | 306 |     return {307 |       totalLogs,308 |       lowConfidenceLogs,309 |       highConfidenceLogs,310 |       logsWithFeedback,311 |       averageConfidence: Number(averageConfidence._avg.rasaConfidence) || 0,312 |       topIntents: topIntents313 |         .filter(item => item.rasaIntent !== null)314 |         .map(item => ({315 |           intent: item.rasaIntent as string,316 |           count: item._count.rasaIntent317 |         }))318 |     };319 |   } catch (error) {320 |     throw error;321 |   }322 | }323 | 324 | function convertToRasaFormat(logs: unknown[]): string {325 |   const intentGroups: Record<string, string[]> = {};326 | 327 |   for (const log of logs) {328 |     const logObj = log as Record<string, unknown>;329 |     if (!logObj.rasaIntent) continue;330 | 331 |     if (!intentGroups[logObj.rasaIntent as string]) {332 |       intentGroups[logObj.rasaIntent as string] = [];333 |     }334 | 335 |     let example = logObj.userMessage as string;336 |     if (logObj.rasaEntities && Array.isArray(logObj.rasaEntities) && logObj.rasaEntities.length > 0) {337 | 338 |       const sortedEntities = (logObj.rasaEntities as Record<string, unknown>[]).sort((a: Record<string, unknown>, b: Record<string, unknown>) => (b.start as number) - (a.start as number));339 |       for (const entity of sortedEntities) {340 |         const before = example.substring(0, entity.start as number);341 |         const after = example.substring(entity.end as number);342 |         example = `${before}[${entity.value as string}](${entity.entity as string})${after}`;343 |       }344 |     }345 | 346 |     intentGroups[logObj.rasaIntent as string].push(`    - ${example}`);347 |   }348 | 349 |   let yaml = 'version: "3.1"\n\nnlu:\n';350 | 351 |   for (const [intent, examples] of Object.entries(intentGroups)) {352 |     yaml += `- intent: ${intent}\n  examples: |\n`;353 |     yaml += examples.join('\n') + '\n\n';354 |   }355 | 356 |   return yaml;357 | }
============================================================END: frontend/app/api/admin/conversation-logs/route.ts============================================================


============================================================FILE: frontend/app/api/admin/conversation-logs/test/route.tsSIZE: 1.91 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET() {  5 |   try {  6 |   7 |     const logs = await prisma.conversationLog.findMany({  8 |       take: 10,  9 |       orderBy: { timestamp: 'desc' }, 10 |       select: { 11 |         id: true, 12 |         userId: true, 13 |         userMessage: true, 14 |         botResponse: true, 15 |         rasaIntent: true, 16 |         rasaConfidence: true, 17 |         timestamp: true, 18 |         responseGenerator: true, 19 |         feedback: { 20 |           select: { 21 |             rating: true, 22 |             comment: true 23 |           } 24 |         } 25 |       } 26 |     }); 27 |  28 |     const stats = await prisma.conversationLog.aggregate({ 29 |       _count: { id: true }, 30 |       _avg: { rasaConfidence: true } 31 |     }); 32 |  33 |     const lowConfidenceCount = await prisma.conversationLog.count({ 34 |       where: { rasaConfidence: { lte: 0.6 } } 35 |     }); 36 |  37 |     const highConfidenceCount = await prisma.conversationLog.count({ 38 |       where: { rasaConfidence: { gte: 0.8 } } 39 |     }); 40 |  41 |     const feedbackCount = await prisma.conversationLog.count({ 42 |       where: { feedback: { some: {} } } 43 |     }); 44 |  45 |     return NextResponse.json({ 46 |       success: true, 47 |       message: "Conversation logs test endpoint", 48 |       data: { 49 |         sampleLogs: logs, 50 |         statistics: { 51 |           totalLogs: stats._count.id, 52 |           averageConfidence: stats._avg.rasaConfidence || 0, 53 |           lowConfidenceLogs: lowConfidenceCount, 54 |           highConfidenceLogs: highConfidenceCount, 55 |           logsWithFeedback: feedbackCount 56 |         } 57 |       }, 58 |       timestamp: new Date().toISOString() 59 |     }); 60 |  61 |   } catch (error) { 62 |     return NextResponse.json({ 63 |       success: false, 64 |       error: 'Internal server error', 65 |       message: error instanceof Error ? error.message : 'Unknown error', 66 |     }, { status: 500 }); 67 |   } 68 | }
============================================================END: frontend/app/api/admin/conversation-logs/test/route.ts============================================================


============================================================FILE: frontend/app/api/admin/currencies/route.tsSIZE: 9.88 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const createCurrencySchema = z.object({  7 |   code: z.string().length(3, 'Currency code must be 3 characters').toUpperCase(),  8 |   name: z.string().min(1, 'Currency name is required').max(100, 'Name too long'),  9 |   symbol: z.string().min(1, 'Currency symbol is required').max(10, 'Symbol too long'), 10 |   isDefault: z.boolean().default(false), 11 |   exchangeRate: z.number().positive('Exchange rate must be positive').default(1) 12 | }); 13 |  14 | const updateCurrencySchema = createCurrencySchema.partial().extend({ 15 |   id: z.number().int().positive('Currency ID must be positive') 16 | }); 17 |  18 | const querySchema = z.object({ 19 |   isDefault: z.enum(['true', 'false']).optional(), 20 |   page: z.coerce.number().int().min(1).default(1), 21 |   limit: z.coerce.number().int().min(1).max(100).default(20) 22 | }); 23 |  24 | export async function GET(request: NextRequest) { 25 |   try { 26 |     const user = await requireAuth(request); 27 |     if (!user || user.role !== 'admin') { 28 |       return NextResponse.json({ 29 |         success: false, 30 |         error: 'Unauthorized', 31 |         message: 'Admin access required' 32 |       }, { status: 401 }); 33 |     } 34 |  35 |     const { searchParams } = new URL(request.url); 36 |     const queryParams = Object.fromEntries(searchParams.entries()); 37 |     const validation = querySchema.safeParse(queryParams); 38 |  39 |     if (!validation.success) { 40 |       return NextResponse.json({ 41 |         success: false, 42 |         error: 'Invalid query parameters', 43 |         details: validation.error.issues 44 |       }, { status: 400 }); 45 |     } 46 |  47 |     const { isDefault, page, limit } = validation.data; 48 |     const offset = (page - 1) * limit; 49 |  50 |     const where: { is_default?: boolean } = {}; 51 |     if (isDefault !== undefined) where.is_default = isDefault === 'true'; 52 |  53 |     const [currencies, totalCount] = await Promise.all([ 54 |       prisma.currency.findMany({ 55 |         where, 56 |         skip: offset, 57 |         take: limit, 58 |         orderBy: [ 59 |           { is_default: 'desc' }, 60 |           { code: 'asc' } 61 |         ] 62 |       }), 63 |       prisma.currency.count({ where }) 64 |     ]); 65 |  66 |     const totalPages = Math.ceil(totalCount / limit); 67 |  68 |     return NextResponse.json({ 69 |       success: true, 70 |       data: currencies, 71 |       pagination: { 72 |         page, 73 |         limit, 74 |         total: totalCount, 75 |         totalPages 76 |       } 77 |     }); 78 |  79 |   } catch (error) { 80 |     return NextResponse.json({ 81 |       success: false, 82 |       error: 'Internal server error', 83 |       message: 'An unexpected error occurred', 84 |       details: error instanceof Error ? error.message : 'Unknown error' 85 |     }, { status: 500 }); 86 |   } finally { 87 |     await prisma.$disconnect(); 88 |   } 89 | } 90 |  91 | export async function POST(request: NextRequest) { 92 |   try { 93 |     const user = await requireAuth(request); 94 |     if (!user || user.role !== 'admin') { 95 |       return NextResponse.json({ 96 |         success: false, 97 |         error: 'Unauthorized', 98 |         message: 'Admin access required' 99 |       }, { status: 401 });100 |     }101 | 102 |     const body = await request.json();103 |     const validation = createCurrencySchema.safeParse(body);104 | 105 |     if (!validation.success) {106 |       return NextResponse.json({107 |         success: false,108 |         error: 'Validation failed',109 |         message: 'Invalid currency data',110 |         details: validation.error.issues111 |       }, { status: 400 });112 |     }113 | 114 |     const currencyData = validation.data;115 | 116 |     const existingCurrency = await prisma.currency.findUnique({117 |       where: { code: currencyData.code }118 |     });119 | 120 |     if (existingCurrency) {121 |       return NextResponse.json({122 |         success: false,123 |         error: 'Currency already exists',124 |         message: 'A currency with this code already exists'125 |       }, { status: 409 });126 |     }127 | 128 |     if (currencyData.isDefault) {129 |       await prisma.currency.updateMany({130 |         where: { is_default: true },131 |         data: { is_default: false }132 |       });133 |     }134 | 135 |     const newCurrency = await prisma.currency.create({136 |       data: currencyData137 |     });138 | 139 |     return NextResponse.json({140 |       success: true,141 |       message: 'Currency created successfully',142 |       data: newCurrency143 |     }, { status: 201 });144 | 145 |   } catch (error) {146 |     return NextResponse.json({147 |       success: false,148 |       error: 'Internal server error',149 |       message: 'Failed to create currency',150 |       details: error instanceof Error ? error.message : 'Unknown error'151 |     }, { status: 500 });152 |   } finally {153 |     await prisma.$disconnect();154 |   }155 | }156 | 157 | export async function PUT(request: NextRequest) {158 |   try {159 |     const user = await requireAuth(request);160 |     if (!user || user.role !== 'admin') {161 |       return NextResponse.json({162 |         success: false,163 |         error: 'Unauthorized',164 |         message: 'Admin access required'165 |       }, { status: 401 });166 |     }167 | 168 |     const body = await request.json();169 |     const validation = updateCurrencySchema.safeParse(body);170 | 171 |     if (!validation.success) {172 |       return NextResponse.json({173 |         success: false,174 |         error: 'Validation failed',175 |         message: 'Invalid currency update data',176 |         details: validation.error.issues177 |       }, { status: 400 });178 |     }179 | 180 |     const { id, ...updateData } = validation.data;181 | 182 |     const existingCurrency = await prisma.currency.findUnique({183 |       where: { id }184 |     });185 | 186 |     if (!existingCurrency) {187 |       return NextResponse.json({188 |         success: false,189 |         error: 'Currency not found',190 |         message: 'Currency with this ID does not exist'191 |       }, { status: 404 });192 |     }193 | 194 |     if (updateData.code && updateData.code !== existingCurrency.code) {195 |       const codeConflict = await prisma.currency.findFirst({196 |         where: {197 |           code: updateData.code,198 |           id: { not: id }199 |         }200 |       });201 | 202 |       if (codeConflict) {203 |         return NextResponse.json({204 |           success: false,205 |           error: 'Code conflict',206 |           message: 'A currency with this code already exists'207 |         }, { status: 409 });208 |       }209 |     }210 | 211 |         if (updateData.isDefault) {212 |       await prisma.currency.updateMany({213 |         where: {214 |           is_default: true,215 |           id: { not: id }216 |         },217 |         data: { is_default: false }218 |       });219 |     }220 | 221 |     const updatedCurrency = await prisma.currency.update({222 |       where: { id },223 |       data: updateData224 |     });225 | 226 |     return NextResponse.json({227 |       success: true,228 |       message: 'Currency updated successfully',229 |       data: updatedCurrency230 |     });231 | 232 |   } catch (error) {233 |     return NextResponse.json({234 |       success: false,235 |       error: 'Internal server error',236 |       message: 'Failed to update currency',237 |       details: error instanceof Error ? error.message : 'Unknown error'238 |     }, { status: 500 });239 |   } finally {240 |     await prisma.$disconnect();241 |   }242 | }243 | 244 | export async function DELETE(request: NextRequest) {245 |   try {246 |     const user = await requireAuth(request);247 |     if (!user || user.role !== 'admin') {248 |       return NextResponse.json({249 |         success: false,250 |         error: 'Unauthorized',251 |         message: 'Admin access required'252 |       }, { status: 401 });253 |     }254 | 255 |     const { searchParams } = new URL(request.url);256 |     const currencyId = searchParams.get('id');257 | 258 |     if (!currencyId) {259 |       return NextResponse.json({260 |         success: false,261 |         error: 'Missing ID',262 |         message: 'Currency ID is required'263 |       }, { status: 400 });264 |     }265 | 266 |     const id = parseInt(currencyId);267 |     if (isNaN(id)) {268 |       return NextResponse.json({269 |         success: false,270 |         error: 'Invalid ID',271 |         message: 'Currency ID must be a number'272 |       }, { status: 400 });273 |     }274 | 275 |     const existingCurrency = await prisma.currency.findUnique({276 |       where: { id },277 |       include: {278 |         packagePrices: {279 |           where: { isActive: true }280 |         }281 |       }282 |     });283 | 284 |     if (!existingCurrency) {285 |       return NextResponse.json({286 |         success: false,287 |         error: 'Currency not found',288 |         message: 'Currency with this ID does not exist'289 |       }, { status: 404 });290 |     }291 | 292 |     if (existingCurrency.packagePrices.length > 0) {293 |       return NextResponse.json({294 |         success: false,295 |         error: 'Cannot delete currency',296 |         message: 'Currency is being used by active package prices and cannot be deleted'297 |       }, { status: 400 });298 |     }299 | 300 |     if (existingCurrency.is_default) {301 |       return NextResponse.json({302 |         success: false,303 |         error: 'Cannot delete default currency',304 |         message: 'Default currency cannot be deleted'305 |       }, { status: 400 });306 |     }307 | 308 |     await prisma.currency.delete({309 |       where: { id }310 |     });311 | 312 |     return NextResponse.json({313 |       success: true,314 |       message: 'Currency deleted successfully'315 |     });316 | 317 |   } catch (error) {318 |     return NextResponse.json({319 |       success: false,320 |       error: 'Internal server error',321 |       message: 'Failed to delete currency',322 |       details: error instanceof Error ? error.message : 'Unknown error'323 |     }, { status: 500 });324 |   } finally {325 |     await prisma.$disconnect();326 |   }327 | }
============================================================END: frontend/app/api/admin/currencies/route.ts============================================================


============================================================FILE: frontend/app/api/admin/debug/route.tsSIZE: 0.90 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET() {  5 |   try {  6 |   7 |     const userCount = await prisma.user.count();  8 |   9 |     return NextResponse.json({ 10 |       success: true, 11 |       message: 'Database connection and table access working', 12 |       userCount: userCount, 13 |       refactored: true 14 |     }); 15 |  16 |   } catch (error) { 17 |     return NextResponse.json({ 18 |       success: false, 19 |       error: 'Unexpected error', 20 |       details: error instanceof Error ? error.message : 'Unknown error' 21 |     }, { status: 500 }); 22 |   } 23 | }
============================================================END: frontend/app/api/admin/debug/route.ts============================================================


============================================================FILE: frontend/app/api/admin/email/config/route.tsSIZE: 4.00 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { createAdminClient } from '@/lib/supabase/admin';  4 |   5 | export async function GET(request: NextRequest) {  6 |   try {  7 |     const user = await requireAuth(request);  8 |     if (!user) {  9 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 10 |     } 11 |  12 |     const supabase = createAdminClient(); 13 |  14 |     const { data, error } = await supabase 15 |       .from('email_config') 16 |       .select('*') 17 |       .single(); 18 |  19 |     if (error) { 20 |  21 |       const defaultConfig = { 22 |         smtp_host: 'smtp.gmail.com', 23 |         smtp_port: 587, 24 |         smtp_user: '', 25 |         smtp_pass: '', 26 |         from_email: 'noreply@matmax.store', 27 |         from_name: 'MatMax Yoga Studio', 28 |         brevo_api_key: '', 29 |         sender_email: '', 30 |         sender_name: '', 31 |         admin_email: '', 32 |  33 |         sms_provider: 'labsmobile', 34 |         labsmobile_username: '', 35 |         labsmobile_token: '', 36 |         sms_sender_name: 'MatMax Yoga Studio', 37 |         sms_enabled: false, 38 |  39 |         sms_otp_template_en: 'Your MatMax Yoga Studio verification code is: {{otpCode}}. This code expires in 10 minutes.', 40 |         sms_otp_template_es: 'Su código de verificación de MatMax Yoga Studio es: {{otpCode}}. Este código expira en 10 minutos.', 41 |         sms_booking_template_en: 'Your MatMax Yoga Studio class is confirmed for {{bookingDate}} at {{bookingTime}}. We look forward to seeing you!', 42 |         sms_booking_template_es: 'Su clase en MatMax Yoga Studio está confirmada para el {{bookingDate}} a las {{bookingTime}}. ¡Esperamos verte!' 43 |       }; 44 |  45 |       return NextResponse.json({ config: defaultConfig }); 46 |     } 47 |  48 |     return NextResponse.json({ config: data }); 49 |   } catch (error) { 50 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 51 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 52 |   } 53 | } 54 |  55 | export async function PUT(request: NextRequest) { 56 |   try { 57 |     const user = await requireAuth(request); 58 |     if (!user) { 59 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 60 |     } 61 |  62 |     const body = await request.json(); 63 |     const supabase = createAdminClient(); 64 |  65 |     const { data, error } = await supabase 66 |       .from('email_config') 67 |       .upsert(body, { onConflict: 'id' }) 68 |       .select() 69 |       .single(); 70 |  71 |     if (error) { 72 |       return NextResponse.json({ 73 |         error: 'Email configuration table does not exist. Please run the database setup first.', 74 |         details: error.message 75 |       }, { status: 500 }); 76 |     } 77 |  78 |     return NextResponse.json({ config: data }); 79 |   } catch (error) { 80 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 81 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 82 |   } 83 | }
============================================================END: frontend/app/api/admin/email/config/route.ts============================================================


============================================================FILE: frontend/app/api/admin/email/templates/route.tsSIZE: 4.36 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | interface EmailTemplateData {  6 |   id: number;  7 |   templateKey: string;  8 |   language?: string;  9 |   subject: string; 10 |   body: string; 11 |   createdAt: string; 12 |   updatedAt: string; 13 | } 14 |  15 | interface TransformedTemplates { 16 |   [language: string]: { 17 |     [templateKey: string]: { 18 |       id: number; 19 |       subject: string; 20 |       body: string; 21 |       createdAt: string; 22 |       updatedAt: string; 23 |       videoConferenceLink?: { 24 |         isActive: boolean; 25 |         url: string; 26 |         includeInTemplate: boolean; 27 |       }; 28 |     }; 29 |   }; 30 | } 31 |  32 | interface TemplateInput { 33 |   [language: string]: { 34 |     [templateKey: string]: { 35 |       subject?: string; 36 |       body?: string; 37 |       videoConferenceLink?: unknown; 38 |     }; 39 |   }; 40 | } 41 |  42 | const supabase = createClient( 43 |   process.env.NEXT_PUBLIC_SUPABASE_URL!, 44 |   process.env.SUPABASE_SERVICE_ROLE_KEY! 45 | ); 46 |  47 | export async function GET(request: NextRequest) { 48 |   try { 49 |     const user = await requireAuth(request); 50 |     if (!user) { 51 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 52 |     } 53 |  54 |     const { data, error } = await supabase 55 |       .from('email_templates') 56 |       .select('*'); 57 |  58 |     if (error) { 59 |       return NextResponse.json({ error: 'Failed to fetch email templates' }, { status: 500 }); 60 |     } 61 |  62 |     const transformedData: TransformedTemplates = {}; 63 |  64 |     if (data && data.length > 0) { 65 |       data.forEach((template: EmailTemplateData) => { 66 |         const lang = template.language || 'en'; 67 |         const key = template.templateKey; 68 |  69 |         if (!transformedData[lang]) { 70 |           transformedData[lang] = {}; 71 |         } 72 |  73 |         transformedData[lang][key] = { 74 |           id: template.id, 75 |           subject: template.subject || '', 76 |           body: template.body || '', 77 |           createdAt: template.createdAt, 78 |           updatedAt: template.updatedAt, 79 |           videoConferenceLink: { 80 |             isActive: false, 81 |             url: '', 82 |             includeInTemplate: false 83 |           } 84 |         }; 85 |       }); 86 |     } 87 |  88 |     return NextResponse.json({ templates: transformedData }); 89 |   } catch (error) { 90 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 91 |   } 92 | } 93 |  94 | export async function PUT(request: NextRequest) { 95 |   try { 96 |     const user = await requireAuth(request); 97 |     if (!user) { 98 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 99 |     }100 | 101 |     const body = await request.json();102 |     const { templates } = body;103 | 104 |     if (!templates) {105 |       return NextResponse.json({ error: 'Templates data is required' }, { status: 400 });106 |     }107 | 108 |     const templateRows: Array<{109 |       template_key: string;110 |       language: string;111 |       subject: string;112 |       body: string;113 |     }> = [];114 | 115 |     Object.entries(templates as TemplateInput).forEach(([lang, langTemplates]) => {116 |       Object.entries(langTemplates).forEach(([key, template]) => {117 |         templateRows.push({118 |           template_key: key,119 |           language: lang,120 |           subject: template.subject || '',121 |           body: template.body || ''122 |         });123 |       });124 |     });125 | 126 |     const { error: deleteError } = await supabase127 |       .from('email_templates')128 |       .delete()129 |       .neq('id', 0);130 | 131 |     if (deleteError) {132 |       return NextResponse.json({ error: 'Failed to update email templates' }, { status: 500 });133 |     }134 | 135 |     if (templateRows.length > 0) {136 |       const { error: insertError } = await supabase137 |         .from('email_templates')138 |         .insert(templateRows)139 |         .select();140 | 141 |       if (insertError) {142 |         return NextResponse.json({ error: 'Failed to update email templates' }, { status: 500 });143 |       }144 |     }145 | 146 |     return NextResponse.json({ success: true, message: 'Templates updated successfully' });147 |   } catch (error) {148 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 });149 |   }150 | }
============================================================END: frontend/app/api/admin/email/templates/route.ts============================================================


============================================================FILE: frontend/app/api/admin/email/test/route.tsSIZE: 1.33 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { sendEmail } from '@/lib/email';  4 |   5 | export async function POST(request: NextRequest) {  6 |   try {  7 |     const user = await requireAuth(request);  8 |     if (!user) {  9 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 10 |     } 11 |  12 |     const body = await request.json(); 13 |     const { to, language = 'en' } = body; 14 |  15 |     if (!to) { 16 |       return NextResponse.json({ 17 |         error: 'Recipient email is required' 18 |       }, { status: 400 }); 19 |     } 20 |  21 |     const success = await sendEmail( 22 |       to, 23 |       'Test Email - SOULPATH', 24 |       ` 25 |         <h2>Test Email</h2> 26 |         <p>This is a test email from the SOULPATH system.</p> 27 |         <p>If you received this email, the email configuration is working correctly.</p> 28 |         <p>Sent at: ${new Date().toLocaleString()}</p> 29 |         <p>Language: ${language}</p> 30 |       ` 31 |     ); 32 |  33 |     if (success) { 34 |       return NextResponse.json({ 35 |         success: true, 36 |         message: 'Test email sent successfully' 37 |       }); 38 |     } else { 39 |       return NextResponse.json({ 40 |         error: 'Failed to send test email' 41 |       }, { status: 500 }); 42 |     } 43 |  44 |   } catch (error) { 45 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 46 |   } 47 | }
============================================================END: frontend/app/api/admin/email/test/route.ts============================================================


============================================================FILE: frontend/app/api/admin/email/test-brevo/route.tsSIZE: 4.77 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 |   4 | export async function POST(request: NextRequest) {  5 |   try {  6 |     const user = await requireAuth(request);  7 |     if (!user) {  8 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });  9 |     } 10 |  11 |     const { createEmailService } = await import('@/lib/brevo-email-service'); 12 |     const emailService = await createEmailService(); 13 |  14 |     if (!emailService) { 15 |       return NextResponse.json({ 16 |         success: false, 17 |         error: 'Email service not available. Please check Brevo configuration.' 18 |       }, { status: 500 }); 19 |     } 20 |  21 |     const testEmailData = { 22 |       to: 'bestosaco@gmail.com', 23 |       subject: '🧪 Test Email from SoulPath - Brevo Integration', 24 |       html: ` 25 |         <!DOCTYPE html> 26 |         <html> 27 |         <head> 28 |             <meta charset="UTF-8"> 29 |             <meta name="viewport" content="width=device-width, initial-scale=1.0"> 30 |             <title>Test Email</title> 31 |             <style> 32 |                 body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #f7f7f7; margin: 0; padding: 20px; } 33 |                 .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); } 34 |                 .header { background: linear-gradient(135deg, #191970, #0A0A23); color: #FFD700; padding: 30px 20px; text-align: center; } 35 |                 .header h1 { margin: 0; font-size: 28px; font-weight: bold; } 36 |                 .content { padding: 30px; } 37 |                 .test-info { background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #28a745; } 38 |                 .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; } 39 |             </style> 40 |         </head> 41 |         <body> 42 |             <div class="container"> 43 |                 <div class="header"> 44 |                     <h1>✨ SoulPath Astrology ✨</h1> 45 |                     <p>Brevo Email Service Test</p> 46 |                 </div> 47 |                 <div class="content"> 48 |                     <h2>🎉 Test Email Successful!</h2> 49 |                     <p>This is a test email to verify that the Brevo email service integration is working correctly.</p> 50 |  51 |                     <div class="test-info"> 52 |                         <h3>✅ What This Confirms</h3> 53 |                         <ul> 54 |                             <li>Brevo API key is configured correctly</li> 55 |                             <li>Email service can connect to Brevo</li> 56 |                             <li>Emails can be sent successfully</li> 57 |                             <li>Template system is ready for use</li> 58 |                         </ul> 59 |                     </div> 60 |  61 |                     <p><strong>Test Details:</strong></p> 62 |                     <ul> 63 |                         <li><strong>Sent to:</strong> bestosaco@gmail.com</li> 64 |                         <li><strong>Sent from:</strong> SoulPath Email Service</li> 65 |                         <li><strong>Timestamp:</strong> ${new Date().toLocaleString()}</li> 66 |                         <li><strong>Service:</strong> Brevo (Sendinblue)</li> 67 |                     </ul> 68 |  69 |                     <p>If you received this email, the integration is working perfectly! 🚀</p> 70 |                 </div> 71 |                 <div class="footer"> 72 |                     <p>© 2024 SoulPath Astrology - José Garfias<br> 73 |                     Guiding souls through the wisdom of the stars</p> 74 |                 </div> 75 |             </div> 76 |         </body> 77 |         </html> 78 |       ` 79 |     }; 80 |  81 |     const emailSent = await emailService.sendEmail(testEmailData); 82 |  83 |     if (emailSent) { 84 |       return NextResponse.json({ 85 |         success: true, 86 |         message: 'Test email sent successfully to bestosaco@gmail.com', 87 |         timestamp: new Date().toISOString(), 88 |         recipient: testEmailData.to 89 |       }); 90 |     } else { 91 |       return NextResponse.json({ 92 |         success: false, 93 |         error: 'Failed to send test email via Brevo' 94 |       }, { status: 500 }); 95 |     } 96 |  97 |   } catch (error) { 98 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 99 |     return NextResponse.json({100 |       success: false,101 |       error: 'Internal server error',102 |       details: errorMessage103 |     }, { status: 500 });104 |   }105 | }
============================================================END: frontend/app/api/admin/email/test-brevo/route.ts============================================================


============================================================FILE: frontend/app/api/admin/external-apis/route.tsSIZE: 7.34 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { ExternalAPIService } from '@/lib/services/external-api-service';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | const apiService = new ExternalAPIService();  6 |   7 | export async function GET(request: NextRequest) {  8 |   try {  9 |  10 |     const user = await requireAuth(request); 11 |     if (!user) { 12 |       return NextResponse.json( 13 |         { success: false, error: 'Unauthorized' }, 14 |         { status: 401 } 15 |       ); 16 |     } 17 |  18 |     if (user.role !== 'admin') { 19 |       return NextResponse.json( 20 |         { success: false, error: 'Admin access required' }, 21 |         { status: 403 } 22 |       ); 23 |     } 24 |  25 |     const { searchParams } = new URL(request.url); 26 |     const action = searchParams.get('action'); 27 |  28 |     switch (action) { 29 |       case 'list': 30 |         const configs = await apiService.getAllConfigs(); 31 |         return NextResponse.json({ 32 |           success: true, 33 |           data: configs, 34 |         }); 35 |  36 |       case 'audit': 37 |         const configId = searchParams.get('configId'); 38 |         const limit = parseInt(searchParams.get('limit') || '50'); 39 |         const offset = parseInt(searchParams.get('offset') || '0'); 40 |  41 |         const auditLogs = await apiService.getAuditLogs(configId || undefined, limit, offset); 42 |         return NextResponse.json({ 43 |           success: true, 44 |           data: auditLogs, 45 |         }); 46 |  47 |       default: 48 |  49 |         const allConfigs = await apiService.getAllConfigs(); 50 |         return NextResponse.json({ 51 |           success: true, 52 |           data: allConfigs, 53 |         }); 54 |     } 55 |  56 |   } catch (error) { 57 |     return NextResponse.json( 58 |       { 59 |         success: false, 60 |         error: 'Internal server error', 61 |         message: error instanceof Error ? error.message : 'Unknown error', 62 |       }, 63 |       { status: 500 } 64 |     ); 65 |   } 66 | } 67 |  68 | export async function POST(request: NextRequest) { 69 |   try { 70 |  71 |     const user = await requireAuth(request); 72 |     if (!user) { 73 |       return NextResponse.json( 74 |         { success: false, error: 'Unauthorized' }, 75 |         { status: 401 } 76 |       ); 77 |     } 78 |  79 |     if (user.role !== 'admin') { 80 |       return NextResponse.json( 81 |         { success: false, error: 'Admin access required' }, 82 |         { status: 403 } 83 |       ); 84 |     } 85 |  86 |     const body = await request.json(); 87 |     const { action, data } = body; 88 |  89 |     const ipAddress = request.headers.get('x-forwarded-for') || 90 |                      request.headers.get('x-real-ip') || 91 |                      'unknown'; 92 |  93 |     const userAgent = request.headers.get('user-agent') || 'unknown'; 94 |  95 |     switch (action) { 96 |       case 'create': 97 |         if (!data || !data.name || !data.provider || !data.category) { 98 |           return NextResponse.json( 99 |             { success: false, error: 'Missing required fields: name, provider, category' },100 |             { status: 400 }101 |           );102 |         }103 | 104 |         const newConfig = await apiService.createConfig(105 |           data,106 |           user.id,107 |           ipAddress,108 |           userAgent109 |         );110 | 111 |         return NextResponse.json({112 |           success: true,113 |           data: newConfig,114 |           message: 'API configuration created successfully',115 |         });116 | 117 |       case 'test':118 |         if (!data?.id) {119 |           return NextResponse.json(120 |             { success: false, error: 'Configuration ID is required' },121 |             { status: 400 }122 |           );123 |         }124 | 125 |         const testResult = await apiService.testConfig(126 |           data.id,127 |           user.id,128 |           ipAddress,129 |           userAgent130 |         );131 | 132 |         return NextResponse.json({133 |           success: true,134 |           data: testResult,135 |           message: testResult.success ? 'API test successful' : 'API test failed',136 |         });137 | 138 |       default:139 |         return NextResponse.json(140 |           { success: false, error: 'Invalid action' },141 |           { status: 400 }142 |         );143 |     }144 | 145 |   } catch (error) {146 |     return NextResponse.json(147 |       {148 |         success: false,149 |         error: 'Internal server error',150 |         message: error instanceof Error ? error.message : 'Unknown error',151 |       },152 |       { status: 500 }153 |     );154 |   }155 | }156 | 157 | export async function PUT(request: NextRequest) {158 |   try {159 | 160 |     const user = await requireAuth(request);161 |     if (!user) {162 |       return NextResponse.json(163 |         { success: false, error: 'Unauthorized' },164 |         { status: 401 }165 |       );166 |     }167 | 168 |     if (user.role !== 'admin') {169 |       return NextResponse.json(170 |         { success: false, error: 'Admin access required' },171 |         { status: 403 }172 |       );173 |     }174 | 175 |     const { searchParams } = new URL(request.url);176 |     const id = searchParams.get('id');177 | 178 |     if (!id) {179 |       return NextResponse.json(180 |         { success: false, error: 'Configuration ID is required' },181 |         { status: 400 }182 |       );183 |     }184 | 185 |     const body = await request.json();186 |     const updateData = body;187 | 188 |     const ipAddress = request.headers.get('x-forwarded-for') ||189 |                      request.headers.get('x-real-ip') ||190 |                      'unknown';191 | 192 |     const userAgent = request.headers.get('user-agent') || 'unknown';193 | 194 |     const updatedConfig = await apiService.updateConfig(195 |       id,196 |       updateData,197 |       user.id,198 |       ipAddress,199 |       userAgent200 |     );201 | 202 |     return NextResponse.json({203 |       success: true,204 |       data: updatedConfig,205 |       message: 'API configuration updated successfully',206 |     });207 | 208 |   } catch (error) {209 |     return NextResponse.json(210 |       {211 |         success: false,212 |         error: 'Internal server error',213 |         message: error instanceof Error ? error.message : 'Unknown error',214 |       },215 |       { status: 500 }216 |     );217 |   }218 | }219 | 220 | export async function DELETE(request: NextRequest) {221 |   try {222 | 223 |     const user = await requireAuth(request);224 |     if (!user) {225 |       return NextResponse.json(226 |         { success: false, error: 'Unauthorized' },227 |         { status: 401 }228 |       );229 |     }230 | 231 |     if (user.role !== 'admin') {232 |       return NextResponse.json(233 |         { success: false, error: 'Admin access required' },234 |         { status: 403 }235 |       );236 |     }237 | 238 |     const { searchParams } = new URL(request.url);239 |     const id = searchParams.get('id');240 | 241 |     if (!id) {242 |       return NextResponse.json(243 |         { success: false, error: 'Configuration ID is required' },244 |         { status: 400 }245 |       );246 |     }247 | 248 |     const ipAddress = request.headers.get('x-forwarded-for') ||249 |                      request.headers.get('x-real-ip') ||250 |                      'unknown';251 | 252 |     const userAgent = request.headers.get('user-agent') || 'unknown';253 | 254 |     await apiService.deleteConfig(255 |       id,256 |       user.id,257 |       ipAddress,258 |       userAgent259 |     );260 | 261 |     return NextResponse.json({262 |       success: true,263 |       message: 'API configuration deleted successfully',264 |     });265 | 266 |   } catch (error) {267 |     return NextResponse.json(268 |       {269 |         success: false,270 |         error: 'Internal server error',271 |         message: error instanceof Error ? error.message : 'Unknown error',272 |       },273 |       { status: 500 }274 |     );275 |   }276 | }
============================================================END: frontend/app/api/admin/external-apis/route.ts============================================================


============================================================FILE: frontend/app/api/admin/health/route.tsSIZE: 2.11 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | export async function GET(request: NextRequest) {  6 |   try {  7 |   8 |     const user = await requireAuth(request);  9 |     if (!user || user.role !== 'admin') { 10 |       return NextResponse.json({ 11 |         success: false, 12 |         error: 'Unauthorized', 13 |         message: 'Admin access required' 14 |       }, { status: 401 }); 15 |     } 16 |  17 |     let dbStatus = 'unknown'; 18 |     const dbError = null; 19 |     try { 20 |       await prisma.$connect(); 21 |       await prisma.$queryRaw`SELECT 1`; 22 |       dbStatus = 'connected'; 23 |       } catch (dbError) { 24 |       dbStatus = 'error'; 25 |       } 26 |  27 |     let tableExists = false; 28 |     let recordCount = 0; 29 |     try { 30 |       const count = await prisma.conversationLog.count(); 31 |       tableExists = true; 32 |       recordCount = count; 33 |       } catch (queryError) { 34 |       } 35 |  36 |     return NextResponse.json({ 37 |       success: true, 38 |       data: { 39 |         timestamp: new Date().toISOString(), 40 |         authentication: { 41 |           status: 'success', 42 |           user: { 43 |             id: user.id, 44 |             email: user.email, 45 |             role: user.role 46 |           } 47 |         }, 48 |         database: { 49 |           status: dbStatus, 50 |           error: dbError ? String(dbError) : null, 51 |           tableExists, 52 |           recordCount 53 |         } 54 |       } 55 |     }); 56 |  57 |   } catch (error) { 58 |     return NextResponse.json({ 59 |       success: false, 60 |       error: 'Health check failed', 61 |       message: error instanceof Error ? error.message : 'Unknown error', 62 |     }, { status: 500 }); 63 |   } 64 | }
============================================================END: frontend/app/api/admin/health/route.ts============================================================


============================================================FILE: frontend/app/api/admin/images/[imageKey]/route.tsSIZE: 5.18 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | export async function POST( 11 |   request: NextRequest, 12 |   { params }: { params: { imageKey: string } } 13 | ) { 14 |   try { 15 |     const user = await requireAuth(request); 16 |     if (!user) { 17 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 18 |     } 19 |  20 |     const { imageKey } = params; 21 |     const body = await request.json(); 22 |     const { file } = body; 23 |     if (!file) { 24 |       return NextResponse.json({ 25 |         error: 'File data is required' 26 |       }, { status: 400 }); 27 |     } 28 |  29 |     const { data, error } = await supabase 30 |       .from('images') 31 |       .upsert({ 32 |         key: imageKey, 33 |         url: file.url || file, 34 |         metadata: file.metadata || {}, 35 |         updatedAt: new Date().toISOString() 36 |       }, { onConflict: 'key' }) 37 |       .select() 38 |       .single(); 39 |  40 |     if (error) { 41 |       return NextResponse.json({ 42 |         error: 'Images table does not exist. Please run the database setup first.', 43 |         details: error.message 44 |       }, { status: 500 }); 45 |     } 46 |  47 |     return NextResponse.json({ 48 |       success: true, 49 |       message: 'Image updated successfully', 50 |       image: data 51 |     }); 52 |  53 |   } catch (error) { 54 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 55 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 56 |   } 57 | } 58 |  59 | export async function PUT( 60 |   request: NextRequest, 61 |   { params }: { params: { imageKey: string } } 62 | ) { 63 |   try { 64 |     const user = await requireAuth(request); 65 |     if (!user) { 66 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 67 |     } 68 |  69 |     const { imageKey } = params; 70 |     const body = await request.json(); 71 |     const { url } = body; 72 |     if (!url) { 73 |       return NextResponse.json({ 74 |         error: 'URL is required' 75 |       }, { status: 400 }); 76 |     } 77 |  78 |     const { data, error } = await supabase 79 |       .from('images') 80 |       .upsert({ 81 |         key: imageKey, 82 |         url, 83 |         updatedAt: new Date().toISOString() 84 |       }, { onConflict: 'key' }) 85 |       .select() 86 |       .single(); 87 |  88 |     if (error) { 89 |       return NextResponse.json({ 90 |         error: 'Images table does not exist. Please run the database setup first.', 91 |         details: error.message 92 |       }, { status: 500 }); 93 |     } 94 |  95 |     return NextResponse.json({ 96 |       success: true, 97 |       message: 'Image URL updated successfully', 98 |       image: data 99 |     });100 | 101 |   } catch (error) {102 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';103 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 });104 |   }105 | }106 | 107 | export async function DELETE(108 |   request: NextRequest,109 |   { params }: { params: { imageKey: string } }110 | ) {111 |   try {112 |     const user = await requireAuth(request);113 |     if (!user) {114 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });115 |     }116 | 117 |     const { imageKey } = params;118 | 119 |     const { error } = await supabase120 |       .from('images')121 |       .delete()122 |       .eq('key', imageKey);123 | 124 |     if (error) {125 |       return NextResponse.json({126 |         error: 'Images table does not exist. Please run the database setup first.',127 |         details: error.message128 |       }, { status: 500 });129 |     }130 | 131 |     return NextResponse.json({132 |       success: true,133 |       message: 'Image deleted successfully'134 |     });135 | 136 |   } catch (error) {137 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';138 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 });139 |   }140 | }
============================================================END: frontend/app/api/admin/images/[imageKey]/route.ts============================================================


============================================================FILE: frontend/app/api/admin/images/route.tsSIZE: 2.99 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { createAdminClient } from '@/lib/supabase/admin';  4 |   5 | interface ImageData {  6 |   id: number;  7 |   name: string;  8 |   url: string;  9 |   altText?: string; 10 |   category?: string; 11 |   createdAt: string; 12 |   updatedAt: string; 13 | } 14 |  15 | export async function GET(request: NextRequest) { 16 |   try { 17 |     const user = await requireAuth(request); 18 |     if (!user) { 19 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 20 |     } 21 |  22 |     const supabase = createAdminClient(); 23 |  24 |     const { data, error } = await supabase 25 |       .from('images') 26 |       .select('*'); 27 |  28 |     if (error) { 29 |  30 |       const defaultImages: ImageData[] = []; 31 |  32 |       return NextResponse.json({ images: defaultImages }); 33 |     } 34 |  35 |     return NextResponse.json({ images: data || [] }); 36 |   } catch (error) { 37 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 38 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 39 |   } 40 | } 41 |  42 | export async function POST(request: NextRequest) { 43 |   try { 44 |     const user = await requireAuth(request); 45 |     if (!user) { 46 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 47 |     } 48 |  49 |     const body = await request.json(); 50 |     const supabase = createAdminClient(); 51 |  52 |     const { data, error } = await supabase 53 |       .from('images') 54 |       .upsert(body, { onConflict: 'id' }) 55 |       .select() 56 |       .single(); 57 |  58 |     if (error) { 59 |       return NextResponse.json({ 60 |         error: 'Images table does not exist. Please run the database setup first.', 61 |         details: error.message 62 |       }, { status: 500 }); 63 |     } 64 |  65 |     return NextResponse.json({ images: data }); 66 |   } catch (error) { 67 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 68 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 69 |   } 70 | }
============================================================END: frontend/app/api/admin/images/route.ts============================================================


============================================================FILE: frontend/app/api/admin/live-session-config/route.tsSIZE: 4.93 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 | import { z } from 'zod';  5 |   6 | const liveSessionConfigSchema = z.object({  7 |   name: z.string().min(1, 'Name is required'),  8 |   provider: z.enum(['zoom', 'meet', 'teams', 'weebly', 'custom']),  9 |   apiKey: z.string().min(1, 'API key is required'), 10 |   apiSecret: z.string().optional(), 11 |   webhookUrl: z.string().url().optional(), 12 |   isActive: z.boolean().default(false), 13 |   settings: z.object({ 14 |     allowVideo: z.boolean().default(true), 15 |     allowAudio: z.boolean().default(true), 16 |     allowChat: z.boolean().default(true), 17 |     allowScreenShare: z.boolean().default(true), 18 |     maxParticipants: z.number().int().min(1).max(100).default(10), 19 |     recordingEnabled: z.boolean().default(false), 20 |     autoStart: z.boolean().default(false), 21 |     waitingRoom: z.boolean().default(true), 22 |     muteOnEntry: z.boolean().default(false) 23 |   }), 24 |   weeblySettings: z.object({ 25 |     siteId: z.string().optional(), 26 |     appId: z.string().optional(), 27 |     clientId: z.string().optional(), 28 |     clientSecret: z.string().optional(), 29 |     redirectUri: z.string().url().optional(), 30 |     scope: z.array(z.string()).default(['read:site', 'write:site']) 31 |   }).optional() 32 | }); 33 |  34 | export async function GET(request: NextRequest) { 35 |   try { 36 |     const user = await requireAuth(request); 37 |     if (!user) { 38 |       return NextResponse.json({ 39 |         success: false, 40 |         error: 'Unauthorized', 41 |         message: 'Authentication required' 42 |       }, { status: 401 }); 43 |     } 44 |  45 |     const config = { 46 |       id: 'live-session-config-1', 47 |       name: 'SoulPath Live Sessions', 48 |       provider: 'zoom', 49 |       apiKey: process.env.ZOOM_API_KEY || '', 50 |       apiSecret: process.env.ZOOM_API_SECRET || '', 51 |       webhookUrl: process.env.WEBHOOK_URL || '', 52 |       isActive: true, 53 |       settings: { 54 |         allowVideo: true, 55 |         allowAudio: true, 56 |         allowChat: true, 57 |         allowScreenShare: true, 58 |         maxParticipants: 10, 59 |         recordingEnabled: true, 60 |         autoStart: false, 61 |         waitingRoom: true, 62 |         muteOnEntry: false 63 |       }, 64 |       weeblySettings: { 65 |         siteId: process.env.WEEBBLY_SITE_ID || '', 66 |         appId: process.env.WEEBBLY_APP_ID || '', 67 |         clientId: process.env.WEEBBLY_CLIENT_ID || '', 68 |         clientSecret: process.env.WEEBBLY_CLIENT_SECRET || '', 69 |         redirectUri: process.env.WEEBBLY_REDIRECT_URI || '', 70 |         scope: ['read:site', 'write:site', 'read:blog', 'write:blog'] 71 |       }, 72 |       createdAt: new Date().toISOString(), 73 |       updatedAt: new Date().toISOString() 74 |     }; 75 |  76 |     return NextResponse.json({ 77 |       success: true, 78 |       data: config 79 |     }); 80 |  81 |   } catch (error) { 82 |     return NextResponse.json({ 83 |       success: false, 84 |       error: 'Internal server error', 85 |       message: 'Failed to load live session configuration' 86 |     }, { status: 500 }); 87 |   } finally { 88 |     await prisma.$disconnect(); 89 |   } 90 | } 91 |  92 | export async function POST(request: NextRequest) { 93 |   try { 94 |     const user = await requireAuth(request); 95 |     if (!user) { 96 |       return NextResponse.json({ 97 |         success: false, 98 |         error: 'Unauthorized', 99 |         message: 'Authentication required'100 |       }, { status: 401 });101 |     }102 | 103 |     const body = await request.json();104 |     const validation = liveSessionConfigSchema.safeParse(body);105 | 106 |     if (!validation.success) {107 |       return NextResponse.json({108 |         success: false,109 |         error: 'Validation failed',110 |         message: 'Invalid configuration data',111 |         details: validation.error.issues112 |       }, { status: 400 });113 |     }114 | 115 |     const configData = validation.data;116 | 117 |     const savedConfig = {118 |       id: 'live-session-config-1',119 |       ...configData,120 |       createdAt: new Date().toISOString(),121 |       updatedAt: new Date().toISOString()122 |     };123 | 124 |     return NextResponse.json({125 |       success: true,126 |       data: savedConfig,127 |       message: 'Configuration saved successfully'128 |     });129 | 130 |   } catch (error) {131 |     return NextResponse.json({132 |       success: false,133 |       error: 'Internal server error',134 |       message: 'Failed to save configuration'135 |     }, { status: 500 });136 |   } finally {137 |     await prisma.$disconnect();138 |   }139 | }
============================================================END: frontend/app/api/admin/live-session-config/route.ts============================================================


============================================================FILE: frontend/app/api/admin/live-session-config/test/route.tsSIZE: 3.99 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 |   5 | const testConnectionSchema = z.object({  6 |   provider: z.enum(['zoom', 'meet', 'teams', 'weebly', 'custom']),  7 |   apiKey: z.string().min(1, 'API key is required'),  8 |   apiSecret: z.string().optional(),  9 |   weeblySettings: z.object({ 10 |     siteId: z.string().optional(), 11 |     clientId: z.string().optional(), 12 |     clientSecret: z.string().optional() 13 |   }).optional() 14 | }); 15 |  16 | export async function POST(request: NextRequest) { 17 |   try { 18 |     const user = await requireAuth(request); 19 |     if (!user) { 20 |       return NextResponse.json({ 21 |         success: false, 22 |         error: 'Unauthorized', 23 |         message: 'Authentication required' 24 |       }, { status: 401 }); 25 |     } 26 |  27 |     const body = await request.json(); 28 |     const validation = testConnectionSchema.safeParse(body); 29 |  30 |     if (!validation.success) { 31 |       return NextResponse.json({ 32 |         success: false, 33 |         error: 'Validation failed', 34 |         message: 'Invalid test data', 35 |         details: validation.error.issues 36 |       }, { status: 400 }); 37 |     } 38 |  39 |     const { provider, apiKey, apiSecret, weeblySettings } = validation.data; 40 |  41 |     let testResult = { success: false, message: '' }; 42 |  43 |     switch (provider) { 44 |       case 'zoom': 45 |  46 |         if (apiKey && apiSecret) { 47 |           testResult = { 48 |             success: true, 49 |             message: 'Zoom API connection successful' 50 |           }; 51 |         } else { 52 |           testResult = { 53 |             success: false, 54 |             message: 'Zoom API key and secret are required' 55 |           }; 56 |         } 57 |         break; 58 |  59 |       case 'meet': 60 |  61 |         if (apiKey) { 62 |           testResult = { 63 |             success: true, 64 |             message: 'Google Meet API connection successful' 65 |           }; 66 |         } else { 67 |           testResult = { 68 |             success: false, 69 |             message: 'Google Meet API key is required' 70 |           }; 71 |         } 72 |         break; 73 |  74 |       case 'teams': 75 |  76 |         if (apiKey) { 77 |           testResult = { 78 |             success: true, 79 |             message: 'Microsoft Teams API connection successful' 80 |           }; 81 |         } else { 82 |           testResult = { 83 |             success: false, 84 |             message: 'Microsoft Teams API key is required' 85 |           }; 86 |         } 87 |         break; 88 |  89 |       case 'weebly': 90 |  91 |         if (apiKey && weeblySettings?.siteId && weeblySettings?.clientId) { 92 |           testResult = { 93 |             success: true, 94 |             message: 'Weebly API connection successful' 95 |           }; 96 |         } else { 97 |           testResult = { 98 |             success: false, 99 |             message: 'Weebly API key, site ID, and client ID are required'100 |           };101 |         }102 |         break;103 | 104 |       case 'custom':105 | 106 |         if (apiKey) {107 |           testResult = {108 |             success: true,109 |             message: 'Custom API connection successful'110 |           };111 |         } else {112 |           testResult = {113 |             success: false,114 |             message: 'Custom API key is required'115 |           };116 |         }117 |         break;118 | 119 |       default:120 |         testResult = {121 |           success: false,122 |           message: 'Unknown provider'123 |         };124 |     }125 | 126 |     return NextResponse.json({127 |       success: testResult.success,128 |       message: testResult.message,129 |       provider: provider,130 |       timestamp: new Date().toISOString()131 |     });132 | 133 |   } catch (error) {134 |     return NextResponse.json({135 |       success: false,136 |       error: 'Internal server error',137 |       message: 'Failed to test connection'138 |     }, { status: 500 });139 |   }140 | }
============================================================END: frontend/app/api/admin/live-session-config/test/route.ts============================================================


============================================================FILE: frontend/app/api/admin/package-definitions/route.tsSIZE: 13.98 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | interface PackageDefinitionWhereClause {  7 |   packageType?: string;  8 |   isActive?: boolean;  9 |   sessionDurationId?: number; 10 | } 11 |  12 | interface PackageDefinitionSelectClause { 13 |   id: boolean; 14 |   name: boolean; 15 |   description: boolean; 16 |   sessionsCount: boolean; 17 |   sessionDurationId: boolean; 18 |   packageType: boolean; 19 |   maxGroupSize: boolean; 20 |   isActive: boolean; 21 |   isPopular: boolean; 22 |   displayOrder: boolean; 23 |   featured: boolean; 24 |   createdAt: boolean; 25 |   updatedAt: boolean; 26 |   sessionDuration?: { 27 |     select: { 28 |       id: boolean; 29 |       name: boolean; 30 |       duration_minutes: boolean; 31 |     }; 32 |   }; 33 |   packagePrices?: { 34 |     where?: { 35 |       isActive: boolean; 36 |     }; 37 |     select: { 38 |       id: boolean; 39 |       price: boolean; 40 |       currency: { 41 |         select: { 42 |           id: boolean; 43 |           code: boolean; 44 |           symbol: boolean; 45 |         }; 46 |       }; 47 |     }; 48 |   }; 49 |   _count?: { 50 |     packagePrices: boolean; 51 |   }; 52 | } 53 |  54 | const createPackageDefinitionSchema = z.object({ 55 |   name: z.string().min(1, 'Name is required').max(255, 'Name too long'), 56 |   description: z.string().optional(), 57 |   sessionsCount: z.number().int().positive('Sessions count must be positive'), 58 |   sessionDurationId: z.number().int().positive('Session duration ID must be positive'), 59 |   packageType: z.string().min(1, 'Package type is required').max(20, 'Package type too long'), 60 |   maxGroupSize: z.number().int().positive('Max group size must be positive').optional(), 61 |   isActive: z.boolean().default(true) 62 | }); 63 |  64 | const updatePackageDefinitionSchema = createPackageDefinitionSchema.partial().extend({ 65 |   id: z.number().int().positive('Package definition ID must be positive') 66 | }); 67 |  68 | const querySchema = z.object({ 69 |   packageType: z.string().optional(), 70 |   isActive: z.enum(['true', 'false']).optional(), 71 |   sessionDurationId: z.coerce.number().int().positive().optional(), 72 |   page: z.coerce.number().int().min(1).default(1), 73 |   limit: z.coerce.number().int().min(1).max(100).default(20), 74 |   enhanced: z.enum(['true', 'false']).optional() 75 | }); 76 |  77 | export async function GET(request: NextRequest) { 78 |   try { 79 |     const user = await requireAuth(request); 80 |     if (!user || user.role !== 'admin') { 81 |       return NextResponse.json({ 82 |         success: false, 83 |         error: 'Unauthorized', 84 |         message: 'Admin access required' 85 |       }, { status: 401 }); 86 |     } 87 |  88 |     const { searchParams } = new URL(request.url); 89 |     const queryParams = Object.fromEntries(searchParams.entries()); 90 |     const validation = querySchema.safeParse(queryParams); 91 |  92 |     if (!validation.success) { 93 |       return NextResponse.json({ 94 |         success: false, 95 |         error: 'Invalid query parameters', 96 |         details: validation.error.issues 97 |       }, { status: 400 }); 98 |     } 99 | 100 |     const { packageType, isActive, sessionDurationId, page, limit, enhanced } = validation.data;101 |     const offset = (page - 1) * limit;102 | 103 |     const where: PackageDefinitionWhereClause = {};104 | 105 |     if (packageType) where.packageType = packageType;106 |     if (isActive !== undefined) where.isActive = isActive === 'true';107 |     if (sessionDurationId) where.sessionDurationId = sessionDurationId;108 | 109 |     const select: PackageDefinitionSelectClause = {110 |       id: true,111 |       name: true,112 |       description: true,113 |       sessionsCount: true,114 |       sessionDurationId: true,115 |       packageType: true,116 |       maxGroupSize: true,117 |       isActive: true,118 |       isPopular: true,119 |       displayOrder: true,120 |       featured: true,121 |       createdAt: true,122 |       updatedAt: true,123 |       sessionDuration: {124 |         select: {125 |           id: true,126 |           name: true,127 |           duration_minutes: true128 |         }129 |       }130 |     };131 | 132 |     const queryOptions = enhanced === 'true' ? {133 |       where,134 |       skip: offset,135 |       take: limit,136 |       orderBy: { createdAt: 'desc' as const },137 |       include: {138 |         sessionDuration: {139 |           select: {140 |             id: true,141 |             name: true,142 |             duration_minutes: true143 |           }144 |         },145 |         packagePrices: {146 |           select: {147 |             id: true,148 |             price: true,149 |             isActive: true,150 |             currency: {151 |               select: {152 |                 id: true,153 |                 code: true,154 |                 symbol: true155 |               }156 |             }157 |           }158 |         },159 |         _count: {160 |           select: {161 |             packagePrices: true162 |           }163 |         }164 |       }165 |     } : {166 |       where,167 |       skip: offset,168 |       take: limit,169 |       orderBy: { createdAt: 'desc' as const },170 |       select171 |     };172 | 173 |     const [packageDefinitions, totalCount] = await Promise.all([174 | 175 |       prisma.packageDefinition.findMany(queryOptions as any),176 |       prisma.packageDefinition.count({ where })177 |     ]);178 | 179 |     if (packageDefinitions.length > 0) {180 |       );181 |     }182 | 183 |     const totalPages = Math.ceil(totalCount / limit);184 | 185 |     return NextResponse.json({186 |       success: true,187 |       data: packageDefinitions,188 |       pagination: {189 |         page,190 |         limit,191 |         total: totalCount,192 |         totalPages193 |       }194 |     });195 | 196 |   } catch (error) {197 |     return NextResponse.json({198 |       success: false,199 |       error: 'Internal server error',200 |       message: 'An unexpected error occurred',201 |       details: error instanceof Error ? error.message : 'Unknown error'202 |     }, { status: 500 });203 |   } finally {204 |     await prisma.$disconnect();205 |   }206 | }207 | 208 | export async function POST(request: NextRequest) {209 |   try {210 |     const user = await requireAuth(request);211 |     if (!user || user.role !== 'admin') {212 |       return NextResponse.json({213 |         success: false,214 |         error: 'Unauthorized',215 |         message: 'Admin access required'216 |       }, { status: 401 });217 |     }218 | 219 |     const body = await request.json();220 |     const validation = createPackageDefinitionSchema.safeParse(body);221 | 222 |     if (!validation.success) {223 |       return NextResponse.json({224 |         success: false,225 |         error: 'Validation failed',226 |         message: 'Invalid package definition data',227 |         details: validation.error.issues228 |       }, { status: 400 });229 |     }230 | 231 |     const packageData = validation.data;232 | 233 |     const sessionDuration = await prisma.sessionDuration.findUnique({234 |       where: { id: packageData.sessionDurationId }235 |     });236 | 237 |     if (!sessionDuration) {238 |       return NextResponse.json({239 |         success: false,240 |         error: 'Session duration not found',241 |         message: 'The specified session duration does not exist'242 |       }, { status: 404 });243 |     }244 | 245 |     const existingPackage = await prisma.packageDefinition.findFirst({246 |       where: { name: packageData.name }247 |     });248 | 249 |     if (existingPackage) {250 |       return NextResponse.json({251 |         success: false,252 |         error: 'Package definition already exists',253 |         message: 'A package definition with this name already exists'254 |       }, { status: 409 });255 |     }256 | 257 |     const newPackageDefinition = await prisma.packageDefinition.create({258 |       data: packageData,259 |       include: {260 |         sessionDuration: {261 |           select: {262 |             id: true,263 |             name: true,264 |             duration_minutes: true,265 |             description: true266 |           }267 |         }268 |       }269 |     });270 | 271 |     return NextResponse.json({272 |       success: true,273 |       message: 'Package definition created successfully',274 |       data: newPackageDefinition275 |     }, { status: 201 });276 | 277 |   } catch (error) {278 |     return NextResponse.json({279 |       success: false,280 |       error: 'Internal server error',281 |       message: 'Failed to create package definition',282 |       details: error instanceof Error ? error.message : 'Unknown error'283 |     }, { status: 500 });284 |   } finally {285 |     await prisma.$disconnect();286 |   }287 | }288 | 289 | export async function PUT(request: NextRequest) {290 |   try {291 |     const user = await requireAuth(request);292 |     if (!user || user.role !== 'admin') {293 |       return NextResponse.json({294 |         success: false,295 |         error: 'Unauthorized',296 |         message: 'Admin access required'297 |       }, { status: 401 });298 |     }299 | 300 |     const body = await request.json();301 |     const validation = updatePackageDefinitionSchema.safeParse(body);302 | 303 |     if (!validation.success) {304 |       return NextResponse.json({305 |         success: false,306 |         error: 'Validation failed',307 |         message: 'Invalid package definition update data',308 |         details: validation.error.issues309 |       }, { status: 400 });310 |     }311 | 312 |     const { id, ...updateData } = validation.data;313 | 314 |     const existingPackage = await prisma.packageDefinition.findUnique({315 |       where: { id }316 |     });317 | 318 |     if (!existingPackage) {319 |       return NextResponse.json({320 |         success: false,321 |         error: 'Package definition not found',322 |         message: 'Package definition with this ID does not exist'323 |       }, { status: 404 });324 |     }325 | 326 |     if (updateData.sessionDurationId) {327 |       const sessionDuration = await prisma.sessionDuration.findUnique({328 |         where: { id: updateData.sessionDurationId }329 |       });330 | 331 |       if (!sessionDuration) {332 |         return NextResponse.json({333 |           success: false,334 |           error: 'Session duration not found',335 |           message: 'The specified session duration does not exist'336 |         }, { status: 404 });337 |       }338 |     }339 | 340 |     if (updateData.name && updateData.name !== existingPackage.name) {341 |       const nameConflict = await prisma.packageDefinition.findFirst({342 |         where: {343 |           name: updateData.name,344 |           id: { not: id }345 |         }346 |       });347 | 348 |       if (nameConflict) {349 |         return NextResponse.json({350 |           success: false,351 |           error: 'Name conflict',352 |           message: 'A package definition with this name already exists'353 |         }, { status: 409 });354 |       }355 |     }356 | 357 |     const updatedPackageDefinition = await prisma.packageDefinition.update({358 |       where: { id },359 |       data: updateData,360 |       include: {361 |         sessionDuration: {362 |           select: {363 |             id: true,364 |             name: true,365 |             duration_minutes: true,366 |             description: true367 |           }368 |         }369 |       }370 |     });371 | 372 |     return NextResponse.json({373 |       success: true,374 |       message: 'Package definition updated successfully',375 |       data: updatedPackageDefinition376 |     });377 | 378 |   } catch (error) {379 |     return NextResponse.json({380 |       success: false,381 |       error: 'Internal server error',382 |       message: 'Failed to update package definition',383 |       details: error instanceof Error ? error.message : 'Unknown error'384 |     }, { status: 500 });385 |   } finally {386 |     await prisma.$disconnect();387 |   }388 | }389 | 390 | export async function DELETE(request: NextRequest) {391 |   try {392 |     const user = await requireAuth(request);393 |     if (!user || user.role !== 'admin') {394 |       return NextResponse.json({395 |         success: false,396 |         error: 'Unauthorized',397 |         message: 'Admin access required'398 |       }, { status: 401 });399 |     }400 | 401 |     const { searchParams } = new URL(request.url);402 |     const packageId = searchParams.get('id');403 | 404 |     if (!packageId) {405 |       return NextResponse.json({406 |         success: false,407 |         error: 'Missing ID',408 |         message: 'Package definition ID is required'409 |       }, { status: 400 });410 |     }411 | 412 |     const id = parseInt(packageId);413 |     if (isNaN(id)) {414 |       return NextResponse.json({415 |         success: false,416 |         error: 'Invalid ID',417 |         message: 'Package definition ID must be a number'418 |       }, { status: 400 });419 |     }420 | 421 |     const existingPackage = await prisma.packageDefinition.findUnique({422 |       where: { id },423 |       include: {424 |         packagePrices: {425 |           include: {426 |             userPackages: {427 |               where: { isActive: true }428 |             }429 |           }430 |         }431 |       }432 |     });433 | 434 |     if (!existingPackage) {435 |       return NextResponse.json({436 |         success: false,437 |         error: 'Package definition not found',438 |         message: 'Package definition with this ID does not exist'439 |       }, { status: 404 });440 |     }441 | 442 |     const hasActivePackages = existingPackage.packagePrices.some(443 |       price => price.userPackages.length > 0444 |     );445 | 446 |     if (hasActivePackages) {447 |       return NextResponse.json({448 |         success: false,449 |         error: 'Cannot delete package definition',450 |         message: 'Package definition has active user packages and cannot be deleted'451 |       }, { status: 400 });452 |     }453 | 454 |     await prisma.packageDefinition.delete({455 |       where: { id }456 |     });457 | 458 |     return NextResponse.json({459 |       success: true,460 |       message: 'Package definition deleted successfully'461 |     });462 | 463 |   } catch (error) {464 |     return NextResponse.json({465 |       success: false,466 |       error: 'Internal server error',467 |       message: 'Failed to delete package definition',468 |       details: error instanceof Error ? error.message : 'Unknown error'469 |     }, { status: 500 });470 |   } finally {471 |     await prisma.$disconnect();472 |   }473 | }
============================================================END: frontend/app/api/admin/package-definitions/route.ts============================================================


============================================================FILE: frontend/app/api/admin/package-prices/route.tsSIZE: 14.73 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const createPackagePriceSchema = z.object({  7 |   packageDefinitionId: z.number().int().positive('Package definition ID must be positive'),  8 |   currencyId: z.number().int().positive('Currency ID must be positive'),  9 |   price: z.number().positive('Price must be positive'), 10 |   pricingMode: z.enum(['custom', 'calculated']).default('calculated'), 11 |   isActive: z.boolean().default(true) 12 | }); 13 |  14 | const updatePackagePriceSchema = createPackagePriceSchema.partial().extend({ 15 |   id: z.number().int().positive('Package price ID must be positive') 16 | }); 17 |  18 | const querySchema = z.object({ 19 |   packageDefinitionId: z.coerce.number().int().positive().optional(), 20 |   currencyId: z.coerce.number().int().positive().optional(), 21 |   pricingMode: z.enum(['custom', 'calculated', 'all']).optional(), 22 |   isActive: z.enum(['true', 'false']).optional(), 23 |   page: z.coerce.number().int().min(1).default(1), 24 |   limit: z.coerce.number().int().min(1).max(100).default(20), 25 |   enhanced: z.enum(['true', 'false']).optional() 26 | }); 27 |  28 | export async function GET(request: NextRequest) { 29 |   try { 30 |     const user = await requireAuth(request); 31 |     if (!user || user.role !== 'admin') { 32 |       return NextResponse.json({ 33 |         success: false, 34 |         error: 'Unauthorized', 35 |         message: 'Admin access required' 36 |       }, { status: 401 }); 37 |     } 38 |  39 |     const { searchParams } = new URL(request.url); 40 |     const queryParams = Object.fromEntries(searchParams.entries()); 41 |     const validation = querySchema.safeParse(queryParams); 42 |  43 |     if (!validation.success) { 44 |       return NextResponse.json({ 45 |         success: false, 46 |         error: 'Invalid query parameters', 47 |         details: validation.error.issues 48 |       }, { status: 400 }); 49 |     } 50 |  51 |     const { packageDefinitionId, currencyId, pricingMode, isActive, page, limit, enhanced } = validation.data; 52 |     const offset = (page - 1) * limit; 53 |  54 |     const where: Record<string, unknown> = {}; 55 |  56 |     if (packageDefinitionId) where.packageDefinitionId = packageDefinitionId; 57 |     if (currencyId) where.currencyId = currencyId; 58 |     if (pricingMode && pricingMode !== 'all') where.pricingMode = pricingMode as 'custom' | 'calculated'; 59 |     if (isActive !== undefined) where.isActive = isActive === 'true'; 60 |  61 |     const select: Record<string, unknown> = { 62 |       id: true, 63 |       packageDefinitionId: true, 64 |       currencyId: true, 65 |       price: true, 66 |       pricingMode: true, 67 |       isActive: true, 68 |       createdAt: true, 69 |       updatedAt: true, 70 |       packageDefinition: { 71 |         select: { 72 |           id: true, 73 |           name: true, 74 |           description: true, 75 |           sessionsCount: true, 76 |           packageType: true, 77 |           maxGroupSize: true, 78 |           sessionDuration: { 79 |             select: { 80 |               id: true, 81 |               name: true, 82 |               duration_minutes: true 83 |             } 84 |           } 85 |         } 86 |       }, 87 |         currency: { 88 |           select: { 89 |             id: true, 90 |             code: true, 91 |             name: true, 92 |             symbol: true, 93 |             is_default: true 94 |           } 95 |         } 96 |     }; 97 |  98 |     if (enhanced === 'true') { 99 |       select._count = {100 |         userPackages: true101 |       };102 |       select.userPackages = {103 |         take: 5,104 |         orderBy: { createdAt: 'desc' },105 |         select: {106 |           id: true,107 |           quantity: true,108 |           isActive: true,109 |           createdAt: true,110 |           user: {111 |             select: {112 |               id: true,113 |               email: true,114 |               fullName: true115 |             }116 |           }117 |         }118 |       };119 |     }120 | 121 |     const [packagePrices, totalCount] = await Promise.all([122 |       prisma.packagePrice.findMany({123 |         where,124 |         select,125 |         skip: offset,126 |         take: limit,127 |         orderBy: [128 |           { packageDefinition: { name: 'asc' } },129 |           { currency: { code: 'asc' } },130 |           { price: 'asc' }131 |         ]132 |       }),133 |       prisma.packagePrice.count({ where })134 |     ]);135 | 136 |     const totalPages = Math.ceil(totalCount / limit);137 | 138 |     return NextResponse.json({139 |       success: true,140 |       data: packagePrices,141 |       pagination: {142 |         page,143 |         limit,144 |         total: totalCount,145 |         totalPages146 |       }147 |     });148 | 149 |   } catch (error) {150 |     return NextResponse.json({151 |       success: false,152 |       error: 'Internal server error',153 |       message: 'An unexpected error occurred',154 |       details: error instanceof Error ? error.message : 'Unknown error'155 |     }, { status: 500 });156 |   } finally {157 |     await prisma.$disconnect();158 |   }159 | }160 | 161 | export async function POST(request: NextRequest) {162 |   try {163 |     const user = await requireAuth(request);164 |     if (!user || user.role !== 'admin') {165 |       return NextResponse.json({166 |         success: false,167 |         error: 'Unauthorized',168 |         message: 'Admin access required'169 |       }, { status: 401 });170 |     }171 | 172 |     const body = await request.json();173 |     const validation = createPackagePriceSchema.safeParse(body);174 | 175 |     if (!validation.success) {176 |       return NextResponse.json({177 |         success: false,178 |         error: 'Validation failed',179 |         message: 'Invalid package price data',180 |         details: validation.error.issues181 |       }, { status: 400 });182 |     }183 | 184 |     const priceData = validation.data;185 | 186 |     const packageDefinition = await prisma.packageDefinition.findUnique({187 |       where: { id: priceData.packageDefinitionId }188 |     });189 | 190 |     if (!packageDefinition) {191 |       return NextResponse.json({192 |         success: false,193 |         error: 'Package definition not found',194 |         message: 'The specified package definition does not exist'195 |       }, { status: 404 });196 |     }197 | 198 |     const currency = await prisma.currency.findUnique({199 |       where: { id: priceData.currencyId }200 |     });201 | 202 |     if (!currency) {203 |       return NextResponse.json({204 |         success: false,205 |         error: 'Currency not found',206 |         message: 'The specified currency does not exist'207 |       }, { status: 404 });208 |     }209 | 210 |     const existingPrice = await prisma.packagePrice.findFirst({211 |       where: {212 |         packageDefinitionId: priceData.packageDefinitionId,213 |         currencyId: priceData.currencyId214 |       }215 |     });216 | 217 |     if (existingPrice) {218 |       return NextResponse.json({219 |         success: false,220 |         error: 'Price already exists',221 |         message: 'A price for this package and currency already exists'222 |       }, { status: 409 });223 |     }224 | 225 |     const newPackagePrice = await prisma.packagePrice.create({226 |       data: priceData,227 |       include: {228 |         packageDefinition: {229 |           select: {230 |             id: true,231 |             name: true,232 |             description: true,233 |             sessionsCount: true,234 |             packageType: true,235 |             maxGroupSize: true,236 |             sessionDuration: {237 |               select: {238 |                 id: true,239 |                 name: true,240 |                 duration_minutes: true241 |               }242 |             }243 |           }244 |         },245 |         currency: {246 |           select: {247 |             id: true,248 |             code: true,249 |             name: true,250 |             symbol: true,251 |             is_default: true252 |           }253 |         }254 |       }255 |     });256 | 257 |     return NextResponse.json({258 |       success: true,259 |       message: 'Package price created successfully',260 |       data: newPackagePrice261 |     }, { status: 201 });262 | 263 |   } catch (error) {264 |     return NextResponse.json({265 |       success: false,266 |       error: 'Internal server error',267 |       message: 'Failed to create package price',268 |       details: error instanceof Error ? error.message : 'Unknown error'269 |     }, { status: 500 });270 |   } finally {271 |     await prisma.$disconnect();272 |   }273 | }274 | 275 | export async function PUT(request: NextRequest) {276 |   try {277 |     const user = await requireAuth(request);278 |     if (!user || user.role !== 'admin') {279 |       return NextResponse.json({280 |         success: false,281 |         error: 'Unauthorized',282 |         message: 'Admin access required'283 |       }, { status: 401 });284 |     }285 | 286 |     const body = await request.json();287 |     const validation = updatePackagePriceSchema.safeParse(body);288 | 289 |     if (!validation.success) {290 |       return NextResponse.json({291 |         success: false,292 |         error: 'Validation failed',293 |         message: 'Invalid package price update data',294 |         details: validation.error.issues295 |       }, { status: 400 });296 |     }297 | 298 |     const { id, ...updateData } = validation.data;299 | 300 |     const existingPrice = await prisma.packagePrice.findUnique({301 |       where: { id }302 |     });303 | 304 |     if (!existingPrice) {305 |       return NextResponse.json({306 |         success: false,307 |         error: 'Package price not found',308 |         message: 'Package price with this ID does not exist'309 |       }, { status: 404 });310 |     }311 | 312 |     if (updateData.packageDefinitionId) {313 |       const packageDefinition = await prisma.packageDefinition.findUnique({314 |         where: { id: updateData.packageDefinitionId }315 |       });316 | 317 |       if (!packageDefinition) {318 |         return NextResponse.json({319 |           success: false,320 |           error: 'Package definition not found',321 |           message: 'The specified package definition does not exist'322 |         }, { status: 404 });323 |       }324 |     }325 | 326 |     if (updateData.currencyId) {327 |       const currency = await prisma.currency.findUnique({328 |         where: { id: updateData.currencyId }329 |       });330 | 331 |       if (!currency) {332 |         return NextResponse.json({333 |           success: false,334 |           error: 'Currency not found',335 |           message: 'The specified currency does not exist'336 |         }, { status: 404 });337 |       }338 |     }339 | 340 |     const isPackageChanging = updateData.packageDefinitionId && updateData.packageDefinitionId !== existingPrice.packageDefinitionId;341 |     const isCurrencyChanging = updateData.currencyId && updateData.currencyId !== existingPrice.currencyId;342 | 343 |     if (isPackageChanging || isCurrencyChanging) {344 |       const newPackageDefinitionId = updateData.packageDefinitionId ?? existingPrice.packageDefinitionId;345 |       const newCurrencyId = updateData.currencyId ?? existingPrice.currencyId;346 | 347 |       const conflict = await prisma.packagePrice.findFirst({348 |         where: {349 |           packageDefinitionId: newPackageDefinitionId,350 |           currencyId: newCurrencyId,351 |           id: { not: id }352 |         }353 |       });354 | 355 |       if (conflict) {356 |         return NextResponse.json({357 |           success: false,358 |           error: 'Price conflict',359 |           message: 'A price for this package and currency already exists'360 |         }, { status: 409 });361 |       }362 |     }363 | 364 |     const updatedPackagePrice = await prisma.packagePrice.update({365 |       where: { id },366 |       data: updateData,367 |       include: {368 |         packageDefinition: {369 |           select: {370 |             id: true,371 |             name: true,372 |             description: true,373 |             sessionsCount: true,374 |             packageType: true,375 |             maxGroupSize: true,376 |             sessionDuration: {377 |               select: {378 |                 id: true,379 |                 name: true,380 |                 duration_minutes: true381 |               }382 |             }383 |           }384 |         },385 |         currency: {386 |           select: {387 |             id: true,388 |             code: true,389 |             name: true,390 |             symbol: true,391 |             is_default: true392 |           }393 |         }394 |       }395 |     });396 | 397 |     return NextResponse.json({398 |       success: true,399 |       message: 'Package price updated successfully',400 |       data: updatedPackagePrice401 |     });402 | 403 |   } catch (error) {404 |     return NextResponse.json({405 |       success: false,406 |       error: 'Internal server error',407 |       message: 'Failed to update package price',408 |       details: error instanceof Error ? error.message : 'Unknown error'409 |     }, { status: 500 });410 |   } finally {411 |     await prisma.$disconnect();412 |   }413 | }414 | 415 | export async function DELETE(request: NextRequest) {416 |   try {417 |     const user = await requireAuth(request);418 |     if (!user || user.role !== 'admin') {419 |       return NextResponse.json({420 |         success: false,421 |         error: 'Unauthorized',422 |         message: 'Admin access required'423 |       }, { status: 401 });424 |     }425 | 426 |     const { searchParams } = new URL(request.url);427 |     const priceId = searchParams.get('id');428 | 429 |     if (!priceId) {430 |       return NextResponse.json({431 |         success: false,432 |         error: 'Missing ID',433 |         message: 'Package price ID is required'434 |       }, { status: 400 });435 |     }436 | 437 |     const id = parseInt(priceId);438 |     if (isNaN(id)) {439 |       return NextResponse.json({440 |         success: false,441 |         error: 'Invalid ID',442 |         message: 'Package price ID must be a number'443 |       }, { status: 400 });444 |     }445 | 446 |     const existingPrice = await prisma.packagePrice.findUnique({447 |       where: { id },448 |       include: {449 |         userPackages: {450 |           where: { isActive: true }451 |         }452 |       }453 |     });454 | 455 |     if (!existingPrice) {456 |       return NextResponse.json({457 |         success: false,458 |         error: 'Package price not found',459 |         message: 'Package price with this ID does not exist'460 |       }, { status: 404 });461 |     }462 | 463 |     if (existingPrice.userPackages.length > 0) {464 |       return NextResponse.json({465 |         success: false,466 |         error: 'Cannot delete package price',467 |         message: 'Package price is being used by active user packages and cannot be deleted'468 |       }, { status: 400 });469 |     }470 | 471 |     await prisma.packagePrice.delete({472 |       where: { id }473 |     });474 | 475 |     return NextResponse.json({476 |       success: true,477 |       message: 'Package price deleted successfully'478 |     });479 | 480 |   } catch (error) {481 |     return NextResponse.json({482 |       success: false,483 |       error: 'Internal server error',484 |       message: 'Failed to delete package price',485 |       details: error instanceof Error ? error.message : 'Unknown error'486 |     }, { status: 500 });487 |   } finally {488 |     await prisma.$disconnect();489 |   }490 | }
============================================================END: frontend/app/api/admin/package-prices/route.ts============================================================


============================================================FILE: frontend/app/api/admin/payment-methods/[id]/route.tsSIZE: 5.33 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | export async function GET(  6 |   { params }: { params: { id: string } }  7 | ) {  8 |   try {  9 |     const supabase = await createServerClient(); 10 |  11 |     const { data: { user }, error: authError } = await supabase.auth.getUser(); 12 |  13 |     if (authError || !user) { 14 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 15 |     } 16 |  17 |     const { data: adminCheck, error: adminError } = await supabase 18 |       .from('clients') 19 |       .select('status') 20 |       .eq('email', user.email) 21 |       .single(); 22 |  23 |     if (adminError || adminCheck?.status !== 'active') { 24 |       return NextResponse.json({ error: 'Admin access required' }, { status: 403 }); 25 |     } 26 |  27 |     const { data: paymentMethod, error } = await supabase 28 |       .from('payment_methods') 29 |       .select(` 30 |         *, 31 |         currencies:currency_id( 32 |           id, 33 |           code, 34 |           symbol, 35 |           name 36 |         ) 37 |       `) 38 |       .eq('id', params.id) 39 |       .single(); 40 |  41 |     if (error) { 42 |       return NextResponse.json({ error: 'Failed to fetch payment method' }, { status: 500 }); 43 |     } 44 |  45 |     if (!paymentMethod) { 46 |       return NextResponse.json({ error: 'Payment method not found' }, { status: 404 }); 47 |     } 48 |  49 |     return NextResponse.json({ 50 |       success: true, 51 |       data: paymentMethod 52 |     }); 53 |  54 |   } catch (error) { 55 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 56 |   } 57 | } 58 |  59 | export async function PUT( 60 |   request: NextRequest, 61 |   { params }: { params: { id: string } } 62 | ) { 63 |   try { 64 |     const user = await requireAuth(request); 65 |     if (!user) { 66 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 67 |     } 68 |  69 |     const supabase = await createServerClient(); 70 |  71 |     const body = await request.json(); 72 |     const { name, description, is_active, currency_id } = body; 73 |  74 |     if (!name || !currency_id) { 75 |       return NextResponse.json( 76 |         { error: 'Name and currency are required' }, 77 |         { status: 400 } 78 |       ); 79 |     } 80 |  81 |     const updateData: Record<string, unknown> = {}; 82 |     if (name !== undefined) updateData.name = name; 83 |     if (description !== undefined) updateData.description = description; 84 |     if (is_active !== undefined) updateData.is_active = is_active; 85 |     if (currency_id !== undefined) updateData.currency_id = currency_id; 86 |     updateData.updated_at = new Date().toISOString(); 87 |  88 |     const { data, error } = await supabase 89 |       .from('payment_methods') 90 |       .update(updateData) 91 |       .eq('id', params.id) 92 |       .select(` 93 |         *, 94 |         currencies:currency_id( 95 |           id, 96 |           code, 97 |           symbol, 98 |           name 99 |         )100 |       `)101 |       .single();102 | 103 |     if (error) {104 |       return NextResponse.json(105 |         { error: 'Failed to update payment method' },106 |         { status: 500 }107 |       );108 |     }109 | 110 |     return NextResponse.json({111 |       success: true,112 |       data,113 |       message: 'Payment method updated successfully'114 |     });115 |   } catch (error) {116 |     return NextResponse.json(117 |       { error: 'Internal server error' },118 |       { status: 500 }119 |     );120 |   }121 | }122 | 123 | export async function DELETE(124 |   { params }: { params: { id: string } }125 | ) {126 |   try {127 |     const supabase = await createServerClient();128 | 129 |     const { data: { user }, error: authError } = await supabase.auth.getUser();130 | 131 |     if (authError || !user) {132 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });133 |     }134 | 135 |     const { data: adminCheck, error: adminError } = await supabase136 |       .from('clients')137 |       .select('status')138 |       .eq('email', user.email)139 |       .single();140 | 141 |     if (adminError || adminCheck?.status !== 'active') {142 |       return NextResponse.json({ error: 'Admin access required' }, { status: 403 });143 |     }144 | 145 |     const { data: usageData, error: usageError } = await supabase146 |       .from('payment_records')147 |       .select('id')148 |       .eq('payment_method', params.id)149 |       .limit(1);150 | 151 |     if (usageError) {152 |       return NextResponse.json(153 |         { error: 'Failed to check payment method usage' },154 |         { status: 500 }155 |       );156 |     }157 | 158 |     if (usageData && usageData.length > 0) {159 |       return NextResponse.json(160 |         { error: 'Cannot delete payment method that is being used' },161 |         { status: 400 }162 |       );163 |     }164 | 165 |     const { error } = await supabase166 |       .from('payment_methods')167 |       .delete()168 |       .eq('id', params.id);169 | 170 |     if (error) {171 |       return NextResponse.json(172 |         { error: 'Failed to delete payment method' },173 |         { status: 500 }174 |       );175 |     }176 | 177 |     return NextResponse.json({ success: true });178 |   } catch (error) {179 |     return NextResponse.json(180 |       { error: 'Internal server error' },181 |       { status: 500 }182 |     );183 |   }184 | }
============================================================END: frontend/app/api/admin/payment-methods/[id]/route.ts============================================================


============================================================FILE: frontend/app/api/admin/payment-methods/route.tsSIZE: 5.98 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | interface PaymentMethodUpdateData {  6 |   name?: string;  7 |   type?: string;  8 |   description?: string;  9 |   icon?: string; 10 |   requiresConfirmation?: boolean; 11 |   autoAssignPackage?: boolean; 12 |   isActive?: boolean; 13 |   providerConfig?: Record<string, unknown>; 14 | } 15 |  16 | export async function GET(request: NextRequest) { 17 |   try { 18 |     const user = await requireAuth(request); 19 |     if (!user) { 20 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 21 |     } 22 |  23 |     await prisma.$connect(); 24 |  25 |     const paymentMethods = await prisma.paymentMethodConfig.findMany({ 26 |       select: { 27 |         id: true, 28 |         name: true, 29 |         type: true, 30 |         description: true, 31 |         icon: true, 32 |         requiresConfirmation: true, 33 |         autoAssignPackage: true, 34 |         isActive: true, 35 |         providerConfig: true, 36 |         createdAt: true, 37 |         updatedAt: true 38 |       }, 39 |       orderBy: { 40 |         name: 'asc' 41 |       } 42 |     }); 43 |  44 |     return NextResponse.json({ 45 |       success: true, 46 |       data: paymentMethods 47 |     }); 48 |  49 |   } catch (error) { 50 |     return NextResponse.json({ 51 |       error: 'Internal server error', 52 |       details: error instanceof Error ? error.message : 'Unknown error' 53 |     }, { status: 500 }); 54 |   } 55 | } 56 |  57 | export async function POST(request: NextRequest) { 58 |   try { 59 |     const user = await requireAuth(request); 60 |     if (!user) { 61 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 62 |     } 63 |  64 |     const body = await request.json(); 65 |  66 |     if (!body.name) { 67 |       return NextResponse.json({ error: 'Name is required' }, { status: 400 }); 68 |     } 69 |  70 |     const newPaymentMethod = await prisma.paymentMethodConfig.create({ 71 |       data: { 72 |         name: body.name, 73 |         type: body.type || 'custom', 74 |         description: body.description || null, 75 |         icon: body.icon || null, 76 |         requiresConfirmation: body.requiresConfirmation !== undefined ? body.requiresConfirmation : false, 77 |         autoAssignPackage: body.autoAssignPackage !== undefined ? body.autoAssignPackage : true, 78 |         isActive: body.isActive !== undefined ? body.isActive : true, 79 |         providerConfig: body.providerConfig || null 80 |       } 81 |     }); 82 |  83 |     return NextResponse.json({ 84 |       success: true, 85 |       data: newPaymentMethod, 86 |       message: 'Payment method created successfully' 87 |     }); 88 |  89 |   } catch (error) { 90 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 91 |   } 92 | } 93 |  94 | export async function PUT(request: NextRequest) { 95 |   try { 96 |     const user = await requireAuth(request); 97 |     if (!user) { 98 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 99 |     }100 | 101 |     const body = await request.json();102 |     const { id, name, type, description, icon, requiresConfirmation, autoAssignPackage, isActive, providerConfig } = body;103 | 104 |     if (!id) {105 |       return NextResponse.json({ error: 'ID is required' }, { status: 400 });106 |     }107 | 108 |     const updateData: PaymentMethodUpdateData = {};109 |     if (name !== undefined) updateData.name = name;110 |     if (type !== undefined) updateData.type = type;111 |     if (description !== undefined) updateData.description = description;112 |     if (icon !== undefined) updateData.icon = icon;113 |     if (requiresConfirmation !== undefined) updateData.requiresConfirmation = requiresConfirmation;114 |     if (autoAssignPackage !== undefined) updateData.autoAssignPackage = autoAssignPackage;115 |     if (isActive !== undefined) updateData.isActive = isActive;116 |     if (providerConfig !== undefined) updateData.providerConfig = providerConfig;117 | 118 |     const updatedPaymentMethod = await prisma.paymentMethodConfig.update({119 |       where: { id: parseInt(id) },120 | 121 |       data: updateData as any122 |     });123 | 124 |     return NextResponse.json({125 |       success: true,126 |       data: updatedPaymentMethod,127 |       message: 'Payment method updated successfully'128 |     });129 | 130 |   } catch (error) {131 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 });132 |   }133 | }134 | 135 | export async function DELETE(request: NextRequest) {136 |   try {137 |     const user = await requireAuth(request);138 |     if (!user) {139 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });140 |     }141 | 142 |     const { searchParams } = new URL(request.url);143 |     const id = searchParams.get('id');144 | 145 |     if (!id) {146 |       return NextResponse.json({ error: 'ID is required' }, { status: 400 });147 |     }148 | 149 |     await prisma.paymentMethodConfig.delete({150 |       where: { id: parseInt(id) }151 |     });152 | 153 |     return NextResponse.json({154 |       success: true,155 |       message: 'Payment method deleted successfully'156 |     });157 | 158 |   } catch (error) {159 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 });160 |   }161 | }
============================================================END: frontend/app/api/admin/payment-methods/route.ts============================================================


============================================================FILE: frontend/app/api/admin/purchases/route.tsSIZE: 16.23 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const createPurchaseSchema = z.object({  7 |   userId: z.string().cuid('Invalid user ID format'),  8 |   packages: z.array(z.object({  9 |     packagePriceId: z.number().int().positive('Package price ID must be positive'), 10 |     quantity: z.number().int().positive('Quantity must be positive').default(1) 11 |   })).min(1, 'At least one package must be specified'), 12 |   paymentMethod: z.string().min(1, 'Payment method is required'), 13 |   currencyCode: z.string().length(3, 'Currency code must be 3 characters'), 14 |   transactionId: z.string().optional(), 15 |   notes: z.string().optional() 16 | }); 17 |  18 | const updatePurchaseSchema = z.object({ 19 |   id: z.number().int().positive('Purchase ID must be positive'), 20 |   paymentStatus: z.enum(['pending', 'completed', 'failed', 'refunded']).optional(), 21 |   transactionId: z.string().optional(), 22 |   notes: z.string().optional(), 23 |   confirmedAt: z.string().datetime().optional() 24 | }); 25 |  26 | const querySchema = z.object({ 27 |   userId: z.string().cuid().optional(), 28 |   paymentStatus: z.enum(['pending', 'completed', 'failed', 'refunded']).optional(), 29 |   paymentMethod: z.string().optional(), 30 |   dateFrom: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(), 31 |   dateTo: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(), 32 |   page: z.coerce.number().int().min(1).default(1), 33 |   limit: z.coerce.number().int().min(1).max(100).default(20), 34 |   enhanced: z.enum(['true', 'false']).optional() 35 | }); 36 |  37 | export async function GET(request: NextRequest) { 38 |   try { 39 |     const user = await requireAuth(request); 40 |     if (!user || user.role !== 'admin') { 41 |       return NextResponse.json({ 42 |         success: false, 43 |         error: 'Unauthorized', 44 |         message: 'Admin access required' 45 |       }, { status: 401 }); 46 |     } 47 |  48 |     const { searchParams } = new URL(request.url); 49 |     const queryParams = Object.fromEntries(searchParams.entries()); 50 |     const validation = querySchema.safeParse(queryParams); 51 |  52 |     if (!validation.success) { 53 |       return NextResponse.json({ 54 |         success: false, 55 |         error: 'Invalid query parameters', 56 |         details: validation.error.issues 57 |       }, { status: 400 }); 58 |     } 59 |  60 |     const { userId, paymentStatus, paymentMethod, dateFrom, dateTo, page, limit, enhanced } = validation.data; 61 |     const offset = (page - 1) * limit; 62 |  63 |     const where: Record<string, unknown> = {}; 64 |  65 |     if (userId) where.userId = userId; 66 |     if (paymentStatus) where.paymentStatus = paymentStatus; 67 |     if (paymentMethod) where.paymentMethod = paymentMethod; 68 |     if (dateFrom) where.purchasedAt = { gte: new Date(`${dateFrom}T00:00:00Z`) }; 69 |     if (dateTo) { 70 |       where.purchasedAt = { 71 |         ...(where.purchasedAt || {}), 72 |         lte: new Date(`${dateTo}T23:59:59Z`) 73 |       }; 74 |     } 75 |  76 |     const select: Record<string, unknown> = { 77 |       id: true, 78 |       userId: true, 79 |       totalAmount: true, 80 |       currencyCode: true, 81 |       paymentMethod: true, 82 |       paymentStatus: true, 83 |       transactionId: true, 84 |       notes: true, 85 |       purchasedAt: true, 86 |       confirmedAt: true, 87 |       createdAt: true, 88 |       updatedAt: true, 89 |       user: { 90 |         select: { 91 |           id: true, 92 |           email: true, 93 |           fullName: true, 94 |           phone: true 95 |         } 96 |       } 97 |     }; 98 |  99 |     if (enhanced === 'true') {100 |       select.userPackages = {101 |         select: {102 |           id: true,103 |           quantity: true,104 |           sessionsUsed: true,105 |           isActive: true,106 |           expiresAt: true,107 |           packagePrice: {108 |             select: {109 |               id: true,110 |               price: true,111 |               pricingMode: true,112 |               packageDefinition: {113 |                 select: {114 |                   id: true,115 |                   name: true,116 |                   description: true,117 |                   sessionsCount: true,118 |                   packageType: true,119 |                   sessionDuration: {120 |                     select: {121 |                       name: true,122 |                       duration_minutes: true123 |                     }124 |                   }125 |                 }126 |               }127 |             }128 |           }129 |         }130 |       };131 |       select.paymentRecords = {132 |         select: {133 |           id: true,134 |           amount: true,135 |           paymentStatus: true,136 |           paymentDate: true,137 |           confirmedAt: true138 |         }139 |       };140 |     }141 | 142 |     const [purchases, totalCount] = await Promise.all([143 |       prisma.purchase.findMany({144 |         where,145 |         select,146 |         skip: offset,147 |         take: limit,148 |         orderBy: { createdAt: 'desc' }149 |       }),150 |       prisma.purchase.count({ where })151 |     ]);152 | 153 |     const totalPages = Math.ceil(totalCount / limit);154 | 155 |     return NextResponse.json({156 |       success: true,157 |       data: purchases,158 |       pagination: {159 |         page,160 |         limit,161 |         total: totalCount,162 |         totalPages163 |       }164 |     });165 | 166 |   } catch (error) {167 |     return NextResponse.json({168 |       success: false,169 |       error: 'Internal server error',170 |       message: 'An unexpected error occurred',171 |       details: error instanceof Error ? error.message : 'Unknown error'172 |     }, { status: 500 });173 |   } finally {174 |     await prisma.$disconnect();175 |   }176 | }177 | 178 | export async function POST(request: NextRequest) {179 |   try {180 |     const user = await requireAuth(request);181 |     if (!user || user.role !== 'admin') {182 |       return NextResponse.json({183 |         success: false,184 |         error: 'Unauthorized',185 |         message: 'Admin access required'186 |       }, { status: 401 });187 |     }188 | 189 |     const body = await request.json();190 |     const validation = createPurchaseSchema.safeParse(body);191 | 192 |     if (!validation.success) {193 |       return NextResponse.json({194 |         success: false,195 |         error: 'Validation failed',196 |         message: 'Invalid purchase data',197 |         details: validation.error.issues198 |       }, { status: 400 });199 |     }200 | 201 |     const { userId, packages, paymentMethod, currencyCode, transactionId, notes } = validation.data;202 | 203 |     const targetUser = await prisma.user.findUnique({204 |       where: { id: userId }205 |     });206 | 207 |     if (!targetUser) {208 |       return NextResponse.json({209 |         success: false,210 |         error: 'User not found',211 |         message: 'The specified user does not exist'212 |       }, { status: 404 });213 |     }214 | 215 |     const packagePriceIds = packages.map(pkg => pkg.packagePriceId);216 |     const packagePrices = await prisma.packagePrice.findMany({217 |       where: {218 |         id: { in: packagePriceIds },219 |         isActive: true220 |       },221 |       include: {222 |         packageDefinition: {223 |           select: {224 |             name: true,225 |             sessionsCount: true,226 |             isActive: true227 |           }228 |         }229 |       }230 |     });231 | 232 |     if (packagePrices.length !== packagePriceIds.length) {233 |       return NextResponse.json({234 |         success: false,235 |         error: 'Invalid package prices',236 |         message: 'Some package prices were not found or are inactive'237 |       }, { status: 400 });238 |     }239 | 240 |     const inactivePackages = packagePrices.filter(price => !price.packageDefinition.isActive);241 |     if (inactivePackages.length > 0) {242 |       return NextResponse.json({243 |         success: false,244 |         error: 'Inactive packages',245 |         message: 'Some packages are no longer active'246 |       }, { status: 400 });247 |     }248 | 249 |     let totalAmount = 0;250 |     for (const pkg of packages) {251 |       const price = packagePrices.find(p => p.id === pkg.packagePriceId);252 |       if (price) {253 |         totalAmount += Number(price.price) * pkg.quantity;254 |       }255 |     }256 | 257 |     const result = await prisma.$transaction(async (tx) => {258 | 259 |       const purchase = await tx.purchase.create({260 |         data: {261 |           userId,262 |           totalAmount,263 |           currencyCode,264 |           paymentMethod,265 |           paymentStatus: 'pending',266 |           transactionId,267 |           notes268 |         }269 |       });270 | 271 |       const userPackagePromises = packages.map(pkg => {272 |         return tx.userPackage.create({273 |           data: {274 |             userId,275 |             purchaseId: purchase.id,276 |             packagePriceId: pkg.packagePriceId,277 |             quantity: pkg.quantity,278 |             sessionsUsed: 0,279 |             isActive: true,280 | 281 |             expiresAt: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000)282 |           }283 |         });284 |       });285 | 286 |       const userPackages = await Promise.all(userPackagePromises);287 | 288 |       const paymentRecord = await tx.paymentRecord.create({289 |         data: {290 |           userId,291 |           purchaseId: purchase.id,292 |           amount: totalAmount,293 |           currencyCode,294 |           paymentMethod,295 |           paymentStatus: 'pending',296 |           transactionId297 |         }298 |       });299 | 300 |       return { purchase, userPackages, paymentRecord };301 |     });302 | 303 |     const completePurchase = await prisma.purchase.findUnique({304 |       where: { id: result.purchase.id },305 |       include: {306 |         user: {307 |           select: {308 |             id: true,309 |             email: true,310 |             fullName: true,311 |             phone: true312 |           }313 |         },314 |         userPackages: {315 |           include: {316 |             packagePrice: {317 |               include: {318 |                 packageDefinition: {319 |                   select: {320 |                     name: true,321 |                     sessionsCount: true,322 |                     sessionDuration: {323 |                       select: {324 |                         name: true,325 |                         duration_minutes: true326 |                       }327 |                     }328 |                   }329 |                 }330 |               }331 |             }332 |           }333 |         },334 |         paymentRecords: true335 |       }336 |     });337 | 338 |     return NextResponse.json({339 |       success: true,340 |       message: 'Purchase created successfully',341 |       data: completePurchase342 |     }, { status: 201 });343 | 344 |   } catch (error) {345 |     return NextResponse.json({346 |       success: false,347 |       error: 'Internal server error',348 |       message: 'Failed to create purchase',349 |       details: error instanceof Error ? error.message : 'Unknown error'350 |     }, { status: 500 });351 |   } finally {352 |     await prisma.$disconnect();353 |   }354 | }355 | 356 | export async function PUT(request: NextRequest) {357 |   try {358 |     const user = await requireAuth(request);359 |     if (!user || user.role !== 'admin') {360 |       return NextResponse.json({361 |         success: false,362 |         error: 'Unauthorized',363 |         message: 'Admin access required'364 |       }, { status: 401 });365 |     }366 | 367 |     const body = await request.json();368 |     const validation = updatePurchaseSchema.safeParse(body);369 | 370 |     if (!validation.success) {371 |       return NextResponse.json({372 |         success: false,373 |         error: 'Validation failed',374 |         message: 'Invalid purchase update data',375 |         details: validation.error.issues376 |       }, { status: 400 });377 |     }378 | 379 |     const { id, ...updateData } = validation.data;380 | 381 |     const existingPurchase = await prisma.purchase.findUnique({382 |       where: { id },383 |       include: { paymentRecords: true }384 |     });385 | 386 |     if (!existingPurchase) {387 |       return NextResponse.json({388 |         success: false,389 |         error: 'Purchase not found',390 |         message: 'Purchase with this ID does not exist'391 |       }, { status: 404 });392 |     }393 | 394 |     await prisma.$transaction(async (tx) => {395 |       const updatedPurchase = await tx.purchase.update({396 |         where: { id },397 |         data: {398 |           ...updateData,399 |           confirmedAt: updateData.confirmedAt ? new Date(updateData.confirmedAt) : undefined400 |         }401 |       });402 | 403 |       if (updateData.paymentStatus) {404 |         await tx.paymentRecord.updateMany({405 |           where: { purchaseId: id },406 |           data: {407 |             paymentStatus: updateData.paymentStatus,408 |             confirmedAt: updateData.paymentStatus === 'completed' ? new Date() : null409 |           }410 |         });411 |       }412 | 413 |       return updatedPurchase;414 |     });415 | 416 |     const completePurchase = await prisma.purchase.findUnique({417 |       where: { id },418 |       include: {419 |         user: {420 |           select: {421 |             id: true,422 |             email: true,423 |             fullName: true,424 |             phone: true425 |           }426 |         },427 |         userPackages: {428 |           include: {429 |             packagePrice: {430 |               include: {431 |                 packageDefinition: {432 |                   select: {433 |                     name: true,434 |                     sessionsCount: true435 |                   }436 |                 }437 |               }438 |             }439 |           }440 |         },441 |         paymentRecords: true442 |       }443 |     });444 | 445 |     return NextResponse.json({446 |       success: true,447 |       message: 'Purchase updated successfully',448 |       data: completePurchase449 |     });450 | 451 |   } catch (error) {452 |     return NextResponse.json({453 |       success: false,454 |       error: 'Internal server error',455 |       message: 'Failed to update purchase',456 |       details: error instanceof Error ? error.message : 'Unknown error'457 |     }, { status: 500 });458 |   } finally {459 |     await prisma.$disconnect();460 |   }461 | }462 | 463 | export async function DELETE(request: NextRequest) {464 |   try {465 |     const user = await requireAuth(request);466 |     if (!user || user.role !== 'admin') {467 |       return NextResponse.json({468 |         success: false,469 |         error: 'Unauthorized',470 |         message: 'Admin access required'471 |       }, { status: 401 });472 |     }473 | 474 |     const { searchParams } = new URL(request.url);475 |     const purchaseId = searchParams.get('id');476 | 477 |     if (!purchaseId) {478 |       return NextResponse.json({479 |         success: false,480 |         error: 'Missing ID',481 |         message: 'Purchase ID is required'482 |       }, { status: 400 });483 |     }484 | 485 |     const id = parseInt(purchaseId);486 |     if (isNaN(id)) {487 |       return NextResponse.json({488 |         success: false,489 |         error: 'Invalid ID',490 |         message: 'Purchase ID must be a number'491 |       }, { status: 400 });492 |     }493 | 494 |     const existingPurchase = await prisma.purchase.findUnique({495 |       where: { id },496 |       include: {497 |         userPackages: {498 |           include: {499 |             bookings: {500 |               where: {501 |                 status: { in: ['confirmed', 'pending'] }502 |               }503 |             }504 |           }505 |         }506 |       }507 |     });508 | 509 |     if (!existingPurchase) {510 |       return NextResponse.json({511 |         success: false,512 |         error: 'Purchase not found',513 |         message: 'Purchase with this ID does not exist'514 |       }, { status: 404 });515 |     }516 | 517 |     const hasActiveBookings = existingPurchase.userPackages.some(518 |       pkg => pkg.bookings.length > 0519 |     );520 | 521 |     if (hasActiveBookings) {522 |       return NextResponse.json({523 |         success: false,524 |         error: 'Cannot delete purchase',525 |         message: 'Purchase has active bookings and cannot be deleted'526 |       }, { status: 400 });527 |     }528 | 529 |     await prisma.purchase.delete({530 |       where: { id }531 |     });532 | 533 |     return NextResponse.json({534 |       success: true,535 |       message: 'Purchase deleted successfully'536 |     });537 | 538 |   } catch (error) {539 |     return NextResponse.json({540 |       success: false,541 |       error: 'Internal server error',542 |       message: 'Failed to delete purchase',543 |       details: error instanceof Error ? error.message : 'Unknown error'544 |     }, { status: 500 });545 |   } finally {546 |     await prisma.$disconnect();547 |   }548 | }
============================================================END: frontend/app/api/admin/purchases/route.ts============================================================


============================================================FILE: frontend/app/api/admin/schedule-slots/route.tsSIZE: 16.09 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const createScheduleSlotSchema = z.object({  7 |   scheduleTemplateId: z.number().int().positive('Schedule template ID must be positive'),  8 |   startTime: z.string().datetime('Invalid start time format'),  9 |   endTime: z.string().datetime('Invalid end time format'), 10 |   capacity: z.number().int().positive('Capacity must be positive').default(3), 11 |   bookedCount: z.number().int().min(0, 'Booked count cannot be negative').default(0), 12 |   isAvailable: z.boolean().default(true) 13 | }); 14 |  15 | const updateScheduleSlotSchema = createScheduleSlotSchema.partial().extend({ 16 |   id: z.number().int().positive('Schedule slot ID must be positive') 17 | }); 18 |  19 | const querySchema = z.object({ 20 |   scheduleTemplateId: z.coerce.number().int().positive().optional(), 21 |   isAvailable: z.enum(['true', 'false']).optional(), 22 |   dateFrom: z.string().datetime().optional(), 23 |   dateTo: z.string().datetime().optional(), 24 |   hasCapacity: z.enum(['true', 'false']).optional(), 25 |   page: z.coerce.number().int().min(1).default(1), 26 |   limit: z.coerce.number().int().min(1).max(100).default(20), 27 |   enhanced: z.enum(['true', 'false']).optional() 28 | }); 29 |  30 | export async function GET(request: NextRequest) { 31 |   try { 32 |     const user = await requireAuth(request); 33 |     if (!user || user.role !== 'admin') { 34 |       return NextResponse.json({ 35 |         success: false, 36 |         error: 'Unauthorized', 37 |         message: 'Admin access required' 38 |       }, { status: 401 }); 39 |     } 40 |  41 |     const { searchParams } = new URL(request.url); 42 |     const queryParams = Object.fromEntries(searchParams.entries()); 43 |     const validation = querySchema.safeParse(queryParams); 44 |  45 |     if (!validation.success) { 46 |       return NextResponse.json({ 47 |         success: false, 48 |         error: 'Invalid query parameters', 49 |         details: validation.error.issues 50 |       }, { status: 400 }); 51 |     } 52 |  53 |     const { scheduleTemplateId, isAvailable, dateFrom, dateTo, hasCapacity, page, limit, enhanced } = validation.data; 54 |     const offset = (page - 1) * limit; 55 |  56 |     const where: Record<string, unknown> = {}; 57 |  58 |     if (scheduleTemplateId) where.scheduleTemplateId = scheduleTemplateId; 59 |     if (isAvailable !== undefined) where.isAvailable = isAvailable === 'true'; 60 |     if (dateFrom) where.startTime = { gte: new Date(dateFrom) }; 61 |     if (dateTo) { 62 |       where.startTime = { 63 |         ...(where.startTime || {}), 64 |         lte: new Date(dateTo) 65 |       }; 66 |     } 67 |  68 |     if (hasCapacity === 'true') { 69 |       where.OR = [ 70 |         { capacity: null }, 71 |         { capacity: { not: null } } 72 |       ]; 73 |     } else if (hasCapacity === 'false') { 74 |       where.capacity = { not: null }; 75 |     } 76 |  77 |     const baseSelect = { 78 |       id: true, 79 |       scheduleTemplateId: true, 80 |       startTime: true, 81 |       endTime: true, 82 |       capacity: true, 83 |       bookedCount: true, 84 |       isAvailable: true, 85 |       createdAt: true, 86 |       updatedAt: true, 87 |       scheduleTemplate: { 88 |         select: { 89 |           id: true, 90 |           dayOfWeek: true, 91 |           startTime: true, 92 |           endTime: true, 93 |           capacity: true, 94 |           sessionDuration: { 95 |             select: { 96 |               id: true, 97 |               name: true, 98 |               duration_minutes: true 99 |             }100 |           }101 |         }102 |       }103 |     };104 | 105 |     const enhancedInclude = {106 |       scheduleTemplate: {107 |         select: {108 |           id: true,109 |           dayOfWeek: true,110 |           startTime: true,111 |           endTime: true,112 |           capacity: true,113 |           sessionDuration: {114 |             select: {115 |               id: true,116 |               name: true,117 |               duration_minutes: true118 |             }119 |           }120 |         }121 |       },122 |       bookings: {123 |         take: 5,124 |         orderBy: { createdAt: 'desc' as const },125 |         select: {126 |           id: true,127 |           sessionType: true,128 |           status: true,129 |           createdAt: true,130 |           user: {131 |             select: {132 |               id: true,133 |               email: true,134 |               fullName: true135 |             }136 |           }137 |         }138 |       },139 |       _count: {140 |         select: {141 |           bookings: true142 |         }143 |       }144 |     };145 | 146 |     const [scheduleSlots, totalCount] = await Promise.all([147 |       enhanced === 'true'148 |         ? prisma.scheduleSlot.findMany({149 |             where,150 |             include: enhancedInclude,151 |             skip: offset,152 |             take: limit,153 |             orderBy: { startTime: 'asc' }154 |           })155 |         : prisma.scheduleSlot.findMany({156 |             where,157 |             select: baseSelect,158 |             skip: offset,159 |             take: limit,160 |             orderBy: { startTime: 'asc' }161 |           }),162 |       prisma.scheduleSlot.count({ where })163 |     ]);164 | 165 |     const totalPages = Math.ceil(totalCount / limit);166 | 167 |     return NextResponse.json({168 |       success: true,169 |       data: scheduleSlots,170 |       pagination: {171 |         page,172 |         limit,173 |         total: totalCount,174 |         totalPages175 |       }176 |     });177 | 178 |   } catch (error) {179 |     return NextResponse.json({180 |       success: false,181 |       error: 'Internal server error',182 |       message: 'An unexpected error occurred',183 |       details: error instanceof Error ? error.message : 'Unknown error'184 |     }, { status: 500 });185 |   }186 | }187 | 188 | export async function POST(request: NextRequest) {189 |   try {190 |     const user = await requireAuth(request);191 |     if (!user || user.role !== 'admin') {192 |       return NextResponse.json({193 |         success: false,194 |         error: 'Unauthorized',195 |         message: 'Admin access required'196 |       }, { status: 401 });197 |     }198 | 199 |     const body = await request.json();200 |     const validation = createScheduleSlotSchema.safeParse(body);201 | 202 |     if (!validation.success) {203 |       return NextResponse.json({204 |         success: false,205 |         error: 'Validation failed',206 |         message: 'Invalid schedule slot data',207 |         details: validation.error.issues208 |       }, { status: 400 });209 |     }210 | 211 |     const slotData = validation.data;212 | 213 |     const startTime = new Date(slotData.startTime);214 |     const endTime = new Date(slotData.endTime);215 | 216 |     if (startTime >= endTime) {217 |       return NextResponse.json({218 |         success: false,219 |         error: 'Invalid time range',220 |         message: 'End time must be after start time'221 |       }, { status: 400 });222 |     }223 | 224 |     const scheduleTemplate = await prisma.scheduleTemplate.findUnique({225 |       where: { id: slotData.scheduleTemplateId }226 |     });227 | 228 |     if (!scheduleTemplate) {229 |       return NextResponse.json({230 |         success: false,231 |         error: 'Schedule template not found',232 |         message: 'The specified schedule template does not exist'233 |       }, { status: 404 });234 |     }235 | 236 |     if (slotData.bookedCount > slotData.capacity) {237 |       return NextResponse.json({238 |         success: false,239 |         error: 'Invalid capacity',240 |         message: 'Booked count cannot exceed capacity'241 |       }, { status: 400 });242 |     }243 | 244 |     const overlappingSlot = await prisma.scheduleSlot.findFirst({245 |       where: {246 |         scheduleTemplateId: slotData.scheduleTemplateId,247 |         OR: [248 |           {249 |             startTime: { lt: endTime },250 |             endTime: { gt: startTime }251 |           }252 |         ]253 |       }254 |     });255 | 256 |     if (overlappingSlot) {257 |       return NextResponse.json({258 |         success: false,259 |         error: 'Time conflict',260 |         message: 'This time slot overlaps with an existing slot'261 |       }, { status: 409 });262 |     }263 | 264 |     const newScheduleSlot = await prisma.scheduleSlot.create({265 |       data: slotData,266 |       include: {267 |         scheduleTemplate: {268 |           select: {269 |             id: true,270 |             dayOfWeek: true,271 |             startTime: true,272 |             endTime: true,273 |             capacity: true,274 |             sessionDuration: {275 |               select: {276 |                 id: true,277 |                 name: true,278 |                 duration_minutes: true279 |               }280 |             }281 |           }282 |         }283 |       }284 |     });285 | 286 |     return NextResponse.json({287 |       success: true,288 |       message: 'Schedule slot created successfully',289 |       data: newScheduleSlot290 |     }, { status: 201 });291 | 292 |   } catch (error) {293 |     return NextResponse.json({294 |       success: false,295 |       error: 'Internal server error',296 |       message: 'Failed to create schedule slot',297 |       details: error instanceof Error ? error.message : 'Unknown error'298 |     }, { status: 500 });299 |   } finally {300 |     await prisma.$disconnect();301 |   }302 | }303 | 304 | export async function PUT(request: NextRequest) {305 |   try {306 |     const user = await requireAuth(request);307 |     if (!user || user.role !== 'admin') {308 |       return NextResponse.json({309 |         success: false,310 |         error: 'Unauthorized',311 |         message: 'Admin access required'312 |       }, { status: 401 });313 |     }314 | 315 |     const body = await request.json();316 |     const validation = updateScheduleSlotSchema.safeParse(body);317 | 318 |     if (!validation.success) {319 |       return NextResponse.json({320 |         success: false,321 |         error: 'Validation failed',322 |         message: 'Invalid schedule slot update data',323 |         details: validation.error.issues324 |       }, { status: 400 });325 |     }326 | 327 |     const { id, ...updateData } = validation.data;328 | 329 |     const existingSlot = await prisma.scheduleSlot.findUnique({330 |       where: { id }331 |     });332 | 333 |     if (!existingSlot) {334 |       return NextResponse.json({335 |         success: false,336 |         error: 'Schedule slot not found',337 |         message: 'Schedule slot with this ID does not exist'338 |       }, { status: 404 });339 |     }340 | 341 |     if (updateData.startTime || updateData.endTime) {342 |       const startTime = updateData.startTime ? new Date(updateData.startTime) : existingSlot.startTime;343 |       const endTime = updateData.endTime ? new Date(updateData.endTime) : existingSlot.endTime;344 | 345 |       if (startTime >= endTime) {346 |         return NextResponse.json({347 |           success: false,348 |           error: 'Invalid time range',349 |           message: 'End time must be after start time'350 |         }, { status: 400 });351 |       }352 |     }353 | 354 |     if (updateData.scheduleTemplateId) {355 |       const scheduleTemplate = await prisma.scheduleTemplate.findUnique({356 |         where: { id: updateData.scheduleTemplateId }357 |       });358 | 359 |       if (!scheduleTemplate) {360 |         return NextResponse.json({361 |           success: false,362 |           error: 'Schedule template not found',363 |           message: 'The specified schedule template does not exist'364 |         }, { status: 404 });365 |       }366 |     }367 | 368 |     if (updateData.capacity !== undefined || updateData.bookedCount !== undefined) {369 |       const newCapacity = updateData.capacity ?? existingSlot.capacity;370 |       const newBookedCount = updateData.bookedCount ?? existingSlot.bookedCount;371 | 372 |       if (newBookedCount && newCapacity && newBookedCount > newCapacity) {373 |         return NextResponse.json({374 |           success: false,375 |           error: 'Invalid capacity',376 |           message: 'Booked count cannot exceed capacity'377 |         }, { status: 400 });378 |       }379 |     }380 | 381 |     if (updateData.startTime || updateData.endTime) {382 |       const newStartTime = updateData.startTime ? new Date(updateData.startTime) : existingSlot.startTime;383 |       const newEndTime = updateData.endTime ? new Date(updateData.endTime) : existingSlot.endTime;384 |       const newTemplateId = updateData.scheduleTemplateId ?? existingSlot.scheduleTemplateId;385 | 386 |       const overlappingSlot = await prisma.scheduleSlot.findFirst({387 |         where: {388 |           scheduleTemplateId: newTemplateId,389 |           id: { not: id },390 |           OR: [391 |             {392 |               startTime: { lt: newEndTime },393 |               endTime: { gt: newStartTime }394 |             }395 |           ]396 |         }397 |       });398 | 399 |       if (overlappingSlot) {400 |         return NextResponse.json({401 |           success: false,402 |           error: 'Time conflict',403 |           message: 'This time slot overlaps with an existing slot'404 |         }, { status: 409 });405 |       }406 |     }407 | 408 |     const updatedScheduleSlot = await prisma.scheduleSlot.update({409 |       where: { id },410 |       data: updateData,411 |       include: {412 |         scheduleTemplate: {413 |           select: {414 |             id: true,415 |             dayOfWeek: true,416 |             startTime: true,417 |             endTime: true,418 |             capacity: true,419 |             sessionDuration: {420 |               select: {421 |                 id: true,422 |                 name: true,423 |                 duration_minutes: true424 |               }425 |             }426 |           }427 |         }428 |       }429 |     });430 | 431 |     return NextResponse.json({432 |       success: true,433 |       message: 'Schedule slot updated successfully',434 |       data: updatedScheduleSlot435 |     });436 | 437 |   } catch (error) {438 |     return NextResponse.json({439 |       success: false,440 |       error: 'Internal server error',441 |       message: 'Failed to update schedule slot',442 |       details: error instanceof Error ? error.message : 'Unknown error'443 |     }, { status: 500 });444 |   } finally {445 |     await prisma.$disconnect();446 |   }447 | }448 | 449 | export async function DELETE(request: NextRequest) {450 |   try {451 |     const user = await requireAuth(request);452 |     if (!user || user.role !== 'admin') {453 |       return NextResponse.json({454 |         success: false,455 |         error: 'Unauthorized',456 |         message: 'Admin access required'457 |       }, { status: 401 });458 |     }459 | 460 |     const { searchParams } = new URL(request.url);461 |     const slotId = searchParams.get('id');462 | 463 |     if (!slotId) {464 |       return NextResponse.json({465 |         success: false,466 |         error: 'Missing ID',467 |         message: 'Schedule slot ID is required'468 |       }, { status: 400 });469 |     }470 | 471 |     const id = parseInt(slotId);472 |     if (isNaN(id)) {473 |       return NextResponse.json({474 |         success: false,475 |         error: 'Invalid ID',476 |         message: 'Schedule slot ID must be a number'477 |       }, { status: 400 });478 |     }479 | 480 |     const existingSlot = await prisma.scheduleSlot.findUnique({481 |       where: { id },482 |       include: {483 |         bookings: {484 |           where: {485 |             status: { in: ['confirmed', 'pending'] }486 |           }487 |         }488 |       }489 |     });490 | 491 |     if (!existingSlot) {492 |       return NextResponse.json({493 |         success: false,494 |         error: 'Schedule slot not found',495 |         message: 'Schedule slot with this ID does not exist'496 |       }, { status: 404 });497 |     }498 | 499 |     if (existingSlot.bookings.length > 0) {500 |       return NextResponse.json({501 |         success: false,502 |         error: 'Cannot delete schedule slot',503 |         message: 'Schedule slot has active bookings and cannot be deleted'504 |       }, { status: 400 });505 |     }506 | 507 |     await prisma.scheduleSlot.delete({508 |       where: { id }509 |     });510 | 511 |     return NextResponse.json({512 |       success: true,513 |       message: 'Schedule slot deleted successfully'514 |     });515 | 516 |   } catch (error) {517 |     return NextResponse.json({518 |       success: false,519 |       error: 'Internal server error',520 |       message: 'Failed to delete schedule slot',521 |       details: error instanceof Error ? error.message : 'Unknown error'522 |     }, { status: 500 });523 |   } finally {524 |     await prisma.$disconnect();525 |   }526 | }
============================================================END: frontend/app/api/admin/schedule-slots/route.ts============================================================


============================================================FILE: frontend/app/api/admin/schedule-templates/route.tsSIZE: 14.75 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | interface ScheduleTemplateWhereClause {  7 |   dayOfWeek?: string;  8 |   isAvailable?: boolean;  9 |   sessionDurationId?: number; 10 |   autoAvailable?: boolean; 11 | } 12 |  13 | interface ScheduleTemplateSelectClause { 14 |   id: boolean; 15 |   dayOfWeek: boolean; 16 |   startTime: boolean; 17 |   endTime: boolean; 18 |   capacity: boolean; 19 |   isAvailable: boolean; 20 |   sessionDurationId: boolean; 21 |   autoAvailable: boolean; 22 |   createdAt: boolean; 23 |   updatedAt: boolean; 24 |   sessionDuration?: { 25 |     select: { 26 |       id: boolean; 27 |       name: boolean; 28 |       duration_minutes: boolean; 29 |     }; 30 |   }; 31 |   scheduleSlots?: { 32 |     take?: number; 33 |     orderBy?: { 34 |       startTime: 'asc' | 'desc'; 35 |     }; 36 |     select: { 37 |       id: boolean; 38 |       startTime: boolean; 39 |       endTime: boolean; 40 |       isAvailable: boolean; 41 |       bookedCount: boolean; 42 |       capacity: boolean; 43 |     }; 44 |   }; 45 | } 46 |  47 | const createScheduleTemplateSchema = z.object({ 48 |   dayOfWeek: z.string().min(1, 'Day of week is required').max(20, 'Day of week too long'), 49 |   startTime: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)'), 50 |   endTime: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)'), 51 |   capacity: z.number().int().positive('Capacity must be positive').default(3), 52 |   isAvailable: z.boolean().default(true), 53 |   sessionDurationId: z.number().int().positive('Session duration ID must be positive').optional(), 54 |   autoAvailable: z.boolean().default(true) 55 | }); 56 |  57 | const updateScheduleTemplateSchema = createScheduleTemplateSchema.partial().extend({ 58 |   id: z.number().int().positive('Schedule template ID must be positive') 59 | }); 60 |  61 | const querySchema = z.object({ 62 |   dayOfWeek: z.string().optional(), 63 |   isAvailable: z.enum(['true', 'false']).optional(), 64 |   sessionDurationId: z.coerce.number().int().positive().optional(), 65 |   autoAvailable: z.enum(['true', 'false']).optional(), 66 |   page: z.coerce.number().int().min(1).default(1), 67 |   limit: z.coerce.number().int().min(1).max(100).default(20), 68 |   enhanced: z.enum(['true', 'false']).optional() 69 | }); 70 |  71 | export async function GET(request: NextRequest) { 72 |   try { 73 |     const user = await requireAuth(request); 74 |     if (!user || user.role !== 'admin') { 75 |       return NextResponse.json({ 76 |         success: false, 77 |         error: 'Unauthorized', 78 |         message: 'Admin access required' 79 |       }, { status: 401 }); 80 |     } 81 |  82 |     const { searchParams } = new URL(request.url); 83 |     const queryParams = Object.fromEntries(searchParams.entries()); 84 |     const validation = querySchema.safeParse(queryParams); 85 |  86 |     if (!validation.success) { 87 |       return NextResponse.json({ 88 |         success: false, 89 |         error: 'Invalid query parameters', 90 |         details: validation.error.issues 91 |       }, { status: 400 }); 92 |     } 93 |  94 |     const { dayOfWeek, isAvailable, sessionDurationId, autoAvailable, page, limit, enhanced } = validation.data; 95 |     const offset = (page - 1) * limit; 96 |  97 |     const where: ScheduleTemplateWhereClause = {}; 98 |  99 |     if (dayOfWeek) where.dayOfWeek = dayOfWeek;100 |     if (isAvailable !== undefined) where.isAvailable = isAvailable === 'true';101 |     if (sessionDurationId) where.sessionDurationId = sessionDurationId;102 |     if (autoAvailable !== undefined) where.autoAvailable = autoAvailable === 'true';103 | 104 |     const select: ScheduleTemplateSelectClause = {105 |       id: true,106 |       dayOfWeek: true,107 |       startTime: true,108 |       endTime: true,109 |       capacity: true,110 |       isAvailable: true,111 |       sessionDurationId: true,112 |       autoAvailable: true,113 |       createdAt: true,114 |       updatedAt: true,115 |       sessionDuration: {116 |         select: {117 |           id: true,118 |           name: true,119 |           duration_minutes: true120 |         }121 |       }122 |     };123 | 124 |     let enhancedSelect = select;125 |     if (enhanced === 'true') {126 |       enhancedSelect = {127 |         ...select,128 |         scheduleSlots: {129 |           take: 10,130 |           orderBy: { startTime: 'desc' },131 |           select: {132 |             id: true,133 |             startTime: true,134 |             endTime: true,135 |             capacity: true,136 |             bookedCount: true,137 |             isAvailable: true138 |           }139 |         }140 |       };141 |     }142 | 143 |     const [scheduleTemplates, totalCount] = await Promise.all([144 |       prisma.scheduleTemplate.findMany({145 |         where,146 |         select: enhancedSelect,147 |         skip: offset,148 |         take: limit,149 |         orderBy: [150 |           { dayOfWeek: 'asc' },151 |           { startTime: 'asc' }152 |         ]153 |       }),154 |       prisma.scheduleTemplate.count({ where })155 |     ]);156 | 157 |     const totalPages = Math.ceil(totalCount / limit);158 | 159 |     return NextResponse.json({160 |       success: true,161 |       data: scheduleTemplates,162 |       pagination: {163 |         page,164 |         limit,165 |         total: totalCount,166 |         totalPages167 |       }168 |     });169 | 170 |   } catch (error) {171 |     return NextResponse.json({172 |       success: false,173 |       error: 'Internal server error',174 |       message: 'An unexpected error occurred',175 |       details: error instanceof Error ? error.message : 'Unknown error'176 |     }, { status: 500 });177 |   } finally {178 |     await prisma.$disconnect();179 |   }180 | }181 | 182 | export async function POST(request: NextRequest) {183 |   try {184 |     const user = await requireAuth(request);185 |     if (!user || user.role !== 'admin') {186 |       return NextResponse.json({187 |         success: false,188 |         error: 'Unauthorized',189 |         message: 'Admin access required'190 |       }, { status: 401 });191 |     }192 | 193 |     const body = await request.json();194 |     const validation = createScheduleTemplateSchema.safeParse(body);195 | 196 |     if (!validation.success) {197 |       return NextResponse.json({198 |         success: false,199 |         error: 'Validation failed',200 |         message: 'Invalid schedule template data',201 |         details: validation.error.issues202 |       }, { status: 400 });203 |     }204 | 205 |     const templateData = validation.data;206 | 207 |     const startTime = new Date(`2000-01-01T${templateData.startTime}:00`);208 |     const endTime = new Date(`2000-01-01T${templateData.endTime}:00`);209 | 210 |     if (startTime >= endTime) {211 |       return NextResponse.json({212 |         success: false,213 |         error: 'Invalid time range',214 |         message: 'End time must be after start time'215 |       }, { status: 400 });216 |     }217 | 218 |     if (templateData.sessionDurationId) {219 |       const sessionDuration = await prisma.sessionDuration.findUnique({220 |         where: { id: templateData.sessionDurationId }221 |       });222 | 223 |       if (!sessionDuration) {224 |         return NextResponse.json({225 |           success: false,226 |           error: 'Session duration not found',227 |           message: 'The specified session duration does not exist'228 |         }, { status: 404 });229 |       }230 |     }231 | 232 |     const existingTemplate = await prisma.scheduleTemplate.findFirst({233 |       where: {234 |         dayOfWeek: templateData.dayOfWeek,235 |         startTime: templateData.startTime,236 |         endTime: templateData.endTime237 |       }238 |     });239 | 240 |     if (existingTemplate) {241 |       return NextResponse.json({242 |         success: false,243 |         error: 'Template already exists',244 |         message: 'A schedule template for this day and time already exists'245 |       }, { status: 409 });246 |     }247 | 248 |     const newScheduleTemplate = await prisma.scheduleTemplate.create({249 |       data: templateData,250 |       include: {251 |         sessionDuration: {252 |           select: {253 |             id: true,254 |             name: true,255 |             duration_minutes: true,256 |             description: true257 |           }258 |         }259 |       }260 |     });261 | 262 |     return NextResponse.json({263 |       success: true,264 |       message: 'Schedule template created successfully',265 |       data: newScheduleTemplate266 |     }, { status: 201 });267 | 268 |   } catch (error) {269 |     return NextResponse.json({270 |       success: false,271 |       error: 'Internal server error',272 |       message: 'Failed to create schedule template',273 |       details: error instanceof Error ? error.message : 'Unknown error'274 |     }, { status: 500 });275 |   } finally {276 |     await prisma.$disconnect();277 |   }278 | }279 | 280 | export async function PUT(request: NextRequest) {281 |   try {282 |     const user = await requireAuth(request);283 |     if (!user || user.role !== 'admin') {284 |       return NextResponse.json({285 |         success: false,286 |         error: 'Unauthorized',287 |         message: 'Admin access required'288 |       }, { status: 401 });289 |     }290 | 291 |     const body = await request.json();292 |     const validation = updateScheduleTemplateSchema.safeParse(body);293 | 294 |     if (!validation.success) {295 |       return NextResponse.json({296 |         success: false,297 |         error: 'Validation failed',298 |         message: 'Invalid schedule template update data',299 |         details: validation.error.issues300 |       }, { status: 400 });301 |     }302 | 303 |     const { id, ...updateData } = validation.data;304 | 305 |     const existingTemplate = await prisma.scheduleTemplate.findUnique({306 |       where: { id }307 |     });308 | 309 |     if (!existingTemplate) {310 |       return NextResponse.json({311 |         success: false,312 |         error: 'Schedule template not found',313 |         message: 'Schedule template with this ID does not exist'314 |       }, { status: 404 });315 |     }316 | 317 |     if (updateData.startTime || updateData.endTime) {318 |       const startTime = new Date(`2000-01-01T${updateData.startTime || existingTemplate.startTime}:00`);319 |       const endTime = new Date(`2000-01-01T${updateData.endTime || existingTemplate.endTime}:00`);320 | 321 |       if (startTime >= endTime) {322 |         return NextResponse.json({323 |           success: false,324 |           error: 'Invalid time range',325 |           message: 'End time must be after start time'326 |         }, { status: 400 });327 |       }328 |     }329 | 330 |     if (updateData.sessionDurationId) {331 |       const sessionDuration = await prisma.sessionDuration.findUnique({332 |         where: { id: updateData.sessionDurationId }333 |       });334 | 335 |       if (!sessionDuration) {336 |         return NextResponse.json({337 |           success: false,338 |           error: 'Session duration not found',339 |           message: 'The specified session duration does not exist'340 |         }, { status: 404 });341 |       }342 |     }343 | 344 |     if (updateData.dayOfWeek || updateData.startTime || updateData.endTime) {345 |       const newDayOfWeek = updateData.dayOfWeek || existingTemplate.dayOfWeek;346 |       const newStartTime = updateData.startTime || existingTemplate.startTime;347 |       const newEndTime = updateData.endTime || existingTemplate.endTime;348 | 349 |       const conflict = await prisma.scheduleTemplate.findFirst({350 |         where: {351 |           dayOfWeek: newDayOfWeek,352 |           startTime: newStartTime,353 |           endTime: newEndTime,354 |           id: { not: id }355 |         }356 |       });357 | 358 |       if (conflict) {359 |         return NextResponse.json({360 |           success: false,361 |           error: 'Template conflict',362 |           message: 'A schedule template for this day and time already exists'363 |         }, { status: 409 });364 |       }365 |     }366 | 367 |     const updatedScheduleTemplate = await prisma.scheduleTemplate.update({368 |       where: { id },369 |       data: updateData,370 |       include: {371 |         sessionDuration: {372 |           select: {373 |             id: true,374 |             name: true,375 |             duration_minutes: true,376 |             description: true377 |           }378 |         }379 |       }380 |     });381 | 382 |     return NextResponse.json({383 |       success: true,384 |       message: 'Schedule template updated successfully',385 |       data: updatedScheduleTemplate386 |     });387 | 388 |   } catch (error) {389 |     return NextResponse.json({390 |       success: false,391 |       error: 'Internal server error',392 |       message: 'Failed to update schedule template',393 |       details: error instanceof Error ? error.message : 'Unknown error'394 |     }, { status: 500 });395 |   } finally {396 |     await prisma.$disconnect();397 |   }398 | }399 | 400 | export async function DELETE(request: NextRequest) {401 |   try {402 |     const user = await requireAuth(request);403 |     if (!user || user.role !== 'admin') {404 |       return NextResponse.json({405 |         success: false,406 |         error: 'Unauthorized',407 |         message: 'Admin access required'408 |       }, { status: 401 });409 |     }410 | 411 |     const { searchParams } = new URL(request.url);412 |     const templateId = searchParams.get('id');413 | 414 |     if (!templateId) {415 |       return NextResponse.json({416 |         success: false,417 |         error: 'Missing ID',418 |         message: 'Schedule template ID is required'419 |       }, { status: 400 });420 |     }421 | 422 |     const id = parseInt(templateId);423 |     if (isNaN(id)) {424 |       return NextResponse.json({425 |         success: false,426 |         error: 'Invalid ID',427 |         message: 'Schedule template ID must be a number'428 |       }, { status: 400 });429 |     }430 | 431 |     const existingTemplate = await prisma.scheduleTemplate.findUnique({432 |       where: { id },433 |       include: {434 |         scheduleSlots: {435 |           where: {436 |             OR: [437 |               { isAvailable: true },438 |               { bookedCount: { gt: 0 } }439 |             ]440 |           }441 |         }442 |       }443 |     });444 | 445 |     if (!existingTemplate) {446 |       return NextResponse.json({447 |         success: false,448 |         error: 'Schedule template not found',449 |         message: 'Schedule template with this ID does not exist'450 |       }, { status: 404 });451 |     }452 | 453 |     if (existingTemplate.scheduleSlots.length > 0) {454 |       return NextResponse.json({455 |         success: false,456 |         error: 'Cannot delete schedule template',457 |         message: 'Schedule template has active or booked slots and cannot be deleted'458 |       }, { status: 400 });459 |     }460 | 461 |     await prisma.scheduleTemplate.delete({462 |       where: { id }463 |     });464 | 465 |     return NextResponse.json({466 |       success: true,467 |       message: 'Schedule template deleted successfully'468 |     });469 | 470 |   } catch (error) {471 |     return NextResponse.json({472 |       success: false,473 |       error: 'Internal server error',474 |       message: 'Failed to delete schedule template',475 |       details: error instanceof Error ? error.message : 'Unknown error'476 |     }, { status: 500 });477 |   } finally {478 |     await prisma.$disconnect();479 |   }480 | }
============================================================END: frontend/app/api/admin/schedule-templates/route.ts============================================================


============================================================FILE: frontend/app/api/admin/schedules/[id]/route.tsSIZE: 2.02 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | export async function PUT( 11 |   request: NextRequest, 12 |   { params }: { params: { id: string } } 13 | ) { 14 |   try { 15 |     const user = await requireAuth(request); 16 |     if (!user) { 17 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 18 |     } 19 |  20 |     const { id } = params; 21 |     const body = await request.json(); 22 |  23 |     const { data, error } = await supabase 24 |       .from('schedules') 25 |       .update({ 26 |         ...body, 27 |         updatedAt: new Date().toISOString() 28 |       }) 29 |       .eq('id', id) 30 |       .select() 31 |       .single(); 32 |  33 |     if (error) { 34 |       return NextResponse.json({ error: 'Failed to update schedule' }, { status: 500 }); 35 |     } 36 |  37 |     return NextResponse.json({ 38 |       success: true, 39 |       message: 'Schedule updated successfully', 40 |       schedule: data 41 |     }); 42 |  43 |   } catch (error) { 44 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 45 |   } 46 | } 47 |  48 | export async function DELETE( 49 |   request: NextRequest, 50 |   { params }: { params: { id: string } } 51 | ) { 52 |   try { 53 |     const user = await requireAuth(request); 54 |     if (!user) { 55 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 56 |     } 57 |  58 |     const { id } = params; 59 |  60 |     const { error } = await supabase 61 |       .from('schedules') 62 |       .delete() 63 |       .eq('id', id); 64 |  65 |     if (error) { 66 |       return NextResponse.json({ error: 'Failed to delete schedule' }, { status: 500 }); 67 |     } 68 |  69 |     return NextResponse.json({ 70 |       success: true, 71 |       message: 'Schedule deleted successfully' 72 |     }); 73 |  74 |   } catch (error) { 75 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 76 |   } 77 | }
============================================================END: frontend/app/api/admin/schedules/[id]/route.ts============================================================


============================================================FILE: frontend/app/api/admin/schedules/bulk/route.tsSIZE: 6.15 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 | import { z } from 'zod';  5 |   6 | const supabase = createClient(  7 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  8 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  9 | ); 10 |  11 | const bulkScheduleSchema = z.object({ 12 |   startDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid start date format (YYYY-MM-DD)'), 13 |   endDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid end date format (YYYY-MM-DD)'), 14 |   timeSlots: z.array(z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)')).min(1, 'At least one time slot is required'), 15 |   duration: z.number().min(30, 'Duration must be at least 30 minutes').max(180, 'Duration cannot exceed 3 hours'), 16 |   capacity: z.number().min(1, 'Capacity must be at least 1').max(10, 'Capacity cannot exceed 10'), 17 |   serviceType: z.string().default('yoga'), 18 |   available: z.boolean().default(true), 19 |   notes: z.string().optional() 20 | }); 21 |  22 | export async function POST(request: NextRequest) { 23 |   try { 24 |     const user = await requireAuth(request); 25 |     if (!user) { 26 |       return NextResponse.json({ 27 |         success: false, 28 |         error: 'Unauthorized', 29 |         message: 'Authentication required', 30 |         toast: { 31 |           type: 'error', 32 |           title: 'Authentication Failed', 33 |           description: 'You must be logged in to perform this action' 34 |         } 35 |       }, { status: 401 }); 36 |     } 37 |  38 |     const body = await request.json(); 39 |  40 |     const validation = bulkScheduleSchema.safeParse(body); 41 |     if (!validation.success) { 42 |       return NextResponse.json({ 43 |         success: false, 44 |         error: 'Validation failed', 45 |         message: 'Bulk schedule data validation failed', 46 |         details: validation.error.issues, 47 |         toast: { 48 |           type: 'error', 49 |           title: 'Validation Error', 50 |           description: 'Bulk schedule data validation failed. Please check the form fields.' 51 |         } 52 |       }, { status: 400 }); 53 |     } 54 |  55 |     const scheduleData = validation.data; 56 |  57 |     const startDate = new Date(scheduleData.startDate); 58 |     const endDate = new Date(scheduleData.endDate); 59 |  60 |     if (startDate > endDate) { 61 |       return NextResponse.json({ 62 |         success: false, 63 |         error: 'Invalid date range', 64 |         message: 'Start date must be before or equal to end date', 65 |         toast: { 66 |           type: 'error', 67 |           title: 'Invalid Date Range', 68 |           description: 'Start date must be before or equal to end date' 69 |         } 70 |       }, { status: 400 }); 71 |     } 72 |  73 |     const dates: string[] = []; 74 |     const currentDate = new Date(startDate); 75 |  76 |     while (currentDate <= endDate) { 77 |       dates.push(currentDate.toISOString().split('T')[0]); 78 |       currentDate.setDate(currentDate.getDate() + 1); 79 |     } 80 |  81 |     const schedulesToCreate: Array<{ 82 |       date: string; 83 |       time: string; 84 |       duration: number; 85 |       capacity: number; 86 |       serviceType: string; 87 |     }> = []; 88 |     for (const date of dates) { 89 |       for (const time of scheduleData.timeSlots) { 90 |         schedulesToCreate.push({ 91 |           date, 92 |           time, 93 |           duration: scheduleData.duration, 94 |           capacity: scheduleData.capacity, 95 |           serviceType: scheduleData.serviceType 96 |         }); 97 |       } 98 |     } 99 | 100 |     const { data: existingSchedules, error: checkError } = await supabase101 |       .from('schedules')102 |       .select('date, time')103 |       .in('date', dates)104 |       .in('time', scheduleData.timeSlots);105 | 106 |     if (checkError) {107 |       return NextResponse.json({108 |         success: false,109 |         error: 'Database error',110 |         message: 'Failed to check existing schedules',111 |         details: checkError.message,112 |         toast: {113 |           type: 'error',114 |           title: 'Database Error',115 |           description: 'Failed to check existing schedules. Please try again.'116 |         }117 |       }, { status: 500 });118 |     }119 | 120 |     const existingScheduleKeys = new Set(121 |       existingSchedules?.map(s => `${s.date}-${s.time}`) || []122 |     );123 | 124 |     const newSchedules = schedulesToCreate.filter(schedule =>125 |       !existingScheduleKeys.has(`${schedule.date}-${schedule.time}`)126 |     );127 | 128 |     if (newSchedules.length === 0) {129 |       return NextResponse.json({130 |         success: false,131 |         error: 'No new schedules',132 |         message: 'All schedules in the specified range already exist',133 |         toast: {134 |           type: 'warning',135 |           title: 'No New Schedules',136 |           description: 'All schedules in the specified range already exist'137 |         }138 |       }, { status: 400 });139 |     }140 | 141 |     const { data: createdSchedules, error: createError } = await supabase142 |       .from('schedules')143 |       .insert(newSchedules)144 |       .select();145 | 146 |     if (createError) {147 |       return NextResponse.json({148 |         success: false,149 |         error: 'Database error',150 |         message: 'Failed to create bulk schedules',151 |         details: createError.message,152 |         toast: {153 |           type: 'error',154 |           title: 'Bulk Creation Failed',155 |           description: 'Failed to create bulk schedules. Please try again.'156 |         }157 |       }, { status: 500 });158 |     }159 | 160 |     return NextResponse.json({161 |       success: true,162 |       message: 'Bulk schedules created successfully',163 |       count: createdSchedules?.length || 0,164 |       data: createdSchedules,165 |       toast: {166 |         type: 'success',167 |         title: 'Success!',168 |         description: `Successfully created ${createdSchedules?.length || 0} new schedules`169 |       }170 |     }, { status: 201 });171 | 172 |   } catch (error) {173 |     return NextResponse.json({174 |       success: false,175 |       error: 'Internal server error',176 |       message: 'An unexpected error occurred',177 |       toast: {178 |         type: 'error',179 |         title: 'Unexpected Error',180 |         description: 'An unexpected error occurred. Please try again.'181 |       }182 |     }, { status: 500 });183 |   }184 | }
============================================================END: frontend/app/api/admin/schedules/bulk/route.ts============================================================


============================================================FILE: frontend/app/api/admin/schedules/route.tsSIZE: 12.90 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 | import { z } from 'zod';  5 |   6 | const supabase = createClient(  7 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  8 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  9 | ); 10 |  11 | const scheduleCreateSchema = z.object({ 12 |   date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)'), 13 |   time: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)'), 14 |   duration: z.number().min(30, 'Duration must be at least 30 minutes').max(180, 'Duration cannot exceed 3 hours'), 15 |   capacity: z.number().min(1, 'Capacity must be at least 1').max(10, 'Capacity cannot exceed 10'), 16 |   available: z.boolean().default(true), 17 |   notes: z.string().optional() 18 | }); 19 |  20 | const scheduleUpdateSchema = z.object({ 21 |   date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)').optional(), 22 |   time: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)').optional(), 23 |   duration: z.number().min(30, 'Duration must be at least 30 minutes').max(180, 'Duration cannot exceed 3 hours').optional(), 24 |   capacity: z.number().min(1, 'Capacity must be at least 1').max(10, 'Capacity cannot exceed 10').optional(), 25 |   available: z.boolean().optional(), 26 |   notes: z.string().optional() 27 | }); 28 |  29 | export async function GET(request: NextRequest) { 30 |   try { 31 |     const user = await requireAuth(request); 32 |     if (!user) { 33 |       return NextResponse.json({ 34 |         success: false, 35 |         error: 'Unauthorized', 36 |         message: 'Authentication required', 37 |         toast: { 38 |           type: 'error', 39 |           title: 'Authentication Failed', 40 |           description: 'You must be logged in to perform this action' 41 |         } 42 |       }, { status: 401 }); 43 |     } 44 |  45 |     const { searchParams } = new URL(request.url); 46 |     const page = parseInt(searchParams.get('page') || '1'); 47 |     const limit = parseInt(searchParams.get('limit') || '10'); 48 |     const date = searchParams.get('date'); 49 |     const available = searchParams.get('available'); 50 |  51 |     let query = supabase 52 |       .from('schedules') 53 |       .select('*', { count: 'exact' }); 54 |  55 |     if (date) { 56 |       query = query.eq('date', date); 57 |     } 58 |  59 |     if (available !== null) { 60 |       query = query.eq('available', available === 'true'); 61 |     } 62 |  63 |     const { data: schedules, error, count } = await query 64 |       .range((page - 1) * limit, page * limit - 1) 65 |       .order('date', { ascending: true }) 66 |       .order('time', { ascending: true }); 67 |  68 |     if (error) { 69 |       return NextResponse.json({ 70 |         success: false, 71 |         error: 'Database error', 72 |         message: 'Failed to fetch schedules', 73 |         details: error.message, 74 |         toast: { 75 |           type: 'error', 76 |           title: 'Database Error', 77 |           description: 'Failed to fetch schedules. Please try again.' 78 |         } 79 |       }, { status: 500 }); 80 |     } 81 |  82 |     return NextResponse.json({ 83 |       success: true, 84 |       data: schedules, 85 |       pagination: { 86 |         page, 87 |         limit, 88 |         total: count || 0, 89 |         totalPages: Math.ceil((count || 0) / limit) 90 |       } 91 |     }); 92 |  93 |   } catch (error) { 94 |     return NextResponse.json({ 95 |       success: false, 96 |       error: 'Internal server error', 97 |       message: 'An unexpected error occurred', 98 |       toast: { 99 |         type: 'error',100 |         title: 'Unexpected Error',101 |         description: 'An unexpected error occurred. Please try again.'102 |       }103 |     }, { status: 500 });104 |   }105 | }106 | 107 | export async function POST(request: NextRequest) {108 |   try {109 |     const user = await requireAuth(request);110 |     if (!user) {111 |       return NextResponse.json({112 |         success: false,113 |         error: 'Unauthorized',114 |         message: 'Authentication required',115 |         toast: {116 |           type: 'error',117 |           title: 'Authentication Failed',118 |           description: 'You must be logged in to perform this action'119 |         }120 |       }, { status: 401 });121 |     }122 | 123 |     const body = await request.json();124 | 125 |     const validation = scheduleCreateSchema.safeParse(body);126 |     if (!validation.success) {127 |       return NextResponse.json({128 |         success: false,129 |         error: 'Validation failed',130 |         message: 'Schedule data validation failed',131 |         details: validation.error.issues,132 |         toast: {133 |           type: 'error',134 |           title: 'Validation Error',135 |           description: 'Schedule data validation failed. Please check the form fields.'136 |         }137 |       }, { status: 400 });138 |     }139 | 140 |     const scheduleData = validation.data;141 | 142 |     const { data: existingSchedule } = await supabase143 |       .from('schedules')144 |       .select('id')145 |       .eq('date', scheduleData.date)146 |       .eq('time', scheduleData.time)147 |       .single();148 | 149 |     if (existingSchedule) {150 |       return NextResponse.json({151 |         success: false,152 |         error: 'Schedule already exists',153 |         message: 'A schedule already exists for this date and time',154 |         toast: {155 |           type: 'error',156 |           title: 'Schedule Exists',157 |           description: 'A schedule already exists for this date and time'158 |         }159 |       }, { status: 409 });160 |     }161 | 162 |     const { data, error } = await supabase163 |       .from('schedules')164 |       .insert({165 |         date: scheduleData.date,166 |         time: scheduleData.time,167 |         duration: scheduleData.duration,168 |         capacity: scheduleData.capacity,169 |         available: scheduleData.available,170 |         notes: scheduleData.notes,171 |         created_at: new Date().toISOString()172 |       })173 |       .select()174 |       .single();175 | 176 |     if (error) {177 |       return NextResponse.json({178 |         success: false,179 |         error: 'Database error',180 |         message: 'Failed to create schedule',181 |         details: error.message,182 |         toast: {183 |           type: 'error',184 |           title: 'Schedule Creation Failed',185 |           description: 'Failed to create schedule. Please try again.'186 |         }187 |       }, { status: 500 });188 |     }189 | 190 |     return NextResponse.json({191 |       success: true,192 |       message: 'Schedule created successfully',193 |       data,194 |       toast: {195 |         type: 'success',196 |         title: 'Success!',197 |         description: `Schedule for ${data.date} at ${data.time} created successfully`198 |       }199 |     }, { status: 201 });200 | 201 |   } catch (error) {202 |     return NextResponse.json({203 |       success: false,204 |       error: 'Internal server error',205 |       message: 'An unexpected error occurred',206 |       toast: {207 |         type: 'error',208 |         title: 'Unexpected Error',209 |         description: 'An unexpected error occurred. Please try again.'210 |       }211 |     }, { status: 500 });212 |   }213 | }214 | 215 | export async function PUT(request: NextRequest) {216 |   try {217 |     const user = await requireAuth(request);218 |     if (!user) {219 |       return NextResponse.json({220 |         success: false,221 |         error: 'Unauthorized',222 |         message: 'Authentication required',223 |         toast: {224 |           type: 'error',225 |           title: 'Authentication Failed',226 |           description: 'You must be logged in to perform this action'227 |         }228 |       }, { status: 401 });229 |     }230 | 231 |     const body = await request.json();232 |     const { id, ...updateData } = body;233 | 234 |     if (!id) {235 |       return NextResponse.json({236 |         success: false,237 |         error: 'Missing ID',238 |         message: 'Schedule ID is required for update',239 |         toast: {240 |           type: 'error',241 |           title: 'Missing Information',242 |           description: 'Schedule ID is required for update'243 |         }244 |       }, { status: 400 });245 |     }246 | 247 |     const validation = scheduleUpdateSchema.safeParse(updateData);248 |     if (!validation.success) {249 |       return NextResponse.json({250 |         success: false,251 |         error: 'Validation failed',252 |         message: 'Update data validation failed',253 |         details: validation.error.issues,254 |         toast: {255 |           type: 'error',256 |           title: 'Validation Error',257 |           description: 'Update data validation failed. Please check the form fields.'258 |         }259 |       }, { status: 400 });260 |     }261 | 262 |     const validUpdateData = validation.data;263 | 264 |     if (validUpdateData.date || validUpdateData.time) {265 |       const { data: existingSchedule } = await supabase266 |         .from('schedules')267 |         .select('id')268 |         .eq('date', validUpdateData.date || body.date)269 |         .eq('time', validUpdateData.time || body.time)270 |         .neq('id', id)271 |         .single();272 | 273 |       if (existingSchedule) {274 |         return NextResponse.json({275 |           success: false,276 |           error: 'Schedule conflict',277 |           message: 'A schedule already exists for this date and time',278 |           toast: {279 |             type: 'error',280 |             title: 'Schedule Conflict',281 |             description: 'A schedule already exists for this date and time'282 |           }283 |         }, { status: 409 });284 |       }285 |     }286 | 287 |     const { data, error } = await supabase288 |       .from('schedules')289 |       .update({290 |         ...validUpdateData,291 |         updated_at: new Date().toISOString()292 |       })293 |       .eq('id', id)294 |       .select()295 |       .single();296 | 297 |     if (error) {298 |       return NextResponse.json({299 |         success: false,300 |         error: 'Database error',301 |         message: 'Failed to update schedule',302 |         details: error.message,303 |         toast: {304 |           type: 'error',305 |           title: 'Update Failed',306 |           description: 'Failed to update schedule. Please try again.'307 |         }308 |       }, { status: 500 });309 |     }310 | 311 |     return NextResponse.json({312 |       success: true,313 |       message: 'Schedule updated successfully',314 |       data,315 |       toast: {316 |         type: 'success',317 |         title: 'Success!',318 |         description: `Schedule for ${data.date} at ${data.time} updated successfully`319 |       }320 |     });321 | 322 |   } catch (error) {323 |     return NextResponse.json({324 |       success: false,325 |       error: 'Internal server error',326 |       message: 'An unexpected error occurred',327 |       toast: {328 |         type: 'error',329 |         title: 'Unexpected Error',330 |         description: 'An unexpected error occurred. Please try again.'331 |       }332 |     }, { status: 500 });333 |   }334 | }335 | 336 | export async function DELETE(request: NextRequest) {337 |   try {338 |     const user = await requireAuth(request);339 |     if (!user) {340 |       return NextResponse.json({341 |         success: false,342 |         error: 'Unauthorized',343 |         message: 'Authentication required',344 |         toast: {345 |           type: 'error',346 |           title: 'Authentication Failed',347 |           description: 'You must be logged in to perform this action'348 |         }349 |       }, { status: 401 });350 |     }351 | 352 |     const { searchParams } = new URL(request.url);353 |     const id = searchParams.get('id');354 | 355 |     if (!id) {356 |       return NextResponse.json({357 |         success: false,358 |         error: 'Missing ID',359 |         message: 'Schedule ID is required for deletion',360 |         toast: {361 |           type: 'error',362 |           title: 'Missing Information',363 |           description: 'Schedule ID is required for deletion'364 |         }365 |       }, { status: 400 });366 |     }367 | 368 |     const { data: bookings } = await supabase369 |       .from('bookings')370 |       .select('id')371 |       .eq('schedule_id', id);372 | 373 |     if (bookings && bookings.length > 0) {374 |       return NextResponse.json({375 |         success: false,376 |         error: 'Schedule has bookings',377 |         message: 'Cannot delete schedule with existing bookings',378 |         toast: {379 |           type: 'error',380 |           title: 'Cannot Delete',381 |           description: 'Cannot delete schedule with existing bookings'382 |         }383 |       }, { status: 400 });384 |     }385 | 386 |     const { error } = await supabase387 |       .from('schedules')388 |       .delete()389 |       .eq('id', id);390 | 391 |     if (error) {392 |       return NextResponse.json({393 |         success: false,394 |         error: 'Database error',395 |         message: 'Failed to delete schedule',396 |         details: error.message,397 |         toast: {398 |           type: 'error',399 |           title: 'Deletion Failed',400 |           description: 'Failed to delete schedule. Please try again.'401 |         }402 |       }, { status: 500 });403 |     }404 | 405 |     return NextResponse.json({406 |       success: true,407 |       message: 'Schedule deleted successfully',408 |       toast: {409 |         type: 'success',410 |         title: 'Success!',411 |         description: 'Schedule deleted successfully'412 |       }413 |     });414 | 415 |   } catch (error) {416 |     return NextResponse.json({417 |       success: false,418 |       error: 'Internal server error',419 |       message: 'An unexpected error occurred',420 |       toast: {421 |         type: 'error',422 |         title: 'Unexpected Error',423 |         description: 'An unexpected error occurred. Please try again.'424 |       }425 |     }, { status: 500 });426 |   }427 | }
============================================================END: frontend/app/api/admin/schedules/route.ts============================================================


============================================================FILE: frontend/app/api/admin/sections/route.tsSIZE: 6.19 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 | import { revalidatePath, revalidateTag } from 'next/cache';  5 |   6 | export async function GET(request: NextRequest) {  7 |   try {  8 |     const user = await requireAuth(request);  9 |     if (!user) { 10 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 11 |     } 12 |  13 |     const sections = await prisma.section.findMany({ 14 |       orderBy: { order: 'asc' } 15 |     }); 16 |  17 |     return NextResponse.json({ sections }); 18 |  19 |   } catch (error) { 20 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 21 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 22 |   } 23 | } 24 |  25 | export async function PUT(request: NextRequest) { 26 |   try { 27 |     const user = await requireAuth(request); 28 |     if (!user) { 29 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 30 |     } 31 |  32 |     const body = await request.json(); 33 |     const { sections, action = 'replace' } = body; 34 |  35 |     if (!Array.isArray(sections)) { 36 |       return NextResponse.json({ error: 'Sections array is required' }, { status: 400 }); 37 |     } 38 |  39 |     let result; 40 |  41 |     if (action === 'replace') { 42 |  43 |       await prisma.section.deleteMany({}); 44 |  45 |       result = await Promise.all( 46 |         sections.map(async (section, index) => { 47 |           return await prisma.section.create({ 48 |             data: { 49 |               sectionId: section.id, 50 |               type: section.type || 'content', 51 |               title: section.title, 52 |               description: section.description || '', 53 |               icon: section.icon || 'Circle', 54 |               component: section.component, 55 |               order: section.order ?? index, 56 |               enabled: section.enabled ?? true, 57 |               mobileConfig: section.mobileConfig || {}, 58 |               desktopConfig: section.desktopConfig || {} 59 |             } 60 |           }); 61 |         }) 62 |       ); 63 |       } else if (action === 'add') { 64 |  65 |       result = await Promise.all( 66 |         sections.map(async (section) => { 67 |  68 |           const existing = await prisma.section.findUnique({ 69 |             where: { sectionId: section.id } 70 |           }); 71 |  72 |           if (existing) { 73 |  74 |             return await prisma.section.update({ 75 |               where: { sectionId: section.id }, 76 |               data: { 77 |                 type: section.type || 'content', 78 |                 title: section.title, 79 |                 description: section.description || '', 80 |                 icon: section.icon || 'Circle', 81 |                 component: section.component, 82 |                 order: section.order ?? existing.order, 83 |                 enabled: section.enabled ?? true, 84 |                 mobileConfig: section.mobileConfig || {}, 85 |                 desktopConfig: section.desktopConfig || {} 86 |               } 87 |             }); 88 |           } else { 89 |  90 |             return await prisma.section.create({ 91 |               data: { 92 |                 sectionId: section.id, 93 |                 type: section.type || 'content', 94 |                 title: section.title, 95 |                 description: section.description || '', 96 |                 icon: section.icon || 'Circle', 97 |                 component: section.component, 98 |                 order: section.order ?? 999, 99 |                 enabled: section.enabled ?? true,100 |                 mobileConfig: section.mobileConfig || {},101 |                 desktopConfig: section.desktopConfig || {}102 |               }103 |             });104 |           }105 |         })106 |       );107 |       } else {108 |       return NextResponse.json({ error: 'Invalid action. Use "replace" or "add"' }, { status: 400 });109 |     }110 | 111 |     await triggerRevalidation();112 | 113 |     return NextResponse.json({ sections: result });114 | 115 |   } catch (error) {116 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';117 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 });118 |   }119 | }120 | 121 | async function triggerRevalidation() {122 |   try {123 | 124 |     revalidatePath('/');125 |     revalidatePath('/admin');126 |     revalidatePath('/api/content');127 | 128 |     revalidateTag('content');129 |     revalidateTag('translations');130 |     revalidateTag('sections');131 | 132 |     try {133 |       const revalResponse = await fetch(`${process.env.NEXT_PUBLIC_APP_URL || `http:134 |         method: 'POST'135 |       });136 | 137 |       if (revalResponse.ok) {138 |         } else {139 |         }140 |     } catch (revalError) {141 |       }142 | 143 |     } catch (error) {144 | 145 |   }146 | }
============================================================END: frontend/app/api/admin/sections/route.ts============================================================


============================================================FILE: frontend/app/api/admin/seed/admin/route.tsSIZE: 3.53 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { z } from 'zod';  3 | import bcrypt from 'bcryptjs';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const adminUserSchema = z.object({  7 |   email: z.string().email('Invalid email format'),  8 |   password: z.string().min(6, 'Password must be at least 6 characters'),  9 |   fullName: z.string().min(1, 'Full name is required'), 10 |   role: z.enum(['admin', 'user']).default('admin'), 11 |   phone: z.string().optional(), 12 |   birthDate: z.string().optional(), 13 |   birthTime: z.string().optional(), 14 |   birthPlace: z.string().optional(), 15 |   question: z.string().optional(), 16 |   language: z.string().optional(), 17 |   adminNotes: z.string().optional() 18 | }); 19 |  20 | export async function POST() { 21 |   try { 22 |  23 |     const adminData = { 24 |       email: 'admin@soulpath.lat', 25 |       password: 'soulpath', 26 |       fullName: 'SoulPath Admin', 27 |       role: 'admin' as const, 28 |       phone: '+1234567890', 29 |       birthDate: '1990-01-15', 30 |       birthTime: '10:30:00', 31 |       birthPlace: 'New York, USA', 32 |       question: 'How can I help manage the SOULPATH wellness system?', 33 |       language: 'en', 34 |       adminNotes: 'Primary system administrator for SOULPATH' 35 |     }; 36 |  37 |     const validationResult = adminUserSchema.safeParse(adminData); 38 |     if (!validationResult.success) { 39 |       ); 40 |       return NextResponse.json({ 41 |         success: false, 42 |         error: 'Validation failed', 43 |         message: 'Admin user data validation failed', 44 |         details: validationResult.error.format(), 45 |         toast: { 46 |           type: 'error', 47 |           title: 'Validation Error', 48 |           description: 'Admin user data validation failed. Please check the data format.' 49 |         } 50 |       }, { status: 400 }); 51 |     } 52 |  53 |     await prisma.user.deleteMany({ 54 |       where: { email: adminData.email } 55 |     }); 56 |  57 |     const hashedPassword = await bcrypt.hash(adminData.password, 12); 58 |  59 |     const user = await prisma.user.create({ 60 |       data: { 61 |         email: adminData.email, 62 |         password: hashedPassword, 63 |         fullName: adminData.fullName, 64 |         role: adminData.role, 65 |         phone: adminData.phone, 66 |         birthDate: adminData.birthDate ? new Date(adminData.birthDate) : null, 67 |         birthTime: adminData.birthTime ? new Date(`1970-01-01T${adminData.birthTime}`) : null, 68 |         birthPlace: adminData.birthPlace, 69 |         question: adminData.question, 70 |         language: adminData.language, 71 |         adminNotes: adminData.adminNotes, 72 |         status: 'active' 73 |       } 74 |     }); 75 |  76 |     return NextResponse.json({ 77 |       success: true, 78 |       message: 'Admin user created successfully', 79 |       user: { 80 |         id: user.id, 81 |         email: user.email, 82 |         fullName: user.fullName, 83 |         role: user.role 84 |       }, 85 |       toast: { 86 |         type: 'success', 87 |         title: 'Success!', 88 |         description: `Admin user ${adminData.email} created successfully with password: ${adminData.password}` 89 |       } 90 |     }); 91 |  92 |   } catch (error) { 93 |     return NextResponse.json({ 94 |       success: false, 95 |       error: 'Internal server error', 96 |       message: 'An unexpected error occurred', 97 |       details: error instanceof Error ? error.message : 'Unknown error', 98 |       toast: { 99 |         type: 'error',100 |         title: 'Unexpected Error',101 |         description: 'An unexpected error occurred. Please try again.'102 |       }103 |     }, { status: 500 });104 |   }105 | }
============================================================END: frontend/app/api/admin/seed/admin/route.ts============================================================


============================================================FILE: frontend/app/api/admin/seed/clients/route.tsSIZE: 7.41 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 | import { z } from 'zod';  5 |   6 | const supabase = createClient(  7 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  8 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  9 | ); 10 |  11 | const sampleCustomerSchema = z.object({ 12 |   name: z.string().min(1, 'Name is required'), 13 |   email: z.string().email('Invalid email format'), 14 |   phone: z.string().optional(), 15 |   status: z.enum(['active', 'confirmed', 'pending', 'inactive']), 16 |   birth_date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)'), 17 |   birth_time: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)').optional(), 18 |   birth_place: z.string().min(1, 'Birth place is required'), 19 |   question: z.string().min(10, 'Question must be at least 10 characters'), 20 |   language: z.enum(['en', 'es']), 21 |   admin_notes: z.string().optional() 22 | }); 23 |  24 | const seedClientsSchema = z.object({ 25 |   customers: z.array(sampleCustomerSchema) 26 | }); 27 |  28 | export async function POST(request: NextRequest) { 29 |   try { 30 |     const user = await requireAuth(request); 31 |     if (!user) { 32 |       return NextResponse.json({ 33 |         success: false, 34 |         error: 'Unauthorized', 35 |         message: 'Authentication required', 36 |         toast: { 37 |           type: 'error', 38 |           title: 'Authentication Failed', 39 |           description: 'You must be logged in to perform this action' 40 |         } 41 |       }, { status: 401 }); 42 |     } 43 |  44 |     const sampleCustomers = [ 45 |       { 46 |         name: 'Maria Garcia', 47 |         email: 'maria.garcia@example.com', 48 |         phone: '+1 (555) 123-4567', 49 |         status: 'active' as const, 50 |         birth_date: '1985-03-15', 51 |         birth_time: '14:30', 52 |         birth_place: 'Madrid, Spain', 53 |         question: 'I want to understand my relationship patterns and find true love. I\'ve been through several relationships but none seem to last. What does my chart reveal about my romantic destiny?', 54 |         language: 'es' as const, 55 |         admin_notes: 'Spanish-speaking client, interested in relationship astrology. Very engaged and asks thoughtful questions. Prefers evening sessions.' 56 |       }, 57 |       { 58 |         name: 'John Smith', 59 |         email: 'john.smith@example.com', 60 |         phone: '+1 (555) 234-5678', 61 |         status: 'confirmed' as const, 62 |         birth_date: '1990-07-22', 63 |         birth_time: '09:15', 64 |         birth_place: 'New York, USA', 65 |         question: 'I\'m at a crossroads in my career. Should I stay in my current job or take the leap to start my own business? I need guidance on timing and what my chart suggests about my professional path.', 66 |         language: 'en' as const, 67 |         admin_notes: 'Career-focused client, analytical mindset. Interested in business astrology and timing. Good candidate for follow-up sessions.' 68 |       }, 69 |       { 70 |         name: 'Ana Rodriguez', 71 |         email: 'ana.rodriguez@example.com', 72 |         phone: '+1 (555) 345-6789', 73 |         status: 'pending' as const, 74 |         birth_date: '1988-11-08', 75 |         birth_time: '16:45', 76 |         birth_place: 'Barcelona, Spain', 77 |         question: 'I feel lost and don\'t know my life purpose. What does my birth chart reveal about my spiritual journey and the work I\'m meant to do in this lifetime?', 78 |         language: 'es' as const, 79 |         admin_notes: 'Spiritual seeker, very open to guidance. First-time astrology client. May need extra support and explanation of concepts.' 80 |       } 81 |     ]; 82 |  83 |     )); 84 |  85 |     const { searchParams } = new URL(request.url); 86 |     const clearExisting = searchParams.get('clear') === 'true'; 87 |  88 |     if (clearExisting) { 89 |  90 |       const { error: deleteError } = await supabase 91 |         .from('clients') 92 |         .delete() 93 |         .in('email', sampleCustomers.map(c => c.email)); 94 |  95 |       if (deleteError) { 96 |         return NextResponse.json({ 97 |           success: false, 98 |           error: 'Database error', 99 |           message: 'Failed to clear existing customers',100 |           details: deleteError.message101 |         }, { status: 500 });102 |       }103 |     }104 | 105 |     const validationResult = seedClientsSchema.safeParse({ customers: sampleCustomers });106 |     if (!validationResult.success) {107 |       return NextResponse.json({108 |         success: false,109 |         error: 'Validation failed',110 |         message: 'Sample customer data validation failed',111 |         details: validationResult.error.issues,112 |         toast: {113 |           type: 'error',114 |           title: 'Validation Error',115 |           description: 'Sample customer data validation failed. Please check the data format.'116 |         }117 |       }, { status: 400 });118 |     }119 | 120 |     const { data: existingClients, error: checkError } = await supabase121 |       .from('clients')122 |       .select('email, name, status')123 |       .in('email', sampleCustomers.map(c => c.email));124 | 125 |     const { data, error } = await supabase126 |       .from('clients')127 |       .upsert(sampleCustomers, {128 |         onConflict: 'email',129 |         ignoreDuplicates: false130 |       })131 |       .select();132 | 133 |     if (error) {134 |       return NextResponse.json({135 |         success: false,136 |         error: 'Database error',137 |         message: 'Failed to seed customers',138 |         details: error.message,139 |         toast: {140 |           type: 'error',141 |           title: 'Database Error',142 |           description: 'Failed to create sample customers. Please try again.'143 |         }144 |       }, { status: 500 });145 |     }146 | 147 |     const createdCount = data?.length || 0;148 |     if (createdCount === 0) {149 |       return NextResponse.json({150 |         success: true,151 |         message: 'All sample customers already exist in the database',152 |         count: 0,153 |         customers: [],154 |         toast: {155 |           type: 'info',156 |           title: 'Info',157 |           description: 'Sample customers already exist in the database'158 |         }159 |       });160 |     }161 | 162 |     return NextResponse.json({163 |       success: true,164 |       message: 'Sample customers created successfully',165 |       count: data?.length || 0,166 |       customers: data,167 |       toast: {168 |         type: 'success',169 |         title: 'Success!',170 |         description: `Successfully created ${data?.length || 0} sample customers`171 |       }172 |     });173 | 174 |   } catch (error) {175 |     return NextResponse.json({176 |       success: false,177 |       error: 'Internal server error',178 |       message: 'An unexpected error occurred',179 |       toast: {180 |         type: 'error',181 |         title: 'Unexpected Error',182 |         description: 'An unexpected error occurred. Please try again.'183 |       }184 |     }, { status: 500 });185 |   }186 | }
============================================================END: frontend/app/api/admin/seed/clients/route.ts============================================================


============================================================FILE: frontend/app/api/admin/seed/content/route.tsSIZE: 1.24 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | export async function POST(request: NextRequest) { 11 |   try { 12 |     const user = await requireAuth(request); 13 |     if (!user) { 14 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 15 |     } 16 |  17 |     const body = await request.json(); 18 |     const { content } = body; 19 |  20 |     if (!content) { 21 |       return NextResponse.json({ 22 |         error: 'Content data is required' 23 |       }, { status: 400 }); 24 |     } 25 |  26 |     const { data, error } = await supabase 27 |       .from('content') 28 |       .upsert(content, { onConflict: 'id' }) 29 |       .select() 30 |       .single(); 31 |  32 |     if (error) { 33 |       return NextResponse.json({ error: 'Failed to seed content' }, { status: 500 }); 34 |     } 35 |  36 |     return NextResponse.json({ 37 |       success: true, 38 |       message: 'Content seeded successfully', 39 |       content: data 40 |     }); 41 |  42 |   } catch (error) { 43 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 44 |   } 45 | }
============================================================END: frontend/app/api/admin/seed/content/route.ts============================================================


============================================================FILE: frontend/app/api/admin/seed/schedules/route.tsSIZE: 5.90 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { z } from 'zod';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | const sampleScheduleSchema = z.object({ 11 |   date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)'), 12 |   time: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)'), 13 |   duration: z.number().min(30, 'Duration must be at least 30 minutes').max(180, 'Duration cannot exceed 3 hours'), 14 |   capacity: z.number().min(1, 'Capacity must be at least 1').max(10, 'Capacity cannot exceed 10'), 15 |   available: z.boolean().default(true), 16 |   notes: z.string().optional() 17 | }); 18 |  19 | const seedSchedulesSchema = z.object({ 20 |   schedules: z.array(sampleScheduleSchema) 21 | }); 22 |  23 | export async function POST() { 24 |   try { 25 |  26 |     const sampleSchedules = []; 27 |     const today = new Date(); 28 |  29 |     for (let i = 0; i < 30; i++) { 30 |       const date = new Date(today); 31 |       date.setDate(today.getDate() + i); 32 |       const dateString = date.toISOString().split('T')[0]; 33 |  34 |       sampleSchedules.push({ 35 |         date: dateString, 36 |         time: '09:00', 37 |         duration: 90, 38 |         capacity: 3, 39 |         available: true, 40 |         notes: 'Morning birth chart reading session', 41 |         created_at: new Date().toISOString() 42 |       }); 43 |  44 |       sampleSchedules.push({ 45 |         date: dateString, 46 |         time: '11:00', 47 |         duration: 60, 48 |         capacity: 2, 49 |         available: true, 50 |         notes: 'Morning relationship compatibility session', 51 |         created_at: new Date().toISOString() 52 |       }); 53 |  54 |       sampleSchedules.push({ 55 |         date: dateString, 56 |         time: '14:00', 57 |         duration: 90, 58 |         capacity: 3, 59 |         available: true, 60 |         notes: 'Afternoon birth chart reading session', 61 |         created_at: new Date().toISOString() 62 |       }); 63 |  64 |       sampleSchedules.push({ 65 |         date: dateString, 66 |         time: '16:00', 67 |         duration: 60, 68 |         capacity: 2, 69 |         available: true, 70 |         notes: 'Afternoon career guidance session', 71 |         created_at: new Date().toISOString() 72 |       }); 73 |  74 |       sampleSchedules.push({ 75 |         date: dateString, 76 |         time: '18:00', 77 |         duration: 90, 78 |         capacity: 2, 79 |         available: true, 80 |         notes: 'Evening birth chart reading session', 81 |         created_at: new Date().toISOString() 82 |       }); 83 |     } 84 |  85 |     const validation = seedSchedulesSchema.safeParse({ schedules: sampleSchedules }); 86 |     if (!validation.success) { 87 |       return NextResponse.json({ 88 |         success: false, 89 |         error: 'Validation failed', 90 |         message: 'Sample schedule data validation failed', 91 |         details: validation.error.issues, 92 |         toast: { 93 |           type: 'error', 94 |           title: 'Validation Error', 95 |           description: 'Sample schedule data validation failed. Please check the data format.' 96 |         } 97 |       }, { status: 400 }); 98 |     } 99 | 100 |     const { data: existingSchedules, error: checkError } = await supabase101 |       .from('schedules')102 |       .select('date, time')103 |       .gte('date', today.toISOString().split('T')[0])104 |       .lte('date', new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]);105 | 106 |     if (checkError) {107 |       return NextResponse.json({108 |         success: false,109 |         error: 'Database error',110 |         message: 'Failed to check existing schedules',111 |         details: checkError.message,112 |         toast: {113 |           type: 'error',114 |           title: 'Database Error',115 |           description: 'Failed to check existing schedules. Please try again.'116 |         }117 |       }, { status: 500 });118 |     }119 | 120 |     const existingScheduleKeys = new Set(121 |       existingSchedules?.map(s => `${s.date}-${s.time}`) || []122 |     );123 | 124 |     const newSchedules = sampleSchedules.filter(schedule =>125 |       !existingScheduleKeys.has(`${schedule.date}-${schedule.time}`)126 |     );127 | 128 |     if (newSchedules.length === 0) {129 |       return NextResponse.json({130 |         success: false,131 |         error: 'No new schedules',132 |         message: 'All sample schedules already exist',133 |         toast: {134 |           type: 'warning',135 |           title: 'No New Schedules',136 |           description: 'All sample schedules already exist'137 |         }138 |       }, { status: 400 });139 |     }140 | 141 |     const { data, error } = await supabase142 |       .from('schedules')143 |       .insert(newSchedules)144 |       .select();145 | 146 |     if (error) {147 |       return NextResponse.json({148 |         success: false,149 |         error: 'Database error',150 |         message: 'Failed to seed schedules',151 |         details: error.message,152 |         toast: {153 |           type: 'error',154 |           title: 'Database Error',155 |           description: 'Failed to create sample schedules. Please try again.'156 |         }157 |       }, { status: 500 });158 |     }159 | 160 |     return NextResponse.json({161 |       success: true,162 |       message: 'Sample schedules created successfully',163 |       count: data?.length || 0,164 |       schedules: data,165 |       toast: {166 |         type: 'success',167 |         title: 'Success!',168 |         description: `Successfully created ${data?.length || 0} sample schedules`169 |       }170 |     });171 | 172 |   } catch (error) {173 |     return NextResponse.json({174 |       success: false,175 |       error: 'Internal server error',176 |       message: 'An unexpected error occurred',177 |       toast: {178 |         type: 'error',179 |         title: 'Unexpected Error',180 |         description: 'An unexpected error occurred. Please try again.'181 |       }182 |     }, { status: 500 });183 |   }184 | }
============================================================END: frontend/app/api/admin/seed/schedules/route.ts============================================================


============================================================FILE: frontend/app/api/admin/seed/seo/route.tsSIZE: 1.20 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | export async function POST(request: NextRequest) { 11 |   try { 12 |     const user = await requireAuth(request); 13 |     if (!user) { 14 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 15 |     } 16 |  17 |     const body = await request.json(); 18 |     const { seo } = body; 19 |  20 |     if (!seo) { 21 |       return NextResponse.json({ 22 |         error: 'SEO data is required' 23 |       }, { status: 400 }); 24 |     } 25 |  26 |     const { data, error } = await supabase 27 |       .from('seo') 28 |       .upsert(seo, { onConflict: 'id' }) 29 |       .select() 30 |       .single(); 31 |  32 |     if (error) { 33 |       return NextResponse.json({ error: 'Failed to seed SEO' }, { status: 500 }); 34 |     } 35 |  36 |     return NextResponse.json({ 37 |       success: true, 38 |       message: 'SEO seeded successfully', 39 |       seo: data 40 |     }); 41 |  42 |   } catch (error) { 43 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 44 |   } 45 | }
============================================================END: frontend/app/api/admin/seed/seo/route.ts============================================================


============================================================FILE: frontend/app/api/admin/session-durations/route.tsSIZE: 9.40 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const createSessionDurationSchema = z.object({  7 |   name: z.string().min(1, 'Name is required').max(100, 'Name too long'),  8 |   duration_minutes: z.number().int().min(15, 'Duration must be at least 15 minutes').max(480, 'Duration cannot exceed 8 hours'),  9 |   description: z.string().optional(), 10 |   is_active: z.boolean().default(true) 11 | }); 12 |  13 | const updateSessionDurationSchema = createSessionDurationSchema.partial().extend({ 14 |   id: z.number().int().positive('Session duration ID must be positive') 15 | }); 16 |  17 | const querySchema = z.object({ 18 |   is_active: z.enum(['true', 'false']).optional(), 19 |   page: z.coerce.number().int().min(1).default(1), 20 |   limit: z.coerce.number().int().min(1).max(100).default(20) 21 | }); 22 |  23 | export async function GET(request: NextRequest) { 24 |   try { 25 |     const user = await requireAuth(request); 26 |     if (!user || user.role !== 'admin') { 27 |       return NextResponse.json({ 28 |         success: false, 29 |         error: 'Unauthorized', 30 |         message: 'Admin access required' 31 |       }, { status: 401 }); 32 |     } 33 |  34 |     const { searchParams } = new URL(request.url); 35 |     const queryParams = Object.fromEntries(searchParams.entries()); 36 |     const validation = querySchema.safeParse(queryParams); 37 |  38 |     if (!validation.success) { 39 |       return NextResponse.json({ 40 |         success: false, 41 |         error: 'Invalid query parameters', 42 |         details: validation.error.issues 43 |       }, { status: 400 }); 44 |     } 45 |  46 |     const { is_active, page, limit } = validation.data; 47 |     const offset = (page - 1) * limit; 48 |  49 |     const where: Record<string, unknown> = {}; 50 |     if (is_active !== undefined) where.is_active = is_active === 'true'; 51 |  52 |     const [sessionDurations, totalCount] = await Promise.all([ 53 |       prisma.sessionDuration.findMany({ 54 |         where, 55 |         skip: offset, 56 |         take: limit, 57 |         orderBy: { duration_minutes: 'asc' } 58 |       }), 59 |       prisma.sessionDuration.count({ where }) 60 |     ]); 61 |  62 |     const totalPages = Math.ceil(totalCount / limit); 63 |  64 |     return NextResponse.json({ 65 |       success: true, 66 |       data: sessionDurations, 67 |       pagination: { 68 |         page, 69 |         limit, 70 |         total: totalCount, 71 |         totalPages 72 |       } 73 |     }); 74 |  75 |   } catch (error) { 76 |     return NextResponse.json({ 77 |       success: false, 78 |       error: 'Internal server error', 79 |       message: 'An unexpected error occurred', 80 |       details: error instanceof Error ? error.message : 'Unknown error' 81 |     }, { status: 500 }); 82 |   } finally { 83 |     await prisma.$disconnect(); 84 |   } 85 | } 86 |  87 | export async function POST(request: NextRequest) { 88 |   try { 89 |     const user = await requireAuth(request); 90 |     if (!user || user.role !== 'admin') { 91 |       return NextResponse.json({ 92 |         success: false, 93 |         error: 'Unauthorized', 94 |         message: 'Admin access required' 95 |       }, { status: 401 }); 96 |     } 97 |  98 |     const body = await request.json(); 99 |     const validation = createSessionDurationSchema.safeParse(body);100 | 101 |     if (!validation.success) {102 |       return NextResponse.json({103 |         success: false,104 |         error: 'Validation failed',105 |         message: 'Invalid session duration data',106 |         details: validation.error.issues107 |       }, { status: 400 });108 |     }109 | 110 |     const durationData = validation.data;111 | 112 |     const existingDuration = await prisma.sessionDuration.findFirst({113 |       where: { name: durationData.name }114 |     });115 | 116 |     if (existingDuration) {117 |       return NextResponse.json({118 |         success: false,119 |         error: 'Session duration already exists',120 |         message: 'A session duration with this name already exists'121 |       }, { status: 409 });122 |     }123 | 124 |     const newSessionDuration = await prisma.sessionDuration.create({125 |       data: durationData126 |     });127 | 128 |     return NextResponse.json({129 |       success: true,130 |       message: 'Session duration created successfully',131 |       data: newSessionDuration132 |     }, { status: 201 });133 | 134 |   } catch (error) {135 |     return NextResponse.json({136 |       success: false,137 |       error: 'Internal server error',138 |       message: 'Failed to create session duration',139 |       details: error instanceof Error ? error.message : 'Unknown error'140 |     }, { status: 500 });141 |   } finally {142 |     await prisma.$disconnect();143 |   }144 | }145 | 146 | export async function PUT(request: NextRequest) {147 |   try {148 |     const user = await requireAuth(request);149 |     if (!user || user.role !== 'admin') {150 |       return NextResponse.json({151 |         success: false,152 |         error: 'Unauthorized',153 |         message: 'Admin access required'154 |       }, { status: 401 });155 |     }156 | 157 |     const body = await request.json();158 |     const validation = updateSessionDurationSchema.safeParse(body);159 | 160 |     if (!validation.success) {161 |       return NextResponse.json({162 |         success: false,163 |         error: 'Validation failed',164 |         message: 'Invalid session duration update data',165 |         details: validation.error.issues166 |       }, { status: 400 });167 |     }168 | 169 |     const { id, ...updateData } = validation.data;170 | 171 |     const existingDuration = await prisma.sessionDuration.findUnique({172 |       where: { id }173 |     });174 | 175 |     if (!existingDuration) {176 |       return NextResponse.json({177 |         success: false,178 |         error: 'Session duration not found',179 |         message: 'Session duration with this ID does not exist'180 |       }, { status: 404 });181 |     }182 | 183 |     if (updateData.name && updateData.name !== existingDuration.name) {184 |       const nameConflict = await prisma.sessionDuration.findFirst({185 |         where: {186 |           name: updateData.name,187 |           id: { not: id }188 |         }189 |       });190 | 191 |       if (nameConflict) {192 |         return NextResponse.json({193 |           success: false,194 |           error: 'Name conflict',195 |           message: 'A session duration with this name already exists'196 |         }, { status: 409 });197 |       }198 |     }199 | 200 |     const updatedSessionDuration = await prisma.sessionDuration.update({201 |       where: { id },202 |       data: updateData203 |     });204 | 205 |     return NextResponse.json({206 |       success: true,207 |       message: 'Session duration updated successfully',208 |       data: updatedSessionDuration209 |     });210 | 211 |   } catch (error) {212 |     return NextResponse.json({213 |       success: false,214 |       error: 'Internal server error',215 |       message: 'Failed to update session duration',216 |       details: error instanceof Error ? error.message : 'Unknown error'217 |     }, { status: 500 });218 |   } finally {219 |     await prisma.$disconnect();220 |   }221 | }222 | 223 | export async function DELETE(request: NextRequest) {224 |   try {225 |     const user = await requireAuth(request);226 |     if (!user || user.role !== 'admin') {227 |       return NextResponse.json({228 |         success: false,229 |         error: 'Unauthorized',230 |         message: 'Admin access required'231 |       }, { status: 401 });232 |     }233 | 234 |     const { searchParams } = new URL(request.url);235 |     const durationId = searchParams.get('id');236 | 237 |     if (!durationId) {238 |       return NextResponse.json({239 |         success: false,240 |         error: 'Missing ID',241 |         message: 'Session duration ID is required'242 |       }, { status: 400 });243 |     }244 | 245 |     const id = parseInt(durationId);246 |     if (isNaN(id)) {247 |       return NextResponse.json({248 |         success: false,249 |         error: 'Invalid ID',250 |         message: 'Session duration ID must be a number'251 |       }, { status: 400 });252 |     }253 | 254 |     const existingDuration = await prisma.sessionDuration.findUnique({255 |       where: { id },256 |       include: {257 |         scheduleTemplates: {258 |           where: { isAvailable: true }259 |         }260 |       }261 |     });262 | 263 |     if (!existingDuration) {264 |       return NextResponse.json({265 |         success: false,266 |         error: 'Session duration not found',267 |         message: 'Session duration with this ID does not exist'268 |       }, { status: 404 });269 |     }270 | 271 |     if (existingDuration.scheduleTemplates.length > 0) {272 |       return NextResponse.json({273 |         success: false,274 |         error: 'Cannot delete session duration',275 |         message: 'Session duration is being used by active schedule templates and cannot be deleted'276 |       }, { status: 400 });277 |     }278 | 279 |     await prisma.sessionDuration.delete({280 |       where: { id }281 |     });282 | 283 |     return NextResponse.json({284 |       success: true,285 |       message: 'Session duration deleted successfully'286 |     });287 | 288 |   } catch (error) {289 |     return NextResponse.json({290 |       success: false,291 |       error: 'Internal server error',292 |       message: 'Failed to delete session duration',293 |       details: error instanceof Error ? error.message : 'Unknown error'294 |     }, { status: 500 });295 |   } finally {296 |     await prisma.$disconnect();297 |   }298 | }
============================================================END: frontend/app/api/admin/session-durations/route.ts============================================================


============================================================FILE: frontend/app/api/admin/sms-config/route.tsSIZE: 1.97 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import { z } from 'zod';  4 |   5 | const smsConfigSchema = z.object({  6 |   provider: z.string().default('labsmobile'),  7 |   username: z.string().min(1, 'Username is required'),  8 |   tokenApi: z.string().min(1, 'API token is required'),  9 |   senderName: z.string().optional(), 10 |   isActive: z.boolean().default(true), 11 | }); 12 |  13 | export async function GET() { 14 |   try { 15 |     const config = await prisma.smsConfiguration.findFirst({ 16 |       where: { provider: 'labsmobile' }, 17 |       orderBy: { createdAt: 'desc' } 18 |     }); 19 |  20 |     return NextResponse.json({ 21 |       config: config || null 22 |     }); 23 |   } catch (error) { 24 |     return NextResponse.json( 25 |       { error: 'Failed to load SMS configuration' }, 26 |       { status: 500 } 27 |     ); 28 |   } 29 | } 30 |  31 | export async function POST(request: NextRequest) { 32 |   try { 33 |     const body = await request.json(); 34 |     const validatedData = smsConfigSchema.parse(body); 35 |  36 |     const existingConfig = await prisma.smsConfiguration.findFirst({ 37 |       where: { provider: 'labsmobile' } 38 |     }); 39 |  40 |     let config; 41 |     if (existingConfig) { 42 |  43 |       config = await prisma.smsConfiguration.update({ 44 |         where: { id: existingConfig.id }, 45 |         data: { 46 |           ...validatedData, 47 |           updatedAt: new Date() 48 |         } 49 |       }); 50 |     } else { 51 |  52 |       config = await prisma.smsConfiguration.create({ 53 |         data: validatedData 54 |       }); 55 |     } 56 |  57 |     return NextResponse.json({ 58 |       success: true, 59 |       config 60 |     }); 61 |   } catch (error) { 62 |     if (error instanceof z.ZodError) { 63 |       return NextResponse.json( 64 |         { error: 'Invalid request data', details: error.issues }, 65 |         { status: 400 } 66 |       ); 67 |     } 68 |  69 |     return NextResponse.json( 70 |       { error: 'Failed to save SMS configuration' }, 71 |       { status: 500 } 72 |     ); 73 |   } 74 | }
============================================================END: frontend/app/api/admin/sms-config/route.ts============================================================


============================================================FILE: frontend/app/api/admin/sms-config/test/route.tsSIZE: 1.31 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { z } from 'zod';  3 |   4 | const testConfigSchema = z.object({  5 |   username: z.string().min(1, 'Username is required'),  6 |   tokenApi: z.string().min(1, 'API token is required'),  7 | });  8 |   9 | export async function POST(request: NextRequest) { 10 |   try { 11 |     const body = await request.json(); 12 |     const { username, tokenApi } = testConfigSchema.parse(body); 13 |  14 |     const authHeader = Buffer.from(`${username}:${tokenApi}`).toString('base64'); 15 |  16 |     const response = await fetch('https: 17 |       method: 'GET', 18 |       headers: { 19 |         'Authorization': `Basic ${authHeader}`, 20 |         'Content-Type': 'application/json', 21 |       }, 22 |     }); 23 |  24 |     if (!response.ok) { 25 |       throw new Error(`HTTP error! status: ${response.status}`); 26 |     } 27 |  28 |     const balance = await response.json(); 29 |  30 |     return NextResponse.json({ 31 |       success: true, 32 |       balance 33 |     }); 34 |   } catch (error) { 35 |     if (error instanceof z.ZodError) { 36 |       return NextResponse.json( 37 |         { error: 'Invalid request data', details: error.issues }, 38 |         { status: 400 } 39 |       ); 40 |     } 41 |  42 |     return NextResponse.json( 43 |       { error: 'Failed to test SMS configuration' }, 44 |       { status: 500 } 45 |     ); 46 |   } 47 | }
============================================================END: frontend/app/api/admin/sms-config/test/route.ts============================================================


============================================================FILE: frontend/app/api/admin/sms-config/test-sms/route.tsSIZE: 1.67 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { z } from 'zod';  3 |   4 | const testSmsSchema = z.object({  5 |   phoneNumber: z.string().min(1, 'Phone number is required'),  6 |   message: z.string().min(1, 'Message is required'),  7 |   username: z.string().min(1, 'Username is required'),  8 |   tokenApi: z.string().min(1, 'API token is required'),  9 |   senderName: z.string().optional(), 10 | }); 11 |  12 | export async function POST(request: NextRequest) { 13 |   try { 14 |     const body = await request.json(); 15 |     const { phoneNumber, message, username, tokenApi, senderName } = testSmsSchema.parse(body); 16 |  17 |     const authHeader = Buffer.from(`${username}:${tokenApi}`).toString('base64'); 18 |  19 |     const smsData = { 20 |       message, 21 |       tpoa: senderName || 'MatMax Yoga Studio', 22 |       recipient: [ 23 |         { 24 |           msisdn: phoneNumber 25 |         } 26 |       ] 27 |     }; 28 |  29 |     const response = await fetch('https: 30 |       method: 'POST', 31 |       headers: { 32 |         'Authorization': `Basic ${authHeader}`, 33 |         'Content-Type': 'application/json', 34 |       }, 35 |       body: JSON.stringify(smsData), 36 |     }); 37 |  38 |     if (!response.ok) { 39 |       throw new Error(`HTTP error! status: ${response.status}`); 40 |     } 41 |  42 |     const result = await response.json(); 43 |  44 |     return NextResponse.json({ 45 |       success: true, 46 |       result 47 |     }); 48 |   } catch (error) { 49 |     if (error instanceof z.ZodError) { 50 |       return NextResponse.json( 51 |         { error: 'Invalid request data', details: error.issues }, 52 |         { status: 400 } 53 |       ); 54 |     } 55 |  56 |     return NextResponse.json( 57 |       { error: 'Failed to send test SMS' }, 58 |       { status: 500 } 59 |     ); 60 |   } 61 | }
============================================================END: frontend/app/api/admin/sms-config/test-sms/route.ts============================================================


============================================================FILE: frontend/app/api/admin/sms-templates/route.tsSIZE: 3.87 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { createAdminClient } from '@/lib/supabase/admin';  4 |   5 | export async function GET(request: NextRequest) {  6 |   try {  7 |     const user = await requireAuth(request);  8 |     if (!user) {  9 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 10 |     } 11 |  12 |     const supabase = createAdminClient(); 13 |  14 |     const { data, error } = await supabase 15 |       .from('email_config') 16 |       .select('sms_otp_template_en, sms_otp_template_es, sms_booking_template_en, sms_booking_template_es') 17 |       .single(); 18 |  19 |     if (error) { 20 |  21 |       const defaultTemplates = { 22 |         sms_otp_template_en: 'Your MatMax Yoga Studio verification code is: {{otpCode}}. This code expires in 10 minutes.', 23 |         sms_otp_template_es: 'Su código de verificación de MatMax Yoga Studio es: {{otpCode}}. Este código expira en 10 minutos.', 24 |         sms_booking_template_en: 'Your MatMax Yoga Studio class is confirmed for {{bookingDate}} at {{bookingTime}}. We look forward to seeing you!', 25 |         sms_booking_template_es: 'Su clase en MatMax Yoga Studio está confirmada para el {{bookingDate}} a las {{bookingTime}}. ¡Esperamos verte!' 26 |       }; 27 |  28 |       return NextResponse.json({ templates: defaultTemplates }); 29 |     } 30 |  31 |     return NextResponse.json({ templates: data }); 32 |   } catch (error) { 33 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 34 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 35 |   } 36 | } 37 |  38 | export async function PUT(request: NextRequest) { 39 |   try { 40 |     const user = await requireAuth(request); 41 |     if (!user) { 42 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 43 |     } 44 |  45 |     const body = await request.json(); 46 |     const supabase = createAdminClient(); 47 |  48 |     const { data, error } = await supabase 49 |       .from('email_config') 50 |       .upsert({ 51 |         sms_otp_template_en: body.sms_otp_template_en, 52 |         sms_otp_template_es: body.sms_otp_template_es, 53 |         sms_booking_template_en: body.sms_booking_template_en, 54 |         sms_booking_template_es: body.sms_booking_template_es 55 |       }, { onConflict: 'id' }) 56 |       .select() 57 |       .single(); 58 |  59 |     if (error) { 60 |       return NextResponse.json({ 61 |         error: 'SMS templates configuration table does not exist. Please run the database setup first.', 62 |         details: error.message 63 |       }, { status: 500 }); 64 |     } 65 |  66 |     return NextResponse.json({ templates: data }); 67 |   } catch (error) { 68 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 69 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 70 |   } 71 | }
============================================================END: frontend/app/api/admin/sms-templates/route.ts============================================================


============================================================FILE: frontend/app/api/admin/telegram-config/route.tsSIZE: 8.65 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { createAdminClient } from '@/lib/supabase/admin';  4 | import { TelegramService } from '@/lib/services/telegram-service';  5 |   6 | export async function GET(request: NextRequest) {  7 |   try {  8 |     const user = await requireAuth(request);  9 |     if (!user) { 10 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 11 |     } 12 |  13 |     if (user.role !== 'admin') { 14 |       return NextResponse.json({ error: 'Admin access required' }, { status: 403 }); 15 |     } 16 |  17 |     const supabase = createAdminClient(); 18 |  19 |     const { data, error } = await supabase 20 |       .from('telegram_config') 21 |       .select('*') 22 |       .single(); 23 |  24 |     if (error) { 25 |  26 |       const defaultConfig = { 27 |         bot_token: '', 28 |         webhook_url: '', 29 |         is_active: false, 30 |         bot_username: '', 31 |         bot_name: '', 32 |         webhook_set: false, 33 |         last_webhook_error: null, 34 |         created_at: new Date().toISOString(), 35 |         updated_at: new Date().toISOString() 36 |       }; 37 |  38 |       return NextResponse.json({ config: defaultConfig }); 39 |     } 40 |  41 |     return NextResponse.json({ config: data }); 42 |   } catch (error) { 43 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'; 44 |     return NextResponse.json({ error: 'Internal server error', details: errorMessage }, { status: 500 }); 45 |   } 46 | } 47 |  48 | export async function POST(request: NextRequest) { 49 |   try { 50 |     const user = await requireAuth(request); 51 |     if (!user) { 52 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 53 |     } 54 |  55 |     if (user.role !== 'admin') { 56 |       return NextResponse.json({ error: 'Admin access required' }, { status: 403 }); 57 |     } 58 |  59 |     const body = await request.json(); 60 |     const { bot_token, webhook_url, is_active } = body; 61 |  62 |     const supabase = createAdminClient(); 63 |  64 |     let botInfo = null; 65 |     let webhookSet = false; 66 |     let lastWebhookError = null; 67 |  68 |     if (bot_token) { 69 |       try { 70 |         const telegramService = new TelegramService(bot_token); 71 |         const testResult = await telegramService.testConnection(); 72 |  73 |         if (testResult.success && testResult.botInfo) { 74 |           botInfo = testResult.botInfo; 75 |           } else { 76 |           return NextResponse.json({ 77 |             error: 'Invalid bot token', 78 |             details: testResult.message 79 |           }, { status: 400 }); 80 |         } 81 |       } catch (error) { 82 |         return NextResponse.json({ 83 |           error: 'Failed to validate bot token', 84 |           details: error instanceof Error ? error.message : 'Unknown error' 85 |         }, { status: 400 }); 86 |       } 87 |     } 88 |  89 |     if (bot_token && webhook_url) { 90 |       try { 91 |         const telegramService = new TelegramService(bot_token); 92 |         const webhookResult = await telegramService.setWebhook(webhook_url); 93 |  94 |         if (webhookResult) { 95 |           webhookSet = true; 96 |           } else { 97 |           lastWebhookError = 'Failed to set webhook'; 98 |           } 99 |       } catch (error) {100 |         lastWebhookError = error instanceof Error ? error.message : 'Unknown error';101 |         }102 |     }103 | 104 |     const configData = {105 |       bot_token: bot_token || '',106 |       webhook_url: webhook_url || '',107 |       is_active: is_active || false,108 |       bot_username: botInfo?.username || '',109 |       bot_name: botInfo?.first_name || '',110 |       webhook_set: webhookSet,111 |       last_webhook_error: lastWebhookError,112 |       updated_at: new Date().toISOString()113 |     };114 | 115 |     const { data: existingConfig } = await supabase116 |       .from('telegram_config')117 |       .select('id')118 |       .single();119 | 120 |     let result;121 |     if (existingConfig) {122 | 123 |       const { data, error } = await supabase124 |         .from('telegram_config')125 |         .update(configData)126 |         .eq('id', existingConfig.id)127 |         .select()128 |         .single();129 | 130 |       if (error) {131 |         return NextResponse.json({132 |           error: 'Failed to update configuration',133 |           details: error.message134 |         }, { status: 500 });135 |       }136 | 137 |       result = data;138 |       } else {139 | 140 |       const { data, error } = await supabase141 |         .from('telegram_config')142 |         .insert([{143 |           ...configData,144 |           created_at: new Date().toISOString()145 |         }])146 |         .select()147 |         .single();148 | 149 |       if (error) {150 |         return NextResponse.json({151 |           error: 'Failed to create configuration',152 |           details: error.message153 |         }, { status: 500 });154 |       }155 | 156 |       result = data;157 |       }158 | 159 |     return NextResponse.json({160 |       success: true,161 |       config: result,162 |       message: 'Telegram configuration saved successfully'163 |     });164 | 165 |   } catch (error) {166 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';167 |     return NextResponse.json({168 |       error: 'Internal server error',169 |       details: errorMessage170 |     }, { status: 500 });171 |   }172 | }173 | 174 | export async function DELETE(request: NextRequest) {175 |   try {176 |     const user = await requireAuth(request);177 |     if (!user) {178 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });179 |     }180 | 181 |     if (user.role !== 'admin') {182 |       return NextResponse.json({ error: 'Admin access required' }, { status: 403 });183 |     }184 | 185 |     const supabase = createAdminClient();186 | 187 |     const { data: currentConfig } = await supabase188 |       .from('telegram_config')189 |       .select('bot_token')190 |       .single();191 | 192 |     if (currentConfig?.bot_token) {193 |       try {194 |         const telegramService = new TelegramService(currentConfig.bot_token);195 |         await telegramService.deleteWebhook();196 |         } catch (error) {197 |         }198 |     }199 | 200 |     const { error } = await supabase201 |       .from('telegram_config')202 |       .delete()203 |       .neq('id', '00000000-0000-0000-0000-000000000000');204 | 205 |     if (error) {206 |       return NextResponse.json({207 |         error: 'Failed to delete configuration',208 |         details: error.message209 |       }, { status: 500 });210 |     }211 | 212 |     return NextResponse.json({213 |       success: true,214 |       message: 'Telegram configuration deleted successfully'215 |     });216 | 217 |   } catch (error) {218 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';219 |     return NextResponse.json({220 |       error: 'Internal server error',221 |       details: errorMessage222 |     }, { status: 500 });223 |   }224 | }
============================================================END: frontend/app/api/admin/telegram-config/route.ts============================================================


============================================================FILE: frontend/app/api/admin/user-packages/route.tsSIZE: 17.55 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const createUserPackageSchema = z.object({  7 |   userId: z.string().cuid('Invalid user ID format'),  8 |   purchaseId: z.number().int().positive('Purchase ID must be positive'),  9 |   packagePriceId: z.number().int().positive('Package price ID must be positive'), 10 |   quantity: z.number().int().positive('Quantity must be positive').default(1), 11 |   sessionsUsed: z.number().int().min(0, 'Sessions used cannot be negative').default(0), 12 |   isActive: z.boolean().default(true), 13 |   expiresAt: z.string().datetime('Invalid expiry date format').optional() 14 | }); 15 |  16 | const updateUserPackageSchema = createUserPackageSchema.partial().extend({ 17 |   id: z.number().int().positive('User package ID must be positive') 18 | }); 19 |  20 | const querySchema = z.object({ 21 |   userId: z.string().cuid().optional(), 22 |   purchaseId: z.coerce.number().int().positive().optional(), 23 |   isActive: z.enum(['true', 'false']).optional(), 24 |   hasRemainingSessions: z.enum(['true', 'false']).optional(), 25 |   packageType: z.string().optional(), 26 |   page: z.coerce.number().int().min(1).default(1), 27 |   limit: z.coerce.number().int().min(1).max(100).default(20), 28 |   enhanced: z.enum(['true', 'false']).optional() 29 | }); 30 |  31 | export async function GET(request: NextRequest) { 32 |   try { 33 |     const user = await requireAuth(request); 34 |     if (!user || user.role !== 'admin') { 35 |       return NextResponse.json({ 36 |         success: false, 37 |         error: 'Unauthorized', 38 |         message: 'Admin access required' 39 |       }, { status: 401 }); 40 |     } 41 |  42 |     const { searchParams } = new URL(request.url); 43 |     const queryParams = Object.fromEntries(searchParams.entries()); 44 |     const validation = querySchema.safeParse(queryParams); 45 |  46 |     if (!validation.success) { 47 |       return NextResponse.json({ 48 |         success: false, 49 |         error: 'Invalid query parameters', 50 |         details: validation.error.issues 51 |       }, { status: 400 }); 52 |     } 53 |  54 |     const { userId, purchaseId, isActive, hasRemainingSessions, packageType, page, limit, enhanced } = validation.data; 55 |     const offset = (page - 1) * limit; 56 |  57 |     const where: Record<string, unknown> = {}; 58 |  59 |     if (userId) where.userId = userId; 60 |     if (purchaseId) where.purchaseId = purchaseId; 61 |     if (isActive !== undefined) where.isActive = isActive === 'true'; 62 |     if (packageType) { 63 |       where.packagePrice = { 64 |         packageDefinition: { 65 |           packageType: packageType 66 |         } 67 |       }; 68 |     } 69 |  70 |     const select: Record<string, unknown> = { 71 |       id: true, 72 |       userId: true, 73 |       purchaseId: true, 74 |       packagePriceId: true, 75 |       quantity: true, 76 |       sessionsUsed: true, 77 |       isActive: true, 78 |       expiresAt: true, 79 |       createdAt: true, 80 |       updatedAt: true, 81 |       user: { 82 |         select: { 83 |           id: true, 84 |           email: true, 85 |           fullName: true, 86 |           phone: true 87 |         } 88 |       }, 89 |       purchase: { 90 |         select: { 91 |           id: true, 92 |           totalAmount: true, 93 |           paymentStatus: true, 94 |           purchasedAt: true 95 |         } 96 |       }, 97 |       packagePrice: { 98 |         select: { 99 |           id: true,100 |           price: true,101 |           pricingMode: true,102 |           packageDefinition: {103 |             select: {104 |               id: true,105 |               name: true,106 |               description: true,107 |               sessionsCount: true,108 |               packageType: true,109 |               sessionDuration: {110 |                 select: {111 |                   id: true,112 |                   name: true,113 |                   duration_minutes: true114 |                 }115 |               }116 |             }117 |           },118 |           currency: {119 |             select: {120 |               id: true,121 |               code: true,122 |               name: true,123 |               symbol: true124 |             }125 |           }126 |         }127 |       }128 |     };129 | 130 |     if (enhanced === 'true') {131 |       select._count = {132 |         bookings: true133 |       };134 |       select.bookingHistory = {135 |         take: 10,136 |         orderBy: { createdAt: 'desc' },137 |         select: {138 |           id: true,139 |           sessionType: true,140 |           status: true,141 |           createdAt: true,142 |           scheduleSlot: {143 |             select: {144 |               id: true,145 |               startTime: true,146 |               endTime: true147 |             }148 |           }149 |         }150 |       };151 |     }152 | 153 |     const [userPackages, totalCount] = await Promise.all([154 |       prisma.userPackage.findMany({155 |         where,156 |         select,157 |         skip: offset,158 |         take: limit,159 |         orderBy: { createdAt: 'desc' }160 |       }),161 |       prisma.userPackage.count({ where })162 |     ]);163 | 164 |     const filteredPackages = userPackages;165 | 166 |     const totalPages = Math.ceil(totalCount / limit);167 | 168 |     return NextResponse.json({169 |       success: true,170 |       data: filteredPackages,171 |       pagination: {172 |         page,173 |         limit,174 |         total: totalCount,175 |         totalPages176 |       }177 |     });178 | 179 |   } catch (error) {180 |     return NextResponse.json({181 |       success: false,182 |       error: 'Internal server error',183 |       message: 'An unexpected error occurred',184 |       details: error instanceof Error ? error.message : 'Unknown error'185 |     }, { status: 500 });186 |   } finally {187 |     await prisma.$disconnect();188 |   }189 | }190 | 191 | export async function POST(request: NextRequest) {192 |   try {193 |     const user = await requireAuth(request);194 |     if (!user || user.role !== 'admin') {195 |       return NextResponse.json({196 |         success: false,197 |         error: 'Unauthorized',198 |         message: 'Admin access required'199 |       }, { status: 401 });200 |     }201 | 202 |     const body = await request.json();203 |     const validation = createUserPackageSchema.safeParse(body);204 | 205 |     if (!validation.success) {206 |       return NextResponse.json({207 |         success: false,208 |         error: 'Validation failed',209 |         message: 'Invalid user package data',210 |         details: validation.error.issues211 |       }, { status: 400 });212 |     }213 | 214 |     const packageData = validation.data;215 | 216 |     const targetUser = await prisma.user.findUnique({217 |       where: { id: packageData.userId }218 |     });219 | 220 |     if (!targetUser) {221 |       return NextResponse.json({222 |         success: false,223 |         error: 'User not found',224 |         message: 'The specified user does not exist'225 |       }, { status: 404 });226 |     }227 | 228 |     const purchase = await prisma.purchase.findUnique({229 |       where: { id: packageData.purchaseId }230 |     });231 | 232 |     if (!purchase) {233 |       return NextResponse.json({234 |         success: false,235 |         error: 'Purchase not found',236 |         message: 'The specified purchase does not exist'237 |       }, { status: 404 });238 |     }239 | 240 |     const packagePrice = await prisma.packagePrice.findUnique({241 |       where: { id: packageData.packagePriceId },242 |       include: {243 |         packageDefinition: {244 |           select: {245 |             sessionsCount: true246 |           }247 |         }248 |       }249 |     });250 | 251 |     if (!packagePrice) {252 |       return NextResponse.json({253 |         success: false,254 |         error: 'Package price not found',255 |         message: 'The specified package price does not exist'256 |       }, { status: 404 });257 |     }258 | 259 |     const totalSessions = packagePrice.packageDefinition.sessionsCount * packageData.quantity;260 |     if (packageData.sessionsUsed > totalSessions) {261 |       return NextResponse.json({262 |         success: false,263 |         error: 'Invalid sessions used',264 |         message: 'Sessions used cannot exceed total sessions in package'265 |       }, { status: 400 });266 |     }267 | 268 |     if (purchase.userId !== packageData.userId) {269 |       return NextResponse.json({270 |         success: false,271 |         error: 'Purchase mismatch',272 |         message: 'This purchase does not belong to the specified user'273 |       }, { status: 400 });274 |     }275 | 276 |     const newUserPackage = await prisma.userPackage.create({277 |       data: {278 |         ...packageData,279 |         expiresAt: packageData.expiresAt ? new Date(packageData.expiresAt) : null280 |       },281 |       include: {282 |         user: {283 |           select: {284 |             id: true,285 |             email: true,286 |             fullName: true,287 |             phone: true288 |           }289 |         },290 |         purchase: {291 |           select: {292 |             id: true,293 |             totalAmount: true,294 |             paymentStatus: true,295 |             purchasedAt: true296 |           }297 |         },298 |         packagePrice: {299 |           select: {300 |             id: true,301 |             price: true,302 |             pricingMode: true,303 |             packageDefinition: {304 |               select: {305 |                 id: true,306 |                 name: true,307 |                 description: true,308 |                 sessionsCount: true,309 |                 packageType: true,310 |                 sessionDuration: {311 |                   select: {312 |                     id: true,313 |                     name: true,314 |                     duration_minutes: true315 |                   }316 |                 }317 |               }318 |             },319 |             currency: {320 |               select: {321 |                 id: true,322 |                 code: true,323 |                 name: true,324 |                 symbol: true325 |               }326 |             }327 |           }328 |         }329 |       }330 |     });331 | 332 |     return NextResponse.json({333 |       success: true,334 |       message: 'User package created successfully',335 |       data: newUserPackage336 |     }, { status: 201 });337 | 338 |   } catch (error) {339 |     return NextResponse.json({340 |       success: false,341 |       error: 'Internal server error',342 |       message: 'Failed to create user package',343 |       details: error instanceof Error ? error.message : 'Unknown error'344 |     }, { status: 500 });345 |   } finally {346 |     await prisma.$disconnect();347 |   }348 | }349 | 350 | export async function PUT(request: NextRequest) {351 |   try {352 |     const user = await requireAuth(request);353 |     if (!user || user.role !== 'admin') {354 |       return NextResponse.json({355 |         success: false,356 |         error: 'Unauthorized',357 |         message: 'Admin access required'358 |       }, { status: 401 });359 |     }360 | 361 |     const body = await request.json();362 |     const validation = updateUserPackageSchema.safeParse(body);363 | 364 |     if (!validation.success) {365 |       return NextResponse.json({366 |         success: false,367 |         error: 'Validation failed',368 |         message: 'Invalid user package update data',369 |         details: validation.error.issues370 |       }, { status: 400 });371 |     }372 | 373 |     const { id, ...updateData } = validation.data;374 | 375 |     const existingPackage = await prisma.userPackage.findUnique({376 |       where: { id },377 |       include: {378 |         packagePrice: {379 |           include: {380 |             packageDefinition: {381 |               select: {382 |                 sessionsCount: true383 |               }384 |             }385 |           }386 |         }387 |       }388 |     });389 | 390 |     if (!existingPackage) {391 |       return NextResponse.json({392 |         success: false,393 |         error: 'User package not found',394 |         message: 'User package with this ID does not exist'395 |       }, { status: 404 });396 |     }397 | 398 |     if (updateData.sessionsUsed !== undefined || updateData.quantity !== undefined) {399 |       const newQuantity = updateData.quantity ?? existingPackage.quantity;400 |       const newSessionsUsed = updateData.sessionsUsed ?? existingPackage.sessionsUsed;401 |       const totalSessions = existingPackage.packagePrice.packageDefinition.sessionsCount * (newQuantity || 1);402 | 403 |       if (newSessionsUsed && newSessionsUsed > totalSessions) {404 |         return NextResponse.json({405 |           success: false,406 |           error: 'Invalid sessions used',407 |           message: 'Sessions used cannot exceed total sessions in package'408 |         }, { status: 400 });409 |       }410 |     }411 | 412 |     if (updateData.userId) {413 |       const targetUser = await prisma.user.findUnique({414 |         where: { id: updateData.userId }415 |       });416 | 417 |       if (!targetUser) {418 |         return NextResponse.json({419 |           success: false,420 |           error: 'User not found',421 |           message: 'The specified user does not exist'422 |         }, { status: 404 });423 |       }424 |     }425 | 426 |     if (updateData.purchaseId) {427 |       const purchase = await prisma.purchase.findUnique({428 |         where: { id: updateData.purchaseId }429 |       });430 | 431 |       if (!purchase) {432 |         return NextResponse.json({433 |           success: false,434 |           error: 'Purchase not found',435 |           message: 'The specified purchase does not exist'436 |         }, { status: 404 });437 |       }438 |     }439 | 440 |     if (updateData.packagePriceId) {441 |       const packagePrice = await prisma.packagePrice.findUnique({442 |         where: { id: updateData.packagePriceId }443 |       });444 | 445 |       if (!packagePrice) {446 |         return NextResponse.json({447 |           success: false,448 |           error: 'Package price not found',449 |           message: 'The specified package price does not exist'450 |         }, { status: 404 });451 |       }452 |     }453 | 454 |     const updatedUserPackage = await prisma.userPackage.update({455 |       where: { id },456 |       data: {457 |         ...updateData,458 |         expiresAt: updateData.expiresAt ? new Date(updateData.expiresAt) : undefined459 |       },460 |       include: {461 |         user: {462 |           select: {463 |             id: true,464 |             email: true,465 |             fullName: true,466 |             phone: true467 |           }468 |         },469 |         purchase: {470 |           select: {471 |             id: true,472 |             totalAmount: true,473 |             paymentStatus: true,474 |             purchasedAt: true475 |           }476 |         },477 |         packagePrice: {478 |           select: {479 |             id: true,480 |             price: true,481 |             pricingMode: true,482 |             packageDefinition: {483 |               select: {484 |                 id: true,485 |                 name: true,486 |                 description: true,487 |                 sessionsCount: true,488 |                 packageType: true,489 |                 sessionDuration: {490 |                   select: {491 |                     id: true,492 |                     name: true,493 |                     duration_minutes: true494 |                   }495 |                 }496 |               }497 |             },498 |             currency: {499 |               select: {500 |                 id: true,501 |                 code: true,502 |                 name: true,503 |                 symbol: true504 |               }505 |             }506 |           }507 |         }508 |       }509 |     });510 | 511 |     return NextResponse.json({512 |       success: true,513 |       message: 'User package updated successfully',514 |       data: updatedUserPackage515 |     });516 | 517 |   } catch (error) {518 |     return NextResponse.json({519 |       success: false,520 |       error: 'Internal server error',521 |       message: 'Failed to update user package',522 |       details: error instanceof Error ? error.message : 'Unknown error'523 |     }, { status: 500 });524 |   } finally {525 |     await prisma.$disconnect();526 |   }527 | }528 | 529 | export async function DELETE(request: NextRequest) {530 |   try {531 |     const user = await requireAuth(request);532 |     if (!user || user.role !== 'admin') {533 |       return NextResponse.json({534 |         success: false,535 |         error: 'Unauthorized',536 |         message: 'Admin access required'537 |       }, { status: 401 });538 |     }539 | 540 |     const { searchParams } = new URL(request.url);541 |     const packageId = searchParams.get('id');542 | 543 |     if (!packageId) {544 |       return NextResponse.json({545 |         success: false,546 |         error: 'Missing ID',547 |         message: 'User package ID is required'548 |       }, { status: 400 });549 |     }550 | 551 |     const id = parseInt(packageId);552 |     if (isNaN(id)) {553 |       return NextResponse.json({554 |         success: false,555 |         error: 'Invalid ID',556 |         message: 'User package ID must be a number'557 |       }, { status: 400 });558 |     }559 | 560 |     const existingPackage = await prisma.userPackage.findUnique({561 |       where: { id },562 |       include: {563 |         bookings: {564 |           where: {565 |             status: { in: ['confirmed', 'pending'] }566 |           }567 |         }568 |       }569 |     });570 | 571 |     if (!existingPackage) {572 |       return NextResponse.json({573 |         success: false,574 |         error: 'User package not found',575 |         message: 'User package with this ID does not exist'576 |       }, { status: 404 });577 |     }578 | 579 |     if (existingPackage.bookings.length > 0) {580 |       return NextResponse.json({581 |         success: false,582 |         error: 'Cannot delete user package',583 |         message: 'User package has active bookings and cannot be deleted'584 |       }, { status: 400 });585 |     }586 | 587 |     await prisma.userPackage.delete({588 |       where: { id }589 |     });590 | 591 |     return NextResponse.json({592 |       success: true,593 |       message: 'User package deleted successfully'594 |     });595 | 596 |   } catch (error) {597 |     return NextResponse.json({598 |       success: false,599 |       error: 'Internal server error',600 |       message: 'Failed to delete user package',601 |       details: error instanceof Error ? error.message : 'Unknown error'602 |     }, { status: 500 });603 |   } finally {604 |     await prisma.$disconnect();605 |   }606 | }
============================================================END: frontend/app/api/admin/user-packages/route.ts============================================================


============================================================FILE: frontend/app/api/admin/users/route.tsSIZE: 11.70 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const createUserSchema = z.object({  7 |   email: z.string().email('Invalid email format'),  8 |   fullName: z.string().min(1, 'Full name is required'),  9 |   phone: z.string().optional(), 10 |   role: z.enum(['user', 'admin']).default('user'), 11 |   status: z.enum(['active', 'inactive', 'suspended']).default('active'), 12 |   birthDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)').optional(), 13 |   birthTime: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)').optional(), 14 |   birthPlace: z.string().optional(), 15 |   question: z.string().optional(), 16 |   language: z.enum(['en', 'es']).default('en'), 17 |   adminNotes: z.string().optional(), 18 |   scheduledDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)').optional(), 19 |   scheduledTime: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)').optional(), 20 |   sessionType: z.string().optional(), 21 |   notes: z.string().optional() 22 | }); 23 |  24 | const updateUserSchema = createUserSchema.partial().extend({ 25 |   id: z.string().cuid('Invalid user ID format') 26 | }); 27 |  28 | const querySchema = z.object({ 29 |   email: z.string().email().optional(), 30 |   status: z.enum(['active', 'inactive', 'suspended']).optional(), 31 |   language: z.enum(['en', 'es']).optional(), 32 |   role: z.enum(['user', 'admin']).optional(), 33 |   hasActivePackages: z.enum(['true', 'false']).optional(), 34 |   page: z.coerce.number().int().min(1).default(1), 35 |   limit: z.coerce.number().int().min(1).max(100).default(20), 36 |   enhanced: z.enum(['true', 'false']).optional() 37 | }); 38 |  39 | export async function GET(request: NextRequest) { 40 |   try { 41 |     const user = await requireAuth(request); 42 |     if (!user || user.role !== 'admin') { 43 |       return NextResponse.json({ 44 |         success: false, 45 |         error: 'Unauthorized', 46 |         message: 'Admin access required' 47 |       }, { status: 401 }); 48 |     } 49 |  50 |     const { searchParams } = new URL(request.url); 51 |     const queryParams = Object.fromEntries(searchParams.entries()); 52 |     const validation = querySchema.safeParse(queryParams); 53 |  54 |     if (!validation.success) { 55 |       return NextResponse.json({ 56 |         success: false, 57 |         error: 'Invalid query parameters', 58 |         details: validation.error.issues 59 |       }, { status: 400 }); 60 |     } 61 |  62 |     const { email, status, language, role, hasActivePackages, page, limit, enhanced } = validation.data; 63 |     const offset = (page - 1) * limit; 64 |  65 |     const where: Record<string, unknown> = {}; 66 |  67 |     if (email) where.email = email; 68 |     if (status) where.status = status; 69 |     if (language) where.language = language; 70 |     if (role) where.role = role; 71 |  72 |     const select: Record<string, unknown> = { 73 |       id: true, 74 |       email: true, 75 |       fullName: true, 76 |       phone: true, 77 |       role: true, 78 |       status: true, 79 |       birthDate: true, 80 |       birthTime: true, 81 |       birthPlace: true, 82 |       question: true, 83 |       language: true, 84 |       adminNotes: true, 85 |       scheduledDate: true, 86 |       scheduledTime: true, 87 |       sessionType: true, 88 |       lastReminderSent: true, 89 |       lastBooking: true, 90 |       notes: true, 91 |       createdAt: true, 92 |       updatedAt: true 93 |     }; 94 |  95 |     if (enhanced === 'true') { 96 |  97 |     } 98 |  99 |     await prisma.$connect();100 | 101 |     const testCount = await prisma.user.count();102 |     const [users, totalCount] = await Promise.all([103 |       prisma.user.findMany({104 |         where,105 |         select,106 |         skip: offset,107 |         take: limit,108 |         orderBy: { createdAt: 'desc' }109 |       }),110 |       prisma.user.count({ where })111 |     ]);112 | 113 |     let filteredUsers = users;114 |     if (hasActivePackages === 'true') {115 |       const usersWithActivePackages = await prisma.user.findMany({116 |         where: {117 |           ...where,118 |           purchases: {119 |             some: {120 |               userPackages: {121 |                 some: {122 |                   isActive: true123 |                 }124 |               }125 |             }126 |           }127 |         },128 |         select,129 |         skip: offset,130 |         take: limit,131 |         orderBy: { createdAt: 'desc' }132 |       });133 |       filteredUsers = usersWithActivePackages;134 |     } else if (hasActivePackages === 'false') {135 |       const usersWithoutActivePackages = await prisma.user.findMany({136 |         where: {137 |           ...where,138 |           purchases: {139 |             none: {140 |               userPackages: {141 |                 some: {142 |                   isActive: true143 |                 }144 |               }145 |             }146 |           }147 |         },148 |         select,149 |         skip: offset,150 |         take: limit,151 |         orderBy: { createdAt: 'desc' }152 |       });153 |       filteredUsers = usersWithoutActivePackages;154 |     }155 | 156 |     const totalPages = Math.ceil(totalCount / limit);157 | 158 |     return NextResponse.json({159 |       success: true,160 |       data: filteredUsers,161 |       pagination: {162 |         page,163 |         limit,164 |         total: totalCount,165 |         totalPages166 |       }167 |     });168 | 169 |   } catch (error) {170 |     .cause : undefined171 |     });172 |     return NextResponse.json({173 |       success: false,174 |       error: 'Internal server error',175 |       message: 'An unexpected error occurred',176 |       details: error instanceof Error ? error.message : 'Unknown error'177 |     }, { status: 500 });178 |   } finally {179 |     await prisma.$disconnect();180 |   }181 | }182 | 183 | export async function POST(request: NextRequest) {184 |   try {185 |     const user = await requireAuth(request);186 |     if (!user || user.role !== 'admin') {187 |       return NextResponse.json({188 |         success: false,189 |         error: 'Unauthorized',190 |         message: 'Admin access required'191 |       }, { status: 401 });192 |     }193 | 194 |     const body = await request.json();195 |     const validation = createUserSchema.safeParse(body);196 | 197 |     if (!validation.success) {198 |       return NextResponse.json({199 |         success: false,200 |         error: 'Validation failed',201 |         message: 'Invalid user data',202 |         details: validation.error.issues203 |       }, { status: 400 });204 |     }205 | 206 |     const userData = validation.data;207 | 208 |     const existingUser = await prisma.user.findUnique({209 |       where: { email: userData.email }210 |     });211 | 212 |     if (existingUser) {213 |       return NextResponse.json({214 |         success: false,215 |         error: 'User already exists',216 |         message: 'A user with this email already exists'217 |       }, { status: 409 });218 |     }219 | 220 |     const newUser = await prisma.user.create({221 |       data: {222 |         ...userData,223 |         birthDate: userData.birthDate ? new Date(userData.birthDate) : null,224 |         scheduledDate: userData.scheduledDate ? new Date(userData.scheduledDate) : null225 |       }226 |     });227 | 228 |     return NextResponse.json({229 |       success: true,230 |       message: 'User created successfully',231 |       data: newUser232 |     }, { status: 201 });233 | 234 |   } catch (error) {235 |     return NextResponse.json({236 |       success: false,237 |       error: 'Internal server error',238 |       message: 'Failed to create user',239 |       details: error instanceof Error ? error.message : 'Unknown error'240 |     }, { status: 500 });241 |   } finally {242 |     await prisma.$disconnect();243 |   }244 | }245 | 246 | export async function PUT(request: NextRequest) {247 |   try {248 |     const user = await requireAuth(request);249 |     if (!user || user.role !== 'admin') {250 |       return NextResponse.json({251 |         success: false,252 |         error: 'Unauthorized',253 |         message: 'Admin access required'254 |       }, { status: 401 });255 |     }256 | 257 |     const body = await request.json();258 |     const validation = updateUserSchema.safeParse(body);259 | 260 |     if (!validation.success) {261 |       return NextResponse.json({262 |         success: false,263 |         error: 'Validation failed',264 |         message: 'Invalid user data',265 |         details: validation.error.issues266 |       }, { status: 400 });267 |     }268 | 269 |     const { id, ...updateData } = validation.data;270 | 271 |     const existingUser = await prisma.user.findUnique({272 |       where: { id }273 |     });274 | 275 |     if (!existingUser) {276 |       return NextResponse.json({277 |         success: false,278 |         error: 'User not found',279 |         message: 'User with this ID does not exist'280 |       }, { status: 404 });281 |     }282 | 283 |     const updatedUser = await prisma.user.update({284 |       where: { id },285 |       data: {286 |         ...updateData,287 |         birthDate: updateData.birthDate ? new Date(updateData.birthDate) : undefined,288 |         scheduledDate: updateData.scheduledDate ? new Date(updateData.scheduledDate) : undefined289 |       }290 |     });291 | 292 |     return NextResponse.json({293 |       success: true,294 |       message: 'User updated successfully',295 |       data: updatedUser296 |     });297 | 298 |   } catch (error) {299 |     return NextResponse.json({300 |       success: false,301 |       error: 'Internal server error',302 |       message: 'Failed to update user',303 |       details: error instanceof Error ? error.message : 'Unknown error'304 |     }, { status: 500 });305 |   } finally {306 |     await prisma.$disconnect();307 |   }308 | }309 | 310 | export async function DELETE(request: NextRequest) {311 |   try {312 |     const user = await requireAuth(request);313 |     if (!user || user.role !== 'admin') {314 |       return NextResponse.json({315 |         success: false,316 |         error: 'Unauthorized',317 |         message: 'Admin access required'318 |       }, { status: 401 });319 |     }320 | 321 |     const { searchParams } = new URL(request.url);322 |     const userId = searchParams.get('id');323 | 324 |     if (!userId) {325 |       return NextResponse.json({326 |         success: false,327 |         error: 'Missing ID',328 |         message: 'User ID is required'329 |       }, { status: 400 });330 |     }331 | 332 |     const existingUser = await prisma.user.findUnique({333 |       where: { id: userId }334 |     });335 | 336 |     if (!existingUser) {337 |       return NextResponse.json({338 |         success: false,339 |         error: 'User not found',340 |         message: 'User with this ID does not exist'341 |       }, { status: 404 });342 |     }343 | 344 |     await prisma.user.delete({345 |       where: { id: userId }346 |     });347 | 348 |     return NextResponse.json({349 |       success: true,350 |       message: 'User deleted successfully'351 |     });352 | 353 |   } catch (error) {354 |     return NextResponse.json({355 |       success: false,356 |       error: 'Internal server error',357 |       message: 'Failed to delete user',358 |       details: error instanceof Error ? error.message : 'Unknown error'359 |     }, { status: 500 });360 |   } finally {361 |     await prisma.$disconnect();362 |   }363 | }
============================================================END: frontend/app/api/admin/users/route.ts============================================================


============================================================FILE: frontend/app/api/analytics/performance/route.tsSIZE: 5.50 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET(request: NextRequest) {  5 |   try {  6 |     const { searchParams } = new URL(request.url);  7 |     const modelVersion = searchParams.get('model_version');  8 |     const dateRange = searchParams.get('date_range') || '30';  9 |  10 |     const startDate = new Date(); 11 |     startDate.setDate(startDate.getDate() - parseInt(dateRange)); 12 |  13 |     const modelPerformance = await prisma.mlModelPerformance.findMany({ 14 |       where: modelVersion ? { modelVersion } : undefined, 15 |       orderBy: { createdAt: 'desc' } 16 |     }); 17 |  18 |     const conversationStats = await prisma.conversationLog.groupBy({ 19 |       by: ['rasaIntent', 'responseGenerator'], 20 |       where: { 21 |         timestamp: { gte: startDate }, 22 |         ...(modelVersion ? { modelVersion } : {}) 23 |       }, 24 |       _count: { id: true }, 25 |       _avg: { rasaConfidence: true } 26 |     }); 27 |  28 |     const bookingStats = await prisma.conversationLog.groupBy({ 29 |       by: ['bookingStep'], 30 |       where: { 31 |         timestamp: { gte: startDate }, 32 |         ...(modelVersion ? { modelVersion } : {}) 33 |       }, 34 |       _count: { id: true } 35 |     }); 36 |  37 |     const feedbackStats = await prisma.userFeedback.groupBy({ 38 |       by: ['rating'], 39 |       where: { 40 |         createdAt: { gte: startDate } 41 |       }, 42 |       _count: { id: true } 43 |     }); 44 |  45 |     const abTestResults = await prisma.abTestExperiment.findMany({ 46 |       where: { 47 |         status: { in: ['active', 'completed'] }, 48 |         startDate: { gte: startDate } 49 |       }, 50 |       include: { 51 |         assignments: true 52 |       } 53 |     }); 54 |  55 |     const totalConversations = conversationStats.reduce((sum, stat) => sum + stat._count.id, 0); 56 |     const avgConfidence = conversationStats.reduce((sum, stat) => 57 |       sum + (Number(stat._avg.rasaConfidence) || 0) * stat._count.id, 0) / totalConversations; 58 |  59 |     const positiveFeedback = feedbackStats.find(f => f.rating === 2)?._count.id || 0; 60 |     const negativeFeedback = feedbackStats.find(f => f.rating === 1)?._count.id || 0; 61 |     const totalFeedback = positiveFeedback + negativeFeedback; 62 |     const satisfactionRate = totalFeedback > 0 ? positiveFeedback / totalFeedback : 0; 63 |  64 |     const bookingCompletions = bookingStats.find(b => b.bookingStep === 'booking_complete')?._count.id || 0; 65 |     const bookingAttempts = bookingStats.find(b => b.bookingStep === 'selecting_package')?._count.id || 0; 66 |     const bookingSuccessRate = bookingAttempts > 0 ? bookingCompletions / bookingAttempts : 0; 67 |  68 |     const responseGeneratorStats = conversationStats.reduce((acc, stat) => { 69 |       const generator = stat.responseGenerator || 'unknown'; 70 |       acc[generator] = (acc[generator] || 0) + stat._count.id; 71 |       return acc; 72 |     }, {} as Record<string, number>); 73 |  74 |     const intentStats = conversationStats.reduce((acc, stat) => { 75 |       const intent = stat.rasaIntent || 'unknown'; 76 |       acc[intent] = (acc[intent] || 0) + stat._count.id; 77 |       return acc; 78 |     }, {} as Record<string, number>); 79 |  80 |     const analytics = { 81 |       summary: { 82 |         totalConversations, 83 |         avgConfidence: avgConfidence || 0, 84 |         satisfactionRate, 85 |         bookingSuccessRate, 86 |         dateRange: `${dateRange} days`, 87 |         modelVersion: modelVersion || 'all' 88 |       }, 89 |       modelPerformance: modelPerformance.map(model => ({ 90 |         modelVersion: model.modelVersion, 91 |         accuracy: (model.evaluationResults as Record<string, unknown>)?.accuracy as number || 0, 92 |         bookingSuccessRate: model.bookingSuccessRate || 0, 93 |         avgConversationTurns: model.avgConversationTurns || 0, 94 |         isActiveProduction: model.isActiveProduction, 95 |         isActiveAbTest: model.isActiveAbTest, 96 |         deploymentDate: model.deploymentDate, 97 |         createdAt: model.createdAt 98 |       })), 99 |       conversationMetrics: {100 |         responseGeneratorDistribution: responseGeneratorStats,101 |         intentDistribution: intentStats,102 |         bookingStepDistribution: bookingStats.reduce((acc, stat) => {103 |           acc[stat.bookingStep || 'unknown'] = stat._count.id;104 |           return acc;105 |         }, {} as Record<string, number>)106 |       },107 |       feedbackMetrics: {108 |         totalFeedback,109 |         positiveFeedback,110 |         negativeFeedback,111 |         satisfactionRate,112 |         feedbackByRating: feedbackStats.reduce((acc, stat) => {113 |           acc[stat.rating] = stat._count.id;114 |           return acc;115 |         }, {} as Record<number, number>)116 |       },117 |       abTestResults: abTestResults.map(experiment => ({118 |         id: experiment.id,119 |         experimentName: experiment.experimentName,120 |         modelAVersion: experiment.modelAVersion,121 |         modelBVersion: experiment.modelBVersion,122 |         trafficSplit: experiment.trafficSplit,123 |         status: experiment.status,124 |         startDate: experiment.startDate,125 |         endDate: experiment.endDate,126 |         totalAssignments: experiment.assignments.length,127 |         winningModelVersion: experiment.winningModelVersion,128 |         finalResults: experiment.finalResults129 |       }))130 |     };131 | 132 |     return NextResponse.json({133 |       success: true,134 |       data: analytics135 |     });136 | 137 |   } catch (error) {138 |     return NextResponse.json(139 |       {140 |         success: false,141 |         error: 'Failed to fetch analytics data',142 |         details: error instanceof Error ? error.message : 'Unknown error'143 |       },144 |       { status: 500 }145 |     );146 |   } finally {147 |     await prisma.$disconnect();148 |   }149 | }
============================================================END: frontend/app/api/analytics/performance/route.ts============================================================


============================================================FILE: frontend/app/api/auth/login/route.tsSIZE: 5.65 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import * as bcrypt from 'bcryptjs';  3 | import * as jwt from 'jsonwebtoken';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';  7 |   8 | export async function POST(request: NextRequest) {  9 |   try { 10 |  11 |     try { 12 |       await prisma.$connect(); 13 |       } catch (dbError) { 14 |       return NextResponse.json({ 15 |         success: false, 16 |         error: 'Database connection failed', 17 |         message: 'Unable to connect to database', 18 |         details: dbError instanceof Error ? dbError.message : 'Unknown database error' 19 |       }, { status: 500 }); 20 |     } 21 |  22 |     const { email, password } = await request.json(); 23 |     if (!email || !password) { 24 |       return NextResponse.json({ 25 |         success: false, 26 |         error: 'Missing credentials', 27 |         message: 'Email and password are required' 28 |       }, { status: 400 }); 29 |     } 30 |  31 |     ); 32 |     let user; 33 |     try { 34 |  35 |       await prisma.$connect(); 36 |  37 |       user = await prisma.user.findUnique({ 38 |         where: { email: email.toLowerCase() } 39 |       }); 40 |       if (user) { 41 |         } else { 42 |         ); 43 |       } 44 |     } catch (userQueryError) { 45 |       return NextResponse.json({ 46 |         success: false, 47 |         error: 'Database query failed', 48 |         message: 'Unable to query user data', 49 |         details: userQueryError instanceof Error ? userQueryError.message : 'Unknown query error' 50 |       }, { status: 500 }); 51 |     } 52 |  53 |     if (!user) { 54 |       return NextResponse.json({ 55 |         success: false, 56 |         error: 'Invalid credentials', 57 |         message: 'Invalid email or password' 58 |       }, { status: 401 }); 59 |     } 60 |  61 |     if (!user.password) { 62 |       return NextResponse.json({ 63 |         success: false, 64 |         error: 'Invalid credentials', 65 |         message: 'Invalid email or password' 66 |       }, { status: 401 }); 67 |     } 68 |  69 |     let isValidPassword; 70 |     try { 71 |       isValidPassword = await bcrypt.compare(password, user.password); 72 |       } catch (passwordError) { 73 |       return NextResponse.json({ 74 |         success: false, 75 |         error: 'Password verification failed', 76 |         message: 'Unable to verify password', 77 |         details: passwordError instanceof Error ? passwordError.message : 'Unknown password error' 78 |       }, { status: 500 }); 79 |     } 80 |  81 |     if (!isValidPassword) { 82 |       return NextResponse.json({ 83 |         success: false, 84 |         error: 'Invalid credentials', 85 |         message: 'Invalid email or password' 86 |       }, { status: 401 }); 87 |     } 88 |  89 |     let token; 90 |     try { 91 |       token = jwt.sign( 92 |         { 93 |           userId: user.id, 94 |           email: user.email, 95 |           role: user.role 96 |         }, 97 |         JWT_SECRET, 98 |         { expiresIn: '7d' } 99 |       );100 |       } catch (jwtError) {101 |       return NextResponse.json({102 |         success: false,103 |         error: 'Token generation failed',104 |         message: 'Unable to generate authentication token',105 |         details: jwtError instanceof Error ? jwtError.message : 'Unknown JWT error'106 |       }, { status: 500 });107 |     }108 | 109 |     return NextResponse.json({110 |       success: true,111 |       user: {112 |         id: user.id,113 |         email: user.email,114 |         fullName: user.fullName,115 |         role: user.role,116 |         access_token: token117 |       },118 |       message: 'Login successful'119 |     });120 | 121 |   } catch (error) {122 |     return NextResponse.json({123 |       success: false,124 |       error: 'Internal server error',125 |       message: 'An error occurred during login',126 |       details: error instanceof Error ? error.message : 'Unknown error'127 |     }, { status: 500 });128 |   }129 | }
============================================================END: frontend/app/api/auth/login/route.ts============================================================


============================================================FILE: frontend/app/api/auth/reset-password/route.tsSIZE: 1.10 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 |   4 | export async function POST() {  5 |   try {  6 |     const supabase = await createServerClient();  7 |   8 |     const { data: { user }, error: authError } = await supabase.auth.getUser();  9 |  10 |     if (authError || !user) { 11 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 12 |     } 13 |  14 |     const { error } = await supabase.auth.resetPasswordForEmail(user.email || '', { 15 |       redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}/account/profile?reset=true` 16 |     }); 17 |  18 |     if (error) { 19 |       return NextResponse.json({ error: 'Failed to send password reset email' }, { status: 500 }); 20 |     } 21 |  22 |     return NextResponse.json({ 23 |       success: true, 24 |       message: 'Password reset email sent successfully' 25 |     }); 26 |  27 |   } catch (error) { 28 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 29 |   } 30 | }
============================================================END: frontend/app/api/auth/reset-password/route.ts============================================================


============================================================FILE: frontend/app/api/auth/verify/route.tsSIZE: 1.59 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import * as jwt from 'jsonwebtoken';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';  6 |   7 | export async function POST(request: NextRequest) {  8 |   try {  9 |     const { token } = await request.json(); 10 |  11 |     if (!token) { 12 |       return NextResponse.json({ 13 |         success: false, 14 |         error: 'No token provided', 15 |         message: 'Authentication token is required' 16 |       }, { status: 401 }); 17 |     } 18 |  19 |     const decoded = jwt.verify(token, JWT_SECRET) as { userId: string; iat?: number; exp?: number }; 20 |  21 |     if (!decoded) { 22 |       return NextResponse.json({ 23 |         success: false, 24 |         error: 'Invalid token', 25 |         message: 'Authentication token is invalid' 26 |       }, { status: 401 }); 27 |     } 28 |  29 |     const user = await prisma.user.findUnique({ 30 |       where: { id: decoded.userId } 31 |     }); 32 |  33 |     if (!user) { 34 |       return NextResponse.json({ 35 |         success: false, 36 |         error: 'User not found', 37 |         message: 'User does not exist' 38 |       }, { status: 401 }); 39 |     } 40 |  41 |     return NextResponse.json({ 42 |       success: true, 43 |       user: { 44 |         id: user.id, 45 |         email: user.email, 46 |         fullName: user.fullName, 47 |         role: user.role 48 |       }, 49 |       message: 'Token verified successfully' 50 |     }); 51 |  52 |   } catch (error) { 53 |     return NextResponse.json({ 54 |       success: false, 55 |       error: 'Invalid token', 56 |       message: 'Authentication token is invalid or expired' 57 |     }, { status: 401 }); 58 |   } 59 | }
============================================================END: frontend/app/api/auth/verify/route.ts============================================================


============================================================FILE: frontend/app/api/booking/route.tsSIZE: 7.25 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { z } from 'zod';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!  8 | );  9 |  10 | const bookingCreateSchema = z.object({ 11 |   user_id: z.string().min(1, 'User ID is required'), 12 |   schedule_slot_id: z.number().int('Invalid schedule slot ID'), 13 |   user_package_id: z.number().int('Invalid user package ID'), 14 |   session_type: z.string().min(1, 'Session type is required'), 15 |   notes: z.string().optional(), 16 |   status: z.enum(['pending', 'confirmed', 'cancelled', 'completed']).default('confirmed') 17 | }); 18 |  19 | export async function POST(request: NextRequest) { 20 |   try { 21 |     const body = await request.json(); 22 |  23 |     const validation = bookingCreateSchema.safeParse(body); 24 |     if (!validation.success) { 25 |       return NextResponse.json({ 26 |         success: false, 27 |         error: 'Validation failed', 28 |         message: 'Booking data validation failed', 29 |         details: validation.error.issues, 30 |         toast: { 31 |           type: 'error', 32 |           title: 'Validation Error', 33 |           description: 'Booking data validation failed. Please check the form fields.' 34 |         } 35 |       }, { status: 400 }); 36 |     } 37 |  38 |     const bookingData = validation.data; 39 |  40 |     const { data: user, error: userError } = await supabase 41 |       .from('users') 42 |       .select('id, full_name') 43 |       .eq('id', bookingData.user_id) 44 |       .single(); 45 |  46 |     if (userError || !user) { 47 |       return NextResponse.json({ 48 |         success: false, 49 |         error: 'User not found', 50 |         message: 'The specified user does not exist', 51 |         toast: { 52 |           type: 'error', 53 |           title: 'User Not Found', 54 |           description: 'The specified user does not exist' 55 |         } 56 |       }, { status: 404 }); 57 |     } 58 |  59 |     const { data: scheduleSlot, error: scheduleError } = await supabase 60 |       .from('schedule_slots') 61 |       .select('id, start_time, end_time, capacity, booked_count, is_available') 62 |       .eq('id', bookingData.schedule_slot_id) 63 |       .single(); 64 |  65 |     if (scheduleError || !scheduleSlot) { 66 |       return NextResponse.json({ 67 |         success: false, 68 |         error: 'Schedule slot not found', 69 |         message: 'The specified schedule slot does not exist', 70 |         toast: { 71 |           type: 'error', 72 |           title: 'Schedule Slot Not Found', 73 |           description: 'The specified schedule slot does not exist' 74 |         } 75 |       }, { status: 404 }); 76 |     } 77 |  78 |     if (!scheduleSlot.is_available) { 79 |       return NextResponse.json({ 80 |         success: false, 81 |         error: 'Schedule slot unavailable', 82 |         message: 'The specified schedule slot is not available', 83 |         toast: { 84 |           type: 'error', 85 |           title: 'Schedule Slot Unavailable', 86 |           description: 'The specified schedule slot is not available' 87 |         } 88 |       }, { status: 400 }); 89 |     } 90 |  91 |     const { data: existingBookings, error: bookingsError } = await supabase 92 |       .from('bookings') 93 |       .select('id') 94 |       .eq('schedule_slot_id', bookingData.schedule_slot_id) 95 |       .eq('status', 'confirmed'); 96 |  97 |     if (bookingsError) { 98 |       return NextResponse.json({ 99 |         success: false,100 |         error: 'Database error',101 |         message: 'Failed to check schedule slot availability',102 |         details: bookingsError.message,103 |         toast: {104 |           type: 'error',105 |           title: 'Database Error',106 |           description: 'Failed to check schedule slot availability. Please try again.'107 |         }108 |       }, { status: 500 });109 |     }110 | 111 |     const currentBookings = existingBookings?.length || 0;112 |     if (currentBookings >= (scheduleSlot.capacity || 3)) {113 |       return NextResponse.json({114 |         success: false,115 |         error: 'Schedule slot full',116 |         message: 'The specified schedule slot is at full capacity',117 |         toast: {118 |           type: 'error',119 |           title: 'Schedule Slot Full',120 |           description: 'The specified schedule slot is at full capacity'121 |         }122 |       }, { status: 400 });123 |     }124 | 125 |     const { data: booking, error: createError } = await supabase126 |       .from('bookings')127 |       .insert({128 |         user_id: bookingData.user_id,129 |         schedule_slot_id: bookingData.schedule_slot_id,130 |         user_package_id: bookingData.user_package_id,131 |         session_type: bookingData.session_type,132 |         notes: bookingData.notes,133 |         status: bookingData.status,134 |         created_at: new Date().toISOString()135 |       })136 |       .select()137 |       .single();138 | 139 |     if (createError) {140 |       return NextResponse.json({141 |         success: false,142 |         error: 'Database error',143 |         message: 'Failed to create booking',144 |         details: createError.message,145 |         toast: {146 |           type: 'error',147 |           title: 'Booking Creation Failed',148 |           description: 'Failed to create booking. Please try again.'149 |         }150 |       }, { status: 500 });151 |     }152 | 153 |     return NextResponse.json({154 |       success: true,155 |       message: 'Booking created successfully',156 |       data: booking,157 |       toast: {158 |         type: 'success',159 |         title: 'Success!',160 |         description: `Booking created for ${user.full_name} on ${scheduleSlot.start_time}`161 |       }162 |     }, { status: 201 });163 | 164 |   } catch (error) {165 |     return NextResponse.json({166 |       success: false,167 |       error: 'Internal server error',168 |       message: 'An unexpected error occurred',169 |       toast: {170 |         type: 'error',171 |         title: 'Unexpected Error',172 |         description: 'An unexpected error occurred. Please try again.'173 |       }174 |     }, { status: 500 });175 |   }176 | }177 | 178 | export async function GET(request: NextRequest) {179 |   try {180 |     const { searchParams } = new URL(request.url);181 |     const userId = searchParams.get('user_id');182 |     const scheduleSlotId = searchParams.get('schedule_slot_id');183 | 184 |     let query = supabase185 |       .from('bookings')186 |       .select('*');187 | 188 |     if (userId) {189 |       query = query.eq('user_id', userId);190 |     }191 | 192 |     if (scheduleSlotId) {193 |       query = query.eq('schedule_slot_id', scheduleSlotId);194 |     }195 | 196 |     const { data: bookings, error } = await query197 |       .order('created_at', { ascending: false });198 | 199 |     if (error) {200 |       return NextResponse.json({201 |         success: false,202 |         error: 'Database error',203 |         message: 'Failed to fetch bookings',204 |         details: error.message,205 |         toast: {206 |           type: 'error',207 |           title: 'Database Error',208 |           description: 'Failed to fetch bookings. Please try again.'209 |         }210 |       }, { status: 500 });211 |     }212 | 213 |     return NextResponse.json({214 |       success: true,215 |       data: bookings216 |     });217 | 218 |   } catch (error) {219 |     return NextResponse.json({220 |       success: false,221 |       error: 'Internal server error',222 |       message: 'An unexpected error occurred',223 |       toast: {224 |         type: 'error',225 |         title: 'Unexpected Error',226 |         description: 'An unexpected error occurred. Please try again.'227 |       }228 |     }, { status: 500 });229 |   }230 | }
============================================================END: frontend/app/api/booking/route.ts============================================================


============================================================FILE: frontend/app/api/bug-reports/route.tsSIZE: 3.03 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import jwt from 'jsonwebtoken';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';  6 |   7 | export async function GET() {  8 |   return NextResponse.json({ message: 'Bug reports API is working' });  9 | } 10 |  11 | export async function POST(request: NextRequest) { 12 |   try { 13 |  14 |     const authHeader = request.headers.get('authorization'); 15 |     if (!authHeader || !authHeader.startsWith('Bearer ')) { 16 |       return NextResponse.json( 17 |         { error: 'Unauthorized - No token provided' }, 18 |         { status: 401 } 19 |       ); 20 |     } 21 |  22 |     const token = authHeader.substring(7); 23 |  24 |     let decoded: { userId: string }; 25 |     try { 26 |       decoded = jwt.verify(token, JWT_SECRET) as { userId: string }; 27 |       } catch { 28 |       return NextResponse.json( 29 |         { error: 'Unauthorized - Invalid token' }, 30 |         { status: 401 } 31 |       ); 32 |     } 33 |  34 |     const user = await prisma.user.findUnique({ 35 |       where: { id: decoded.userId } 36 |     }); 37 |  38 |     if (!user) { 39 |       return NextResponse.json( 40 |         { error: 'Unauthorized - User not found' }, 41 |         { status: 401 } 42 |       ); 43 |     } 44 |  45 |     const body = await request.json(); 46 |     const { title, description, screenshot, annotations, category, priority } = body; 47 |  48 |     if (!title || !description) { 49 |       return NextResponse.json( 50 |         { error: 'Title and description are required' }, 51 |         { status: 400 } 52 |       ); 53 |     } 54 |  55 |     const bugReport = await prisma.bugReport.create({ 56 |       data: { 57 |         title, 58 |         description, 59 |         screenshot, 60 |         annotations: annotations || [], 61 |         category: category || null, 62 |         priority: priority || 'MEDIUM', 63 |         status: 'OPEN', 64 |         reporterId: user.id 65 |       } 66 |     }); 67 |  68 |     return NextResponse.json({ 69 |       success: true, 70 |       bugReport, 71 |       message: 'Bug report submitted successfully' 72 |     }); 73 |  74 |   } catch (error) { 75 |     return NextResponse.json( 76 |       { error: 'Internal server error: ' + (error instanceof Error ? error.message : 'Unknown error') }, 77 |       { status: 500 } 78 |     ); 79 |   } finally { 80 |     await prisma.$disconnect(); 81 |   } 82 | }
============================================================END: frontend/app/api/bug-reports/route.ts============================================================


============================================================FILE: frontend/app/api/calendly-booking/route.tsSIZE: 7.46 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import { z } from 'zod';  4 |   5 | const calendlyBookingSchema = z.object({  6 |   packageId: z.number().int('Invalid package ID'),  7 |   clientName: z.string().min(1, 'Client name is required'),  8 |   clientEmail: z.string().email('Invalid email address'),  9 |   clientPhone: z.string().min(1, 'Phone number is required'), 10 |   selectedDate: z.string().min(1, 'Date is required'), 11 |   selectedTime: z.string().min(1, 'Time is required'), 12 |   birthDate: z.string().min(1, 'Birth date is required'), 13 |   birthCity: z.string().min(1, 'Birth city is required'), 14 |   message: z.string().optional(), 15 |   paymentMethodId: z.number().int('Payment method is required'), 16 |   language: z.string().default('en') 17 | }); 18 |  19 | export async function POST(request: NextRequest) { 20 |   try { 21 |     const body = await request.json(); 22 |  23 |     const validation = calendlyBookingSchema.safeParse(body); 24 |     if (!validation.success) { 25 |       return NextResponse.json({ 26 |         success: false, 27 |         error: 'Validation failed', 28 |         message: 'Booking data validation failed', 29 |         details: validation.error.issues 30 |       }, { status: 400 }); 31 |     } 32 |  33 |     const bookingData = validation.data; 34 |  35 |     let user = await prisma.user.findUnique({ 36 |       where: { email: bookingData.clientEmail } 37 |     }); 38 |  39 |     if (!user) { 40 |  41 |       user = await prisma.user.create({ 42 |         data: { 43 |           email: bookingData.clientEmail, 44 |           fullName: bookingData.clientName, 45 |           phone: bookingData.clientPhone, 46 |           birthDate: new Date(bookingData.birthDate), 47 |           birthPlace: bookingData.birthCity, 48 |           language: bookingData.language, 49 |           role: 'user', 50 |           status: 'active' 51 |         } 52 |       }); 53 |       } else { 54 |  55 |       user = await prisma.user.update({ 56 |         where: { id: user.id }, 57 |         data: { 58 |           fullName: bookingData.clientName, 59 |           phone: bookingData.clientPhone, 60 |           birthDate: new Date(bookingData.birthDate), 61 |           birthPlace: bookingData.birthCity, 62 |           language: bookingData.language 63 |         } 64 |       }); 65 |       } 66 |  67 |     const packageDefinition = await prisma.packageDefinition.findUnique({ 68 |       where: { id: bookingData.packageId }, 69 |       include: { 70 |         packagePrices: { 71 |           where: { isActive: true }, 72 |           include: { 73 |             currency: true 74 |           } 75 |         }, 76 |         sessionDuration: true 77 |       } 78 |     }); 79 |  80 |     if (!packageDefinition) { 81 |       return NextResponse.json({ 82 |         success: false, 83 |         error: 'Package not found', 84 |         message: 'The selected package was not found' 85 |       }, { status: 400 }); 86 |     } 87 |  88 |     const scheduleSlot = await prisma.scheduleSlot.findFirst({ 89 |       where: { 90 |         startTime: { 91 |           gte: new Date(`${bookingData.selectedDate}T${bookingData.selectedTime}:00.000Z`), 92 |           lt: new Date(`${bookingData.selectedDate}T${bookingData.selectedTime}:59.999Z`) 93 |         }, 94 |         isAvailable: true 95 |       }, 96 |       include: { 97 |         scheduleTemplate: { 98 |           include: { 99 |             sessionDuration: true100 |           }101 |         }102 |       }103 |     });104 | 105 |     if (!scheduleSlot) {106 |       return NextResponse.json({107 |         success: false,108 |         error: 'Schedule slot not found',109 |         message: 'The selected time slot is no longer available'110 |       }, { status: 400 });111 |     }112 | 113 |     if (scheduleSlot.capacity && (scheduleSlot.bookedCount || 0) >= scheduleSlot.capacity) {114 |       return NextResponse.json({115 |         success: false,116 |         error: 'Slot full',117 |         message: 'This time slot is at full capacity'118 |       }, { status: 400 });119 |     }120 | 121 |     const paymentMethod = await prisma.paymentMethodConfig.findUnique({122 |       where: { id: bookingData.paymentMethodId }123 |     });124 | 125 |     if (!paymentMethod) {126 |       return NextResponse.json({127 |         success: false,128 |         error: 'Payment method not found',129 |         message: 'The selected payment method was not found'130 |       }, { status: 400 });131 |     }132 | 133 |     const packagePrice = packageDefinition.packagePrices[0];134 |     if (!packagePrice) {135 |       return NextResponse.json({136 |         success: false,137 |         error: 'Package price not found',138 |         message: 'No active price found for this package'139 |       }, { status: 400 });140 |     }141 | 142 |     const purchase = await prisma.purchase.create({143 |       data: {144 |         userId: user.id,145 |         totalAmount: packagePrice.price,146 |         currencyCode: packagePrice.currency.code,147 |         paymentMethod: paymentMethod.type || 'custom',148 |         paymentStatus: 'confirmed'149 |       }150 |     });151 | 152 |     const userPackage = await prisma.userPackage.create({153 |       data: {154 |         userId: user.id,155 |         purchaseId: purchase.id,156 |         packagePriceId: packagePrice.id,157 |         quantity: 1,158 |         isActive: true,159 |         sessionsUsed: 0160 |       }161 |     });162 | 163 |     const booking = await prisma.booking.create({164 |       data: {165 |         userId: user.id,166 |         userPackageId: userPackage.id,167 |         scheduleSlotId: scheduleSlot.id,168 |         sessionType: packageDefinition.name,169 |         notes: bookingData.message,170 |         status: 'confirmed'171 |       },172 |       include: {173 |         user: {174 |           select: {175 |             id: true,176 |             email: true,177 |             fullName: true,178 |             phone: true179 |           }180 |         },181 |         userPackage: {182 |           include: {183 |             packagePrice: {184 |               include: {185 |                 packageDefinition: {186 |                   include: {187 |                     sessionDuration: true188 |                   }189 |                 },190 |                 currency: true191 |               }192 |             }193 |           }194 |         },195 |         scheduleSlot: {196 |           include: {197 |             scheduleTemplate: {198 |               include: {199 |                 sessionDuration: true200 |               }201 |             }202 |           }203 |         }204 |       }205 |     });206 | 207 |     await prisma.scheduleSlot.update({208 |       where: { id: scheduleSlot.id },209 |       data: { bookedCount: { increment: 1 } }210 |     });211 | 212 |     return NextResponse.json({213 |       success: true,214 |       message: 'Booking created successfully',215 |       data: {216 |         bookingId: booking.id,217 |         user: booking.user,218 |         package: booking.userPackage.packagePrice.packageDefinition,219 |         schedule: {220 |           date: booking.scheduleSlot.startTime.toISOString().split('T')[0],221 |           time: booking.scheduleSlot.startTime.toTimeString().split(' ')[0].substring(0, 5),222 |           duration: booking.scheduleSlot.scheduleTemplate.sessionDuration?.duration_minutes || 60223 |         },224 |         totalPrice: booking.userPackage.packagePrice.price,225 |         currency: booking.userPackage.packagePrice.currency.symbol226 |       }227 |     }, { status: 201 });228 | 229 |   } catch (error) {230 |     return NextResponse.json({231 |       success: false,232 |       error: 'Booking creation failed',233 |       message: 'An error occurred while creating the booking'234 |     }, { status: 500 });235 |   }236 | }
============================================================END: frontend/app/api/calendly-booking/route.ts============================================================


============================================================FILE: frontend/app/api/chat/hybrid/route.tsSIZE: 22.41 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import OpenRouterService from '@/lib/services/openrouter-service';  3 | import { LoggingService } from '@/lib/services/logging-service';  4 |   5 | export async function POST(request: NextRequest) {  6 |   try {  7 |     const { message, userId, conversationHistory = [] } = await request.json();  8 |   9 |     if (!message) { 10 |       return NextResponse.json( 11 |         { error: 'Message is required' }, 12 |         { status: 400 } 13 |       ); 14 |     } 15 |  16 |     const loggingService = new LoggingService({ 17 |       enabled: true, 18 |       storage: 'database', 19 |       level: 'info' 20 |     }); 21 |  22 |     let response = ''; 23 |     const lowerMessage = message.toLowerCase(); 24 |  25 |     try { 26 |       const rasaResponse = await fetch('http: 27 |         method: 'POST', 28 |         headers: { 29 |           'Content-Type': 'application/json', 30 |         }, 31 |         body: JSON.stringify({ 32 |           text: message, 33 |           message_id: `hybrid_${Date.now()}` 34 |         }), 35 |       }); 36 |  37 |       if (rasaResponse.ok) { 38 |         const rasaData = await rasaResponse.json(); 39 |  40 |         if (rasaData.intent && rasaData.intent.confidence > 0.7) { 41 |           const intent = rasaData.intent.name; 42 |  43 |           switch (intent) { 44 |             case 'greet': 45 |               response = '¡Hola! 🌟 Soy Jose Garfias, tu astrólogo. ¿En qué puedo ayudarte hoy?'; 46 |               break; 47 |             case 'provide_name': 48 |               response = '¡Mucho gusto! 🌟 Es un placer conocerte. ¿En qué puedo ayudarte hoy?'; 49 |               break; 50 |             case 'astrology_sign': 51 |               response = '¡Excelente! 🌟 Para darte una lectura precisa de tu signo, necesito tu fecha de nacimiento completa (día, mes y año). ¿Podrías compartirla conmigo?'; 52 |               break; 53 |             case 'birth_date': 54 |               response = '¡Perfecto! 🌟 Con tu fecha de nacimiento puedo crear tu carta natal completa. ¿Te gustaría que te haga una lectura personalizada?'; 55 |               break; 56 |             case 'goodbye': 57 |               response = '¡Hasta luego! 🌟 Que tengas un día maravilloso. ¡Cuídate mucho! 💫'; 58 |               break; 59 |             case 'ask_packages': 60 |             case 'show_packages': 61 |             case 'ask_package_info': 62 |  63 |               response = await fetchPackagesFromAPI(); 64 |               break; 65 |             case 'package_details': 66 |  67 |               const entities = rasaData.entities || []; 68 |               const packageName = entities.find((e: Record<string, unknown>) => e.entity === 'package_name')?.value as string; 69 |               const packageId = entities.find((e: Record<string, unknown>) => e.entity === 'package_id')?.value as string; 70 |               response = await fetchPackageDetailsFromAPI(packageName, packageId); 71 |               break; 72 |             default: 73 |  74 |               break; 75 |           } 76 |         } 77 |       } 78 |     } catch { 79 |       } 80 |  81 |     if (!response) { 82 |       response = await getSimpleResponse(lowerMessage, conversationHistory) || ''; 83 |     } 84 |  85 |     if (!response || isComplexQuery(lowerMessage)) { 86 |       try { 87 |         const openRouter = new OpenRouterService(); 88 |         response = await openRouter.handleChitchat({ 89 |           userMessage: message, 90 |           conversationHistory: conversationHistory, 91 |           brandContext: { 92 |             astrologerName: 'Jose Garfias', 93 |             services: [ 94 |               'Lecturas de Carta Natal', 95 |               'Análisis de Tránsitos', 96 |               'Compatibilidad de Relaciones', 97 |               'Orientación Profesional', 98 |               'Desarrollo Espiritual', 99 |               'Numerología',100 |               'Lecturas de Tarot'101 |             ],102 |             specialties: [103 |               'Astrología Occidental',104 |               'Astrología Evolutiva',105 |               'Psicología Astrológica',106 |               'Medicina Holística',107 |               'Coaching Espiritual'108 |             ]109 |           }110 |         });111 |       } catch (error) {112 |         response = '¡Qué interesante! 🌟 Háblame más sobre eso. ¿Hay algo específico en lo que pueda ayudarte?';113 |       }114 |     }115 | 116 |     try {117 |       await loggingService.logConversation({118 |         sessionId: `hybrid_${Date.now()}`,119 |         userId: userId || 'anonymous',120 |         message: message,121 |         userMessage: message,122 |         botResponse: response,123 |         rasaIntent: 'hybrid_chat',124 |         rasaConfidence: 0.8,125 |         rasaEntities: [],126 |         responseGenerator: 'hybrid_chat',127 |         bookingStep: null,128 |         bookingDataSnapshot: null,129 |         modelVersion: '1.0.0',130 |         intent: 'hybrid_chat',131 |         entities: [],132 |         action: 'hybrid_chat',133 |         rasaResponse: response,134 |         llmResponse: response,135 |         apiCalls: [],136 |         processingTime: 0,137 |         success: true,138 |         error: undefined139 |       });140 |     } catch (logError) {141 |       }142 | 143 |     return NextResponse.json({144 |       success: true,145 |       response: response,146 |       language: lowerMessage.includes('hola') || lowerMessage.includes('precio') || lowerMessage.includes('contacto') ? 'es' : 'en'147 |     });148 | 149 |   } catch (error) {150 |     return NextResponse.json(151 |       {152 |         success: false,153 |         error: 'Lo siento, hubo un error procesando tu mensaje. Por favor intenta nuevamente. / Sorry, there was an error processing your message. Please try again.',154 |         details: error instanceof Error ? error.message : 'Unknown error'155 |       },156 |       { status: 500 }157 |     );158 |   }159 | }160 | 161 | async function fetchPackagesFromAPI(): Promise<string> {162 |   try {163 |     const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || `http:164 |     const response = await fetch(`${baseUrl}/api/packages?active=true`, {165 |       method: 'GET',166 |       headers: {167 |         'Content-Type': 'application/json',168 |       },169 |     });170 | 171 |     if (response.ok) {172 |       const data = await response.json();173 |       const packages = data.packages || [];174 | 175 |       if (packages.length === 0) {176 |         return 'No hay paquetes disponibles en este momento. Por favor contacta con nosotros directamente.';177 |       }178 | 179 |       let message = '🌟 **Paquetes de Astrología Disponibles:**\n\n';180 | 181 |       packages.forEach((pkg: Record<string, unknown>, index: number) => {182 |         const name = pkg.name || 'Paquete Desconocido';183 |         const description = pkg.description || 'Sin descripción disponible';184 |         const price = pkg.price || 0;185 |         const currency = pkg.currency || '$';186 |         const sessions = pkg.sessionsCount || 1;187 |         const duration = pkg.duration || 60;188 |         const isPopular = pkg.isPopular || false;189 | 190 |         const priceText = (typeof price === 'number' && !isNaN(price) && price > 0) ? `${currency}${price.toFixed(0)}` : 'Contactar para precio';191 |         const popularBadge = isPopular ? ' ⭐ POPULAR' : '';192 | 193 |         message += `**${index + 1}. ${name}**${popularBadge}\n`;194 |         message += `   💰 Precio: ${priceText}\n`;195 |         message += `   📅 Sesiones: ${sessions}\n`;196 |         message += `   ⏱️ Duración: ${duration} minutos cada una\n`;197 |         message += `   📝 ${description}\n\n`;198 |       });199 | 200 |       message += '💫 **¿Listo para reservar?** Solo dime qué paquete te interesa y te ayudo a comenzar.';201 | 202 |       return message;203 |     } else {204 |       return 'Estoy teniendo problemas para acceder a la información de paquetes. Por favor intenta más tarde o contacta con nosotros directamente.';205 |     }206 |   } catch (error) {207 |     return 'Estoy experimentando dificultades técnicas. Por favor intenta de nuevo o contacta con nosotros directamente.';208 |   }209 | }210 | 211 | async function fetchPackageDetailsFromAPI(packageName?: string, packageId?: string): Promise<string> {212 |   try {213 |     const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || `http:214 |     const response = await fetch(`${baseUrl}/api/packages?active=true`, {215 |       method: 'GET',216 |       headers: {217 |         'Content-Type': 'application/json',218 |       },219 |     });220 | 221 |     if (response.ok) {222 |       const data = await response.json();223 |       const packages = data.packages || [];224 | 225 |       let targetPackage = null;226 |       if (packageId) {227 |         targetPackage = packages.find((pkg: Record<string, unknown>) => String(pkg.id) === String(packageId));228 |       } else if (packageName) {229 |         targetPackage = packages.find((pkg: Record<string, unknown>) =>230 |           pkg.name && (pkg.name as string).toLowerCase().includes(packageName.toLowerCase())231 |         );232 |       }233 | 234 |       if (targetPackage) {235 |         const name = targetPackage.name || 'Paquete Desconocido';236 |         const description = targetPackage.description || 'Sin descripción disponible';237 |         const price = targetPackage.price || 0;238 |         const currency = targetPackage.currency || '$';239 |         const sessions = targetPackage.sessionsCount || 1;240 |         const duration = targetPackage.duration || 60;241 |         const packageType = targetPackage.packageType || 'Estándar';242 |         const maxGroup = targetPackage.maxGroupSize || 1;243 |         const isPopular = targetPackage.isPopular || false;244 | 245 |         const priceText = (typeof price === 'number' && !isNaN(price) && price > 0) ? `${currency}${price.toFixed(0)}` : 'Contactar para precio';246 |         const popularBadge = isPopular ? ' ⭐ POPULAR' : '';247 | 248 |         let message = `🌟 **${name}**${popularBadge}\n\n`;249 |         message += `📝 **Descripción:**\n${description}\n\n`;250 |         message += `💰 **Precio:** ${priceText}\n`;251 |         message += `📅 **Sesiones:** ${sessions}\n`;252 |         message += `⏱️ **Duración:** ${duration} minutos por sesión\n`;253 |         message += `👥 **Tipo:** ${packageType}\n`;254 |         message += `👥 **Tamaño Máximo de Grupo:** ${maxGroup}\n\n`;255 | 256 |         if (isPopular) {257 |           message += '⭐ ¡Este es uno de nuestros paquetes más populares!\n\n';258 |         }259 | 260 |         message += '💫 **¿Listo para reservar este paquete?** Solo dime y te ayudo a comenzar.';261 | 262 |         return message;263 |       } else {264 |         return `No pude encontrar un paquete que coincida con '${packageName || packageId}'. Déjame mostrarte todos los paquetes disponibles en su lugar.`;265 |       }266 |     } else {267 |       return 'Estoy teniendo problemas para acceder a los detalles del paquete. Por favor intenta más tarde.';268 |     }269 |   } catch (error) {270 |     return 'Estoy experimentando dificultades técnicas. Por favor intenta de nuevo o contacta con nosotros directamente.';271 |   }272 | }273 | 274 | function isComplexQuery(message: string): boolean {275 |   const lowerMessage = message.toLowerCase();276 | 277 |   const complexPatterns = [278 |     'confused', 'confundido', 'guidance', 'orientación', 'help me', 'ayúdame',279 |     'career', 'carrera', 'work', 'trabajo', 'job', 'empleo', 'future', 'futuro',280 |     'relationship', 'relación', 'love', 'amor', 'family', 'familia', 'problem',281 |     'problema', 'issue', 'asunto', 'difficult', 'difícil', 'struggling', 'luchando',282 |     'advice', 'consejo', 'suggestion', 'sugerencia', 'recommendation', 'recomendación',283 |     'what should', 'qué debería', 'how can', 'cómo puedo', 'why', 'por qué',284 |     'feeling', 'sintiendo', 'emotion', 'emoción', 'mood', 'estado de ánimo'285 |   ];286 | 287 |   return complexPatterns.some(pattern => lowerMessage.includes(pattern));288 | }289 | 290 | async function getSimpleResponse(lowerMessage: string, conversationHistory: Record<string, unknown>[] = []): Promise<string | null> {291 | 292 |   if (lowerMessage.includes('hola') || lowerMessage.includes('hello') || lowerMessage.includes('hi') ||293 |       lowerMessage.includes('buenos dias') || lowerMessage.includes('buenas tardes') || lowerMessage.includes('buenas noches')) {294 |     return '¡Hola! 🌟 Soy Jose Garfias, tu astrólogo. ¿En qué puedo ayudarte hoy?';295 |   }296 | 297 |   if (lowerMessage.includes('gracias') || lowerMessage.includes('thank') || lowerMessage.includes('thanks')) {298 |     return '¡De nada! 🌟 ¿Hay algo más en lo que pueda ayudarte?';299 |   }300 | 301 |   if (lowerMessage.includes('como estas') || lowerMessage.includes('how are you') || lowerMessage.includes('que tal')) {302 |     return '¡Estoy muy bien, gracias! 💫 ¿Y tú? ¿Cómo has estado?';303 |   }304 | 305 |   if (lowerMessage.includes('soy ') &&306 |       (lowerMessage.includes('aries') || lowerMessage.includes('tauro') || lowerMessage.includes('geminis') ||307 |        lowerMessage.includes('cancer') || lowerMessage.includes('leo') || lowerMessage.includes('virgo') ||308 |        lowerMessage.includes('libra') || lowerMessage.includes('escorpio') || lowerMessage.includes('sagitario') ||309 |        lowerMessage.includes('capricornio') || lowerMessage.includes('acuario') || lowerMessage.includes('piscis'))) {310 |     return '¡Excelente! 🌟 Para darte una lectura precisa de tu signo, necesito tu fecha de nacimiento completa (día, mes y año). ¿Podrías compartirla conmigo?';311 |   }312 | 313 |   if (lowerMessage.includes('mi signo') || lowerMessage.includes('mi signo es') ||314 |       lowerMessage.includes('cual es mi signo') || lowerMessage.includes('what is my sign') ||315 |       lowerMessage.includes('my sign is')) {316 |     return '¡Excelente! 🌟 Para darte una lectura precisa de tu signo, necesito tu fecha de nacimiento completa (día, mes y año). ¿Podrías compartirla conmigo?';317 |   }318 | 319 |   if (lowerMessage.includes('me llamo') || lowerMessage.includes('mi nombre es') ||320 |       lowerMessage.includes('soy ') || lowerMessage.includes('i am ') ||321 |       lowerMessage.includes('my name is') || lowerMessage.includes('i\'m ')) {322 |     return '¡Mucho gusto! 🌟 Es un placer conocerte. ¿En qué puedo ayudarte hoy?';323 |   }324 | 325 |   if (lowerMessage.includes('fecha de nacimiento') || lowerMessage.includes('naci el') ||326 |       lowerMessage.includes('naci en') || lowerMessage.includes('born on') ||327 |       lowerMessage.includes('birth date') || /\d{1,2}\/\d{1,2}\/\d{4}/.test(lowerMessage) ||328 |       /\d{1,2}-\d{1,2}-\d{4}/.test(lowerMessage)) {329 |     return '¡Perfecto! 🌟 Con tu fecha de nacimiento puedo crear tu carta natal completa. ¿Te gustaría que te haga una lectura personalizada?';330 |   }331 | 332 |   if (lowerMessage.includes('analisis') || lowerMessage.includes('carta natal completa') ||333 |       lowerMessage.includes('análisis de carta natal')) {334 |     return '¡Perfecto! 📊 Para hacer un análisis completo de tu Carta Natal necesito:\n\n• Tu fecha de nacimiento exacta\n• Hora de nacimiento (si la tienes)\n• Lugar de nacimiento\n\nCon esta información puedo crear un reporte detallado sobre tu personalidad, fortalezas, desafíos y potencial. ¿Tienes estos datos?';335 |   }336 | 337 |   if (lowerMessage.includes('compatibilidad') || lowerMessage.includes('relaciones') ||338 |       lowerMessage.includes('pareja')) {339 |     return '¡Excelente! 💫 Para analizar compatibilidad necesito:\n\n• Tu información de nacimiento\n• La información de la otra persona (fecha, hora, lugar)\n\nPuedo analizar compatibilidad romántica, amistosa o profesional. ¿Con quién te gustaría analizar la compatibilidad?';340 |   }341 | 342 |   if (lowerMessage.includes('predicciones') || lowerMessage.includes('tránsitos') ||343 |       lowerMessage.includes('futuro')) {344 |     return '¡Fascinante! 🔮 Para hacer predicciones precisas necesito:\n\n• Tu carta natal completa\n• El período que te interesa analizar\n\nPuedo analizar tránsitos planetarios, oportunidades y desafíos. ¿Qué período te interesa más?';345 |   }346 | 347 |   if (lowerMessage.includes('astrologia') || lowerMessage.includes('astrology') ||348 |       lowerMessage.includes('carta natal') || lowerMessage.includes('natal chart') ||349 |       lowerMessage.includes('horoscopo') || lowerMessage.includes('horoscope') ||350 |       lowerMessage.includes('lectura') || lowerMessage.includes('reading')) {351 |     return '¡Me encanta hablar de astrología! 🌟 ¿Hay algo específico que te gustaría saber sobre tu carta natal o signo?';352 |   }353 | 354 |   if (lowerMessage.includes('si') || lowerMessage.includes('yes') || lowerMessage.includes('claro') || lowerMessage.includes('por supuesto')) {355 | 356 |     const lastMessages = conversationHistory.slice(-3).map(msg => (msg.content as string).toLowerCase()).join(' ');357 |     if (lastMessages.includes('carta natal') || lastMessages.includes('lectura') || lastMessages.includes('signo') ||358 |         lastMessages.includes('astrología') || lastMessages.includes('leo') || lastMessages.includes('aries') ||359 |         lastMessages.includes('tauro') || lastMessages.includes('géminis') || lastMessages.includes('cáncer') ||360 |         lastMessages.includes('virgo') || lastMessages.includes('libra') || lastMessages.includes('escorpio') ||361 |         lastMessages.includes('sagitario') || lastMessages.includes('capricornio') || lastMessages.includes('acuario') ||362 |         lastMessages.includes('piscis')) {363 |       return '¡Excelente! 🌟 Puedo ayudarte con:\n\n• 📊 **Análisis de tu Carta Natal completa**\n• 💫 **Compatibilidad con otros signos**\n• 🔮 **Predicciones y tránsitos**\n• 💝 **Orientación en relaciones**\n• 🎯 **Guía profesional y personal**\n\n¿Qué te interesa más?';364 |     }365 |     return '¡Perfecto! ✨ ¿Qué te gustaría explorar?';366 |   }367 | 368 |   if (lowerMessage.includes('no') || lowerMessage.includes('nah') || lowerMessage.includes('quizas') || lowerMessage.includes('maybe')) {369 |     return '¡Sin problema! 🤝 ¿Hay algo más en lo que pueda ayudarte?';370 |   }371 | 372 |   if (lowerMessage.includes('paquetes') || lowerMessage.includes('packages') ||373 |       lowerMessage.includes('mostrar paquetes') || lowerMessage.includes('show packages') ||374 |       lowerMessage.includes('ver paquetes') || lowerMessage.includes('see packages') ||375 |       lowerMessage.includes('que paquetes') || lowerMessage.includes('what packages') ||376 |       lowerMessage.includes('paquetes disponibles') || lowerMessage.includes('available packages')) {377 | 378 |     return await fetchPackagesFromAPI();379 |   }380 | 381 |   if (lowerMessage.includes('precio') || lowerMessage.includes('price') ||382 |       lowerMessage.includes('cost') || lowerMessage.includes('costo') ||383 |       lowerMessage.includes('cuanto cuesta') || lowerMessage.includes('how much') ||384 |       lowerMessage.includes('tarifa') || lowerMessage.includes('rate') ||385 |       lowerMessage.includes('valor') || lowerMessage.includes('value') ||386 |       lowerMessage.includes('coste') || lowerMessage.includes('costes') ||387 |       lowerMessage.includes('cuanto vale') || lowerMessage.includes('worth') ||388 |       lowerMessage.includes('tarifario') || lowerMessage.includes('pricing') ||389 |       lowerMessage.includes('lista de precios') || lowerMessage.includes('price list') ||390 |       lowerMessage.includes('tabla de precios') || lowerMessage.includes('price table') ||391 |       lowerMessage.includes('catálogo de precios') || lowerMessage.includes('price catalog') ||392 |       lowerMessage.includes('información de precios') || lowerMessage.includes('pricing information') ||393 |       lowerMessage.includes('detalles de precios') || lowerMessage.includes('pricing details') ||394 |       lowerMessage.includes('opciones de precios') || lowerMessage.includes('price options') ||395 |       lowerMessage.includes('rangos de precios') || lowerMessage.includes('price range') ||396 |       lowerMessage.includes('estructura de precios') || lowerMessage.includes('pricing structure') ||397 |       lowerMessage.includes('política de precios') || lowerMessage.includes('pricing policy') ||398 |       lowerMessage.includes('cost structure') || lowerMessage.includes('fee structure') ||399 |       lowerMessage.includes('rate structure') || lowerMessage.includes('cost breakdown') ||400 |       lowerMessage.includes('price breakdown') || lowerMessage.includes('pricing guide') ||401 |       lowerMessage.includes('price guide') || lowerMessage.includes('cost guide') ||402 |       lowerMessage.includes('rate guide') || lowerMessage.includes('fee guide') ||403 |       lowerMessage.includes('pricing sheet') || lowerMessage.includes('price sheet') ||404 |       lowerMessage.includes('cost sheet') || lowerMessage.includes('rate sheet') ||405 |       lowerMessage.includes('fee sheet')) {406 |     return await fetchPackagesFromAPI();407 |   }408 | 409 |   if (lowerMessage.includes('contacto') || lowerMessage.includes('contact') ||410 |       lowerMessage.includes('telefono') || lowerMessage.includes('phone') ||411 |       lowerMessage.includes('email')) {412 |     return '📧 **Email**: info@josegarfias.com\n📱 **WhatsApp**: +52 55 1234 5678\n📍 **Ubicación**: Ciudad de México\n\n🕒 **Horarios**: Lunes-Viernes 9AM-7PM, Sábados 10AM-4PM\n\n¿Prefieres WhatsApp o email?';413 |   }414 | 415 |   if (lowerMessage.includes('horario') || lowerMessage.includes('horarios') ||416 |       lowerMessage.includes('disponible') || lowerMessage.includes('availability') ||417 |       lowerMessage.includes('schedule')) {418 |     return '📅 **Disponibilidad:**\n• Lunes-Viernes: 9AM-7PM\n• Sábados: 10AM-4PM\n• Domingos: Con cita previa\n\n💫 **Horarios populares:**\n• Mañanas: 10AM-12PM\n• Tardes: 2PM-5PM\n• Noches: 6PM-8PM\n\n¿Qué horario prefieres?';419 |   }420 | 421 |   if (lowerMessage.includes('bye') || lowerMessage.includes('goodbye') ||422 |       lowerMessage.includes('adios') || lowerMessage.includes('hasta luego')) {423 |     return '¡Hasta luego! 🌟 Que tengas un día maravilloso. ¡Cuídate mucho! 💫';424 |   }425 | 426 |   return null;427 | }
============================================================END: frontend/app/api/chat/hybrid/route.ts============================================================


============================================================FILE: frontend/app/api/chat/schedule-slots/route.tsSIZE: 3.17 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { z } from 'zod';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | const querySchema = z.object({  6 |   isAvailable: z.enum(['true', 'false']).optional(),  7 |   limit: z.coerce.number().int().min(1).max(10).default(5)  8 | });  9 |  10 | export async function GET(request: NextRequest) { 11 |   try { 12 |     const { searchParams } = new URL(request.url); 13 |     const queryParams = Object.fromEntries(searchParams.entries()); 14 |     const validation = querySchema.safeParse(queryParams); 15 |  16 |     if (!validation.success) { 17 |       return NextResponse.json({ 18 |         success: false, 19 |         error: 'Invalid query parameters', 20 |         details: validation.error.issues 21 |       }, { status: 400 }); 22 |     } 23 |  24 |     const { isAvailable, limit } = validation.data; 25 |  26 |     const where: Record<string, unknown> = { 27 |       isAvailable: true 28 |     }; 29 |  30 |     where.startTime = { 31 |       gte: new Date() 32 |     }; 33 |  34 |     const scheduleSlots = await prisma.scheduleSlot.findMany({ 35 |       where, 36 |       select: { 37 |         id: true, 38 |         startTime: true, 39 |         endTime: true, 40 |         capacity: true, 41 |         bookedCount: true, 42 |         isAvailable: true, 43 |         scheduleTemplate: { 44 |           select: { 45 |             id: true, 46 |             dayOfWeek: true, 47 |             startTime: true, 48 |             endTime: true, 49 |             capacity: true, 50 |             sessionDuration: { 51 |               select: { 52 |                 id: true, 53 |                 name: true, 54 |                 duration_minutes: true 55 |               } 56 |             } 57 |           } 58 |         }, 59 |         _count: { 60 |           select: { 61 |             bookings: true 62 |           } 63 |         } 64 |       }, 65 |       take: limit, 66 |       orderBy: { startTime: 'asc' } 67 |     }); 68 |  69 |     const transformedSlots = scheduleSlots.map(slot => ({ 70 |       id: slot.id.toString(), 71 |       date: slot.startTime.toISOString().split('T')[0], 72 |       time: slot.startTime.toTimeString().split(' ')[0].substring(0, 5), 73 |       isAvailable: slot.isAvailable && (slot.bookedCount || 0) < (slot.capacity || 1), 74 |       capacity: slot.capacity || 1, 75 |       bookedCount: slot.bookedCount || 0, 76 |       sessionType: slot.scheduleTemplate.sessionDuration?.name || 'Session', 77 |       duration: slot.scheduleTemplate.sessionDuration?.duration_minutes || 60, 78 |       startTime: slot.startTime.toISOString(), 79 |       endTime: slot.endTime.toISOString() 80 |     })); 81 |  82 |     return NextResponse.json({ 83 |       success: true, 84 |       data: transformedSlots 85 |     }); 86 |  87 |   } catch (error) { 88 |     return NextResponse.json({ 89 |       success: false, 90 |       error: 'Internal server error', 91 |       message: 'Failed to fetch schedule slots', 92 |       details: error instanceof Error ? error.message : 'Unknown error' 93 |     }, { status: 500 }); 94 |   } finally { 95 |     await prisma.$disconnect(); 96 |   } 97 | }
============================================================END: frontend/app/api/chat/schedule-slots/route.ts============================================================


============================================================FILE: frontend/app/api/chat/web/route.tsSIZE: 10.82 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { ConversationalOrchestrator } from '@/lib/services/conversational-orchestrator';  3 | import { OrchestratorConfig, IntentActionMapping } from '@/lib/types/conversational-orchestrator';  4 |   5 | const orchestratorConfig: OrchestratorConfig = {  6 |   rasa: {  7 |     url: process.env.RASA_URL || 'http:  8 |     model: process.env.RASA_MODEL || 'rasa',  9 |     confidence_threshold: parseFloat(process.env.RASA_CONFIDENCE_THRESHOLD || '0.7') 10 |   }, 11 |   openrouter: { 12 |     apiKey: process.env.OPENROUTER_API_KEY || '', 13 |     baseUrl: process.env.OPENROUTER_BASE_URL || 'https: 14 |     model: process.env.OPENROUTER_MODEL || 'meta-llama/llama-3.3-8b-instruct:free', 15 |     temperature: parseFloat(process.env.OPENROUTER_TEMPERATURE || '0.7'), 16 |     maxTokens: parseInt(process.env.OPENROUTER_MAX_TOKENS || '1000') 17 |   }, 18 |   twilio: { 19 |     accountSid: process.env.TWILIO_ACCOUNT_SID || '', 20 |     authToken: process.env.TWILIO_AUTH_TOKEN || '', 21 |     phoneNumber: process.env.TWILIO_PHONE_NUMBER || '', 22 |     webhookUrl: process.env.TWILIO_WEBHOOK_URL || '' 23 |   }, 24 |   logging: { 25 |     enabled: process.env.LOGGING_ENABLED === 'true', 26 |     level: (process.env.LOGGING_LEVEL as 'debug' | 'info' | 'warn' | 'error') || 'info', 27 |     storage: (process.env.LOGGING_STORAGE as 'database' | 'file' | 'console') || 'console' 28 |   }, 29 |   apis: { 30 |     baseUrl: process.env.API_BASE_URL || `${process.env.NEXT_PUBLIC_BASE_URL || `http: 31 |     timeout: parseInt(process.env.API_TIMEOUT || '10000'), 32 |     retries: parseInt(process.env.API_RETRIES || '3') 33 |   } 34 | }; 35 |  36 | const intentActionMapping: IntentActionMapping = { 37 |   'consulta_estado': { 38 |     action: 'consultar_estado', 39 |     apiEndpoint: '/admin/bookings', 40 |     requiredEntities: ['solicitud_id', 'cita_id', 'email'], 41 |     optionalEntities: ['tipo_consulta'], 42 |     description: 'Consultar el estado de una solicitud o cita' 43 |   }, 44 |   'agendar_cita': { 45 |     action: 'agendar_cita', 46 |     apiEndpoint: '/booking', 47 |     requiredEntities: ['fecha', 'hora', 'email'], 48 |     optionalEntities: ['tipo_sesion', 'paquete_id', 'tamaño_grupo', 'notas'], 49 |     description: 'Agendar una nueva cita' 50 |   }, 51 |   'consultar_paquetes': { 52 |     action: 'consultar_paquetes', 53 |     apiEndpoint: '/packages', 54 |     requiredEntities: [], 55 |     optionalEntities: ['tipo_paquete', 'moneda', 'duración'], 56 |     description: 'Consultar paquetes disponibles' 57 |   }, 58 |   'pagar_servicio': { 59 |     action: 'pagar_servicio', 60 |     apiEndpoint: '/client/purchase', 61 |     requiredEntities: ['monto', 'método_pago', 'email'], 62 |     optionalEntities: ['cita_id', 'paquete_id', 'moneda', 'notas'], 63 |     description: 'Procesar un pago' 64 |   }, 65 |   'cancelar_cita': { 66 |     action: 'cancelar_cita', 67 |     apiEndpoint: '/client/bookings', 68 |     requiredEntities: ['cita_id', 'email'], 69 |     optionalEntities: ['motivo'], 70 |     description: 'Cancelar una cita existente' 71 |   }, 72 |   'consultar_historial': { 73 |     action: 'consultar_historial', 74 |     apiEndpoint: '/client/purchase-history', 75 |     requiredEntities: ['email'], 76 |     optionalEntities: ['tipo_historial', 'fecha_desde', 'fecha_hasta'], 77 |     description: 'Consultar historial del usuario' 78 |   }, 79 |   'consultar_horarios': { 80 |     action: 'consultar_horarios', 81 |     apiEndpoint: '/schedule-slots', 82 |     requiredEntities: [], 83 |     optionalEntities: ['fecha', 'duración', 'tipo_sesion'], 84 |     description: 'Consultar horarios disponibles' 85 |   }, 86 |   'actualizar_perfil': { 87 |     action: 'actualizar_perfil', 88 |     apiEndpoint: '/client/me', 89 |     requiredEntities: ['email'], 90 |     optionalEntities: ['nombre', 'teléfono', 'fecha_nacimiento', 'lugar_nacimiento'], 91 |     description: 'Actualizar información del perfil' 92 |   }, 93 |   'saludo': { 94 |     action: 'saludo', 95 |     requiredEntities: [], 96 |     optionalEntities: ['nombre'], 97 |     description: 'Manejar saludos y bienvenidas' 98 |   }, 99 |   'despedida': {100 |     action: 'despedida',101 |     requiredEntities: [],102 |     optionalEntities: [],103 |     description: 'Manejar despedidas'104 |   },105 |   'ayuda': {106 |     action: 'ayuda',107 |     requiredEntities: [],108 |     optionalEntities: ['tema_ayuda'],109 |     description: 'Proporcionar ayuda y soporte'110 |   }111 | };112 | 113 | let webOrchestrator: ConversationalOrchestrator | null = null;114 | 115 | function getWebOrchestrator(): ConversationalOrchestrator {116 |   if (!webOrchestrator) {117 |     webOrchestrator = new ConversationalOrchestrator(orchestratorConfig, intentActionMapping);118 |   }119 |   return webOrchestrator;120 | }121 | 122 | export async function POST(request: NextRequest) {123 |   try {124 |     const body = await request.json();125 |     const { message, userId, language = 'es', timestamp } = body;126 | 127 |     if (!message) {128 |       return NextResponse.json({129 |         success: false,130 |         error: 'Message is required'131 |       }, { status: 400 });132 |     }133 | 134 |     if (!userId) {135 |       return NextResponse.json({136 |         success: false,137 |         error: 'User ID is required'138 |       }, { status: 400 });139 |     }140 | 141 |     + (message.length > 100 ? '...' : ''),142 |       language,143 |       timestamp144 |     });145 | 146 |     const orchestrator = getWebOrchestrator();147 | 148 |     const mockWebhook = {149 |       Body: message,150 |       From: `web:${userId}`,151 |       To: `web:assistant`,152 |       MessageSid: `web_${Date.now()}`,153 |       Timestamp: timestamp || new Date().toISOString(),154 |       ProfileName: 'Web User',155 | 156 |       Language: language,157 |       Channel: 'web',158 |       UserAgent: request.headers.get('user-agent') || 'unknown'159 |     };160 | 161 |     const result = await orchestrator.processWhatsAppMessage(mockWebhook);162 | 163 |     if (result.success) {164 |       const data = result.data as Record<string, unknown>;165 |       ?.length || 0166 |       });167 | 168 |       return NextResponse.json({169 |         success: true,170 |         data: {171 |           response: data.response,172 |           logId: data.logId,173 |           processingTime: data.processingTime,174 |           timestamp: new Date().toISOString(),175 |           language176 |         }177 |       });178 |     } else {179 | 180 |       const errorResponse = language === 'es'181 |         ? 'Lo siento, hubo un problema al procesar tu mensaje. Por favor intenta de nuevo en unos momentos.'182 |         : 'Sorry, there was a problem processing your message. Please try again in a moment.';183 | 184 |       return NextResponse.json({185 |         success: false,186 |         error: result.error || 'Processing failed',187 |         data: {188 |           response: errorResponse,189 |           timestamp: new Date().toISOString(),190 |           language191 |         }192 |       }, { status: 500 });193 |     }194 | 195 |   } catch (error) {196 |     return NextResponse.json({197 |       success: false,198 |       error: 'Internal server error',199 |       code: 'INTERNAL_ERROR',200 |       details: error instanceof Error ? error.message : 'Unknown error'201 |     }, { status: 500 });202 |   }203 | }204 | 205 | export async function GET(request: NextRequest) {206 |   try {207 |     const { searchParams } = new URL(request.url);208 |     const action = searchParams.get('action');209 | 210 |     const orchestrator = getWebOrchestrator();211 | 212 |     switch (action) {213 |       case 'health':214 |         const healthCheck = await orchestrator.healthCheck();215 |         return NextResponse.json({216 |           success: true,217 |           data: {218 |             ...healthCheck,219 |             channel: 'web',220 |             timestamp: new Date().toISOString()221 |           }222 |         });223 | 224 |       case 'config':225 |         return NextResponse.json({226 |           success: true,227 |           data: {228 |             config: {229 |               rasa: {230 |                 url: orchestratorConfig.rasa.url,231 |                 confidence_threshold: orchestratorConfig.rasa.confidence_threshold232 |               },233 |               openrouter: {234 |                 baseUrl: orchestratorConfig.openrouter.baseUrl,235 |                 model: orchestratorConfig.openrouter.model,236 |                 temperature: orchestratorConfig.openrouter.temperature237 |               },238 |               logging: {239 |                 enabled: orchestratorConfig.logging.enabled,240 |                 level: orchestratorConfig.logging.level,241 |                 storage: orchestratorConfig.logging.storage242 |               },243 |               channel: 'web'244 |             },245 |             supportedIntents: Object.keys(intentActionMapping),246 |             timestamp: new Date().toISOString()247 |           }248 |         });249 | 250 |       case 'examples':251 |         const examples = {252 |           es: [253 |             'Hola, ¿cómo estás?',254 |             '¿Qué paquetes tienen disponibles?',255 |             'Quiero agendar una cita para mañana a las 3pm',256 |             '¿Cuál es el estado de mi solicitud 12345?',257 |             'Quiero pagar $50 por mi paquete con tarjeta de crédito',258 |             '¿Qué horarios tienen disponibles para esta semana?',259 |             'Necesito cancelar mi cita del viernes',260 |             '¿Cómo funciona el sistema de citas?'261 |           ],262 |           en: [263 |             'Hello, how are you?',264 |             'What packages do you have available?',265 |             'I want to schedule an appointment for tomorrow at 3pm',266 |             'What is the status of my request 12345?',267 |             'I want to pay $50 for my package with credit card',268 |             'What schedules are available for this week?',269 |             'I need to cancel my Friday appointment',270 |             'How does the appointment system work?'271 |           ]272 |         };273 | 274 |         return NextResponse.json({275 |           success: true,276 |           data: {277 |             examples,278 |             intents: Object.keys(intentActionMapping).map(intent => ({279 |               name: intent,280 |               description: intentActionMapping[intent].description,281 |               requiredEntities: intentActionMapping[intent].requiredEntities,282 |               optionalEntities: intentActionMapping[intent].optionalEntities283 |             })),284 |             timestamp: new Date().toISOString()285 |           }286 |         });287 | 288 |       default:289 |         return NextResponse.json({290 |           success: true,291 |           message: 'Web Chat API',292 |           availableActions: ['health', 'config', 'examples'],293 |           usage: {294 |             POST: 'Send {message, userId, language?, timestamp?} to process a message',295 |             GET: 'Use ?action=health|config|examples for information'296 |           },297 |           timestamp: new Date().toISOString()298 |         });299 |     }300 | 301 |   } catch (error) {302 |     return NextResponse.json({303 |       success: false,304 |       error: 'Internal server error',305 |       code: 'INTERNAL_ERROR',306 |       details: error instanceof Error ? error.message : 'Unknown error'307 |     }, { status: 500 });308 |   }309 | }
============================================================END: frontend/app/api/chat/web/route.ts============================================================


============================================================FILE: frontend/app/api/client/bookings/[id]/report/route.tsSIZE: 2.04 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { createServerClient } from '@/lib/supabase/server';  3 |   4 | export async function GET(  5 |   { params }: { params: { id: string } }  6 | ) {  7 |   try {  8 |     const supabase = await createServerClient();  9 |  10 |     const { data: { user }, error: authError } = await supabase.auth.getUser(); 11 |  12 |     if (authError || !user) { 13 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 14 |     } 15 |  16 |     const { data: booking, error: bookingError } = await supabase 17 |       .from('bookings') 18 |       .select('*') 19 |       .eq('id', params.id) 20 |       .eq('client_id', user.id) 21 |       .single(); 22 |  23 |     if (bookingError || !booking) { 24 |       return NextResponse.json({ error: 'Booking not found or access denied' }, { status: 404 }); 25 |     } 26 |  27 |     const { data: report, error: reportError } = await supabase 28 |       .from('session_reports') 29 |       .select('*') 30 |       .eq('booking_id', params.id) 31 |       .single(); 32 |  33 |     if (reportError || !report) { 34 |       return NextResponse.json({ error: 'Session report not found' }, { status: 404 }); 35 |     } 36 |  37 |     const { data: fileData, error: fileError } = await supabase.storage 38 |       .from('session-reports') 39 |       .download(report.file_path); 40 |  41 |     if (fileError || !fileData) { 42 |       return NextResponse.json({ error: 'File not found' }, { status: 404 }); 43 |     } 44 |  45 |     const arrayBuffer = await fileData.arrayBuffer(); 46 |  47 |     return new NextResponse(arrayBuffer, { 48 |       headers: { 49 |         'Content-Type': report.mime_type || 'application/pdf', 50 |         'Content-Disposition': `attachment; filename="${report.original_filename || 'session-report.pdf'}"`, 51 |         'Content-Length': arrayBuffer.byteLength.toString() 52 |       } 53 |     }); 54 |  55 |   } catch (error) { 56 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 57 |   } 58 | }
============================================================END: frontend/app/api/client/bookings/[id]/report/route.ts============================================================


============================================================FILE: frontend/app/api/client/bookings/route.tsSIZE: 13.21 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 | import { replacePlaceholders } from '@/lib/communication/placeholders';  6 |   7 | const createBookingSchema = z.object({  8 |   scheduleSlotId: z.number().int().positive('Schedule slot ID must be positive'),  9 |   userPackageId: z.number().int().positive('User package ID must be positive'), 10 |   sessionType: z.string().min(1, 'Session type is required').default('Session'), 11 |   notes: z.string().optional(), 12 |   otpCode: z.string().optional(), 13 |   phoneNumber: z.string().optional() 14 | }); 15 |  16 | const querySchema = z.object({ 17 |   status: z.enum(['upcoming', 'past', 'all']).default('all'), 18 |   page: z.coerce.number().int().min(1).default(1), 19 |   limit: z.coerce.number().int().min(1).max(50).default(20) 20 | }); 21 |  22 | export async function GET(request: NextRequest) { 23 |   try { 24 |     const user = await requireAuth(request); 25 |     if (!user) { 26 |       return NextResponse.json({ 27 |         success: false, 28 |         error: 'Unauthorized', 29 |         message: 'Authentication required' 30 |       }, { status: 401 }); 31 |     } 32 |  33 |     const { searchParams } = new URL(request.url); 34 |     const queryParams = Object.fromEntries(searchParams.entries()); 35 |     const validation = querySchema.safeParse(queryParams); 36 |  37 |     if (!validation.success) { 38 |       return NextResponse.json({ 39 |         success: false, 40 |         error: 'Invalid query parameters', 41 |         details: validation.error.issues 42 |       }, { status: 400 }); 43 |     } 44 |  45 |     const { status, page, limit } = validation.data; 46 |     const offset = (page - 1) * limit; 47 |  48 |     const where: Record<string, unknown> = { 49 |       userId: user.id 50 |     }; 51 |  52 |     if (status === 'upcoming') { 53 |       where.scheduleSlot = { 54 |         startTime: { gte: new Date() } 55 |       }; 56 |       where.status = 'confirmed'; 57 |     } else if (status === 'past') { 58 |       where.scheduleSlot = { 59 |         startTime: { lt: new Date() } 60 |       }; 61 |       where.status = 'completed'; 62 |     } 63 |  64 |     const [bookings, totalCount] = await Promise.all([ 65 |       prisma.booking.findMany({ 66 |         where, 67 |         select: { 68 |           id: true, 69 |           sessionType: true, 70 |           status: true, 71 |           notes: true, 72 |           cancelledReason: true, 73 |           reminderSent: true, 74 |           createdAt: true, 75 |           updatedAt: true, 76 |           scheduleSlot: { 77 |             select: { 78 |               id: true, 79 |               startTime: true, 80 |               endTime: true, 81 |               capacity: true, 82 |               bookedCount: true, 83 |               scheduleTemplate: { 84 |                 select: { 85 |                   dayOfWeek: true, 86 |                   sessionDuration: { 87 |                     select: { 88 |                       name: true, 89 |                       duration_minutes: true 90 |                     } 91 |                   } 92 |                 } 93 |               } 94 |             } 95 |           }, 96 |           userPackage: { 97 |             select: { 98 |               id: true, 99 |               quantity: true,100 |               sessionsUsed: true,101 |               isActive: true,102 |               expiresAt: true,103 |               packagePrice: {104 |                 select: {105 |                   price: true,106 |                   pricingMode: true,107 |                   packageDefinition: {108 |                     select: {109 |                       name: true,110 |                       description: true,111 |                       sessionsCount: true,112 |                       packageType: true113 |                     }114 |                   },115 |                   currency: {116 |                     select: {117 |                       code: true,118 |                       symbol: true119 |                     }120 |                   }121 |                 }122 |               }123 |             }124 |           }125 |         },126 |         skip: offset,127 |         take: limit,128 |         orderBy: [129 |           { scheduleSlot: { startTime: status === 'upcoming' ? 'asc' : 'desc' } }130 |         ]131 |       }),132 |       prisma.booking.count({ where })133 |     ]);134 | 135 |     const totalPages = Math.ceil(totalCount / limit);136 | 137 |     return NextResponse.json({138 |       success: true,139 |       data: bookings,140 |       pagination: {141 |         page,142 |         limit,143 |         total: totalCount,144 |         totalPages145 |       },146 |       message: 'Bookings fetched successfully'147 |     });148 | 149 |   } catch (error) {150 |     return NextResponse.json({151 |       success: false,152 |       error: 'Internal server error',153 |       message: 'Failed to fetch bookings',154 |       details: error instanceof Error ? error.message : 'Unknown error'155 |     }, { status: 500 });156 |   } finally {157 |     await prisma.$disconnect();158 |   }159 | }160 | 161 | export async function POST(request: NextRequest) {162 |   try {163 |     const user = await requireAuth(request);164 |     if (!user) {165 |       return NextResponse.json({166 |         success: false,167 |         error: 'Unauthorized',168 |         message: 'Authentication required'169 |       }, { status: 401 });170 |     }171 | 172 |     const body = await request.json();173 |     const validation = createBookingSchema.safeParse(body);174 | 175 |     if (!validation.success) {176 |       return NextResponse.json({177 |         success: false,178 |         error: 'Validation failed',179 |         message: 'Invalid booking data',180 |         details: validation.error.issues181 |       }, { status: 400 });182 |     }183 | 184 |     const { scheduleSlotId, userPackageId, sessionType, notes, otpCode, phoneNumber } = validation.data;185 | 186 |     const userPackage = await prisma.userPackage.findFirst({187 |       where: {188 |         id: userPackageId,189 |         userId: user.id,190 |         isActive: true191 |       },192 |       include: {193 |         packagePrice: {194 |           include: {195 |             packageDefinition: {196 |               select: {197 |                 sessionsCount: true198 |               }199 |             }200 |           }201 |         }202 |       }203 |     });204 | 205 |     if (!userPackage) {206 |       return NextResponse.json({207 |         success: false,208 |         error: 'Invalid package',209 |         message: 'Package not found or not active'210 |       }, { status: 400 });211 |     }212 | 213 |     const totalSessions = userPackage.packagePrice.packageDefinition.sessionsCount * (userPackage.quantity || 1);214 |     const remainingSessions = totalSessions - (userPackage.sessionsUsed || 0);215 | 216 |     if (remainingSessions <= 0) {217 |       return NextResponse.json({218 |         success: false,219 |         error: 'No sessions remaining',220 |         message: 'You have no sessions remaining in this package'221 |       }, { status: 400 });222 |     }223 | 224 |     if (otpCode && phoneNumber) {225 |       const otpVerification = await prisma.otpVerification.findFirst({226 |         where: {227 |           phoneNumber,228 |           otpCode,229 |           isVerified: true,230 |           expiresAt: {231 |             gt: new Date()232 |           }233 |         },234 |         orderBy: {235 |           createdAt: 'desc'236 |         }237 |       });238 | 239 |       if (!otpVerification) {240 |         return NextResponse.json({241 |           success: false,242 |           error: 'Invalid OTP',243 |           message: 'OTP code is invalid or has expired'244 |         }, { status: 400 });245 |       }246 |     }247 | 248 |     const scheduleSlot = await prisma.scheduleSlot.findFirst({249 |       where: {250 |         id: scheduleSlotId,251 |         isAvailable: true252 |       }253 |     });254 | 255 |     if (!scheduleSlot) {256 |       return NextResponse.json({257 |         success: false,258 |         error: 'Invalid schedule slot',259 |         message: 'Schedule slot not found or not available'260 |       }, { status: 400 });261 |     }262 | 263 |     if (scheduleSlot.bookedCount && scheduleSlot.capacity && scheduleSlot.bookedCount >= scheduleSlot.capacity) {264 |       return NextResponse.json({265 |         success: false,266 |         error: 'Slot full',267 |         message: 'This time slot is already full'268 |       }, { status: 400 });269 |     }270 | 271 |     const result = await prisma.$transaction(async (tx) => {272 | 273 |       const booking = await tx.booking.create({274 |         data: {275 |           userId: user.id,276 |           userPackageId: userPackageId,277 |           scheduleSlotId: scheduleSlotId,278 |           sessionType: sessionType,279 |           notes: notes,280 |           status: 'confirmed'281 |         },282 |         include: {283 |           scheduleSlot: {284 |             select: {285 |               id: true,286 |               startTime: true,287 |               endTime: true,288 |               scheduleTemplate: {289 |                 select: {290 |                   dayOfWeek: true,291 |                   sessionDuration: {292 |                     select: {293 |                       name: true,294 |                       duration_minutes: true295 |                     }296 |                   }297 |                 }298 |               }299 |             }300 |           },301 |           userPackage: {302 |             select: {303 |               id: true,304 |               sessionsUsed: true,305 |               packagePrice: {306 |                 select: {307 |                   packageDefinition: {308 |                     select: {309 |                       name: true,310 |                       sessionsCount: true311 |                     }312 |                   }313 |                 }314 |               }315 |             }316 |           }317 |         }318 |       });319 | 320 |       await tx.userPackage.update({321 |         where: { id: userPackageId },322 |         data: { sessionsUsed: { increment: 1 } }323 |       });324 | 325 |       await tx.scheduleSlot.update({326 |         where: { id: scheduleSlotId },327 |         data: { bookedCount: { increment: 1 } }328 |       });329 | 330 |       return booking;331 |     });332 | 333 |     try {334 | 335 |       const bookingTemplate = await prisma.communicationTemplate.findFirst({336 |         where: {337 |           templateKey: 'booking_confirmation',338 |           type: 'email',339 |           isActive: true340 |         },341 |         include: {342 |           translations: true343 |         }344 |       });345 | 346 |       if (bookingTemplate && user.email) {347 | 348 |         const userDetails = await prisma.user.findUnique({349 |           where: { id: user.id },350 |           select: {351 |             fullName: true,352 |             email: true,353 |             phone: true,354 |             birthDate: true,355 |             birthTime: true,356 |             birthPlace: true,357 |             language: true358 |           }359 |         });360 | 361 |         if (userDetails) {362 | 363 |           const templateData = {364 |             userName: userDetails.fullName || 'User',365 |             userEmail: userDetails.email || '',366 |             bookingId: result.id.toString(),367 |             language: userDetails.language || 'English',368 |             adminEmail: 'admin@soulpath.lat',369 |             submissionDate: new Date().toLocaleDateString(),370 |             birthDate: userDetails.birthDate?.toISOString().split('T')[0] || '',371 |             birthTime: userDetails.birthTime?.toString().substring(0, 5) || '',372 |             birthPlace: userDetails.birthPlace || '',373 |             clientQuestion: notes || 'No specific question provided',374 |             bookingDate: result.scheduleSlot.startTime.toISOString().split('T')[0],375 |             bookingTime: result.scheduleSlot.startTime.toTimeString().substring(0, 5),376 |             sessionType: sessionType377 |           };378 | 379 |           const userLanguage = userDetails.language?.toLowerCase() || 'en';380 |           const translation = bookingTemplate.translations.find(t =>381 |             t.language === userLanguage382 |           ) || bookingTemplate.translations[0];383 | 384 |           if (translation) {385 | 386 |             const subject = replacePlaceholders(translation.subject || '', templateData);387 |             const content = replacePlaceholders(translation.content || '', templateData);388 | 389 |             + '...'390 |             });391 |           }392 |         }393 |       }394 |     } catch (templateError) {395 | 396 |     }397 | 398 |     return NextResponse.json({399 |       success: true,400 |       data: result,401 |       message: 'Booking created successfully'402 |     }, { status: 201 });403 | 404 |   } catch (error) {405 |     return NextResponse.json({406 |       success: false,407 |       error: 'Internal server error',408 |       message: 'Failed to create booking',409 |       details: error instanceof Error ? error.message : 'Unknown error'410 |     }, { status: 500 });411 |   } finally {412 |     await prisma.$disconnect();413 |   }414 | }
============================================================END: frontend/app/api/client/bookings/route.ts============================================================


============================================================FILE: frontend/app/api/client/dashboard-stats/route.tsSIZE: 6.00 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 | import { withCache } from '@/lib/cache';  5 | import { withApiOptimization } from '@/lib/middleware/performance';  6 |   7 | interface BookingData {  8 |   id: string;  9 |   status: string; 10 |   created_at: string; 11 |   rating?: number; 12 | } 13 |  14 | interface PurchaseData { 15 |   id: string; 16 |   total_amount: number; 17 |   payment_status: string; 18 |   purchased_at: string; 19 | } 20 |  21 | interface PackageWithDetails { 22 |   id: string; 23 |   is_active: boolean; 24 |   sessions_used: number; 25 |   quantity: number; 26 |   expires_at: string; 27 |   package_prices?: Array<{ 28 |     package_definitions?: Array<{ 29 |       name: string; 30 |       description?: string; 31 |       sessions_count: number; 32 |     }>; 33 |     price: number; 34 |     currency?: { 35 |       symbol: string; 36 |       code: string; 37 |     }; 38 |   }>; 39 | } 40 |  41 | async function handler(request: NextRequest) { 42 |   try { 43 |     const supabase = createClient( 44 |       process.env.NEXT_PUBLIC_SUPABASE_URL!, 45 |       process.env.SUPABASE_SERVICE_ROLE_KEY! 46 |     ); 47 |     const user = await requireAuth(request); 48 |  49 |     if (!user) { 50 |       return NextResponse.json( 51 |         { success: false, error: 'Unauthorized' }, 52 |         { status: 401 } 53 |       ); 54 |     } 55 |  56 |     const cacheKey = `dashboard-stats-${user.email}`; 57 |  58 |     return withCache( 59 |       cacheKey, 60 |       async () => { 61 |  62 |         const { data: customer, error: customerError } = await supabase 63 |           .from('users') 64 |           .select('id, email, created_at') 65 |           .eq('email', user.email) 66 |           .single(); 67 |  68 |         if (customerError || !customer) { 69 |           throw new Error('Customer not found'); 70 |         } 71 |  72 |     const [bookingsResult, packagesResult, purchasesResult] = await Promise.all([ 73 |       supabase 74 |         .from('bookings') 75 |         .select('id, status, created_at, completed_at, rating') 76 |         .eq('user_id', customer.id), 77 |       supabase 78 |         .from('user_packages') 79 |         .select(` 80 |           id, 81 |           is_active, 82 |           sessions_used, 83 |           quantity, 84 |           expires_at, 85 |           package_prices ( 86 |             package_definitions ( 87 |               name, 88 |               description, 89 |               sessions_count 90 |             ), 91 |             price, 92 |             currency ( 93 |               symbol, 94 |               code 95 |             ) 96 |           ) 97 |         `) 98 |         .eq('user_id', customer.id) 99 |         .returns<PackageWithDetails[]>(),100 |       supabase101 |         .from('purchases')102 |         .select(`103 |           id,104 |           total_amount,105 |           payment_status,106 |           purchased_at,107 |           payment_method108 |         `)109 |         .eq('user_id', customer.id)110 |     ]);111 | 112 |     if (bookingsResult.error) {113 |       return NextResponse.json(114 |         { success: false, error: 'Failed to fetch bookings' },115 |         { status: 500 }116 |       );117 |     }118 | 119 |     if (packagesResult.error) {120 |       return NextResponse.json(121 |         { success: false, error: 'Failed to fetch packages' },122 |         { status: 500 }123 |       );124 |     }125 | 126 |     if (purchasesResult.error) {127 |       return NextResponse.json(128 |         { success: false, error: 'Failed to fetch purchases' },129 |         { status: 500 }130 |       );131 |     }132 | 133 |     const bookings = bookingsResult.data;134 |     const packages = packagesResult.data;135 |     const purchases = purchasesResult.data;136 | 137 |     const totalBookings = bookings?.length || 0;138 |     const completedBookings = bookings?.filter((b: BookingData) => b.status === 'completed').length || 0;139 |     const upcomingBookings = bookings?.filter((b: BookingData) =>140 |       b.status === 'confirmed' && new Date(b.created_at) > new Date()141 |     ).length || 0;142 | 143 |     const activePackages = (packages as PackageWithDetails[])?.filter((p: PackageWithDetails) => {144 |       const packagePrice = p.package_prices?.[0];145 |       const sessionsCount = packagePrice?.package_definitions?.[0]?.sessions_count || 0;146 |       const totalSessions = sessionsCount * (p.quantity || 1);147 |       const sessionsRemaining = totalSessions - (p.sessions_used || 0);148 |       return p.is_active && sessionsRemaining > 0;149 |     }).length || 0;150 | 151 |     const totalSpent = purchases?.reduce((sum: number, purchase: PurchaseData) => {152 |       if (purchase.payment_status === 'completed') {153 |         return sum + (purchase.total_amount || 0);154 |       }155 |       return sum;156 |     }, 0) || 0;157 | 158 |     const averageRating = bookings?.length > 0159 |       ? bookings160 |           .filter((b: BookingData) => b.rating)161 |           .reduce((sum: number, b: BookingData) => sum + (b.rating || 0), 0) /162 |           bookings.filter((b: BookingData) => b.rating).length163 |       : 0;164 | 165 |     const loyaltyPoints = Math.floor(totalSpent / 10) + completedBookings;166 | 167 |     const stats = {168 |       totalBookings,169 |       activePackages,170 |       totalSpent,171 |       upcomingSessions: upcomingBookings,172 |       completedSessions: completedBookings,173 |       averageRating: Math.round(averageRating * 10) / 10,174 |       loyaltyPoints175 |     };176 | 177 |         return NextResponse.json({178 |           success: true,179 |           data: stats180 |         });181 |       },182 |       5 * 60 * 1000183 |     );184 | 185 |   } catch (error) {186 |     if (error instanceof Error && error.message === 'Customer not found') {187 |       return NextResponse.json(188 |         { success: false, error: 'Customer not found' },189 |         { status: 404 }190 |       );191 |     }192 |     return NextResponse.json(193 |       { success: false, error: 'Failed to fetch dashboard statistics' },194 |       { status: 500 }195 |     );196 |   }197 | }198 | 199 | export const GET = withApiOptimization(handler, {200 |   cache: true,201 |   cacheTTL: 300,202 |   compress: true,203 |   rateLimit: true,204 |   rateLimitMax: 50205 | });
============================================================END: frontend/app/api/client/dashboard-stats/route.ts============================================================


============================================================FILE: frontend/app/api/client/live-session/config/route.tsSIZE: 1.57 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | export async function GET(request: NextRequest) {  6 |   try {  7 |     const user = await requireAuth(request);  8 |     if (!user) {  9 |       return NextResponse.json({ 10 |         success: false, 11 |         error: 'Unauthorized', 12 |         message: 'Authentication required' 13 |       }, { status: 401 }); 14 |     } 15 |  16 |     const config = { 17 |       id: 'live-session-1', 18 |       name: 'SoulPath Live Sessions', 19 |       provider: 'zoom' as const, 20 |       apiKey: process.env.ZOOM_API_KEY || '', 21 |       isActive: true, 22 |       settings: { 23 |         allowVideo: true, 24 |         allowAudio: true, 25 |         allowChat: true, 26 |         allowScreenShare: true, 27 |         maxParticipants: 10, 28 |         recordingEnabled: true 29 |       } 30 |     }; 31 |  32 |     return NextResponse.json({ 33 |       success: true, 34 |       data: config 35 |     }); 36 |  37 |   } catch (error) { 38 |     return NextResponse.json({ 39 |       success: false, 40 |       error: 'Internal server error', 41 |       message: 'Failed to load live session configuration' 42 |     }, { status: 500 }); 43 |   } finally { 44 |     await prisma.$disconnect(); 45 |   } 46 | }
============================================================END: frontend/app/api/client/live-session/config/route.ts============================================================


============================================================FILE: frontend/app/api/client/live-session/create-meeting/route.tsSIZE: 3.30 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 | import { z } from 'zod';  5 |   6 | const createMeetingSchema = z.object({  7 |   sessionId: z.string().min(1, 'Session ID is required'),  8 |   title: z.string().min(1, 'Title is required'),  9 |   duration: z.number().int().min(1, 'Duration must be at least 1 minute'), 10 |   settings: z.object({ 11 |     videoEnabled: z.boolean().default(true), 12 |     audioEnabled: z.boolean().default(true), 13 |     chatEnabled: z.boolean().default(true), 14 |     screenShareEnabled: z.boolean().default(false) 15 |   }).optional() 16 | }); 17 |  18 | export async function POST(request: NextRequest) { 19 |   try { 20 |     const user = await requireAuth(request); 21 |     if (!user) { 22 |       return NextResponse.json({ 23 |         success: false, 24 |         error: 'Unauthorized', 25 |         message: 'Authentication required' 26 |       }, { status: 401 }); 27 |     } 28 |  29 |     const body = await request.json(); 30 |     const validation = createMeetingSchema.safeParse(body); 31 |  32 |     if (!validation.success) { 33 |       return NextResponse.json({ 34 |         success: false, 35 |         error: 'Validation failed', 36 |         message: 'Invalid meeting data', 37 |         details: validation.error.issues 38 |       }, { status: 400 }); 39 |     } 40 |  41 |     const { title, duration, settings } = validation.data; 42 |  43 |     const meetingId = `meeting_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`; 44 |  45 |     const provider = process.env.LIVE_SESSION_PROVIDER || 'zoom'; 46 |     let meetingUrl = ''; 47 |  48 |     switch (provider) { 49 |       case 'zoom': 50 |         meetingUrl = `https: 51 |         break; 52 |       case 'meet': 53 |         meetingUrl = `https: 54 |         break; 55 |       case 'teams': 56 |         meetingUrl = `https: 57 |         break; 58 |       default: 59 |         meetingUrl = `https: 60 |     } 61 |  62 |     return NextResponse.json({ 63 |       success: true, 64 |       data: { 65 |         meetingId, 66 |         meetingUrl, 67 |         title, 68 |         duration, 69 |         settings: settings || { 70 |           videoEnabled: true, 71 |           audioEnabled: true, 72 |           chatEnabled: true, 73 |           screenShareEnabled: false 74 |         }, 75 |         createdAt: new Date().toISOString() 76 |       }, 77 |       message: 'Meeting created successfully' 78 |     }); 79 |  80 |   } catch (error) { 81 |     return NextResponse.json({ 82 |       success: false, 83 |       error: 'Internal server error', 84 |       message: 'Failed to create meeting' 85 |     }, { status: 500 }); 86 |   } finally { 87 |     await prisma.$disconnect(); 88 |   } 89 | }
============================================================END: frontend/app/api/client/live-session/create-meeting/route.ts============================================================


============================================================FILE: frontend/app/api/client/live-session/upcoming/route.tsSIZE: 2.53 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | export async function GET(request: NextRequest) {  6 |   try {  7 |     const user = await requireAuth(request);  8 |     if (!user) {  9 |       return NextResponse.json({ 10 |         success: false, 11 |         error: 'Unauthorized', 12 |         message: 'Authentication required' 13 |       }, { status: 401 }); 14 |     } 15 |  16 |     const upcomingSessions = [ 17 |       { 18 |         id: 'session-1', 19 |         title: 'Spiritual Guidance Session', 20 |         description: 'One-on-one spiritual guidance and consultation', 21 |         startTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(), 22 |         endTime: new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(), 23 |         duration: 60, 24 |         status: 'scheduled' as const, 25 |         participants: 1, 26 |         maxParticipants: 2 27 |       }, 28 |       { 29 |         id: 'session-2', 30 |         title: 'Group Meditation Session', 31 |         description: 'Guided group meditation and spiritual discussion', 32 |         startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), 33 |         endTime: new Date(Date.now() + 25 * 60 * 60 * 1000).toISOString(), 34 |         duration: 90, 35 |         status: 'scheduled' as const, 36 |         participants: 3, 37 |         maxParticipants: 8 38 |       }, 39 |       { 40 |         id: 'session-3', 41 |         title: 'Live Q&A Session', 42 |         description: 'Ask questions and receive spiritual guidance', 43 |         startTime: new Date(Date.now() - 30 * 60 * 1000).toISOString(), 44 |         endTime: new Date(Date.now() + 30 * 60 * 1000).toISOString(), 45 |         duration: 60, 46 |         status: 'live' as const, 47 |         participants: 5, 48 |         maxParticipants: 10 49 |       } 50 |     ]; 51 |  52 |     return NextResponse.json({ 53 |       success: true, 54 |       data: upcomingSessions 55 |     }); 56 |  57 |   } catch (error) { 58 |     return NextResponse.json({ 59 |       success: false, 60 |       error: 'Internal server error', 61 |       message: 'Failed to load upcoming sessions' 62 |     }, { status: 500 }); 63 |   } finally { 64 |     await prisma.$disconnect(); 65 |   } 66 | }
============================================================END: frontend/app/api/client/live-session/upcoming/route.ts============================================================


============================================================FILE: frontend/app/api/client/me/route.tsSIZE: 4.90 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const updateUserProfileSchema = z.object({  7 |   fullName: z.string().min(1, 'Full name is required').max(255, 'Name too long'),  8 |   phone: z.string().optional(),  9 |   birthDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)').optional(), 10 |   birthTime: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)').optional(), 11 |   birthPlace: z.string().optional(), 12 |   question: z.string().optional(), 13 |   language: z.enum(['en', 'es']).default('en'), 14 |   notes: z.string().optional() 15 | }); 16 |  17 | export async function GET(request: NextRequest) { 18 |   try { 19 |     const user = await requireAuth(request); 20 |     if (!user) { 21 |       return NextResponse.json({ 22 |         success: false, 23 |         error: 'Unauthorized', 24 |         message: 'Authentication required' 25 |       }, { status: 401 }); 26 |     } 27 |  28 |     const userProfile = await prisma.user.findUnique({ 29 |       where: { id: user.id }, 30 |       select: { 31 |         id: true, 32 |         email: true, 33 |         fullName: true, 34 |         phone: true, 35 |         role: true, 36 |         status: true, 37 |         birthDate: true, 38 |         birthTime: true, 39 |         birthPlace: true, 40 |         question: true, 41 |         language: true, 42 |         adminNotes: true, 43 |         scheduledDate: true, 44 |         scheduledTime: true, 45 |         sessionType: true, 46 |         notes: true, 47 |         createdAt: true, 48 |         updatedAt: true, 49 |         _count: { 50 |           select: { 51 |             bookings: true, 52 |             purchases: true, 53 |             userPackages: true 54 |           } 55 |         } 56 |       } 57 |     }); 58 |  59 |     if (!userProfile) { 60 |       return NextResponse.json({ 61 |         success: false, 62 |         error: 'Profile not found', 63 |         message: 'User profile does not exist' 64 |       }, { status: 404 }); 65 |     } 66 |  67 |     return NextResponse.json({ 68 |       success: true, 69 |       data: userProfile 70 |     }); 71 |  72 |   } catch (error) { 73 |     return NextResponse.json({ 74 |       success: false, 75 |       error: 'Internal server error', 76 |       message: 'Failed to retrieve user profile', 77 |       details: error instanceof Error ? error.message : 'Unknown error' 78 |     }, { status: 500 }); 79 |   } finally { 80 |     await prisma.$disconnect(); 81 |   } 82 | } 83 |  84 | export async function PUT(request: NextRequest) { 85 |   try { 86 |     const user = await requireAuth(request); 87 |     if (!user) { 88 |       return NextResponse.json({ 89 |         success: false, 90 |         error: 'Unauthorized', 91 |         message: 'Authentication required' 92 |       }, { status: 401 }); 93 |     } 94 |  95 |     const body = await request.json(); 96 |     const validation = updateUserProfileSchema.safeParse(body); 97 |  98 |     if (!validation.success) { 99 |       return NextResponse.json({100 |         success: false,101 |         error: 'Validation failed',102 |         message: 'Invalid profile data',103 |         details: validation.error.issues104 |       }, { status: 400 });105 |     }106 | 107 |     const updateData = validation.data;108 | 109 |     const updatedProfile = await prisma.user.update({110 |       where: { id: user.id },111 |       data: {112 |         fullName: updateData.fullName,113 |         phone: updateData.phone,114 |         birthDate: updateData.birthDate,115 |         birthTime: updateData.birthTime,116 |         birthPlace: updateData.birthPlace,117 |         question: updateData.question,118 |         language: updateData.language,119 |         notes: updateData.notes120 |       },121 |       select: {122 |         id: true,123 |         email: true,124 |         fullName: true,125 |         phone: true,126 |         role: true,127 |         status: true,128 |         birthDate: true,129 |         birthTime: true,130 |         birthPlace: true,131 |         question: true,132 |         language: true,133 |         adminNotes: true,134 |         scheduledDate: true,135 |         scheduledTime: true,136 |         sessionType: true,137 |         notes: true,138 |         createdAt: true,139 |         updatedAt: true140 |       }141 |     });142 | 143 |     return NextResponse.json({144 |       success: true,145 |       message: 'Profile updated successfully',146 |       data: updatedProfile147 |     });148 | 149 |   } catch (error) {150 |     return NextResponse.json({151 |       success: false,152 |       error: 'Internal server error',153 |       message: 'Failed to update user profile',154 |       details: error instanceof Error ? error.message : 'Unknown error'155 |     }, { status: 500 });156 |   } finally {157 |     await prisma.$disconnect();158 |   }159 | }
============================================================END: frontend/app/api/client/me/route.ts============================================================


============================================================FILE: frontend/app/api/client/my-bookings/route.tsSIZE: 8.40 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | interface BookingData {  6 |   id: string;  7 |   date: string;  8 |   time: string;  9 |   status: string; 10 |   session_type: string; 11 |   price?: number; 12 |   notes?: string; 13 |   rating?: number; 14 |   feedback?: string; 15 |   created_at: string; 16 |   completed_at?: string; 17 |   customer_packages?: { 18 |     id: string; 19 |     package_definitions?: { 20 |       name: string; 21 |       description?: string; 22 |     }[]; 23 |   }[]; 24 |   schedules?: { 25 |     id: string; 26 |     session_type: string; 27 |     capacity: number; 28 |     booked_count: number; 29 |   }[]; 30 | } 31 |  32 | export async function GET(request: NextRequest) { 33 |   try { 34 |     const supabase = createClient( 35 |       process.env.NEXT_PUBLIC_SUPABASE_URL!, 36 |       process.env.SUPABASE_SERVICE_ROLE_KEY! 37 |     ); 38 |     const user = await requireAuth(request); 39 |  40 |     if (!user) { 41 |       return NextResponse.json( 42 |         { success: false, error: 'Unauthorized' }, 43 |         { status: 401 } 44 |       ); 45 |     } 46 |  47 |     const { data: customer, error: customerError } = await supabase 48 |       .from('customers') 49 |       .select('id, email') 50 |       .eq('email', user.email) 51 |       .single(); 52 |  53 |     if (customerError || !customer) { 54 |       return NextResponse.json( 55 |         { success: false, error: 'Customer not found' }, 56 |         { status: 404 } 57 |       ); 58 |     } 59 |  60 |     const { data: bookings, error: bookingsError } = await supabase 61 |       .from('bookings') 62 |       .select(` 63 |         id, 64 |         date, 65 |         time, 66 |         status, 67 |         session_type, 68 |         price, 69 |         notes, 70 |         rating, 71 |         feedback, 72 |         created_at, 73 |         completed_at, 74 |         customer_packages ( 75 |           id, 76 |           package_definitions ( 77 |             name, 78 |             description 79 |           ) 80 |         ), 81 |         schedules ( 82 |           id, 83 |           session_type, 84 |           capacity, 85 |           booked_count 86 |         ) 87 |       `) 88 |       .eq('customer_id', customer.id) 89 |       .order('date', { ascending: false }); 90 |  91 |     if (bookingsError) { 92 |       return NextResponse.json( 93 |         { success: false, error: 'Failed to fetch bookings' }, 94 |         { status: 500 } 95 |       ); 96 |     } 97 |  98 |     const transformedBookings = bookings?.map((booking: BookingData) => ({ 99 |       id: booking.id,100 |       date: booking.date,101 |       time: booking.time,102 |       status: booking.status,103 |       sessionType: booking.session_type,104 |       packageId: booking.customer_packages?.[0]?.id,105 |       packageName: booking.customer_packages?.[0]?.package_definitions?.[0]?.name,106 |       createdAt: booking.created_at107 |     })) || [];108 | 109 |     return NextResponse.json({110 |       success: true,111 |       data: transformedBookings112 |     });113 | 114 |   } catch (error) {115 |     return NextResponse.json(116 |       { success: false, error: 'Internal server error' },117 |       { status: 500 }118 |     );119 |   }120 | }121 | 122 | export async function POST(request: NextRequest) {123 |   try {124 |     const supabase = createClient(125 |       process.env.NEXT_PUBLIC_SUPABASE_URL!,126 |       process.env.SUPABASE_SERVICE_ROLE_KEY!127 |     );128 |     const user = await requireAuth(request);129 | 130 |     if (!user) {131 |       return NextResponse.json(132 |         { success: false, error: 'Unauthorized' },133 |         { status: 401 }134 |       );135 |     }136 | 137 |     const body = await request.json();138 |     const {139 |       packageId,140 |       scheduleId,141 |       clientName,142 |       clientEmail,143 |       clientPhone,144 |       birthDate,145 |       birthTime,146 |       birthPlace,147 |       question,148 |       specialRequests,149 |       language150 |     } = body;151 | 152 |     if (!packageId || !scheduleId || !clientName || !clientEmail || !birthDate || !birthPlace || !question) {153 |       return NextResponse.json(154 |         { success: false, error: 'Missing required fields' },155 |         { status: 400 }156 |       );157 |     }158 | 159 |     const { data: customer, error: customerError } = await supabase160 |       .from('customers')161 |       .select('id, email')162 |       .eq('email', user.email)163 |       .single();164 | 165 |     if (customerError || !customer) {166 |       return NextResponse.json(167 |         { success: false, error: 'Customer not found' },168 |         { status: 404 }169 |       );170 |     }171 | 172 |     const { data: packageData, error: packageError } = await supabase173 |       .from('customer_packages')174 |       .select(`175 |         id,176 |         sessions_remaining,177 |         status,178 |         package_definitions (179 |           name,180 |           session_duration_id181 |         )182 |       `)183 |       .eq('id', packageId)184 |       .eq('customer_id', customer.id)185 |       .single();186 | 187 |     if (packageError || !packageData) {188 |       return NextResponse.json(189 |         { success: false, error: 'Package not found or not owned by customer' },190 |         { status: 404 }191 |       );192 |     }193 | 194 |     if (packageData.status !== 'active') {195 |       return NextResponse.json(196 |         { success: false, error: 'Package is not active' },197 |         { status: 400 }198 |       );199 |     }200 | 201 |     if (packageData.sessions_remaining <= 0) {202 |       return NextResponse.json(203 |         { success: false, error: 'No sessions remaining in this package' },204 |         { status: 400 }205 |       );206 |     }207 | 208 |     const { data: schedule, error: scheduleError } = await supabase209 |       .from('schedules')210 |       .select('id, date, time, capacity, booked_count, is_available')211 |       .eq('id', scheduleId)212 |       .single();213 | 214 |     if (scheduleError || !schedule) {215 |       return NextResponse.json(216 |         { success: false, error: 'Schedule not found' },217 |         { status: 404 }218 |       );219 |     }220 | 221 |     if (!schedule.is_available || schedule.booked_count >= schedule.capacity) {222 |       return NextResponse.json(223 |         { success: false, error: 'Schedule is not available' },224 |         { status: 400 }225 |       );226 |     }227 | 228 |     const { data: existingBooking, error: existingBookingError } = await supabase229 |       .from('bookings')230 |       .select('id')231 |       .eq('customer_id', customer.id)232 |       .eq('schedule_id', scheduleId)233 |       .single();234 | 235 |     if (existingBooking && !existingBookingError) {236 |       return NextResponse.json(237 |         { success: false, error: 'You already have a booking for this schedule' },238 |         { status: 400 }239 |       );240 |     }241 | 242 |     const { data: newBooking, error: bookingCreateError } = await supabase243 |       .from('bookings')244 |       .insert({245 |         customer_id: customer.id,246 |         customer_package_id: packageId,247 |         schedule_id: scheduleId,248 |         date: schedule.date,249 |         time: schedule.time,250 |         status: 'pending',251 |         session_type: packageData.package_definitions?.[0]?.name || 'Standard Reading',252 |         client_name: clientName,253 |         client_email: clientEmail,254 |         client_phone: clientPhone,255 |         birth_date: birthDate,256 |         birth_time: birthTime,257 |         birth_place: birthPlace,258 |         question: question,259 |         special_requests: specialRequests,260 |         language: language261 |       })262 |       .select()263 |       .single();264 | 265 |     if (bookingCreateError) {266 |       return NextResponse.json(267 |         { success: false, error: 'Failed to create booking' },268 |         { status: 500 }269 |       );270 |     }271 | 272 |     const { error: scheduleUpdateError } = await supabase273 |       .from('schedules')274 |       .update({ booked_count: schedule.booked_count + 1 })275 |       .eq('id', scheduleId);276 | 277 |     if (scheduleUpdateError) {278 | 279 |     }280 | 281 |     const { error: packageUpdateError } = await supabase282 |       .from('customer_packages')283 |       .update({ sessions_remaining: packageData.sessions_remaining - 1 })284 |       .eq('id', packageId);285 | 286 |     if (packageUpdateError) {287 | 288 |     }289 | 290 |     return NextResponse.json({291 |       success: true,292 |       data: {293 |         booking: newBooking,294 |         message: 'Booking created successfully'295 |       }296 |     });297 | 298 |   } catch (error) {299 |     return NextResponse.json(300 |       { success: false, error: 'Internal server error' },301 |       { status: 500 }302 |     );303 |   }304 | }
============================================================END: frontend/app/api/client/my-bookings/route.ts============================================================


============================================================FILE: frontend/app/api/client/my-packages/route.tsSIZE: 5.50 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const querySchema = z.object({  7 |   isActive: z.enum(['true', 'false']).optional(),  8 |   hasRemainingSessions: z.enum(['true', 'false']).optional(),  9 |   page: z.coerce.number().int().min(1).default(1), 10 |   limit: z.coerce.number().int().min(1).max(50).default(20) 11 | }); 12 |  13 | export async function GET(request: NextRequest) { 14 |   try { 15 |     const user = await requireAuth(request); 16 |     if (!user) { 17 |       return NextResponse.json({ 18 |         success: false, 19 |         error: 'Unauthorized', 20 |         message: 'Authentication required' 21 |       }, { status: 401 }); 22 |     } 23 |  24 |     const { searchParams } = new URL(request.url); 25 |     const queryParams = Object.fromEntries(searchParams.entries()); 26 |     const validation = querySchema.safeParse(queryParams); 27 |  28 |     if (!validation.success) { 29 |       return NextResponse.json({ 30 |         success: false, 31 |         error: 'Invalid query parameters', 32 |         details: validation.error.issues 33 |       }, { status: 400 }); 34 |     } 35 |  36 |     const { isActive, hasRemainingSessions, page, limit } = validation.data; 37 |     const offset = (page - 1) * limit; 38 |  39 |     const where: Record<string, unknown> = { 40 |       userId: user.id 41 |     }; 42 |  43 |     if (isActive !== undefined) { 44 |       where.isActive = isActive === 'true'; 45 |     } 46 |  47 |     const [userPackages, totalCount] = await Promise.all([ 48 |       prisma.userPackage.findMany({ 49 |         where, 50 |         select: { 51 |           id: true, 52 |           quantity: true, 53 |           sessionsUsed: true, 54 |           isActive: true, 55 |           expiresAt: true, 56 |           createdAt: true, 57 |           updatedAt: true, 58 |           purchase: { 59 |             select: { 60 |               id: true, 61 |               totalAmount: true, 62 |               paymentStatus: true, 63 |               purchasedAt: true 64 |             } 65 |           }, 66 |           packagePrice: { 67 |             select: { 68 |               id: true, 69 |               price: true, 70 |               pricingMode: true, 71 |               packageDefinition: { 72 |                 select: { 73 |                   id: true, 74 |                   name: true, 75 |                   description: true, 76 |                   sessionsCount: true, 77 |                   packageType: true, 78 |                   maxGroupSize: true, 79 |                   sessionDuration: { 80 |                     select: { 81 |                       id: true, 82 |                       name: true, 83 |                       duration_minutes: true, 84 |                       description: true 85 |                     } 86 |                   } 87 |                 } 88 |               }, 89 |               currency: { 90 |                 select: { 91 |                   id: true, 92 |                   code: true, 93 |                   name: true, 94 |                   symbol: true 95 |                 } 96 |               } 97 |             } 98 |           } 99 |         },100 |         skip: offset,101 |         take: limit,102 |         orderBy: { createdAt: 'desc' }103 |       }),104 |       prisma.userPackage.count({ where })105 |     ]);106 | 107 |     const transformedPackages = userPackages.map((pkg) => {108 |       const totalSessions = pkg.packagePrice.packageDefinition.sessionsCount * (pkg.quantity || 1);109 |       const sessionsRemaining = totalSessions - (pkg.sessionsUsed || 0);110 | 111 |       return {112 |         id: pkg.id,113 |         name: pkg.packagePrice.packageDefinition.name,114 |         description: pkg.packagePrice.packageDefinition.description,115 |         sessionsRemaining,116 |         totalSessions,117 |         sessionsUsed: pkg.sessionsUsed,118 |         quantity: pkg.quantity,119 |         expiresAt: pkg.expiresAt,120 |         isActive: pkg.isActive,121 |         purchaseDate: pkg.purchase.purchasedAt,122 |         price: pkg.packagePrice.price,123 |         sessionDuration: pkg.packagePrice.packageDefinition.sessionDuration.duration_minutes,124 |         packageType: pkg.packagePrice.packageDefinition.packageType,125 |         maxGroupSize: pkg.packagePrice.packageDefinition.maxGroupSize,126 |         currency: pkg.packagePrice.currency.symbol,127 |         currencyCode: pkg.packagePrice.currency.code,128 |         paymentStatus: pkg.purchase.paymentStatus,129 |         totalAmount: pkg.purchase.totalAmount130 |       };131 |     });132 | 133 |     let filteredPackages = transformedPackages;134 |     if (hasRemainingSessions === 'true') {135 |       filteredPackages = transformedPackages.filter(pkg => pkg.sessionsRemaining > 0);136 |     } else if (hasRemainingSessions === 'false') {137 |       filteredPackages = transformedPackages.filter(pkg => pkg.sessionsRemaining <= 0);138 |     }139 | 140 |     const totalPages = Math.ceil(totalCount / limit);141 | 142 |     return NextResponse.json({143 |       success: true,144 |       data: filteredPackages,145 |       pagination: {146 |         page,147 |         limit,148 |         total: totalCount,149 |         totalPages150 |       }151 |     });152 | 153 |   } catch (error) {154 |     return NextResponse.json({155 |       success: false,156 |       error: 'Internal server error',157 |       message: 'Failed to fetch user packages',158 |       details: error instanceof Error ? error.message : 'Unknown error'159 |     }, { status: 500 });160 |   } finally {161 |     await prisma.$disconnect();162 |   }163 | }
============================================================END: frontend/app/api/client/my-packages/route.ts============================================================


============================================================FILE: frontend/app/api/client/packages/route.tsSIZE: 3.63 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const querySchema = z.object({  7 |   currency: z.string().length(3).optional(),  8 |   packageType: z.string().optional(),  9 |   page: z.coerce.number().int().min(1).default(1), 10 |   limit: z.coerce.number().int().min(1).max(50).default(20) 11 | }); 12 |  13 | export async function GET(request: NextRequest) { 14 |   try { 15 |     const user = await requireAuth(request); 16 |     if (!user) { 17 |       return NextResponse.json({ 18 |         success: false, 19 |         error: 'Unauthorized', 20 |         message: 'Authentication required' 21 |       }, { status: 401 }); 22 |     } 23 |  24 |     const { searchParams } = new URL(request.url); 25 |     const queryParams = Object.fromEntries(searchParams.entries()); 26 |     const validation = querySchema.safeParse(queryParams); 27 |  28 |     if (!validation.success) { 29 |       return NextResponse.json({ 30 |         success: false, 31 |         error: 'Invalid query parameters', 32 |         details: validation.error.issues 33 |       }, { status: 400 }); 34 |     } 35 |  36 |     const { currency, packageType, page, limit } = validation.data; 37 |     const offset = (page - 1) * limit; 38 |  39 |     const where: Record<string, unknown> = { 40 |       isActive: true 41 |     }; 42 |  43 |     if (packageType) { 44 |       where.packageType = packageType; 45 |     } 46 |  47 |     const [packageDefinitions, totalCount] = await Promise.all([ 48 |       prisma.packageDefinition.findMany({ 49 |         where, 50 |         select: { 51 |           id: true, 52 |           name: true, 53 |           description: true, 54 |           sessionsCount: true, 55 |           packageType: true, 56 |           maxGroupSize: true, 57 |           isActive: true, 58 |           createdAt: true, 59 |           updatedAt: true, 60 |           sessionDuration: { 61 |             select: { 62 |               id: true, 63 |               name: true, 64 |               duration_minutes: true, 65 |               description: true 66 |             } 67 |           }, 68 |           packagePrices: { 69 |             where: { 70 |               isActive: true, 71 |               ...(currency && { currency: { code: currency } }) 72 |             }, 73 |             select: { 74 |               id: true, 75 |               price: true, 76 |               pricingMode: true, 77 |               isActive: true, 78 |               currency: { 79 |                 select: { 80 |                   id: true, 81 |                   code: true, 82 |                   name: true, 83 |                   symbol: true 84 |                 } 85 |               } 86 |             }, 87 |             orderBy: { price: 'asc' } 88 |           } 89 |         }, 90 |         skip: offset, 91 |         take: limit, 92 |         orderBy: { name: 'asc' } 93 |       }), 94 |       prisma.packageDefinition.count({ where }) 95 |     ]); 96 |  97 |     const totalPages = Math.ceil(totalCount / limit); 98 |  99 |     return NextResponse.json({100 |       success: true,101 |       data: packageDefinitions,102 |       pagination: {103 |         page,104 |         limit,105 |         total: totalCount,106 |         totalPages107 |       }108 |     });109 | 110 |   } catch (error) {111 |     return NextResponse.json({112 |       success: false,113 |       error: 'Internal server error',114 |       message: 'Failed to fetch packages',115 |       details: error instanceof Error ? error.message : 'Unknown error'116 |     }, { status: 500 });117 |   } finally {118 |     await prisma.$disconnect();119 |   }120 | }
============================================================END: frontend/app/api/client/packages/route.ts============================================================


============================================================FILE: frontend/app/api/client/payment-methods/route.tsSIZE: 1.73 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET() {  5 |   try {  6 |   7 |     const paymentMethods = await prisma.paymentMethodConfig.findMany({  8 |       where: {  9 |         isActive: true 10 |       }, 11 |       select: { 12 |         id: true, 13 |         name: true, 14 |         type: true, 15 |         description: true, 16 |         icon: true, 17 |         requiresConfirmation: true, 18 |         autoAssignPackage: true, 19 |         isActive: true 20 |       }, 21 |       orderBy: { name: 'asc' } 22 |     }); 23 |  24 |     const transformedMethods = paymentMethods.map(method => ({ 25 |       id: method.id, 26 |       name: method.name, 27 |       type: method.type || 'custom', 28 |       description: method.description || '', 29 |       icon: method.icon || 'https: 30 |       requiresConfirmation: method.requiresConfirmation || false, 31 |       autoAssignPackage: method.autoAssignPackage || true, 32 |       isActive: method.isActive || true 33 |     })); 34 |  35 |     return NextResponse.json({ 36 |       success: true, 37 |       data: transformedMethods 38 |     }); 39 |  40 |   } catch (error) { 41 |     return NextResponse.json({ 42 |       success: false, 43 |       error: 'Internal server error', 44 |       message: 'Failed to fetch payment methods', 45 |       details: error instanceof Error ? error.message : 'Unknown error' 46 |     }, { status: 500 }); 47 |   } finally { 48 |     await prisma.$disconnect(); 49 |   } 50 | }
============================================================END: frontend/app/api/client/payment-methods/route.ts============================================================


============================================================FILE: frontend/app/api/client/purchase/route.tsSIZE: 10.12 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { prisma } from '@/lib/prisma';  4 | import { z } from 'zod';  5 | import { createEmailService } from '@/lib/brevo-email-service';  6 |   7 | const createPurchaseSchema = z.object({  8 |   packagePriceId: z.number().int('Invalid package price ID'),  9 |   paymentMethodId: z.number().int('Invalid payment method ID'), 10 |   quantity: z.number().int().min(1, 'Quantity must be at least 1').default(1), 11 |   notes: z.string().optional(), 12 |   paymentToken: z.string().optional() 13 | }); 14 |  15 | export async function GET() { 16 |  17 |   return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 18 | } 19 |  20 | export async function POST(request: NextRequest) { 21 |   try { 22 |     const user = await requireAuth(request); 23 |     if (!user) { 24 |       return NextResponse.json({ 25 |         success: false, 26 |         error: 'Unauthorized', 27 |         message: 'Authentication required' 28 |       }, { status: 401 }); 29 |     } 30 |  31 |     const body = await request.json(); 32 |     const validation = createPurchaseSchema.safeParse(body); 33 |  34 |     if (!validation.success) { 35 |       return NextResponse.json({ 36 |         success: false, 37 |         error: 'Validation failed', 38 |         message: 'Invalid purchase data', 39 |         details: validation.error.issues 40 |       }, { status: 400 }); 41 |     } 42 |  43 |     const { packagePriceId, paymentMethodId, quantity, notes, paymentToken } = validation.data; 44 |  45 |     const packagePrice = await prisma.packagePrice.findUnique({ 46 |       where: { id: packagePriceId }, 47 |       include: { 48 |         packageDefinition: { 49 |           select: { 50 |             id: true, 51 |             name: true, 52 |             description: true, 53 |             sessionsCount: true, 54 |             isActive: true 55 |           } 56 |         }, 57 |         currency: { 58 |           select: { 59 |             id: true, 60 |             code: true, 61 |             symbol: true, 62 |             name: true 63 |           } 64 |         } 65 |       } 66 |     }); 67 |  68 |     if (!packagePrice) { 69 |       return NextResponse.json({ 70 |         success: false, 71 |         error: 'Package not found', 72 |         message: 'The specified package price does not exist' 73 |       }, { status: 404 }); 74 |     } 75 |  76 |     if (!packagePrice.packageDefinition.isActive) { 77 |       return NextResponse.json({ 78 |         success: false, 79 |         error: 'Package inactive', 80 |         message: 'This package is currently not available for purchase' 81 |       }, { status: 400 }); 82 |     } 83 |  84 |     const paymentMethod = await prisma.paymentMethodConfig.findUnique({ 85 |       where: { id: paymentMethodId }, 86 |       select: { 87 |         id: true, 88 |         type: true, 89 |         name: true, 90 |         description: true, 91 |         icon: true, 92 |         isActive: true, 93 |         requiresConfirmation: true, 94 |         autoAssignPackage: true, 95 |         providerConfig: true 96 |       } 97 |     }); 98 |  99 |     if (!paymentMethod || !paymentMethod.isActive) {100 |       return NextResponse.json({101 |         success: false,102 |         error: 'Payment method not found',103 |         message: 'The specified payment method is not available'104 |       }, { status: 404 });105 |     }106 | 107 |     const totalAmount = Number(packagePrice.price) * quantity;108 | 109 |     const purchase = await prisma.purchase.create({110 |       data: {111 |         userId: user.id,112 |         totalAmount: totalAmount,113 |         currencyCode: packagePrice.currency.code,114 |         paymentMethod: paymentMethod.name,115 |         paymentStatus: 'pending',116 |         notes: notes117 |       }118 |     });119 | 120 |     if (paymentMethod.type === 'izipay' && paymentToken) {121 |       try {122 |         const izipayConfig = (paymentMethod.providerConfig as Record<string, unknown>)?.izipayConfig;123 | 124 |         if (!izipayConfig || !(izipayConfig as Record<string, unknown>).username || !(izipayConfig as Record<string, unknown>).password) {125 |           throw new Error('Izipay configuration is incomplete');126 |         }127 | 128 |         const credentials = Buffer.from(`${(izipayConfig as Record<string, unknown>).username}:${(izipayConfig as Record<string, unknown>).password}`).toString('base64');129 | 130 |         const izipayPayload = {131 |           amount: Math.round(totalAmount * 100),132 |           currency: packagePrice.currency.code,133 |           paymentToken: paymentToken,134 |           customer: {135 |             email: user.email,136 |             name: user.email,137 |           },138 |           orderId: purchase.id.toString(),139 |           metadata: {140 |             packageName: packagePrice.packageDefinition.name,141 |             quantity: quantity.toString(),142 |             userId: user.id.toString()143 |           }144 |         };145 | 146 |         const izipayResponse = await fetch('https:147 |           method: 'POST',148 |           headers: {149 |             'Authorization': `Basic ${credentials}`,150 |             'Content-Type': 'application/json',151 |             'Accept': 'application/json'152 |           },153 |           body: JSON.stringify(izipayPayload)154 |         });155 | 156 |         const izipayResult = await izipayResponse.json();157 |         if (izipayResponse.ok && izipayResult.status === 'SUCCESS') {158 | 159 |           await prisma.purchase.update({160 |             where: { id: purchase.id },161 |             data: {162 |               paymentStatus: 'completed',163 |               transactionId: izipayResult.transactionId || paymentToken,164 |               purchasedAt: new Date()165 |             }166 |           });167 | 168 |           } else {169 | 170 |           await prisma.purchase.update({171 |             where: { id: purchase.id },172 |             data: {173 |               paymentStatus: 'failed',174 |               notes: `Payment failed: ${izipayResult.errorMessage || 'Unknown error'}`175 |             }176 |           });177 | 178 |           throw new Error(izipayResult.errorMessage || 'Payment processing failed');179 |         }180 |       } catch (error: unknown) {181 | 182 |         await prisma.purchase.update({183 |           where: { id: purchase.id },184 |           data: {185 |             paymentStatus: 'failed',186 |             notes: `Payment error: ${error instanceof Error ? error.message : 'Unknown error'}`187 |           }188 |         });189 | 190 |         return NextResponse.json({191 |           success: false,192 |           error: 'Payment failed',193 |           message: error instanceof Error ? error.message : 'Payment processing failed'194 |         }, { status: 400 });195 |       }196 |     }197 | 198 |     let userPackage = null;199 |     if (paymentMethod.autoAssignPackage) {200 |       userPackage = await prisma.userPackage.create({201 |         data: {202 |           userId: user.id,203 |           purchaseId: purchase.id,204 |           packagePriceId: packagePriceId,205 |           quantity: quantity,206 |           sessionsUsed: 0,207 |           isActive: true,208 |           expiresAt: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000)209 |         },210 |         include: {211 |           packagePrice: {212 |             include: {213 |               packageDefinition: true214 |             }215 |           }216 |         }217 |       });218 |       }219 | 220 |     try {221 |       const emailService = await createEmailService();222 |       if (emailService) {223 |         const replacements = {224 |           client_name: user.email,225 |           package_name: packagePrice.packageDefinition.name,226 |           quantity: quantity.toString(),227 |           total_amount: `${packagePrice.currency.symbol}${totalAmount.toFixed(2)}`,228 |           payment_method: paymentMethod.name,229 |           purchase_date: new Date().toLocaleDateString(),230 |           sessions_count: packagePrice.packageDefinition.sessionsCount.toString()231 |         };232 | 233 |         await emailService.sendTemplateEmail(234 |           user.email,235 |           'purchase_confirmation',236 |           'Purchase Confirmation - SoulPath',237 |           replacements238 |         );239 |         }240 |     } catch (emailError) {241 | 242 |     }243 | 244 |     return NextResponse.json({245 |       success: true,246 |       data: {247 |         purchase: {248 |           id: purchase.id,249 |           totalAmount: purchase.totalAmount,250 |           currencyCode: purchase.currencyCode,251 |           paymentMethod: purchase.paymentMethod,252 |           paymentStatus: purchase.paymentStatus,253 |           notes: purchase.notes,254 |           purchasedAt: purchase.purchasedAt,255 |           package: {256 |             name: packagePrice.packageDefinition.name,257 |             description: packagePrice.packageDefinition.description,258 |             sessionsCount: packagePrice.packageDefinition.sessionsCount259 |           },260 |           paymentMethodDetails: {261 |             name: paymentMethod.name,262 |             type: paymentMethod.type263 |           },264 |           currency: {265 |             symbol: packagePrice.currency.symbol,266 |             code: packagePrice.currency.code267 |           }268 |         },269 |         userPackage: userPackage ? {270 |           id: userPackage.id,271 |           sessionsUsed: userPackage.sessionsUsed,272 |           isActive: userPackage.isActive,273 |           quantity: userPackage.quantity274 |         } : null275 |       },276 |       message: 'Purchase created successfully'277 |     });278 | 279 |   } catch (error) {280 |     return NextResponse.json({281 |       success: false,282 |       error: 'Internal server error',283 |       message: 'Failed to process purchase'284 |     }, { status: 500 });285 |   } finally {286 |     await prisma.$disconnect();287 |   }288 | }
============================================================END: frontend/app/api/client/purchase/route.ts============================================================


============================================================FILE: frontend/app/api/client/purchase-history/route.tsSIZE: 2.93 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | interface PurchaseWithDetails {  6 |   id: string;  7 |   created_at: string;  8 |   amount: number;  9 |   status: string; 10 |   transaction_id?: string; 11 |   package_definitions?: Array<{ 12 |     id: string; 13 |     name: string; 14 |     description?: string; 15 |     sessions_count?: number; 16 |   }>; 17 |   payment_methods?: Array<{ 18 |     id: string; 19 |     name: string; 20 |     description?: string; 21 |   }>; 22 |   currencies?: Array<{ 23 |     symbol: string; 24 |     code: string; 25 |     name?: string; 26 |   }>; 27 | } 28 |  29 | export async function GET(request: NextRequest) { 30 |   try { 31 |     const supabase = createClient( 32 |       process.env.NEXT_PUBLIC_SUPABASE_URL!, 33 |       process.env.SUPABASE_SERVICE_ROLE_KEY! 34 |     ); 35 |     const user = await requireAuth(request); 36 |  37 |     if (!user) { 38 |       return NextResponse.json( 39 |         { success: false, error: 'Unauthorized' }, 40 |         { status: 401 } 41 |       ); 42 |     } 43 |  44 |     const { data: customer, error: customerError } = await supabase 45 |       .from('customers') 46 |       .select('id, email') 47 |       .eq('email', user.email) 48 |       .single(); 49 |  50 |     if (customerError || !customer) { 51 |       return NextResponse.json( 52 |         { success: false, error: 'Customer not found' }, 53 |         { status: 404 } 54 |       ); 55 |     } 56 |  57 |     const { data: purchases, error: purchasesError } = await supabase 58 |       .from('purchases') 59 |       .select(` 60 |         id, 61 |         created_at, 62 |         amount, 63 |         status, 64 |         transaction_id, 65 |         payment_methods ( 66 |           id, 67 |           name, 68 |           description 69 |         ), 70 |         package_definitions ( 71 |           id, 72 |           name, 73 |           description, 74 |           sessions_count 75 |         ), 76 |         currencies ( 77 |           symbol, 78 |           code, 79 |           name 80 |         ) 81 |       `) 82 |       .eq('customer_id', customer.id) 83 |       .order('created_at', { ascending: false }) 84 |       .returns<PurchaseWithDetails[]>(); 85 |  86 |     if (purchasesError) { 87 |       return NextResponse.json( 88 |         { success: false, error: 'Failed to fetch purchase history' }, 89 |         { status: 500 } 90 |       ); 91 |     } 92 |  93 |     const transformedPurchases = (purchases as PurchaseWithDetails[])?.map((purchase: PurchaseWithDetails) => ({ 94 |       id: purchase.id, 95 |       date: purchase.created_at, 96 |       packageName: purchase.package_definitions?.[0]?.name || 'Unknown Package', 97 |       amount: purchase.amount, 98 |       status: purchase.status, 99 |       paymentMethod: purchase.payment_methods?.[0]?.name || 'Unknown'100 |     })) || [];101 | 102 |     return NextResponse.json({103 |       success: true,104 |       data: transformedPurchases105 |     });106 | 107 |   } catch (error) {108 |     return NextResponse.json(109 |       { success: false, error: 'Internal server error' },110 |       { status: 500 }111 |     );112 |   }113 | }
============================================================END: frontend/app/api/client/purchase-history/route.ts============================================================


============================================================FILE: frontend/app/api/client/schedule-slots/route.tsSIZE: 4.48 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { requireAuth } from '@/lib/auth';  3 | import { z } from 'zod';  4 | import { prisma } from '@/lib/prisma';  5 |   6 | const querySchema = z.object({  7 |   dateFrom: z.string().datetime().optional(),  8 |   dateTo: z.string().datetime().optional(),  9 |   isAvailable: z.enum(['true', 'false']).optional(), 10 |   page: z.coerce.number().int().min(1).default(1), 11 |   limit: z.coerce.number().int().min(1).max(50).default(20) 12 | }); 13 |  14 | export async function GET(request: NextRequest) { 15 |   try { 16 |     const user = await requireAuth(request); 17 |     if (!user) { 18 |       return NextResponse.json({ 19 |         success: false, 20 |         error: 'Unauthorized', 21 |         message: 'Authentication required' 22 |       }, { status: 401 }); 23 |     } 24 |  25 |     const { searchParams } = new URL(request.url); 26 |     const queryParams = Object.fromEntries(searchParams.entries()); 27 |     const validation = querySchema.safeParse(queryParams); 28 |  29 |     if (!validation.success) { 30 |       return NextResponse.json({ 31 |         success: false, 32 |         error: 'Invalid query parameters', 33 |         details: validation.error.issues 34 |       }, { status: 400 }); 35 |     } 36 |  37 |     const { dateFrom, dateTo, isAvailable, page, limit } = validation.data; 38 |     const offset = (page - 1) * limit; 39 |  40 |     const where: Record<string, unknown> = { 41 |       isAvailable: true 42 |     }; 43 |  44 |     if (dateFrom) { 45 |       where.startTime = { gte: new Date(dateFrom) }; 46 |     } 47 |     if (dateTo) { 48 |       where.startTime = { 49 |         ...(where.startTime || {}), 50 |         lte: new Date(dateTo) 51 |       }; 52 |     } 53 |     if (isAvailable !== undefined) { 54 |       where.isAvailable = isAvailable === 'true'; 55 |     } 56 |  57 |     where.startTime = { 58 |       ...(where.startTime || {}), 59 |       gte: new Date() 60 |     }; 61 |  62 |     const [scheduleSlots, totalCount] = await Promise.all([ 63 |       prisma.scheduleSlot.findMany({ 64 |         where, 65 |         select: { 66 |           id: true, 67 |           startTime: true, 68 |           endTime: true, 69 |           capacity: true, 70 |           bookedCount: true, 71 |           isAvailable: true, 72 |           scheduleTemplate: { 73 |             select: { 74 |               id: true, 75 |               dayOfWeek: true, 76 |               startTime: true, 77 |               endTime: true, 78 |               capacity: true, 79 |               sessionDuration: { 80 |                 select: { 81 |                   id: true, 82 |                   name: true, 83 |                   duration_minutes: true 84 |                 } 85 |               } 86 |             } 87 |           }, 88 |           _count: { 89 |             select: { 90 |               bookings: true 91 |             } 92 |           } 93 |         }, 94 |         skip: offset, 95 |         take: limit, 96 |         orderBy: { startTime: 'asc' } 97 |       }), 98 |       prisma.scheduleSlot.count({ where }) 99 |     ]);100 | 101 |     const transformedSlots = scheduleSlots.map(slot => ({102 |       id: slot.id.toString(),103 |       date: slot.startTime.toISOString().split('T')[0],104 |       time: slot.startTime.toTimeString().split(' ')[0].substring(0, 5),105 |       isAvailable: slot.isAvailable && (slot.bookedCount || 0) < (slot.capacity || 1),106 |       capacity: slot.capacity || 1,107 |       bookedCount: slot.bookedCount || 0,108 |       sessionType: slot.scheduleTemplate.sessionDuration?.name || 'Session',109 |       price: 0,110 |       duration: slot.scheduleTemplate.sessionDuration?.duration_minutes || 60,111 |       startTime: slot.startTime.toISOString(),112 |       endTime: slot.endTime.toISOString()113 |     }));114 | 115 |     const totalPages = Math.ceil(totalCount / limit);116 | 117 |     return NextResponse.json({118 |       success: true,119 |       data: transformedSlots,120 |       pagination: {121 |         page,122 |         limit,123 |         total: totalCount,124 |         totalPages125 |       }126 |     });127 | 128 |   } catch (error) {129 |     return NextResponse.json({130 |       success: false,131 |       error: 'Internal server error',132 |       message: 'Failed to fetch schedule slots',133 |       details: error instanceof Error ? error.message : 'Unknown error'134 |     }, { status: 500 });135 |   } finally {136 |     await prisma.$disconnect();137 |   }138 | }
============================================================END: frontend/app/api/client/schedule-slots/route.ts============================================================


============================================================FILE: frontend/app/api/content/route.tsSIZE: 17.12 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import { withCache } from '@/lib/cache';  4 |   5 | export const revalidate = 3600;  6 |   7 | interface NestedContent {  8 |   [key: string]: string | NestedContent | Array<{ title: string; text: string }>;  9 | } 10 |  11 | interface TransformedContent { 12 |   en: NestedContent; 13 |   es: NestedContent; 14 | } 15 |  16 | function transformFlatContentToNested(flatContent: Record<string, string>): TransformedContent { 17 |   const nestedContent: TransformedContent = { 18 |     en: {} as NestedContent, 19 |     es: {} as NestedContent 20 |   }; 21 |  22 |   if (flatContent) { 23 |  24 |     nestedContent.en.hero = { 25 |       title: flatContent.heroTitleEn || 'MatMax Yoga Studio', 26 |       tagline: 'Transform your life through spiritual guidance and healing', 27 |       description: 'Experience profound transformation through personalized spiritual sessions, energy healing, and guidance on your journey to inner peace and self-discovery.', 28 |       ctaPrimary: 'Book Your Session', 29 |       ctaSecondary: 'Learn More', 30 |       subtitle: flatContent.heroSubtitleEn || 'Your journey to wellness starts here' 31 |     }; 32 |     nestedContent.es.hero = { 33 |       title: flatContent.heroTitleEs || 'MatMax Yoga Studio', 34 |       tagline: 'Transforma tu vida a través de la guía espiritual y la sanación', 35 |       description: 'Experimenta una transformación profunda a través de sesiones espirituales personalizadas, sanación energética y guía en tu camino hacia la paz interior y el autodescubrimiento.', 36 |       ctaPrimary: 'Reserva tu Sesión', 37 |       ctaSecondary: 'Conoce Más', 38 |       subtitle: flatContent.heroSubtitleEs || 'Tu camino al bienestar comienza aquí' 39 |     }; 40 |  41 |     nestedContent.en.about = { 42 |       title: flatContent.aboutTitleEn || 'About MatMax Yoga Studio', 43 |       text: flatContent.aboutContentEn || 'MatMax Yoga Studio is dedicated to helping people build strength, flexibility, and inner peace through mindful movement and breath. Our classes support wellbeing and balance for all levels.', 44 |       description: flatContent.aboutContentEn || 'MatMax Yoga Studio is dedicated to helping people build strength, flexibility, and inner peace through mindful movement and breath. Our classes support wellbeing and balance for all levels.', 45 |       statsClients: 'Clients Helped', 46 |       statsYears: 'Years Experience', 47 |       statsSessions: 'Sessions Completed', 48 |       statsCountries: 'Countries Served', 49 |       valuesTitle: 'Our Core Values', 50 |       value1Title: 'Compassion', 51 |       value1Description: 'We approach every client with deep empathy and understanding, creating a safe space for healing and growth.', 52 |       value2Title: 'Authenticity', 53 |       value2Description: 'Our guidance comes from genuine spiritual wisdom and personal experience, not from textbooks or theories.', 54 |       value3Title: 'Transformation', 55 |       value3Description: 'We believe in the power of real change and are committed to helping you achieve lasting transformation.', 56 |       storyTitle: 'Jose\'s Story', 57 |       storyText: 'My journey began over 15 years ago when I experienced a profound spiritual awakening that changed my life forever. Since then, I\'ve dedicated myself to helping others find their own path to spiritual growth and personal transformation. Through years of study, practice, and working with clients from around the world, I\'ve developed a unique approach that combines traditional spiritual wisdom with modern understanding of human psychology and energy work.' 58 |     }; 59 |     nestedContent.es.about = { 60 |       title: flatContent.aboutTitleEs || 'Acerca de MatMax Yoga Studio', 61 |       text: flatContent.aboutContentEs || 'MatMax Yoga Studio está dedicado a ayudarte a construir fuerza, flexibilidad y paz interior a través del movimiento consciente y la respiración. Nuestras clases apoyan el bienestar y el equilibrio para todos los niveles.', 62 |       description: flatContent.aboutContentEs || 'MatMax Yoga Studio está dedicado a ayudarte a construir fuerza, flexibilidad y paz interior a través del movimiento consciente y la respiración. Nuestras clases apoyan el bienestar y el equilibrio para todos los niveles.', 63 |       statsClients: 'Clientes Ayudados', 64 |       statsYears: 'Años de Experiencia', 65 |       statsSessions: 'Sesiones Completadas', 66 |       statsCountries: 'Países Atendidos', 67 |       valuesTitle: 'Nuestros Valores Fundamentales', 68 |       value1Title: 'Compasión', 69 |       value1Description: 'Nos acercamos a cada cliente con profunda empatía y comprensión, creando un espacio seguro para la sanación y el crecimiento.', 70 |       value2Title: 'Autenticidad', 71 |       value2Description: 'Nuestra guía proviene de la sabiduría espiritual genuina y la experiencia personal, no de libros de texto o teorías.', 72 |       value3Title: 'Transformación', 73 |       value3Description: 'Creemos en el poder del cambio real y estamos comprometidos a ayudarte a lograr una transformación duradera.', 74 |       storyTitle: 'La Historia de José', 75 |       storyText: 'Mi viaje comenzó hace más de 15 años cuando experimenté un despertar espiritual profundo que cambió mi vida para siempre. Desde entonces, me he dedicado a ayudar a otros a encontrar su propio camino hacia el crecimiento espiritual y la transformación personal. A través de años de estudio, práctica y trabajo con clientes de todo el mundo, he desarrollado un enfoque único que combina la sabiduría espiritual tradicional con la comprensión moderna de la psicología humana y el trabajo energético.' 76 |     }; 77 |  78 |     nestedContent.en.approach = { 79 |       title: flatContent.approachTitleEn || 'Our Approach', 80 |       content: flatContent.approachContentEn || 'We use a holistic approach to wellness.', 81 |       items: [ 82 |         { 83 |           title: 'Heart-Centered Healing', 84 |           text: 'Connect with your emotional core and release past traumas through compassionate guidance and energy work.' 85 |         }, 86 |         { 87 |           title: 'Mindful Transformation', 88 |           text: 'Develop mental clarity and break free from limiting beliefs that hold you back from your true potential.' 89 |         }, 90 |         { 91 |           title: 'Spiritual Awakening', 92 |           text: 'Discover your spiritual path and deepen your connection to the divine through meditation and spiritual practices.' 93 |         } 94 |       ] as Array<{ title: string; text: string }> 95 |     }; 96 |     nestedContent.es.approach = { 97 |       title: flatContent.approachTitleEs || 'Nuestro Enfoque', 98 |       content: flatContent.approachContentEs || 'Usamos un enfoque holístico para el bienestar.', 99 |       items: [100 |         {101 |           title: 'Sanación Centrada en el Corazón',102 |           text: 'Conecta con tu núcleo emocional y libera traumas pasados a través de guía compasiva y trabajo energético.'103 |         },104 |         {105 |           title: 'Transformación Consciente',106 |           text: 'Desarrolla claridad mental y libérate de creencias limitantes que te impiden alcanzar tu verdadero potencial.'107 |         },108 |         {109 |           title: 'Despertar Espiritual',110 |           text: 'Descubre tu camino espiritual y profundiza tu conexión con lo divino a través de la meditación y prácticas espirituales.'111 |         }112 |       ] as Array<{ title: string; text: string }>113 |     };114 | 115 |     nestedContent.en.services = {116 |       title: flatContent.servicesTitleEn || 'Our Services',117 |       content: flatContent.servicesContentEn || 'Professional wellness services in a peaceful environment.'118 |     };119 |     nestedContent.es.services = {120 |       title: flatContent.servicesTitleEs || 'Nuestros Servicios',121 |       content: flatContent.servicesContentEs || 'Servicios profesionales de bienestar en un ambiente pacífico.'122 |     };123 | 124 |     nestedContent.en.nav = {125 |       invitation: 'Invitation',126 |       approach: 'Approach',127 |       session: 'Session',128 |       about: 'About',129 |       apply: 'Apply'130 |     };131 |     nestedContent.es.nav = {132 |       invitation: 'Invitación',133 |       approach: 'Enfoque',134 |       session: 'Sesión',135 |       about: 'Acerca de',136 |       apply: 'Aplicar'137 |     };138 | 139 |     nestedContent.en.cta = {140 |       bookReading: 'Book Your Reading'141 |     };142 |     nestedContent.es.cta = {143 |       bookReading: 'Reserva Tu Lectura'144 |     };145 |   }146 | 147 |   return nestedContent;148 | }149 | 150 | export async function GET() {151 |   try {152 | 153 |     const transformedContent = await withCache(154 |       'content',155 |       async () => {156 |         try {157 | 158 |           const content = await prisma.content.findFirst();159 | 160 |           if (!content) {161 |             try {162 |               const defaultContent = await prisma.content.create({163 |                 data: {164 |                   heroTitleEn: 'MatMax Yoga Studio',165 |                   heroTitleEs: 'MatMax Yoga Studio',166 |                   heroSubtitleEn: 'Your journey to wellness starts here',167 |                   heroSubtitleEs: 'Tu camino al bienestar comienza aquí',168 |                   aboutTitleEn: 'About Us',169 |                   aboutTitleEs: 'Sobre Nosotros',170 |                   aboutContentEn: 'We are dedicated to helping you achieve your wellness goals.',171 |                   aboutContentEs: 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.',172 |                   approachTitleEn: 'Our Approach',173 |                   approachTitleEs: 'Nuestro Enfoque',174 |                   approachContentEn: 'We use a holistic approach to wellness.',175 |                   approachContentEs: 'Usamos un enfoque holístico para el bienestar.',176 |                   servicesTitleEn: 'Our Services',177 |                   servicesTitleEs: 'Nuestros Servicios',178 |                   servicesContentEn: 'Professional wellness services in a peaceful environment.',179 |                   servicesContentEs: 'Servicios profesionales de bienestar en un ambiente pacífico.'180 |                 }181 |               });182 |               return transformFlatContentToNested(defaultContent as unknown as Record<string, string>);183 |             } catch (createError) {184 |               const defaultContent: Record<string, string> = {185 |                 heroTitleEn: 'MatMax Yoga Studio',186 |                 heroTitleEs: 'MatMax Yoga Studio',187 |                 heroSubtitleEn: 'Your journey to wellness starts here',188 |                 heroSubtitleEs: 'Tu camino al bienestar comienza aquí',189 |                 aboutTitleEn: 'About Us',190 |                 aboutTitleEs: 'Sobre Nosotros',191 |                 aboutContentEn: 'We are dedicated to helping you achieve your wellness goals.',192 |                 aboutContentEs: 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.',193 |                 approachTitleEn: 'Our Approach',194 |                 approachTitleEs: 'Nuestro Enfoque',195 |                 approachContentEn: 'We use a holistic approach to wellness.',196 |                 approachContentEs: 'Usamos un enfoque holístico para el bienestar.',197 |                 servicesTitleEn: 'Our Services',198 |                 servicesTitleEs: 'Nuestros Servicios',199 |                 servicesContentEn: 'Professional wellness services in a peaceful environment.',200 |                 servicesContentEs: 'Servicios profesionales de bienestar en un ambiente pacífico.'201 |               };202 |               return transformFlatContentToNested(defaultContent);203 |             }204 |           }205 | 206 |           return transformFlatContentToNested(content as unknown as Record<string, string>);207 |         } catch {208 |           const defaultContent: Record<string, string> = {209 |             heroTitleEn: 'MatMax Yoga Studio',210 |             heroTitleEs: 'MatMax Yoga Studio',211 |             heroSubtitleEn: 'Your journey to wellness starts here',212 |             heroSubtitleEs: 'Tu camino al bienestar comienza aquí',213 |             aboutTitleEn: 'About Us',214 |             aboutTitleEs: 'Sobre Nosotros',215 |             aboutContentEn: 'We are dedicated to helping you achieve your wellness goals.',216 |             aboutContentEs: 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.',217 |             approachTitleEn: 'Our Approach',218 |             approachTitleEs: 'Nuestro Enfoque',219 |             approachContentEn: 'We use a holistic approach to wellness.',220 |             approachContentEs: 'Usamos un enfoque holístico para el bienestar.',221 |             servicesTitleEn: 'Our Services',222 |             servicesTitleEs: 'Nuestros Servicios',223 |             servicesContentEn: 'Professional wellness services in a peaceful environment.',224 |             servicesContentEs: 'Servicios profesionales de bienestar en un ambiente pacífico.'225 |           };226 |           return transformFlatContentToNested(defaultContent);227 |         }228 |       },229 |       15 * 60 * 1000230 |     );231 | 232 |     return NextResponse.json({ content: transformedContent });233 |   } catch (error) {234 |     :', error);235 | 236 |     const defaultContent: Record<string, string> = {237 |       heroTitleEn: 'MatMax Yoga Studio',238 |       heroTitleEs: 'MatMax Yoga Studio',239 |       heroSubtitleEn: 'Your journey to wellness starts here',240 |       heroSubtitleEs: 'Tu camino al bienestar comienza aquí',241 |       aboutTitleEn: 'About Us',242 |       aboutTitleEs: 'Sobre Nosotros',243 |       aboutContentEn: 'We are dedicated to helping you achieve your wellness goals.',244 |       aboutContentEs: 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.',245 |       approachTitleEn: 'Our Approach',246 |       approachTitleEs: 'Nuestro Enfoque',247 |       approachContentEn: 'We use a holistic approach to wellness.',248 |       approachContentEs: 'Usamos un enfoque holístico para el bienestar.',249 |       servicesTitleEn: 'Our Services',250 |       servicesTitleEs: 'Nuestros Servicios',251 |       servicesContentEn: 'Professional wellness services in a peaceful environment.',252 |       servicesContentEs: 'Servicios profesionales de bienestar en un ambiente pacífico.'253 |     };254 |     const transformedContent = transformFlatContentToNested(defaultContent);255 |     return NextResponse.json({ content: transformedContent });256 |   }257 | }258 | 259 | export async function PUT(request: NextRequest) {260 |   try {261 |     const body = await request.json();262 | 263 |     let content = await prisma.content.findFirst();264 | 265 |     if (!content) {266 | 267 |       content = await prisma.content.create({268 |         data: {269 |           heroTitleEn: body.heroTitleEn || 'Welcome to SOULPATH',270 |           heroTitleEs: body.heroTitleEs || 'Bienvenido a SOULPATH',271 |           heroSubtitleEn: body.heroSubtitleEn || 'Your journey to wellness starts here',272 |           heroSubtitleEs: body.heroSubtitleEs || 'Tu camino al bienestar comienza aquí',273 |           aboutTitleEn: body.aboutTitleEn || 'About Us',274 |           aboutTitleEs: body.aboutTitleEs || 'Sobre Nosotros',275 |           aboutContentEn: body.aboutContentEn || 'We are dedicated to helping you achieve your wellness goals.',276 |           aboutContentEs: body.aboutContentEs || 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.',277 |           approachTitleEn: body.approachTitleEn || 'Our Approach',278 |           approachTitleEs: body.approachTitleEs || 'Nuestro Enfoque',279 |           approachContentEn: body.approachContentEn || 'We use a holistic approach to wellness.',280 |           approachContentEs: body.approachContentEs || 'Usamos un enfoque holístico para el bienestar.',281 |           servicesTitleEn: body.servicesTitleEn || 'Our Services',282 |           servicesTitleEs: body.servicesTitleEs || 'Nuestros Servicios',283 |           servicesContentEn: body.servicesContentEn || 'Professional wellness services in a peaceful environment.',284 |           servicesContentEs: body.servicesContentEs || 'Servicios profesionales de bienestar en un ambiente pacífico.'285 |         }286 |       });287 |     } else {288 | 289 |       content = await prisma.content.update({290 |         where: { id: content.id },291 |         data: {292 |           heroTitleEn: body.heroTitleEn,293 |           heroTitleEs: body.heroTitleEs,294 |           heroSubtitleEn: body.heroSubtitleEn,295 |           heroSubtitleEs: body.heroSubtitleEs,296 |           aboutTitleEn: body.aboutTitleEn,297 |           aboutTitleEs: body.aboutTitleEs,298 |           aboutContentEn: body.aboutContentEn,299 |           aboutContentEs: body.aboutContentEs,300 |           approachTitleEn: body.approachTitleEn,301 |           approachTitleEs: body.approachTitleEs,302 |           approachContentEn: body.approachContentEn,303 |           approachContentEs: body.approachContentEs,304 |           servicesTitleEn: body.servicesTitleEn,305 |           servicesTitleEs: body.servicesTitleEs,306 |           servicesContentEn: body.servicesContentEn,307 |           servicesContentEs: body.servicesContentEs308 |         }309 |       });310 |     }311 | 312 |     const transformedContent = transformFlatContentToNested(content as unknown as Record<string, string>);313 |     return NextResponse.json({ content: transformedContent });314 |   } catch (error) {315 |     return NextResponse.json({ error: 'Failed to update content' }, { status: 500 });316 |   }317 | }
============================================================END: frontend/app/api/content/route.ts============================================================


============================================================FILE: frontend/app/api/debug/schedule-slots/route.tsSIZE: 1.88 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET() {  5 |   try {  6 |   7 |     const connectionTest = await prisma.$queryRaw`SELECT 1 as test`;  8 |   9 |     const simpleQuery = await prisma.scheduleSlot.findMany({ 10 |       take: 1, 11 |       select: { 12 |         id: true, 13 |         startTime: true, 14 |         endTime: true, 15 |         capacity: true, 16 |         bookedCount: true, 17 |         isAvailable: true 18 |       } 19 |     }); 20 |  21 |     const complexQuery = await prisma.scheduleSlot.findMany({ 22 |       take: 1, 23 |       select: { 24 |         id: true, 25 |         startTime: true, 26 |         endTime: true, 27 |         capacity: true, 28 |         bookedCount: true, 29 |         isAvailable: true, 30 |         scheduleTemplate: { 31 |           select: { 32 |             id: true, 33 |             dayOfWeek: true, 34 |             sessionDuration: { 35 |               select: { 36 |                 id: true, 37 |                 name: true, 38 |                 duration_minutes: true 39 |               } 40 |             } 41 |           } 42 |         } 43 |       } 44 |     }); 45 |     return NextResponse.json({ 46 |       success: true, 47 |       message: 'Debug test successful', 48 |       data: { 49 |         connectionTest, 50 |         simpleQuery, 51 |         complexQuery 52 |       } 53 |     }); 54 |  55 |   } catch (error) { 56 |     return NextResponse.json({ 57 |       success: false, 58 |       error: 'Debug test failed', 59 |       details: error instanceof Error ? error.message : 'Unknown error', 60 |       stack: error instanceof Error ? error.stack : undefined 61 |     }, { status: 500 }); 62 |   } 63 | }
============================================================END: frontend/app/api/debug/schedule-slots/route.ts============================================================


============================================================FILE: frontend/app/api/feedback/route.tsSIZE: 3.69 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function POST(request: NextRequest) {  5 |   try {  6 |     const { conversationLogId, sessionId, rating, comment } = await request.json();  7 |   8 |     if (!conversationLogId || !sessionId || !rating) {  9 |       return NextResponse.json( 10 |         { error: 'Missing required fields: conversationLogId, sessionId, rating' }, 11 |         { status: 400 } 12 |       ); 13 |     } 14 |  15 |     if (rating !== 1 && rating !== 2) { 16 |       return NextResponse.json( 17 |         { error: 'Rating must be 1 (negative) or 2 (positive)' }, 18 |         { status: 400 } 19 |       ); 20 |     } 21 |  22 |     const conversationLog = await prisma.conversationLog.findUnique({ 23 |       where: { id: conversationLogId } 24 |     }); 25 |  26 |     if (!conversationLog) { 27 |       return NextResponse.json( 28 |         { error: 'Conversation log not found' }, 29 |         { status: 404 } 30 |       ); 31 |     } 32 |  33 |     const existingFeedback = await prisma.userFeedback.findFirst({ 34 |       where: { 35 |         conversationLogId: conversationLogId 36 |       } 37 |     }); 38 |  39 |     let feedback; 40 |     if (existingFeedback) { 41 |  42 |       feedback = await prisma.userFeedback.update({ 43 |         where: { id: existingFeedback.id }, 44 |         data: { 45 |           rating, 46 |           comment: comment || null, 47 |           reviewedForTraining: false 48 |         } 49 |       }); 50 |     } else { 51 |  52 |       feedback = await prisma.userFeedback.create({ 53 |         data: { 54 |           conversationLogId, 55 |           sessionId, 56 |           rating, 57 |           comment: comment || null, 58 |           reviewedForTraining: false 59 |         } 60 |       }); 61 |     } 62 |  63 |     return NextResponse.json({ 64 |       success: true, 65 |       message: 'Feedback submitted successfully', 66 |       feedbackId: feedback.id 67 |     }); 68 |  69 |   } catch (error) { 70 |     return NextResponse.json( 71 |       { 72 |         success: false, 73 |         error: 'Failed to submit feedback', 74 |         details: error instanceof Error ? error.message : 'Unknown error' 75 |       }, 76 |       { status: 500 } 77 |     ); 78 |   } finally { 79 |     await prisma.$disconnect(); 80 |   } 81 | } 82 |  83 | export async function GET(request: NextRequest) { 84 |   try { 85 |     const { searchParams } = new URL(request.url); 86 |     const sessionId = searchParams.get('session_id'); 87 |     const conversationLogId = searchParams.get('conversation_log_id'); 88 |  89 |     if (!sessionId && !conversationLogId) { 90 |       return NextResponse.json( 91 |         { error: 'Either sessionId or conversationLogId is required' }, 92 |         { status: 400 } 93 |       ); 94 |     } 95 |  96 |     const feedback = await prisma.userFeedback.findMany({ 97 |       where: { 98 |         ...(sessionId ? { sessionId } : {}), 99 |         ...(conversationLogId ? { conversationLogId: parseInt(conversationLogId) } : {})100 |       },101 |       include: {102 |         conversationLog: {103 |           select: {104 |             userMessage: true,105 |             botResponse: true,106 |             timestamp: true107 |           }108 |         }109 |       },110 |       orderBy: { createdAt: 'desc' }111 |     });112 | 113 |     return NextResponse.json({114 |       success: true,115 |       feedback: feedback.map(f => ({116 |         id: f.id,117 |         conversationLogId: f.conversationLogId,118 |         sessionId: f.sessionId,119 |         rating: f.rating,120 |         comment: f.comment,121 |         createdAt: f.createdAt,122 |         reviewedForTraining: f.reviewedForTraining,123 |         conversation: f.conversationLog124 |       }))125 |     });126 | 127 |   } catch (error) {128 |     return NextResponse.json(129 |       {130 |         success: false,131 |         error: 'Failed to fetch feedback',132 |         details: error instanceof Error ? error.message : 'Unknown error'133 |       },134 |       { status: 500 }135 |     );136 |   } finally {137 |     await prisma.$disconnect();138 |   }139 | }
============================================================END: frontend/app/api/feedback/route.ts============================================================


============================================================FILE: frontend/app/api/health/route.tsSIZE: 1.38 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET() {  5 |   try {  6 |   7 |     await prisma.$queryRaw`SELECT 1`;  8 |   9 |     let userCount = 0; 10 |     let bookingCount = 0; 11 |     let purchaseCount = 0; 12 |  13 |     try { 14 |       userCount = await prisma.user.count(); 15 |     } catch (error) { 16 |       } 17 |  18 |     try { 19 |       bookingCount = await prisma.booking.count(); 20 |     } catch (error) { 21 |       } 22 |  23 |     try { 24 |       purchaseCount = await prisma.purchase.count(); 25 |     } catch (error) { 26 |       } 27 |  28 |     return NextResponse.json({ 29 |       status: 'healthy', 30 |       timestamp: new Date().toISOString(), 31 |       database: 'connected', 32 |       stats: { 33 |         users: userCount, 34 |         bookings: bookingCount, 35 |         purchases: purchaseCount 36 |       }, 37 |       version: '2.0.0', 38 |       refactored: true 39 |     }); 40 |   } catch (error) { 41 |     return NextResponse.json({ 42 |       status: 'unhealthy', 43 |       timestamp: new Date().toISOString(), 44 |       database: 'disconnected', 45 |       error: error instanceof Error ? error.message : 'Unknown error' 46 |     }, { status: 500 }); 47 |   } finally { 48 |     await prisma.$disconnect(); 49 |   } 50 | }
============================================================END: frontend/app/api/health/route.ts============================================================


============================================================FILE: frontend/app/api/images/route.tsSIZE: 1.72 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 |   4 | const supabase = createClient(  5 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  6 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  7 | );  8 |   9 | const defaultImages = { 10 |   id: 1, 11 |   profileImage: '/assets/cf4f95a6cc4d03023c0e98479a93fe16d4ef06f2.png', 12 |   heroImage: null, 13 |   aboutImage: null, 14 |   createdAt: new Date().toISOString(), 15 |   updatedAt: new Date().toISOString() 16 | }; 17 |  18 | export async function GET() { 19 |   try { 20 |     const { data, error } = await supabase 21 |       .from('images') 22 |       .select('*') 23 |       .single(); 24 |  25 |     if (error) { 26 |  27 |       if (error.code === 'PGRST116') { 28 |         return NextResponse.json({ images: defaultImages }); 29 |       } 30 |  31 |       return NextResponse.json({ images: defaultImages }); 32 |     } 33 |  34 |     return NextResponse.json({ images: data }); 35 |   } catch (error) { 36 |     return NextResponse.json({ images: defaultImages }); 37 |   } 38 | } 39 |  40 | export async function POST(request: NextRequest) { 41 |   try { 42 |     const body = await request.json(); 43 |  44 |     const { data, error } = await supabase 45 |       .from('images') 46 |       .upsert(body, { onConflict: 'id' }) 47 |       .select() 48 |       .single(); 49 |  50 |     if (error) { 51 |       return NextResponse.json({ images: defaultImages }); 52 |     } 53 |  54 |     return NextResponse.json({ images: data }); 55 |   } catch (error) { 56 |     return NextResponse.json({ images: defaultImages }); 57 |   } 58 | }
============================================================END: frontend/app/api/images/route.ts============================================================


============================================================FILE: frontend/app/api/izipay/create-payment-intent/route.tsSIZE: 4.54 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { IzipayPaymentService } from '@/lib/izipay/payment-service';  3 | import { prisma } from '@/lib/prisma';  4 |   5 | export async function POST(request: NextRequest) {  6 |   try {  7 |     const body = await request.json();  8 |     const {  9 |       amount, 10 |       currency = 'PEN', 11 |       customerEmail, 12 |       customerName, 13 |       description, 14 |       packagePriceId, 15 |       quantity = 1, 16 |       metadata = {} 17 |     } = body; 18 |  19 |     if (!amount || !customerEmail) { 20 |       return NextResponse.json({ 21 |         success: false, 22 |         error: 'Missing required fields', 23 |         message: 'Amount and customer email are required' 24 |       }, { status: 400 }); 25 |     } 26 |  27 |     if (typeof amount !== 'number' || amount <= 0) { 28 |       return NextResponse.json({ 29 |         success: false, 30 |         error: 'Invalid amount', 31 |         message: 'Amount must be a positive number' 32 |       }, { status: 400 }); 33 |     } 34 |  35 |     const orderId = `WLN_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`; 36 |  37 |     let customer; 38 |     try { 39 |       customer = await prisma.user.findUnique({ 40 |         where: { email: customerEmail }, 41 |         select: { id: true, fullName: true, email: true } 42 |       }); 43 |     } catch { 44 |       } 45 |  46 |     const paymentParams = { 47 |       amount: amount, 48 |       currency: currency.toUpperCase(), 49 |       customerEmail: customerEmail, 50 |       customerName: customerName || customer?.fullName || 'Customer', 51 |       orderId: orderId, 52 |       description: description || 'Wellness Services Payment', 53 |       metadata: { 54 |         ...metadata, 55 |         packagePriceId: packagePriceId, 56 |         quantity: quantity, 57 |         customerEmail: customerEmail, 58 |       } 59 |     }; 60 |  61 |     let overrideConfig: Record<string, unknown> | null = null; 62 |     try { 63 |       const izipayMethod = await prisma.paymentMethodConfig.findFirst({ 64 |         where: { type: 'izipay', isActive: true }, 65 |         select: { providerConfig: true } 66 |       }); 67 |       overrideConfig = (izipayMethod?.providerConfig as Record<string, unknown>) || null; 68 |     } catch { 69 |       } 70 |  71 |     const paymentResult = await IzipayPaymentService.createPaymentIntent(paymentParams, overrideConfig || undefined); 72 |  73 |     if (!paymentResult.success) { 74 |       return NextResponse.json({ 75 |         success: false, 76 |         error: 'Payment processing failed', 77 |         message: paymentResult.error || 'Unable to create payment intent', 78 |         details: paymentResult.details 79 |       }, { status: 500 }); 80 |     } 81 |  82 |     try { 83 |       await prisma.purchase.create({ 84 |         data: { 85 |           userId: customer?.id || customerEmail, 86 |           totalAmount: amount, 87 |           currencyCode: currency.toUpperCase(), 88 |           paymentMethod: 'izipay', 89 |           paymentStatus: 'pending', 90 |           transactionId: paymentResult.transactionId, 91 |           notes: `Izipay payment - Order: ${orderId}`, 92 |         } 93 |       }); 94 |       } catch (dbError) { 95 |  96 |     } 97 |  98 |     return NextResponse.json({ 99 |       success: true,100 |       paymentUrl: paymentResult.paymentUrl,101 |       transactionId: paymentResult.transactionId,102 |       orderId: orderId,103 |       amount: amount,104 |       currency: currency.toUpperCase(),105 |       message: 'Payment intent created successfully'106 |     });107 | 108 |   } catch (error) {109 |     return NextResponse.json({110 |       success: false,111 |       error: 'Internal server error',112 |       message: 'Failed to create payment intent',113 |       details: error instanceof Error ? error.message : 'Unknown error'114 |     }, { status: 500 });115 |   }116 | }
============================================================END: frontend/app/api/izipay/create-payment-intent/route.ts============================================================


============================================================FILE: frontend/app/api/izipay/webhook/route.tsSIZE: 6.79 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import crypto from 'crypto';  4 |   5 | export async function GET() {  6 |   return NextResponse.json({  7 |     error: 'Method not allowed',  8 |     message: 'This endpoint only accepts POST requests'  9 |   }, { status: 405 }); 10 | } 11 |  12 | export async function POST(request: NextRequest) { 13 |   try { 14 |  15 |     const rawBody = await request.text(); 16 |  17 |     const krHash = request.headers.get('kr-hash'); 18 |     if (!krHash) { 19 |       return NextResponse.json({ 20 |         error: 'Unauthorized', 21 |         message: 'Missing signature header' 22 |       }, { status: 401 }); 23 |     } 24 |  25 |     const izipayPaymentMethod = await prisma.paymentMethodConfig.findFirst({ 26 |       where: { 27 |         type: 'izipay', 28 |         isActive: true 29 |       }, 30 |       select: { 31 |         id: true, 32 |         type: true, 33 |         name: true, 34 |         description: true, 35 |         icon: true, 36 |         isActive: true, 37 |         requiresConfirmation: true, 38 |         autoAssignPackage: true, 39 |         providerConfig: true 40 |       } 41 |     }); 42 |  43 |     if (!izipayPaymentMethod || !((izipayPaymentMethod.providerConfig as Record<string, unknown>)?.izipayConfig as Record<string, unknown>)?.hmacKey) { 44 |       return NextResponse.json({ 45 |         error: 'Configuration error', 46 |         message: 'Izipay configuration not found' 47 |       }, { status: 500 }); 48 |     } 49 |  50 |     const hmacSecret = ((izipayPaymentMethod.providerConfig as Record<string, unknown>)?.izipayConfig as Record<string, unknown>)?.hmacKey as string; 51 |  52 |     const calculatedHash = crypto 53 |       .createHmac('sha256', hmacSecret) 54 |       .update(rawBody, 'utf8') 55 |       .digest('base64'); 56 |  57 |     if (calculatedHash !== krHash) { 58 |       return NextResponse.json({ 59 |         error: 'Unauthorized', 60 |         message: 'Invalid signature' 61 |       }, { status: 401 }); 62 |     } 63 |  64 |     const webhookData = new URLSearchParams(rawBody); 65 |     const krAnswer = webhookData.get('kr-answer'); 66 |  67 |     if (!krAnswer) { 68 |       return NextResponse.json({ 69 |         error: 'Bad request', 70 |         message: 'Missing kr-answer data' 71 |       }, { status: 400 }); 72 |     } 73 |  74 |     let paymentData; 75 |     try { 76 |       paymentData = JSON.parse(krAnswer); 77 |       ); 78 |     } catch (parseError) { 79 |       return NextResponse.json({ 80 |         error: 'Bad request', 81 |         message: 'Invalid JSON in kr-answer' 82 |       }, { status: 400 }); 83 |     } 84 |  85 |     const orderId = paymentData.orderId; 86 |     const transactionStatus = paymentData.transactionDetails?.status; 87 |     const transactionId = paymentData.transactionDetails?.transactionId || paymentData.transactionId; 88 |  89 |     if (!orderId) { 90 |       return NextResponse.json({ 91 |         error: 'Bad request', 92 |         message: 'Missing orderId' 93 |       }, { status: 400 }); 94 |     } 95 |  96 |     const purchase = await prisma.purchase.findUnique({ 97 |       where: { id: parseInt(orderId) } 98 |     }); 99 | 100 |     if (!purchase) {101 |       return NextResponse.json({102 |         error: 'Not found',103 |         message: 'Purchase not found'104 |       }, { status: 404 });105 |     }106 | 107 |     let newPaymentStatus = purchase.paymentStatus;108 |     let notes = purchase.notes || '';109 | 110 |     switch (transactionStatus) {111 |       case 'PAID':112 |       case 'AUTHORISED':113 |         newPaymentStatus = 'completed';114 |         notes = `Payment confirmed via webhook. Transaction ID: ${transactionId}`;115 |         break;116 |       case 'UNPAID':117 |       case 'REFUSED':118 |       case 'CANCELLED':119 |         newPaymentStatus = 'failed';120 |         notes = `Payment failed via webhook. Status: ${transactionStatus}. Transaction ID: ${transactionId}`;121 |         break;122 |       case 'PENDING':123 |         newPaymentStatus = 'pending';124 |         notes = `Payment pending via webhook. Transaction ID: ${transactionId}`;125 |         break;126 |       default:127 |         notes = `Webhook received with status: ${transactionStatus}. Transaction ID: ${transactionId}`;128 |     }129 | 130 |     const updatedPurchase = await prisma.purchase.update({131 |       where: { id: purchase.id },132 |       data: {133 |         paymentStatus: newPaymentStatus,134 |         transactionId: transactionId || purchase.transactionId,135 |         notes: notes,136 |         ...(newPaymentStatus === 'completed' && !purchase.purchasedAt && {137 |           purchasedAt: new Date()138 |         })139 |       }140 |     });141 | 142 |     if (newPaymentStatus === 'completed') {143 | 144 |     }145 | 146 |     return NextResponse.json({147 |       success: true,148 |       message: 'Webhook processed successfully',149 |       orderId,150 |       status: newPaymentStatus151 |     });152 | 153 |   } catch (error) {154 |     return NextResponse.json({155 |       error: 'Internal server error',156 |       message: 'Failed to process webhook'157 |     }, { status: 500 });158 |   } finally {159 |     await prisma.$disconnect();160 |   }161 | }
============================================================END: frontend/app/api/izipay/webhook/route.ts============================================================


============================================================FILE: frontend/app/api/logo/route.tsSIZE: 3.09 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient, SupabaseClient } from '@supabase/supabase-js';  3 | import { withCache } from '@/lib/cache';  4 |   5 | let supabaseClient: SupabaseClient | null = null;  6 |   7 | function createSupabaseClient() {  8 |   if (supabaseClient) {  9 |     return supabaseClient; 10 |   } 11 |  12 |   const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL; 13 |   const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY; 14 |  15 |   if (!supabaseUrl || !supabaseKey) { 16 |     throw new Error('Missing Supabase environment variables'); 17 |   } 18 |  19 |   supabaseClient = createClient(supabaseUrl, supabaseKey); 20 |   return supabaseClient; 21 | } 22 |  23 | const defaultLogo = { 24 |   id: 1, 25 |   type: 'image', 26 |   text: 'MatMax Yoga Studio', 27 |   imageUrl: '/logo_matmax.png', 28 |   isActive: true, 29 |   createdAt: new Date().toISOString(), 30 |   updatedAt: new Date().toISOString() 31 | }; 32 |  33 | export async function GET() { 34 |   try { 35 |  36 |     const logoSettings = await withCache( 37 |       'logo_settings', 38 |       async () => { 39 |         const supabase = createSupabaseClient(); 40 |  41 |         const { data, error } = await supabase 42 |           .from('logo') 43 |           .select('*') 44 |           .single(); 45 |  46 |         if (error) { 47 |  48 |           if (error.code === 'PGRST205' || error.code === 'PGRST116') { 49 |             return defaultLogo; 50 |           } 51 |  52 |           return defaultLogo; 53 |         } 54 |  55 |         return data; 56 |       }, 57 |       30 * 60 * 1000 58 |     ); 59 |  60 |     return NextResponse.json({ logoSettings }); 61 |   } catch (error) { 62 |     return NextResponse.json({ logoSettings: defaultLogo }); 63 |   } 64 | } 65 |  66 | export async function POST(request: NextRequest) { 67 |   try { 68 |     const supabase = createSupabaseClient(); 69 |     const body = await request.json(); 70 |  71 |     try { 72 |       const { data, error } = await supabase 73 |         .from('logo') 74 |         .upsert(body, { onConflict: 'id' }) 75 |         .select() 76 |         .single(); 77 |  78 |       if (error) { 79 |         return NextResponse.json({ logoSettings: defaultLogo }); 80 |       } 81 |  82 |       return NextResponse.json({ logoSettings: data }); 83 |     } catch (tableError: unknown) { 84 |  85 |       if (tableError && typeof tableError === 'object' && 'code' in tableError && tableError.code === 'PGRST205') { 86 |         return NextResponse.json({ logoSettings: defaultLogo }); 87 |       } 88 |       throw tableError; 89 |     } 90 |   } catch (error) { 91 |     return NextResponse.json({ logoSettings: defaultLogo }); 92 |   } 93 | }
============================================================END: frontend/app/api/logo/route.ts============================================================


============================================================FILE: frontend/app/api/ml/retrain/route.tsSIZE: 6.34 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import MLPipelineService from '@/lib/services/ml-pipeline-service';  4 | import OpenRouterService from '@/lib/services/openrouter-service';  5 | import * as path from 'path';  6 |   7 | const openRouter = new OpenRouterService();  8 | const mlPipeline = new MLPipelineService(prisma, openRouter);  9 |  10 | export async function POST(request: NextRequest) { 11 |   try { 12 |     const { triggerSource = 'manual', minNewDataPoints = 10 } = await request.json(); 13 |  14 |     const trainingData = await mlPipeline.generateTrainingData({ 15 |       minConfidence: 0.6, 16 |       includeNegativeFeedback: true, 17 |       includeFallbackCases: true, 18 |       limit: 200 19 |     }); 20 |  21 |     if (trainingData.length < minNewDataPoints) { 22 |       return NextResponse.json({ 23 |         success: false, 24 |         message: `Insufficient training data. Generated ${trainingData.length} examples, need at least ${minNewDataPoints}`, 25 |         jobId: null 26 |       }); 27 |     } 28 |  29 |     const trainingDataFile = await saveTrainingDataToFile(trainingData as unknown as Record<string, unknown>[]); 30 |  31 |     const modelVersion = await trainRasaModel(); 32 |  33 |     const performance = await mlPipeline.evaluateModel(modelVersion); 34 |     }`); 35 |  36 |     const feedbackIds = await getUnreviewedFeedbackIds(); 37 |     if (feedbackIds.length > 0) { 38 |       await mlPipeline.markFeedbackAsReviewed(feedbackIds); 39 |       } 40 |  41 |     let abTestId = null; 42 |     if (performance.evaluationResults.accuracy > 0.8) { 43 |       const abTest = await mlPipeline.createABTest({ 44 |         experimentName: `Model Comparison ${new Date().toISOString().split('T')[0]}`, 45 |         modelAVersion: 'current_production', 46 |         modelBVersion: modelVersion, 47 |         trafficSplit: 0.1, 48 |         successMetric: 'booking_completion_rate' 49 |       }); 50 |       abTestId = abTest.id; 51 |       } 52 |  53 |     return NextResponse.json({ 54 |       success: true, 55 |       message: 'ML retraining pipeline completed successfully', 56 |       jobId: `retrain_${Date.now()}`, 57 |       results: { 58 |         trainingDataCount: trainingData.length, 59 |         modelVersion, 60 |         performance: { 61 |           accuracy: performance.evaluationResults.accuracy, 62 |           bookingSuccessRate: performance.bookingSuccessRate, 63 |           avgConversationTurns: performance.avgConversationTurns 64 |         }, 65 |         abTestId 66 |       } 67 |     }); 68 |  69 |   } catch (error) { 70 |     return NextResponse.json( 71 |       { 72 |         success: false, 73 |         error: 'ML retraining pipeline failed', 74 |         details: error instanceof Error ? error.message : 'Unknown error' 75 |       }, 76 |       { status: 500 } 77 |     ); 78 |   } finally { 79 |     await prisma.$disconnect(); 80 |   } 81 | } 82 |  83 | async function saveTrainingDataToFile(trainingData: Record<string, unknown>[]): Promise<string> { 84 |   const fs = await import('fs/promises'); 85 |   const path = await import('path'); 86 |  87 |   const rasaDataDir = path.default.join(process.cwd(), 'rasa', 'data'); 88 |   const fileName = `training_data_${Date.now()}.yml`; 89 |   const filePath = path.default.join(rasaDataDir, fileName); 90 |  91 |   const rasaFormat = convertToRasaFormat(trainingData); 92 |  93 |   await fs.default.writeFile(filePath, rasaFormat, 'utf8'); 94 |   return filePath; 95 | } 96 |  97 | function convertToRasaFormat(trainingData: Record<string, unknown>[]): string { 98 |   const intentGroups: Record<string, string[]> = {}; 99 | 100 |   for (const data of trainingData) {101 |     const intent = data.intent as string;102 |     const text = data.text as string;103 |     if (!intentGroups[intent]) {104 |       intentGroups[intent] = [];105 |     }106 | 107 |     let example = text;108 |     if (data.entities && Array.isArray(data.entities) && data.entities.length > 0) {109 | 110 |       const sortedEntities = (data.entities as Array<{ start: number; end: number; value: string; entity: string }>).sort((a, b) => b.start - a.start);111 |       for (const entity of sortedEntities) {112 |         const before = example.substring(0, entity.start);113 |         const after = example.substring(entity.end);114 |         example = `${before}[${entity.value}](${entity.entity})${after}`;115 |       }116 |     }117 | 118 |     intentGroups[intent].push(`    - ${example}`);119 |   }120 | 121 |   let yaml = 'version: "3.1"\n\nnlu:\n';122 | 123 |   for (const [intent, examples] of Object.entries(intentGroups)) {124 |     yaml += `- intent: ${intent}\n  examples: |\n`;125 |     yaml += examples.join('\n') + '\n\n';126 |   }127 | 128 |   return yaml;129 | }130 | 131 | async function trainRasaModel(): Promise<string> {132 |   const { exec } = await import('child_process');133 |   const { promisify } = await import('util');134 |   const execAsync = promisify(exec);135 | 136 |   const rasaDir = path.join(process.cwd(), 'rasa');137 | 138 |   try {139 | 140 |     const { stdout, stderr } = await execAsync('rasa train', { cwd: rasaDir });141 | 142 |     if (stderr && !stderr.includes('WARNING')) {143 |       throw new Error(`Rasa training error: ${stderr}`);144 |     }145 | 146 |     const modelMatch = stdout.match(/model-(\d{8}-\d{6}-\w+)/);147 |     const modelVersion = modelMatch ? modelMatch[1] : `model_${Date.now()}`;148 | 149 |     return modelVersion;150 |   } catch (error) {151 |     throw new Error(`Failed to train Rasa model: ${error}`);152 |   }153 | }154 | 155 | async function getUnreviewedFeedbackIds(): Promise<number[]> {156 |   const feedback = await prisma.userFeedback.findMany({157 |     where: { reviewedForTraining: false },158 |     select: { id: true },159 |     take: 100160 |   });161 | 162 |   return feedback.map(f => f.id);163 | }
============================================================END: frontend/app/api/ml/retrain/route.ts============================================================


============================================================FILE: frontend/app/api/orchestrator/route.tsSIZE: 8.76 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { ConversationalOrchestrator } from '@/lib/services/conversational-orchestrator';  3 | import { OrchestratorConfig, IntentActionMapping } from '@/lib/types/conversational-orchestrator';  4 |   5 | const orchestratorConfig: OrchestratorConfig = {  6 |   rasa: {  7 |     url: process.env.RASA_URL || 'http:  8 |     model: process.env.RASA_MODEL || 'rasa',  9 |     confidence_threshold: parseFloat(process.env.RASA_CONFIDENCE_THRESHOLD || '0.7') 10 |   }, 11 |   openrouter: { 12 |     apiKey: process.env.OPENROUTER_API_KEY || '', 13 |     baseUrl: process.env.OPENROUTER_BASE_URL || 'https: 14 |     model: process.env.OPENROUTER_MODEL || 'meta-llama/llama-3.3-8b-instruct:free', 15 |     temperature: parseFloat(process.env.OPENROUTER_TEMPERATURE || '0.7'), 16 |     maxTokens: parseInt(process.env.OPENROUTER_MAX_TOKENS || '1000') 17 |   }, 18 |   twilio: { 19 |     accountSid: process.env.TWILIO_ACCOUNT_SID || '', 20 |     authToken: process.env.TWILIO_AUTH_TOKEN || '', 21 |     phoneNumber: process.env.TWILIO_PHONE_NUMBER || '', 22 |     webhookUrl: process.env.TWILIO_WEBHOOK_URL || '' 23 |   }, 24 |   logging: { 25 |     enabled: process.env.LOGGING_ENABLED === 'true', 26 |     level: (process.env.LOGGING_LEVEL as 'debug' | 'info' | 'warn' | 'error') || 'info', 27 |     storage: (process.env.LOGGING_STORAGE as 'database' | 'file' | 'console') || 'console' 28 |   }, 29 |   apis: { 30 |     baseUrl: process.env.API_BASE_URL || `${process.env.NEXT_PUBLIC_BASE_URL || `http: 31 |     timeout: parseInt(process.env.API_TIMEOUT || '10000'), 32 |     retries: parseInt(process.env.API_RETRIES || '3') 33 |   } 34 | }; 35 |  36 | const intentActionMapping: IntentActionMapping = { 37 |   'consulta_estado': { 38 |     action: 'consultar_estado', 39 |     apiEndpoint: '/admin/bookings', 40 |     requiredEntities: ['solicitud_id', 'cita_id', 'email'], 41 |     optionalEntities: ['tipo_consulta'], 42 |     description: 'Consultar el estado de una solicitud o cita' 43 |   }, 44 |   'agendar_cita': { 45 |     action: 'agendar_cita', 46 |     apiEndpoint: '/booking', 47 |     requiredEntities: ['fecha', 'hora', 'email'], 48 |     optionalEntities: ['tipo_sesion', 'paquete_id', 'tamaño_grupo', 'notas'], 49 |     description: 'Agendar una nueva cita' 50 |   }, 51 |   'consultar_paquetes': { 52 |     action: 'consultar_paquetes', 53 |     apiEndpoint: '/packages', 54 |     requiredEntities: [], 55 |     optionalEntities: ['tipo_paquete', 'moneda', 'duración'], 56 |     description: 'Consultar paquetes disponibles' 57 |   }, 58 |   'pagar_servicio': { 59 |     action: 'pagar_servicio', 60 |     apiEndpoint: '/client/purchase', 61 |     requiredEntities: ['monto', 'método_pago', 'email'], 62 |     optionalEntities: ['cita_id', 'paquete_id', 'moneda', 'notas'], 63 |     description: 'Procesar un pago' 64 |   }, 65 |   'cancelar_cita': { 66 |     action: 'cancelar_cita', 67 |     apiEndpoint: '/client/bookings', 68 |     requiredEntities: ['cita_id', 'email'], 69 |     optionalEntities: ['motivo'], 70 |     description: 'Cancelar una cita existente' 71 |   }, 72 |   'consultar_historial': { 73 |     action: 'consultar_historial', 74 |     apiEndpoint: '/client/purchase-history', 75 |     requiredEntities: ['email'], 76 |     optionalEntities: ['tipo_historial', 'fecha_desde', 'fecha_hasta'], 77 |     description: 'Consultar historial del usuario' 78 |   }, 79 |   'consultar_horarios': { 80 |     action: 'consultar_horarios', 81 |     apiEndpoint: '/schedule-slots', 82 |     requiredEntities: [], 83 |     optionalEntities: ['fecha', 'duración', 'tipo_sesion'], 84 |     description: 'Consultar horarios disponibles' 85 |   }, 86 |   'actualizar_perfil': { 87 |     action: 'actualizar_perfil', 88 |     apiEndpoint: '/client/me', 89 |     requiredEntities: ['email'], 90 |     optionalEntities: ['nombre', 'teléfono', 'fecha_nacimiento', 'lugar_nacimiento'], 91 |     description: 'Actualizar información del perfil' 92 |   }, 93 |   'saludo': { 94 |     action: 'saludo', 95 |     requiredEntities: [], 96 |     optionalEntities: ['nombre'], 97 |     description: 'Manejar saludos y bienvenidas' 98 |   }, 99 |   'despedida': {100 |     action: 'despedida',101 |     requiredEntities: [],102 |     optionalEntities: [],103 |     description: 'Manejar despedidas'104 |   },105 |   'ayuda': {106 |     action: 'ayuda',107 |     requiredEntities: [],108 |     optionalEntities: ['tema_ayuda'],109 |     description: 'Proporcionar ayuda y soporte'110 |   }111 | };112 | 113 | let orchestrator: ConversationalOrchestrator | null = null;114 | 115 | function getOrchestrator(): ConversationalOrchestrator {116 |   if (!orchestrator) {117 |     orchestrator = new ConversationalOrchestrator(orchestratorConfig, intentActionMapping);118 |   }119 |   return orchestrator;120 | }121 | 122 | export async function GET(request: NextRequest) {123 |   try {124 |     const { searchParams } = new URL(request.url);125 |     const action = searchParams.get('action');126 | 127 |     const orchestrator = getOrchestrator();128 | 129 |     switch (action) {130 |       case 'health':131 |         const healthCheck = await orchestrator.healthCheck();132 |         return NextResponse.json({133 |           success: true,134 |           data: healthCheck,135 |           timestamp: new Date().toISOString()136 |         });137 | 138 |       case 'stats':139 |         const userId = searchParams.get('userId');140 |         const dateFrom = searchParams.get('dateFrom');141 |         const dateTo = searchParams.get('dateTo');142 | 143 |         const stats = await orchestrator.getConversationStats(144 |           userId || undefined,145 |           dateFrom || undefined,146 |           dateTo || undefined147 |         );148 | 149 |         return NextResponse.json({150 |           success: true,151 |           data: stats,152 |           timestamp: new Date().toISOString()153 |         });154 | 155 |       case 'logs':156 |         const logUserId = searchParams.get('userId');157 |         const limit = parseInt(searchParams.get('limit') || '50');158 |         const offset = parseInt(searchParams.get('offset') || '0');159 | 160 |         if (!logUserId) {161 |           return NextResponse.json({162 |             success: false,163 |             error: 'userId is required for logs action'164 |           }, { status: 400 });165 |         }166 | 167 |         const logs = await orchestrator.getConversationLogs(logUserId, limit, offset);168 | 169 |         return NextResponse.json({170 |           success: true,171 |           data: logs,172 |           pagination: {173 |             limit,174 |             offset,175 |             total: logs.length176 |           },177 |           timestamp: new Date().toISOString()178 |         });179 | 180 |       case 'config':181 |         return NextResponse.json({182 |           success: true,183 |           data: {184 |             config: orchestratorConfig,185 |             intentActionMapping186 |           },187 |           timestamp: new Date().toISOString()188 |         });189 | 190 |       default:191 |         return NextResponse.json({192 |           success: true,193 |           message: 'Conversational Orchestrator API',194 |           availableActions: ['health', 'stats', 'logs', 'config'],195 |           timestamp: new Date().toISOString()196 |         });197 |     }198 | 199 |   } catch (error) {200 |     return NextResponse.json({201 |       success: false,202 |       error: 'Internal server error',203 |       code: 'INTERNAL_ERROR',204 |       details: error instanceof Error ? error.message : 'Unknown error'205 |     }, { status: 500 });206 |   }207 | }208 | 209 | export async function POST(request: NextRequest) {210 |   try {211 |     const body = await request.json();212 |     const { action, data } = body;213 | 214 |     const orchestrator = getOrchestrator();215 | 216 |     switch (action) {217 |       case 'clean-logs':218 |         const daysToKeep = data?.daysToKeep || 30;219 |         const cleanedCount = await orchestrator.cleanOldLogs(daysToKeep);220 | 221 |         return NextResponse.json({222 |           success: true,223 |           data: {224 |             cleanedCount,225 |             daysToKeep226 |           },227 |           message: `Cleaned ${cleanedCount} old log entries`228 |         });229 | 230 |       case 'test-message':231 |         const { message, userId } = data;232 | 233 |         if (!message || !userId) {234 |           return NextResponse.json({235 |             success: false,236 |             error: 'message and userId are required for test-message action'237 |           }, { status: 400 });238 |         }239 | 240 |         const mockWebhook = {241 |           Body: message,242 |           From: `whatsapp:${userId}`,243 |           To: `whatsapp:${process.env.TWILIO_PHONE_NUMBER}`,244 |           MessageSid: `test_${Date.now()}`,245 |           Timestamp: new Date().toISOString(),246 |           ProfileName: 'Test User'247 |         };248 | 249 |         const result = await orchestrator.processWhatsAppMessage(mockWebhook);250 | 251 |         return NextResponse.json({252 |           success: true,253 |           data: result,254 |           message: 'Test message processed'255 |         });256 | 257 |       default:258 |         return NextResponse.json({259 |           success: false,260 |           error: `Unknown action: ${action}`,261 |           availableActions: ['clean-logs', 'test-message']262 |         }, { status: 400 });263 |     }264 | 265 |   } catch (error) {266 |     return NextResponse.json({267 |       success: false,268 |       error: 'Internal server error',269 |       code: 'INTERNAL_ERROR',270 |       details: error instanceof Error ? error.message : 'Unknown error'271 |     }, { status: 500 });272 |   }273 | }
============================================================END: frontend/app/api/orchestrator/route.ts============================================================


============================================================FILE: frontend/app/api/orchestrator/test/route.tsSIZE: 9.86 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { ConversationalOrchestrator } from '@/lib/services/conversational-orchestrator';  3 | import { OrchestratorConfig, IntentActionMapping } from '@/lib/types/conversational-orchestrator';  4 |   5 | const orchestratorConfig: OrchestratorConfig = {  6 |   rasa: {  7 |     url: process.env.RASA_URL || 'http:  8 |     model: process.env.RASA_MODEL || 'rasa',  9 |     confidence_threshold: parseFloat(process.env.RASA_CONFIDENCE_THRESHOLD || '0.7') 10 |   }, 11 |   openrouter: { 12 |     apiKey: process.env.OPENROUTER_API_KEY || '', 13 |     baseUrl: process.env.OPENROUTER_BASE_URL || 'https: 14 |     model: process.env.OPENROUTER_MODEL || 'meta-llama/llama-3.3-8b-instruct:free', 15 |     temperature: parseFloat(process.env.OPENROUTER_TEMPERATURE || '0.7'), 16 |     maxTokens: parseInt(process.env.OPENROUTER_MAX_TOKENS || '1000') 17 |   }, 18 |   twilio: { 19 |     accountSid: process.env.TWILIO_ACCOUNT_SID || '', 20 |     authToken: process.env.TWILIO_AUTH_TOKEN || '', 21 |     phoneNumber: process.env.TWILIO_PHONE_NUMBER || '', 22 |     webhookUrl: process.env.TWILIO_WEBHOOK_URL || '' 23 |   }, 24 |   logging: { 25 |     enabled: process.env.LOGGING_ENABLED === 'true', 26 |     level: (process.env.LOGGING_LEVEL as 'debug' | 'info' | 'warn' | 'error') || 'info', 27 |     storage: (process.env.LOGGING_STORAGE as 'database' | 'file' | 'console') || 'console' 28 |   }, 29 |   apis: { 30 |     baseUrl: process.env.API_BASE_URL || `${process.env.NEXT_PUBLIC_BASE_URL || `http: 31 |     timeout: parseInt(process.env.API_TIMEOUT || '10000'), 32 |     retries: parseInt(process.env.API_RETRIES || '3') 33 |   } 34 | }; 35 |  36 | const intentActionMapping: IntentActionMapping = { 37 |   'consulta_estado': { 38 |     action: 'consultar_estado', 39 |     apiEndpoint: '/admin/bookings', 40 |     requiredEntities: ['solicitud_id', 'cita_id', 'email'], 41 |     optionalEntities: ['tipo_consulta'], 42 |     description: 'Consultar el estado de una solicitud o cita' 43 |   }, 44 |   'agendar_cita': { 45 |     action: 'agendar_cita', 46 |     apiEndpoint: '/booking', 47 |     requiredEntities: ['fecha', 'hora', 'email'], 48 |     optionalEntities: ['tipo_sesion', 'paquete_id', 'tamaño_grupo', 'notas'], 49 |     description: 'Agendar una nueva cita' 50 |   }, 51 |   'consultar_paquetes': { 52 |     action: 'consultar_paquetes', 53 |     apiEndpoint: '/packages', 54 |     requiredEntities: [], 55 |     optionalEntities: ['tipo_paquete', 'moneda', 'duración'], 56 |     description: 'Consultar paquetes disponibles' 57 |   }, 58 |   'pagar_servicio': { 59 |     action: 'pagar_servicio', 60 |     apiEndpoint: '/client/purchase', 61 |     requiredEntities: ['monto', 'método_pago', 'email'], 62 |     optionalEntities: ['cita_id', 'paquete_id', 'moneda', 'notas'], 63 |     description: 'Procesar un pago' 64 |   }, 65 |   'cancelar_cita': { 66 |     action: 'cancelar_cita', 67 |     apiEndpoint: '/client/bookings', 68 |     requiredEntities: ['cita_id', 'email'], 69 |     optionalEntities: ['motivo'], 70 |     description: 'Cancelar una cita existente' 71 |   }, 72 |   'consultar_historial': { 73 |     action: 'consultar_historial', 74 |     apiEndpoint: '/client/purchase-history', 75 |     requiredEntities: ['email'], 76 |     optionalEntities: ['tipo_historial', 'fecha_desde', 'fecha_hasta'], 77 |     description: 'Consultar historial del usuario' 78 |   }, 79 |   'consultar_horarios': { 80 |     action: 'consultar_horarios', 81 |     apiEndpoint: '/schedule-slots', 82 |     requiredEntities: [], 83 |     optionalEntities: ['fecha', 'duración', 'tipo_sesion'], 84 |     description: 'Consultar horarios disponibles' 85 |   }, 86 |   'actualizar_perfil': { 87 |     action: 'actualizar_perfil', 88 |     apiEndpoint: '/client/me', 89 |     requiredEntities: ['email'], 90 |     optionalEntities: ['nombre', 'teléfono', 'fecha_nacimiento', 'lugar_nacimiento'], 91 |     description: 'Actualizar información del perfil' 92 |   }, 93 |   'saludo': { 94 |     action: 'saludo', 95 |     requiredEntities: [], 96 |     optionalEntities: ['nombre'], 97 |     description: 'Manejar saludos y bienvenidas' 98 |   }, 99 |   'despedida': {100 |     action: 'despedida',101 |     requiredEntities: [],102 |     optionalEntities: [],103 |     description: 'Manejar despedidas'104 |   },105 |   'ayuda': {106 |     action: 'ayuda',107 |     requiredEntities: [],108 |     optionalEntities: ['tema_ayuda'],109 |     description: 'Proporcionar ayuda y soporte'110 |   }111 | };112 | 113 | let orchestrator: ConversationalOrchestrator | null = null;114 | 115 | function getOrchestrator(): ConversationalOrchestrator {116 |   if (!orchestrator) {117 |     orchestrator = new ConversationalOrchestrator(orchestratorConfig, intentActionMapping);118 |   }119 |   return orchestrator;120 | }121 | 122 | export async function POST(request: NextRequest) {123 |   try {124 |     const body = await request.json();125 |     const { message, userId, testType } = body;126 | 127 |     if (!message) {128 |       return NextResponse.json({129 |         success: false,130 |         error: 'Message is required'131 |       }, { status: 400 });132 |     }133 | 134 |     const testUserId = userId || `test_${Date.now()}`;135 |     const orchestrator = getOrchestrator();136 | 137 |     const mockWebhook = {138 |       Body: message,139 |       From: `whatsapp:${testUserId}`,140 |       To: `whatsapp:${process.env.TWILIO_PHONE_NUMBER || '+1234567890'}`,141 |       MessageSid: `test_${Date.now()}`,142 |       Timestamp: new Date().toISOString(),143 |       ProfileName: 'Test User'144 |     };145 | 146 |     const startTime = Date.now();147 |     const result = await orchestrator.processWhatsAppMessage(mockWebhook);148 |     const processingTime = Date.now() - startTime;149 | 150 |     return NextResponse.json({151 |       success: true,152 |       data: {153 |         ...result,154 |         processingTime,155 |         testType: testType || 'full',156 |         timestamp: new Date().toISOString()157 |       }158 |     });159 | 160 |   } catch (error) {161 |     return NextResponse.json({162 |       success: false,163 |       error: 'Test failed',164 |       code: 'TEST_ERROR',165 |       details: error instanceof Error ? error.message : 'Unknown error'166 |     }, { status: 500 });167 |   }168 | }169 | 170 | export async function GET(request: NextRequest) {171 |   try {172 |     const { searchParams } = new URL(request.url);173 |     const testType = searchParams.get('type') || 'health';174 | 175 |     const orchestrator = getOrchestrator();176 | 177 |     switch (testType) {178 |       case 'health':179 |         const healthCheck = await orchestrator.healthCheck();180 |         return NextResponse.json({181 |           success: true,182 |           data: {183 |             health: healthCheck,184 |             config: {185 |               rasa: {186 |                 url: orchestratorConfig.rasa.url,187 |                 confidence_threshold: orchestratorConfig.rasa.confidence_threshold188 |               },189 |               openrouter: {190 |                 baseUrl: orchestratorConfig.openrouter.baseUrl,191 |                 model: orchestratorConfig.openrouter.model192 |               },193 |               twilio: {194 |                 phoneNumber: orchestratorConfig.twilio.phoneNumber195 |               },196 |               logging: {197 |                 enabled: orchestratorConfig.logging.enabled,198 |                 level: orchestratorConfig.logging.level,199 |                 storage: orchestratorConfig.logging.storage200 |               }201 |             }202 |           },203 |           timestamp: new Date().toISOString()204 |         });205 | 206 |       case 'examples':207 |         return NextResponse.json({208 |           success: true,209 |           data: {210 |             testMessages: [211 |               {212 |                 intent: 'saludo',213 |                 message: 'Hola, ¿cómo estás?',214 |                 description: 'Mensaje de saludo básico'215 |               },216 |               {217 |                 intent: 'consultar_paquetes',218 |                 message: '¿Qué paquetes tienen disponibles?',219 |                 description: 'Consulta de paquetes'220 |               },221 |               {222 |                 intent: 'agendar_cita',223 |                 message: 'Quiero agendar una cita para mañana a las 3pm',224 |                 description: 'Agendar cita con fecha y hora'225 |               },226 |               {227 |                 intent: 'consulta_estado',228 |                 message: '¿Cuál es el estado de mi solicitud 12345?',229 |                 description: 'Consulta de estado con ID'230 |               },231 |               {232 |                 intent: 'pagar_servicio',233 |                 message: 'Quiero pagar $50 por mi paquete con tarjeta de crédito',234 |                 description: 'Pago con método específico'235 |               },236 |               {237 |                 intent: 'consultar_horarios',238 |                 message: '¿Qué horarios tienen disponibles para esta semana?',239 |                 description: 'Consulta de horarios disponibles'240 |               },241 |               {242 |                 intent: 'cancelar_cita',243 |                 message: 'Necesito cancelar mi cita del viernes',244 |                 description: 'Cancelación de cita'245 |               },246 |               {247 |                 intent: 'ayuda',248 |                 message: '¿Cómo funciona el sistema de citas?',249 |                 description: 'Solicitud de ayuda'250 |               }251 |             ],252 |             intents: Object.keys(intentActionMapping),253 |             entities: [254 |               'solicitud_id', 'cita_id', 'email', 'fecha', 'hora', 'tipo_sesion',255 |               'paquete_id', 'monto', 'método_pago', 'moneda', 'nombre', 'teléfono',256 |               'fecha_nacimiento', 'lugar_nacimiento', 'tamaño_grupo', 'notas'257 |             ]258 |           },259 |           timestamp: new Date().toISOString()260 |         });261 | 262 |       case 'stats':263 |         const stats = await orchestrator.getConversationStats();264 |         return NextResponse.json({265 |           success: true,266 |           data: stats,267 |           timestamp: new Date().toISOString()268 |         });269 | 270 |       default:271 |         return NextResponse.json({272 |           success: true,273 |           message: 'Orchestrator Test API',274 |           availableTests: ['health', 'examples', 'stats'],275 |           usage: {276 |             GET: 'Use ?type=health|examples|stats',277 |             POST: 'Send {message, userId?, testType?} to test message processing'278 |           },279 |           timestamp: new Date().toISOString()280 |         });281 |     }282 | 283 |   } catch (error) {284 |     return NextResponse.json({285 |       success: false,286 |       error: 'Test API error',287 |       code: 'TEST_API_ERROR',288 |       details: error instanceof Error ? error.message : 'Unknown error'289 |     }, { status: 500 });290 |   }291 | }
============================================================END: frontend/app/api/orchestrator/test/route.ts============================================================


============================================================FILE: frontend/app/api/otp/send/route.tsSIZE: 3.26 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import { labsMobileSmsService, LabsMobileSmsService } from '@/lib/labsmobile-sms-service';  4 | import { z } from 'zod';  5 |   6 | const sendOtpSchema = z.object({  7 |   phoneNumber: z.string().min(1, 'Phone number is required'),  8 |   countryCode: z.string().min(1, 'Country code is required'),  9 |   language: z.string().optional().default('en'), 10 | }); 11 |  12 | export async function POST(request: NextRequest) { 13 |   try { 14 |     const body = await request.json(); 15 |     const { phoneNumber, countryCode, language } = sendOtpSchema.parse(body); 16 |  17 |     if (!LabsMobileSmsService.validatePhoneNumber(phoneNumber, countryCode)) { 18 |       const cleanNumber = phoneNumber.replace(/\D/g, ''); 19 |       return NextResponse.json( 20 |         { 21 |           error: `Invalid phone number format for ${countryCode}. Received: "${cleanNumber}" (${cleanNumber.length} digits). Please check the example format.` 22 |         }, 23 |         { status: 400 } 24 |       ); 25 |     } 26 |  27 |     const formattedPhoneNumber = LabsMobileSmsService.formatPhoneNumber(phoneNumber, countryCode); 28 |  29 |     const existingOtp = await prisma.otpVerification.findFirst({ 30 |       where: { 31 |         phoneNumber: formattedPhoneNumber, 32 |         isVerified: false, 33 |         expiresAt: { 34 |           gt: new Date() 35 |         } 36 |       } 37 |     }); 38 |  39 |     if (existingOtp) { 40 |  41 |       const timeDiff = existingOtp.expiresAt.getTime() - new Date().getTime(); 42 |       if (timeDiff > 8 * 60 * 1000) { 43 |         return NextResponse.json( 44 |           { error: 'Please wait before requesting a new OTP code' }, 45 |           { status: 429 } 46 |         ); 47 |       } 48 |     } 49 |  50 |     const otpCode = LabsMobileSmsService.generateOtpCode(6); 51 |     const expiresAt = new Date(Date.now() + 10 * 60 * 1000); 52 |  53 |     const otpVerification = await prisma.otpVerification.create({ 54 |       data: { 55 |         phoneNumber: formattedPhoneNumber, 56 |         countryCode, 57 |         otpCode, 58 |         expiresAt, 59 |         attempts: 0, 60 |         maxAttempts: 3 61 |       } 62 |     }); 63 |  64 |     try { 65 |       await labsMobileSmsService.sendOtpSms(formattedPhoneNumber, otpCode, language); 66 |  67 |       return NextResponse.json({ 68 |         success: true, 69 |         message: 'OTP sent successfully', 70 |         otpId: otpVerification.id, 71 |         expiresAt: expiresAt.toISOString() 72 |       }); 73 |     } catch (smsError) { 74 |  75 |       await prisma.otpVerification.delete({ 76 |         where: { id: otpVerification.id } 77 |       }); 78 |  79 |       return NextResponse.json( 80 |         { error: 'Failed to send OTP. Please try again.' }, 81 |         { status: 500 } 82 |       ); 83 |     } 84 |  85 |   } catch (error) { 86 |     if (error instanceof z.ZodError) { 87 |       return NextResponse.json( 88 |         { error: 'Invalid request data', details: error.issues }, 89 |         { status: 400 } 90 |       ); 91 |     } 92 |  93 |     return NextResponse.json( 94 |       { error: 'Internal server error' }, 95 |       { status: 500 } 96 |     ); 97 |   } 98 | }
============================================================END: frontend/app/api/otp/send/route.ts============================================================


============================================================FILE: frontend/app/api/otp/verify/route.tsSIZE: 4.04 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import { z } from 'zod';  4 |   5 | const verifyOtpSchema = z.object({  6 |   phoneNumber: z.string().min(1, 'Phone number is required'),  7 |   otpCode: z.string().min(6, 'OTP code must be at least 6 digits').max(6, 'OTP code must be at most 6 digits'),  8 | });  9 |  10 | export async function POST(request: NextRequest) { 11 |   try { 12 |     const body = await request.json(); 13 |     const { phoneNumber, otpCode } = verifyOtpSchema.parse(body); 14 |  15 |     const otpVerification = await prisma.otpVerification.findFirst({ 16 |       where: { 17 |         phoneNumber, 18 |         otpCode, 19 |         isVerified: false, 20 |         expiresAt: { 21 |           gt: new Date() 22 |         } 23 |       }, 24 |       orderBy: { 25 |         createdAt: 'desc' 26 |       } 27 |     }); 28 |  29 |     if (!otpVerification) { 30 |  31 |       const expiredOtp = await prisma.otpVerification.findFirst({ 32 |         where: { 33 |           phoneNumber, 34 |           otpCode, 35 |           isVerified: false 36 |         }, 37 |         orderBy: { 38 |           createdAt: 'desc' 39 |         } 40 |       }); 41 |  42 |       if (expiredOtp) { 43 |         if (expiredOtp.expiresAt < new Date()) { 44 |           return NextResponse.json( 45 |             { error: 'OTP code has expired. Please request a new one.' }, 46 |             { status: 400 } 47 |           ); 48 |         } 49 |  50 |         if (expiredOtp.attempts >= expiredOtp.maxAttempts) { 51 |           return NextResponse.json( 52 |             { error: 'Maximum verification attempts exceeded. Please request a new OTP.' }, 53 |             { status: 400 } 54 |           ); 55 |         } 56 |       } 57 |  58 |       return NextResponse.json( 59 |         { error: 'Invalid OTP code' }, 60 |         { status: 400 } 61 |       ); 62 |     } 63 |  64 |     if (otpVerification.attempts >= otpVerification.maxAttempts) { 65 |       return NextResponse.json( 66 |         { error: 'Maximum verification attempts exceeded. Please request a new OTP.' }, 67 |         { status: 400 } 68 |       ); 69 |     } 70 |  71 |     if (otpVerification.expiresAt < new Date()) { 72 |       return NextResponse.json( 73 |         { error: 'OTP code has expired. Please request a new one.' }, 74 |         { status: 400 } 75 |       ); 76 |     } 77 |  78 |     await prisma.otpVerification.update({ 79 |       where: { id: otpVerification.id }, 80 |       data: { 81 |         isVerified: true, 82 |         attempts: otpVerification.attempts + 1 83 |       } 84 |     }); 85 |  86 |     const existingUser = await prisma.user.findFirst({ 87 |       where: { 88 |         phone: phoneNumber 89 |       }, 90 |       select: { 91 |         id: true, 92 |         email: true, 93 |         fullName: true, 94 |         phone: true, 95 |         birthDate: true, 96 |         birthTime: true, 97 |         birthPlace: true, 98 |         language: true, 99 |         status: true100 |       }101 |     });102 | 103 |     if (existingUser) {104 | 105 |       return NextResponse.json({106 |         success: true,107 |         message: 'OTP verified successfully',108 |         user: {109 |           id: existingUser.id,110 |           email: existingUser.email,111 |           fullName: existingUser.fullName,112 |           phone: existingUser.phone,113 |           birthDate: existingUser.birthDate?.toISOString().split('T')[0],114 |           birthTime: existingUser.birthTime?.toString().substring(0, 5),115 |           birthPlace: existingUser.birthPlace,116 |           language: existingUser.language,117 |           status: existingUser.status118 |         },119 |         isExistingCustomer: true120 |       });121 |     } else {122 | 123 |       return NextResponse.json({124 |         success: true,125 |         message: 'OTP verified successfully',126 |         user: {127 |           phone: phoneNumber128 |         },129 |         isExistingCustomer: false130 |       });131 |     }132 | 133 |   } catch (error) {134 |     if (error instanceof z.ZodError) {135 |       return NextResponse.json(136 |         { error: 'Invalid request data', details: error.issues },137 |         { status: 400 }138 |       );139 |     }140 | 141 |     return NextResponse.json(142 |       { error: 'Internal server error' },143 |       { status: 500 }144 |     );145 |   }146 | }
============================================================END: frontend/app/api/otp/verify/route.ts============================================================


============================================================FILE: frontend/app/api/packages/route.tsSIZE: 3.36 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET(request: NextRequest) {  5 |   try {  6 |     const { searchParams } = new URL(request.url);  7 |     const activeOnly = searchParams.get('active') !== 'false';  8 |     const currency = searchParams.get('currency') || 'PEN';  9 |  10 |     const packages = await prisma.packageDefinition.findMany({ 11 |       where: { 12 |         isActive: activeOnly ? true : undefined 13 |       }, 14 |       select: { 15 |         id: true, 16 |         name: true, 17 |         description: true, 18 |         sessionsCount: true, 19 |         packageType: true, 20 |         maxGroupSize: true, 21 |         isPopular: true, 22 |         featured: true, 23 |         displayOrder: true, 24 |         packagePrices: { 25 |           where: { 26 |             isActive: true, 27 |             currency: { 28 |               code: currency 29 |             } 30 |           }, 31 |           select: { 32 |             id: true, 33 |             price: true, 34 |             pricingMode: true, 35 |             currency: { 36 |               select: { 37 |                 id: true, 38 |                 code: true, 39 |                 name: true, 40 |                 symbol: true 41 |               } 42 |             } 43 |           }, 44 |           orderBy: { 45 |             price: 'asc' 46 |           } 47 |         }, 48 |         sessionDuration: { 49 |           select: { 50 |             id: true, 51 |             name: true, 52 |             duration_minutes: true, 53 |             description: true 54 |           } 55 |         } 56 |       }, 57 |       orderBy: [ 58 |         { displayOrder: 'asc' }, 59 |         { name: 'asc' } 60 |       ] 61 |     }); 62 |  63 |     const transformedPackages = packages.map(pkg => { 64 |  65 |       const price = pkg.packagePrices[0]; 66 |  67 |       if (!price) { 68 |         return null; 69 |       } 70 |  71 |       return { 72 |         id: price.id, 73 |         price: Number(price.price), 74 |         packageDefinition: { 75 |           id: pkg.id, 76 |           name: pkg.name, 77 |           description: pkg.description || '', 78 |           sessionsCount: pkg.sessionsCount, 79 |           isActive: true 80 |         }, 81 |         currency: { 82 |           id: price.currency.id, 83 |           code: price.currency.code, 84 |           symbol: price.currency.symbol, 85 |           name: price.currency.name 86 |         }, 87 |         sessionDuration: pkg.sessionDuration, 88 |         packageType: pkg.packageType, 89 |         maxGroupSize: pkg.maxGroupSize, 90 |         isPopular: pkg.isPopular, 91 |         featured: pkg.featured 92 |       }; 93 |     }).filter(Boolean); 94 |  95 |     return NextResponse.json({ 96 |       success: true, 97 |       data: transformedPackages, 98 |       meta: { 99 |         currency,100 |         total: transformedPackages.length101 |       }102 |     });103 | 104 |   } catch (error) {105 |     return NextResponse.json({106 |       success: false,107 |       error: 'Failed to fetch packages',108 |       message: 'An error occurred while fetching packages',109 |       details: process.env.NODE_ENV === 'development' ? (error instanceof Error ? error.message : 'Unknown error') : 'Internal server error'110 |     }, { status: 500 });111 |   }112 | }
============================================================END: frontend/app/api/packages/route.ts============================================================


============================================================FILE: frontend/app/api/payment-methods/route.tsSIZE: 1.12 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { PrismaClient } from '@prisma/client';  3 |   4 | export async function GET() {  5 |   const prisma = new PrismaClient();  6 |   7 |   try {  8 |     const paymentMethods = await prisma.paymentMethodConfig.findMany({  9 |       where: { 10 |         isActive: true 11 |       }, 12 |       select: { 13 |         id: true, 14 |         name: true, 15 |         type: true, 16 |         description: true, 17 |         icon: true, 18 |         requiresConfirmation: true, 19 |         autoAssignPackage: true, 20 |         isActive: true 21 |       }, 22 |       orderBy: { 23 |         name: 'asc' 24 |       } 25 |     }); 26 |  27 |     return NextResponse.json({ 28 |       success: true, 29 |       data: paymentMethods 30 |     }); 31 |  32 |   } catch (error) { 33 |     const message = error instanceof Error ? error.message : 'Unknown error'; 34 |     return NextResponse.json( 35 |       { 36 |         error: 'Failed to fetch payment methods', 37 |         details: message 38 |       }, 39 |       { status: 500 } 40 |     ); 41 |   } finally { 42 |     await prisma.$disconnect(); 43 |   } 44 | }
============================================================END: frontend/app/api/payment-methods/route.ts============================================================


============================================================FILE: frontend/app/api/performance/route.tsSIZE: 1.20 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { performanceMonitor, cacheMetrics } from '@/lib/performance';  3 | import { apiCache } from '@/lib/cache';  4 |   5 | export async function GET() {  6 |   try {  7 |     const metrics = performanceMonitor.getAllMetrics();  8 |     const cacheStats = apiCache.getStats();  9 |     const cacheDetails = cacheMetrics.getStats(); 10 |  11 |     return NextResponse.json({ 12 |       success: true, 13 |       performance: { 14 |         metrics, 15 |         cache: { 16 |           ...cacheStats, 17 |           ...cacheDetails 18 |         } 19 |       }, 20 |       timestamp: new Date().toISOString() 21 |     }); 22 |   } catch (error) { 23 |     return NextResponse.json( 24 |       { error: 'Failed to fetch performance metrics' }, 25 |       { status: 500 } 26 |     ); 27 |   } 28 | } 29 |  30 | export async function POST() { 31 |   try { 32 |  33 |     performanceMonitor.clearMetrics(); 34 |     cacheMetrics.reset(); 35 |  36 |     return NextResponse.json({ 37 |       success: true, 38 |       message: 'Performance metrics cleared' 39 |     }); 40 |   } catch (error) { 41 |     return NextResponse.json( 42 |       { error: 'Failed to clear performance metrics' }, 43 |       { status: 500 } 44 |     ); 45 |   } 46 | }
============================================================END: frontend/app/api/performance/route.ts============================================================


============================================================FILE: frontend/app/api/redis/route.tsSIZE: 2.20 KB============================================================
  1 | import { createClient } from "redis";  2 | import { NextResponse } from "next/server";  3 |   4 | let redis: ReturnType<typeof createClient> | null = null;  5 |   6 | async function getRedisClient() {  7 |   if (!redis) {  8 |     redis = createClient({  9 |       url: process.env.REDIS_URL || process.env.REDISCLOUD_URL || 'redis: 10 |     }); 11 |  12 |     redis.on('error', (err) => { 13 |       }); 14 |  15 |     redis.on('connect', () => { 16 |       }); 17 |  18 |     await redis.connect(); 19 |   } 20 |   return redis; 21 | } 22 |  23 | export async function GET() { 24 |   try { 25 |     const redisClient = await getRedisClient(); 26 |     const value = await redisClient.get("myKey"); 27 |  28 |     return NextResponse.json({ value }); 29 |   } catch (error) { 30 |     return NextResponse.json( 31 |       { error: 'Failed to get value from Redis' }, 32 |       { status: 500 } 33 |     ); 34 |   } 35 | } 36 |  37 | export async function POST(request: Request) { 38 |   try { 39 |     const redisClient = await getRedisClient(); 40 |     const body = await request.json(); 41 |     const { key, value } = body; 42 |  43 |     if (!key || value === undefined) { 44 |       return NextResponse.json( 45 |         { error: 'Key and value are required' }, 46 |         { status: 400 } 47 |       ); 48 |     } 49 |  50 |     await redisClient.set(key, String(value)); 51 |  52 |     return NextResponse.json({ 53 |       success: true, 54 |       key, 55 |       value 56 |     }); 57 |   } catch (error) { 58 |     return NextResponse.json( 59 |       { error: 'Failed to set value in Redis' }, 60 |       { status: 500 } 61 |     ); 62 |   } 63 | } 64 |  65 | export async function DELETE(request: Request) { 66 |   try { 67 |     const redisClient = await getRedisClient(); 68 |     const { searchParams } = new URL(request.url); 69 |     const key = searchParams.get('key'); 70 |  71 |     if (!key) { 72 |       return NextResponse.json( 73 |         { error: 'Key parameter is required' }, 74 |         { status: 400 } 75 |       ); 76 |     } 77 |  78 |     const result = await redisClient.del(key); 79 |  80 |     return NextResponse.json({ 81 |       success: true, 82 |       key, 83 |       deleted: result > 0 84 |     }); 85 |   } catch (error) { 86 |     return NextResponse.json( 87 |       { error: 'Failed to delete key from Redis' }, 88 |       { status: 500 } 89 |     ); 90 |   } 91 | }
============================================================END: frontend/app/api/redis/route.ts============================================================


============================================================FILE: frontend/app/api/redis-test/route.tsSIZE: 3.10 KB============================================================
  1 | import { createClient } from 'redis';  2 | import { NextRequest, NextResponse } from 'next/server';  3 | import { RedisMonitor } from '@/lib/redis';  4 |   5 | export async function GET(request: NextRequest) {  6 |   const startTime = Date.now();  7 |   8 |   try {  9 |  10 |     const redis = createClient({ 11 |       url: process.env.REDIS_URL || process.env.REDISCLOUD_URL || 'redis: 12 |     }); 13 |  14 |     await redis.connect(); 15 |  16 |     const testKey = 'test:item'; 17 |     const testValue = JSON.stringify({ 18 |       message: 'Hello from Redis!', 19 |       timestamp: new Date().toISOString(), 20 |       userAgent: request.headers.get('user-agent') 21 |     }); 22 |  23 |     await redis.setEx(testKey, 300, testValue); 24 |  25 |     const result = await redis.get(testKey); 26 |  27 |     const ttl = await redis.ttl(testKey); 28 |  29 |     await redis.disconnect(); 30 |  31 |     RedisMonitor.recordOperation('redis_test', Date.now() - startTime); 32 |  33 |     return NextResponse.json({ 34 |       success: true, 35 |       data: { 36 |         stored: JSON.parse(result || '{}'), 37 |         ttl, 38 |         redisConnected: true, 39 |         performance: RedisMonitor.getStats() 40 |       } 41 |     }, { status: 200 }); 42 |  43 |   } catch (error) { 44 |  45 |     RedisMonitor.recordOperation('redis_test_error', Date.now() - startTime); 46 |  47 |     return NextResponse.json({ 48 |       success: false, 49 |       error: 'Redis connection failed', 50 |       message: error instanceof Error ? error.message : 'Unknown error', 51 |       fallbackCache: true 52 |     }, { status: 200 }); 53 |   } 54 | } 55 |  56 | export async function POST(request: NextRequest) { 57 |   const startTime = Date.now(); 58 |  59 |   try { 60 |  61 |     const redis = await createClient({ 62 |       url: process.env.REDIS_URL || process.env.REDISCLOUD_URL || 'redis: 63 |     }).connect(); 64 |  65 |     const body = await request.json(); 66 |     const { key, value, ttl = 300 } = body; 67 |  68 |     if (!key || !value) { 69 |       return NextResponse.json({ 70 |         success: false, 71 |         error: 'Missing key or value in request body' 72 |       }, { status: 400 }); 73 |     } 74 |  75 |     await redis.setEx(key, ttl, JSON.stringify(value)); 76 |  77 |     const storedValue = await redis.get(key); 78 |  79 |     await redis.disconnect(); 80 |  81 |     RedisMonitor.recordOperation('redis_set', Date.now() - startTime); 82 |  83 |     return NextResponse.json({ 84 |       success: true, 85 |       data: { 86 |         key, 87 |         stored: JSON.parse(storedValue || '{}'), 88 |         ttl, 89 |         redisConnected: true 90 |       } 91 |     }, { status: 200 }); 92 |  93 |   } catch (error) { 94 |  95 |     RedisMonitor.recordOperation('redis_set_error', Date.now() - startTime); 96 |  97 |     return NextResponse.json({ 98 |       success: false, 99 |       error: 'Failed to store data in Redis',100 |       message: error instanceof Error ? error.message : 'Unknown error'101 |     }, { status: 500 });102 |   }103 | }
============================================================END: frontend/app/api/redis-test/route.ts============================================================


============================================================FILE: frontend/app/api/revalidate/route.tsSIZE: 2.13 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { revalidatePath, revalidateTag } from 'next/cache';  3 |   4 | export async function POST(request: NextRequest) {  5 |   try {  6 |     const { searchParams } = new URL(request.url);  7 |     const path = searchParams.get('path');  8 |     const tag = searchParams.get('tag');  9 |  10 |     if (!path && !tag) { 11 |       return NextResponse.json( 12 |         { error: 'Missing path or tag parameter' }, 13 |         { status: 400 } 14 |       ); 15 |     } 16 |  17 |     if (path) { 18 |  19 |       revalidatePath(path); 20 |       } 21 |  22 |     if (tag) { 23 |  24 |       revalidateTag(tag); 25 |       } 26 |  27 |     revalidatePath('/'); 28 |     revalidatePath('/admin'); 29 |  30 |     revalidateTag('content'); 31 |     revalidateTag('translations'); 32 |     revalidateTag('sections'); 33 |  34 |     return NextResponse.json({ 35 |       success: true, 36 |       message: 'Revalidation completed', 37 |       revalidated: { 38 |         path: path || null, 39 |         tag: tag || null, 40 |         home: '/', 41 |         admin: '/admin', 42 |         contentTags: ['content', 'translations', 'sections'] 43 |       } 44 |     }); 45 |  46 |   } catch (error) { 47 |     return NextResponse.json( 48 |       { 49 |         error: 'Revalidation failed', 50 |         details: error instanceof Error ? error.message : 'Unknown error' 51 |       }, 52 |       { status: 500 } 53 |     ); 54 |   } 55 | } 56 |  57 | export async function GET() { 58 |   return NextResponse.json({ 59 |     message: 'Revalidation endpoint is working', 60 |     usage: { 61 |       method: 'POST', 62 |       parameters: { 63 |         path: 'Optional: Path to revalidate (e.g., /api/revalidate?path=/about)', 64 |         tag: 'Optional: Tag to revalidate (e.g., /api/revalidate?tag=content)' 65 |       }, 66 |       examples: [ 67 |         'POST /api/revalidate?path=/', 68 |         'POST /api/revalidate?tag=content', 69 |         'POST /api/revalidate?path=/&tag=translations' 70 |       ] 71 |     } 72 |   }); 73 | }
============================================================END: frontend/app/api/revalidate/route.ts============================================================


============================================================FILE: frontend/app/api/schedule-slots/route.tsSIZE: 2.81 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { PrismaClient } from '@prisma/client';  3 |   4 | export async function GET(request: NextRequest) {  5 |   const prisma = new PrismaClient();  6 |   7 |   try {  8 |     const { searchParams } = new URL(request.url);  9 |     const availableOnly = searchParams.get('available') === 'true'; 10 |     const date = searchParams.get('date'); 11 |  12 |     const whereClause: Record<string, unknown> = {}; 13 |  14 |     if (availableOnly) { 15 |       whereClause.isAvailable = true; 16 |  17 |       whereClause.OR = [ 18 |         { capacity: null }, 19 |         { 20 |           AND: [ 21 |             { capacity: { not: null } }, 22 |             { bookedCount: { lt: prisma.scheduleSlot.fields.capacity } } 23 |           ] 24 |         } 25 |       ]; 26 |     } 27 |  28 |     if (date) { 29 |       const startOfDay = new Date(date); 30 |       const endOfDay = new Date(date); 31 |       endOfDay.setDate(endOfDay.getDate() + 1); 32 |  33 |       whereClause.startTime = { 34 |         gte: startOfDay, 35 |         lt: endOfDay 36 |       }; 37 |     } 38 |  39 |     const slots = await prisma.scheduleSlot.findMany({ 40 |       where: whereClause, 41 |       select: { 42 |         id: true, 43 |         startTime: true, 44 |         endTime: true, 45 |         capacity: true, 46 |         bookedCount: true, 47 |         isAvailable: true, 48 |         scheduleTemplate: { 49 |           select: { 50 |             sessionDuration: { 51 |               select: { 52 |                 name: true, 53 |                 duration_minutes: true 54 |               } 55 |             } 56 |           } 57 |         } 58 |       }, 59 |       orderBy: [ 60 |         { startTime: 'asc' } 61 |       ] 62 |     }); 63 |  64 |     const transformedSlots = slots.map(slot => ({ 65 |       id: slot.id, 66 |       date: slot.startTime.toISOString().split('T')[0], 67 |       time: slot.startTime.toTimeString().split(' ')[0].substring(0, 5), 68 |       isAvailable: slot.isAvailable && (slot.capacity === null || (slot.bookedCount || 0) < slot.capacity), 69 |       capacity: slot.capacity, 70 |       bookedCount: slot.bookedCount || 0, 71 |       duration: slot.scheduleTemplate.sessionDuration?.duration_minutes || 60, 72 |       sessionType: slot.scheduleTemplate.sessionDuration?.name || 'Standard Session' 73 |     })); 74 |  75 |     return NextResponse.json({ 76 |       success: true, 77 |       slots: transformedSlots 78 |     }); 79 |  80 |   } catch (error) { 81 |     return NextResponse.json({ 82 |       success: false, 83 |       error: 'Failed to fetch schedule slots', 84 |       message: 'An error occurred while fetching schedule slots' 85 |     }, { status: 500 }); 86 |   } finally { 87 |     await prisma.$disconnect(); 88 |   } 89 | }
============================================================END: frontend/app/api/schedule-slots/route.ts============================================================


============================================================FILE: frontend/app/api/schedules/route.tsSIZE: 5.30 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { z } from 'zod';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!  8 | );  9 |  10 | const scheduleCreateSchema = z.object({ 11 |   day_of_week: z.string().min(1, 'Day of week is required'), 12 |   start_time: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)'), 13 |   end_time: z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format (HH:MM)'), 14 |   capacity: z.number().min(1, 'Capacity must be at least 1').max(10, 'Capacity cannot exceed 10').optional(), 15 |   is_available: z.boolean().default(true), 16 |   auto_available: z.boolean().default(true).optional(), 17 |   session_duration_id: z.number().optional() 18 | }); 19 |  20 | export async function GET(request: NextRequest) { 21 |   try { 22 |     const { searchParams } = new URL(request.url); 23 |     const dayOfWeek = searchParams.get('day_of_week'); 24 |     const available = searchParams.get('available'); 25 |  26 |     let query = supabase 27 |       .from('schedule_templates') 28 |       .select('*') 29 |       .order('day_of_week', { ascending: true }) 30 |       .order('start_time', { ascending: true }); 31 |  32 |     if (dayOfWeek) { 33 |       query = query.eq('day_of_week', dayOfWeek); 34 |     } 35 |  36 |     if (available !== null) { 37 |       query = query.eq('is_available', available === 'true'); 38 |     } 39 |  40 |     const { data: schedules, error } = await query; 41 |  42 |     if (error) { 43 |       return NextResponse.json({ 44 |         success: false, 45 |         error: 'Database error', 46 |         message: 'Failed to fetch schedules', 47 |         details: error.message, 48 |         toast: { 49 |           type: 'error', 50 |           title: 'Database Error', 51 |           description: 'Failed to fetch schedules. Please try again.' 52 |         } 53 |       }, { status: 500 }); 54 |     } 55 |  56 |     return NextResponse.json({ 57 |       success: true, 58 |       data: schedules 59 |     }); 60 |  61 |   } catch (error) { 62 |     return NextResponse.json({ 63 |       success: false, 64 |       error: 'Internal server error', 65 |       message: 'An unexpected error occurred', 66 |       toast: { 67 |         type: 'error', 68 |         title: 'Unexpected Error', 69 |         description: 'An unexpected error occurred. Please try again.' 70 |       } 71 |     }, { status: 500 }); 72 |   } 73 | } 74 |  75 | export async function POST(request: NextRequest) { 76 |   try { 77 |     const body = await request.json(); 78 |  79 |     const validation = scheduleCreateSchema.safeParse(body); 80 |     if (!validation.success) { 81 |       return NextResponse.json({ 82 |         success: false, 83 |         error: 'Validation failed', 84 |         message: 'Schedule data validation failed', 85 |         details: validation.error.issues, 86 |         toast: { 87 |           type: 'error', 88 |           title: 'Validation Error', 89 |           description: 'Schedule data validation failed. Please check the form fields.' 90 |         } 91 |       }, { status: 400 }); 92 |     } 93 |  94 |     const scheduleData = validation.data; 95 |  96 |     const { data: existingSchedule } = await supabase 97 |       .from('schedule_templates') 98 |       .select('id') 99 |       .eq('day_of_week', scheduleData.day_of_week)100 |       .eq('start_time', scheduleData.start_time)101 |       .single();102 | 103 |     if (existingSchedule) {104 |       return NextResponse.json({105 |         success: false,106 |         error: 'Schedule already exists',107 |         message: 'A schedule already exists for this day and time',108 |         toast: {109 |           type: 'error',110 |           title: 'Schedule Exists',111 |           description: 'A schedule already exists for this day and time'112 |         }113 |       }, { status: 409 });114 |     }115 | 116 |     const { data, error } = await supabase117 |       .from('schedule_templates')118 |       .insert({119 |         day_of_week: scheduleData.day_of_week,120 |         start_time: scheduleData.start_time,121 |         end_time: scheduleData.end_time,122 |         capacity: scheduleData.capacity,123 |         is_available: scheduleData.is_available,124 |         auto_available: scheduleData.auto_available,125 |         session_duration_id: scheduleData.session_duration_id,126 |         created_at: new Date().toISOString()127 |       })128 |       .select()129 |       .single();130 | 131 |     if (error) {132 |       return NextResponse.json({133 |         success: false,134 |         error: 'Database error',135 |         message: 'Failed to create schedule',136 |         details: error.message,137 |         toast: {138 |           type: 'error',139 |           title: 'Schedule Creation Failed',140 |           description: 'Failed to create schedule. Please try again.'141 |         }142 |       }, { status: 500 });143 |     }144 | 145 |     return NextResponse.json({146 |       success: true,147 |       message: 'Schedule created successfully',148 |       data,149 |       toast: {150 |         type: 'success',151 |         title: 'Success!',152 |         description: `Schedule for ${data.day_of_week} at ${data.start_time} created successfully`153 |       }154 |     }, { status: 201 });155 | 156 |   } catch (error) {157 |     return NextResponse.json({158 |       success: false,159 |       error: 'Internal server error',160 |       message: 'An unexpected error occurred',161 |       toast: {162 |         type: 'error',163 |         title: 'Unexpected Error',164 |         description: 'An unexpected error occurred. Please try again.'165 |       }166 |     }, { status: 500 });167 |   }168 | }
============================================================END: frontend/app/api/schedules/route.ts============================================================


============================================================FILE: frontend/app/api/sections/route.tsSIZE: 6.09 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import { withCache } from '@/lib/cache';  4 |   5 | export const revalidate = 3600;  6 |   7 | export async function GET() {  8 |   const startTime = Date.now();  9 |  10 |   try { 11 |  12 |     const defaultSections = [ 13 |       { 14 |         id: 'invitation', 15 |         type: 'hero', 16 |         title: 'Invitation', 17 |         description: 'Main landing section with cosmic theme', 18 |         icon: 'Star', 19 |         component: 'HeroSection', 20 |         order: 0, 21 |         enabled: true, 22 |         mobileConfig: { 23 |           padding: 'pt-20 pb-12', 24 |           layout: 'center', 25 |           imageSize: 'large' 26 |         }, 27 |         desktopConfig: { 28 |           padding: 'pt-16 pb-20', 29 |           layout: 'center', 30 |           imageSize: 'large' 31 |         } 32 |       }, 33 |       { 34 |         id: 'approach', 35 |         type: 'content', 36 |         title: 'Our Approach', 37 |         description: 'How we work and our methodology', 38 |         icon: 'Compass', 39 |         component: 'ApproachSection', 40 |         order: 1, 41 |         enabled: true, 42 |         mobileConfig: { 43 |           padding: 'pt-20 pb-12', 44 |           layout: 'stack', 45 |           imageSize: 'medium' 46 |         }, 47 |         desktopConfig: { 48 |           padding: 'pt-16 pb-20', 49 |           layout: 'grid', 50 |           imageSize: 'medium' 51 |         } 52 |       }, 53 |       { 54 |         id: 'session', 55 |         type: 'content', 56 |         title: 'Sessions & Services', 57 |         description: 'Available services and session types', 58 |         icon: 'Clock', 59 |         component: 'SessionSection', 60 |         order: 2, 61 |         enabled: true, 62 |         mobileConfig: { 63 |           padding: 'pt-20 pb-12', 64 |           layout: 'stack', 65 |           imageSize: 'medium' 66 |         }, 67 |         desktopConfig: { 68 |           padding: 'pt-16 pb-20', 69 |           layout: 'grid', 70 |           imageSize: 'medium' 71 |         } 72 |       }, 73 |       { 74 |         id: 'about', 75 |         type: 'content', 76 |         title: 'About MatMax Yoga Studio', 77 |         description: 'Information about MatMax Yoga Studio and our approach', 78 |         icon: 'User', 79 |         component: 'AboutSection', 80 |         order: 3, 81 |         enabled: true, 82 |         mobileConfig: { 83 |           padding: 'pt-20 pb-12', 84 |           layout: 'stack', 85 |           imageSize: 'large' 86 |         }, 87 |         desktopConfig: { 88 |           padding: 'pt-16 pb-20', 89 |           layout: 'grid', 90 |           imageSize: 'large' 91 |         } 92 |       }, 93 |       { 94 |         id: 'apply', 95 |         type: 'form', 96 |         title: 'Book Your Session', 97 |         description: 'Booking form and scheduling', 98 |         icon: 'Calendar', 99 |         component: 'BookingSection',100 |         order: 4,101 |         enabled: true,102 |         mobileConfig: {103 |           padding: 'pt-20 pb-12',104 |           layout: 'center',105 |           imageSize: 'small'106 |         },107 |         desktopConfig: {108 |           padding: 'pt-16 pb-20',109 |           layout: 'center',110 |           imageSize: 'small'111 |         }112 |       }113 |     ];114 | 115 |     let sections;116 |     try {117 |       sections = await withCache(118 |         'sections',119 |         async () => {120 |           try {121 |             return await prisma.section.findMany({122 |               where: { enabled: true },123 |               orderBy: { order: 'asc' },124 |               select: {125 |                 sectionId: true,126 |                 type: true,127 |                 title: true,128 |                 description: true,129 |                 icon: true,130 |                 component: true,131 |                 order: true,132 |                 enabled: true,133 |                 mobileConfig: true,134 |                 desktopConfig: true135 |               }136 |             });137 |           } catch {138 |             return [] as Array<Record<string, unknown>>;139 |           }140 |         },141 |         10 * 60 * 1000142 |       );143 | 144 |       if (sections && sections.length > 0) {145 | 146 |         const transformedSections = sections.map(section => ({147 |           id: section.sectionId,148 |           type: section.type,149 |           title: section.title,150 |           description: section.description,151 |           icon: section.icon,152 |           component: section.component,153 |           order: section.order,154 |           enabled: section.enabled,155 |           mobileConfig: section.mobileConfig || {},156 |           desktopConfig: section.desktopConfig || {}157 |         }));158 | 159 |         const processingTime = Date.now() - startTime;160 | 161 |         return NextResponse.json({162 |           success: true,163 |           sections: transformedSections,164 |           timestamp: new Date().toISOString(),165 |           processingTime: `${processingTime}ms`,166 |           source: 'database'167 |         });168 |       }169 |     } catch {170 | 171 |     }172 | 173 |     ');174 | 175 |     const processingTime = Date.now() - startTime;176 | 177 |     return NextResponse.json({178 |       success: true,179 |       sections: defaultSections,180 |       timestamp: new Date().toISOString(),181 |       processingTime: `${processingTime}ms`,182 |       source: 'default',183 |       message: 'Using default section configuration'184 |     });185 | 186 |   } catch (error) {187 |     const processingTime = Date.now() - startTime;188 |     :`, error);189 | 190 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error';191 | 192 |     return NextResponse.json({193 |       error: 'Internal server error',194 |       message: errorMessage,195 |       timestamp: new Date().toISOString(),196 |       processingTime: `${processingTime}ms`,197 |       sections: [198 |         {199 |           id: 'invitation',200 |           type: 'hero',201 |           title: 'Invitation',202 |           description: 'Main landing section with cosmic theme',203 |           icon: 'Star',204 |           component: 'HeroSection',205 |           order: 0,206 |           enabled: true207 |         }208 |       ]209 |     }, { status: 500 });210 |   }211 | }
============================================================END: frontend/app/api/sections/route.ts============================================================


============================================================FILE: frontend/app/api/seo/route.tsSIZE: 1.51 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import { requireAuth } from '@/lib/auth';  4 |   5 | const supabase = createClient(  6 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  7 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  8 | );  9 |  10 | export async function GET() { 11 |   try { 12 |     const { data, error } = await supabase 13 |       .from('seo') 14 |       .select('*') 15 |       .single(); 16 |  17 |     if (error) { 18 |       return NextResponse.json({ error: 'Failed to fetch SEO settings' }, { status: 500 }); 19 |     } 20 |  21 |     return NextResponse.json({ seo: data }); 22 |   } catch (error) { 23 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 24 |   } 25 | } 26 |  27 | export async function POST(request: NextRequest) { 28 |   try { 29 |     const user = await requireAuth(request); 30 |     if (!user) { 31 |       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 }); 32 |     } 33 |  34 |     const body = await request.json(); 35 |  36 |     const { data, error } = await supabase 37 |       .from('seo') 38 |       .upsert(body, { onConflict: 'id' }) 39 |       .select() 40 |       .single(); 41 |  42 |     if (error) { 43 |       return NextResponse.json({ error: 'Failed to update SEO settings' }, { status: 500 }); 44 |     } 45 |  46 |     return NextResponse.json({ seo: data }); 47 |   } catch (error) { 48 |     return NextResponse.json({ error: 'Internal server error' }, { status: 500 }); 49 |   } 50 | }
============================================================END: frontend/app/api/seo/route.ts============================================================


============================================================FILE: frontend/app/api/stripe/create-checkout-session/route.tsSIZE: 2.42 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { StripePaymentService } from '@/lib/stripe/payment-service';  3 |   4 | export async function POST(request: NextRequest) {  5 |   6 |   if (!process.env.STRIPE_SECRET_KEY) {  7 |     return NextResponse.json(  8 |       {  9 |         error: 'Stripe not configured', 10 |         message: 'Payment processing is not available. Please contact support.', 11 |         code: 'STRIPE_NOT_CONFIGURED' 12 |       }, 13 |       { status: 503 } 14 |     ); 15 |   } 16 |  17 |   if (!StripePaymentService) { 18 |     return NextResponse.json( 19 |       { 20 |         error: 'Stripe service unavailable', 21 |         message: 'Payment processing is temporarily unavailable.', 22 |         code: 'STRIPE_SERVICE_UNAVAILABLE' 23 |       }, 24 |       { status: 503 } 25 |     ); 26 |   } 27 |  28 |   try { 29 |  30 |     const body = await request.json(); 31 |     const { 32 |       amount, 33 |       currency, 34 |       description, 35 |       customerEmail, 36 |       customerId, 37 |       metadata, 38 |       successUrl, 39 |       cancelUrl, 40 |     } = body; 41 |  42 |     if (!amount || !currency || !description || !successUrl || !cancelUrl) { 43 |       return NextResponse.json( 44 |         { error: 'Missing required fields' }, 45 |         { status: 400 } 46 |       ); 47 |     } 48 |  49 |     const result = await StripePaymentService.createCheckoutSession({ 50 |       customerId, 51 |       customerEmail, 52 |       lineItems: [ 53 |         { 54 |           price_data: { 55 |             currency: currency.toLowerCase(), 56 |             product_data: { 57 |               name: description, 58 |               description: `Payment for ${description}`, 59 |             }, 60 |             unit_amount: amount, 61 |           }, 62 |           quantity: 1, 63 |         }, 64 |       ], 65 |       successUrl, 66 |       cancelUrl, 67 |       metadata: { 68 |         ...metadata, 69 |         source: 'soulpath_checkout', 70 |         timestamp: new Date().toISOString(), 71 |       }, 72 |     }); 73 |  74 |     if (!result.success) { 75 |       return NextResponse.json( 76 |         { error: result.error }, 77 |         { status: 500 } 78 |       ); 79 |     } 80 |  81 |     return NextResponse.json({ 82 |       success: true, 83 |       sessionId: result.sessionId, 84 |       url: result.url, 85 |     }); 86 |  87 |   } catch (error) { 88 |     return NextResponse.json( 89 |       { error: 'Internal server error' }, 90 |       { status: 500 } 91 |     ); 92 |   } 93 | }
============================================================END: frontend/app/api/stripe/create-checkout-session/route.ts============================================================


============================================================FILE: frontend/app/api/stripe/create-payment-intent/route.tsSIZE: 1.98 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { StripePaymentService } from '@/lib/stripe/payment-service';  3 |   4 | export async function POST(request: NextRequest) {  5 |   6 |   if (!process.env.STRIPE_SECRET_KEY) {  7 |     return NextResponse.json(  8 |       {  9 |         error: 'Stripe not configured', 10 |         message: 'Payment processing is not available. Please contact support.', 11 |         code: 'STRIPE_NOT_CONFIGURED' 12 |       }, 13 |       { status: 503 } 14 |     ); 15 |   } 16 |  17 |   if (!StripePaymentService) { 18 |     return NextResponse.json( 19 |       { 20 |         error: 'Stripe service unavailable', 21 |         message: 'Payment processing is temporarily unavailable.', 22 |         code: 'STRIPE_SERVICE_UNAVAILABLE' 23 |       }, 24 |       { status: 503 } 25 |     ); 26 |   } 27 |  28 |   try { 29 |     const body = await request.json(); 30 |     const { 31 |       amount, 32 |       currency, 33 |       customerEmail, 34 |       customerId, 35 |       metadata, 36 |       description, 37 |     } = body; 38 |  39 |     if (!amount || !currency || !description) { 40 |       return NextResponse.json( 41 |         { error: 'Missing required fields' }, 42 |         { status: 400 } 43 |       ); 44 |     } 45 |  46 |     const result = await StripePaymentService.createPaymentIntent({ 47 |       amount, 48 |       currency: currency.toLowerCase(), 49 |       customerId, 50 |       customerEmail, 51 |       metadata: { 52 |         ...metadata, 53 |         source: 'soulpath_payment_intent', 54 |         timestamp: new Date().toISOString(), 55 |       }, 56 |       description, 57 |     }); 58 |  59 |     if (!result.success) { 60 |       return NextResponse.json( 61 |         { error: result.error }, 62 |         { status: 500 } 63 |       ); 64 |     } 65 |  66 |     return NextResponse.json({ 67 |       success: true, 68 |       clientSecret: result.clientSecret, 69 |       paymentIntentId: result.paymentIntentId, 70 |     }); 71 |  72 |   } catch (error) { 73 |     return NextResponse.json( 74 |       { error: 'Internal server error' }, 75 |       { status: 500 } 76 |     ); 77 |   } 78 | }
============================================================END: frontend/app/api/stripe/create-payment-intent/route.ts============================================================


============================================================FILE: frontend/app/api/stripe/webhook/route.tsSIZE: 9.22 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { createClient } from '@supabase/supabase-js';  3 | import Stripe from 'stripe';  4 | import { headers } from 'next/headers';  5 |   6 | const getStripe = () => {  7 |   const secretKey = process.env.STRIPE_SECRET_KEY;  8 |   if (!secretKey) {  9 |     return null; 10 |   } 11 |   return new Stripe(secretKey, { 12 |     apiVersion: '2025-08-27.basil', 13 |   }); 14 | }; 15 |  16 | const getEndpointSecret = () => { 17 |   const secret = process.env.STRIPE_WEBHOOK_SECRET; 18 |   if (!secret) { 19 |     return null; 20 |   } 21 |   return secret; 22 | }; 23 |  24 | export async function POST(request: NextRequest) { 25 |   try { 26 |     const body = await request.text(); 27 |     const headersList = await headers(); 28 |     const sig = headersList.get('stripe-signature'); 29 |  30 |     if (!sig) { 31 |       return NextResponse.json( 32 |         { error: 'No signature provided' }, 33 |         { status: 400 } 34 |       ); 35 |     } 36 |  37 |     const stripe = getStripe(); 38 |     const endpointSecret = getEndpointSecret(); 39 |  40 |     if (!stripe || !endpointSecret) { 41 |       return NextResponse.json({ received: true, message: 'Stripe webhook disabled' }); 42 |     } 43 |  44 |     let event: Stripe.Event; 45 |  46 |     try { 47 |       event = stripe.webhooks.constructEvent(body, sig, endpointSecret); 48 |     } catch (err) { 49 |       return NextResponse.json( 50 |         { error: 'Invalid signature' }, 51 |         { status: 400 } 52 |       ); 53 |     } 54 |  55 |     const supabase = createClient( 56 |       process.env.NEXT_PUBLIC_SUPABASE_URL!, 57 |       process.env.SUPABASE_SERVICE_ROLE_KEY! 58 |     ); 59 |  60 |     switch (event.type) { 61 |       case 'checkout.session.completed': 62 |         await handleCheckoutSessionCompleted(event.data.object as Stripe.Checkout.Session, supabase); 63 |         break; 64 |  65 |       case 'payment_intent.succeeded': 66 |         await handlePaymentIntentSucceeded(event.data.object as Stripe.PaymentIntent, supabase); 67 |         break; 68 |  69 |       case 'payment_intent.payment_failed': 70 |         await handlePaymentIntentFailed(event.data.object as Stripe.PaymentIntent, supabase); 71 |         break; 72 |  73 |       case 'invoice.payment_succeeded': 74 |         await handleInvoicePaymentSucceeded(event.data.object as Stripe.Invoice); 75 |         break; 76 |  77 |       case 'invoice.payment_failed': 78 |         await handleInvoicePaymentFailed(event.data.object as Stripe.Invoice); 79 |         break; 80 |  81 |       default: 82 |         } 83 |  84 |     return NextResponse.json({ received: true }); 85 |  86 |   } catch (error) { 87 |     return NextResponse.json( 88 |       { error: 'Webhook handler failed' }, 89 |       { status: 500 } 90 |     ); 91 |   } 92 | } 93 |  94 | async function handleCheckoutSessionCompleted(session: Stripe.Checkout.Session, supabase: any) { 95 |   try { 96 |     const metadata = session.metadata; 97 |     if (!metadata) { 98 |       return; 99 |     }100 | 101 |     const customerId = metadata.customer_id;102 |     const packageId = metadata.package_id;103 | 104 |     const quantity = parseInt(metadata.quantity || '1');105 |     const totalAmount = parseFloat(metadata.total_amount || '0');106 | 107 |     const { error: purchaseUpdateError } = await supabase108 |       .from('purchases')109 |       .update({110 |         status: 'completed',111 |         transaction_id: session.payment_intent as string,112 |         updated_at: new Date().toISOString(),113 |         metadata: {114 |           ...session.metadata,115 |           stripe_payment_intent: session.payment_intent,116 |           stripe_customer: session.customer117 |         }118 |       })119 |       .eq('stripe_session_id', session.id);120 | 121 |     if (purchaseUpdateError) {122 |       }123 | 124 |     const { data: packageData, error: packageError } = await supabase125 |       .from('package_definitions')126 |       .select(`127 |         id,128 |         name,129 |         description,130 |         sessions_count,131 |         session_duration_id,132 |         package_type,133 |         max_group_size134 |       `)135 |       .eq('id', packageId)136 |       .single();137 | 138 |     if (packageError || !packageData) {139 |       return;140 |     }141 | 142 |     const { data: purchaseData, error: purchaseError } = await supabase143 |       .from('purchases')144 |       .insert({145 |         user_id: customerId,146 |         total_amount: totalAmount,147 |         currency_code: 'USD',148 |         payment_method: 'stripe',149 |         payment_status: 'completed',150 |         transaction_id: session.payment_intent as string,151 |         purchased_at: new Date().toISOString(),152 |         confirmed_at: new Date().toISOString(),153 |         created_at: new Date().toISOString(),154 |         updated_at: new Date().toISOString()155 |       })156 |       .select()157 |       .single();158 | 159 |     if (purchaseError || !purchaseData) {160 |       return;161 |     }162 | 163 |     for (let i = 0; i < quantity; i++) {164 | 165 |       const { data: packagePrice, error: priceError } = await supabase166 |         .from('package_prices')167 |         .select('id')168 |         .eq('package_definition_id', packageId)169 |         .single();170 | 171 |       if (priceError || !packagePrice) {172 |         continue;173 |       }174 | 175 |       const { error: userPackageError } = await supabase176 |         .from('user_packages')177 |         .insert({178 |           user_id: customerId,179 |           purchase_id: purchaseData.id,180 |           package_price_id: packagePrice.id,181 |           quantity: 1,182 |           sessions_used: 0,183 |           is_active: true,184 |           expires_at: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),185 |           created_at: new Date().toISOString(),186 |           updated_at: new Date().toISOString()187 |         });188 | 189 |       if (userPackageError) {190 |         }191 |     }192 | 193 |     } catch (error) {194 |     }195 | }196 | 197 | async function handlePaymentIntentSucceeded(paymentIntent: Stripe.PaymentIntent, supabase: any) {198 |   try {199 | 200 |     const { error: updateError } = await supabase201 |       .from('purchases')202 |       .update({203 |         status: 'completed',204 |         transaction_id: paymentIntent.id,205 |         updated_at: new Date().toISOString()206 |       })207 |       .eq('transaction_id', paymentIntent.id)208 |       .eq('status', 'pending');209 | 210 |     if (updateError) {211 |       }212 | 213 |   } catch (error) {214 |     }215 | }216 | 217 | async function handlePaymentIntentFailed(paymentIntent: Stripe.PaymentIntent, supabase: any) {218 |   try {219 | 220 |     const { error: updateError } = await supabase221 |       .from('purchases')222 |       .update({223 |         status: 'failed',224 |         updated_at: new Date().toISOString(),225 |         metadata: {226 |           failure_reason: paymentIntent.last_payment_error?.message,227 |           failure_code: paymentIntent.last_payment_error?.code228 |         }229 |       })230 |       .eq('transaction_id', paymentIntent.id);231 | 232 |     if (updateError) {233 |       }234 | 235 |   } catch (error) {236 |     }237 | }238 | 239 | async function handleInvoicePaymentSucceeded(invoice: Stripe.Invoice) {240 |   try {241 | 242 |     if ('subscription' in invoice && invoice.subscription) {243 | 244 |       }245 | 246 |   } catch (error) {247 |     }248 | }249 | 250 | async function handleInvoicePaymentFailed(invoice: Stripe.Invoice) {251 |   try {252 | 253 |     if ('subscription' in invoice && invoice.subscription) {254 |       }255 | 256 |   } catch (error) {257 |     }258 | }
============================================================END: frontend/app/api/stripe/webhook/route.ts============================================================


============================================================FILE: frontend/app/api/telegram/webhook/route.tsSIZE: 13.21 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { ConversationalOrchestrator } from '@/lib/services/conversational-orchestrator';  3 | import { OrchestratorConfig, IntentActionMapping } from '@/lib/types/conversational-orchestrator';  4 |   5 | const orchestratorConfig: OrchestratorConfig = {  6 |   rasa: {  7 |     url: process.env.RASA_URL || 'http:  8 |     model: process.env.RASA_MODEL || 'rasa',  9 |     confidence_threshold: parseFloat(process.env.RASA_CONFIDENCE_THRESHOLD || '0.7') 10 |   }, 11 |   openrouter: { 12 |     apiKey: process.env.OPENROUTER_API_KEY || '', 13 |     baseUrl: process.env.OPENROUTER_BASE_URL || 'https: 14 |     model: process.env.OPENROUTER_MODEL || 'meta-llama/llama-3.3-8b-instruct:free', 15 |     temperature: parseFloat(process.env.OPENROUTER_TEMPERATURE || '0.7'), 16 |     maxTokens: parseInt(process.env.OPENROUTER_MAX_TOKENS || '1000') 17 |   }, 18 |   twilio: { 19 |     accountSid: process.env.TWILIO_ACCOUNT_SID || '', 20 |     authToken: process.env.TWILIO_AUTH_TOKEN || '', 21 |     phoneNumber: process.env.TWILIO_PHONE_NUMBER || '', 22 |     webhookUrl: process.env.TWILIO_WEBHOOK_URL || '' 23 |   }, 24 |   logging: { 25 |     enabled: process.env.LOGGING_ENABLED !== 'false', 26 |     level: (process.env.LOGGING_LEVEL as 'debug' | 'info' | 'warn' | 'error') || 'info', 27 |     storage: (process.env.LOGGING_STORAGE as 'database' | 'file' | 'console') || 'database' 28 |   }, 29 |   apis: { 30 |     baseUrl: process.env.API_BASE_URL || `${process.env.NEXT_PUBLIC_BASE_URL || `http: 31 |     timeout: parseInt(process.env.API_TIMEOUT || '10000'), 32 |     retries: parseInt(process.env.API_RETRIES || '3') 33 |   } 34 | }; 35 |  36 | const intentActionMapping: IntentActionMapping = { 37 |   'greet': { 38 |     action: 'greet_user', 39 |     apiEndpoint: undefined, 40 |     description: undefined 41 |   }, 42 |   'book_session': { 43 |     action: 'book_session', 44 |     apiEndpoint: '/bookings', 45 |     description: 'Te ayudo a reservar una sesión. ¿Qué tipo de sesión te interesa?' 46 |   }, 47 |   'ask_packages': { 48 |     action: 'view_packages', 49 |     apiEndpoint: '/packages', 50 |     description: 'Aquí tienes nuestros paquetes disponibles:' 51 |   }, 52 |   'show_packages': { 53 |     action: 'view_packages', 54 |     apiEndpoint: '/packages', 55 |     description: 'Aquí tienes nuestros paquetes disponibles:' 56 |   }, 57 |   'view_packages': { 58 |     action: 'view_packages', 59 |     apiEndpoint: '/packages', 60 |     description: 'Aquí tienes nuestros paquetes disponibles:' 61 |   }, 62 |   'check_balance': { 63 |     action: 'check_balance', 64 |     apiEndpoint: '/user/balance', 65 |     description: 'Tu saldo actual es:' 66 |   }, 67 |   'contact_support': { 68 |     action: 'contact_support', 69 |     apiEndpoint: undefined, 70 |     description: 'Para contactar soporte, puedes escribirnos a support@soulpath.lat o usar nuestro chat en vivo.' 71 |   }, 72 |   'goodbye': { 73 |     action: 'goodbye', 74 |     apiEndpoint: undefined, 75 |     description: '¡Hasta luego! Que tengas un excelente día. 🙏' 76 |   } 77 | }; 78 |  79 | let orchestrator: ConversationalOrchestrator | null = null; 80 |  81 | function getTelegramOrchestrator(): ConversationalOrchestrator { 82 |   if (!orchestrator) { 83 |     orchestrator = new ConversationalOrchestrator(orchestratorConfig, intentActionMapping); 84 |   } 85 |   return orchestrator; 86 | } 87 |  88 | function getBaseUrl(): string { 89 |  90 |   if (process.env.NEXT_PUBLIC_BASE_URL) { 91 |     return process.env.NEXT_PUBLIC_BASE_URL; 92 |   } 93 |  94 |   let port = process.env.PORT || 3000; 95 |  96 |   if (!process.env.PORT) { 97 |  98 |     port = 3001; 99 |   }100 | 101 |   const baseUrl = `http:102 |   `);103 |   return baseUrl;104 | }105 | 106 | export async function GET() {107 |   try {108 |     return NextResponse.json({109 |       status: 'ok',110 |       channel: 'telegram',111 |       timestamp: new Date().toISOString()112 |     });113 |   } catch (error) {114 |     return NextResponse.json(115 |       { error: 'Internal server error' },116 |       { status: 500 }117 |     );118 |   }119 | }120 | 121 | export async function POST(request: NextRequest) {122 |   try {123 |     const body = await request.json();124 |     );125 | 126 |     if (!body.update_id) {127 |       return NextResponse.json({ status: 'ok' });128 |     }129 | 130 |     const message = body.message;131 |     const callbackQuery = body.callback_query;132 | 133 |     if (message) {134 | 135 |       const chatId = message.chat?.id;136 |       const text = message.text;137 |       const userInfo = message.from;138 | 139 |       if (!chatId || !text) {140 |         return NextResponse.json({ status: 'ok' });141 |       }142 | 143 |       const conversationContext = {144 |         userId: chatId.toString(),145 |         sessionId: `telegram_${chatId}_${message.chat?.id}`,146 |         conversationHistory: []147 |       };148 | 149 |       const lowerText = text.toLowerCase();150 |       const isPackageRequest = lowerText.includes('paquetes') || lowerText.includes('packages') ||151 |                               lowerText.includes('lista') || lowerText.includes('list') ||152 |                               lowerText.includes('mostrar') || lowerText.includes('show') ||153 |                               lowerText.includes('ver') || lowerText.includes('see') ||154 |                               lowerText.includes('dame') || lowerText.includes('give me') ||155 |                               lowerText.includes('precios') || lowerText.includes('prices') ||156 |                               lowerText.includes('precio') || lowerText.includes('price') ||157 |                               lowerText.includes('costo') || lowerText.includes('cost') ||158 |                               lowerText.includes('tarifa') || lowerText.includes('rates') ||159 |                               lowerText.includes('cuánto') || lowerText.includes('how much');160 | 161 |       let response;162 | 163 |       if (isPackageRequest) {164 |         const baseUrl = getBaseUrl();165 |         try {166 |           const hybridResponse = await fetch(`${baseUrl}/api/chat/hybrid`, {167 |             method: 'POST',168 |             headers: {169 |               'Content-Type': 'application/json',170 |             },171 |             body: JSON.stringify({172 |               message: text,173 |               userId: chatId.toString(),174 |               conversationHistory: []175 |             }),176 |           });177 | 178 |           if (hybridResponse.ok) {179 |             const hybridData = await hybridResponse.json();180 |             if (hybridData.success && hybridData.response) {181 |               response = {182 |                 success: true,183 |                 data: {184 |                   text: hybridData.response,185 |                   intent: 'package_request',186 |                   confidence: 0.9,187 |                   entities: []188 |                 }189 |               };190 |             }191 |           }192 |         } catch (error) {193 |           }194 |       }195 | 196 |       if (!response) {197 |         const orchestrator = getTelegramOrchestrator();198 |         response = await orchestrator.processMessage(text, conversationContext);199 |       }200 | 201 |       if (!response || !('success' in response) || !response.success || !response.data || !(response.data as Record<string, unknown>).text) {202 |         const baseUrl = getBaseUrl();203 |         try {204 |           const hybridResponse = await fetch(`${baseUrl}/api/chat/hybrid`, {205 |             method: 'POST',206 |             headers: {207 |               'Content-Type': 'application/json',208 |             },209 |             body: JSON.stringify({210 |               message: text,211 |               userId: chatId.toString(),212 |               conversationHistory: []213 |             }),214 |           });215 | 216 |           if (hybridResponse.ok) {217 |             const hybridData = await hybridResponse.json();218 |             if (hybridData.success && hybridData.response) {219 |               response = {220 |                 success: true,221 |                 data: {222 |                   text: hybridData.response,223 |                   intent: 'hybrid_fallback',224 |                   confidence: 0.8,225 |                   entities: []226 |                 }227 |               };228 |             }229 |           }230 |         } catch (error) {231 |           }232 |       }233 | 234 |       if (response && 'success' in response && response.success && response.data && (response.data as Record<string, unknown>).text) {235 |         const responseText = (response.data as Record<string, unknown>).text as string;236 |         await sendTelegramMessage(chatId.toString(), responseText);237 |         } else {238 |         }239 | 240 |     } else if (callbackQuery) {241 | 242 |       const chatId = callbackQuery.message?.chat?.id;243 |       const data = callbackQuery.data;244 |       const userInfo = callbackQuery.from;245 | 246 |       if (!chatId || !data) {247 |         return NextResponse.json({ status: 'ok' });248 |       }249 | 250 |       const conversationContext = {251 |         userId: chatId.toString(),252 |         sessionId: `telegram_${chatId}_${callbackQuery.message?.chat?.id}`,253 |         conversationHistory: []254 |       };255 | 256 |       const orchestrator = getTelegramOrchestrator();257 |       const response = await orchestrator.processMessage(data, conversationContext);258 | 259 |       if (response && 'success' in response && response.success && response.data && (response.data as Record<string, unknown>).text) {260 |         const responseText = (response.data as Record<string, unknown>).text as string;261 |         await sendTelegramMessage(chatId.toString(), responseText);262 |         } else {263 |         }264 | 265 |       await answerCallbackQuery(callbackQuery.id);266 |     }267 | 268 |     return NextResponse.json({ status: 'ok' });269 | 270 |   } catch (error) {271 |     return NextResponse.json(272 |       { error: 'Internal server error' },273 |       { status: 500 }274 |     );275 |   }276 | }277 | 278 | async function sendTelegramMessage(chatId: string, text: string): Promise<void> {279 |   const botToken = process.env.TELEGRAM_BOT_TOKEN || '8381849581:AAG7bQxK23l5m2MeKJDnMIpGEzy0SeEYSig';280 |   const url = `https:281 | 282 |   try {283 |     const response = await fetch(url, {284 |       method: 'POST',285 |       headers: {286 |         'Content-Type': 'application/json',287 |       },288 |       body: JSON.stringify({289 |         chat_id: chatId,290 |         text: text,291 |         parse_mode: 'HTML'292 |       }),293 |     });294 | 295 |     if (!response.ok) {296 |       const errorText = await response.text();297 |       } else {298 |       }299 |   } catch (error) {300 |     }301 | }302 | 303 | async function answerCallbackQuery(callbackQueryId: string): Promise<void> {304 |   const botToken = process.env.TELEGRAM_BOT_TOKEN || '8381849581:AAG7bQxK23l5m2MeKJDnMIpGEzy0SeEYSig';305 |   const url = `https:306 | 307 |   try {308 |     const response = await fetch(url, {309 |       method: 'POST',310 |       headers: {311 |         'Content-Type': 'application/json',312 |       },313 |       body: JSON.stringify({314 |         callback_query_id: callbackQueryId315 |       }),316 |     });317 | 318 |     if (!response.ok) {319 |       const errorText = await response.text();320 |       } else {321 |       }322 |   } catch (error) {323 |     }324 | }
============================================================END: frontend/app/api/telegram/webhook/route.ts============================================================


============================================================FILE: frontend/app/api/test/db/route.tsSIZE: 3.74 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 | import * as bcrypt from 'bcryptjs';  4 |   5 | export async function GET() {  6 |   try {  7 |   8 |     await prisma.$connect();  9 |  10 |     const userCount = await prisma.user.count(); 11 |  12 |     const users = await prisma.user.findMany({ 13 |       select: { 14 |         id: true, 15 |         email: true, 16 |         role: true, 17 |         fullName: true, 18 |         password: true, 19 |         createdAt: true 20 |       } 21 |     }); 22 |  23 |     try { 24 |       await prisma.user.findUnique({ 25 |         where: { email: 'test@example.com' } 26 |       }); 27 |       } catch (queryError) { 28 |       } 29 |  30 |     )); 31 |  32 |     return NextResponse.json({ 33 |       success: true, 34 |       data: { 35 |         connectionStatus: 'connected', 36 |         userCount, 37 |         users: users.map(u => ({ 38 |           id: u.id, 39 |           email: u.email, 40 |           role: u.role, 41 |           fullName: u.fullName, 42 |           hasPassword: !!u.password, 43 |           createdAt: u.createdAt 44 |         })) 45 |       } 46 |     }); 47 |  48 |   } catch (error) { 49 |     return NextResponse.json({ 50 |       success: false, 51 |       error: 'Database test failed', 52 |       message: error instanceof Error ? error.message : 'Unknown error', 53 |       details: error instanceof Error ? error.stack : undefined 54 |     }, { status: 500 }); 55 |   } 56 | } 57 |  58 | export async function POST(request: NextRequest) { 59 |   try { 60 |     const { email, password, fullName, role } = await request.json(); 61 |  62 |     if (!email || !password) { 63 |       return NextResponse.json({ 64 |         success: false, 65 |         error: 'Missing required fields', 66 |         message: 'Email and password are required' 67 |       }, { status: 400 }); 68 |     } 69 |  70 |     const existingUser = await prisma.user.findUnique({ 71 |       where: { email: email.toLowerCase() } 72 |     }); 73 |  74 |     if (existingUser) { 75 |       return NextResponse.json({ 76 |         success: false, 77 |         error: 'User already exists', 78 |         message: 'A user with this email already exists' 79 |       }, { status: 409 }); 80 |     } 81 |  82 |     const hashedPassword = await bcrypt.hash(password, 12); 83 |  84 |     const user = await prisma.user.create({ 85 |       data: { 86 |         email: email.toLowerCase(), 87 |         password: hashedPassword, 88 |         fullName: fullName || 'Test User', 89 |         role: role || 'admin' 90 |       } 91 |     }); 92 |  93 |     return NextResponse.json({ 94 |       success: true, 95 |       data: { 96 |         id: user.id, 97 |         email: user.email, 98 |         role: user.role, 99 |         fullName: user.fullName,100 |         createdAt: user.createdAt101 |       },102 |       message: 'Test user created successfully'103 |     });104 | 105 |   } catch (error) {106 |     return NextResponse.json({107 |       success: false,108 |       error: 'User creation failed',109 |       message: error instanceof Error ? error.message : 'Unknown error',110 |       details: error instanceof Error ? error.stack : undefined111 |     }, { status: 500 });112 |   }113 | }
============================================================END: frontend/app/api/test/db/route.ts============================================================


============================================================FILE: frontend/app/api/test/logging/route.tsSIZE: 1.28 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { LoggingService } from '@/lib/services/logging-service';  3 |   4 | export async function POST() {  5 |   try {  6 |     const loggingService = new LoggingService({  7 |       enabled: true,  8 |       storage: 'database',  9 |       level: 'info' 10 |     }); 11 |  12 |     const logId = await loggingService.logConversation({ 13 |       sessionId: `test_${Date.now()}`, 14 |       userId: 'test_user', 15 |       message: 'Test message from logging test endpoint', 16 |       userMessage: 'Test message from logging test endpoint', 17 |       botResponse: 'Test response from logging test endpoint', 18 |       rasaIntent: 'test', 19 |       rasaConfidence: 0.9, 20 |       rasaEntities: [], 21 |       responseGenerator: 'test', 22 |       bookingStep: null, 23 |       bookingDataSnapshot: null, 24 |       modelVersion: '1.0.0', 25 |       intent: 'test', 26 |       entities: [], 27 |       action: 'test', 28 |       rasaResponse: 'Test response', 29 |       llmResponse: 'Test response', 30 |       apiCalls: [], 31 |       processingTime: 100, 32 |       success: true, 33 |         error: undefined 34 |     }); 35 |  36 |     return NextResponse.json({ 37 |       success: true, 38 |       logId, 39 |       message: 'Test log created successfully' 40 |     }); 41 |   } catch (error) { 42 |     return NextResponse.json({ 43 |       success: false, 44 |       error: error instanceof Error ? error.message : String(error) 45 |     }, { status: 500 }); 46 |   } 47 | }
============================================================END: frontend/app/api/test/logging/route.ts============================================================


============================================================FILE: frontend/app/api/test/openrouter/route.tsSIZE: 1.15 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { OpenRouterService } from '@/lib/services/openrouter-service';  3 |   4 | export async function GET() {  5 |   try {  6 |     const openRouterService = new OpenRouterService();  7 |   8 |     const response = await openRouterService.handleChitchat({  9 |       userMessage: "Hello, test message", 10 |       conversationHistory: [ 11 |         { role: "user", content: "Hello" }, 12 |         { role: "assistant", content: "Hi there! How can I help you today?" } 13 |       ], 14 |       brandContext: { 15 |         astrologerName: "Jose Garfias", 16 |         services: ["Astrology Reading", "Spiritual Guidance"], 17 |         specialties: ["Natal Chart Analysis", "Career Guidance", "Relationship Counseling"] 18 |       } 19 |     }); 20 |  21 |     return NextResponse.json({ 22 |       success: true, 23 |       message: "OpenRouter is working", 24 |       response: response, 25 |       apiKey: process.env.OPENROUTER_API_KEY ? "Set" : "Not set" 26 |     }); 27 |   } catch (error) { 28 |     return NextResponse.json({ 29 |       success: false, 30 |       error: error instanceof Error ? error.message : String(error), 31 |       apiKey: process.env.OPENROUTER_API_KEY ? "Set" : "Not set" 32 |     }, { status: 500 }); 33 |   } 34 | }
============================================================END: frontend/app/api/test/openrouter/route.ts============================================================


============================================================FILE: frontend/app/api/test/prisma/route.tsSIZE: 2.43 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET() {  5 |   try {  6 |   7 |     await prisma.$connect();  8 |   9 |     const userCount = await prisma.user.count(); 10 |  11 |     const users = await prisma.user.findMany({ 12 |       take: 5, 13 |       select: { 14 |         id: true, 15 |         email: true, 16 |         role: true, 17 |         createdAt: true 18 |       } 19 |     }); 20 |  21 |     const testEmail = 'test@example.com'; 22 |     const uniqueUser = await prisma.user.findUnique({ 23 |       where: { email: testEmail } 24 |     }); 25 |  26 |     const rawResult = await prisma.$queryRaw`SELECT COUNT(*) as count FROM users`; 27 |     return NextResponse.json({ 28 |       success: true, 29 |       data: { 30 |         connectionStatus: 'connected', 31 |         userCount, 32 |         users: users.map(u => ({ 33 |           id: u.id, 34 |           email: u.email, 35 |           role: u.role, 36 |           createdAt: u.createdAt 37 |         })), 38 |         testQueryResults: { 39 |           countQuery: userCount, 40 |           findManyQuery: users.length, 41 |           findUniqueQuery: !!uniqueUser, 42 |           rawQuery: rawResult 43 |         } 44 |       } 45 |     }); 46 |  47 |   } catch (error) { 48 |     return NextResponse.json({ 49 |       success: false, 50 |       error: 'Prisma test failed', 51 |       message: error instanceof Error ? error.message : 'Unknown error', 52 |       details: error instanceof Error ? error.stack : undefined 53 |     }, { status: 500 }); 54 |   } 55 | }
============================================================END: frontend/app/api/test/prisma/route.ts============================================================


============================================================FILE: frontend/app/api/test-packages/route.tsSIZE: 2.19 KB============================================================
  1 | import { NextResponse } from 'next/server';  2 | import { prisma } from '@/lib/prisma';  3 |   4 | export async function GET() {  5 |   try {  6 |   7 |     await prisma.$queryRaw`SELECT 1`;  8 |   9 |     const packages = await prisma.packageDefinition.findMany({ 10 |       where: { 11 |         isActive: true 12 |       }, 13 |       select: { 14 |         id: true, 15 |         name: true, 16 |         description: true, 17 |         sessionsCount: true, 18 |         packageType: true, 19 |         maxGroupSize: true, 20 |         isPopular: true, 21 |         packagePrices: { 22 |           where: { 23 |             isActive: true 24 |           }, 25 |           select: { 26 |             price: true, 27 |             currency: { 28 |               select: { 29 |                 code: true, 30 |                 symbol: true 31 |               } 32 |             } 33 |           }, 34 |           orderBy: { 35 |             price: 'asc' 36 |           }, 37 |           take: 1 38 |         }, 39 |         sessionDuration: { 40 |           select: { 41 |             name: true, 42 |             duration_minutes: true 43 |           } 44 |         } 45 |       }, 46 |       orderBy: { 47 |         displayOrder: 'asc' 48 |       } 49 |     }); 50 |  51 |     const formattedPackages = packages.map(pkg => { 52 |       const price = pkg.packagePrices[0]; 53 |       return { 54 |         id: pkg.id, 55 |         name: pkg.name, 56 |         description: pkg.description || 'No description available', 57 |         sessionsCount: pkg.sessionsCount, 58 |         price: price ? Number(price.price) : 0, 59 |         currency: price?.currency?.symbol || '$', 60 |         duration: pkg.sessionDuration?.duration_minutes || 60, 61 |         isPopular: pkg.isPopular, 62 |         packageType: pkg.packageType, 63 |         maxGroupSize: pkg.maxGroupSize 64 |       }; 65 |     }); 66 |  67 |     return NextResponse.json({ 68 |       success: true, 69 |       packages: formattedPackages, 70 |       count: formattedPackages.length 71 |     }); 72 |  73 |   } catch (error) { 74 |     return NextResponse.json({ 75 |       success: false, 76 |       error: error instanceof Error ? error.message : 'Unknown error', 77 |       packages: [] 78 |     }, { status: 500 }); 79 |   } 80 | }
============================================================END: frontend/app/api/test-packages/route.ts============================================================


============================================================FILE: frontend/app/api/whatsapp/webhook/route.tsSIZE: 6.42 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { ConversationalOrchestrator } from '@/lib/services/conversational-orchestrator';  3 | import { OrchestratorConfig, IntentActionMapping } from '@/lib/types/conversational-orchestrator';  4 |   5 | const orchestratorConfig: OrchestratorConfig = {  6 |   rasa: {  7 |     url: process.env.RASA_URL || 'http:  8 |     model: process.env.RASA_MODEL || 'rasa',  9 |     confidence_threshold: parseFloat(process.env.RASA_CONFIDENCE_THRESHOLD || '0.7') 10 |   }, 11 |   openrouter: { 12 |     apiKey: process.env.OPENROUTER_API_KEY || '', 13 |     baseUrl: process.env.OPENROUTER_BASE_URL || 'https: 14 |     model: process.env.OPENROUTER_MODEL || 'meta-llama/llama-3.3-8b-instruct:free', 15 |     temperature: parseFloat(process.env.OPENROUTER_TEMPERATURE || '0.7'), 16 |     maxTokens: parseInt(process.env.OPENROUTER_MAX_TOKENS || '1000') 17 |   }, 18 |   twilio: { 19 |     accountSid: process.env.TWILIO_ACCOUNT_SID || '', 20 |     authToken: process.env.TWILIO_AUTH_TOKEN || '', 21 |     phoneNumber: process.env.TWILIO_PHONE_NUMBER || '', 22 |     webhookUrl: process.env.TWILIO_WEBHOOK_URL || '' 23 |   }, 24 |   logging: { 25 |     enabled: process.env.LOGGING_ENABLED === 'true', 26 |     level: (process.env.LOGGING_LEVEL as 'debug' | 'info' | 'warn' | 'error') || 'info', 27 |     storage: (process.env.LOGGING_STORAGE as 'database' | 'file' | 'console') || 'console' 28 |   }, 29 |   apis: { 30 |     baseUrl: process.env.API_BASE_URL || `${process.env.NEXT_PUBLIC_BASE_URL || `http: 31 |     timeout: parseInt(process.env.API_TIMEOUT || '10000'), 32 |     retries: parseInt(process.env.API_RETRIES || '3') 33 |   } 34 | }; 35 |  36 | const intentActionMapping: IntentActionMapping = { 37 |   'consulta_estado': { 38 |     action: 'consultar_estado', 39 |     apiEndpoint: '/admin/bookings', 40 |     requiredEntities: ['solicitud_id', 'cita_id', 'email'], 41 |     optionalEntities: ['tipo_consulta'], 42 |     description: 'Consultar el estado de una solicitud o cita' 43 |   }, 44 |   'agendar_cita': { 45 |     action: 'agendar_cita', 46 |     apiEndpoint: '/booking', 47 |     requiredEntities: ['fecha', 'hora', 'email'], 48 |     optionalEntities: ['tipo_sesion', 'paquete_id', 'tamaño_grupo', 'notas'], 49 |     description: 'Agendar una nueva cita' 50 |   }, 51 |   'consultar_paquetes': { 52 |     action: 'consultar_paquetes', 53 |     apiEndpoint: '/packages', 54 |     requiredEntities: [], 55 |     optionalEntities: ['tipo_paquete', 'moneda', 'duración'], 56 |     description: 'Consultar paquetes disponibles' 57 |   }, 58 |   'pagar_servicio': { 59 |     action: 'pagar_servicio', 60 |     apiEndpoint: '/client/purchase', 61 |     requiredEntities: ['monto', 'método_pago', 'email'], 62 |     optionalEntities: ['cita_id', 'paquete_id', 'moneda', 'notas'], 63 |     description: 'Procesar un pago' 64 |   }, 65 |   'cancelar_cita': { 66 |     action: 'cancelar_cita', 67 |     apiEndpoint: '/client/bookings', 68 |     requiredEntities: ['cita_id', 'email'], 69 |     optionalEntities: ['motivo'], 70 |     description: 'Cancelar una cita existente' 71 |   }, 72 |   'consultar_historial': { 73 |     action: 'consultar_historial', 74 |     apiEndpoint: '/client/purchase-history', 75 |     requiredEntities: ['email'], 76 |     optionalEntities: ['tipo_historial', 'fecha_desde', 'fecha_hasta'], 77 |     description: 'Consultar historial del usuario' 78 |   }, 79 |   'consultar_horarios': { 80 |     action: 'consultar_horarios', 81 |     apiEndpoint: '/schedule-slots', 82 |     requiredEntities: [], 83 |     optionalEntities: ['fecha', 'duración', 'tipo_sesion'], 84 |     description: 'Consultar horarios disponibles' 85 |   }, 86 |   'actualizar_perfil': { 87 |     action: 'actualizar_perfil', 88 |     apiEndpoint: '/client/me', 89 |     requiredEntities: ['email'], 90 |     optionalEntities: ['nombre', 'teléfono', 'fecha_nacimiento', 'lugar_nacimiento'], 91 |     description: 'Actualizar información del perfil' 92 |   }, 93 |   'saludo': { 94 |     action: 'saludo', 95 |     requiredEntities: [], 96 |     optionalEntities: ['nombre'], 97 |     description: 'Manejar saludos y bienvenidas' 98 |   }, 99 |   'despedida': {100 |     action: 'despedida',101 |     requiredEntities: [],102 |     optionalEntities: [],103 |     description: 'Manejar despedidas'104 |   },105 |   'ayuda': {106 |     action: 'ayuda',107 |     requiredEntities: [],108 |     optionalEntities: ['tema_ayuda'],109 |     description: 'Proporcionar ayuda y soporte'110 |   }111 | };112 | 113 | let orchestrator: ConversationalOrchestrator | null = null;114 | 115 | function getOrchestrator(): ConversationalOrchestrator {116 |   if (!orchestrator) {117 |     orchestrator = new ConversationalOrchestrator(orchestratorConfig, intentActionMapping);118 |   }119 |   return orchestrator;120 | }121 | 122 | export async function POST(request: NextRequest) {123 |   try {124 |     const body = await request.text();125 |     const signature = request.headers.get('x-twilio-signature');126 | 127 |     const formData = new URLSearchParams(body);128 |     const webhookBody = Object.fromEntries(formData.entries());129 | 130 |     .toISOString()131 |     });132 | 133 |     const orchestrator = getOrchestrator();134 |     const result = await orchestrator.processWhatsAppMessage(webhookBody, signature || undefined);135 | 136 |     if (result.success) {137 |       ?.logId,138 |         processingTime: (result.data as Record<string, unknown>)?.processingTime139 |       });140 | 141 |       return NextResponse.json(result, { status: 200 });142 |     } else {143 |       return NextResponse.json(result, { status: 400 });144 |     }145 | 146 |   } catch (error) {147 |     return NextResponse.json({148 |       success: false,149 |       error: 'Internal server error',150 |       code: 'INTERNAL_ERROR',151 |       details: error instanceof Error ? error.message : 'Unknown error'152 |     }, { status: 500 });153 |   }154 | }155 | 156 | export async function GET() {157 |   try {158 | 159 |     const orchestrator = getOrchestrator();160 |     const healthCheck = await orchestrator.healthCheck();161 | 162 |     return NextResponse.json({163 |       success: true,164 |       message: 'WhatsApp webhook is healthy',165 |       health: healthCheck,166 |       timestamp: new Date().toISOString()167 |     });168 | 169 |   } catch (error) {170 |     return NextResponse.json({171 |       success: false,172 |       error: 'Health check failed',173 |       code: 'HEALTH_CHECK_ERROR',174 |       details: error instanceof Error ? error.message : 'Unknown error'175 |     }, { status: 500 });176 |   }177 | }
============================================================END: frontend/app/api/whatsapp/webhook/route.ts============================================================


============================================================FILE: frontend/app/api/whatsapp-business/webhook/route.tsSIZE: 8.48 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 | import { ConversationalOrchestrator } from '@/lib/services/conversational-orchestrator';  3 | import { OrchestratorConfig, IntentActionMapping } from '@/lib/types/conversational-orchestrator';  4 |   5 | const orchestratorConfig: OrchestratorConfig = {  6 |   rasa: {  7 |     url: process.env.RASA_URL || 'http:  8 |     model: process.env.RASA_MODEL || 'rasa',  9 |     confidence_threshold: parseFloat(process.env.RASA_CONFIDENCE_THRESHOLD || '0.7') 10 |   }, 11 |   openrouter: { 12 |     apiKey: process.env.OPENROUTER_API_KEY || '', 13 |     baseUrl: process.env.OPENROUTER_BASE_URL || 'https: 14 |     model: process.env.OPENROUTER_MODEL || 'meta-llama/llama-3.1-8b-instruct:free', 15 |     temperature: parseFloat(process.env.OPENROUTER_TEMPERATURE || '0.7'), 16 |     maxTokens: parseInt(process.env.OPENROUTER_MAX_TOKENS || '1000') 17 |   }, 18 |   twilio: { 19 |     accountSid: process.env.TWILIO_ACCOUNT_SID || '', 20 |     authToken: process.env.TWILIO_AUTH_TOKEN || '', 21 |     phoneNumber: process.env.TWILIO_PHONE_NUMBER || '', 22 |     webhookUrl: process.env.TWILIO_WEBHOOK_URL || '' 23 |   }, 24 |   logging: { 25 |     enabled: process.env.LOGGING_ENABLED === 'true', 26 |     level: (process.env.LOGGING_LEVEL as 'debug' | 'info' | 'warn' | 'error') || 'info', 27 |     storage: (process.env.LOGGING_STORAGE as 'database' | 'file' | 'console') || 'console' 28 |   }, 29 |   apis: { 30 |     baseUrl: process.env.API_BASE_URL || `${process.env.NEXT_PUBLIC_BASE_URL || `http: 31 |     timeout: parseInt(process.env.API_TIMEOUT || '10000'), 32 |     retries: parseInt(process.env.API_RETRIES || '3') 33 |   } 34 | }; 35 |  36 | const intentActionMapping: IntentActionMapping = { 37 |   'consulta_estado': { 38 |     action: 'consultar_estado', 39 |     apiEndpoint: '/admin/bookings', 40 |     requiredEntities: ['solicitud_id', 'cita_id', 'email'], 41 |     optionalEntities: ['tipo_consulta'], 42 |     description: 'Consultar el estado de una solicitud o cita' 43 |   }, 44 |   'agendar_cita': { 45 |     action: 'agendar_cita', 46 |     apiEndpoint: '/booking', 47 |     requiredEntities: ['fecha', 'hora', 'email'], 48 |     optionalEntities: ['tipo_sesion', 'paquete_id', 'tamaño_grupo', 'notas'], 49 |     description: 'Agendar una nueva cita' 50 |   }, 51 |   'consultar_paquetes': { 52 |     action: 'consultar_paquetes', 53 |     apiEndpoint: '/packages', 54 |     requiredEntities: [], 55 |     optionalEntities: ['tipo_paquete', 'moneda', 'duración'], 56 |     description: 'Consultar paquetes disponibles' 57 |   }, 58 |   'pagar_servicio': { 59 |     action: 'pagar_servicio', 60 |     apiEndpoint: '/client/purchase', 61 |     requiredEntities: ['monto', 'método_pago', 'email'], 62 |     optionalEntities: ['cita_id', 'paquete_id', 'moneda', 'notas'], 63 |     description: 'Procesar un pago' 64 |   }, 65 |   'cancelar_cita': { 66 |     action: 'cancelar_cita', 67 |     apiEndpoint: '/client/bookings', 68 |     requiredEntities: ['cita_id', 'email'], 69 |     optionalEntities: ['motivo'], 70 |     description: 'Cancelar una cita existente' 71 |   }, 72 |   'consultar_historial': { 73 |     action: 'consultar_historial', 74 |     apiEndpoint: '/client/purchase-history', 75 |     requiredEntities: ['email'], 76 |     optionalEntities: ['tipo_historial', 'fecha_desde', 'fecha_hasta'], 77 |     description: 'Consultar historial del usuario' 78 |   }, 79 |   'consultar_horarios': { 80 |     action: 'consultar_horarios', 81 |     apiEndpoint: '/schedule-slots', 82 |     requiredEntities: [], 83 |     optionalEntities: ['fecha', 'duración', 'tipo_sesion'], 84 |     description: 'Consultar horarios disponibles' 85 |   }, 86 |   'actualizar_perfil': { 87 |     action: 'actualizar_perfil', 88 |     apiEndpoint: '/client/me', 89 |     requiredEntities: ['email'], 90 |     optionalEntities: ['nombre', 'teléfono', 'fecha_nacimiento', 'lugar_nacimiento'], 91 |     description: 'Actualizar información del perfil' 92 |   }, 93 |   'saludo': { 94 |     action: 'saludo', 95 |     requiredEntities: [], 96 |     optionalEntities: ['nombre'], 97 |     description: 'Manejar saludos y bienvenidas' 98 |   }, 99 |   'despedida': {100 |     action: 'despedida',101 |     requiredEntities: [],102 |     optionalEntities: [],103 |     description: 'Manejar despedidas'104 |   },105 |   'ayuda': {106 |     action: 'ayuda',107 |     requiredEntities: [],108 |     optionalEntities: ['tema_ayuda'],109 |     description: 'Proporcionar ayuda y soporte'110 |   }111 | };112 | 113 | let orchestrator: ConversationalOrchestrator | null = null;114 | 115 | function getOrchestrator(): ConversationalOrchestrator {116 |   if (!orchestrator) {117 |     orchestrator = new ConversationalOrchestrator(orchestratorConfig, intentActionMapping);118 |   }119 |   return orchestrator;120 | }121 | 122 | async function sendWhatsAppMessage(phoneNumberId: string, accessToken: string, to: string, message: string) {123 |   const url = `https:124 | 125 |   const payload = {126 |     messaging_product: "whatsapp",127 |     to: to,128 |     type: "text",129 |     text: {130 |       body: message131 |     }132 |   };133 | 134 |   const response = await fetch(url, {135 |     method: 'POST',136 |     headers: {137 |       'Authorization': `Bearer ${accessToken}`,138 |       'Content-Type': 'application/json',139 |     },140 |     body: JSON.stringify(payload)141 |   });142 | 143 |   if (!response.ok) {144 |     const error = await response.text();145 |     throw new Error(`WhatsApp API error: ${response.status} - ${error}`);146 |   }147 | 148 |   return await response.json();149 | }150 | 151 | export async function GET(request: NextRequest) {152 |   try {153 |     const { searchParams } = new URL(request.url);154 |     const mode = searchParams.get('hub.mode');155 |     const token = searchParams.get('hub.verify_token');156 |     const challenge = searchParams.get('hub.challenge');157 | 158 |     if (mode === 'subscribe' && token === process.env.WHATSAPP_VERIFY_TOKEN) {159 |       return new NextResponse(challenge, { status: 200 });160 |     } else {161 |       return new NextResponse('Forbidden', { status: 403 });162 |     }163 | 164 |   } catch (error) {165 |     return new NextResponse('Internal Server Error', { status: 500 });166 |   }167 | }168 | 169 | export async function POST(request: NextRequest) {170 |   try {171 |     const body = await request.json();172 | 173 |     .toISOString()174 |     });175 | 176 |     if (body.object === 'whatsapp_business_account') {177 |       const entries = body.entry || [];178 | 179 |       for (const entry of entries) {180 |         const changes = entry.changes || [];181 | 182 |         for (const change of changes) {183 |           if (change.field === 'messages') {184 |             const messages = change.value.messages || [];185 | 186 |             for (const message of messages) {187 |               if (message.type === 'text') {188 |                 const from = message.from;189 |                 const text = message.text.body;190 | 191 |                 const orchestrator = getOrchestrator();192 |                 const result = await orchestrator.processMessage(text, from);193 | 194 |                 if (result.success && (result.data as Record<string, unknown>).response) {195 | 196 |                   await sendWhatsAppMessage(197 |                     process.env.WHATSAPP_PHONE_NUMBER_ID || '',198 |                     process.env.WHATSAPP_ACCESS_TOKEN || '',199 |                     from,200 |                     (result.data as Record<string, unknown>).response as string201 |                   );202 | 203 |                   } else {204 | 205 |                   await sendWhatsAppMessage(206 |                     process.env.WHATSAPP_PHONE_NUMBER_ID || '',207 |                     process.env.WHATSAPP_ACCESS_TOKEN || '',208 |                     from,209 |                     'Lo siento, no pude procesar tu mensaje. Por favor intenta de nuevo.'210 |                   );211 |                 }212 |               }213 |             }214 |           }215 |         }216 |       }217 |     }218 | 219 |     return NextResponse.json({ status: 'ok' }, { status: 200 });220 | 221 |   } catch (error) {222 |     return NextResponse.json({223 |       success: false,224 |       error: 'Internal server error',225 |       code: 'INTERNAL_ERROR',226 |       details: error instanceof Error ? error.message : 'Unknown error'227 |     }, { status: 500 });228 |   }229 | }
============================================================END: frontend/app/api/whatsapp-business/webhook/route.ts============================================================


============================================================FILE: frontend/app/error.tsxSIZE: 2.35 KB============================================================
  1 | 'use client';  2 |   3 | import { Button } from '@/components/ui/button';  4 | import { AlertCircle, RefreshCw, Home } from 'lucide-react';  5 |   6 | export default function Error({  7 |   error,  8 |   reset  9 | }: { 10 |   error: Error & { digest?: string }; 11 |   reset: () => void 12 | }) { 13 |   return ( 14 |     <div className="flex h-screen flex-col items-center justify-center bg-[#0a0a0a] text-white"> 15 |       <div className="relative"> 16 |         {} 17 |         <div className="absolute inset-0 bg-gradient-to-b from-[#0a0a0a] via-[#1a1a2e] to-[#16213e] opacity-50" /> 18 |  19 |         {} 20 |         <div className="relative z-10 text-center max-w-md mx-auto px-6"> 21 |           <div className="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6"> 22 |             <AlertCircle size={40} className="text-red-400" /> 23 |           </div> 24 |  25 |           <h2 className="text-3xl font-bold mb-4 text-[#FFD700]">Oops! Something went wrong</h2> 26 |  27 |           <p className="text-[#C0C0C0] mb-8 leading-relaxed"> 28 |             We encountered an unexpected error while loading your page. 29 |             This might be a temporary issue that will resolve itself. 30 |           </p> 31 |  32 |           {process.env.NODE_ENV === 'development' && ( 33 |             <details className="mb-6 text-left"> 34 |               <summary className="cursor-pointer text-[#FFD700] mb-2">Error Details</summary> 35 |               <pre className="bg-[#1a1a2e] p-4 rounded-lg text-sm text-red-400 overflow-auto"> 36 |                 {error.message} 37 |                 {error.stack && `\n\n${error.stack}`} 38 |               </pre> 39 |             </details> 40 |           )} 41 |  42 |           <div className="flex flex-col sm:flex-row gap-4 justify-center"> 43 |             <Button 44 |               onClick={() => reset()} 45 |               className="bg-[#FFD700] text-[#0a0a0a] hover:bg-[#FFA500] transition-colors" 46 |             > 47 |               <RefreshCw size={16} className="mr-2" /> 48 |               Try Again 49 |             </Button> 50 |  51 |             <Button 52 |               onClick={() => window.location.href = '/'} 53 |               variant="outline" 54 |               className="border-[#FFD700] text-[#FFD700] hover:bg-[#FFD700] hover:text-[#0a0a0a] transition-colors" 55 |             > 56 |               <Home size={16} className="mr-2" /> 57 |               Go Home 58 |             </Button> 59 |           </div> 60 |         </div> 61 |       </div> 62 |     </div> 63 |   ); 64 | }
============================================================END: frontend/app/error.tsx============================================================


============================================================FILE: frontend/app/fonts.tsSIZE: 0.33 KB============================================================
  1 | import { Poppins, Roboto } from 'next/font/google';  2 |   3 | export const poppins = Poppins({  4 |   subsets: ['latin'],  5 |   weight: ['300', '400', '500', '600', '700', '900'],  6 |   variable: '--font-heading',  7 | });  8 |   9 | export const roboto = Roboto({ 10 |   subsets: ['latin'], 11 |   weight: ['300', '400', '500', '600', '700', '900'], 12 |   variable: '--font-body', 13 | });
============================================================END: frontend/app/fonts.ts============================================================


============================================================FILE: frontend/app/izipay-demo/page.tsxSIZE: 10.07 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Input } from '@/components/ui/input';  6 | import { Label } from '@/components/ui/label';  7 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  8 | import { Separator } from '@/components/ui/separator';  9 | import { Badge } from '@/components/ui/badge'; 10 | import IzipayPaymentButton from '@/components/izipay/IzipayPaymentButton'; 11 | import IzipayPaymentMethod from '@/components/izipay/IzipayPaymentMethod'; 12 |  13 | export default function IzipayDemoPage() { 14 |   const [paymentData, setPaymentData] = useState({ 15 |     amount: 100.00, 16 |     currency: 'PEN', 17 |     customerEmail: 'test@example.com', 18 |     customerName: 'Test Customer', 19 |     description: 'Wellness Services Demo Payment', 20 |   }); 21 |  22 |   const [paymentVariant, setPaymentVariant] = useState<'button' | 'inline' | 'card'>('card'); 23 |  24 |   const handleInputChange = (field: string, value: string | number) => { 25 |     setPaymentData(prev => ({ 26 |       ...prev, 27 |       [field]: value 28 |     })); 29 |   }; 30 |  31 |   const handlePaymentSuccess = (result: Record<string, unknown>) => { 32 |     alert('¡Pago exitoso! Revisa la consola para más detalles.'); 33 |   }; 34 |  35 |   const handlePaymentError = (error: string) => { 36 |     alert(`Error en el pago: ${error}`); 37 |   }; 38 |  39 |   const formatAmount = (amount: number, currency: string) => { 40 |     const formatter = new Intl.NumberFormat('es-PE', { 41 |       style: 'currency', 42 |       currency: currency, 43 |       minimumFractionDigits: 2, 44 |     }); 45 |     return formatter.format(amount); 46 |   }; 47 |  48 |   return ( 49 |     <div className="container mx-auto py-8 px-4 max-w-6xl"> 50 |       <div className="mb-8 text-center"> 51 |         <h1 className="text-3xl font-bold mb-2">Izipay Payment Demo</h1> 52 |         <p className="text-gray-600"> 53 |           Demonstración de la integración de pagos con Izipay para Perú 54 |         </p> 55 |         <Badge variant="outline" className="mt-2"> 56 |           Modo de Prueba 57 |         </Badge> 58 |       </div> 59 |  60 |       <div className="grid grid-cols-1 lg:grid-cols-2 gap-8"> 61 |         {} 62 |         <Card> 63 |           <CardHeader> 64 |             <CardTitle>Configuración del Pago</CardTitle> 65 |             <CardDescription> 66 |               Configura los parámetros de tu pago de prueba 67 |             </CardDescription> 68 |           </CardHeader> 69 |           <CardContent className="space-y-4"> 70 |             <div className="grid grid-cols-2 gap-4"> 71 |               <div> 72 |                 <Label htmlFor="amount">Monto</Label> 73 |                 <Input 74 |                   id="amount" 75 |                   type="number" 76 |                   step="0.01" 77 |                   min="1" 78 |                   value={paymentData.amount} 79 |                   onChange={(e) => handleInputChange('amount', parseFloat(e.target.value) || 0)} 80 |                 /> 81 |               </div> 82 |               <div> 83 |                 <Label htmlFor="currency">Moneda</Label> 84 |                 <Select value={paymentData.currency} onValueChange={(value) => handleInputChange('currency', value)}> 85 |                   <SelectTrigger> 86 |                     <SelectValue /> 87 |                   </SelectTrigger> 88 |                   <SelectContent> 89 |                     <SelectItem value="PEN">PEN - Sol Peruano</SelectItem> 90 |                     <SelectItem value="USD">USD - Dólar Americano</SelectItem> 91 |                   </SelectContent> 92 |                 </Select> 93 |               </div> 94 |             </div> 95 |  96 |             <div> 97 |               <Label htmlFor="customerEmail">Email del Cliente</Label> 98 |               <Input 99 |                 id="customerEmail"100 |                 type="email"101 |                 value={paymentData.customerEmail}102 |                 onChange={(e) => handleInputChange('customerEmail', e.target.value)}103 |               />104 |             </div>105 | 106 |             <div>107 |               <Label htmlFor="customerName">Nombre del Cliente</Label>108 |               <Input109 |                 id="customerName"110 |                 value={paymentData.customerName}111 |                 onChange={(e) => handleInputChange('customerName', e.target.value)}112 |               />113 |             </div>114 | 115 |             <div>116 |               <Label htmlFor="description">Descripción</Label>117 |               <Input118 |                 id="description"119 |                 value={paymentData.description}120 |                 onChange={(e) => handleInputChange('description', e.target.value)}121 |               />122 |             </div>123 | 124 |             <Separator />125 | 126 |             <div>127 |               <Label htmlFor="variant">Tipo de Componente</Label>128 |               <Select value={paymentVariant} onValueChange={(value: string) => setPaymentVariant(value as 'button' | 'inline' | 'card')}>129 |                 <SelectTrigger>130 |                   <SelectValue />131 |                 </SelectTrigger>132 |                 <SelectContent>133 |                   <SelectItem value="button">Botón Simple</SelectItem>134 |                   <SelectItem value="card">Tarjeta Completa</SelectItem>135 |                   <SelectItem value="inline">Formulario Integrado</SelectItem>136 |                 </SelectContent>137 |               </Select>138 |             </div>139 | 140 |             <div className="p-3 bg-blue-50 rounded-lg">141 |               <p className="text-sm text-blue-800">142 |                 <strong>Total:</strong> {formatAmount(paymentData.amount, paymentData.currency)}143 |               </p>144 |             </div>145 |           </CardContent>146 |         </Card>147 | 148 |         {}149 |         <Card>150 |           <CardHeader>151 |             <CardTitle>Componente de Pago</CardTitle>152 |             <CardDescription>153 |               Vista previa del componente de pago seleccionado154 |             </CardDescription>155 |           </CardHeader>156 |           <CardContent>157 |             {paymentVariant === 'button' && (158 |               <IzipayPaymentButton159 |                 amount={paymentData.amount}160 |                 currency={paymentData.currency}161 |                 customerEmail={paymentData.customerEmail}162 |                 customerName={paymentData.customerName}163 |                 description={paymentData.description}164 |                 onSuccess={handlePaymentSuccess}165 |                 onError={handlePaymentError}166 |               />167 |             )}168 | 169 |             {paymentVariant === 'card' && (170 |               <IzipayPaymentMethod171 |                 amount={paymentData.amount}172 |                 currency={paymentData.currency}173 |                 customerEmail={paymentData.customerEmail}174 |                 customerName={paymentData.customerName}175 |                 description={paymentData.description}176 |                 variant="card"177 |                 showFeatures={true}178 |                 onSuccess={handlePaymentSuccess}179 |                 onError={handlePaymentError}180 |               />181 |             )}182 | 183 |             {paymentVariant === 'inline' && (184 |               <div className="text-center py-8 text-gray-500">185 |                 <p>El formulario integrado requiere configuración adicional</p>186 |                 <p className="text-sm">Ver IZIPAY_INTEGRATION.md para más detalles</p>187 |               </div>188 |             )}189 |           </CardContent>190 |         </Card>191 |       </div>192 | 193 |       {}194 |       <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">195 |         <Card>196 |           <CardHeader>197 |             <CardTitle className="text-lg">🔒 Seguridad</CardTitle>198 |           </CardHeader>199 |           <CardContent>200 |             <ul className="text-sm space-y-1 text-gray-600">201 |               <li>• 3D Secure authentication</li>202 |               <li>• Tokenización de tarjetas</li>203 |               <li>• Encriptación SSL/TLS</li>204 |               <li>• Verificación de webhooks</li>205 |             </ul>206 |           </CardContent>207 |         </Card>208 | 209 |         <Card>210 |           <CardHeader>211 |             <CardTitle className="text-lg">💳 Tarjetas Aceptadas</CardTitle>212 |           </CardHeader>213 |           <CardContent>214 |             <ul className="text-sm space-y-1 text-gray-600">215 |               <li>• Visa</li>216 |               <li>• Mastercard</li>217 |               <li>• American Express</li>218 |               <li>• Diners Club</li>219 |             </ul>220 |           </CardContent>221 |         </Card>222 | 223 |         <Card>224 |           <CardHeader>225 |             <CardTitle className="text-lg">🌎 Cobertura</CardTitle>226 |           </CardHeader>227 |           <CardContent>228 |             <ul className="text-sm space-y-1 text-gray-600">229 |               <li>• Específico para Perú</li>230 |               <li>• Moneda: Sol Peruano (PEN)</li>231 |               <li>• Regulaciones locales</li>232 |               <li>• Soporte en español</li>233 |             </ul>234 |           </CardContent>235 |         </Card>236 |       </div>237 | 238 |       {}239 |       <Card className="mt-8">240 |         <CardHeader>241 |           <CardTitle>🧪 Tarjetas de Prueba</CardTitle>242 |           <CardDescription>243 |             Usa estas tarjetas en el entorno de sandbox para probar diferentes escenarios244 |           </CardDescription>245 |         </CardHeader>246 |         <CardContent>247 |           <div className="grid grid-cols-1 md:grid-cols-3 gap-4">248 |             <div className="p-3 bg-green-50 rounded-lg">249 |               <p className="font-medium text-green-800">Pago Exitoso</p>250 |               <p className="text-sm text-green-600 font-mono">4970100000000003</p>251 |             </div>252 |             <div className="p-3 bg-red-50 rounded-lg">253 |               <p className="font-medium text-red-800">Pago Fallido</p>254 |               <p className="text-sm text-red-600 font-mono">4970100000000004</p>255 |             </div>256 |             <div className="p-3 bg-blue-50 rounded-lg">257 |               <p className="font-medium text-blue-800">3D Secure</p>258 |               <p className="text-sm text-blue-600 font-mono">4970100000000005</p>259 |             </div>260 |           </div>261 |           <p className="text-xs text-gray-500 mt-2">262 |             Usa cualquier CVV (3 dígitos) y fecha de expiración futura263 |           </p>264 |         </CardContent>265 |       </Card>266 | 267 |       {}268 |       <div className="text-center mt-8 text-sm text-gray-500">269 |         <p>270 |           Para más información, consulta la documentación en{' '}271 |           <code className="bg-gray-100 px-1 rounded">IZIPAY_INTEGRATION.md</code>272 |         </p>273 |       </div>274 |     </div>275 |   );276 | }
============================================================END: frontend/app/izipay-demo/page.tsx============================================================


============================================================FILE: frontend/app/layout.tsxSIZE: 2.54 KB============================================================
  1 | import type { Metadata } from 'next';  2 | import { poppins, roboto } from './fonts';  3 | import './globals.css';  4 | import { createAdminClient } from '@/lib/supabase/admin';  5 | import { cn } from '@/lib/utils';  6 | import { ThemeProvider } from '@/lib/theme/ThemeProvider';  7 |   8 | async function getSeoData() {  9 |  10 |   const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY; 11 |   if (!serviceRoleKey || serviceRoleKey.length < 50) { 12 |     return null; 13 |   } 14 |  15 |   try { 16 |     const supabase = createAdminClient(); 17 |     const { data } = await supabase.from('seo').select('*').single(); 18 |     return data; 19 |   } catch (error) { 20 |  21 |     return null; 22 |   } 23 | } 24 |  25 | export async function generateMetadata(): Promise<Metadata> { 26 |   let seo = null; 27 |  28 |   try { 29 |     seo = await getSeoData(); 30 |   } catch (error) { 31 |  32 |   } 33 |  34 |   return { 35 |     title: seo?.title || 'MatMax Yoga Studio', 36 |     description: seo?.description || 'Strategic astrological counsel to navigate your life\'s most pivotal moments.', 37 |     keywords: seo?.keywords || ['astrology', 'counseling', 'spiritual guidance'], 38 |     openGraph: { 39 |       title: seo?.ogTitle || seo?.title || 'MatMax Yoga Studio', 40 |       description: seo?.ogDescription || seo?.description || 'Strategic astrological counsel to navigate your life\'s most pivotal moments.', 41 |       images: seo?.ogImage ? [seo.ogImage] : [], 42 |       type: 'website', 43 |     }, 44 |     twitter: { 45 |       card: 'summary_large_image', 46 |       title: seo?.ogTitle || seo?.title || 'MatMax Yoga Studio', 47 |       description: seo?.ogDescription || seo?.description || 'Strategic astrological counsel to navigate your life\'s most pivotal moments.', 48 |       images: seo?.ogImage ? [seo.ogImage] : [], 49 |     }, 50 |   }; 51 | } 52 |  53 | export const viewport = { 54 |   width: 'device-width', 55 |   initialScale: 1.0, 56 |   maximumScale: 1.0, 57 |   userScalable: false, 58 |   viewportFit: 'cover', 59 |   themeColor: '#0A0A23', 60 | }; 61 |  62 | export default function RootLayout({ 63 |   children, 64 | }: { 65 |   children: React.ReactNode; 66 | }) { 67 |   return ( 68 |     <html lang="en" className={`${poppins.variable} ${roboto.variable}`}> 69 |       <body className={cn( 70 |         "antialiased", 71 |         poppins.variable, 72 |         roboto.variable 73 |       )}> 74 |         <ThemeProvider initialTheme="light"> 75 |           {children} 76 |         </ThemeProvider> 77 |       </body> 78 |     </html> 79 |   ); 80 | }
============================================================END: frontend/app/layout.tsx============================================================


============================================================FILE: frontend/app/loading.tsxSIZE: 0.80 KB============================================================
  1 | export default function Loading() {  2 |   return (  3 |     <div className="flex h-screen w-full items-center justify-center bg-[#0a0a0a]">  4 |       <div className="relative">  5 |         {}  6 |         <div className="absolute inset-0 bg-gradient-to-b from-[#0a0a0a] via-[#1a1a2e] to-[#16213e] opacity-50" />  7 |   8 |         {}  9 |         <div className="relative z-10"> 10 |           <div className="w-16 h-16 border-4 border-[#FFD700]/20 border-t-[#FFD700] rounded-full animate-spin" /> 11 |           <div className="mt-4 text-center"> 12 |             <div className="w-2 h-2 bg-[#FFD700] rounded-full animate-bounce mx-auto mb-2" /> 13 |             <p className="text-[#FFD700] text-lg font-semibold">Loading MatMax Yoga Studio...</p> 14 |           </div> 15 |         </div> 16 |       </div> 17 |     </div> 18 |   ); 19 | }
============================================================END: frontend/app/loading.tsx============================================================


============================================================FILE: frontend/app/login/page.tsxSIZE: 7.62 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect } from 'react';  4 | import { useRouter } from 'next/navigation';  5 | import { useAuth } from '@/hooks/useAuth';  6 | import { motion } from 'framer-motion';  7 | import { Header } from '@/components/Header';  8 | import { useTranslations, useLanguage } from '@/hooks/useTranslations';  9 | import { Eye, EyeOff } from 'lucide-react'; 10 |  11 | export default function LoginPage() { 12 |   const [email, setEmail] = useState(''); 13 |   const [password, setPassword] = useState(''); 14 |   const [isLoading, setIsLoading] = useState(false); 15 |   const [error, setError] = useState(''); 16 |   const [isMenuOpen, setIsMenuOpen] = useState(false); 17 |   const [showPassword, setShowPassword] = useState(false); 18 |   const router = useRouter(); 19 |   const { signIn, user, isAdmin } = useAuth(); 20 |   const { language, setLanguage } = useLanguage(); 21 |   const { t } = useTranslations(); 22 |   const translations = t as Record<string, string | Record<string, string>>; 23 |  24 |   useEffect(() => { 25 |     if (user) { 26 |       if (isAdmin) { 27 |         router.push('/admin'); 28 |       } else { 29 |         router.push('/account'); 30 |       } 31 |     } 32 |   }, [user, isAdmin, router]); 33 |  34 |   const handleSubmit = async (e: React.FormEvent) => { 35 |     e.preventDefault(); 36 |     setIsLoading(true); 37 |     setError(''); 38 |  39 |     try { 40 |       const { data, error: signInError } = await signIn(email, password); 41 |  42 |       if (signInError) { 43 |         setError((signInError as any)?.message || 'Login failed'); 44 |         return; 45 |       } 46 |  47 |       } catch (error) { 48 |       setError('An unexpected error occurred'); 49 |     } finally { 50 |       setIsLoading(false); 51 |     } 52 |   }; 53 |  54 |   const scrollToSection = (section: string) => { 55 |  56 |     }; 57 |  58 |   const handleLoginClick = () => { 59 |  60 |     }; 61 |  62 |   return ( 63 |     <div className="min-h-screen bg-white"> 64 |       {} 65 |       <Header 66 |         language={language} 67 |         setLanguage={setLanguage} 68 |         scrollToSection={scrollToSection} 69 |         t={translations} 70 |         isMenuOpen={isMenuOpen} 71 |         setIsMenuOpen={setIsMenuOpen} 72 |         onLoginClick={handleLoginClick} 73 |         user={user} 74 |         isAdmin={isAdmin} 75 |       /> 76 |  77 |       {} 78 |       <section className="relative min-h-screen flex items-center justify-center pt-24"> 79 |         {} 80 |         <div 81 |           className="absolute inset-0 bg-cover bg-center bg-no-repeat" 82 |           style={{ 83 |             backgroundImage: 'url("/matmaxstudio.png")', 84 |           }} 85 |         > 86 |           <div className="absolute inset-0 bg-black bg-opacity-60"></div> 87 |         </div> 88 |  89 |         {} 90 |         <div className="relative z-10 w-full max-w-md mx-4"> 91 |           <motion.div 92 |             initial={{ opacity: 0, y: 20 }} 93 |             animate={{ opacity: 1, y: 0 }} 94 |             transition={{ duration: 0.5 }} 95 |             className="bg-white/95 backdrop-blur-sm rounded-2xl p-8 shadow-2xl border border-white/20" 96 |           > 97 |             {} 98 |             <div className="text-center mb-8"> 99 |               <h1100 |                 className="text-3xl font-bold text-gray-800 mb-2"101 |                 style={{ fontFamily: 'var(--font-heading)' }}102 |               >103 |                 Welcome Back104 |               </h1>105 |               <p106 |                 className="text-gray-600"107 |                 style={{ fontFamily: 'var(--font-body)' }}108 |               >109 |                 Sign in to your account110 |               </p>111 |             </div>112 | 113 |             {}114 |             <form onSubmit={handleSubmit} className="space-y-6">115 |               {error && (116 |                 <motion.div117 |                   initial={{ opacity: 0, y: -10 }}118 |                   animate={{ opacity: 1, y: 0 }}119 |                   className="bg-red-50 border border-red-200 rounded-lg p-3 text-red-700 text-sm"120 |                 >121 |                   {error}122 |                 </motion.div>123 |               )}124 | 125 |               <div>126 |                 <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-2">127 |                   Email Address128 |                 </label>129 |                 <input130 |                   id="email"131 |                   type="email"132 |                   value={email}133 |                   onChange={(e) => setEmail(e.target.value)}134 |                   required135 |                   className="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#6ea058] focus:border-transparent transition-all duration-200"136 |                   placeholder="Enter your email"137 |                   disabled={isLoading}138 |                 />139 |               </div>140 | 141 |               <div>142 |                 <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-2">143 |                   Password144 |                 </label>145 |                 <div className="relative">146 |                   <input147 |                     id="password"148 |                     type={showPassword ? "text" : "password"}149 |                     value={password}150 |                     onChange={(e) => setPassword(e.target.value)}151 |                     required152 |                     className="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#6ea058] focus:border-transparent transition-all duration-200"153 |                     placeholder="Enter your password"154 |                     disabled={isLoading}155 |                   />156 |                   <button157 |                     type="button"158 |                     onClick={() => setShowPassword(!showPassword)}159 |                     className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none focus:text-gray-700 transition-colors duration-200"160 |                     disabled={isLoading}161 |                   >162 |                     {showPassword ? (163 |                       <EyeOff size={20} />164 |                     ) : (165 |                       <Eye size={20} />166 |                     )}167 |                   </button>168 |                 </div>169 |               </div>170 | 171 |               <motion.button172 |                 type="submit"173 |                 disabled={isLoading}174 |                 whileHover={{ scale: 1.02 }}175 |                 whileTap={{ scale: 0.98 }}176 |                 className="w-full bg-[#6ea058] hover:bg-[#5a8a4a] text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"177 |                 style={{ fontFamily: 'var(--font-body)' }}178 |               >179 |                 {isLoading ? (180 |                   <div className="flex items-center justify-center">181 |                     <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>182 |                     Signing In...183 |                   </div>184 |                 ) : (185 |                   'Sign In'186 |                 )}187 |               </motion.button>188 |             </form>189 | 190 |             {}191 |             <div className="mt-6 text-center">192 |               <button193 |                 onClick={() => router.push('/')}194 |                 className="text-[#6ea058] hover:text-[#5a8a4a] transition-colors duration-200 text-sm font-medium"195 |                 style={{ fontFamily: 'var(--font-body)' }}196 |               >197 |                 ← Back to Home198 |               </button>199 |             </div>200 |           </motion.div>201 |         </div>202 |       </section>203 |     </div>204 |   );205 | }
============================================================END: frontend/app/login/page.tsx============================================================


============================================================FILE: frontend/app/not-found.tsxSIZE: 0.72 KB============================================================
  1 | import Link from 'next/link';  2 |   3 | export default function NotFound() {  4 |   return (  5 |     <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#191970] to-[#0A0A23] text-white">  6 |       <div className="text-center">  7 |         <h1 className="text-6xl font-bold text-[#FFD700] mb-4">404</h1>  8 |         <h2 className="text-2xl mb-4">Page Not Found</h2>  9 |         <p className="text-[#C0C0C0] mb-8"> 10 |           The page you&apos;re looking for doesn&apos;t exist. 11 |         </p> 12 |         <Link 13 |           href="/" 14 |           className="inline-block bg-[#FFD700] text-[#0A0A23] px-6 py-3 rounded-lg font-semibold hover:bg-[#FFD700]/90 transition-colors" 15 |         > 16 |           Go Home 17 |         </Link> 18 |       </div> 19 |     </div> 20 |   ); 21 | }
============================================================END: frontend/app/not-found.tsx============================================================


============================================================FILE: frontend/app/packages/page.tsxSIZE: 33.51 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { motion, AnimatePresence } from 'framer-motion';  5 | import { Package, CheckCircle, ArrowRight, ArrowLeft, Clock, Users, Star, Loader2, AlertCircle } from 'lucide-react';  6 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  7 | import { Input } from '@/components/ui/input';  8 | import { Label } from '@/components/ui/label';  9 | import { IzipayPaymentMethod } from '@/components/izipay/IzipayPaymentMethod'; 10 | import { Header } from '@/components/Header'; 11 | import { useTranslations, useLanguage } from '@/hooks/useTranslations'; 12 | import { usePackages, PackagePrice } from '@/hooks/usePackages'; 13 | import { toast } from 'sonner'; 14 |  15 | interface ScheduleSlot { 16 |   id: number; 17 |   startTime: string; 18 |   endTime: string; 19 |   capacity: number; 20 |   bookedCount: number; 21 |   isAvailable: boolean; 22 |   instructorName?: string; 23 |   scheduleTemplate: { 24 |     dayOfWeek: string; 25 |     sessionDuration: { 26 |       name: string; 27 |       duration_minutes: number; 28 |     }; 29 |   }; 30 | } 31 |  32 | interface BookingFormData { 33 |   clientName: string; 34 |   clientEmail: string; 35 |   clientPhone: string; 36 |   countryCode: string; 37 |   language: 'en' | 'es'; 38 |   selectedPackage: PackagePrice | null; 39 |   selectedScheduleSlot: ScheduleSlot | null; 40 |   skipBooking: boolean; 41 |   specialRequests?: string; 42 | } 43 |  44 | export default function PackagesPage() { 45 |  46 |   const { packages, loading, error, refetch } = usePackages('PEN'); 47 |   const [scheduleSlots, setScheduleSlots] = useState<ScheduleSlot[]>([ 48 |     { 49 |       id: 1, 50 |       startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), 51 |       endTime: new Date(Date.now() + 24 * 60 * 60 * 1000 + 60 * 60 * 1000).toISOString(), 52 |       capacity: 10, 53 |       bookedCount: 3, 54 |       isAvailable: true, 55 |       scheduleTemplate: { 56 |         dayOfWeek: 'Monday', 57 |         sessionDuration: { 58 |           name: '60 Minutes', 59 |           duration_minutes: 60 60 |         } 61 |       }, 62 |       instructorName: 'Sarah Johnson' 63 |     }, 64 |     { 65 |       id: 2, 66 |       startTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(), 67 |       endTime: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000 + 60 * 60 * 1000).toISOString(), 68 |       capacity: 8, 69 |       bookedCount: 1, 70 |       isAvailable: true, 71 |       scheduleTemplate: { 72 |         dayOfWeek: 'Tuesday', 73 |         sessionDuration: { 74 |           name: '60 Minutes', 75 |           duration_minutes: 60 76 |         } 77 |       }, 78 |       instructorName: 'Mike Chen' 79 |     }, 80 |     { 81 |       id: 3, 82 |       startTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(), 83 |       endTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000 + 60 * 60 * 1000).toISOString(), 84 |       capacity: 12, 85 |       bookedCount: 5, 86 |       isAvailable: true, 87 |       scheduleTemplate: { 88 |         dayOfWeek: 'Wednesday', 89 |         sessionDuration: { 90 |           name: '60 Minutes', 91 |           duration_minutes: 60 92 |         } 93 |       }, 94 |       instructorName: 'Emma Wilson' 95 |     } 96 |   ]); 97 |   const [currentStep, setCurrentStep] = useState(0); 98 |   const [isMenuOpen, setIsMenuOpen] = useState(false); 99 |   const [isCountryDropdownOpen, setIsCountryDropdownOpen] = useState(false);100 | 101 |   const { language, setLanguage } = useLanguage();102 | 103 |   const countries = [104 |     { code: '+51', flag: '🇵🇪', name: 'Peru', country: 'PE' },105 |     { code: '+1', flag: '🇺🇸', name: 'United States', country: 'US' },106 |     { code: '+1', flag: '🇨🇦', name: 'Canada', country: 'CA' },107 |     { code: '+52', flag: '🇲🇽', name: 'Mexico', country: 'MX' },108 |     { code: '+54', flag: '🇦🇷', name: 'Argentina', country: 'AR' },109 |     { code: '+55', flag: '🇧🇷', name: 'Brazil', country: 'BR' },110 |     { code: '+56', flag: '🇨🇱', name: 'Chile', country: 'CL' },111 |     { code: '+57', flag: '🇨🇴', name: 'Colombia', country: 'CO' },112 |     { code: '+58', flag: '🇻🇪', name: 'Venezuela', country: 'VE' },113 |     { code: '+34', flag: '🇪🇸', name: 'Spain', country: 'ES' },114 |     { code: '+33', flag: '🇫🇷', name: 'France', country: 'FR' },115 |     { code: '+49', flag: '🇩🇪', name: 'Germany', country: 'DE' },116 |     { code: '+44', flag: '🇬🇧', name: 'United Kingdom', country: 'GB' },117 |     { code: '+39', flag: '🇮🇹', name: 'Italy', country: 'IT' },118 |     { code: '+86', flag: '🇨🇳', name: 'China', country: 'CN' },119 |     { code: '+81', flag: '🇯🇵', name: 'Japan', country: 'JP' },120 |     { code: '+82', flag: '🇰🇷', name: 'South Korea', country: 'KR' },121 |     { code: '+91', flag: '🇮🇳', name: 'India', country: 'IN' },122 |     { code: '+61', flag: '🇦🇺', name: 'Australia', country: 'AU' }123 |   ];124 | 125 |   const { t } = useTranslations();126 |   const translations = t as Record<string, string | Record<string, string>>;127 | 128 |   const [formData, setFormData] = useState<BookingFormData>({129 |     clientName: '',130 |     clientEmail: '',131 |     clientPhone: '',132 |     countryCode: '+51',133 |     language: 'en',134 |     selectedPackage: null,135 |     selectedScheduleSlot: null,136 |     skipBooking: false137 |   });138 | 139 |   const selectedCountry = countries.find(c => c.code === formData.countryCode) || countries[0];140 | 141 |   const steps = [142 |     { id: 0, name: 'Select Package', description: 'Choose your package' },143 |     { id: 1, name: 'Personal Info', description: 'Your details' },144 |     { id: 2, name: 'Booking', description: 'Schedule your session' },145 |     { id: 3, name: 'Payment', description: 'Complete purchase' }146 |   ];147 | 148 |   const handleLoginClick = () => {149 | 150 |     };151 | 152 |   const scrollToSection = (section: string) => {153 | 154 |     };155 | 156 |   useEffect(() => {157 | 158 |     loadScheduleSlots();159 |   }, []);160 | 161 |   const loadScheduleSlots = async () => {162 |     try {163 |       const response = await fetch('/api/schedule-slots');164 |       const data = await response.json();165 | 166 |       if (data.success) {167 | 168 |         const transformedSlots = data.slots.map((slot: Record<string, unknown>) => ({169 |           id: slot.id,170 |           startTime: new Date(`${slot.date as string}T${slot.time as string}`).toISOString(),171 |           endTime: new Date(new Date(`${slot.date as string}T${slot.time as string}`).getTime() + ((slot.duration as number) * 60000)).toISOString(),172 |           capacity: slot.capacity,173 |           bookedCount: slot.bookedCount,174 |           isAvailable: slot.isAvailable,175 |           scheduleTemplate: {176 |             dayOfWeek: new Date(slot.date as string).toLocaleDateString('en-US', { weekday: 'long' }),177 |             sessionDuration: {178 |               name: slot.sessionType as string,179 |               duration_minutes: slot.duration as number180 |             }181 |           },182 |           instructorName: 'Available'183 |         }));184 |         setScheduleSlots(transformedSlots);185 |       } else {186 |         setScheduleSlots([]);187 |       }188 |     } catch (error) {189 |       setScheduleSlots([]);190 |     }191 |   };192 | 193 |   useEffect(() => {194 |     const handleClickOutside = (event: MouseEvent) => {195 |       if (isCountryDropdownOpen) {196 |         const target = event.target as Element;197 |         if (!target.closest('.country-dropdown')) {198 |           setIsCountryDropdownOpen(false);199 |         }200 |       }201 |     };202 | 203 |     document.addEventListener('mousedown', handleClickOutside);204 |     return () => {205 |       document.removeEventListener('mousedown', handleClickOutside);206 |     };207 |   }, [isCountryDropdownOpen]);208 | 209 |   useEffect(() => {210 |     if (currentStep === 3) {211 | 212 |       document.body.style.overflow = 'auto';213 |       document.documentElement.style.overflow = 'auto';214 |     }215 |   }, [currentStep]);216 | 217 |   const handlePackageSelect = (pkg: PackagePrice) => {218 |     setFormData(prev => ({ ...prev, selectedPackage: pkg }));219 |     setCurrentStep(1);220 |   };221 | 222 |   const handlePaymentSuccess = async (paymentData: Record<string, unknown>) => {223 |     try {224 | 225 |       const purchaseResponse = await fetch('/api/client/purchase', {226 |         method: 'POST',227 |         headers: {228 |           'Content-Type': 'application/json',229 |         },230 |         body: JSON.stringify({231 |           packagePriceId: formData.selectedPackage?.id,232 |           quantity: 1,233 |           clientName: formData.clientName,234 |           clientEmail: formData.clientEmail,235 |           clientPhone: `${formData.countryCode}${formData.clientPhone}`,236 |           language: formData.language,237 |           paymentMethod: 'izipay',238 |           paymentData: paymentData239 |         })240 |       });241 | 242 |       const purchaseResult = await purchaseResponse.json();243 | 244 |       if (purchaseResult.success) {245 | 246 |         if (!formData.skipBooking && formData.selectedScheduleSlot) {247 |           const bookingResponse = await fetch('/api/client/bookings', {248 |             method: 'POST',249 |             headers: {250 |               'Content-Type': 'application/json',251 |             },252 |             body: JSON.stringify({253 |               userPackageId: purchaseResult.data.userPackageId,254 |               scheduleSlotId: formData.selectedScheduleSlot.id,255 |               sessionType: formData.selectedPackage?.packageDefinition.name || 'Standard Reading',256 |               notes: formData.specialRequests257 |             })258 |           });259 | 260 |           const bookingResult = await bookingResponse.json();261 | 262 |           if (bookingResult.success) {263 |             toast.success('Purchase and booking completed successfully!');264 |           } else {265 |             toast.success('Purchase completed! You can book your session later.');266 |           }267 |         } else {268 |           toast.success('Purchase completed! You can book your session later.');269 |         }270 | 271 |         setFormData({272 |           clientName: '',273 |           clientEmail: '',274 |           clientPhone: '',275 |           countryCode: '+51',276 |           language: 'en',277 |           selectedPackage: null,278 |           selectedScheduleSlot: null,279 |           skipBooking: false280 |         });281 |         setCurrentStep(0);282 |       } else {283 |         throw new Error(purchaseResult.message || 'Purchase failed');284 |       }285 |     } catch (error) {286 |       toast.error('Failed to complete purchase');287 |     }288 |   };289 | 290 |   const handlePaymentError = (error: string) => {291 |     toast.error(`Payment failed: ${error}`);292 |   };293 | 294 |   return (295 |     <div className="min-h-screen bg-white packages-page inner-page mobile-scrollable">296 |       <Header297 |         language={language}298 |         setLanguage={setLanguage}299 |         scrollToSection={scrollToSection}300 |         t={translations}301 |         isMenuOpen={isMenuOpen}302 |         setIsMenuOpen={setIsMenuOpen}303 |         onLoginClick={handleLoginClick}304 |         user={null}305 |         isAdmin={false}306 |       />307 | 308 |       {}309 |       <div className="container mx-auto px-4 py-8 pt-24 mobile-scrollable">310 |         <div className="text-center mb-12">311 |           <h1312 |             className="text-4xl md:text-6xl font-bold mb-6 text-primary"313 |             style={{ fontFamily: 'var(--font-heading)' }}314 |           >315 |             Choose Your Package316 |           </h1>317 |           <p318 |             className="text-xl text-muted max-w-3xl mx-auto"319 |             style={{ fontFamily: 'var(--font-body)' }}320 |           >321 |             Select the perfect package for your spiritual journey and book your session322 |           </p>323 |         </div>324 | 325 |         {}326 |         <div className="mb-12">327 |           <div className="flex justify-center">328 |             <div className="flex items-center space-x-4">329 |               {steps.map((step, index) => (330 |                 <div key={step.id} className="flex items-center">331 |                   <div className={`flex items-center justify-center w-10 h-10 rounded-full border-2 ${332 |                     currentStep >= step.id333 |                       ? 'bg-primary border-primary text-white'334 |                       : 'border-gray-400 text-gray-400'335 |                   }`}>336 |                     {currentStep > step.id ? (337 |                       <CheckCircle className="w-6 h-6" />338 |                     ) : (339 |                       <span className="font-semibold">{step.id + 1}</span>340 |                     )}341 |                   </div>342 |                   <div className="ml-3">343 |                     <p className={`font-semibold ${344 |                       currentStep >= step.id ? 'text-primary' : 'text-gray-400'345 |                     }`}>346 |                       {step.name}347 |                     </p>348 |                     <p className="text-sm text-gray-500">{step.description}</p>349 |                   </div>350 |                   {index < steps.length - 1 && (351 |                     <ArrowRight className="w-5 h-5 text-gray-400 mx-4" />352 |                   )}353 |                 </div>354 |               ))}355 |             </div>356 |           </div>357 |         </div>358 | 359 |         {}360 |         <AnimatePresence mode="wait">361 |           {currentStep === 0 && (362 |             <motion.div363 |               key="packages"364 |               initial={{ opacity: 0, x: 20 }}365 |               animate={{ opacity: 1, x: 0 }}366 |               exit={{ opacity: 0, x: -20 }}367 |               className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"368 |             >369 |               {loading ? (370 |                 <div className="col-span-full text-center py-12">371 |                   <Loader2 className="w-8 h-8 animate-spin mx-auto mb-4 text-primary" />372 |                   <p className="text-muted text-lg">Loading packages...</p>373 |                 </div>374 |               ) : error ? (375 |                 <div className="col-span-full text-center py-12">376 |                   <AlertCircle className="w-8 h-8 mx-auto mb-4 text-red-500" />377 |                   <p className="text-red-600 text-lg mb-4">Error loading packages: {error}</p>378 |                   <button379 |                     onClick={refetch}380 |                     className="btn-primary"381 |                   >382 |                     Try Again383 |                   </button>384 |                 </div>385 |               ) : packages.length === 0 ? (386 |                 <div className="col-span-full text-center py-12">387 |                   <Package className="w-8 h-8 mx-auto mb-4 text-muted" />388 |                   <p className="text-muted text-lg">No packages available at the moment.</p>389 |                   <button390 |                     onClick={refetch}391 |                     className="btn-primary mt-4"392 |                   >393 |                     Refresh394 |                   </button>395 |                 </div>396 |               ) : (397 |                 packages.map((pkg) => (398 |                 <Card key={pkg.id} className="card-base card-hover hover-scale">399 |                   <CardHeader className="text-center">400 |                     <div className="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">401 |                       <Package className="w-8 h-8 text-white" />402 |                     </div>403 |                     <CardTitle404 |                       className="text-2xl text-primary"405 |                       style={{ fontFamily: 'var(--font-heading)' }}406 |                     >407 |                       {pkg.packageDefinition.name}408 |                     </CardTitle>409 |                     <div410 |                       className="text-3xl font-bold text-black"411 |                       style={{ fontFamily: 'var(--font-heading)' }}412 |                     >413 |                       {pkg.currency.symbol}{pkg.price}414 |                     </div>415 |                   </CardHeader>416 |                   <CardContent>417 |                     <p418 |                       className="text-muted mb-6 text-center"419 |                       style={{ fontFamily: 'var(--font-body)' }}420 |                     >421 |                       {pkg.packageDefinition.description}422 |                     </p>423 |                     <div className="space-y-3 mb-6">424 |                       <div className="flex items-center text-sm">425 |                         <Users className="w-4 h-4 mr-2 text-primary" />426 |                         <span className="text-muted">{pkg.packageDefinition.sessionsCount} Sessions</span>427 |                       </div>428 |                       <div className="flex items-center text-sm">429 |                         <Clock className="w-4 h-4 mr-2 text-primary" />430 |                         <span className="text-muted">{pkg.packageDefinition.sessionDuration.duration_minutes} minutes each</span>431 |                       </div>432 |                       <div className="flex items-center text-sm">433 |                         <Star className="w-4 h-4 mr-2 text-primary" />434 |                         <span className="text-muted">Personalized guidance</span>435 |                       </div>436 |                     </div>437 |                     <button438 |                       onClick={() => handlePackageSelect(pkg)}439 |                       className="btn-primary w-full"440 |                     >441 |                       Select Package442 |                     </button>443 |                   </CardContent>444 |                 </Card>445 |                 ))446 |               )}447 |             </motion.div>448 |           )}449 | 450 |           {currentStep === 1 && (451 |             <motion.div452 |               key="personal-info"453 |               initial={{ opacity: 0, x: 20 }}454 |               animate={{ opacity: 1, x: 0 }}455 |               exit={{ opacity: 0, x: -20 }}456 |               className="max-w-2xl mx-auto"457 |             >458 |               <Card className="card-base">459 |                 <CardHeader>460 |                   <CardTitle461 |                     className="text-2xl text-primary text-center"462 |                     style={{ fontFamily: 'var(--font-heading)' }}463 |                   >464 |                     Personal Information465 |                   </CardTitle>466 |                 </CardHeader>467 |                 <CardContent className="space-y-6">468 |                   <div className="grid grid-cols-1 md:grid-cols-2 gap-4">469 |                     <div>470 |                       <Label htmlFor="clientName" className="text-black">Full Name *</Label>471 |                       <Input472 |                         id="clientName"473 |                         value={formData.clientName}474 |                         onChange={(e) => setFormData(prev => ({ ...prev, clientName: e.target.value }))}475 |                         className="border-gray-300 text-black placeholder-gray-400"476 |                         placeholder="Enter your full name"477 |                         required478 |                       />479 |                     </div>480 |                     <div>481 |                       <Label htmlFor="clientEmail" className="text-black">Email *</Label>482 |                       <Input483 |                         id="clientEmail"484 |                         type="email"485 |                         value={formData.clientEmail}486 |                         onChange={(e) => setFormData(prev => ({ ...prev, clientEmail: e.target.value }))}487 |                         className="border-gray-300 text-black placeholder-gray-400"488 |                         placeholder="Enter your email"489 |                         required490 |                       />491 |                     </div>492 |                   </div>493 | 494 |                   <div className="grid grid-cols-1 md:grid-cols-2 gap-4">495 |                     <div>496 |                       <Label htmlFor="clientPhone" className="text-black">Phone *</Label>497 |                       <div className="relative">498 |                         {}499 |                         <div className="absolute inset-y-0 left-0 z-10 country-dropdown">500 |                           <button501 |                             type="button"502 |                             onClick={() => setIsCountryDropdownOpen(!isCountryDropdownOpen)}503 |                             className="h-full w-24 px-3 flex items-center space-x-1 border-r border-gray-300 bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"504 |                           >505 |                             <span className="text-sm">{selectedCountry.flag}</span>506 |                             <span className="text-sm text-gray-700">{selectedCountry.code}</span>507 |                             <svg className="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">508 |                               <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />509 |                             </svg>510 |                           </button>511 | 512 |                           {}513 |                           {isCountryDropdownOpen && (514 |                             <div className="absolute top-full left-0 mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg z-20 max-h-60 overflow-y-auto">515 |                               {countries.map((country) => (516 |                                 <button517 |                                   key={country.country}518 |                                   type="button"519 |                                   onClick={() => {520 |                                     setFormData(prev => ({ ...prev, countryCode: country.code }));521 |                                     setIsCountryDropdownOpen(false);522 |                                   }}523 |                                   className="w-full px-3 py-2 text-left hover:bg-gray-100 flex items-center space-x-3"524 |                                 >525 |                                   <span className="text-sm">{country.flag}</span>526 |                                   <span className="text-sm text-gray-700">{country.code}</span>527 |                                   <span className="text-sm text-gray-500">{country.name}</span>528 |                                 </button>529 |                               ))}530 |                             </div>531 |                           )}532 |                         </div>533 | 534 |                         <Input535 |                           id="clientPhone"536 |                           type="tel"537 |                           value={formData.clientPhone}538 |                           onChange={(e) => setFormData(prev => ({ ...prev, clientPhone: e.target.value }))}539 |                           className="border-gray-300 text-black placeholder-gray-400 pl-24 h-10 flex items-center"540 |                           placeholder="987654321"541 |                           required542 |                         />543 |                       </div>544 |                     </div>545 |                     <div>546 |                       {}547 |                     </div>548 |                   </div>549 | 550 |                   <div className="flex justify-between pt-4">551 |                     <button552 |                       onClick={() => setCurrentStep(0)}553 |                       className="btn-outline"554 |                     >555 |                       <ArrowLeft className="w-4 h-4 mr-2" />556 |                       Back557 |                     </button>558 |                     <button559 |                       onClick={() => setCurrentStep(2)}560 |                       className="btn-primary"561 |                     >562 |                       Continue563 |                       <ArrowRight className="w-4 h-4 ml-2" />564 |                     </button>565 |                   </div>566 |                 </CardContent>567 |               </Card>568 |             </motion.div>569 |           )}570 | 571 |           {currentStep === 2 && (572 |             <motion.div573 |               key="booking"574 |               initial={{ opacity: 0, x: 20 }}575 |               animate={{ opacity: 1, x: 0 }}576 |               exit={{ opacity: 0, x: -20 }}577 |               className="max-w-4xl mx-auto"578 |             >579 |               <Card className="card-base">580 |                 <CardHeader>581 |                   <CardTitle582 |                     className="text-2xl text-primary text-center"583 |                     style={{ fontFamily: 'var(--font-heading)' }}584 |                   >585 |                     Schedule Your Session586 |                   </CardTitle>587 |                   <p588 |                     className="text-muted text-center"589 |                     style={{ fontFamily: 'var(--font-body)' }}590 |                   >591 |                     Choose a time that works for you, or skip to book later592 |                   </p>593 |                 </CardHeader>594 |                 <CardContent>595 |                   {}596 |                   <div className="mb-6">597 |                     <div className="flex items-center space-x-2 p-4 border border-gray-200 rounded-lg">598 |                       <input599 |                         type="checkbox"600 |                         id="skipBooking"601 |                         checked={formData.skipBooking}602 |                         onChange={(e) => setFormData(prev => ({ ...prev, skipBooking: e.target.checked, selectedScheduleSlot: null }))}603 |                         className="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary"604 |                       />605 |                       <label htmlFor="skipBooking" className="text-sm text-gray-700 cursor-pointer">606 |                         Skip booking for now - I&apos;ll book later from my account607 |                       </label>608 |                     </div>609 |                   </div>610 | 611 |                   {}612 |                   {!formData.skipBooking && (613 |                     <div>614 |                       <h4 className="text-lg font-semibold text-black mb-4" style={{ fontFamily: 'var(--font-heading)' }}>615 |                         Available Time Slots616 |                       </h4>617 |                       {scheduleSlots.length > 0 ? (618 |                         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">619 |                           {scheduleSlots.slice(0, 12).map((slot) => (620 |                             <Card621 |                               key={slot.id}622 |                               className={`cursor-pointer transition-all duration-300 ${623 |                                 slot.isAvailable && slot.bookedCount < slot.capacity624 |                                   ? formData.selectedScheduleSlot?.id === slot.id625 |                                     ? 'border-primary bg-primary/10'626 |                                     : 'card-base card-hover border-gray-300 hover:border-primary'627 |                                   : 'bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed'628 |                               }`}629 |                               onClick={() => {630 |                                 if (slot.isAvailable && slot.bookedCount < slot.capacity) {631 |                                   setFormData(prev => ({ ...prev, selectedScheduleSlot: slot }));632 |                                 }633 |                               }}634 |                             >635 |                               <CardContent className="p-4 text-center">636 |                                 <div className="text-sm text-muted">637 |                                   {new Date(slot.startTime).toLocaleDateString('en-US', {638 |                                     weekday: 'short',639 |                                     month: 'short',640 |                                     day: 'numeric'641 |                                   })}642 |                                 </div>643 |                                 <div644 |                                   className="font-semibold text-black"645 |                                   style={{ fontFamily: 'var(--font-heading)' }}646 |                                 >647 |                                   {new Date(slot.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}648 |                                 </div>649 |                                 <div className="text-xs text-muted">650 |                                   {slot.scheduleTemplate?.sessionDuration?.duration_minutes || 60} min651 |                                 </div>652 |                                 <div className="text-xs text-muted">653 |                                   {slot.instructorName || 'Available'}654 |                                 </div>655 |                                 <div className="text-xs text-muted">656 |                                   {slot.bookedCount}/{slot.capacity} booked657 |                                 </div>658 |                                 {formData.selectedScheduleSlot?.id === slot.id && (659 |                                   <div className="text-xs text-primary font-medium mt-1">660 |                                     ✓ Selected661 |                                   </div>662 |                                 )}663 |                               </CardContent>664 |                             </Card>665 |                           ))}666 |                         </div>667 |                       ) : (668 |                         <div className="text-center py-8 text-gray-500">669 |                           <div className="text-sm">No available time slots</div>670 |                           <div className="text-xs mt-1">Please try again later or skip to book later</div>671 |                         </div>672 |                       )}673 |                     </div>674 |                   )}675 | 676 |                   <div className="text-center">677 |                     <button678 |                       onClick={() => setCurrentStep(1)}679 |                       className="btn-outline mr-4"680 |                     >681 |                       <ArrowLeft className="w-4 h-4 mr-2" />682 |                       Back683 |                     </button>684 |                     <button685 |                       onClick={() => setCurrentStep(3)}686 |                       className="btn-primary"687 |                       disabled={!formData.skipBooking && !formData.selectedScheduleSlot}688 |                     >689 |                       Continue to Payment690 |                       <ArrowRight className="w-4 h-4 ml-2" />691 |                     </button>692 |                   </div>693 |                 </CardContent>694 |               </Card>695 |             </motion.div>696 |           )}697 | 698 |           {currentStep === 3 && (699 |             <motion.div700 |               key="payment"701 |               initial={{ opacity: 0, x: 20 }}702 |               animate={{ opacity: 1, x: 0 }}703 |               exit={{ opacity: 0, x: -20 }}704 |               className="max-w-2xl mx-auto payment-step"705 |               style={{ overflow: 'visible' }}706 |             >707 |               <Card className="card-base">708 |                 <CardHeader>709 |                   <CardTitle710 |                     className="text-2xl text-primary text-center"711 |                     style={{ fontFamily: 'var(--font-heading)' }}712 |                   >713 |                     Complete Your Purchase714 |                   </CardTitle>715 |                 </CardHeader>716 |                 <CardContent>717 |                   {}718 |                   <div className="bg-light rounded-lg p-4 mb-6">719 |                     <h3720 |                       className="text-lg font-semibold text-black mb-3"721 |                       style={{ fontFamily: 'var(--font-heading)' }}722 |                     >723 |                       Order Summary724 |                     </h3>725 |                     <div className="space-y-2">726 |                       <div className="flex justify-between">727 |                         <span className="text-muted">Package:</span>728 |                         <span className="text-black">{formData.selectedPackage?.packageDefinition.name}</span>729 |                       </div>730 |                       <div className="flex justify-between">731 |                         <span className="text-muted">Sessions:</span>732 |                         <span className="text-black">{formData.selectedPackage?.packageDefinition.sessionsCount}</span>733 |                       </div>734 |                       {formData.selectedScheduleSlot && (735 |                         <div className="flex justify-between">736 |                           <span className="text-muted">First Session:</span>737 |                           <span className="text-black">738 |                             {new Date(formData.selectedScheduleSlot.startTime).toLocaleDateString()} at{' '}739 |                             {new Date(formData.selectedScheduleSlot.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}740 |                           </span>741 |                         </div>742 |                       )}743 |                       <div className="flex justify-between text-lg font-semibold border-t border-gray-200 pt-2">744 |                         <span className="text-primary">Total:</span>745 |                         <span className="text-primary">746 |                           {formData.selectedPackage?.currency.symbol}{formData.selectedPackage?.price}747 |                         </span>748 |                       </div>749 |                     </div>750 |                   </div>751 | 752 |                   {}753 |                   {formData.selectedPackage && (754 |                     <IzipayPaymentMethod755 |                       amount={formData.selectedPackage.price}756 |                       currency="PEN"757 |                       customerEmail={formData.clientEmail}758 |                       customerName={formData.clientName}759 |                       description={`${formData.selectedPackage.packageDefinition.name} - ${formData.selectedPackage.packageDefinition.sessionsCount} sessions`}760 |                       packagePriceId={formData.selectedPackage.id}761 |                       quantity={1}762 |                       metadata={{763 |                         clientPhone: `${formData.countryCode}${formData.clientPhone}`,764 |                         language: formData.language,765 |                         scheduleSlotId: formData.selectedScheduleSlot?.id766 |                       }}767 |                       onSuccess={handlePaymentSuccess}768 |                       onError={handlePaymentError}769 |                       onCancel={() => setCurrentStep(2)}770 |                     />771 |                   )}772 | 773 |                   <div className="flex justify-between pt-4">774 |                     <button775 |                       onClick={() => setCurrentStep(2)}776 |                       className="btn-outline"777 |                     >778 |                       <ArrowLeft className="w-4 h-4 mr-2" />779 |                       Back780 |                     </button>781 |                   </div>782 |                 </CardContent>783 |               </Card>784 |             </motion.div>785 |           )}786 |         </AnimatePresence>787 |       </div>788 |     </div>789 |   );790 | }
============================================================END: frontend/app/packages/page.tsx============================================================


============================================================FILE: frontend/app/page.tsxSIZE: 0.37 KB============================================================
  1 | import React from 'react';  2 | import { ErrorBoundary } from '@/components/ErrorBoundary';  3 | import { App } from '@/components/App';  4 |   5 | export const revalidate = 3600;  6 |   7 | export default function HomePage() {  8 |   return (  9 |     <ErrorBoundary> 10 |       <App /> 11 |     </ErrorBoundary> 12 |   ); 13 | }
============================================================END: frontend/app/page.tsx============================================================


============================================================FILE: frontend/app/payment/cancel/page.tsxSIZE: 1.83 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { XCircle, ArrowLeft, RefreshCw } from 'lucide-react';  5 | import { BaseCard } from '@/components/ui/BaseCard';  6 | import { BaseButton } from '@/components/ui/BaseButton';  7 | import Link from 'next/link';  8 |   9 | export default function PaymentCancelPage() { 10 |   return ( 11 |     <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#191970] to-[#0A0A23] p-4"> 12 |       <BaseCard className="max-w-md w-full"> 13 |         <div className="text-center p-8"> 14 |           <div className="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6"> 15 |             <XCircle className="w-12 h-12 text-red-600" /> 16 |           </div> 17 |  18 |           <h1 className="text-3xl font-bold text-gray-900 mb-4"> 19 |             Payment Cancelled 20 |           </h1> 21 |  22 |           <p className="text-gray-600 mb-6"> 23 |             Your payment was cancelled. No charges were made to your account. 24 |           </p> 25 |  26 |           <div className="space-y-3"> 27 |             <Link href="/account/book"> 28 |               <BaseButton className="w-full" variant="primary"> 29 |                 <RefreshCw className="w-4 h-4 mr-2" /> 30 |                 Try Again 31 |               </BaseButton> 32 |             </Link> 33 |  34 |             <Link href="/account"> 35 |               <BaseButton className="w-full" variant="outline"> 36 |                 <ArrowLeft className="w-4 h-4 mr-2" /> 37 |                 Back to My Account 38 |               </BaseButton> 39 |             </Link> 40 |  41 |             <Link href="/"> 42 |               <BaseButton className="w-full" variant="ghost"> 43 |                 Return to Home 44 |               </BaseButton> 45 |             </Link> 46 |           </div> 47 |  48 |           <p className="text-xs text-gray-500 mt-6"> 49 |             If you have any questions, please contact our support team. 50 |           </p> 51 |         </div> 52 |       </BaseCard> 53 |     </div> 54 |   ); 55 | }
============================================================END: frontend/app/payment/cancel/page.tsx============================================================


============================================================FILE: frontend/app/payment/success/page.tsxSIZE: 2.64 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useEffect, useState } from 'react';  4 | import { useSearchParams } from 'next/navigation';  5 | import { CheckCircle, ArrowRight } from 'lucide-react';  6 | import { BaseCard } from '@/components/ui/BaseCard';  7 | import { BaseButton } from '@/components/ui/BaseButton';  8 | import Link from 'next/link';  9 |  10 | export default function PaymentSuccessPage() { 11 |   const searchParams = useSearchParams(); 12 |   const sessionId = searchParams.get('session_id'); 13 |   const [loading, setLoading] = useState(true); 14 |  15 |   useEffect(() => { 16 |     if (sessionId) { 17 |  18 |       setLoading(false); 19 |     } 20 |   }, [sessionId]); 21 |  22 |   if (loading) { 23 |     return ( 24 |       <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#191970] to-[#0A0A23]"> 25 |         <div className="text-center"> 26 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 27 |           <p className="text-[#C0C0C0]">Processing payment...</p> 28 |         </div> 29 |       </div> 30 |     ); 31 |   } 32 |  33 |   return ( 34 |     <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#191970] to-[#0A0A23] p-4"> 35 |       <BaseCard className="max-w-md w-full"> 36 |         <div className="text-center p-8"> 37 |           <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"> 38 |             <CheckCircle className="w-12 h-12 text-green-600" /> 39 |           </div> 40 |  41 |           <h1 className="text-3xl font-bold text-gray-900 mb-4"> 42 |             Payment Successful! 43 |           </h1> 44 |  45 |           <p className="text-gray-600 mb-6"> 46 |             Thank you for your payment. Your transaction has been completed successfully. 47 |           </p> 48 |  49 |           {sessionId && ( 50 |             <div className="bg-gray-50 rounded-lg p-4 mb-6"> 51 |               <p className="text-sm text-gray-600"> 52 |                 <span className="font-medium">Transaction ID:</span> {sessionId} 53 |               </p> 54 |             </div> 55 |           )} 56 |  57 |           <div className="space-y-3"> 58 |             <Link href="/account"> 59 |               <BaseButton className="w-full" variant="primary"> 60 |                 Go to My Account 61 |                 <ArrowRight className="w-4 h-4 ml-2" /> 62 |               </BaseButton> 63 |             </Link> 64 |  65 |             <Link href="/"> 66 |               <BaseButton className="w-full" variant="outline"> 67 |                 Return to Home 68 |               </BaseButton> 69 |             </Link> 70 |           </div> 71 |  72 |           <p className="text-xs text-gray-500 mt-6"> 73 |             A confirmation email has been sent to your email address. 74 |           </p> 75 |         </div> 76 |       </BaseCard> 77 |     </div> 78 |   ); 79 | }
============================================================END: frontend/app/payment/success/page.tsx============================================================


============================================================FILE: frontend/app/payment-demo/page.tsxSIZE: 0.22 KB============================================================
  1 | import { StripePaymentDemo } from '@/components/stripe/StripePaymentDemo';  2 |   3 | export default function PaymentDemoPage() {  4 |   return (  5 |     <div className="min-h-screen bg-gray-50 py-12">  6 |       <StripePaymentDemo />  7 |     </div>  8 |   );  9 | }
============================================================END: frontend/app/payment-demo/page.tsx============================================================


============================================================FILE: frontend/components/AboutSection.tsxSIZE: 7.42 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import Image from 'next/image';  5 | import { motion } from 'framer-motion';  6 | import { useProfileImage } from '@/hooks/useProfileImage';  7 |   8 | interface AboutSectionProps {  9 |   t: Record<string, string | Record<string, string>>; 10 | } 11 |  12 | export function AboutSection({ t }: AboutSectionProps) { 13 |   const { profileImage, isLoading: isImageLoading } = useProfileImage(); 14 |  15 |   return ( 16 |     <> 17 |       <style jsx>{` 18 |         .image-container { 19 |           --mobile-scale: 0.95; 20 |           --desktop-scale: 1; 21 |         } 22 |  23 |         @media (max-width: 639px) { 24 |           .image-container { 25 |             transform: scale(var(--mobile-scale)); 26 |             transform-origin: center center; 27 |           } 28 |         } 29 |  30 |         @media (min-width: 640px) { 31 |           .image-container { 32 |             transform: scale(var(--desktop-scale)); 33 |             transform-origin: center center; 34 |           } 35 |         } 36 |       `}</style> 37 |     <section className="h-full flex flex-col justify-center px-4 sm:px-6 lg:px-8 pt-20 sm:pt-24 md:pt-16 lg:pt-20 pb-12 sm:pb-16 lg:pb-20 overflow-hidden safe-padding"> 38 |       <div className="container mx-auto max-w-6xl"> 39 |         <div className="grid gap-8 md:grid-cols-2 md:gap-10 lg:gap-16 items-center"> 40 |           <motion.div 41 |             initial={{ opacity: 0, x: -40 }} 42 |             whileInView={{ opacity: 1, x: 0 }} 43 |             transition={{ duration: 0.8 }} 44 |             className="order-2 md:order-1 space-y-4 sm:space-y-6" 45 |           > 46 |             <h2 className="text-2xl xs:text-3xl sm:text-4xl md:text-3xl lg:text-4xl xl:text-5xl font-heading text-[#EAEAEA] leading-tight"> 47 |               {(t.about as Record<string, string>).title} 48 |             </h2> 49 |             <motion.div 50 |               initial={{ width: 0 }} 51 |               whileInView={{ width: "4rem" }} 52 |               transition={{ duration: 0.8, delay: 0.3 }} 53 |               className="h-0.5 bg-gradient-to-r from-[#FFD700] to-transparent" 54 |             /> 55 |             <p className="text-sm sm:text-base md:text-sm lg:text-base xl:text-lg text-[#EAEAEA]/80 leading-relaxed max-w-2xl"> 56 |               {(t.about as Record<string, string>).text} 57 |             </p> 58 |  59 |             {} 60 |             <motion.div 61 |               initial={{ opacity: 0, y: 20 }} 62 |               whileInView={{ opacity: 1, y: 0 }} 63 |               transition={{ duration: 0.6, delay: 0.5 }} 64 |               className="flex items-center space-x-2 text-[#FFD700]/60 pt-4" 65 |             > 66 |               {[...Array(5)].map((_, i) => ( 67 |                 <motion.div 68 |                   key={i} 69 |                   animate={{ 70 |                     scale: [1, 1.2, 1], 71 |                     opacity: [0.3, 0.8, 0.3] 72 |                   }} 73 |                   transition={{ 74 |                     duration: 2, 75 |                     repeat: Infinity, 76 |                     delay: i * 0.2 77 |                   }} 78 |                   className="w-1 h-1 bg-[#FFD700] rounded-full" 79 |                 /> 80 |               ))} 81 |             </motion.div> 82 |           </motion.div> 83 |  84 |           <motion.div 85 |             initial={{ opacity: 0, x: 40 }} 86 |             whileInView={{ opacity: 1, x: 0 }} 87 |             transition={{ duration: 0.8, delay: 0.3 }} 88 |             className="order-1 md:order-2 flex justify-center" 89 |           > 90 |             <div className="relative max-w-xs xs:max-w-sm mx-auto flex justify-center"> 91 |               <motion.div 92 |                 className="w-32 h-32 xs:w-40 xs:h-40 sm:w-48 sm:h-48 md:w-56 md:h-56 lg:w-64 lg:h-64 xl:w-72 xl:h-72 bg-gradient-to-br from-[#191970]/30 to-[#0A0A23]/30 rounded-full border border-[#C0C0C0]/20 p-1.5 xs:p-2 sm:p-3 cosmic-glow relative overflow-hidden flex items-center justify-center" 93 |                 whileHover={{ scale: 1.02 }} 94 |                 transition={{ duration: 0.3 }} 95 |               > 96 |                 {} 97 |                 <motion.div 98 |                   animate={{ rotate: -360 }} 99 |                   transition={{ duration: 30, repeat: Infinity, ease: "linear" }}100 |                   className="absolute inset-2 border border-[#FFD700]/10 rounded-full"101 |                 />102 | 103 |                 <div className="w-full h-full rounded-full overflow-hidden border-1 xs:border-2 border-[#FFD700]/30 relative z-10 flex items-center justify-center image-container">104 |                   {isImageLoading ? (105 |                     <div className="w-full h-full bg-[#191970]/30 flex items-center justify-center">106 |                       <motion.div107 |                         animate={{ rotate: 360 }}108 |                         transition={{ duration: 2, repeat: Infinity, ease: "linear" }}109 |                         className="w-8 h-8 border-4 border-[#FFD700] border-t-transparent rounded-full"110 |                       />111 |                     </div>112 |                   ) : (113 |                     <Image114 |                       src={profileImage}115 |                       alt="José Garfias - Cosmic Navigator and Astrologer"116 |                       fill117 |                       className="object-cover object-center rounded-full"118 |                       style={{119 |                         objectPosition: 'center 20%'120 |                       }}121 |                       onError={() => {122 |                         }}123 |                     />124 |                   )}125 |                 </div>126 | 127 |                 {}128 |                 <div className="absolute inset-0 bg-gradient-to-t from-[#191970]/20 to-transparent rounded-full pointer-events-none" />129 |               </motion.div>130 | 131 |               {}132 |               <motion.div133 |                 animate={{ rotate: 360 }}134 |                 transition={{ duration: 25, repeat: Infinity, ease: "linear" }}135 |                 className="absolute inset-0 pointer-events-none"136 |               >137 |                 <div className="w-2 h-2 sm:w-3 sm:h-3 bg-[#FFD700] rounded-full absolute top-8 sm:top-12 right-8 sm:right-12 opacity-70 cosmic-glow-small"></div>138 |                 <div className="w-1 h-1 sm:w-1.5 sm:h-1.5 bg-[#C0C0C0] rounded-full absolute bottom-12 sm:bottom-16 left-4 sm:left-8 opacity-80"></div>139 |                 <div className="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-[#FFD700] rounded-full absolute top-16 sm:top-20 left-8 sm:left-12 opacity-60"></div>140 |                 <div className="w-1 h-1 bg-[#C0C0C0] rounded-full absolute top-1/3 right-4 sm:right-8 opacity-50"></div>141 |                 <div className="w-1.5 h-1.5 bg-[#FFD700] rounded-full absolute bottom-1/3 right-12 sm:right-16 opacity-40"></div>142 |               </motion.div>143 | 144 |               {}145 |               {[...Array(6)].map((_, i) => (146 |                 <motion.div147 |                   key={i}148 |                   className="absolute w-0.5 h-0.5 sm:w-1 sm:h-1 bg-[#FFD700] rounded-full opacity-40"149 |                   style={{150 |                     left: `${20 + Math.random() * 60}%`,151 |                     top: `${20 + Math.random() * 60}%`,152 |                   }}153 |                   animate={{154 |                     x: [0, 15, -15, 0],155 |                     y: [0, -20, 15, 0],156 |                     opacity: [0.2, 0.8, 0.2],157 |                     scale: [1, 1.5, 1],158 |                   }}159 |                   transition={{160 |                     duration: 6 + Math.random() * 4,161 |                     repeat: Infinity,162 |                     delay: Math.random() * 2,163 |                   }}164 |                 />165 |               ))}166 |             </div>167 |           </motion.div>168 |         </div>169 |       </div>170 |     </section>171 |     </>172 |   );173 | }
============================================================END: frontend/components/AboutSection.tsx============================================================


============================================================FILE: frontend/components/ApproachSection.tsxSIZE: 7.44 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { motion } from 'framer-motion';  5 | import { Sun, Circle, TrendingUp } from 'lucide-react';  6 |   7 | interface ApproachSectionProps {  8 |   t: Record<string, string | Record<string, string>>;  9 | } 10 |  11 | export function ApproachSection({ t }: ApproachSectionProps) { 12 |   const icons = [Sun, Circle, TrendingUp]; 13 |  14 |   return ( 15 |     <section className="h-full flex flex-col justify-start px-4 sm:px-6 lg:px-8 py-12 sm:py-16 relative overflow-hidden safe-padding pt-20 sm:pt-24 lg:pt-28"> 16 |       {} 17 |       <div className="absolute inset-0 opacity-10"> 18 |         <motion.div 19 |           animate={{ rotate: 360 }} 20 |           transition={{ duration: 60, repeat: Infinity, ease: "linear" }} 21 |           className="absolute top-1/4 left-1/4 w-16 sm:w-24 h-16 sm:h-24 border border-[#FFD700]/20 rounded-full" 22 |         /> 23 |         <motion.div 24 |           animate={{ rotate: -360 }} 25 |           transition={{ duration: 80, repeat: Infinity, ease: "linear" }} 26 |           className="absolute bottom-1/4 right-1/4 w-12 sm:w-20 h-12 sm:h-20 border border-[#C0C0C0]/20 rounded-full" 27 |         /> 28 |       </div> 29 |  30 |       <div className="container mx-auto max-w-7xl relative z-10"> 31 |         {} 32 |         <motion.div 33 |           initial={{ opacity: 0, y: 30 }} 34 |           whileInView={{ opacity: 1, y: 0 }} 35 |           transition={{ duration: 0.8 }} 36 |           className="text-center mb-8 sm:mb-12" 37 |         > 38 |           <h2 className="text-2xl xs:text-3xl sm:text-4xl md:text-5xl font-heading text-[#EAEAEA] mb-4 sm:mb-6 leading-tight px-2"> 39 |             {(t.approach as Record<string, unknown>).title as string} 40 |           </h2> 41 |           <div className="w-16 sm:w-24 h-0.5 sm:h-1 bg-gradient-to-r from-transparent via-[#FFD700] to-transparent mx-auto"></div> 42 |         </motion.div> 43 |  44 |         {} 45 |         <div className="grid gap-6 sm:gap-8 md:grid-cols-3 md:gap-8 lg:gap-12 max-w-6xl mx-auto"> 46 |           {((t.approach as Record<string, unknown>).items as Array<{ title: string; description: string }>).map((item: { title: string; description: string }, index: number) => { 47 |             const Icon = icons[index]; 48 |  49 |             return ( 50 |               <motion.div 51 |                 key={index} 52 |                 initial={{ opacity: 0, y: 40 }} 53 |                 whileInView={{ opacity: 1, y: 0 }} 54 |                 whileHover={{ y: -4, scale: 1.01 }} 55 |                 transition={{ duration: 0.8, delay: index * 0.15 }} 56 |                 className="relative group" 57 |               > 58 |                 {} 59 |                 {index < 2 && ( 60 |                   <div className="hidden md:block absolute top-12 lg:top-16 -right-4 lg:-right-6 w-8 lg:w-12 h-px bg-gradient-to-r from-[#FFD700]/50 to-transparent z-10"> 61 |                     <motion.div 62 |                       initial={{ width: 0 }} 63 |                       whileInView={{ width: "100%" }} 64 |                       transition={{ duration: 1, delay: index * 0.3 + 0.5 }} 65 |                       className="h-full bg-[#FFD700]/50" 66 |                     /> 67 |                   </div> 68 |                 )} 69 |  70 |                 {} 71 |                 <div className="relative bg-gradient-to-br from-[#191970]/25 to-[#0A0A23]/40 rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-6 lg:p-8 border border-[#C0C0C0]/10 group-hover:border-[#FFD700]/30 transition-all duration-300 h-full min-h-[280px] sm:min-h-[320px]"> 72 |                   {} 73 |                   <div className="absolute -top-3 sm:-top-4 left-4 sm:left-6 w-6 h-6 sm:w-8 sm:h-8 bg-[#FFD700] text-[#0A0A23] rounded-full flex items-center justify-center font-heading text-sm sm:text-base cosmic-glow"> 74 |                     {index + 1} 75 |                   </div> 76 |  77 |                   {} 78 |                   <motion.div 79 |                     initial={{ scale: 0, rotate: -180 }} 80 |                     whileInView={{ scale: 1, rotate: 0 }} 81 |                     whileHover={{ scale: 1.05, rotate: 2 }} 82 |                     transition={{ duration: 0.8, delay: index * 0.2 + 0.3 }} 83 |                     className="flex justify-center mb-4 sm:mb-6 mt-2 sm:mt-4" 84 |                   > 85 |                     <div className="relative"> 86 |                       {} 87 |                       <motion.div 88 |                         animate={{ rotate: 360 }} 89 |                         transition={{ duration: 20, repeat: Infinity, ease: "linear" }} 90 |                         className="absolute inset-0 w-14 h-14 sm:w-20 sm:h-20 border border-[#FFD700]/20 rounded-full -m-1 sm:-m-2" 91 |                       /> 92 |  93 |                       {} 94 |                       <div className="w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-[#191970]/60 to-[#0A0A23]/80 rounded-full flex items-center justify-center border border-[#FFD700]/40 group-hover:border-[#FFD700] transition-all duration-300 cosmic-glow"> 95 |                         <Icon size={20} className="sm:w-7 sm:h-7 text-[#FFD700]" /> 96 |                       </div> 97 |  98 |                       {} 99 |                       <div className="absolute inset-0 w-12 h-12 sm:w-16 sm:h-16 bg-[#FFD700]/10 rounded-full blur-md sm:blur-lg group-hover:bg-[#FFD700]/20 transition-all duration-300" />100 |                     </div>101 |                   </motion.div>102 | 103 |                   {}104 |                   <motion.div105 |                     initial={{ opacity: 0 }}106 |                     whileInView={{ opacity: 1 }}107 |                     transition={{ duration: 0.8, delay: index * 0.2 + 0.5 }}108 |                     className="text-center"109 |                   >110 |                     <h3 className="text-lg sm:text-xl md:text-2xl font-heading text-[#EAEAEA] mb-3 sm:mb-4 relative leading-tight">111 |                       {item.title}112 |                       <div className="absolute -bottom-1 sm:-bottom-2 left-1/2 -translate-x-1/2 w-8 sm:w-12 h-0.5 bg-gradient-to-r from-transparent via-[#FFD700] to-transparent"></div>113 |                     </h3>114 | 115 |                     <p className="text-sm sm:text-base text-[#EAEAEA]/80 leading-relaxed">116 |                       {item.description}117 |                     </p>118 |                   </motion.div>119 | 120 |                   {}121 |                   <div className="absolute top-2 sm:top-3 right-2 sm:right-3 w-1.5 h-1.5 sm:w-2 sm:h-2 bg-[#FFD700]/60 rounded-full"></div>122 |                   <div className="absolute bottom-2 sm:bottom-3 left-2 sm:left-3 w-1 h-1 bg-[#C0C0C0]/60 rounded-full"></div>123 |                 </div>124 |               </motion.div>125 |             );126 |           })}127 |         </div>128 | 129 |         {}130 |         <motion.div131 |           initial={{ opacity: 0, scale: 0 }}132 |           whileInView={{ opacity: 1, scale: 1 }}133 |           transition={{ duration: 1, delay: 1.2 }}134 |           className="flex justify-center mt-8 sm:mt-12"135 |         >136 |           <div className="flex items-center space-x-1.5 sm:space-x-2">137 |             {[...Array(3)].map((_, i) => (138 |               <motion.div139 |                 key={i}140 |                 animate={{141 |                   scale: [1, 1.3, 1],142 |                   opacity: [0.5, 1, 0.5]143 |                 }}144 |                 transition={{145 |                   duration: 2,146 |                   repeat: Infinity,147 |                   delay: i * 0.4148 |                 }}149 |                 className="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-[#FFD700] rounded-full"150 |               />151 |             ))}152 |           </div>153 |         </motion.div>154 |       </div>155 |     </section>156 |   );157 | }
============================================================END: frontend/components/ApproachSection.tsx============================================================


============================================================FILE: frontend/components/AstralChart.tsxSIZE: 2.98 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { motion } from 'framer-motion';  5 |   6 | export function AstralChart() {  7 |   return (  8 |     <div className="relative w-48 h-48 xs:w-56 xs:h-56 sm:w-64 sm:h-64 md:w-72 md:h-72 lg:w-80 lg:h-80 mx-auto">  9 |       <svg 10 |         width="100%" 11 |         height="100%" 12 |         viewBox="0 0 320 320" 13 |         className="absolute inset-0 max-w-full max-h-full astral-chart-svg" 14 |       > 15 |         {} 16 |         <circle cx="160" cy="160" r="150" fill="none" stroke="rgba(255, 215, 0, 0.3)" strokeWidth="2" /> 17 |  18 |         {} 19 |         <circle cx="160" cy="160" r="90" fill="none" stroke="rgba(192, 192, 192, 0.4)" strokeWidth="1" /> 20 |  21 |         {} 22 |         <circle cx="160" cy="160" r="3" fill="#FFD700" className="cosmic-glow" /> 23 |  24 |         {} 25 |         {[0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330].map((angle, i) => { 26 |           const x = 160 + 130 * Math.cos((angle - 90) * Math.PI / 180); 27 |           const y = 160 + 130 * Math.sin((angle - 90) * Math.PI / 180); 28 |           return ( 29 |             <motion.circle 30 |               key={i} 31 |               cx={x} 32 |               cy={y} 33 |               r="4" 34 |               fill="rgba(255, 215, 0, 0.6)" 35 |               animate={{ scale: [0.8, 1.2, 0.8], opacity: [0.4, 0.8, 0.4] }} 36 |               transition={{ duration: 3 + i * 0.2, repeat: Infinity }} 37 |             /> 38 |           ); 39 |         })} 40 |  41 |         {} 42 |         {[45, 135, 225, 315].map((angle, i) => { 43 |           const x = 160 + 70 * Math.cos((angle - 90) * Math.PI / 180); 44 |           const y = 160 + 70 * Math.sin((angle - 90) * Math.PI / 180); 45 |           return ( 46 |             <motion.circle 47 |               key={i} 48 |               cx={x} 49 |               cy={y} 50 |               r="3" 51 |               fill="rgba(192, 192, 192, 0.7)" 52 |               animate={{ 53 |                 scale: [1, 1.5, 1], 54 |                 opacity: [0.5, 1, 0.5], 55 |                 rotate: [0, 360] 56 |               }} 57 |               transition={{ duration: 4 + i * 0.3, repeat: Infinity }} 58 |             /> 59 |           ); 60 |         })} 61 |  62 |         {} 63 |         <line x1="160" y1="70" x2="160" y2="250" stroke="rgba(255, 215, 0, 0.2)" strokeWidth="1" /> 64 |         <line x1="70" y1="160" x2="250" y2="160" stroke="rgba(255, 215, 0, 0.2)" strokeWidth="1" /> 65 |       </svg> 66 |  67 |       {} 68 |       {[...Array(4)].map((_, i) => ( 69 |         <motion.div 70 |           key={i} 71 |           className="absolute w-0.5 h-0.5 sm:w-1 sm:h-1 bg-[#FFD700] rounded-full" 72 |           style={{ 73 |             left: `${25 + Math.random() * 50}%`, 74 |             top: `${25 + Math.random() * 50}%`, 75 |           }} 76 |           animate={{ 77 |             x: [0, 8, -8, 0], 78 |             y: [0, -12, 8, 0], 79 |             opacity: [0.3, 1, 0.3], 80 |             scale: [1, 1.2, 1], 81 |           }} 82 |           transition={{ 83 |             duration: 3 + Math.random() * 2, 84 |             repeat: Infinity, 85 |             delay: Math.random() * 2, 86 |           }} 87 |         /> 88 |       ))} 89 |     </div> 90 |   ); 91 | }
============================================================END: frontend/components/AstralChart.tsx============================================================


============================================================FILE: frontend/components/BookingSection.tsxSIZE: 0.39 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { CalendlyBookingFlow } from './CalendlyBookingFlow';  5 |   6 | interface BookingSectionProps {  7 |   t: Record<string, string | Record<string, string>>;  8 |   language: string;  9 | } 10 |  11 | export function BookingSection({ t, language }: BookingSectionProps) { 12 |  13 |   return <CalendlyBookingFlow t={t} language={language} />; 14 | }
============================================================END: frontend/components/BookingSection.tsx============================================================


============================================================FILE: frontend/components/BookingSectionWithReminder.tsxSIZE: 9.93 KB============================================================
  1 | import { useState } from 'react';  2 | import { motion } from 'framer-motion';  3 |   4 | import { CheckCircle, Bell } from 'lucide-react';  5 |   6 | interface BookingSectionProps {  7 |   t: Record<string, string | Record<string, string>>;  8 |   language: string;  9 | } 10 |  11 | interface BookingData { 12 |   sessionType: 'english' | 'spanish' | ''; 13 |   date: Date | undefined; 14 |   time: string; 15 |   name: string; 16 |   email: string; 17 |   birthDate: string; 18 |   birthTime: string; 19 |   birthPlace: string; 20 |   question: string; 21 | } 22 |  23 | export function BookingSection({ t, language }: BookingSectionProps) { 24 |   const [currentStep] = useState(1); 25 |  26 |   const [bookingData] = useState<BookingData>({ 27 |     sessionType: '', 28 |     date: undefined, 29 |     time: '', 30 |     name: '', 31 |     email: '', 32 |     birthDate: '', 33 |     birthTime: '', 34 |     birthPlace: '', 35 |     question: '' 36 |   }); 37 |   const [isConfirmed] = useState(false); 38 |  39 |   const [isSendingReminder, setIsSendingReminder] = useState(false); 40 |   const [reminderSent, setReminderSent] = useState(false); 41 |  42 |   const [lastBookingId] = useState<string>(''); 43 |  44 |   const tomorrow = new Date(); 45 |   tomorrow.setDate(tomorrow.getDate() + 1); 46 |  47 |   const sendReminderEmail = async () => { 48 |     if (!lastBookingId || !bookingData.email) return; 49 |  50 |     setIsSendingReminder(true); 51 |  52 |     try { 53 |       const response = await fetch(`/api/booking/reminder`, { 54 |         method: 'POST', 55 |         headers: { 56 |           'Content-Type': 'application/json' 57 |         }, 58 |         body: JSON.stringify({ 59 |           bookingId: lastBookingId, 60 |           userEmail: bookingData.email, 61 |           userName: bookingData.name, 62 |           bookingDate: formatDate(bookingData.date), 63 |           bookingTime: formatTime(bookingData.time), 64 |           language: bookingData.sessionType === 'spanish' ? 'Spanish' : 'English', 65 |           birthDate: new Date(bookingData.birthDate).toLocaleDateString('en-US', { 66 |             year: 'numeric', 67 |             month: 'long', 68 |             day: 'numeric' 69 |           }), 70 |           birthTime: bookingData.birthTime, 71 |           birthPlace: bookingData.birthPlace, 72 |           clientQuestion: bookingData.question || 'No specific question provided' 73 |         }) 74 |       }); 75 |  76 |       if (response.ok) { 77 |         setReminderSent(true); 78 |         setTimeout(() => setReminderSent(false), 3000); 79 |       } else { 80 |         } 81 |     } catch (error) { 82 |       } finally { 83 |       setIsSendingReminder(false); 84 |     } 85 |   }; 86 |  87 |   const formatDate = (date: Date | undefined) => { 88 |     if (!date) return ''; 89 |     const locale = language === 'es' ? 'es-ES' : 'en-US'; 90 |     return date.toLocaleDateString(locale, { 91 |       weekday: 'long', 92 |       year: 'numeric', 93 |       month: 'long', 94 |       day: 'numeric' 95 |     }); 96 |   }; 97 |  98 |   const formatTime = (timeString: string) => { 99 |     return new Date(`2000-01-01T${timeString}`).toLocaleTimeString(language === 'es' ? 'es-ES' : 'en-US', {100 |       hour: 'numeric',101 |       minute: '2-digit',102 |       hour12: true103 |     });104 |   };105 | 106 |   const getSessionPrice = () => {107 |     return bookingData.sessionType === 'english' ? '$130 USD' : 'S/. 500';108 |   };109 | 110 |   if (isConfirmed) {111 |     return (112 |       <section className="h-full flex flex-col justify-center px-4 sm:px-6 py-8 sm:py-16 overflow-y-auto">113 |         <div className="container mx-auto max-w-2xl text-center">114 |           <motion.div115 |             initial={{ scale: 0, opacity: 0 }}116 |             animate={{ scale: 1, opacity: 1 }}117 |             transition={{ duration: 0.8, ease: "easeOut" }}118 |             className="space-y-6"119 |           >120 |             <div className="w-20 h-20 bg-[#FFD700]/20 rounded-full flex items-center justify-center mx-auto cosmic-glow">121 |               <CheckCircle size={40} className="text-[#FFD700]" />122 |             </div>123 | 124 |             <h2 className="text-2xl sm:text-3xl font-heading text-[#EAEAEA]">125 |               {((t.apply as Record<string, unknown>).form as Record<string, unknown>)?.thankYou as string || 'Thank You!'}126 |             </h2>127 | 128 |             <div className="bg-gradient-to-br from-[#191970]/30 to-[#0A0A23]/30 p-6 rounded-2xl border border-[#FFD700]/20">129 |               <p className="text-[#EAEAEA]/80 mb-4">130 |                 {language === 'en'131 |                   ? "Your cosmic session has been scheduled for:"132 |                   : "Tu sesión cósmica ha sido programada para:"}133 |               </p>134 |               <div className="space-y-2 text-[#FFD700]">135 |                 <p className="font-heading text-lg">{formatDate(bookingData.date)}</p>136 |                 <p className="font-medium">{formatTime(bookingData.time)} - {getSessionPrice()}</p>137 |                 <p className="text-sm text-[#EAEAEA]/60 mt-4">138 |                   {language === 'en'139 |                     ? "We'll send confirmation details to your email shortly."140 |                     : "Te enviaremos los detalles de confirmación a tu email pronto."}141 |                 </p>142 |               </div>143 | 144 |               {}145 |               <div className="mt-6 pt-4 border-t border-[#C0C0C0]/20">146 |                 <div className="flex flex-col sm:flex-row items-center justify-between gap-4">147 |                   <div className="text-center sm:text-left">148 |                     <p className="text-[#EAEAEA]/80 text-sm mb-1">149 |                       {language === 'en'150 |                         ? "Want a reminder email before your session?"151 |                         : "¿Quieres un email recordatorio antes de tu sesión?"}152 |                     </p>153 |                     <p className="text-[#C0C0C0]/60 text-xs">154 |                       {language === 'en'155 |                         ? "We'll send you a detailed preparation guide"156 |                         : "Te enviaremos una guía detallada de preparación"}157 |                     </p>158 |                   </div>159 | 160 |                   <motion.button161 |                     onClick={sendReminderEmail}162 |                     disabled={isSendingReminder || reminderSent}163 |                     whileHover={!isSendingReminder && !reminderSent ? { scale: 1.02 } : {}}164 |                     whileTap={!isSendingReminder && !reminderSent ? { scale: 0.98 } : {}}165 |                     className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-300 min-w-[140px] justify-center ${166 |                       reminderSent167 |                         ? 'bg-green-500/20 text-green-400 border border-green-500/30'168 |                         : isSendingReminder169 |                           ? 'bg-[#C0C0C0]/20 text-[#C0C0C0]/60 border border-[#C0C0C0]/20 cursor-not-allowed'170 |                           : 'bg-[#FFD700]/10 text-[#FFD700] border border-[#FFD700]/30 hover:bg-[#FFD700]/20 hover:border-[#FFD700]/50 cosmic-glow'171 |                     }`}172 |                   >173 |                     {isSendingReminder ? (174 |                       <>175 |                         <motion.div176 |                           animate={{ rotate: 360 }}177 |                           transition={{ duration: 1, repeat: Infinity, ease: "linear" }}178 |                           className="w-4 h-4 border-2 border-[#C0C0C0]/40 border-t-[#C0C0C0] rounded-full"179 |                         />180 |                         <span className="text-sm">181 |                           {language === 'en' ? 'Sending...' : 'Enviando...'}182 |                         </span>183 |                       </>184 |                     ) : reminderSent ? (185 |                       <>186 |                         <CheckCircle size={16} />187 |                         <span className="text-sm">188 |                           {language === 'en' ? 'Sent!' : '¡Enviado!'}189 |                         </span>190 |                       </>191 |                     ) : (192 |                       <>193 |                         <Bell size={16} />194 |                         <span className="text-sm">195 |                           {language === 'en' ? 'Send Reminder' : 'Enviar Recordatorio'}196 |                         </span>197 |                       </>198 |                     )}199 |                   </motion.button>200 |                 </div>201 |               </div>202 |             </div>203 |           </motion.div>204 |         </div>205 |       </section>206 |     );207 |   }208 | 209 |   return (210 |     <section className="h-full flex flex-col justify-start sm:justify-center px-4 sm:px-6 py-8 sm:py-16 overflow-y-auto relative z-10">211 |       <div className="container mx-auto max-w-4xl pb-32 sm:pb-8">212 |         {}213 |         <motion.div214 |           initial={{ opacity: 0, y: 20 }}215 |           animate={{ opacity: 1, y: 0 }}216 |           className="text-center mb-8"217 |         >218 |           <h2 className="text-2xl sm:text-3xl md:text-4xl font-heading text-[#EAEAEA] mb-4">219 |             {(t.apply as Record<string, string>).title || 'Book Your Session'}220 |           </h2>221 | 222 |           {}223 |           <div className="flex items-center justify-center space-x-4 mb-6">224 |             {[1, 2, 3, 4, 5].map((step) => (225 |               <div key={step} className="flex items-center">226 |                 <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-all duration-300 ${227 |                   step <= currentStep228 |                     ? 'bg-[#FFD700] text-[#0A0A23] cosmic-glow'229 |                     : 'bg-[#C0C0C0]/20 text-[#C0C0C0]'230 |                 }`}>231 |                   {step}232 |                 </div>233 |                 {step < 5 && (234 |                   <div className={`w-8 h-0.5 transition-all duration-300 ${235 |                     step < currentStep ? 'bg-[#FFD700]' : 'bg-[#C0C0C0]/20'236 |                   }`} />237 |                 )}238 |               </div>239 |             ))}240 |           </div>241 |         </motion.div>242 | 243 |         {}244 |         <div className="bg-gradient-to-br from-[#191970]/30 to-[#0A0A23]/30 rounded-2xl border border-[#C0C0C0]/10 p-6 sm:p-8 relative z-20">245 |           <p className="text-center text-[#EAEAEA] p-8">246 |             {}247 |             Complete Booking Wizard Implementation Here248 |           </p>249 |         </div>250 |       </div>251 |     </section>252 |   );253 | }
============================================================END: frontend/components/BookingSectionWithReminder.tsx============================================================


============================================================FILE: frontend/components/BookingsManagement.tsxSIZE: 24.11 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { Label } from '@/components/ui/label';  8 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  9 | import { Badge } from '@/components/ui/badge'; 10 | import { 11 |   Calendar, DollarSign, UserCheck, Clock3, Trash2 12 | } from 'lucide-react'; 13 | import { toast } from 'sonner'; 14 | import { useAuth } from '../hooks/useAuth'; 15 | import DeleteConfirmationModal from './modals/DeleteConfirmationModal'; 16 |  17 | interface Client { 18 |   id: number; 19 |   name: string; 20 |   email: string; 21 |   phone?: string; 22 |   status: string; 23 | } 24 |  25 | interface ScheduleSlot { 26 |   id: number; 27 |   start_time: string; 28 |   end_time: string; 29 |   capacity: number; 30 |   booked_count: number; 31 |   is_available: boolean; 32 |   schedule_templates: { 33 |     id: number; 34 |     day_of_week: string; 35 |     start_time: string; 36 |     end_time: string; 37 |     session_durations: { 38 |       id: number; 39 |       name: string; 40 |       duration_minutes: number; 41 |     }; 42 |   }; 43 | } 44 |  45 | interface UserPackage { 46 |   id: number; 47 |   sessions_remaining: number; 48 |   sessions_used: number; 49 |   is_active: boolean; 50 |   package_definition: { 51 |     id: number; 52 |     name: string; 53 |     description: string; 54 |     sessions_count: number; 55 |     package_type: 'individual' | 'group' | 'mixed'; 56 |     max_group_size: number; 57 |     session_durations: { 58 |       id: number; 59 |       name: string; 60 |       duration_minutes: number; 61 |     }; 62 |   }; 63 |   package_price: { 64 |     id: number; 65 |     price: number; 66 |     pricing_mode: 'custom' | 'calculated'; 67 |     currencies: { 68 |       id: number; 69 |       code: string; 70 |       name: string; 71 |       symbol: string; 72 |     }; 73 |   }; 74 | } 75 |  76 | interface Booking { 77 |   id: number; 78 |   client_id: number; 79 |   clientEmail: string; 80 |   schedule_slot_id: number; 81 |   user_package_id: number; 82 |   booking_type: 'individual' | 'group'; 83 |   group_size?: number; 84 |   status: 'pending' | 'confirmed' | 'completed' | 'cancelled' | 'no-show'; 85 |   notes?: string; 86 |   total_amount?: number; 87 |   discount_amount: number; 88 |   final_amount?: number; 89 |   cancelled_at?: string; 90 |   cancelled_reason?: string; 91 |   reminder_sent: boolean; 92 |   reminder_sent_at?: string; 93 |   created_at: string; 94 |   updated_at: string; 95 |   client?: Client; 96 |   schedule_slot?: ScheduleSlot; 97 |   user_package?: UserPackage; 98 | } 99 | 100 | interface BookingFilters {101 |   client_id: string;102 |   status: string;103 |   date_from: string;104 |   date_to: string;105 |   booking_type: string;106 |   package_type: string;107 | }108 | 109 | const BookingsManagement: React.FC = () => {110 |   const { user } = useAuth();111 |   const [bookings, setBookings] = useState<Booking[]>([]);112 |   const [clients, setClients] = useState<Client[]>([]);113 |   const [loading, setLoading] = useState(true);114 |   const [pagination, setPagination] = useState({115 |     page: 1,116 |     limit: 20,117 |     total: 0,118 |     totalPages: 0119 |   });120 | 121 |   const [filters, setFilters] = useState<BookingFilters>({122 |     client_id: 'all',123 |     status: 'all',124 |     date_from: '',125 |     date_to: '',126 |     booking_type: 'all',127 |     package_type: 'all'128 |   });129 | 130 |   const [showDeleteModal, setShowDeleteModal] = useState(false);131 |   const [selectedItem, setSelectedItem] = useState<Booking | null>(null);132 | 133 |   const [stats, setStats] = useState({134 |     totalBookings: 0,135 |     activeBookings: 0,136 |     todayBookings: 0,137 |     totalRevenue: 0,138 |     groupBookings: 0,139 |     individualBookings: 0140 |   });141 | 142 |   const fetchBookings = useCallback(async () => {143 |     if (!user?.access_token) return;144 |     try {145 |       setLoading(true);146 |       const params = new URLSearchParams({147 |         page: pagination.page.toString(),148 |         limit: pagination.limit.toString(),149 |         ...Object.fromEntries(150 |           Object.entries(filters).filter(([, value]) => value && value !== '' && value !== 'all')151 |         )152 |       });153 | 154 |       const response = await fetch(`/api/admin/bookings?${params}`, {155 |         headers: {156 |           'Authorization': `Bearer ${user.access_token}`,157 |           'Content-Type': 'application/json'158 |         }159 |       });160 | 161 |       const data = await response.json();162 | 163 |       if (data.success) {164 |         setBookings(data.data);165 |         setPagination(prev => ({166 |           ...prev,167 |           total: data.pagination.total,168 |           totalPages: data.pagination.totalPages169 |         }));170 |       } else {171 |         toast.error('Failed to fetch bookings');172 |       }173 |     } catch {174 |       toast.error('Error fetching bookings');175 |     } finally {176 |       setLoading(false);177 |     }178 |   }, [user?.access_token, pagination.page, pagination.limit, filters]);179 | 180 |   const fetchClients = useCallback(async () => {181 |     if (!user?.access_token) return;182 |     try {183 |       const response = await fetch('/api/admin/users', {184 |         headers: {185 |           'Authorization': `Bearer ${user.access_token}`,186 |           'Content-Type': 'application/json'187 |         }188 |       });189 | 190 |       const data = await response.json();191 |       if (data.success) {192 |         setClients(data.data);193 |       } else {194 |         toast.error('Failed to fetch clients');195 |       }196 |     } catch {197 |       toast.error('Error fetching clients');198 |     }199 |   }, [user?.access_token]);200 | 201 |   const fetchStats = useCallback(async () => {202 |     if (!user?.access_token) return;203 |     try {204 |       const response = await fetch('/api/admin/bookings/stats', {205 |         headers: {206 |           'Authorization': `Bearer ${user.access_token}`,207 |           'Content-Type': 'application/json'208 |         }209 |       });210 | 211 |       const data = await response.json();212 |       if (data.success) {213 |         setStats(data.data);214 |       }215 |     } catch (error) {216 |       }217 |   }, [user?.access_token]);218 | 219 |   useEffect(() => {220 |     if (user?.access_token) {221 |       fetchBookings();222 |       fetchClients();223 |       fetchStats();224 |     }225 |   }, [user?.access_token, pagination.page, filters, fetchBookings, fetchClients, fetchStats]);226 | 227 |   const handleStatusUpdate = async (bookingId: number, newStatus: string) => {228 |     if (!user?.access_token) return;229 | 230 |     try {231 |       const response = await fetch('/api/admin/bookings', {232 |         method: 'PUT',233 |         headers: {234 |           'Authorization': `Bearer ${user.access_token}`,235 |           'Content-Type': 'application/json'236 |         },237 |         body: JSON.stringify({238 |           id: bookingId,239 |           status: newStatus240 |         })241 |       });242 | 243 |       const data = await response.json();244 | 245 |       if (data.success) {246 |         toast.success('Booking status updated successfully');247 |         fetchBookings();248 |         fetchStats();249 |       } else {250 |         toast.error(data.message || 'Failed to update booking status');251 |       }252 |     } catch {253 |       toast.error('Error updating booking status');254 |     }255 |   };256 | 257 |   const handleDelete = async () => {258 |     if (!user?.access_token || !selectedItem) return;259 | 260 |     try {261 |       const response = await fetch(`/api/admin/bookings?id=${selectedItem.id}`, {262 |         method: 'DELETE',263 |         headers: {264 |           'Authorization': `Bearer ${user.access_token}`,265 |           'Content-Type': 'application/json'266 |         }267 |       });268 | 269 |       const data = await response.json();270 | 271 |       if (data.success) {272 |         toast.success('Booking deleted successfully');273 |         setShowDeleteModal(false);274 |         setSelectedItem(null);275 |         fetchBookings();276 |         fetchStats();277 |       } else {278 |         toast.error(data.message || 'Failed to delete booking');279 |       }280 |     } catch {281 |       toast.error('Error deleting booking');282 |     }283 |   };284 | 285 |   const getBookingTypeBadge = (type: string) => {286 |     const variants = {287 |       individual: 'dashboard-badge-info',288 |       group: 'dashboard-badge-success'289 |     };290 |     return <Badge className={variants[type as keyof typeof variants]}>{type}</Badge>;291 |   };292 | 293 |   const formatDateTime = (dateTime: string) => {294 |     return new Date(dateTime).toLocaleString('en-US', {295 |       month: 'short',296 |       day: 'numeric',297 |       hour: 'numeric',298 |       minute: '2-digit',299 |       hour12: true300 |     });301 |   };302 | 303 |   const formatDate = (dateTime: string) => {304 |     return new Date(dateTime).toLocaleDateString('en-US', {305 |       month: 'short',306 |       day: 'numeric',307 |       year: 'numeric'308 |     });309 |   };310 | 311 |   if (loading && bookings.length === 0) {312 |     return (313 |       <div className="flex items-center justify-center min-h-[400px]">314 |         <div className="text-center">315 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>316 |           <p className="text-[#FFD700] text-lg font-semibold">Loading bookings management...</p>317 |         </div>318 |       </div>319 |     );320 |   }321 | 322 |   return (323 |     <div className="dashboard-container p-6 space-y-6">324 |       <div className="flex items-center justify-between">325 |         <div>326 |           <h1 className="dashboard-text-primary text-3xl font-bold">Bookings Management</h1>327 |           <p className="dashboard-text-secondary">Manage all client bookings and appointments</p>328 |         </div>329 |       </div>330 | 331 |       {}332 |       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">333 |         <Card className="dashboard-card">334 |           <CardContent className="p-4">335 |             <div className="flex items-center justify-between">336 |               <div>337 |                 <p className="text-sm font-medium text-dashboard-text-secondary">Total Bookings</p>338 |                 <p className="text-2xl font-bold text-dashboard-text-primary">{stats.totalBookings}</p>339 |               </div>340 |               <Calendar className="w-8 h-8 text-dashboard-accent" />341 |             </div>342 |           </CardContent>343 |         </Card>344 | 345 |         <Card className="dashboard-card">346 |           <CardContent className="p-4">347 |             <div className="flex items-center justify-between">348 |               <div>349 |                 <p className="text-sm font-medium text-dashboard-text-secondary">Active Bookings</p>350 |                 <p className="text-2xl font-bold text-dashboard-text-primary">{stats.activeBookings}</p>351 |               </div>352 |               <UserCheck className="w-8 h-8 text-dashboard-accent" />353 |             </div>354 |           </CardContent>355 |         </Card>356 | 357 |         <Card className="dashboard-card">358 |           <CardContent className="p-4">359 |             <div className="flex items-center justify-between">360 |               <div>361 |                 <p className="text-sm font-medium text-dashboard-text-secondary">Today&apos;s Bookings</p>362 |                 <p className="text-2xl font-bold text-dashboard-text-primary">{stats.todayBookings}</p>363 |               </div>364 |               <Clock3 className="w-8 h-8 text-dashboard-accent" />365 |             </div>366 |           </CardContent>367 |         </Card>368 | 369 |         <Card className="dashboard-card">370 |           <CardContent className="p-4">371 |             <div className="flex items-center justify-between">372 |               <div>373 |                 <p className="text-sm font-medium text-dashboard-text-secondary">Total Revenue</p>374 |                 <p className="text-2xl font-bold text-dashboard-text-primary">${stats.totalRevenue}</p>375 |               </div>376 |               <DollarSign className="w-8 h-8 text-dashboard-accent" />377 |             </div>378 |           </CardContent>379 |         </Card>380 |       </div>381 | 382 |       {}383 |       <Card className="dashboard-card">384 |         <CardHeader>385 |           <CardTitle className="dashboard-card-title">Filters</CardTitle>386 |         </CardHeader>387 |         <CardContent>388 |           <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">389 |             <div className="space-y-2">390 |               <Label className="dashboard-label">Client</Label>391 |               <Select392 |                 value={filters.client_id}393 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, client_id: value }))}394 |               >395 |                 <SelectTrigger className="dashboard-input">396 |                   <SelectValue placeholder="All clients" />397 |                 </SelectTrigger>398 |                 <SelectContent className="dashboard-dropdown-content">399 |                   <SelectItem value="all" className="dashboard-dropdown-item">All clients</SelectItem>400 |                   {clients.map((client) => (401 |                     <SelectItem key={client.id} value={client.id.toString()} className="dashboard-dropdown-item">402 |                       {client.name}403 |                     </SelectItem>404 |                   ))}405 |                 </SelectContent>406 |               </Select>407 |             </div>408 | 409 |             <div className="space-y-2">410 |               <Label className="dashboard-label">Status</Label>411 |               <Select412 |                 value={filters.status}413 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, status: value }))}414 |               >415 |                 <SelectTrigger className="dashboard-input">416 |                   <SelectValue placeholder="All statuses" />417 |                 </SelectTrigger>418 |                 <SelectContent className="dashboard-dropdown-content">419 |                   <SelectItem value="all" className="dashboard-dropdown-item">All statuses</SelectItem>420 |                   <SelectItem value="pending" className="dashboard-dropdown-item">Pending</SelectItem>421 |                   <SelectItem value="confirmed" className="dashboard-dropdown-item">Confirmed</SelectItem>422 |                   <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>423 |                   <SelectItem value="cancelled" className="dashboard-dropdown-item">Cancelled</SelectItem>424 |                   <SelectItem value="no-show" className="dashboard-dropdown-item">No Show</SelectItem>425 |                 </SelectContent>426 |               </Select>427 |             </div>428 | 429 |             <div className="space-y-2">430 |               <Label className="dashboard-label">Booking Type</Label>431 |               <Select432 |                 value={filters.booking_type}433 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, booking_type: value }))}434 |               >435 |                 <SelectTrigger className="dashboard-input">436 |                   <SelectValue placeholder="All types" />437 |                 </SelectTrigger>438 |                 <SelectContent className="dashboard-dropdown-content">439 |                   <SelectItem value="all" className="dashboard-dropdown-item">All types</SelectItem>440 |                   <SelectItem value="individual" className="dashboard-dropdown-item">Individual</SelectItem>441 |                   <SelectItem value="group" className="dashboard-dropdown-item">Group</SelectItem>442 |                 </SelectContent>443 |               </Select>444 |             </div>445 | 446 |             <div className="space-y-2">447 |               <Label className="dashboard-label">Date From</Label>448 |               <BaseInput449 |                 type="date"450 |                 className="dashboard-input"451 |                 value={filters.date_from}452 |                 onChange={(e) => setFilters(prev => ({ ...prev, date_from: e.target.value }))}453 |               />454 |             </div>455 | 456 |             <div className="space-y-2">457 |               <Label className="dashboard-label">Date To</Label>458 |               <BaseInput459 |                 type="date"460 |                 className="dashboard-input"461 |                 value={filters.date_to}462 |                 onChange={(e) => setFilters(prev => ({ ...prev, date_to: e.target.value }))}463 |               />464 |             </div>465 | 466 |             <div className="space-y-2">467 |               <Label className="dashboard-label">Package Type</Label>468 |               <Select469 |                 value={filters.package_type}470 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, package_type: value }))}471 |               >472 |                 <SelectTrigger className="dashboard-input">473 |                   <SelectValue placeholder="All package types" />474 |                 </SelectTrigger>475 |                 <SelectContent className="dashboard-dropdown-content">476 |                   <SelectItem value="all" className="dashboard-dropdown-item">All package types</SelectItem>477 |                   <SelectItem value="individual" className="dashboard-dropdown-item">Individual</SelectItem>478 |                   <SelectItem value="group" className="dashboard-dropdown-item">Group</SelectItem>479 |                   <SelectItem value="mixed" className="dashboard-dropdown-item">Mixed</SelectItem>480 |                 </SelectContent>481 |               </Select>482 |             </div>483 |           </div>484 |         </CardContent>485 |       </Card>486 | 487 |       {}488 |       <Card className="dashboard-card">489 |         <CardHeader>490 |           <CardTitle className="dashboard-card-title">Bookings</CardTitle>491 |           <CardDescription>492 |             Showing {bookings.length} of {pagination.total} bookings493 |           </CardDescription>494 |         </CardHeader>495 |         <CardContent>496 |           {bookings.length === 0 ? (497 |             <div className="text-center py-8">498 |               <Calendar className="w-12 h-12 text-gray-400 mx-auto mb-4" />499 |               <p className="text-gray-600">No bookings found</p>500 |               <p className="text-sm text-gray-500 mt-2">Try adjusting your filters or create a new booking</p>501 |             </div>502 |           ) : (503 |             <div className="overflow-x-auto">504 |               <table className="w-full">505 |                 <thead>506 |                   <tr className="border-b border-gray-200">507 |                     <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Client</th>508 |                     <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Date & Time</th>509 |                     <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Package</th>510 |                     <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Type</th>511 |                     <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Status</th>512 |                     <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Amount</th>513 |                     <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Actions</th>514 |                   </tr>515 |                 </thead>516 |                 <tbody>517 |                   {bookings.map((booking) => (518 |                     <tr key={booking.id} className="border-b border-gray-100 hover:bg-gray-50">519 |                       <td className="py-3 px-4">520 |                         <div>521 |                           <p className="font-medium text-dashboard-text-primary">522 |                             {booking.client?.name || 'Client'}523 |                           </p>524 |                           <p className="text-sm text-dashboard-text-secondary">525 |                             {booking.client?.email || booking.clientEmail || 'No email'}526 |                           </p>527 |                         </div>528 |                       </td>529 |                       <td className="py-3 px-4">530 |                         <div>531 |                           <p className="font-medium text-dashboard-text-primary">532 |                             {booking.schedule_slot ? formatDate(booking.schedule_slot.start_time) : 'No slot'}533 |                           </p>534 |                           <p className="text-sm text-dashboard-text-secondary">535 |                             {booking.schedule_slot ? formatDateTime(booking.schedule_slot.start_time) : 'No time'}536 |                           </p>537 |                         </div>538 |                       </td>539 |                       <td className="py-3 px-4">540 |                         <div>541 |                           <p className="font-medium text-dashboard-text-primary">542 |                             {booking.user_package?.package_definition?.name || 'No package'}543 |                           </p>544 |                           <p className="text-sm text-dashboard-text-secondary">545 |                             {booking.user_package?.package_definition?.session_durations?.duration_minutes || '0'} min546 |                           </p>547 |                         </div>548 |                       </td>549 |                       <td className="py-3 px-4">550 |                         {getBookingTypeBadge(booking.booking_type)}551 |                         {booking.booking_type === 'group' && booking.group_size && (552 |                           <p className="text-sm text-dashboard-text-secondary mt-1">553 |                             Size: {booking.group_size}554 |                           </p>555 |                         )}556 |                       </td>557 |                       <td className="py-3 px-4">558 |                         <Select559 |                           value={booking.status}560 |                           onValueChange={(value) => handleStatusUpdate(booking.id, value)}561 |                         >562 |                           <SelectTrigger className="w-32">563 |                             <SelectValue />564 |                           </SelectTrigger>565 |                                           <SelectContent className="dashboard-dropdown-content">566 |                   <SelectItem value="pending" className="dashboard-dropdown-item">Pending</SelectItem>567 |                   <SelectItem value="confirmed" className="dashboard-dropdown-item">Confirmed</SelectItem>568 |                   <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>569 |                   <SelectItem value="cancelled" className="dashboard-dropdown-item">Cancelled</SelectItem>570 |                   <SelectItem value="no-show" className="dashboard-dropdown-item">No Show</SelectItem>571 |                 </SelectContent>572 |                         </Select>573 |                       </td>574 |                       <td className="py-3 px-4">575 |                         {booking.final_amount ? (576 |                           <div>577 |                             <p className="font-medium text-dashboard-text-primary">578 |                               ${booking.final_amount}579 |                             </p>580 |                             {booking.discount_amount > 0 && (581 |                               <p className="text-sm text-dashboard-text-secondary">582 |                                 -${booking.discount_amount} discount583 |                               </p>584 |                             )}585 |                           </div>586 |                         ) : (587 |                           <span className="text-dashboard-text-secondary">Not set</span>588 |                         )}589 |                       </td>590 |                       <td className="py-3 px-4">591 |                         <div className="flex items-center gap-2">592 |                           <BaseButton593 |                             variant="outline"594 |                             size="sm"595 |                             onClick={() => {596 |                               setSelectedItem(booking);597 |                               setShowDeleteModal(true);598 |                             }}599 |                             className="border-red-500/30 text-red-400 hover:bg-red-500/10"600 |                           >601 |                             <Trash2 size={14} />602 |                           </BaseButton>603 |                         </div>604 |                       </td>605 |                     </tr>606 |                   ))}607 |                 </tbody>608 |               </table>609 |             </div>610 |           )}611 |         </CardContent>612 |       </Card>613 | 614 |       {}615 |       {pagination.totalPages > 1 && (616 |         <div className="flex items-center justify-between">617 |           <div className="text-sm text-dashboard-text-secondary">618 |             Page {pagination.page} of {pagination.totalPages}619 |           </div>620 |           <div className="flex gap-2">621 |             <BaseButton622 |               variant="outline"623 |               className="dashboard-button-outline"624 |               onClick={() => setPagination(prev => ({ ...prev, page: prev.page - 1 }))}625 |               disabled={pagination.page <= 1}626 |             >627 |               Previous628 |             </BaseButton>629 |             <BaseButton630 |               variant="outline"631 |               className="dashboard-button-outline"632 |               onClick={() => setPagination(prev => ({ ...prev, page: prev.page + 1 }))}633 |               disabled={pagination.page >= pagination.totalPages}634 |             >635 |               Next636 |             </BaseButton>637 |           </div>638 |         </div>639 |       )}640 | 641 |       {}642 |       <DeleteConfirmationModal643 |         isOpen={showDeleteModal}644 |         onClose={() => {645 |           setShowDeleteModal(false);646 |           setSelectedItem(null);647 |         }}648 |         onConfirm={handleDelete}649 |         title="Delete Booking"650 |         description="Are you sure you want to delete this booking? This action cannot be undone."651 |                         itemName={selectedItem ? `${selectedItem.client?.name || selectedItem.clientEmail || 'Unknown Client'} - ${selectedItem.schedule_slot ? formatDate(selectedItem.schedule_slot.start_time) : 'unknown date'}` : undefined}652 |         itemType="booking"653 |       />654 |     </div>655 |   );656 | };657 | 658 | export default BookingsManagement;
============================================================END: frontend/components/BookingsManagement.tsx============================================================


============================================================FILE: frontend/components/BugReportButton.tsxSIZE: 9.44 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import Image from 'next/image';  5 | import { Bug, X, Camera, Send } from 'lucide-react';  6 | import { motion, AnimatePresence } from 'framer-motion';  7 | import { BaseModal } from '@/components/ui/BaseModal';  8 | import { BaseButton } from '@/components/ui/BaseButton';  9 | import { BaseInput } from '@/components/ui/BaseInput'; 10 |  11 | import { toast } from 'sonner'; 12 | import { useAuth } from '@/hooks/useAuth'; 13 | import html2canvas from 'html2canvas'; 14 |  15 | interface BugReportData { 16 |   title: string; 17 |   description: string; 18 |   category: string; 19 |   priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL'; 20 | } 21 |  22 | export function BugReportButton() { 23 |   const { user } = useAuth(); 24 |   const [isModalOpen, setIsModalOpen] = useState(false); 25 |   const [isCapturing, setIsCapturing] = useState(false); 26 |   const [screenshot, setScreenshot] = useState<string | null>(null); 27 |   const [formData, setFormData] = useState<BugReportData>({ 28 |     title: '', 29 |     description: '', 30 |     category: '', 31 |     priority: 'MEDIUM' 32 |   }); 33 |   const [isSubmitting, setIsSubmitting] = useState(false); 34 |  35 |   const captureScreenshot = async () => { 36 |     setIsCapturing(true); 37 |     try { 38 |  39 |       const canvas = await html2canvas(document.body, { 40 |         useCORS: true, 41 |         allowTaint: true, 42 |         scrollX: 0, 43 |         scrollY: 0, 44 |         width: window.innerWidth, 45 |         height: window.innerHeight, 46 |         backgroundColor: '#1a1a2e' 47 |       }); 48 |  49 |       const dataUrl = canvas.toDataURL('image/png'); 50 |       setScreenshot(dataUrl); 51 |       toast.success('Screenshot captured successfully!'); 52 |     } catch (error) { 53 |       toast.error('Failed to capture screenshot'); 54 |     } finally { 55 |       setIsCapturing(false); 56 |     } 57 |   }; 58 |  59 |   const handleSubmit = async (e: React.FormEvent) => { 60 |     e.preventDefault(); 61 |     if (!user) { 62 |       toast.error('Please log in to submit a bug report'); 63 |       return; 64 |     } 65 |  66 |     if (!formData.title.trim() || !formData.description.trim()) { 67 |       toast.error('Please fill in all required fields'); 68 |       return; 69 |     } 70 |  71 |     setIsSubmitting(true); 72 |     try { 73 |       const response = await fetch('/api/bug-reports', { 74 |         method: 'POST', 75 |         headers: { 76 |           'Content-Type': 'application/json', 77 |           'Authorization': `Bearer ${user.access_token}`, 78 |         }, 79 |         body: JSON.stringify({ 80 |           ...formData, 81 |           screenshot, 82 |         }), 83 |       }); 84 |  85 |       if (response.ok) { 86 |         toast.success('Bug report submitted successfully!'); 87 |         setIsModalOpen(false); 88 |         resetForm(); 89 |       } else { 90 |         const error = await response.json(); 91 |         toast.error(error.message || 'Failed to submit bug report'); 92 |       } 93 |     } catch (error) { 94 |       toast.error('Failed to submit bug report'); 95 |     } finally { 96 |       setIsSubmitting(false); 97 |     } 98 |   }; 99 | 100 |   const resetForm = () => {101 |     setFormData({102 |       title: '',103 |       description: '',104 |       category: '',105 |       priority: 'MEDIUM'106 |     });107 |     setScreenshot(null);108 |   };109 | 110 |   const handleModalClose = () => {111 |     setIsModalOpen(false);112 |     resetForm();113 |   };114 | 115 |   return (116 |     <>117 |       {}118 |       <motion.div119 |         className="fixed bottom-6 right-6 z-50"120 |         whileHover={{ scale: 1.1 }}121 |         whileTap={{ scale: 0.9 }}122 |       >123 |         <button124 |           onClick={() => setIsModalOpen(true)}125 |           className="bg-red-500 hover:bg-red-600 text-white p-4 rounded-full shadow-lg transition-all duration-200 flex items-center justify-center"126 |           title="Report a Bug"127 |         >128 |           <Bug size={24} />129 |         </button>130 |       </motion.div>131 | 132 |       {}133 |       <AnimatePresence>134 |         {isModalOpen && (135 |           <BaseModal136 |             isOpen={isModalOpen}137 |             onClose={handleModalClose}138 |             size="lg"139 |             title="Report a Bug"140 |           >141 |             <form onSubmit={handleSubmit} className="space-y-6">142 |               {}143 |               <div className="space-y-3">144 |                 <label className="text-sm font-medium text-gray-300">145 |                   Screenshot (Optional)146 |                 </label>147 |                 <div className="flex items-center space-x-3">148 |                   <BaseButton149 |                     type="button"150 |                     onClick={captureScreenshot}151 |                     disabled={isCapturing}152 |                     variant="outline"153 |                     size="sm"154 |                     leftIcon={<Camera size={16} />}155 |                   >156 |                     {isCapturing ? 'Capturing...' : 'Capture Screenshot'}157 |                   </BaseButton>158 |                   {screenshot && (159 |                     <BaseButton160 |                       type="button"161 |                       onClick={() => setScreenshot(null)}162 |                       variant="outline"163 |                       size="sm"164 |                       leftIcon={<X size={16} />}165 |                     >166 |                       Remove167 |                     </BaseButton>168 |                   )}169 |                 </div>170 |                 {screenshot && (171 |                   <div className="mt-3">172 |                     <Image173 |                       src={screenshot}174 |                       alt="Screenshot"175 |                       width={300}176 |                       height={128}177 |                       className="max-w-full h-32 object-cover rounded-lg border border-gray-600"178 |                     />179 |                   </div>180 |                 )}181 |               </div>182 | 183 |               {}184 |               <div className="space-y-2">185 |                 <label htmlFor="title" className="text-sm font-medium text-gray-300">186 |                   Bug Title *187 |                 </label>188 |                 <BaseInput189 |                   id="title"190 |                   value={formData.title}191 |                   onChange={(e) => setFormData({ ...formData, title: e.target.value })}192 |                   placeholder="Brief description of the issue"193 |                   required194 |                 />195 |               </div>196 | 197 |               {}198 |               <div className="space-y-2">199 |                 <label htmlFor="category" className="text-sm font-medium text-gray-300">200 |                   Category201 |                 </label>202 |                 <select203 |                   id="category"204 |                   value={formData.category}205 |                   onChange={(e) => setFormData({ ...formData, category: e.target.value })}206 |                   className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"207 |                 >208 |                   <option value="">Select a category</option>209 |                   <option value="UI/UX">UI/UX Issue</option>210 |                   <option value="Functionality">Functionality Problem</option>211 |                   <option value="Performance">Performance Issue</option>212 |                   <option value="Payment">Payment Problem</option>213 |                   <option value="Booking">Booking System</option>214 |                   <option value="Other">Other</option>215 |                 </select>216 |               </div>217 | 218 |               {}219 |               <div className="space-y-2">220 |                 <label htmlFor="priority" className="text-sm font-medium text-gray-300">221 |                   Priority222 |                 </label>223 |                 <select224 |                   id="priority"225 |                   value={formData.priority}226 |                   onChange={(e) => setFormData({ ...formData, priority: e.target.value as 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL' })}227 |                   className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"228 |                 >229 |                   <option value="LOW">Low</option>230 |                   <option value="MEDIUM">Medium</option>231 |                   <option value="HIGH">High</option>232 |                   <option value="CRITICAL">Critical</option>233 |                 </select>234 |               </div>235 | 236 |               {}237 |               <div className="space-y-2">238 |                 <label htmlFor="description" className="text-sm font-medium text-gray-300">239 |                   Description *240 |                 </label>241 |                 <textarea242 |                   id="description"243 |                   value={formData.description}244 |                   onChange={(e) => setFormData({ ...formData, description: e.target.value })}245 |                   placeholder="Please describe the issue in detail, including steps to reproduce..."246 |                   rows={4}247 |                   className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"248 |                   required249 |                 />250 |               </div>251 | 252 |               {}253 |               <div className="flex justify-end space-x-3 pt-4">254 |                 <BaseButton255 |                   type="button"256 |                   onClick={handleModalClose}257 |                   variant="outline"258 |                   size="md"259 |                 >260 |                   Cancel261 |                 </BaseButton>262 |                 <BaseButton263 |                   type="submit"264 |                   disabled={isSubmitting}265 |                   variant="primary"266 |                   size="md"267 |                   leftIcon={<Send size={16} />}268 |                 >269 |                   {isSubmitting ? 'Submitting...' : 'Submit Report'}270 |                 </BaseButton>271 |               </div>272 |             </form>273 |           </BaseModal>274 |         )}275 |       </AnimatePresence>276 |     </>277 |   );278 | }
============================================================END: frontend/components/BugReportButton.tsx============================================================


============================================================FILE: frontend/components/BugReportManagement.tsxSIZE: 29.48 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, forwardRef, useImperativeHandle, useCallback } from 'react';  4 | import Image from 'next/image';  5 |   6 | import {  7 |   Bug,  8 |   Eye,  9 |   MessageSquare, 10 |   Archive, 11 |   CheckCircle, 12 |   Clock, 13 |   AlertTriangle, 14 |   User, 15 |   Calendar, 16 |  17 |   Search 18 | } from 'lucide-react'; 19 | import { BaseCard } from '@/components/ui/BaseCard'; 20 | import { BaseButton } from '@/components/ui/BaseButton'; 21 | import { BaseInput } from '@/components/ui/BaseInput'; 22 | import { BaseModal } from '@/components/ui/BaseModal'; 23 | import { toast } from 'sonner'; 24 | import { useAuth } from '@/hooks/useAuth'; 25 | import { BugReportSystem } from './BugReportSystem'; 26 |  27 | interface Annotation { 28 |   id: string; 29 |   type: 'drawing' | 'text'; 30 |   points?: { x: number; y: number }[]; 31 |   text?: string; 32 |   textPosition?: { x: number; y: number }; 33 |   color: string; 34 |   strokeWidth: number; 35 |   fontSize: number; 36 | } 37 |  38 | interface BugReport { 39 |   id: string; 40 |   title: string; 41 |   description: string; 42 |   screenshot: string | null; 43 |   annotations: Annotation[] | null; 44 |   status: 'OPEN' | 'IN_PROGRESS' | 'RESOLVED' | 'CLOSED' | 'ARCHIVED'; 45 |   priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL'; 46 |   category: string; 47 |   reporterId: string | null; 48 |   assignedTo: string | null; 49 |   createdAt: string; 50 |   updatedAt: string; 51 |   resolvedAt: string | null; 52 |   archivedAt: string | null; 53 |   reporter?: { 54 |     fullName: string; 55 |     email: string; 56 |   }; 57 |   assignee?: { 58 |     fullName: string; 59 |     email: string; 60 |   }; 61 |   comments?: BugComment[]; 62 | } 63 |  64 | interface BugComment { 65 |   id: string; 66 |   content: string; 67 |   authorId: string; 68 |   createdAt: string; 69 |   author?: { 70 |     fullName: string; 71 |     email: string; 72 |   }; 73 | } 74 |  75 | interface BugReportFilters { 76 |   status: string; 77 |   priority: string; 78 |   category: string; 79 |   search: string; 80 | } 81 |  82 | export interface BugReportManagementRef { 83 |   refreshBugReports: () => void; 84 | } 85 |  86 | export const BugReportManagement = forwardRef<BugReportManagementRef>((_, ref) => { 87 |   const { user } = useAuth(); 88 |   const [bugReports, setBugReports] = useState<BugReport[]>([]); 89 |   const [loading, setLoading] = useState(true); 90 |   const [selectedBug, setSelectedBug] = useState<BugReport | null>(null); 91 |   const [isDetailModalOpen, setIsDetailModalOpen] = useState(false); 92 |   const [isCommentModalOpen, setIsCommentModalOpen] = useState(false); 93 |   const [newComment, setNewComment] = useState(''); 94 |   const [filters, setFilters] = useState<BugReportFilters>({ 95 |     status: '', 96 |     priority: '', 97 |     category: '', 98 |     search: '' 99 |   });100 | 101 |   const fetchBugReports = useCallback(async () => {102 |     try {103 |       const queryParams = new URLSearchParams();104 |       if (filters.status) queryParams.append('status', filters.status);105 |       if (filters.priority) queryParams.append('priority', filters.priority);106 |       if (filters.category) queryParams.append('category', filters.category);107 |       if (filters.search) queryParams.append('search', filters.search);108 | 109 |       const response = await fetch(`/api/admin/bug-reports?${queryParams}`, {110 |         headers: {111 |           'Authorization': `Bearer ${user?.access_token}`,112 |         },113 |       });114 | 115 |       if (response.ok) {116 |         const data = await response.json();117 |         setBugReports(data.bugReports || []);118 |       } else {119 |         toast.error('Failed to fetch bug reports');120 |       }121 |     } catch (error) {122 |       toast.error('Failed to fetch bug reports');123 |     } finally {124 |       setLoading(false);125 |     }126 |   }, [filters, user?.access_token]);127 | 128 |   useEffect(() => {129 |     if (user?.access_token) {130 |       fetchBugReports();131 |     }132 |   }, [user, filters, fetchBugReports]);133 | 134 |   useImperativeHandle(ref, () => ({135 |     refreshBugReports: fetchBugReports136 |   }), [fetchBugReports]);137 | 138 |   const updateBugStatus = async (bugId: string, status: string) => {139 |     try {140 |       const response = await fetch(`/api/admin/bug-reports/${bugId}/status`, {141 |         method: 'PATCH',142 |         headers: {143 |           'Content-Type': 'application/json',144 |           'Authorization': `Bearer ${user?.access_token}`,145 |         },146 |         body: JSON.stringify({ status }),147 |       });148 | 149 |       if (response.ok) {150 |         toast.success('Bug status updated successfully');151 |         fetchBugReports();152 |       } else {153 |         toast.error('Failed to update bug status');154 |       }155 |     } catch (error) {156 |       toast.error('Failed to update bug status');157 |     }158 |   };159 | 160 |   const assignBug = async (bugId: string, assigneeId: string | null) => {161 |     try {162 |       const response = await fetch(`/api/admin/bug-reports/${bugId}/assign`, {163 |         method: 'PATCH',164 |         headers: {165 |           'Content-Type': 'application/json',166 |           'Authorization': `Bearer ${user?.access_token}`,167 |         },168 |         body: JSON.stringify({ assigneeId }),169 |       });170 | 171 |       if (response.ok) {172 |         toast.success('Bug assignment updated successfully');173 |         fetchBugReports();174 |       } else {175 |         toast.error('Failed to update bug assignment');176 |       }177 |     } catch (error) {178 |       toast.error('Failed to update bug assignment');179 |     }180 |   };181 | 182 |   const addComment = async (bugId: string) => {183 |     if (!newComment.trim()) return;184 | 185 |     try {186 |       const response = await fetch(`/api/admin/bug-reports/${bugId}/comments`, {187 |         method: 'POST',188 |         headers: {189 |           'Content-Type': 'application/json',190 |           'Authorization': `Bearer ${user?.access_token}`,191 |         },192 |         body: JSON.stringify({ content: newComment }),193 |       });194 | 195 |       if (response.ok) {196 |         toast.success('Comment added successfully');197 |         setNewComment('');198 |         setIsCommentModalOpen(false);199 |         fetchBugReports();200 |       } else {201 |         toast.error('Failed to add comment');202 |       }203 |     } catch (error) {204 |       toast.error('Failed to add comment');205 |     }206 |   };207 | 208 |   const archiveBug = async (bugId: string) => {209 |     if (!confirm('Are you sure you want to archive this bug report?')) return;210 | 211 |     try {212 |       const response = await fetch(`/api/admin/bug-reports/${bugId}/archive`, {213 |         method: 'PATCH',214 |         headers: {215 |           'Authorization': `Bearer ${user?.access_token}`,216 |         },217 |       });218 | 219 |       if (response.ok) {220 |         toast.success('Bug report archived successfully');221 |         fetchBugReports();222 |       } else {223 |         toast.error('Failed to archive bug report');224 |       }225 |     } catch (error) {226 |       toast.error('Failed to archive bug report');227 |     }228 |   };229 | 230 |   const getStatusColor = (status: string) => {231 |     switch (status) {232 |       case 'OPEN': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';233 |       case 'IN_PROGRESS': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';234 |       case 'RESOLVED': return 'bg-green-500/20 text-green-400 border-green-500/30';235 |       case 'CLOSED': return 'bg-gray-500/20 text-gray-400 border-gray-500/30';236 |       case 'ARCHIVED': return 'bg-purple-500/20 text-purple-400 border-purple-500/30';237 |       default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';238 |     }239 |   };240 | 241 |   const getPriorityColor = (priority: string) => {242 |     switch (priority) {243 |       case 'LOW': return 'bg-green-500/20 text-green-400 border-green-500/30';244 |       case 'MEDIUM': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';245 |       case 'HIGH': return 'bg-orange-500/20 text-orange-400 border-orange-500/30';246 |       case 'CRITICAL': return 'bg-red-500/20 text-red-400 border-red-500/30';247 |       default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';248 |     }249 |   };250 | 251 |   const getStatusIcon = (status: string) => {252 |     switch (status) {253 |       case 'OPEN': return <AlertTriangle size={16} />;254 |       case 'IN_PROGRESS': return <Clock size={16} />;255 |       case 'RESOLVED': return <CheckCircle size={16} />;256 |       case 'CLOSED': return <CheckCircle size={16} />;257 |       case 'ARCHIVED': return <Archive size={16} />;258 |       default: return <Bug size={16} />;259 |     }260 |   };261 | 262 |   if (loading) {263 |     return (264 |       <div className="flex items-center justify-center min-h-[400px]">265 |         <div className="text-center">266 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>267 |           <p className="text-[#FFD700] text-lg font-semibold">Loading bug reports...</p>268 |         </div>269 |       </div>270 |     );271 |   }272 | 273 |   return (274 |     <div className="space-y-6">275 |       {}276 |       <div className="border-b border-gray-600/20 pb-4">277 |         <div className="flex items-center justify-between">278 |           <div>279 |             <h2 className="text-2xl font-bold text-white mb-2">280 |               Bug Report Management281 |             </h2>282 |             <p className="text-gray-400">283 |               Monitor and manage bug reports from users284 |             </p>285 |           </div>286 |           <BugReportSystem>287 |             {({ openReport }) => (288 |               <BaseButton289 |                 onClick={openReport}290 |                 variant="primary"291 |                 size="md"292 |                 leftIcon={<Bug size={16} />}293 |               >294 |                 Report Bug295 |               </BaseButton>296 |             )}297 |           </BugReportSystem>298 |         </div>299 |       </div>300 | 301 |       {}302 |       <BaseCard variant="default" size="md">303 |         <BaseCard.Content>304 |           <div className="grid grid-cols-1 md:grid-cols-4 gap-4">305 |             <div>306 |               <label className="text-sm font-medium text-gray-300 mb-2 block">Status</label>307 |               <select308 |                 value={filters.status}309 |                 onChange={(e) => setFilters({ ...filters, status: e.target.value })}310 |                 className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"311 |               >312 |                 <option value="">All Statuses</option>313 |                 <option value="OPEN">Open</option>314 |                 <option value="IN_PROGRESS">In Progress</option>315 |                 <option value="RESOLVED">Resolved</option>316 |                 <option value="CLOSED">Closed</option>317 |                 <option value="ARCHIVED">Archived</option>318 |               </select>319 |             </div>320 | 321 |             <div>322 |               <label className="text-sm font-medium text-gray-300 mb-2 block">Priority</label>323 |               <select324 |                 value={filters.priority}325 |                 onChange={(e) => setFilters({ ...filters, priority: e.target.value })}326 |                 className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"327 |               >328 |                 <option value="">All Priorities</option>329 |                 <option value="LOW">Low</option>330 |                 <option value="MEDIUM">Medium</option>331 |                 <option value="HIGH">High</option>332 |                 <option value="CRITICAL">Critical</option>333 |               </select>334 |             </div>335 | 336 |             <div>337 |               <label className="text-sm font-medium text-gray-300 mb-2 block">Category</label>338 |               <select339 |                 value={filters.category}340 |                 onChange={(e) => setFilters({ ...filters, category: e.target.value })}341 |                 className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"342 |               >343 |                 <option value="">All Categories</option>344 |                 <option value="UI/UX">UI/UX Issue</option>345 |                 <option value="Functionality">Functionality Problem</option>346 |                 <option value="Performance">Performance Issue</option>347 |                 <option value="Payment">Payment Problem</option>348 |                 <option value="Booking">Booking System</option>349 |                 <option value="Other">Other</option>350 |               </select>351 |             </div>352 | 353 |             <div>354 |               <label className="text-sm font-medium text-gray-300 mb-2 block">Search</label>355 |               <div className="relative">356 |                 <Search size={16} className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />357 |                 <BaseInput358 |                   value={filters.search}359 |                   onChange={(e) => setFilters({ ...filters, search: e.target.value })}360 |                   placeholder="Search bugs..."361 |                   className="pl-10"362 |                 />363 |               </div>364 |             </div>365 |           </div>366 |         </BaseCard.Content>367 |       </BaseCard>368 | 369 |       {}370 |       <div className="space-y-4">371 |         {bugReports.length === 0 ? (372 |           <BaseCard variant="default" size="md">373 |             <BaseCard.Content>374 |               <div className="text-center py-8">375 |                 <Bug size={48} className="mx-auto text-gray-500 mb-4" />376 |                 <p className="text-gray-400">No bug reports found</p>377 |               </div>378 |             </BaseCard.Content>379 |           </BaseCard>380 |         ) : (381 |           bugReports.map((bug) => (382 |             <BaseCard key={bug.id} variant="default" size="md">383 |               <BaseCard.Content>384 |                 <div className="flex items-start justify-between">385 |                   <div className="flex-1 space-y-3">386 |                     <div className="flex items-center space-x-3">387 |                       <h3 className="text-lg font-medium text-white">{bug.title}</h3>388 |                       <span className={`px-2 py-1 rounded-full text-xs font-medium border ${getStatusColor(bug.status)}`}>389 |                         {getStatusIcon(bug.status)} {bug.status.replace('_', ' ')}390 |                       </span>391 |                       <span className={`px-2 py-1 rounded-full text-xs font-medium border ${getPriorityColor(bug.priority)}`}>392 |                         {bug.priority}393 |                       </span>394 |                     </div>395 | 396 |                     <p className="text-gray-400 text-sm line-clamp-2">{bug.description}</p>397 | 398 |                     <div className="flex items-center space-x-4 text-sm text-gray-500">399 |                       <div className="flex items-center space-x-1">400 |                         <User size={14} />401 |                         <span>{bug.reporter?.fullName || 'Anonymous'}</span>402 |                         {bug.reporter?.email && (403 |                           <span className="text-gray-600">({bug.reporter.email})</span>404 |                         )}405 |                       </div>406 |                       <div className="flex items-center space-x-1">407 |                         <Calendar size={14} />408 |                         <span>{new Date(bug.createdAt).toLocaleDateString()}</span>409 |                         <span className="text-gray-600">410 |                           {new Date(bug.createdAt).toLocaleTimeString()}411 |                         </span>412 |                       </div>413 |                       {bug.category && (414 |                         <span className="px-2 py-1 bg-gray-700 rounded text-xs">{bug.category}</span>415 |                       )}416 |                       {bug.annotations && bug.annotations.length > 0 && (417 |                         <span className="px-2 py-1 bg-blue-700 rounded text-xs">418 |                           {bug.annotations.length} annotation{bug.annotations.length !== 1 ? 's' : ''}419 |                         </span>420 |                       )}421 |                     </div>422 |                   </div>423 | 424 |                   <div className="flex items-center space-x-2 ml-4">425 |                     <BaseButton426 |                       onClick={() => {427 |                         setSelectedBug(bug);428 |                         setIsDetailModalOpen(true);429 |                       }}430 |                       variant="outline"431 |                       size="sm"432 |                       leftIcon={<Eye size={16} />}433 |                     >434 |                       View435 |                     </BaseButton>436 | 437 |                     <BaseButton438 |                       onClick={() => {439 |                         setSelectedBug(bug);440 |                         setIsCommentModalOpen(true);441 |                       }}442 |                       variant="outline"443 |                       size="sm"444 |                       leftIcon={<MessageSquare size={16} />}445 |                     >446 |                       Comment447 |                     </BaseButton>448 | 449 |                     {bug.status !== 'ARCHIVED' && (450 |                       <BaseButton451 |                         onClick={() => archiveBug(bug.id)}452 |                         variant="outline"453 |                         size="sm"454 |                         leftIcon={<Archive size={16} />}455 |                       >456 |                         Archive457 |                       </BaseButton>458 |                     )}459 |                   </div>460 |                 </div>461 |               </BaseCard.Content>462 |             </BaseCard>463 |           ))464 |         )}465 |       </div>466 | 467 |       {}468 |       <BaseModal469 |         isOpen={isDetailModalOpen}470 |         onClose={() => setIsDetailModalOpen(false)}471 |         size="xl"472 |         title={selectedBug?.title || 'Bug Report Details'}473 |       >474 |         {selectedBug && (475 |           <div className="space-y-6">476 |             {}477 |             <div className="p-4 bg-gradient-to-r from-blue-900 to-purple-900 rounded-lg">478 |               <div className="flex items-center justify-between mb-3">479 |                 <h3 className="text-lg font-semibold text-white">Bug Report Summary</h3>480 |                 <div className="flex items-center space-x-2">481 |                   <span className={`px-2 py-1 rounded text-xs font-medium border ${getStatusColor(selectedBug.status)}`}>482 |                     {selectedBug.status.replace('_', ' ')}483 |                   </span>484 |                   <span className={`px-2 py-1 rounded text-xs font-medium border ${getPriorityColor(selectedBug.priority)}`}>485 |                     {selectedBug.priority}486 |                   </span>487 |                 </div>488 |               </div>489 |               <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">490 |                 <div>491 |                   <p className="text-gray-400">Category</p>492 |                   <p className="text-white font-medium">{selectedBug.category || 'Not specified'}</p>493 |                 </div>494 |                 <div>495 |                   <p className="text-gray-400">Reporter</p>496 |                   <p className="text-white font-medium">{selectedBug.reporter?.fullName || 'Anonymous'}</p>497 |                 </div>498 |                 <div>499 |                   <p className="text-gray-400">Annotations</p>500 |                   <p className="text-white font-medium">{selectedBug.annotations?.length || 0}</p>501 |                 </div>502 |                 <div>503 |                   <p className="text-gray-400">Comments</p>504 |                   <p className="text-white font-medium">{selectedBug.comments?.length || 0}</p>505 |                 </div>506 |               </div>507 |             </div>508 | 509 |             {}510 |             <div className="flex items-center justify-between p-4 bg-gray-800 rounded-lg">511 |               <div className="flex items-center space-x-4">512 |                 <span className={`px-3 py-1 rounded-full text-sm font-medium border ${getStatusColor(selectedBug.status)}`}>513 |                   {getStatusIcon(selectedBug.status)} {selectedBug.status.replace('_', ' ')}514 |                 </span>515 |                 <span className={`px-3 py-1 rounded-full text-sm font-medium border ${getPriorityColor(selectedBug.priority)}`}>516 |                   {selectedBug.priority}517 |                 </span>518 |                 {selectedBug.category && (519 |                   <span className="px-3 py-1 bg-gray-700 rounded-full text-sm text-gray-300">520 |                     {selectedBug.category}521 |                   </span>522 |                 )}523 |               </div>524 |               <div className="text-right">525 |                 <p className="text-gray-400 text-sm">Report ID</p>526 |                 <p className="text-white font-mono text-sm">{selectedBug.id}</p>527 |               </div>528 |             </div>529 | 530 |             {}531 |             <div className="p-4 bg-gray-800 rounded-lg">532 |               <h4 className="text-sm font-medium text-gray-300 mb-3">Reporter Information</h4>533 |               <div className="flex items-center space-x-4">534 |                 <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">535 |                   <span className="text-white font-semibold text-lg">536 |                     {selectedBug.reporter?.fullName?.charAt(0).toUpperCase() || 'A'}537 |                   </span>538 |                 </div>539 |                 <div className="flex-1">540 |                   <p className="text-white font-medium">{selectedBug.reporter?.fullName || 'Anonymous'}</p>541 |                   <p className="text-gray-400 text-sm">{selectedBug.reporter?.email}</p>542 |                   <p className="text-gray-500 text-xs mt-1">543 |                     Submitted on {new Date(selectedBug.createdAt).toLocaleDateString()} at {new Date(selectedBug.createdAt).toLocaleTimeString()}544 |                   </p>545 |                 </div>546 |                 <div className="text-right">547 |                   <p className="text-gray-400 text-xs">Last Updated</p>548 |                   <p className="text-white text-xs">{new Date(selectedBug.updatedAt).toLocaleDateString()}</p>549 |                 </div>550 |               </div>551 |             </div>552 | 553 |             {}554 |             <div>555 |               <h4 className="text-sm font-medium text-gray-300 mb-2">Description</h4>556 |               <div className="p-4 bg-gray-800 rounded-lg">557 |                 <p className="text-white whitespace-pre-wrap">{selectedBug.description}</p>558 |               </div>559 |             </div>560 | 561 |             {}562 |             {selectedBug.screenshot && (563 |               <div>564 |                 <div className="flex items-center justify-between mb-2">565 |                   <h4 className="text-sm font-medium text-gray-300">Screenshot</h4>566 |                   {selectedBug.annotations && selectedBug.annotations.length > 0 && (567 |                     <span className="px-2 py-1 bg-blue-600 rounded text-xs text-white">568 |                       {selectedBug.annotations.length} annotation{selectedBug.annotations.length !== 1 ? 's' : ''}569 |                     </span>570 |                   )}571 |                 </div>572 |                 <div className="relative">573 |                   <Image574 |                     src={selectedBug.screenshot}575 |                     alt="Bug Screenshot"576 |                     width={600}577 |                     height={320}578 |                     className="max-w-full h-80 object-contain rounded-lg border border-gray-600"579 |                   />580 |                   {selectedBug.annotations && selectedBug.annotations.length > 0 && (581 |                     <div className="absolute top-2 right-2 bg-black/70 rounded p-2">582 |                       <p className="text-white text-xs">Contains annotations</p>583 |                     </div>584 |                   )}585 |                 </div>586 |               </div>587 |             )}588 | 589 |             {}590 |             <div className="grid grid-cols-2 gap-4">591 |               <div>592 |                 <h4 className="text-sm font-medium text-gray-300 mb-2">Status</h4>593 |                 <select594 |                   value={selectedBug.status}595 |                   onChange={(e) => updateBugStatus(selectedBug.id, e.target.value)}596 |                   className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"597 |                 >598 |                   <option value="OPEN">Open</option>599 |                   <option value="IN_PROGRESS">In Progress</option>600 |                   <option value="RESOLVED">Resolved</option>601 |                   <option value="CLOSED">Closed</option>602 |                   <option value="ARCHIVED">Archived</option>603 |                 </select>604 |               </div>605 | 606 |               <div>607 |                 <h4 className="text-sm font-medium text-gray-300 mb-2">Assigned To</h4>608 |                 <select609 |                   value={selectedBug.assignedTo || ''}610 |                   onChange={(e) => assignBug(selectedBug.id, e.target.value || null)}611 |                   className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"612 |                 >613 |                   <option value="">Unassigned</option>614 |                   {}615 |                 </select>616 |               </div>617 |             </div>618 | 619 |             {}620 |             <div className="grid grid-cols-3 gap-4 p-4 bg-gray-800 rounded-lg">621 |               <div>622 |                 <h4 className="text-sm font-medium text-gray-300 mb-1">Created</h4>623 |                 <p className="text-white text-sm">{new Date(selectedBug.createdAt).toLocaleString()}</p>624 |               </div>625 |               <div>626 |                 <h4 className="text-sm font-medium text-gray-300 mb-1">Last Updated</h4>627 |                 <p className="text-white text-sm">{new Date(selectedBug.updatedAt).toLocaleString()}</p>628 |               </div>629 |               {selectedBug.resolvedAt && (630 |                 <div>631 |                   <h4 className="text-sm font-medium text-gray-300 mb-1">Resolved</h4>632 |                   <p className="text-white text-sm">{new Date(selectedBug.resolvedAt).toLocaleString()}</p>633 |                 </div>634 |               )}635 |             </div>636 | 637 |             {}638 |             {selectedBug.annotations && selectedBug.annotations.length > 0 && (639 |               <div>640 |                 <h4 className="text-sm font-medium text-gray-300 mb-2">641 |                   Annotations ({selectedBug.annotations.length})642 |                 </h4>643 |                 <div className="p-4 bg-gray-800 rounded-lg">644 |                   <div className="grid grid-cols-1 md:grid-cols-2 gap-3">645 |                     {selectedBug.annotations.map((annotation: Annotation, index: number) => (646 |                       <div key={annotation.id || index} className="flex items-center space-x-3 p-3 bg-gray-700 rounded-lg">647 |                         <div648 |                           className="w-6 h-6 rounded border-2 border-white"649 |                           style={{ backgroundColor: annotation.color }}650 |                         />651 |                         <div className="flex-1">652 |                           <div className="flex items-center space-x-2">653 |                             <span className="text-white font-medium text-sm">654 |                               {annotation.type === 'drawing' ? 'Drawing' : 'Text'}655 |                             </span>656 |                             <span className="text-gray-400 text-xs">657 |                               Color: {annotation.color}658 |                             </span>659 |                           </div>660 |                           {annotation.type === 'text' && annotation.text && (661 |                             <p className="text-gray-300 text-sm mt-1">&quot;{annotation.text}&quot;</p>662 |                           )}663 |                           {annotation.type === 'drawing' && (664 |                             <p className="text-gray-400 text-xs mt-1">665 |                               {annotation.points?.length || 0} points • Width: {annotation.strokeWidth}px666 |                             </p>667 |                           )}668 |                           {annotation.type === 'text' && (669 |                             <p className="text-gray-400 text-xs mt-1">670 |                               Font size: {annotation.fontSize}px671 |                             </p>672 |                           )}673 |                         </div>674 |                       </div>675 |                     ))}676 |                   </div>677 |                 </div>678 |               </div>679 |             )}680 | 681 |             {}682 |             {selectedBug.comments && selectedBug.comments.length > 0 && (683 |               <div>684 |                 <h4 className="text-sm font-medium text-gray-300 mb-2">Comments</h4>685 |                 <div className="space-y-3 max-h-48 overflow-y-auto">686 |                   {selectedBug.comments.map((comment) => (687 |                     <div key={comment.id} className="p-3 bg-gray-800 rounded-lg">688 |                       <div className="flex items-center justify-between mb-2">689 |                         <span className="text-sm font-medium text-white">{comment.author?.fullName || 'Admin'}</span>690 |                         <span className="text-xs text-gray-400">{new Date(comment.createdAt).toLocaleString()}</span>691 |                       </div>692 |                       <p className="text-gray-300 text-sm">{comment.content}</p>693 |                     </div>694 |                   ))}695 |                 </div>696 |               </div>697 |             )}698 |           </div>699 |         )}700 |       </BaseModal>701 | 702 |       {}703 |       <BaseModal704 |         isOpen={isCommentModalOpen}705 |         onClose={() => setIsCommentModalOpen(false)}706 |         size="md"707 |         title="Add Comment"708 |       >709 |         <div className="space-y-4">710 |           <div>711 |             <label className="text-sm font-medium text-gray-300 mb-2 block">Comment</label>712 |             <textarea713 |               value={newComment}714 |               onChange={(e) => setNewComment(e.target.value)}715 |               placeholder="Add your comment..."716 |               rows={4}717 |               className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"718 |             />719 |           </div>720 | 721 |           <div className="flex justify-end space-x-3">722 |             <BaseButton723 |               onClick={() => setIsCommentModalOpen(false)}724 |               variant="outline"725 |               size="md"726 |             >727 |               Cancel728 |             </BaseButton>729 |             <BaseButton730 |               onClick={() => selectedBug && addComment(selectedBug.id)}731 |               variant="primary"732 |               size="md"733 |               leftIcon={<MessageSquare size={16} />}734 |             >735 |               Add Comment736 |             </BaseButton>737 |           </div>738 |         </div>739 |       </BaseModal>740 |     </div>741 |   );742 | });743 | 744 | BugReportManagement.displayName = 'BugReportManagement';
============================================================END: frontend/components/BugReportManagement.tsx============================================================


============================================================FILE: frontend/components/BugReportSystem.tsxSIZE: 26.17 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useRef, useCallback, useEffect } from 'react';  4 | import {  5 |   Camera,  6 |   Pen,  7 |   Send,  8 |   RotateCcw,  9 |   Palette 10 | } from 'lucide-react'; 11 | import { BaseButton } from '@/components/ui/BaseButton'; 12 | import { BaseInput } from '@/components/ui/BaseInput'; 13 | import { FullScreenModal } from '@/components/ui/FullScreenModal'; 14 |  15 | import { toast } from 'sonner'; 16 | import { useAuth } from '@/hooks/useAuth'; 17 |  18 | interface Annotation { 19 |   id: string; 20 |   type: 'drawing'; 21 |   points?: { x: number; y: number }[]; 22 |   color: string; 23 |   strokeWidth: number; 24 | } 25 |  26 | interface BugReportData { 27 |   title: string; 28 |   description: string; 29 |   category: string; 30 |   priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL'; 31 |   screenshot: string | null; 32 |   annotations: Annotation[]; 33 |   submitterDetails: { 34 |     fullName: string; 35 |     email: string; 36 |     userId: string; 37 |   }; 38 |   submittedAt: string; 39 |   isCapturingScreenshot?: boolean; 40 | } 41 |  42 | interface BugReportSystemProps { 43 |   children?: (props: { openReport: () => void }) => React.ReactNode; 44 |   onSubmitSuccess?: () => void; 45 | } 46 |  47 | export function BugReportSystem({ children, onSubmitSuccess }: BugReportSystemProps) { 48 |   const { user } = useAuth(); 49 |   const [isOpen, setIsOpen] = useState(false); 50 |  51 |   const [screenshot, setScreenshot] = useState<string | null>(null); 52 |   const [annotations, setAnnotations] = useState<Annotation[]>([]); 53 |   const [currentTool, setCurrentTool] = useState<'pen'>('pen'); 54 |   const [currentColor, setCurrentColor] = useState('#ff0000'); 55 |   const [strokeWidth, setStrokeWidth] = useState(3); 56 |   const [isCapturingScreenshot, setIsCapturingScreenshot] = useState(false); 57 |   const [isSubmitting, setIsSubmitting] = useState(false); 58 |  59 |   const [formData, setFormData] = useState<BugReportData>({ 60 |     title: '', 61 |     description: '', 62 |     category: '', 63 |     priority: 'MEDIUM', 64 |     screenshot: null, 65 |     annotations: [], 66 |     submitterDetails: { 67 |       fullName: user?.email?.split('@')[0] || 'Unknown', 68 |       email: user?.email || '', 69 |       userId: user?.id || '' 70 |     }, 71 |     submittedAt: new Date().toISOString() 72 |   }); 73 |  74 |   const canvasRef = useRef<HTMLCanvasElement>(null); 75 |   const contextRef = useRef<CanvasRenderingContext2D | null>(null); 76 |   const isDrawingRef = useRef(false); 77 |   const lastPointRef = useRef<{ x: number; y: number } | null>(null); 78 |  79 |   const colors = [ 80 |     '#ff0000', '#ff6b6b', '#ffa500', '#ffff00', 81 |     '#00ff00', '#00ffff', '#0000ff', '#ff00ff', 82 |     '#ffffff', '#000000', '#808080', '#c0c0c0' 83 |   ]; 84 |  85 |   useEffect(() => { 86 |     if (canvasRef.current && screenshot) { 87 |       const canvas = canvasRef.current; 88 |       const context = canvas.getContext('2d'); 89 |       if (context) { 90 |         contextRef.current = context; 91 |         context.lineCap = 'round'; 92 |         context.lineJoin = 'round'; 93 |         context.strokeStyle = currentColor; 94 |         context.lineWidth = strokeWidth; 95 |  96 |         const img = new Image(); 97 |         img.onload = () => { 98 |  99 |           canvas.width = img.width;100 |           canvas.height = img.height;101 | 102 |           context.drawImage(img, 0, 0);103 | 104 |           annotations.forEach(annotation => {105 |             if (annotation.type === 'drawing' && annotation.points) {106 |               context.strokeStyle = annotation.color;107 |               context.lineWidth = annotation.strokeWidth;108 |               context.beginPath();109 |               annotation.points.forEach((point, index) => {110 |                 if (index === 0) {111 |                   context.moveTo(point.x, point.y);112 |                 } else {113 |                   context.lineTo(point.x, point.y);114 |                 }115 |               });116 |               context.stroke();117 |             }118 |           });119 |         };120 |         img.src = screenshot;121 |       }122 |     }123 |   }, [screenshot, currentColor, strokeWidth, annotations]);124 | 125 |   const handleScreenshotCapture = useCallback(async (stream: MediaStream) => {126 |     try {127 |       const video = document.createElement('video');128 |       video.srcObject = stream;129 | 130 |       video.onloadedmetadata = () => {131 |         video.play();132 | 133 |         const canvas = document.createElement('canvas');134 |         canvas.width = video.videoWidth;135 |         canvas.height = video.videoHeight;136 | 137 |         const ctx = canvas.getContext('2d');138 |         if (ctx) {139 |           ctx.drawImage(video, 0, 0);140 |           const screenshotDataUrl = canvas.toDataURL('image/png');141 |           setScreenshot(screenshotDataUrl);142 |           setFormData(prev => ({ ...prev, screenshot: screenshotDataUrl }));143 | 144 |           stream.getTracks().forEach(track => track.stop());145 | 146 |           toast.success('Screenshot captured successfully');147 |         }148 |       };149 |     } catch (error) {150 |       toast.error('Failed to process screenshot');151 |     }152 |   }, []);153 | 154 |   const captureScreenshot = useCallback(async () => {155 |     if (isCapturingScreenshot) return;156 | 157 |     try {158 |       setIsCapturingScreenshot(true);159 | 160 |       setIsOpen(false);161 | 162 |       await new Promise(resolve => setTimeout(resolve, 300));163 | 164 |       toast.info('Select screen/window to capture...', { duration: 2000 });165 | 166 |       const stream = await navigator.mediaDevices.getDisplayMedia({167 |         video: { displaySurface: 'monitor' }168 |       });169 | 170 |       await handleScreenshotCapture(stream);171 |       toast.success('Screenshot captured successfully');172 | 173 |       setTimeout(() => {174 |         setIsOpen(true);175 |       }, 500);176 | 177 |     } catch (error) {178 | 179 |       setTimeout(() => {180 |         setIsOpen(true);181 |       }, 500);182 | 183 |       if (error instanceof Error && error.name === 'NotAllowedError') {184 |         toast.error('Screenshot capture was cancelled or denied');185 |       } else {186 |         toast.error('Failed to capture screenshot');187 |       }188 |     } finally {189 |       setIsCapturingScreenshot(false);190 |     }191 |   }, [handleScreenshotCapture, isCapturingScreenshot]);192 | 193 |   const startDrawing = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {194 |     if (currentTool !== 'pen') return;195 | 196 |     const canvas = canvasRef.current;197 |     if (!canvas) return;198 | 199 |     const rect = canvas.getBoundingClientRect();200 |     const scaleX = canvas.width / rect.width;201 |     const scaleY = canvas.height / rect.height;202 |     const x = (e.clientX - rect.left) * scaleX;203 |     const y = (e.clientY - rect.top) * scaleY;204 | 205 |     isDrawingRef.current = true;206 |     lastPointRef.current = { x, y };207 | 208 |     const context = contextRef.current;209 |     if (context) {210 |       context.strokeStyle = currentColor;211 |       context.lineWidth = strokeWidth;212 |       context.beginPath();213 |       context.moveTo(x, y);214 |     }215 |   }, [currentTool, currentColor, strokeWidth]);216 | 217 |   const draw = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {218 |     if (!isDrawingRef.current || currentTool !== 'pen') return;219 | 220 |     const canvas = canvasRef.current;221 |     if (!canvas) return;222 | 223 |     const rect = canvas.getBoundingClientRect();224 |     const scaleX = canvas.width / rect.width;225 |     const scaleY = canvas.height / rect.height;226 |     const x = (e.clientX - rect.left) * scaleX;227 |     const y = (e.clientY - rect.top) * scaleY;228 | 229 |     const context = contextRef.current;230 |     if (context && lastPointRef.current) {231 |       context.lineTo(x, y);232 |       context.stroke();233 | 234 |       const currentAnnotation = annotations[annotations.length - 1];235 |       if (currentAnnotation && currentAnnotation.type === 'drawing') {236 |         currentAnnotation.points?.push({ x, y });237 |       }238 | 239 |       lastPointRef.current = { x, y };240 |     }241 |   }, [currentTool, annotations]);242 | 243 |   const stopDrawing = useCallback(() => {244 |     if (isDrawingRef.current && currentTool === 'pen') {245 |       isDrawingRef.current = false;246 | 247 |       const currentAnnotation = annotations[annotations.length - 1];248 |       if (currentAnnotation && currentAnnotation.type === 'drawing' && currentAnnotation.points) {249 |         setAnnotations(prev => [...prev.slice(0, -1), currentAnnotation]);250 |       }251 |     }252 |   }, [currentTool, annotations]);253 | 254 |   const startDrawingAnnotation = useCallback(() => {255 |     const newAnnotation: Annotation = {256 |       id: Date.now().toString(),257 |       type: 'drawing',258 |       points: [],259 |       color: currentColor,260 |       strokeWidth261 |     };262 |     setAnnotations(prev => [...prev, newAnnotation]);263 |   }, [currentColor, strokeWidth]);264 | 265 |   const clearAnnotations = useCallback(() => {266 |     setAnnotations([]);267 |     if (canvasRef.current && screenshot) {268 |       const canvas = canvasRef.current;269 |       const context = canvas.getContext('2d');270 |       if (context) {271 |         const img = new Image();272 |         img.onload = () => {273 |           context.clearRect(0, 0, canvas.width, canvas.height);274 |           context.drawImage(img, 0, 0);275 |         };276 |         img.src = screenshot;277 |       }278 |     }279 |   }, [screenshot]);280 | 281 |     const submitBugReport = useCallback(async () => {282 |     if (!formData.title.trim() || !formData.description.trim()) {283 |       toast.error('Please fill in all required fields');284 |       return;285 |     }286 | 287 |     if (!user) {288 |       toast.error('You must be logged in to submit a bug report');289 |       return;290 |     }291 | 292 |     const accessToken = user.access_token || localStorage.getItem('auth_token');293 | 294 |     if (!accessToken) {295 |       toast.error('Authentication token not found. Please log in again.');296 |       return;297 |     }298 | 299 |     setIsSubmitting(true);300 |     try {301 | 302 |       let finalScreenshot = screenshot;303 |       if (canvasRef.current && annotations.length > 0) {304 |         finalScreenshot = canvasRef.current.toDataURL('image/png');305 |       }306 | 307 |       const reportData = {308 |         title: formData.title,309 |         description: formData.description,310 |         category: formData.category,311 |         priority: formData.priority,312 |         screenshot: finalScreenshot,313 |         annotations: annotations314 |       };315 | 316 |       const response = await fetch('/api/bug-reports', {317 |         method: 'POST',318 |         headers: {319 |           'Content-Type': 'application/json',320 |           'Authorization': `Bearer ${accessToken}`,321 |         },322 |         body: JSON.stringify(reportData),323 |       });324 | 325 |       const result = await response.json();326 |       if (response.ok) {327 |         toast.success('Bug report submitted successfully');328 | 329 |         setFormData({330 |           title: '',331 |           description: '',332 |           category: '',333 |           priority: 'MEDIUM',334 |           screenshot: null,335 |           annotations: [],336 |           submitterDetails: {337 |             fullName: user?.email?.split('@')[0] || 'Unknown',338 |             email: user?.email || '',339 |             userId: user?.id || ''340 |           },341 |           submittedAt: new Date().toISOString()342 |         });343 | 344 |         setScreenshot(null);345 |         setAnnotations([]);346 |         setIsCapturingScreenshot(false);347 | 348 |         if (canvasRef.current) {349 |           const canvas = canvasRef.current;350 |           const context = canvas.getContext('2d');351 |           if (context) {352 |             context.clearRect(0, 0, canvas.width, canvas.height);353 |           }354 |         }355 | 356 |         setCurrentTool('pen');357 |         setCurrentColor('#ff0000');358 |         setStrokeWidth(3);359 | 360 |         if (onSubmitSuccess) {361 |           onSubmitSuccess();362 |         }363 | 364 |         setTimeout(() => {365 |           setIsOpen(false);366 |         }, 1000);367 | 368 |       } else {369 |         const errorMessage = result.error || result.message || 'Failed to submit bug report';370 |         toast.error(errorMessage);371 |       }372 |     } catch (error) {373 |       const errorMessage = error instanceof Error ? error.message : 'Network error occurred';374 |       toast.error(`Failed to submit bug report: ${errorMessage}`);375 |     } finally {376 |       setIsSubmitting(false);377 |     }378 |   }, [formData, screenshot, annotations, user, onSubmitSuccess]);379 | 380 |   const resetForm = useCallback(() => {381 |     setFormData({382 |       title: '',383 |       description: '',384 |       category: '',385 |       priority: 'MEDIUM',386 |       screenshot: null,387 |       annotations: [],388 |       submitterDetails: {389 |         fullName: user?.email?.split('@')[0] || 'Unknown',390 |         email: user?.email || '',391 |         userId: user?.id || ''392 |       },393 |       submittedAt: new Date().toISOString()394 |     });395 |     setScreenshot(null);396 |     setAnnotations([]);397 |     setCurrentTool('pen');398 |     setCurrentColor('#ff0000');399 |     setStrokeWidth(3);400 |     setIsCapturingScreenshot(false);401 | 402 |     if (canvasRef.current) {403 |       const canvas = canvasRef.current;404 |       const context = canvas.getContext('2d');405 |       if (context) {406 |         context.clearRect(0, 0, canvas.width, canvas.height);407 |       }408 |     }409 |   }, [user]);410 | 411 |   const openReport = () => {412 |     resetForm();413 |     setIsOpen(true);414 |   };415 | 416 |   return (417 |     <>418 |       {children ? (419 |         children({ openReport })420 |       ) : (421 |         <BaseButton422 |           onClick={openReport}423 |           variant="primary"424 |           size="md"425 |           leftIcon={<Camera size={16} />}426 |         >427 |           Report Bug428 |         </BaseButton>429 |       )}430 | 431 |       <FullScreenModal432 |         isOpen={isOpen}433 |         onClose={() => {434 |           if (isSubmitting) return;435 |           setIsOpen(false);436 |           resetForm();437 |         }}438 |         title="Bug Report System"439 |       >440 |         <div className="flex h-full max-w-7xl mx-auto p-4">441 |           {}442 |           <div className="w-1/3 p-6 border-r border-gray-600 overflow-y-auto bg-gray-900">443 |             <div className="space-y-6">444 |               {}445 |               <div>446 |                 <h3 className="text-lg font-semibold text-white mb-4">Submitter Information</h3>447 |                 <div className="space-y-3 p-4 bg-gray-800 rounded-lg">448 |                   <div className="flex items-center space-x-3">449 |                     <div className="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">450 |                       <span className="text-white font-semibold">451 |                         {formData.submitterDetails.fullName.charAt(0).toUpperCase()}452 |                       </span>453 |                     </div>454 |                     <div>455 |                       <p className="text-white font-medium">{formData.submitterDetails.fullName}</p>456 |                       <p className="text-gray-400 text-sm">{formData.submitterDetails.email}</p>457 |                     </div>458 |                   </div>459 |                   <div className="pt-2 border-t border-gray-700">460 |                     <p className="text-gray-400 text-sm">461 |                       <span className="font-medium">Submission Time:</span> {new Date(formData.submittedAt).toLocaleString()}462 |                     </p>463 |                   </div>464 |                 </div>465 |               </div>466 | 467 |               {}468 |               <div>469 |                 <h3 className="text-lg font-semibold text-white mb-4">Bug Information</h3>470 |                 <div className="space-y-4">471 |                   <div>472 |                     <label className="block text-sm font-medium text-gray-300 mb-2">473 |                       Title *474 |                     </label>475 |                     <BaseInput476 |                       value={formData.title}477 |                       onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}478 |                       placeholder="Brief description of the bug"479 |                     />480 |                   </div>481 | 482 |                   <div>483 |                     <label className="block text-sm font-medium text-gray-300 mb-2">484 |                       Description *485 |                     </label>486 |                     <textarea487 |                       value={formData.description}488 |                       onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}489 |                       placeholder="Detailed description of the issue..."490 |                       rows={4}491 |                       className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"492 |                     />493 |                   </div>494 | 495 |                   <div className="grid grid-cols-2 gap-4">496 |                     <div>497 |                       <label className="block text-sm font-medium text-gray-300 mb-2">498 |                         Category499 |                       </label>500 |                       <select501 |                         value={formData.category}502 |                         onChange={(e) => setFormData(prev => ({ ...prev, category: e.target.value }))}503 |                         className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"504 |                       >505 |                         <option value="">Select Category</option>506 |                         <option value="UI/UX">UI/UX Issue</option>507 |                         <option value="Functionality">Functionality Problem</option>508 |                         <option value="Performance">Performance Issue</option>509 |                         <option value="Payment">Payment Problem</option>510 |                         <option value="Booking">Booking System</option>511 |                         <option value="Other">Other</option>512 |                       </select>513 |                     </div>514 | 515 |                     <div>516 |                       <label className="block text-sm font-medium text-gray-300 mb-2">517 |                         Priority518 |                       </label>519 |                       <select520 |                         value={formData.priority}521 |                         onChange={(e) => setFormData(prev => ({ ...prev, priority: e.target.value as 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL' }))}522 |                         className="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"523 |                       >524 |                         <option value="LOW">Low</option>525 |                         <option value="MEDIUM">Medium</option>526 |                         <option value="HIGH">High</option>527 |                         <option value="CRITICAL">Critical</option>528 |                       </select>529 |                     </div>530 |                   </div>531 |                 </div>532 |               </div>533 | 534 |               {}535 |               <div>536 |                 <h3 className="text-lg font-semibold text-white mb-4">Screenshot</h3>537 |                 <div className="space-y-4">538 |                   {!screenshot ? (539 |                     <BaseButton540 |                       onClick={captureScreenshot}541 |                       variant="primary"542 |                       size="md"543 |                       leftIcon={<Camera size={16} />}544 |                       className="w-full"545 |                       disabled={isCapturingScreenshot}546 |                     >547 |                       {isCapturingScreenshot ? 'Capturing...' : 'Capture Screenshot'}548 |                     </BaseButton>549 |                   ) : (550 |                     <div className="space-y-2">551 |                       <p className="text-sm text-gray-400">Screenshot captured successfully</p>552 |                       <BaseButton553 |                         onClick={captureScreenshot}554 |                         variant="primary"555 |                         size="sm"556 |                         leftIcon={<Camera size={14} />}557 |                         disabled={isCapturingScreenshot}558 |                       >559 |                         {isCapturingScreenshot ? 'Capturing...' : 'Retake Screenshot'}560 |                       </BaseButton>561 |                     </div>562 |                   )}563 |                 </div>564 |               </div>565 | 566 |               {}567 |               <div className="pt-4">568 |                 <BaseButton569 |                   onClick={() => {570 |                     submitBugReport();571 |                   }}572 |                   variant="primary"573 |                   size="md"574 |                   leftIcon={isSubmitting ? undefined : <Send size={16} />}575 |                   className="w-full"576 |                   disabled={isSubmitting}577 |                 >578 |                   {isSubmitting ? (579 |                     <>580 |                       <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>581 |                       Submitting...582 |                     </>583 |                   ) : (584 |                     'Submit Bug Report'585 |                   )}586 |                 </BaseButton>587 |               </div>588 |             </div>589 |           </div>590 | 591 |           {}592 |           <div className="flex-1 p-6 bg-gray-900 relative">593 |             {}594 |             {isCapturingScreenshot && (595 |               <div className="absolute inset-0 bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-10 rounded-lg">596 |                 <div className="text-center">597 |                   <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>598 |                   <p className="text-white text-lg font-medium">Capturing Screenshot...</p>599 |                   <p className="text-gray-400 text-sm mt-2">Select the screen/window you want to capture</p>600 |                 </div>601 |               </div>602 |             )}603 | 604 |             {screenshot ? (605 |               <div className="space-y-4">606 |                 {}607 |                 <div className="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">608 |                   <div className="flex items-center space-x-2">609 |                     <BaseButton610 |                       onClick={() => setCurrentTool('pen')}611 |                       variant={currentTool === 'pen' ? 'primary' : 'outline'}612 |                       size="sm"613 |                       leftIcon={<Pen size={16} />}614 |                     >615 |                       Draw616 |                     </BaseButton>617 |                   </div>618 | 619 |                   <div className="flex items-center space-x-2">620 |                     <Palette size={16} className="text-gray-400" />621 |                     <div className="flex space-x-1">622 |                       {colors.map((color) => (623 |                         <button624 |                           key={color}625 |                           onClick={() => setCurrentColor(color)}626 |                           className={`w-6 h-6 rounded border-2 ${627 |                             currentColor === color ? 'border-white' : 'border-gray-600'628 |                           }`}629 |                           style={{ backgroundColor: color }}630 |                         />631 |                       ))}632 |                     </div>633 |                   </div>634 | 635 |                   {currentTool === 'pen' && (636 |                     <div className="flex items-center space-x-2">637 |                       <span className="text-sm text-gray-400">Width:</span>638 |                       <input639 |                         type="range"640 |                         min="1"641 |                         max="10"642 |                         value={strokeWidth}643 |                         onChange={(e) => setStrokeWidth(Number(e.target.value))}644 |                         className="w-20"645 |                       />646 |                     </div>647 |                   )}648 | 649 |                   <BaseButton650 |                     onClick={clearAnnotations}651 |                     variant="secondary"652 |                     size="sm"653 |                     leftIcon={<RotateCcw size={16} />}654 |                     className="bg-white text-gray-900 hover:bg-gray-100"655 |                   >656 |                     Clear657 |                   </BaseButton>658 |                 </div>659 | 660 |                 {}661 |                 <div className="border border-gray-600 rounded-lg overflow-hidden bg-gray-900">662 |                   <div className="flex justify-center items-center p-4">663 |                     <canvas664 |                       ref={canvasRef}665 |                       onMouseDown={(e) => {666 |                         if (currentTool === 'pen') {667 |                           startDrawingAnnotation();668 |                           startDrawing(e);669 |                         }670 |                       }}671 |                       onMouseMove={draw}672 |                       onMouseUp={stopDrawing}673 |                       onMouseLeave={stopDrawing}674 |                       className="cursor-crosshair max-w-full h-auto border border-gray-600 rounded"675 |                       style={{676 |                         display: 'block',677 |                         maxHeight: '70vh',678 |                         objectFit: 'contain'679 |                       }}680 |                     />681 |                   </div>682 |                 </div>683 | 684 |                 <div className="text-sm text-gray-400">685 |                   <p>• Click and drag to draw on the screenshot</p>686 |                   <p>• Use the color palette to change annotation colors</p>687 |                 </div>688 |               </div>689 |             ) : (690 |               <div className="flex items-center justify-center h-full">691 |                 <div className="text-center">692 |                   <Camera size={64} className="mx-auto text-gray-500 mb-4" />693 |                   <p className="text-gray-400">Capture a screenshot to start annotating</p>694 |                 </div>695 |               </div>696 |             )}697 |           </div>698 |         </div>699 |       </FullScreenModal>700 | 701 |     </>702 |   );703 | }
============================================================END: frontend/components/BugReportSystem.tsx============================================================


============================================================FILE: frontend/components/BugReportTrigger.tsxSIZE: 0.81 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { Bug } from 'lucide-react';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BugReportSystem } from './BugReportSystem';  7 |   8 | interface BugReportTriggerProps {  9 |   variant?: 'primary' | 'outline' | 'ghost'; 10 |   size?: 'sm' | 'md' | 'lg'; 11 |   className?: string; 12 |   children?: React.ReactNode; 13 | } 14 |  15 | export function BugReportTrigger({ 16 |   variant = 'outline', 17 |   size = 'md', 18 |   className = '', 19 |   children 20 | }: BugReportTriggerProps) { 21 |   return ( 22 |     <BugReportSystem> 23 |       {({ openReport }) => ( 24 |         <BaseButton 25 |           onClick={openReport} 26 |           variant={variant} 27 |           size={size} 28 |           leftIcon={<Bug size={16} />} 29 |           className={className} 30 |         > 31 |           {children || 'Report Bug'} 32 |         </BaseButton> 33 |       )} 34 |     </BugReportSystem> 35 |   ); 36 | }
============================================================END: frontend/components/BugReportTrigger.tsx============================================================


============================================================FILE: frontend/components/CalendlyBookingFlow.tsxSIZE: 41.23 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import Image from 'next/image';  5 | import { motion, AnimatePresence } from 'framer-motion';  6 | import {  7 |   Calendar,  8 |   Clock,  9 |   User, 10 |   Mail, 11 |   Phone, 12 |   MapPin, 13 |   CreditCard, 14 |   CheckCircle, 15 |   Star, 16 |   Package, 17 |   ArrowRight, 18 |   ArrowLeft, 19 |   ChevronDown, 20 |   ChevronUp 21 | } from 'lucide-react'; 22 | import { Button } from './ui/button'; 23 | import { Input } from './ui/input'; 24 | import { Textarea } from './ui/textarea'; 25 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select'; 26 | import { PhoneVerificationModal } from './modals/PhoneVerificationModal'; 27 |  28 | interface Package { 29 |   id: number; 30 |   name: string; 31 |   description: string; 32 |   sessionsCount: number; 33 |   price: number; 34 |   currency: string; 35 |   duration: number; 36 |   isPopular?: boolean; 37 |   featured?: boolean; 38 | } 39 |  40 | interface ScheduleSlot { 41 |   id: number; 42 |   date: string; 43 |   time: string; 44 |   isAvailable: boolean; 45 |   capacity?: number; 46 |   bookedCount?: number; 47 | } 48 |  49 | interface PaymentMethod { 50 |   id: number; 51 |   name: string; 52 |   description?: string; 53 |   type?: string; 54 |   icon?: string; 55 |   isActive?: boolean; 56 |   requiresConfirmation?: boolean; 57 |   autoAssignPackage?: boolean; 58 | } 59 |  60 | interface BookingData { 61 |   packageId?: number; 62 |   clientName: string; 63 |   clientEmail: string; 64 |   clientPhone: string; 65 |   selectedDate: string; 66 |   selectedTime: string; 67 |   birthDate: string; 68 |   birthTime?: string; 69 |   birthCity: string; 70 |   birthPlace?: string; 71 |   message: string; 72 |   paymentMethodId?: number; 73 | } 74 |  75 | interface CalendlyBookingFlowProps { 76 |   t: Record<string, string | Record<string, string>>; 77 |   language: string; 78 | } 79 |  80 | const STEPS = [ 81 |   { id: 1, title: 'Package', icon: Package }, 82 |   { id: 2, title: 'Personal Info', icon: User }, 83 |   { id: 3, title: 'Date', icon: Calendar }, 84 |   { id: 4, title: 'Time', icon: Clock }, 85 |   { id: 5, title: 'Birth Info', icon: Star }, 86 |   { id: 6, title: 'Payment', icon: CreditCard }, 87 | ]; 88 |  89 | export function CalendlyBookingFlow({ t, language }: CalendlyBookingFlowProps) { 90 |   const [currentStep, setCurrentStep] = useState(1); 91 |   const [packages, setPackages] = useState<Package[]>([]); 92 |   const [scheduleSlots, setScheduleSlots] = useState<ScheduleSlot[]>([]); 93 |   const [paymentMethods, setPaymentMethods] = useState<PaymentMethod[]>([]); 94 |   const [isLoading, setIsLoading] = useState(true); 95 |   const [isSubmitting, setIsSubmitting] = useState(false); 96 |   const [submitStatus, setSubmitStatus] = useState<'idle' | 'success' | 'error'>('idle'); 97 |   const [viewMode, setViewMode] = useState<'week' | 'month'>('week'); 98 |   const [showAllPackages, setShowAllPackages] = useState(false); 99 |   const [isMobile, setIsMobile] = useState(false);100 |   const [apiError, setApiError] = useState<string | null>(null);101 |   const [isPhoneModalOpen, setIsPhoneModalOpen] = useState(false);102 | 103 |   const getTranslation = (path: string, fallback: string = ''): string => {104 |     const keys = path.split('.');105 |     let current: Record<string, string | Record<string, string>> | string = t;106 | 107 |     for (const key of keys) {108 |       if (current && typeof current === 'object' && key in current) {109 |         current = current[key];110 |       } else {111 |         return fallback;112 |       }113 |     }114 | 115 |     return typeof current === 'string' ? current : fallback;116 |   };117 | 118 |   const [bookingData, setBookingData] = useState<BookingData>({119 |     clientName: '',120 |     clientEmail: '',121 |     clientPhone: '',122 |     selectedDate: '',123 |     selectedTime: '',124 |     birthDate: '',125 |     birthCity: '',126 |     message: '',127 |     paymentMethodId: undefined128 |   });129 | 130 |   useEffect(() => {131 |     const checkMobile = () => {132 |       setIsMobile(window.innerWidth < 768);133 |     };134 | 135 |     checkMobile();136 |     window.addEventListener('resize', checkMobile);137 |     return () => window.removeEventListener('resize', checkMobile);138 |   }, []);139 | 140 |   useEffect(() => {141 |     const fetchData = async () => {142 |       try {143 |         setIsLoading(true);144 | 145 |         const packagesResponse = await fetch('/api/packages?active=true');146 |         if (packagesResponse.ok) {147 |           const packagesData = await packagesResponse.json();148 |           if (packagesData.success) {149 |             setPackages(packagesData.packages || []);150 |             setApiError(null);151 |           } else {152 |             setApiError(packagesData.message || 'Failed to load packages');153 |             }154 |         } else {155 |           const errorData = await packagesResponse.json().catch(() => ({}));156 |           setApiError(errorData.message || `HTTP ${packagesResponse.status}: Failed to load packages`);157 |           }158 | 159 |         const scheduleResponse = await fetch('/api/schedule-slots?available=true');160 |         if (scheduleResponse.ok) {161 |           const scheduleData = await scheduleResponse.json();162 |           if (scheduleData.success) {163 |             setScheduleSlots(scheduleData.slots || []);164 |           } else {165 |             }166 |         } else {167 |           }168 | 169 |         const paymentMethodsResponse = await fetch('/api/payment-methods');170 |         if (paymentMethodsResponse.ok) {171 |           const paymentMethodsData = await paymentMethodsResponse.json();172 |           if (paymentMethodsData.success) {173 |             setPaymentMethods(paymentMethodsData.data || []);174 |           } else {175 |             }176 |         } else {177 |           }178 |       } catch (error) {179 |         setApiError('Network error: Unable to connect to the server');180 |       } finally {181 |         setIsLoading(false);182 |       }183 |     };184 | 185 |     fetchData();186 |   }, []);187 | 188 |   const updateBookingData = (field: keyof BookingData, value: string | number) => {189 |     setBookingData(prev => ({ ...prev, [field]: value }));190 |   };191 | 192 |   const nextStep = () => {193 |     if (currentStep < STEPS.length) {194 |       setCurrentStep(prev => prev + 1);195 |     }196 |   };197 | 198 |   const prevStep = () => {199 |     if (currentStep > 1) {200 | 201 |       if (currentStep === 4) {202 |         updateBookingData('selectedTime', '');203 |       }204 |       setCurrentStep(prev => prev - 1);205 |     }206 |   };207 | 208 |   const canProceed = () => {209 |     switch (currentStep) {210 |       case 1: return bookingData.packageId;211 |       case 2: return bookingData.clientName && bookingData.clientEmail && bookingData.clientPhone;212 |       case 3: return bookingData.selectedDate;213 |       case 4: return bookingData.selectedTime;214 |       case 5: return bookingData.birthDate && bookingData.birthCity;215 |       case 6: return bookingData.paymentMethodId;216 |       default: return false;217 |     }218 |   };219 | 220 |   const handlePhoneVerificationSuccess = (userData: { fullName?: string; email?: string; phone?: string; birthDate?: string; birthTime?: string; birthPlace?: string }, isExistingCustomer: boolean) => {221 | 222 |     setBookingData(prev => ({223 |       ...prev,224 |       clientName: userData.fullName || prev.clientName,225 |       clientEmail: userData.email || prev.clientEmail,226 |       clientPhone: userData.phone || prev.clientPhone,227 |       birthDate: userData.birthDate || prev.birthDate,228 |       birthTime: userData.birthTime || prev.birthTime,229 |       birthPlace: userData.birthPlace || prev.birthPlace,230 |     }));231 | 232 |     if (isExistingCustomer && userData.fullName && userData.email) {233 |       setCurrentStep(3);234 |     }235 |   };236 | 237 |   const handleSubmit = async () => {238 |     setIsSubmitting(true);239 |     try {240 |       const response = await fetch('/api/calendly-booking', {241 |         method: 'POST',242 |         headers: { 'Content-Type': 'application/json' },243 |         body: JSON.stringify({244 |           ...bookingData,245 |           language246 |         })247 |       });248 | 249 |       if (response.ok) {250 |         setSubmitStatus('success');251 |       } else {252 |         setSubmitStatus('error');253 |       }254 |     } catch (error) {255 |       setSubmitStatus('error');256 |     } finally {257 |       setIsSubmitting(false);258 |     }259 |   };260 | 261 |   const availableDates = [...new Set(scheduleSlots262 |     .filter(slot => slot.isAvailable)263 |     .map(slot => slot.date)264 |     .sort()265 |   )];266 | 267 |   const availableTimes = scheduleSlots268 |     .filter(slot => slot.date === bookingData.selectedDate && slot.isAvailable)269 |     .map(slot => slot.time)270 |     .sort();271 | 272 |   const formatDate = (dateString: string) => {273 |     const date = new Date(dateString);274 |     return date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {275 |       weekday: 'short',276 |       month: 'short',277 |       day: 'numeric'278 |     });279 |   };280 | 281 |   const getCalendarDates = () => {282 |     const today = new Date();283 |     const dates = [];284 | 285 |     if (viewMode === 'week') {286 | 287 |       for (let i = 0; i < 7; i++) {288 |         const date = new Date(today);289 |         date.setDate(today.getDate() + i);290 |         dates.push(date);291 |       }292 |     } else {293 | 294 |       for (let i = 0; i < 30; i++) {295 |         const date = new Date(today);296 |         date.setDate(today.getDate() + i);297 |         dates.push(date);298 |       }299 |     }300 | 301 |     return dates;302 |   };303 | 304 |   if (isLoading) {305 |     return (306 |       <div className="h-full flex items-center justify-center p-4 pt-20 sm:pt-24 lg:pt-28">307 |         <div className="text-center">308 |           <motion.div309 |             animate={{ rotate: 360 }}310 |             transition={{ duration: 2, repeat: Infinity, ease: "linear" }}311 |             className="w-12 h-12 border-4 border-[#FFD700] border-t-transparent rounded-full mx-auto mb-4"312 |           />313 |           <p className="text-[#EAEAEA] text-sm">Loading packages...</p>314 |         </div>315 |       </div>316 |     );317 |   }318 | 319 |   if (apiError) {320 |     return (321 |       <div className="h-full flex items-center justify-center p-4 pt-20 sm:pt-24 lg:pt-28">322 |         <div className="text-center max-w-md mx-auto">323 |           <div className="bg-red-500/10 border border-red-500/20 rounded-lg p-6 mb-6">324 |             <h2 className="text-xl font-heading text-red-400 mb-4">325 |               Unable to Load Packages326 |             </h2>327 |             <p className="text-[#EAEAEA]/80 mb-4">328 |               {apiError}329 |             </p>330 |             <p className="text-[#C0C0C0]/70 text-sm">331 |               This might be a temporary issue. Please try refreshing the page or contact support if the problem persists.332 |             </p>333 |           </div>334 |           <Button335 |             onClick={() => window.location.reload()}336 |             className="bg-[#FFD700] text-[#0A0A23] hover:bg-[#FFD700]/90"337 |           >338 |             Refresh Page339 |           </Button>340 |         </div>341 |       </div>342 |     );343 |   }344 | 345 |   if (submitStatus === 'success') {346 |     return (347 |       <div className="h-full flex items-center justify-center p-4 pt-20 sm:pt-24 lg:pt-28">348 |         <motion.div349 |           initial={{ opacity: 0, scale: 0.9 }}350 |           animate={{ opacity: 1, scale: 1 }}351 |           className="text-center max-w-sm mx-auto"352 |         >353 |           <CheckCircle className="w-16 h-16 text-[#FFD700] mx-auto mb-6" />354 |           <h2 className="text-2xl font-heading text-[#EAEAEA] mb-4">355 |             {getTranslation('booking.successTitle', 'Booking Confirmed!')}356 |           </h2>357 |           <p className="text-[#EAEAEA]/80 mb-6">358 |             {getTranslation('booking.successMessage', 'You will receive a confirmation email shortly.')}359 |           </p>360 |           <Button361 |             onClick={() => {362 |               setSubmitStatus('idle');363 |               setCurrentStep(1);364 |               setBookingData({365 |                 clientName: '',366 |                 clientEmail: '',367 |                 clientPhone: '',368 |                 selectedDate: '',369 |                 selectedTime: '',370 |                 birthDate: '',371 |                 birthCity: '',372 |                 message: '',373 |                 paymentMethodId: undefined374 |               });375 |             }}376 |             className="w-full bg-[#FFD700] text-[#0A0A23] hover:bg-[#FFD700]/90"377 |           >378 |             {getTranslation('booking.bookAnother', 'Book Another Session')}379 |           </Button>380 |         </motion.div>381 |       </div>382 |     );383 |   }384 | 385 |   return (386 |     <div className="h-full p-2 sm:p-4 lg:p-8 xl:p-12 pt-20 sm:pt-24 lg:pt-28">387 |       <div className={`mx-auto ${isMobile ? 'max-w-sm' : 'max-w-4xl lg:max-w-6xl xl:max-w-7xl'}`}>388 |         {}389 |         <div className="text-center mb-4 sm:mb-6 pt-2 sm:pt-4">390 |           <h1 className="text-xl sm:text-2xl lg:text-4xl xl:text-5xl font-heading text-[#EAEAEA] mb-2">391 |             {getTranslation('booking.title', 'Book Your Session')}392 |           </h1>393 |           <p className="text-[#EAEAEA]/80 text-xs sm:text-sm lg:text-lg xl:text-xl px-4">394 |             {getTranslation('booking.subtitle', 'Choose your cosmic journey')}395 |           </p>396 |         </div>397 | 398 |         {}399 |         <div className={`flex justify-between mb-6 sm:mb-8 ${isMobile ? 'px-2' : ''}`}>400 |           {STEPS.map((step) => {401 |             const Icon = step.icon;402 |             const isActive = currentStep === step.id;403 |             const isCompleted = currentStep > step.id;404 | 405 |             return (406 |               <div key={step.id} className="flex flex-col items-center flex-1">407 |                 <div className={`408 |                   ${isMobile ? 'w-8 h-8' : 'w-10 h-10 lg:w-12 lg:h-12'} rounded-full flex items-center justify-center mb-1 sm:mb-2 transition-all duration-300409 |                   ${isActive ? 'bg-[#FFD700] text-[#0A0A23]' :410 |                     isCompleted ? 'bg-[#FFD700]/20 text-[#FFD700]' :411 |                     'bg-[#C0C0C0]/20 text-[#C0C0C0]/50'}412 |                 `}>413 |                   {isCompleted ? (414 |                     <CheckCircle className={`${isMobile ? 'w-4 h-4' : 'w-5 h-5 lg:w-6 lg:h-6'}`} />415 |                   ) : (416 |                     <Icon className={`${isMobile ? 'w-4 h-4' : 'w-5 h-5 lg:w-6 lg:h-6'}`} />417 |                   )}418 |                 </div>419 |                 <span className={`${isMobile ? 'text-xs' : 'text-xs sm:text-sm'} ${isActive ? 'text-[#FFD700]' : 'text-[#C0C0C0]/50'} text-center leading-tight`}>420 |                   {isMobile ? step.title.split(' ')[0] : step.title}421 |                 </span>422 |               </div>423 |             );424 |           })}425 |         </div>426 | 427 |         {}428 |         <div className={`bg-gradient-to-br from-[#191970]/10 to-[#0A0A23]/10 rounded-xl sm:rounded-2xl border border-[#C0C0C0]/20 backdrop-blur-sm mb-4 sm:mb-6 ${isMobile ? 'p-4' : 'p-6 sm:p-8 lg:p-12 xl:p-16'}`}>429 |           <AnimatePresence mode="wait">430 |             <motion.div431 |               key={currentStep}432 |               initial={{ opacity: 0, x: 20 }}433 |               animate={{ opacity: 1, x: 0 }}434 |               exit={{ opacity: 0, x: -20 }}435 |               transition={{ duration: 0.3 }}436 |             >437 |               {}438 |               {currentStep === 1 && (439 |                 <div className="space-y-3 sm:space-y-4">440 |                   <h3 className={`font-heading text-[#EAEAEA] mb-3 sm:mb-4 ${isMobile ? 'text-base' : 'text-lg lg:text-2xl xl:text-3xl'}`}>441 |                     {getTranslation('booking.selectPackage', 'Select a Package')}442 |                   </h3>443 | 444 |                   {}445 |                   <div className="text-center mb-4">446 |                     <button447 |                       onClick={() => setIsPhoneModalOpen(true)}448 |                       className="text-blue-400 hover:text-blue-300 text-sm font-medium underline transition-colors"449 |                     >450 |                       Already a customer? Verify your phone number451 |                     </button>452 |                   </div>453 | 454 |                   {}455 |                   {packages.length === 0 ? (456 |                     <div className="text-center py-8">457 |                       <p className="text-[#C0C0C0]/70 mb-4">No packages available at the moment.</p>458 |                       <Button459 |                         onClick={() => window.location.reload()}460 |                         variant="outline"461 |                         className="border-[#C0C0C0]/20 text-[#EAEAEA] hover:bg-[#191970]/10"462 |                       >463 |                         Refresh464 |                       </Button>465 |                     </div>466 |                   ) : (467 |                     <div className={`grid gap-3 sm:gap-4 ${isMobile ? 'grid-cols-1' : 'grid-cols-1 lg:grid-cols-2 xl:grid-cols-3'}`}>468 |                       {(showAllPackages ? packages : packages.slice(0, 3)).map((pkg) => (469 |                       <motion.div470 |                         key={pkg.id}471 |                         whileHover={{ scale: 1.02 }}472 |                         whileTap={{ scale: 0.98 }}473 |                         className={`474 |                           p-3 sm:p-4 rounded-lg border-2 cursor-pointer transition-all duration-300475 |                           ${bookingData.packageId === pkg.id476 |                             ? 'border-[#FFD700] bg-[#FFD700]/10'477 |                             : 'border-[#C0C0C0]/20 hover:border-[#FFD700]/50'478 |                           }479 |                         `}480 |                         onClick={() => updateBookingData('packageId', pkg.id)}481 |                       >482 |                         <div className="flex justify-between items-start mb-2">483 |                           <div className="flex items-center gap-2 flex-1 min-w-0">484 |                             <h4 className={`font-medium text-[#EAEAEA] truncate ${isMobile ? 'text-sm' : 'text-base'}`}>485 |                               {pkg.name}486 |                             </h4>487 |                             {pkg.isPopular && (488 |                               <span className="bg-[#FFD700] text-[#0A0A23] text-xs px-2 py-1 rounded-full whitespace-nowrap">489 |                                 Popular490 |                               </span>491 |                             )}492 |                           </div>493 |                           <div className="text-right ml-2">494 |                             <div className={`font-bold text-[#FFD700] ${isMobile ? 'text-base' : 'text-lg'}`}>495 |                               {pkg.currency} {pkg.price}496 |                             </div>497 |                             <div className="text-xs text-[#C0C0C0]/70">498 |                               {pkg.sessionsCount} session{pkg.sessionsCount > 1 ? 's' : ''}499 |                             </div>500 |                           </div>501 |                         </div>502 |                         <p className={`text-[#EAEAEA]/80 ${isMobile ? 'text-xs' : 'text-sm'}`}>503 |                           {pkg.description}504 |                         </p>505 |                         <div className="text-xs text-[#C0C0C0]/70 mt-2">506 |                           Duration: {pkg.duration} minutes507 |                         </div>508 |                       </motion.div>509 |                       ))}510 |                     </div>511 |                   )}512 | 513 |                   {}514 |                   {packages.length > 3 && (515 |                     <motion.div516 |                       initial={{ opacity: 0, y: 10 }}517 |                       animate={{ opacity: 1, y: 0 }}518 |                       className="text-center pt-2 sm:pt-4"519 |                     >520 |                       <button521 |                         onClick={() => setShowAllPackages(!showAllPackages)}522 |                         className="text-[#FFD700] hover:text-[#FFD700]/80 text-sm font-medium transition-colors duration-300 flex items-center justify-center gap-2 mx-auto"523 |                       >524 |                         {showAllPackages ? (525 |                           <>526 |                             <ChevronUp className="w-4 h-4" />527 |                             {getTranslation('booking.showLess', 'Show Less')}528 |                           </>529 |                         ) : (530 |                           <>531 |                             {getTranslation('booking.showMore', `Show More (${packages.length - 3} more)`)}532 |                             <ChevronDown className="w-4 h-4" />533 |                           </>534 |                         )}535 |                       </button>536 |                     </motion.div>537 |                   )}538 |                 </div>539 |               )}540 | 541 |               {}542 |               {currentStep === 2 && (543 |                 <div className="space-y-3 sm:space-y-4">544 |                   <h3 className={`font-heading text-[#EAEAEA] mb-3 sm:mb-4 ${isMobile ? 'text-base' : 'text-lg lg:text-2xl xl:text-3xl'}`}>545 |                     {getTranslation('booking.personalInfo', 'Personal Information')}546 |                   </h3>547 | 548 |                   <div className={`grid gap-3 sm:gap-4 ${isMobile ? 'grid-cols-1' : 'grid-cols-1 lg:grid-cols-2 xl:grid-cols-3'}`}>549 |                     <div>550 |                       <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">551 |                         <User className="inline w-4 h-4 mr-2" />552 |                         {getTranslation('booking.name', 'Full Name')} *553 |                       </label>554 |                       <Input555 |                         type="text"556 |                         value={bookingData.clientName}557 |                         onChange={(e) => updateBookingData('clientName', e.target.value)}558 |                         className="bg-[#191970]/10 border-[#C0C0C0]/20 text-[#EAEAEA] placeholder-[#C0C0C0]/60 h-10 sm:h-11"559 |                         placeholder={getTranslation('booking.namePlaceholder', 'Enter your full name')}560 |                       />561 |                     </div>562 | 563 |                     <div>564 |                       <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">565 |                         <Mail className="inline w-4 h-4 mr-2" />566 |                         {getTranslation('booking.email', 'Email')} *567 |                       </label>568 |                       <Input569 |                         type="email"570 |                         value={bookingData.clientEmail}571 |                         onChange={(e) => updateBookingData('clientEmail', e.target.value)}572 |                         className="bg-[#191970]/10 border-[#C0C0C0]/20 text-[#EAEAEA] placeholder-[#C0C0C0]/60 h-10 sm:h-11"573 |                         placeholder={getTranslation('booking.emailPlaceholder', 'Enter your email')}574 |                       />575 |                     </div>576 | 577 |                     <div className={isMobile ? '' : 'lg:col-span-2'}>578 |                       <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">579 |                         <Phone className="inline w-4 h-4 mr-2" />580 |                         {getTranslation('booking.phone', 'Phone Number')} *581 |                       </label>582 |                       <Input583 |                         type="tel"584 |                         value={bookingData.clientPhone}585 |                         onChange={(e) => updateBookingData('clientPhone', e.target.value)}586 |                         className="bg-[#191970]/10 border-[#C0C0C0]/20 text-[#EAEAEA] placeholder-[#C0C0C0]/60 h-10 sm:h-11"587 |                         placeholder={getTranslation('booking.phonePlaceholder', 'Enter your phone number')}588 |                       />589 |                     </div>590 |                   </div>591 |                 </div>592 |               )}593 | 594 |               {}595 |               {currentStep === 3 && (596 |                 <div className="space-y-3 sm:space-y-4">597 |                   <div className="flex justify-between items-center mb-3 sm:mb-4">598 |                     <h3 className={`font-heading text-[#EAEAEA] ${isMobile ? 'text-base' : 'text-lg lg:text-xl'}`}>599 |                       {getTranslation('booking.selectDate', 'Select Date')}600 |                     </h3>601 |                     <div className="flex bg-[#191970]/10 rounded-lg p-1">602 |                       <button603 |                         onClick={() => setViewMode('week')}604 |                         className={`px-2 sm:px-3 py-1 text-xs rounded transition-colors ${605 |                           viewMode === 'week'606 |                             ? 'bg-[#FFD700] text-[#0A0A23]'607 |                             : 'text-[#C0C0C0]/70 hover:text-[#EAEAEA]'608 |                         }`}609 |                       >610 |                         Week611 |                       </button>612 |                       <button613 |                         onClick={() => setViewMode('month')}614 |                         className={`px-2 sm:px-3 py-1 text-xs rounded transition-colors ${615 |                           viewMode === 'month'616 |                             ? 'bg-[#FFD700] text-[#0A0A23]'617 |                             : 'text-[#C0C0C0]/70 hover:text-[#EAEAEA]'618 |                         }`}619 |                       >620 |                         Month621 |                       </button>622 |                     </div>623 |                   </div>624 | 625 |                   {}626 |                   <div className={`grid gap-1 sm:gap-2 mb-3 sm:mb-4 ${isMobile ? 'grid-cols-7' : 'grid-cols-7 lg:grid-cols-10 xl:grid-cols-14'}`}>627 |                     {getCalendarDates().map((date, index) => {628 |                       const dateString = date.toISOString().split('T')[0];629 |                       const isAvailable = availableDates.includes(dateString);630 |                       const isSelected = bookingData.selectedDate === dateString;631 | 632 |                       return (633 |                         <motion.button634 |                           key={index}635 |                           whileHover={isAvailable ? { scale: 1.05 } : {}}636 |                           whileTap={isAvailable ? { scale: 0.95 } : {}}637 |                           onClick={() => isAvailable && updateBookingData('selectedDate', dateString)}638 |                           disabled={!isAvailable}639 |                           className={`640 |                             ${isMobile ? 'aspect-square text-xs' : 'aspect-square text-xs sm:text-sm'} rounded-lg font-medium transition-all duration-300641 |                             ${isSelected642 |                               ? 'bg-[#FFD700] text-[#0A0A23]'643 |                               : isAvailable644 |                                 ? 'bg-[#191970]/10 text-[#EAEAEA] hover:bg-[#FFD700]/20'645 |                                 : 'bg-[#C0C0C0]/5 text-[#C0C0C0]/30 cursor-not-allowed'646 |                             }647 |                           `}648 |                         >649 |                           {date.getDate()}650 |                         </motion.button>651 |                       );652 |                     })}653 |                   </div>654 | 655 |                 </div>656 |               )}657 | 658 |               {}659 |               {currentStep === 4 && (660 |                 <div className="space-y-3 sm:space-y-4">661 |                   <h3 className={`font-heading text-[#EAEAEA] mb-3 sm:mb-4 ${isMobile ? 'text-base' : 'text-lg lg:text-2xl xl:text-3xl'}`}>662 |                     {getTranslation('booking.selectTime', 'Select Time')}663 |                   </h3>664 | 665 |                   {}666 |                   {bookingData.selectedDate && (667 |                     <div className="bg-[#191970]/10 rounded-lg p-3 sm:p-4 mb-4">668 |                       <p className="text-[#EAEAEA] text-sm sm:text-base">669 |                         <Calendar className="inline w-4 h-4 mr-2" />670 |                         Selected Date: <span className="text-[#FFD700] font-medium">{formatDate(bookingData.selectedDate)}</span>671 |                       </p>672 |                     </div>673 |                   )}674 | 675 |                   {}676 |                   {bookingData.selectedDate && (677 |                     <div>678 |                       <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">679 |                         <Clock className="inline w-4 h-4 mr-2" />680 |                         {getTranslation('booking.selectTime', 'Select Time')}681 |                       </label>682 |                       <div className={`grid gap-2 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6'}`}>683 |                         {availableTimes.map((time) => (684 |                           <motion.button685 |                             key={time}686 |                             whileHover={{ scale: 1.02 }}687 |                             whileTap={{ scale: 0.98 }}688 |                             onClick={() => updateBookingData('selectedTime', time)}689 |                             className={`690 |                               p-2 sm:p-3 rounded-lg text-sm font-medium transition-all duration-300691 |                               ${bookingData.selectedTime === time692 |                                 ? 'bg-[#FFD700] text-[#0A0A23]'693 |                                 : 'bg-[#191970]/10 text-[#EAEAEA] hover:bg-[#FFD700]/20'694 |                               }695 |                             `}696 |                           >697 |                             {time}698 |                           </motion.button>699 |                         ))}700 |                       </div>701 |                     </div>702 |                   )}703 | 704 |                   {!bookingData.selectedDate && (705 |                     <div className="text-center py-8">706 |                       <p className="text-[#C0C0C0]/70 mb-4">Please select a date first to see available times.</p>707 |                     </div>708 |                   )}709 |                 </div>710 |               )}711 | 712 |               {}713 |               {currentStep === 5 && (714 |                 <div className="space-y-3 sm:space-y-4">715 |                   <h3 className={`font-heading text-[#EAEAEA] mb-3 sm:mb-4 ${isMobile ? 'text-base' : 'text-lg lg:text-2xl xl:text-3xl'}`}>716 |                     {getTranslation('booking.birthInfo', 'Birth Information')}717 |                   </h3>718 | 719 |                   <div className={`grid gap-3 sm:gap-4 ${isMobile ? 'grid-cols-1' : 'grid-cols-1 lg:grid-cols-2 xl:grid-cols-3'}`}>720 |                     <div>721 |                       <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">722 |                         <Calendar className="inline w-4 h-4 mr-2" />723 |                         {getTranslation('booking.birthDate', 'Birth Date')} *724 |                       </label>725 |                       <Input726 |                         type="date"727 |                         value={bookingData.birthDate}728 |                         onChange={(e) => updateBookingData('birthDate', e.target.value)}729 |                         className="bg-[#191970]/10 border-[#C0C0C0]/20 text-[#EAEAEA] h-10 sm:h-11"730 |                       />731 |                     </div>732 | 733 |                     <div>734 |                       <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">735 |                         <MapPin className="inline w-4 h-4 mr-2" />736 |                         {getTranslation('booking.birthCity', 'Birth City')} *737 |                       </label>738 |                       <Input739 |                         type="text"740 |                         value={bookingData.birthCity}741 |                         onChange={(e) => updateBookingData('birthCity', e.target.value)}742 |                         className="bg-[#191970]/10 border-[#C0C0C0]/20 text-[#EAEAEA] placeholder-[#C0C0C0]/60 h-10 sm:h-11"743 |                         placeholder={getTranslation('booking.birthCityPlaceholder', 'Enter your birth city')}744 |                       />745 |                     </div>746 | 747 |                     <div className={isMobile ? '' : 'lg:col-span-2'}>748 |                       <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">749 |                         {getTranslation('booking.message', 'Message (Optional)')}750 |                       </label>751 |                       <Textarea752 |                         value={bookingData.message}753 |                         onChange={(e) => updateBookingData('message', e.target.value)}754 |                         rows={3}755 |                         className="bg-[#191970]/10 border-[#C0C0C0]/20 text-[#EAEAEA] placeholder-[#C0C0C0]/60 resize-none"756 |                         placeholder={getTranslation('booking.messagePlaceholder', 'Tell us about your intentions for this session...')}757 |                       />758 |                     </div>759 |                   </div>760 |                 </div>761 |               )}762 | 763 |               {}764 |               {currentStep === 6 && (765 |                 <div className="space-y-3 sm:space-y-4">766 |                   <h3 className={`font-heading text-[#EAEAEA] mb-3 sm:mb-4 ${isMobile ? 'text-base' : 'text-lg lg:text-2xl xl:text-3xl'}`}>767 |                     {getTranslation('booking.payment', 'Payment')}768 |                   </h3>769 | 770 |                   {}771 |                   <div className="bg-[#191970]/10 rounded-lg p-3 sm:p-4 mb-3 sm:mb-4">772 |                     <h4 className="font-medium text-[#EAEAEA] mb-3 text-sm sm:text-base">Booking Summary</h4>773 |                     <div className="space-y-2 text-sm">774 |                       <div className="flex justify-between">775 |                         <span className="text-[#C0C0C0]/70">Package:</span>776 |                         <span className="text-[#EAEAEA]">777 |                           {packages.find(p => p.id === bookingData.packageId)?.name}778 |                         </span>779 |                       </div>780 |                       <div className="flex justify-between">781 |                         <span className="text-[#C0C0C0]/70">Date:</span>782 |                         <span className="text-[#EAEAEA]">783 |                           {bookingData.selectedDate && formatDate(bookingData.selectedDate)}784 |                         </span>785 |                       </div>786 |                       <div className="flex justify-between">787 |                         <span className="text-[#C0C0C0]/70">Time:</span>788 |                         <span className="text-[#EAEAEA]">{bookingData.selectedTime}</span>789 |                       </div>790 |                       <div className="flex justify-between border-t border-[#C0C0C0]/20 pt-2">791 |                         <span className="text-[#EAEAEA] font-medium">Total:</span>792 |                         <span className="text-[#FFD700] font-bold">793 |                           {packages.find(p => p.id === bookingData.packageId)?.currency} {packages.find(p => p.id === bookingData.packageId)?.price}794 |                         </span>795 |                       </div>796 |                     </div>797 |                   </div>798 | 799 |                   {}800 |                   <div>801 |                     <label className="block text-[#EAEAEA] font-medium mb-2 text-sm sm:text-base">802 |                       <CreditCard className="inline w-4 h-4 mr-2" />803 |                       {getTranslation('booking.paymentMethod', 'Payment Method')} *804 |                     </label>805 |                     <Select806 |                       value={bookingData.paymentMethodId?.toString()}807 |                       onValueChange={(value) => updateBookingData('paymentMethodId', parseInt(value))}808 |                     >809 |                       <SelectTrigger className="bg-[#191970]/10 border-[#C0C0C0]/20 text-[#EAEAEA] h-10 sm:h-11">810 |                         <SelectValue placeholder={getTranslation('booking.selectPaymentMethod', 'Select payment method')}>811 |                           {bookingData.paymentMethodId && (() => {812 |                             const selectedMethod = paymentMethods.find(m => m.id === bookingData.paymentMethodId);813 |                             return selectedMethod ? (814 |                               <div className="flex items-center space-x-2">815 |                                 <div className="flex-shrink-0 w-5 h-5 flex items-center justify-center">816 |                                   {selectedMethod.icon ? (817 |                                     <Image818 |                                       src={selectedMethod.icon}819 |                                       alt={selectedMethod.name}820 |                                       width={20}821 |                                       height={20}822 |                                       className="w-5 h-5 object-contain"823 |                                     />824 |                                   ) : (825 |                                     <CreditCard className="w-4 h-4 text-gray-400" />826 |                                   )}827 |                                 </div>828 |                                 <span>{selectedMethod.name}</span>829 |                               </div>830 |                             ) : null;831 |                           })()}832 |                         </SelectValue>833 |                       </SelectTrigger>834 |                       <SelectContent className="dashboard-dropdown-content">835 |                         {paymentMethods.length === 0 ? (836 |                           <SelectItem value="no-methods" disabled className="dashboard-dropdown-item">837 |                             No payment methods available838 |                           </SelectItem>839 |                         ) : (840 |                           paymentMethods.map((method) => (841 |                             <SelectItem key={method.id} value={method.id.toString()} className="dashboard-dropdown-item">842 |                               <div className="flex items-center space-x-3">843 |                                 {}844 |                                 <div className="flex-shrink-0 w-6 h-6 flex items-center justify-center">845 |                                   {method.icon ? (846 |                                     <Image847 |                                       src={method.icon}848 |                                       alt={method.name}849 |                                       width={24}850 |                                       height={24}851 |                                       className="w-6 h-6 object-contain"852 |                                       onError={(e) => {853 | 854 |                                         e.currentTarget.style.display = 'none';855 |                                         e.currentTarget.nextElementSibling?.classList.remove('hidden');856 |                                       }}857 |                                     />858 |                                   ) : null}859 |                                   {}860 |                                   <CreditCard className={`w-5 h-5 text-gray-400 ${method.icon ? 'hidden' : ''}`} />861 |                                 </div>862 |                                 <div className="flex-1">863 |                                   <span className="text-sm font-medium">{method.name}</span>864 |                                   {method.description && (865 |                                     <p className="text-xs text-gray-500 mt-0.5">{method.description}</p>866 |                                   )}867 |                                 </div>868 |                               </div>869 |                             </SelectItem>870 |                           ))871 |                         )}872 |                       </SelectContent>873 |                     </Select>874 |                   </div>875 | 876 |                   {submitStatus === 'error' && (877 |                     <motion.div878 |                       initial={{ opacity: 0, y: 10 }}879 |                       animate={{ opacity: 1, y: 0 }}880 |                       className="bg-red-500/10 border border-red-500/20 rounded-lg p-3 sm:p-4 text-center"881 |                     >882 |                       <p className="text-red-400 font-medium text-sm">883 |                         {getTranslation('booking.errorMessage', 'There was an error with your booking. Please try again.')}884 |                       </p>885 |                     </motion.div>886 |                   )}887 |                 </div>888 |               )}889 |             </motion.div>890 |           </AnimatePresence>891 |         </div>892 | 893 |         {}894 |         <div className={`flex gap-2 sm:gap-3 ${isMobile ? 'flex-col' : 'flex-row'}`}>895 |           {currentStep > 1 && (896 |             <Button897 |               onClick={prevStep}898 |               variant="outline"899 |               className={`border-[#C0C0C0]/20 text-[#EAEAEA] hover:bg-[#191970]/10 h-10 sm:h-11 ${isMobile ? 'w-full' : 'flex-1'}`}900 |             >901 |               <ArrowLeft className="w-4 h-4 mr-2" />902 |               {getTranslation('booking.back', 'Back')}903 |             </Button>904 |           )}905 | 906 |           {currentStep < STEPS.length ? (907 |             <Button908 |               onClick={nextStep}909 |               disabled={!canProceed()}910 |               className={`bg-[#FFD700] text-[#0A0A23] hover:bg-[#FFD700]/90 disabled:opacity-50 disabled:cursor-not-allowed h-10 sm:h-11 ${isMobile ? 'w-full' : 'flex-1'}`}911 |             >912 |               {getTranslation('booking.next', 'Next')}913 |               <ArrowRight className="w-4 h-4 ml-2" />914 |             </Button>915 |           ) : (916 |             <Button917 |               onClick={handleSubmit}918 |               disabled={!canProceed() || isSubmitting}919 |               className={`bg-[#FFD700] text-[#0A0A23] hover:bg-[#FFD700]/90 disabled:opacity-50 disabled:cursor-not-allowed h-10 sm:h-11 ${isMobile ? 'w-full' : 'flex-1'}`}920 |             >921 |               {isSubmitting ? (922 |                 <motion.div923 |                   animate={{ rotate: 360 }}924 |                   transition={{ duration: 1, repeat: Infinity, ease: "linear" }}925 |                   className="w-4 h-4 border-2 border-[#0A0A23] border-t-transparent rounded-full"926 |                 />927 |               ) : (928 |                 <>929 |                   {getTranslation('booking.confirmBooking', 'Confirm Booking')}930 |                   <CheckCircle className="w-4 h-4 ml-2" />931 |                 </>932 |               )}933 |             </Button>934 |           )}935 |         </div>936 |       </div>937 | 938 |       {}939 |       <PhoneVerificationModal940 |         isOpen={isPhoneModalOpen}941 |         onClose={() => setIsPhoneModalOpen(false)}942 |         onVerificationSuccess={handlePhoneVerificationSuccess}943 |       />944 |     </div>945 |   );946 | }
============================================================END: frontend/components/CalendlyBookingFlow.tsx============================================================


============================================================FILE: frontend/components/ChatWindow.tsxSIZE: 15.81 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useRef, useEffect } from 'react';  4 | import { motion, AnimatePresence } from 'framer-motion';  5 | import { MessageCircle, X, Send, Bot, User, Minimize2, Maximize2 } from 'lucide-react';  6 | import { useLanguage } from '@/hooks/useTranslations';  7 | import { ChatConfig } from '@/lib/config/chat-config';  8 | import { PackageDisplay, parsePackagesFromText, Package } from './PackageDisplay';  9 |  10 | interface Message { 11 |   id: string; 12 |   content: string; 13 |   sender: 'user' | 'assistant'; 14 |   timestamp: Date; 15 |   isTyping?: boolean; 16 |   packages?: Package[]; 17 | } 18 |  19 | interface ChatWindowProps { 20 |   isOpen?: boolean; 21 |   onToggle?: () => void; 22 |   className?: string; 23 |   config?: Partial<ChatConfig>; 24 | } 25 |  26 | export function ChatWindow({ isOpen = false, onToggle, className = '' }: ChatWindowProps) { 27 |   const { language } = useLanguage(); 28 |   const [isChatOpen, setIsChatOpen] = useState(isOpen); 29 |   const [isMinimized, setIsMinimized] = useState(false); 30 |   const [messages, setMessages] = useState<Message[]>([]); 31 |   const [inputValue, setInputValue] = useState(''); 32 |   const [isTyping, setIsTyping] = useState(false); 33 |   const messagesEndRef = useRef<HTMLDivElement>(null); 34 |   const inputRef = useRef<HTMLInputElement>(null); 35 |  36 |   useEffect(() => { 37 |     messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); 38 |   }, [messages]); 39 |  40 |   useEffect(() => { 41 |     if (isChatOpen && !isMinimized && inputRef.current) { 42 |       setTimeout(() => inputRef.current?.focus(), 100); 43 |     } 44 |   }, [isChatOpen, isMinimized]); 45 |  46 |   useEffect(() => { 47 |     if (isChatOpen && messages.length === 0) { 48 |       const welcomeMessage: Message = { 49 |         id: 'welcome', 50 |         content: language === 'es' 51 |           ? '🌟 ¡Hola! Soy tu asistente de MatMax Yoga Studio. ¿En qué puedo ayudarte hoy?\n\n✨ **Clases para todos los niveles**\n🧘 **Fortaleza y flexibilidad**\n🫶 **Bienestar y equilibrio**\n📅 **Horarios y reservas**' 52 |           : '🌟 Hello! I\'m your MatMax Yoga Studio assistant. How can I help you today?\n\n✨ **Classes for all levels**\n🧘 **Strength and flexibility**\n🫶 **Wellbeing and balance**\n📅 **Schedules and bookings**', 53 |         sender: 'assistant', 54 |         timestamp: new Date(), 55 |  56 |       }; 57 |       setMessages([welcomeMessage]); 58 |     } 59 |   }, [isChatOpen, messages.length, language]); 60 |  61 |   const toggleChat = () => { 62 |     setIsChatOpen(!isChatOpen); 63 |     if (onToggle) onToggle(); 64 |   }; 65 |  66 |   const toggleMinimize = () => { 67 |     setIsMinimized(!isMinimized); 68 |   }; 69 |  70 |   const generateUniqueId = () => `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`; 71 |  72 |   const handleSendMessage = async () => { 73 |     if (!inputValue.trim()) return; 74 |  75 |     const messageId = generateUniqueId(); 76 |     const userMessage: Message = { 77 |       id: `user_${messageId}`, 78 |       content: inputValue.trim(), 79 |       sender: 'user', 80 |       timestamp: new Date(), 81 |     }; 82 |  83 |     setMessages(prev => [...prev, userMessage]); 84 |     setInputValue(''); 85 |     setIsTyping(true); 86 |  87 |     try { 88 |       const response = await fetch('/api/chat/hybrid', { 89 |         method: 'POST', 90 |         headers: { 91 |           'Content-Type': 'application/json', 92 |         }, 93 |         body: JSON.stringify({ 94 |           message: userMessage.content, 95 |           userId: `web_user_${messageId}`, 96 |           conversationHistory: messages.map(msg => ({ role: msg.sender, content: msg.content })) 97 |         }), 98 |       }); 99 | 100 |       if (!response.ok) {101 |         throw new Error(`API request failed: ${response.status}`);102 |       }103 | 104 |       const data = await response.json();105 |       if (data.success && data.response) {106 |         const assistantMessageId = generateUniqueId();107 | 108 |         const packages = parsePackagesFromText(data.response);109 | 110 |         const assistantMessage: Message = {111 |           id: `assistant_${assistantMessageId}`,112 |           content: data.response,113 |           sender: 'assistant',114 |           timestamp: new Date(),115 |           packages: packages.length > 0 ? packages : undefined,116 |         };117 |         setMessages(prev => [...prev, assistantMessage]);118 |       } else {119 |         throw new Error(data.error || 'No response received');120 |       }121 |     } catch (error) {122 | 123 |       const fallbackMessageId = generateUniqueId();124 |       const fallbackMessage: Message = {125 |         id: `fallback_${fallbackMessageId}`,126 |         content: language === 'es'127 |           ? '¡Hola! Soy tu asistente de MatMax Yoga Studio. ¿En qué puedo ayudarte hoy?\n\nPuedes preguntarme sobre:\n• 📅 Reservar clases\n• 🧘 Tipos de clases\n• 💳 Precios y pagos\n• 🗓️ Horarios disponibles\n• ❓ Preguntas generales'128 |           : 'Hello! I\'m your MatMax Yoga Studio assistant. How can I help you today?\n\nYou can ask me about:\n• 📅 Booking classes\n• 🧘 Class types\n• 💳 Pricing and payments\n• 🗓️ Available schedules\n• ❓ General questions',129 |         sender: 'assistant',130 |         timestamp: new Date(),131 | 132 |       };133 |       setMessages(prev => [...prev, fallbackMessage]);134 |     } finally {135 |       setIsTyping(false);136 |     }137 |   };138 | 139 |   const handleKeyPress = (e: React.KeyboardEvent) => {140 |     if (e.key === 'Enter' && !e.shiftKey) {141 |       e.preventDefault();142 |       handleSendMessage();143 |     }144 |   };145 | 146 |   const formatTime = (date: Date) => {147 |     return date.toLocaleTimeString(language === 'es' ? 'es-ES' : 'en-US', {148 |       hour: '2-digit',149 |       minute: '2-digit',150 |     });151 |   };152 | 153 |   return (154 |     <>155 |       {}156 |       <motion.button157 |         onClick={toggleChat}158 |         whileHover={{ scale: 1.05 }}159 |         whileTap={{ scale: 0.95 }}160 |         className="fixed bottom-6 right-6 w-14 h-14 rounded-full flex items-center justify-center transition-all duration-300 chat-toggle-button cosmic-glow touch-manipulation"161 |         aria-label={language === 'es' ? 'Abrir chat' : 'Open chat'}162 |       >163 |         <MessageCircle size={24} />164 |       </motion.button>165 | 166 |       {}167 |       <AnimatePresence>168 |         {isChatOpen && (169 |           <motion.div170 |             initial={{ opacity: 0, scale: 0.8, y: 20 }}171 |             animate={{ opacity: 1, scale: 1, y: 0 }}172 |             exit={{ opacity: 0, scale: 0.8, y: 20 }}173 |             transition={{ duration: 0.3, ease: 'easeOut' }}174 |             className={`fixed bottom-24 right-6 w-96 max-w-[calc(100vw-2rem)] rounded-xl shadow-2xl z-[9998] flex flex-col chat-window chat-window-enter ${className}`}175 |             style={{ height: isMinimized ? '60px' : '500px' }}176 |           >177 |             {}178 |             <div className="flex items-center justify-between p-4 rounded-t-xl chat-window-header">179 |               <div className="flex items-center space-x-3">180 |                 <div className="w-8 h-8 bg-[#FFD700] rounded-full flex items-center justify-center">181 |                   <Bot size={16} className="text-[#0A0A23]" />182 |                 </div>183 |                 <div>184 |                   <h3 className="text-[#FFD700] font-medium text-sm">185 |                     {language === 'es' ? 'Asistente Astrológico' : 'Astrology Assistant'}186 |                   </h3>187 |                   <p className="text-[#C0C0C0] text-xs">188 |                     {isTyping189 |                       ? (language === 'es' ? 'Escribiendo...' : 'Typing...')190 |                       : (language === 'es' ? 'En línea' : 'Online')191 |                     }192 |                   </p>193 |                 </div>194 |               </div>195 |               <div className="flex items-center space-x-1">196 |                 <button197 |                   onClick={toggleMinimize}198 |                   className="w-6 h-6 text-[#C0C0C0] hover:text-[#FFD700] transition-colors duration-200 flex items-center justify-center rounded hover:bg-[#FFD700]/10"199 |                   aria-label={isMinimized ? (language === 'es' ? 'Maximizar' : 'Maximize') : (language === 'es' ? 'Minimizar' : 'Minimize')}200 |                 >201 |                   {isMinimized ? <Maximize2 size={14} /> : <Minimize2 size={14} />}202 |                 </button>203 |                 <button204 |                   onClick={toggleChat}205 |                   className="w-6 h-6 text-[#C0C0C0] hover:text-[#FFD700] transition-colors duration-200 flex items-center justify-center rounded hover:bg-[#FFD700]/10"206 |                   aria-label={language === 'es' ? 'Cerrar chat' : 'Close chat'}207 |                 >208 |                   <X size={14} />209 |                 </button>210 |               </div>211 |             </div>212 | 213 |             {}214 |             <AnimatePresence>215 |               {!isMinimized && (216 |                 <motion.div217 |                   initial={{ opacity: 0, height: 0 }}218 |                   animate={{ opacity: 1, height: 'auto' }}219 |                   exit={{ opacity: 0, height: 0 }}220 |                   className="flex-1 overflow-hidden"221 |                 >222 |                   <div className="h-full flex flex-col">223 |                     {}224 |                     <div className="flex-1 overflow-y-auto p-4 space-y-4 max-h-80 chat-scrollbar">225 |                       {messages.map((message) => (226 |                         <motion.div227 |                           key={message.id}228 |                           initial={{ opacity: 0, y: 10 }}229 |                           animate={{ opacity: 1, y: 0 }}230 |                           className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}231 |                         >232 |                           <div className={`flex space-x-2 max-w-[80%] ${message.sender === 'user' ? 'flex-row-reverse space-x-reverse' : ''}`}>233 |                             {}234 |                             <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${235 |                               message.sender === 'user'236 |                                 ? 'bg-[#FFD700] text-[#0A0A23]'237 |                                 : 'bg-[#191970] text-[#FFD700]'238 |                             }`}>239 |                               {message.sender === 'user' ? <User size={14} /> : <Bot size={14} />}240 |                             </div>241 | 242 |                             {}243 |                             <div className={`rounded-lg px-3 py-2 text-sm chat-message-enter ${244 |                               message.sender === 'user'245 |                                 ? 'chat-message-user'246 |                                 : 'chat-message-assistant'247 |                             }`}>248 |                               <div className="whitespace-pre-wrap">{message.content}</div>249 | 250 |                               {}251 |                               {message.packages && message.packages.length > 0 && (252 |                                 <div className="mt-3">253 |                                   <PackageDisplay254 |                                     packages={message.packages}255 |                                     onPackageSelect={(selectedPackage) => {256 | 257 |                                       const packageMessageId = generateUniqueId();258 |                                       const packageMessage: Message = {259 |                                         id: `user_${packageMessageId}`,260 |                                         content: `Me interesa el paquete: ${selectedPackage.name}`,261 |                                         sender: 'user',262 |                                         timestamp: new Date(),263 |                                       };264 |                                       setMessages(prev => [...prev, packageMessage]);265 |                                       handleSendMessage();266 |                                     }}267 |                                   />268 |                                 </div>269 |                               )}270 | 271 |                               <div className={`text-xs mt-1 ${272 |                                 message.sender === 'user' ? 'text-[#0A0A23]/70' : 'text-[#C0C0C0]'273 |                               }`}>274 |                                 {formatTime(message.timestamp)}275 |                               </div>276 |                             </div>277 |                           </div>278 |                         </motion.div>279 |                       ))}280 | 281 |                       {}282 |                       {isTyping && (283 |                         <motion.div284 |                           initial={{ opacity: 0, y: 10 }}285 |                           animate={{ opacity: 1, y: 0 }}286 |                           className="flex justify-start"287 |                         >288 |                           <div className="flex space-x-2 max-w-[80%]">289 |                             <div className="w-8 h-8 bg-[#191970] rounded-full flex items-center justify-center">290 |                               <Bot size={14} className="text-[#FFD700]" />291 |                             </div>292 |                             <div className="chat-typing-indicator rounded-lg px-3 py-2 text-sm text-[#EAEAEA]">293 |                               <div className="flex space-x-1">294 |                                 <div className="w-2 h-2 chat-typing-dot rounded-full"></div>295 |                                 <div className="w-2 h-2 chat-typing-dot rounded-full"></div>296 |                                 <div className="w-2 h-2 chat-typing-dot rounded-full"></div>297 |                               </div>298 |                             </div>299 |                           </div>300 |                         </motion.div>301 |                       )}302 | 303 |                       <div ref={messagesEndRef} />304 |                     </div>305 | 306 |                     {}307 |                     <div className="p-4 border-t border-[#FFD700]/20 bg-[#0A0A23]/80">308 |                       <div className="flex space-x-2">309 |                         <input310 |                           ref={inputRef}311 |                           type="text"312 |                           value={inputValue}313 |                           onChange={(e) => setInputValue(e.target.value)}314 |                           onKeyPress={handleKeyPress}315 |                           placeholder={language === 'es' ? 'Escribe tu mensaje...' : 'Type your message...'}316 |                           className="flex-1 chat-input rounded-lg px-3 py-2 text-[#EAEAEA] placeholder-[#C0C0C0] text-sm"317 |                           disabled={isTyping}318 |                         />319 |                         <motion.button320 |                           onClick={handleSendMessage}321 |                           disabled={!inputValue.trim() || isTyping}322 |                           whileHover={{ scale: 1.05 }}323 |                           whileTap={{ scale: 0.95 }}324 |                           className={`w-10 h-10 rounded-lg flex items-center justify-center chat-button-send touch-manipulation ${325 |                             inputValue.trim() && !isTyping ? '' : 'opacity-50 cursor-not-allowed'326 |                           }`}327 |                           aria-label={language === 'es' ? 'Enviar mensaje' : 'Send message'}328 |                         >329 |                           <Send size={16} />330 |                         </motion.button>331 |                       </div>332 |                       <div className="text-xs text-[#C0C0C0] mt-2 text-center">333 |                         {language === 'es'334 |                           ? 'Presiona Enter para enviar • Shift+Enter para nueva línea'335 |                           : 'Press Enter to send • Shift+Enter for new line'336 |                         }337 |                       </div>338 |                     </div>339 |                   </div>340 |                 </motion.div>341 |               )}342 |             </AnimatePresence>343 |           </motion.div>344 |         )}345 |       </AnimatePresence>346 |     </>347 |   );348 | }
============================================================END: frontend/components/ChatWindow.tsx============================================================


============================================================FILE: frontend/components/ClientAuthModal.tsxSIZE: 6.39 KB============================================================
  1 | 'use client';  2 |   3 | import { useState } from 'react';  4 | import { Button } from './ui/button';  5 | import { Input } from './ui/input';  6 | import { Label } from './ui/label';  7 | import { Eye, EyeOff, LogIn, UserPlus } from 'lucide-react';  8 | import { createClient } from '@/lib/supabase/client';  9 | import { toast } from 'sonner'; 10 |  11 | interface ClientAuthModalProps { 12 |   isOpen: boolean; 13 |   onClose: () => void; 14 |   onSuccess: () => void; 15 | } 16 |  17 | export default function ClientAuthModal({ isOpen, onClose, onSuccess }: ClientAuthModalProps) { 18 |   const [isLogin, setIsLogin] = useState(true); 19 |   const [email, setEmail] = useState(''); 20 |   const [password, setPassword] = useState(''); 21 |   const [showPassword, setShowPassword] = useState(false); 22 |   const [loading, setLoading] = useState(false); 23 |  24 |   const handleSubmit = async (e: React.FormEvent) => { 25 |     e.preventDefault(); 26 |  27 |     if (!email || !password) { 28 |       toast.error('Please fill in all fields'); 29 |       return; 30 |     } 31 |  32 |     setLoading(true); 33 |  34 |     try { 35 |       const supabase = createClient(); 36 |  37 |       if (isLogin) { 38 |  39 |         const { data, error } = await supabase.auth.signInWithPassword({ 40 |           email, 41 |           password 42 |         }); 43 |  44 |         if (error) { 45 |           throw error; 46 |         } 47 |  48 |         if (data.user) { 49 |           toast.success('Login successful!'); 50 |           onSuccess(); 51 |           onClose(); 52 |         } 53 |       } else { 54 |  55 |         const { data, error } = await supabase.auth.signUp({ 56 |           email, 57 |           password, 58 |           options: { 59 |             emailRedirectTo: `${window.location.origin}/account/profile` 60 |           } 61 |         }); 62 |  63 |         if (error) { 64 |           throw error; 65 |         } 66 |  67 |         if (data.user) { 68 |           toast.success('Account created! Please check your email to verify your account.'); 69 |           setIsLogin(true); 70 |         } 71 |       } 72 |     } catch (error: unknown) { 73 |       toast.error((error as Error).message || 'Authentication failed'); 74 |     } finally { 75 |       setLoading(false); 76 |     } 77 |   }; 78 |  79 |   const handleForgotPassword = async () => { 80 |     if (!email) { 81 |       toast.error('Please enter your email address'); 82 |       return; 83 |     } 84 |  85 |     try { 86 |       const supabase = createClient(); 87 |       const { error } = await supabase.auth.resetPasswordForEmail(email, { 88 |         redirectTo: `${window.location.origin}/account/profile?reset=true` 89 |       }); 90 |  91 |       if (error) { 92 |         throw error; 93 |       } 94 |  95 |       toast.success('Password reset email sent! Please check your inbox.'); 96 |     } catch (error: unknown) { 97 |       toast.error((error as Error).message || 'Failed to send password reset email'); 98 |     } 99 |   };100 | 101 |   if (!isOpen) return null;102 | 103 |   return (104 |     <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">105 |       <div className="bg-[#1a1a2e] border border-[#16213e] rounded-lg p-6 w-full max-w-md mx-4">106 |         <div className="text-center mb-6">107 |           <h2 className="text-2xl font-bold text-white mb-2">108 |             {isLogin ? 'Welcome Back' : 'Create Account'}109 |           </h2>110 |           <p className="text-gray-400">111 |             {isLogin ? 'Sign in to your account' : 'Join us on your spiritual journey'}112 |           </p>113 |         </div>114 | 115 |         <form onSubmit={handleSubmit} className="space-y-4">116 |           <div>117 |             <Label htmlFor="email" className="text-gray-300">Email</Label>118 |             <Input119 |               id="email"120 |               type="email"121 |               value={email}122 |               onChange={(e) => setEmail(e.target.value)}123 |               placeholder="Enter your email"124 |               className="bg-[#16213e] border-[#0a0a23] text-white"125 |               required126 |             />127 |           </div>128 | 129 |           <div>130 |             <Label htmlFor="password" className="text-gray-300">Password</Label>131 |             <div className="relative">132 |               <Input133 |                 id="password"134 |                 type={showPassword ? 'text' : 'password'}135 |                 value={password}136 |                 onChange={(e) => setPassword(e.target.value)}137 |                 placeholder="Enter your password"138 |                 className="bg-[#16213e] border-[#0a0a23] text-white pr-10"139 |                 required140 |               />141 |               <Button142 |                 type="button"143 |                 variant="ghost"144 |                 size="sm"145 |                 className="absolute right-0 top-0 h-full px-3 text-gray-400 hover:text-white"146 |                 onClick={() => setShowPassword(!showPassword)}147 |               >148 |                 {showPassword ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}149 |               </Button>150 |             </div>151 |           </div>152 | 153 |           {isLogin && (154 |             <div className="text-right">155 |               <Button156 |                 type="button"157 |                 variant="ghost"158 |                 size="sm"159 |                 onClick={handleForgotPassword}160 |                 className="text-[#ffd700] hover:text-[#ffd700]/80 p-0 h-auto"161 |               >162 |                 Forgot password?163 |               </Button>164 |             </div>165 |           )}166 | 167 |           <Button168 |             type="submit"169 |             disabled={loading}170 |             className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"171 |           >172 |             {loading ? (173 |               <div className="flex items-center space-x-2">174 |                 <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-black"></div>175 |                 <span>{isLogin ? 'Signing in...' : 'Creating account...'}</span>176 |               </div>177 |             ) : (178 |               <div className="flex items-center space-x-2">179 |                 {isLogin ? <LogIn className="w-4 h-4" /> : <UserPlus className="w-4 h-4" />}180 |                 <span>{isLogin ? 'Sign In' : 'Create Account'}</span>181 |               </div>182 |             )}183 |           </Button>184 |         </form>185 | 186 |         <div className="mt-6 text-center">187 |           <p className="text-gray-400">188 |             {isLogin ? "Don't have an account? " : "Already have an account? "}189 |             <Button190 |               variant="ghost"191 |               size="sm"192 |               onClick={() => setIsLogin(!isLogin)}193 |               className="text-[#ffd700] hover:text-[#ffd700]/80 p-0 h-auto"194 |             >195 |               {isLogin ? 'Sign up' : 'Sign in'}196 |             </Button>197 |           </p>198 |         </div>199 | 200 |         <Button201 |           variant="ghost"202 |           onClick={onClose}203 |           className="absolute top-4 right-4 text-gray-400 hover:text-white"204 |         >205 |           ✕206 |         </Button>207 |       </div>208 |     </div>209 |   );210 | }
============================================================END: frontend/components/ClientAuthModal.tsx============================================================


============================================================FILE: frontend/components/ClientManagement.tsxSIZE: 54.87 KB============================================================
  1 | import { useState, useEffect, useCallback } from 'react';  2 | import { motion, AnimatePresence } from 'framer-motion';  3 | import {  4 |   Users, Plus, Edit, Clock, User, Search, Calendar, Grid, List,  5 |   RefreshCw, Eye, CheckCircle, History, Download, Star, ArrowUpDown, Trash2  6 | } from 'lucide-react';  7 | import { BaseButton } from './ui/BaseButton';  8 | import { BaseInput } from './ui/BaseInput';  9 | import { Card, CardContent } from './ui/card'; 10 | import { Badge } from './ui/badge'; 11 | import { Label } from './ui/label'; 12 | import { Textarea } from './ui/textarea'; 13 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select'; 14 | import { toast } from 'sonner'; 15 | import { formatDate } from '@/lib/utils'; 16 |  17 | import { useAuth } from '../hooks/useAuth'; 18 | import CreateBookingModal from './modals/CreateBookingModal'; 19 |  20 | interface Client { 21 |   id: string; 22 |   fullName: string; 23 |   email: string; 24 |   phone?: string; 25 |   status: string; 26 |   birthDate: string; 27 |   birthTime?: string; 28 |   birthPlace: string; 29 |   question: string; 30 |   language: string; 31 |   adminNotes?: string; 32 |   scheduledDate?: string; 33 |   scheduledTime?: string; 34 |   sessionType?: string; 35 |   lastReminderSent?: string; 36 |   lastBooking?: string; 37 |   createdAt: string; 38 |   updatedAt?: string; 39 |   totalBookings?: number; 40 |   isRecurrent?: boolean; 41 |   role?: string; 42 | } 43 |  44 | interface Booking { 45 |   id: string; 46 |   clientId: string; 47 |   date: string; 48 |   time: string; 49 |   status: string; 50 |   createdAt: string; 51 |   completedAt?: string; 52 |   notes?: string; 53 |   sessionType?: string; 54 |   price?: number; 55 |   rating?: number; 56 |   feedback?: string; 57 | } 58 |  59 | interface ClientModalProps { 60 |   client: Client | null; 61 |   isOpen: boolean; 62 |   mode: 'create' | 'edit' | 'view'; 63 |   onClose: () => void; 64 |   onSave: (client: Partial<Client>) => void; 65 | } 66 |  67 | function ClientModal({ client, isOpen, mode, onClose, onSave }: ClientModalProps) { 68 |   const [formData, setFormData] = useState<Partial<Client>>({ 69 |     fullName: '', 70 |     email: '', 71 |     phone: '', 72 |     status: 'active', 73 |     birthDate: '', 74 |     birthTime: '', 75 |     birthPlace: '', 76 |     question: '', 77 |     language: 'en', 78 |     adminNotes: '' 79 |   }); 80 |  81 |   useEffect(() => { 82 |     if (client && mode !== 'create') { 83 |       setFormData(client); 84 |     } else { 85 |             setFormData({ 86 |         fullName: '', 87 |         email: '', 88 |         phone: '', 89 |         status: 'active', 90 |         birthDate: '', 91 |         birthTime: '', 92 |         birthPlace: '', 93 |         question: '', 94 |         language: 'en', 95 |         adminNotes: '' 96 |       }); 97 |     } 98 |   }, [client, mode]); 99 | 100 |   const handleSubmit = (e: React.FormEvent) => {101 |     e.preventDefault();102 |     onSave(formData);103 |   };104 | 105 |   if (!isOpen) return null;106 | 107 |   return (108 |     <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">109 |       <motion.div110 |         initial={{ scale: 0.9, opacity: 0 }}111 |         animate={{ scale: 1, opacity: 1 }}112 |         exit={{ scale: 0.9, opacity: 0 }}113 |         className="dashboard-card rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"114 |       >115 |         <div className="p-6">116 |           <div className="flex items-center justify-between mb-6">117 |             <div>118 |               <h2 className="dashboard-text-primary text-xl font-semibold">119 |                 {mode === 'create' ? 'Add New Client' : mode === 'edit' ? 'Edit Client' : 'Client Details'}120 |               </h2>121 |               <p className="dashboard-text-secondary text-sm mt-1">122 |                 {mode === 'create' ? 'Enter client information' : mode === 'edit' ? 'Update client details' : 'View client information'}123 |               </p>124 |             </div>125 |             <BaseButton126 |               variant="outline"127 |               size="sm"128 |               onClick={onClose}129 |               className="dashboard-button-outline"130 |             >131 |               ✕132 |             </BaseButton>133 |           </div>134 | 135 |           <form onSubmit={handleSubmit} className="space-y-6">136 |             {}137 |             <div className="space-y-4">138 |               <h3 className="dashboard-text-primary text-lg font-semibold border-b border-[#2a2a4a] pb-2">139 |                 Basic Information140 |               </h3>141 |               <div className="grid grid-cols-1 md:grid-cols-2 gap-4">142 |                 <div>143 |                   <Label htmlFor="name" className="dashboard-label">Full Name *</Label>144 |                   <BaseInput145 |                     id="name"146 |                     value={formData.fullName || ''}147 |                     onChange={(e) => setFormData(prev => ({ ...prev, fullName: e.target.value }))}148 |                     className="dashboard-input"149 |                     disabled={mode === 'view'}150 |                     required151 |                   />152 |                 </div>153 | 154 |                 <div>155 |                   <Label htmlFor="email" className="dashboard-label">Email *</Label>156 |                   <BaseInput157 |                     id="email"158 |                     type="email"159 |                     value={formData.email || ''}160 |                     onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}161 |                     className="dashboard-input"162 |                     disabled={mode === 'view'}163 |                     required164 |                   />165 |                 </div>166 | 167 |                 <div>168 |                   <Label htmlFor="phone" className="dashboard-label">Phone</Label>169 |                   <BaseInput170 |                     id="phone"171 |                     type="tel"172 |                     value={formData.phone || ''}173 |                     onChange={(e) => setFormData(prev => ({ ...prev, phone: e.target.value }))}174 |                     className="dashboard-input"175 |                     disabled={mode === 'view'}176 |                     placeholder="+1 (555) 123-4567"177 |                   />178 |                 </div>179 | 180 |                 <div>181 |                   <Label htmlFor="language" className="dashboard-label">Language</Label>182 |                   <Select183 |                     value={formData.language || 'en'}184 |                     onValueChange={(value) => setFormData(prev => ({ ...prev, language: value }))}185 |                     disabled={mode === 'view'}186 |                   >187 |                     <SelectTrigger className="dashboard-select">188 |                       <SelectValue />189 |                     </SelectTrigger>190 |                     <SelectContent className="dashboard-dropdown-content">191 |                       <SelectItem value="en" className="dashboard-dropdown-item">🇺🇸 English</SelectItem>192 |                       <SelectItem value="es" className="dashboard-dropdown-item">🇪🇸 Español</SelectItem>193 |                     </SelectContent>194 |                   </Select>195 |                 </div>196 | 197 |                 <div>198 |                   <Label htmlFor="status" className="dashboard-label">Status</Label>199 |                   <Select200 |                     value={formData.status || 'active'}201 |                     onValueChange={(value) => setFormData(prev => ({ ...prev, status: value }))}202 |                     disabled={mode === 'view'}203 |                   >204 |                     <SelectTrigger className="dashboard-select">205 |                       <SelectValue />206 |                     </SelectTrigger>207 |                     <SelectContent className="dashboard-dropdown-content">208 |                       <SelectItem value="active" className="dashboard-dropdown-item">Active</SelectItem>209 |                       <SelectItem value="pending" className="dashboard-dropdown-item">Pending</SelectItem>210 |                       <SelectItem value="confirmed" className="dashboard-dropdown-item">Confirmed</SelectItem>211 |                       <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>212 |                       <SelectItem value="cancelled" className="dashboard-dropdown-item">Cancelled</SelectItem>213 |                       <SelectItem value="no-show" className="dashboard-dropdown-item">No Show</SelectItem>214 |                       <SelectItem value="inactive" className="dashboard-dropdown-item">Inactive</SelectItem>215 |                     </SelectContent>216 |                   </Select>217 |                 </div>218 |               </div>219 |             </div>220 | 221 |             {}222 |             <div className="space-y-4">223 |               <h3 className="dashboard-text-primary text-lg font-semibold border-b border-[#2a2a4a] pb-2">224 |                 Birth Information225 |               </h3>226 |               <div className="grid grid-cols-1 md:grid-cols-2 gap-4">227 |                 <div>228 |                   <Label htmlFor="birthDate" className="dashboard-label">Birth Date *</Label>229 |                   <BaseInput230 |                     id="birthDate"231 |                     type="date"232 |                     value={formData.birthDate || ''}233 |                     onChange={(e) => setFormData(prev => ({ ...prev, birthDate: e.target.value }))}234 |                     className="dashboard-input"235 |                     disabled={mode === 'view'}236 |                     required237 |                   />238 |                 </div>239 | 240 |                 <div>241 |                   <Label htmlFor="birthTime" className="dashboard-label">Birth Time (Optional)</Label>242 |                   <BaseInput243 |                     id="birthTime"244 |                     type="time"245 |                     value={formData.birthTime || ''}246 |                     onChange={(e) => setFormData(prev => ({ ...prev, birthTime: e.target.value }))}247 |                     className="dashboard-input"248 |                     disabled={mode === 'view'}249 |                     placeholder="Leave empty if unknown"250 |                   />251 |                   <p className="dashboard-text-muted text-xs mt-1">Leave empty if birth time is unknown</p>252 |                 </div>253 | 254 |                 <div className="md:col-span-2">255 |                   <Label htmlFor="birthPlace" className="dashboard-label">Birth Place *</Label>256 |                   <BaseInput257 |                     id="birthPlace"258 |                     value={formData.birthPlace || ''}259 |                     onChange={(e) => setFormData(prev => ({ ...prev, birthPlace: e.target.value }))}260 |                     className="dashboard-input"261 |                     disabled={mode === 'view'}262 |                     placeholder="City, Country (or just City if country unknown)"263 |                     required264 |                   />265 |                   <p className="dashboard-text-muted text-xs mt-1">City and country preferred, but city alone is acceptable</p>266 |                 </div>267 | 268 |                 <div className="md:col-span-2">269 |                   <Label htmlFor="question" className="dashboard-label">Question/Focus Areas *</Label>270 |                   <Textarea271 |                     id="question"272 |                     value={formData.question || ''}273 |                     onChange={(e) => setFormData(prev => ({ ...prev, question: e.target.value }))}274 |                     className="dashboard-input min-h-[100px]"275 |                     disabled={mode === 'view'}276 |                     placeholder="What would you like to explore in your reading?"277 |                     required278 |                   />279 |                 </div>280 |               </div>281 |             </div>282 | 283 |             {}284 |             <div className="space-y-4">285 |               <h3 className="dashboard-text-primary text-lg font-semibold border-b border-[#2a2a4a] pb-2">286 |                 Admin & CRM287 |               </h3>288 |               <div className="grid grid-cols-1 gap-4">289 |                 <div>290 |                   <Label htmlFor="adminNotes" className="dashboard-label">Admin Notes (CRM History)</Label>291 |                   <Textarea292 |                     id="adminNotes"293 |                     value={formData.adminNotes || ''}294 |                     onChange={(e) => setFormData(prev => ({ ...prev, adminNotes: e.target.value }))}295 |                     className="dashboard-input min-h-[100px]"296 |                     disabled={mode === 'view'}297 |                     placeholder="Internal notes, follow-up actions, client preferences, etc."298 |                   />299 |                 </div>300 |               </div>301 |             </div>302 | 303 |             {mode !== 'view' && (304 |               <div className="flex justify-end space-x-3">305 |                 <BaseButton306 |                   type="button"307 |                   variant="outline"308 |                   onClick={onClose}309 |                   className="dashboard-button-outline"310 |                 >311 |                   Cancel312 |                 </BaseButton>313 |                 <BaseButton314 |                   type="submit"315 |                   className="dashboard-button-primary"316 |                 >317 |                   {mode === 'create' ? 'Add Client' : 'Save Changes'}318 |                 </BaseButton>319 |               </div>320 |             )}321 |           </form>322 |         </div>323 |       </motion.div>324 |     </div>325 |   );326 | }327 | 328 | interface BookingHistoryModalProps {329 |   client: Client | null;330 |   isOpen: boolean;331 |   onClose: () => void;332 | }333 | 334 | function BookingHistoryModal({ client, isOpen, onClose }: BookingHistoryModalProps) {335 |   const [bookings, setBookings] = useState<Booking[]>([]);336 |   const [isLoading, setIsLoading] = useState(false);337 |   const { user } = useAuth();338 | 339 |   const loadBookingHistory = useCallback(async () => {340 |     if (!client || !user?.access_token) return;341 | 342 |     setIsLoading(true);343 |     try {344 |       const response = await fetch(345 |         `/api/admin/users/${client.id}/bookings`,346 |         {347 |           headers: {348 |             'Authorization': `Bearer ${user.access_token}`,349 |             'Content-Type': 'application/json'350 |           }351 |         }352 |       );353 | 354 |       if (response.ok) {355 |         const data = await response.json();356 |         setBookings(data.bookings || []);357 |       }358 |     } catch (error) {359 |       } finally {360 |       setIsLoading(false);361 |     }362 |   }, [client, user?.access_token]);363 | 364 |   useEffect(() => {365 |     if (isOpen && client) {366 |       loadBookingHistory();367 |     }368 |   }, [isOpen, client, loadBookingHistory]);369 | 370 |   const getStatusBadge = (status: string) => {371 |     const statusConfig = {372 |       'pending': { color: 'bg-yellow-500/20 text-black', label: 'Pending' },373 |       'confirmed': { color: 'bg-blue-500/20 text-black', label: 'Confirmed' },374 |       'completed': { color: 'bg-green-500/20 text-black', label: 'Completed' },375 |       'cancelled': { color: 'bg-red-500/20 text-black', label: 'Cancelled' },376 |       'no-show': { color: 'bg-gray-500/20 text-black', label: 'No Show' }377 |     };378 | 379 |     const config = statusConfig[status as keyof typeof statusConfig] || statusConfig.pending;380 |     return <Badge className={config.color}>{config.label}</Badge>;381 |   };382 | 383 |   if (!isOpen) return null;384 | 385 |   return (386 |     <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">387 |       <motion.div388 |         initial={{ scale: 0.9, opacity: 0 }}389 |         animate={{ scale: 1, opacity: 1 }}390 |         exit={{ scale: 0.9, opacity: 0 }}391 |         className="dashboard-card rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"392 |       >393 |         <div className="p-6">394 |           <div className="flex items-center justify-between mb-6">395 |             <div>396 |               <h2 className="dashboard-text-primary text-xl font-semibold">Booking History</h2>397 |               <p className="dashboard-text-secondary text-sm mt-1">398 |                 All bookings for {client?.fullName} ({client?.email})399 |               </p>400 |             </div>401 |             <BaseButton402 |               variant="outline"403 |               size="sm"404 |               onClick={onClose}405 |               className="dashboard-button-outline"406 |             >407 |               ✕408 |             </BaseButton>409 |           </div>410 | 411 |           {isLoading ? (412 |             <div className="flex items-center justify-center h-64">413 |               <motion.div414 |                 animate={{ rotate: 360 }}415 |                 transition={{ duration: 2, repeat: Infinity, ease: "linear" }}416 |                 className="w-8 h-8 border-4 border-[#FFD700] border-t-transparent rounded-full"417 |               />418 |             </div>419 |           ) : bookings.length === 0 ? (420 |             <div className="text-center py-12">421 |               <Calendar size={48} className="mx-auto text-gray-400/50 mb-4" />422 |               <p className="dashboard-text-secondary text-lg mb-2">No booking history</p>423 |               <p className="dashboard-text-muted text-sm">This client hasn&apos;t made any bookings yet.</p>424 |             </div>425 |           ) : (426 |             <div className="space-y-4">427 |               <div className="flex items-center justify-between mb-4">428 |                 <p className="dashboard-text-secondary text-sm">429 |                   Total bookings: {bookings.length}430 |                 </p>431 |                 <BaseButton432 |                   variant="outline"433 |                   size="sm"434 |                   className="dashboard-button-outline"435 |                 >436 |                   <Download size={16} className="mr-2" />437 |                   Export438 |                 </BaseButton>439 |               </div>440 | 441 |               <div className="space-y-3">442 |                 {bookings.map((booking) => (443 |                   <Card key={booking.id} className="dashboard-card">444 |                     <CardContent className="p-4">445 |                       <div className="flex items-center justify-between">446 |                         <div className="flex items-center space-x-4">447 |                           <div className="w-10 h-10 bg-[#FFD700]/20 rounded-lg flex items-center justify-center">448 |                             <Calendar size={20} className="text-[#FFD700]" />449 |                           </div>450 |                           <div>451 |                             <div className="flex items-center space-x-3 mb-1">452 |                               <p className="dashboard-text-primary font-medium">453 |                                 {formatDate(booking.date)}454 |                               </p>455 |                               <span className="dashboard-text-secondary">•</span>456 |                               <p className="dashboard-text-secondary">{booking.time}</p>457 |                               {getStatusBadge(booking.status)}458 |                             </div>459 |                             <div className="flex items-center space-x-4 text-sm dashboard-text-secondary">460 |                               <span>Type: {booking.sessionType || 'Standard Reading'}</span>461 |                               {booking.price && <span>• ${booking.price}</span>}462 |                               {booking.rating && (463 |                                 <div className="flex items-center space-x-1">464 |                                   <span>•</span>465 |                                   <Star size={14} className="text-yellow-400" />466 |                                   <span>{booking.rating}/5</span>467 |                                 </div>468 |                               )}469 |                             </div>470 |                           </div>471 |                         </div>472 |                         <div className="text-right">473 |                           <p className="text-xs text-gray-400">474 |                             Booked: {formatDate(booking.createdAt)}475 |                           </p>476 |                           {booking.completedAt && (477 |                             <p className="text-xs text-green-400">478 |                               Completed: {formatDate(booking.completedAt)}479 |                             </p>480 |                           )}481 |                         </div>482 |                       </div>483 |                       {booking.notes && (484 |                         <div className="mt-3 pt-3 border-t border-[#C0C0C0]/10">485 |                           <p className="text-sm text-[#EAEAEA]/80">{booking.notes}</p>486 |                         </div>487 |                       )}488 |                       {booking.feedback && (489 |                         <div className="mt-3 pt-3 border-t border-[#C0C0C0]/10">490 |                           <p className="text-xs text-[#C0C0C0] mb-1">Client Feedback:</p>491 |                           <p className="text-sm text-[#EAEAEA]/80 italic">&quot;{booking.feedback}&quot;</p>492 |                         </div>493 |                       )}494 |                     </CardContent>495 |                   </Card>496 |                 ))}497 |               </div>498 |             </div>499 |           )}500 |         </div>501 |       </motion.div>502 |     </div>503 |   );504 | }505 | 506 | export function ClientManagement() {507 |   const { user } = useAuth();508 |   const [clients, setClients] = useState<Client[]>([]);509 | 510 |   const [filteredClients, setFilteredClients] = useState<Client[]>([]);511 |   const [isLoading, setIsLoading] = useState(true);512 |   const [searchQuery, setSearchQuery] = useState('');513 |   const [statusFilter, setStatusFilter] = useState('all');514 |   const [languageFilter, setLanguageFilter] = useState('all');515 |   const [dateFilter, setDateFilter] = useState('all');516 |   const [sortBy, setSortBy] = useState<'name' | 'date' | 'status' | 'bookings'>('date');517 |   const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');518 |   const [viewMode, setViewMode] = useState<'grid' | 'list'>('list');519 |   const [selectedClient, setSelectedClient] = useState<Client | null>(null);520 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null);521 |   const [modalState, setModalState] = useState<{522 |     isOpen: boolean;523 |     mode: 'create' | 'edit' | 'view' | 'history';524 |   }>({ isOpen: false, mode: 'view' });525 |   const [showCreateBookingModal, setShowCreateBookingModal] = useState(false);526 |   const [selectedClientForBooking, setSelectedClientForBooking] = useState<Client | null>(null);527 | 528 |   const loadClients = useCallback(async () => {529 |     try {530 |       if (!user?.access_token) {531 |         toast.error('Please log in to access this feature');532 |         return;533 |       }534 | 535 |       setIsLoading(true);536 |       const response = await fetch(537 |         `/api/admin/users?enhanced=true`,538 |         {539 |           headers: {540 |             'Authorization': `Bearer ${user.access_token}`,541 |             'Content-Type': 'application/json'542 |           }543 |         }544 |       );545 | 546 |       ));547 | 548 |       if (response.ok) {549 |         const data = await response.json();550 |         const loadedClients = data.data || [];551 |         => ({ name: c.name, status: c.status })));552 |         setClients(loadedClients);553 |         setLastLoaded(new Date());554 | 555 |         if (loadedClients.length > 0) {556 |           toast.success(`Loaded ${loadedClients.length} clients successfully`);557 |         } else {558 |           toast.info('No clients found');559 |         }560 |       } else {561 |         const errorText = await response.text();562 |         toast.error('Failed to load clients');563 |       }564 |     } catch (error) {565 |       toast.error('Error loading clients');566 |     } finally {567 |       setIsLoading(false);568 |     }569 |   }, [user]);570 | 571 |   const refreshClients = useCallback(() => {572 |     if (user?.access_token) {573 |       loadClients();574 |     }575 |   }, [user?.access_token, loadClients]);576 | 577 |   useEffect(() => {578 |     if (user?.access_token) {579 |       loadClients();580 |     } else {581 |       setClients([]);582 |       setIsLoading(false);583 |     }584 |   }, [user?.access_token, loadClients]);585 | 586 |   useEffect(() => {587 |     const handleVisibilityChange = () => {588 |       if (document.visibilityState === 'visible' && user?.access_token && clients.length === 0) {589 |         loadClients();590 |       }591 |     };592 | 593 |     document.addEventListener('visibilitychange', handleVisibilityChange);594 |     return () => document.removeEventListener('visibilitychange', handleVisibilityChange);595 |   }, [user?.access_token, clients.length, loadClients]);596 | 597 |   useEffect(() => {598 |     if (user?.access_token && clients.length === 0) {599 |       loadClients();600 |     }601 |   }, [user?.access_token, clients.length, loadClients]);602 | 603 |   useEffect(() => {604 | 605 |     window.refreshClients = refreshClients;606 | 607 |     return () => {608 | 609 |       delete window.refreshClients;610 |     };611 |   }, [user?.access_token, refreshClients]);612 | 613 |   useEffect(() => {614 |     const handleNavigation = () => {615 | 616 |       setTimeout(() => {617 |         if (user?.access_token && clients.length === 0) {618 |           loadClients();619 |         }620 |       }, 100);621 |     };622 | 623 |     window.addEventListener('popstate', handleNavigation);624 | 625 |     const originalPushState = history.pushState;626 |     history.pushState = function(...args) {627 |       originalPushState.apply(history, args);628 |       handleNavigation();629 |     };630 | 631 |     return () => {632 |       window.removeEventListener('popstate', handleNavigation);633 |       history.pushState = originalPushState;634 |     };635 |   }, [user?.access_token, clients.length, loadClients]);636 | 637 |   const filterAndSortClients = useCallback(() => {638 |     let filtered = [...clients];639 | 640 |     if (searchQuery) {641 |       filtered = filtered.filter(client =>642 |         client.fullName.toLowerCase().includes(searchQuery.toLowerCase()) ||643 |         client.email.toLowerCase().includes(searchQuery.toLowerCase()) ||644 |         client.birthPlace?.toLowerCase().includes(searchQuery.toLowerCase())645 |       );646 |     }647 | 648 |     if (statusFilter !== 'all') {649 |       filtered = filtered.filter(client => client.status === statusFilter);650 |     }651 | 652 |     if (languageFilter !== 'all') {653 |       filtered = filtered.filter(client => client.language === languageFilter);654 |     }655 | 656 |     if (dateFilter !== 'all') {657 |       const now = new Date();658 |       const filterDate = new Date();659 | 660 |       switch (dateFilter) {661 |         case 'today':662 |           filterDate.setHours(0, 0, 0, 0);663 |           filtered = filtered.filter(client => {664 |             const clientDate = new Date(client.createdAt);665 |             return !isNaN(clientDate.getTime()) && clientDate >= filterDate;666 |           });667 |           break;668 |         case 'week':669 |           filterDate.setDate(now.getDate() - 7);670 |           filtered = filtered.filter(client => {671 |             const clientDate = new Date(client.createdAt);672 |             return !isNaN(clientDate.getTime()) && clientDate >= filterDate;673 |           });674 |           break;675 |         case 'month':676 |           filterDate.setMonth(now.getMonth() - 1);677 |           filtered = filtered.filter(client => {678 |             const clientDate = new Date(client.createdAt);679 |             return !isNaN(clientDate.getTime()) && clientDate >= filterDate;680 |           });681 |           break;682 |       }683 |     }684 | 685 |     filtered.sort((a, b) => {686 |       let aValue: string | number | Date, bValue: string | number | Date;687 | 688 |       switch (sortBy) {689 |         case 'name':690 |           aValue = a.fullName.toLowerCase();691 |           bValue = b.fullName.toLowerCase();692 |           break;693 |         case 'date':694 |           aValue = new Date(a.createdAt);695 |           bValue = new Date(b.createdAt);696 | 697 |           if (isNaN(aValue.getTime())) aValue = new Date(0);698 |           if (isNaN(bValue.getTime())) bValue = new Date(0);699 |           break;700 |         case 'status':701 |           aValue = a.status;702 |           bValue = b.status;703 |           break;704 |         case 'bookings':705 |           aValue = a.totalBookings || 0;706 |           bValue = b.totalBookings || 0;707 |           break;708 |         default:709 |           aValue = a.createdAt;710 |           bValue = b.createdAt;711 |       }712 | 713 |       if (aValue < bValue) return sortOrder === 'asc' ? -1 : 1;714 |       if (aValue > bValue) return sortOrder === 'asc' ? 1 : -1;715 |       return 0;716 |     });717 | 718 |     setFilteredClients(filtered);719 |   }, [clients, searchQuery, statusFilter, languageFilter, dateFilter, sortBy, sortOrder]);720 | 721 |   useEffect(() => {722 |     filterAndSortClients();723 |   }, [clients, searchQuery, statusFilter, languageFilter, dateFilter, sortBy, sortOrder, filterAndSortClients]);724 | 725 |   const handleCreateClient = () => {726 |     setSelectedClient(null);727 |     setModalState({ isOpen: true, mode: 'create' });728 |   };729 | 730 |   const handleEditClient = (client: Client) => {731 |     setSelectedClient(client);732 |     setModalState({ isOpen: true, mode: 'edit' });733 |   };734 | 735 |   const handleViewClient = (client: Client) => {736 |     setSelectedClient(client);737 |     setModalState({ isOpen: true, mode: 'view' });738 |   };739 | 740 |   const handleViewHistory = (client: Client) => {741 |     setSelectedClient(client);742 |     setModalState({ isOpen: true, mode: 'history' });743 |   };744 | 745 |   const handleCreateBooking = (client: Client) => {746 |     setSelectedClientForBooking(client);747 |     setShowCreateBookingModal(true);748 |   };749 | 750 |   const handleDeleteClient = async (client: Client) => {751 |     if (!user?.access_token) return;752 | 753 |     if (!confirm(`Are you sure you want to delete ${client.fullName}? This action cannot be undone.`)) {754 |       return;755 |     }756 | 757 |     try {758 |       const response = await fetch(759 |         `/api/admin/users/${client.id}`,760 |         {761 |           method: 'DELETE',762 |           headers: {763 |             'Authorization': `Bearer ${user.access_token}`,764 |             'Content-Type': 'application/json'765 |           }766 |         }767 |       );768 | 769 |       if (response.ok) {770 |         setClients(prev => prev.filter(c => c.id !== client.id));771 |         toast.success('Client deleted successfully', {772 |           description: `${client.fullName} has been removed from your client list.`773 |         });774 |       } else {775 |         const errorData = await response.json();776 |         toast.error('Failed to delete client', {777 |           description: errorData.message || 'Please try again.'778 |         });779 |       }780 |     } catch (error) {781 |       toast.error('Network error', {782 |         description: 'Failed to delete client. Please check your connection and try again.'783 |       });784 |     }785 |   };786 | 787 |   const handleSaveClient = async (clientData: Partial<Client>) => {788 |     if (!user?.access_token) return;789 | 790 |     try {791 |       const isCreate = modalState.mode === 'create';792 |       const url = isCreate793 |         ? `/api/admin/users`794 |         : `/api/admin/users/${selectedClient?.id}`;795 | 796 |       const response = await fetch(url, {797 |         method: isCreate ? 'POST' : 'PUT',798 |         headers: {799 |           'Authorization': `Bearer ${user.access_token}`,800 |           'Content-Type': 'application/json'801 |         },802 |         body: JSON.stringify(clientData)803 |       });804 | 805 |       if (response.ok) {806 |         const data = await response.json();807 | 808 |         if (isCreate) {809 |           setClients(prev => [data.client, ...prev]);810 |           toast.success('Client created successfully!', {811 |             description: `${data.client.name} has been added to your client list.`812 |           });813 |         } else {814 |           setClients(prev => prev.map(c =>815 |             c.id === selectedClient?.id ? { ...c, ...data.client } : c816 |           ));817 |           toast.success('Client updated successfully!', {818 |             description: `${data.client.name}'s information has been updated.`819 |           });820 |         }821 | 822 |         setModalState({ isOpen: false, mode: 'view' });823 |         setSelectedClient(null);824 |       } else {825 |         const errorData = await response.json();826 |         toast.error('Failed to save client', {827 |           description: errorData.message || 'Please try again.'828 |         });829 |       }830 |     } catch (error) {831 |       toast.error('Network error', {832 |         description: 'Failed to save client. Please check your connection and try again.'833 |       });834 |     }835 |   };836 | 837 |   const getStatusBadge = (status: string) => {838 |     const statusConfig = {839 |       'pending': { color: 'bg-yellow-500/20 text-black', label: 'Pending' },840 |       'confirmed': { color: 'bg-blue-500/20 text-black', label: 'Confirmed' },841 |       'completed': { color: 'bg-green-500/20 text-black', label: 'Completed' },842 |       'cancelled': { color: 'bg-red-500/20 text-black', label: 'Cancelled' },843 |       'no-show': { color: 'bg-gray-500/20 text-black', label: 'No Show' }844 |     };845 | 846 |     const config = statusConfig[status as keyof typeof statusConfig] || statusConfig.pending;847 |     return <Badge className={config.color}>{config.label}</Badge>;848 |   };849 | 850 |   const stats = {851 |     total: clients.length,852 |     pending: clients.filter(c => c.status === 'pending').length,853 |     confirmed: clients.filter(c => c.status === 'confirmed').length,854 |     completed: clients.filter(c => c.status === 'completed').length,855 |     recurrent: clients.filter(c => c.isRecurrent).length856 |   };857 | 858 |   .length,859 |     confirmed: clients.filter(c => c.status === 'confirmed').length,860 |     completed: clients.filter(c => c.status === 'completed').length,861 |     recurrent: clients.filter(c => c.isRecurrent).length862 |   });863 |   ));864 | 865 |   if (isLoading) {866 |     return (867 |       <div className="flex items-center justify-center min-h-[400px]">868 |         <div className="text-center">869 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>870 |           <p className="text-[#FFD700] text-lg font-semibold">Loading client management...</p>871 |         </div>872 |       </div>873 |     );874 |   }875 | 876 |   return (877 |     <div className="dashboard-container p-6 space-y-6">878 |       {}879 |       <div className="flex items-center justify-between">880 |         <div>881 |           <h1 className="dashboard-text-primary text-3xl font-bold">Client Management</h1>882 |           <p className="dashboard-text-secondary">Manage your consultation clients</p>883 |         </div>884 |         <BaseButton885 |           onClick={handleCreateClient}886 |           className="dashboard-button-primary"887 |         >888 |           <Plus size={16} className="mr-2" />889 |           Add Client890 |         </BaseButton>891 |       </div>892 | 893 |       {}894 |       <div className="grid grid-cols-1 sm:grid-cols-5 gap-4">895 |         <Card className="dashboard-card">896 |           <CardContent className="p-4">897 |             <div className="flex items-center justify-between">898 |               <div>899 |                 <p className="dashboard-stats-label">Total Clients</p>900 |                 <p className="dashboard-stats-value">{stats.total}</p>901 |               </div>902 |               <Users size={24} className="text-dashboard-accent" />903 |             </div>904 |           </CardContent>905 |         </Card>906 | 907 |         <Card className="dashboard-card">908 |           <CardContent className="p-4">909 |             <div className="flex items-center justify-between">910 |               <div>911 |                 <p className="dashboard-stats-label">Pending</p>912 |                 <p className="dashboard-stats-value">{stats.pending}</p>913 |               </div>914 |               <Clock size={24} className="text-dashboard-accent" />915 |             </div>916 |           </CardContent>917 |         </Card>918 | 919 |         <Card className="dashboard-card">920 |           <CardContent className="p-4">921 |             <div className="flex items-center justify-between">922 |               <div>923 |                 <p className="dashboard-stats-label">Confirmed</p>924 |                 <p className="dashboard-stats-value">{stats.confirmed}</p>925 |               </div>926 |               <CheckCircle size={24} className="text-dashboard-accent" />927 |             </div>928 |           </CardContent>929 |         </Card>930 | 931 |         <Card className="dashboard-card">932 |           <CardContent className="p-4">933 |             <div className="flex items-center justify-between">934 |               <div>935 |                 <p className="dashboard-stats-label">Completed</p>936 |                 <p className="dashboard-stats-value">{stats.completed}</p>937 |               </div>938 |               <CheckCircle size={24} className="text-dashboard-accent" />939 |             </div>940 |           </CardContent>941 |         </Card>942 | 943 |         <Card className="dashboard-card">944 |           <CardContent className="p-4">945 |             <div className="flex items-center justify-between">946 |               <div>947 |                 <p className="dashboard-stats-label">Recurrent</p>948 |                 <p className="dashboard-stats-value">{stats.recurrent}</p>949 |               </div>950 |               <Star size={24} className="text-dashboard-accent" />951 |             </div>952 |           </CardContent>953 |         </Card>954 |       </div>955 | 956 |       {}957 |       <Card className="dashboard-card">958 |         <CardContent className="p-4">959 |           <div className="grid grid-cols-1 lg:grid-cols-7 gap-4 items-end">960 |             {}961 |             <div className="lg:col-span-2">962 |               <Label className="dashboard-label">Search</Label>963 |               <div className="relative">964 |                 <Search size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400/50" />965 |                 <BaseInput966 |                   placeholder="Search clients..."967 |                   value={searchQuery}968 |                   onChange={(e) => setSearchQuery(e.target.value)}969 |                   className="pl-10 dashboard-input"970 |                 />971 |               </div>972 |             </div>973 | 974 |             {}975 |             <div>976 |               <Label className="dashboard-label">Status</Label>977 |               <Select value={statusFilter} onValueChange={setStatusFilter}>978 |                 <SelectTrigger className="dashboard-select">979 |                   <SelectValue />980 |                 </SelectTrigger>981 |                 <SelectContent className="dashboard-dropdown-content">982 |                   <SelectItem value="all" className="dashboard-dropdown-item">All Status</SelectItem>983 |                   <SelectItem value="active" className="dashboard-dropdown-item">Active</SelectItem>984 |                   <SelectItem value="pending" className="dashboard-dropdown-item">Pending</SelectItem>985 |                   <SelectItem value="confirmed" className="dashboard-dropdown-item">Confirmed</SelectItem>986 |                   <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>987 |                   <SelectItem value="cancelled" className="dashboard-dropdown-item">Cancelled</SelectItem>988 |                   <SelectItem value="no-show" className="dashboard-dropdown-item">No Show</SelectItem>989 |                   <SelectItem value="inactive" className="dashboard-dropdown-item">Inactive</SelectItem>990 |                 </SelectContent>991 |               </Select>992 |             </div>993 | 994 |             {}995 |             <div>996 |               <Label className="dashboard-label">Language</Label>997 |               <Select value={languageFilter} onValueChange={setLanguageFilter}>998 |                 <SelectTrigger className="dashboard-select">999 |                   <SelectValue />1000 |                 </SelectTrigger>1001 |                 <SelectContent className="dashboard-dropdown-content">1002 |                   <SelectItem value="all" className="dashboard-dropdown-item">All Languages</SelectItem>1003 |                   <SelectItem value="en" className="dashboard-dropdown-item">🇺🇸 English</SelectItem>1004 |                   <SelectItem value="es" className="dashboard-dropdown-item">🇪🇸 Español</SelectItem>1005 |                 </SelectContent>1006 |               </Select>1007 |             </div>1008 | 1009 |             {}1010 |             <div>1011 |               <Label className="dashboard-label">Date</Label>1012 |               <Select value={dateFilter} onValueChange={setDateFilter}>1013 |                 <SelectTrigger className="dashboard-select">1014 |                   <SelectValue />1015 |                 </SelectTrigger>1016 |                 <SelectContent className="dashboard-dropdown-content">1017 |                   <SelectItem value="all" className="dashboard-dropdown-item">All Time</SelectItem>1018 |                   <SelectItem value="today" className="dashboard-dropdown-item">Today</SelectItem>1019 |                   <SelectItem value="week" className="dashboard-dropdown-item">This Week</SelectItem>1020 |                   <SelectItem value="month" className="dashboard-dropdown-item">This Month</SelectItem>1021 |                 </SelectContent>1022 |               </Select>1023 |             </div>1024 | 1025 |             {}1026 |             <div>1027 |               <Label className="dashboard-label">Sort By</Label>1028 |               <Select value={sortBy} onValueChange={(value: 'date' | 'name' | 'status') => setSortBy(value)}>1029 |                 <SelectTrigger className="dashboard-select">1030 |                   <SelectValue />1031 |                 </SelectTrigger>1032 |                 <SelectContent className="dashboard-dropdown-content">1033 |                   <SelectItem value="date" className="dashboard-dropdown-item">Date Created</SelectItem>1034 |                   <SelectItem value="name" className="dashboard-dropdown-item">Name</SelectItem>1035 |                   <SelectItem value="status" className="dashboard-dropdown-item">Status</SelectItem>1036 |                   <SelectItem value="bookings" className="dashboard-dropdown-item">Total Bookings</SelectItem>1037 |                 </SelectContent>1038 |               </Select>1039 |             </div>1040 | 1041 |             {}1042 |             <div className="flex space-x-2">1043 |               <BaseButton1044 |                 variant="outline"1045 |                 size="sm"1046 |                 onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}1047 |                 className="dashboard-button-outline"1048 |               >1049 |                 <ArrowUpDown size={16} />1050 |               </BaseButton>1051 |               <div className="flex dashboard-card rounded-lg">1052 |                 <BaseButton1053 |                   variant="ghost"1054 |                   size="sm"1055 |                   onClick={() => setViewMode('list')}1056 |                   className={viewMode === 'list' ? 'dashboard-button-toggle-active' : 'dashboard-button-toggle-inactive'}1057 |                 >1058 |                   <List size={16} />1059 |                 </BaseButton>1060 |                 <BaseButton1061 |                   variant="ghost"1062 |                   size="sm"1063 |                   onClick={() => setViewMode('grid')}1064 |                   className={viewMode === 'grid' ? 'dashboard-button-toggle-active' : 'dashboard-button-toggle-inactive'}1065 |                 >1066 |                   <Grid size={16} />1067 |                 </BaseButton>1068 |               </div>1069 |             </div>1070 |           </div>1071 |         </CardContent>1072 |       </Card>1073 | 1074 |       {}1075 |       <div className="flex items-center justify-between">1076 |         <div className="flex flex-col space-y-1">1077 |           <p className="dashboard-text-secondary">1078 |             Showing {filteredClients.length} of {clients.length} clients1079 |           </p>1080 |           {lastLoaded && (1081 |             <p className="dashboard-text-muted">1082 |               Last loaded: {lastLoaded.toLocaleTimeString()}1083 |             </p>1084 |           )}1085 |         </div>1086 |         <BaseButton1087 |           size="sm"1088 |           onClick={loadClients}1089 |           className="dashboard-button-reload"1090 |         >1091 |           <RefreshCw size={16} className="mr-2" />1092 |           Refresh1093 |         </BaseButton>1094 |       </div>1095 | 1096 |       {}1097 |       {isLoading && (1098 |         <Card className="dashboard-card">1099 |           <CardContent className="p-12 text-center">1100 |             <motion.div1101 |               animate={{ rotate: 360 }}1102 |               transition={{ duration: 2, repeat: Infinity, ease: "linear" }}1103 |               className="w-12 h-12 border-4 border-[#ffd700] border-t-transparent rounded-full mx-auto mb-4"1104 |             />1105 |             <h3 className="dashboard-text-primary text-lg font-semibold mb-2">Loading clients...</h3>1106 |             <p className="dashboard-text-secondary">Please wait while we fetch your client data.</p>1107 |           </CardContent>1108 |         </Card>1109 |       )}1110 | 1111 |       {}1112 |       {!isLoading && filteredClients.length === 0 ? (1113 |         <Card className="dashboard-card">1114 |           <CardContent className="p-12 text-center">1115 |             <Users size={48} className="mx-auto text-gray-400/50 mb-4" />1116 |             <h3 className="dashboard-text-primary text-lg font-semibold mb-2">No clients found</h3>1117 |             <p className="dashboard-text-secondary mb-4">1118 |               {searchQuery || statusFilter !== 'all' || languageFilter !== 'all' || dateFilter !== 'all'1119 |                 ? 'Try adjusting your filters or search terms.'1120 |                 : 'Get started by adding your first client.'}1121 |             </p>1122 |             {!searchQuery && statusFilter === 'all' && languageFilter === 'all' && dateFilter === 'all' && (1123 |               <BaseButton1124 |                 onClick={handleCreateClient}1125 |                 className="dashboard-button-primary"1126 |               >1127 |                 <Plus size={16} className="mr-2" />1128 |                 Add First Client1129 |               </BaseButton>1130 |             )}1131 |           </CardContent>1132 |         </Card>1133 |       ) : viewMode === 'list' ? (1134 |         <Card className="dashboard-card">1135 |           <CardContent className="p-0">1136 |             <div className="overflow-x-auto">1137 |               <table className="dashboard-table">1138 |                 <thead className="dashboard-table-header">1139 |                   <tr className="text-left">1140 |                     <th className="dashboard-table-header th">Client</th>1141 |                     <th className="dashboard-table-header th">Contact</th>1142 |                     <th className="dashboard-table-header th">Status</th>1143 |                     <th className="dashboard-table-header th">Bookings</th>1144 |                     <th className="dashboard-table-header th">Created</th>1145 |                     <th className="dashboard-table-header th">Actions</th>1146 |                   </tr>1147 |                 </thead>1148 |                 <tbody>1149 |                   {filteredClients.map((client) => (1150 |                     <tr key={client.id} className="dashboard-table-row">1151 |                       <td className="dashboard-table-row td">1152 |                         <div className="flex items-center space-x-3">1153 |                           <div className="w-10 h-10 bg-[#FFD700]/20 rounded-full flex items-center justify-center">1154 |                             <User size={16} className="text-[#FFD700]" />1155 |                           </div>1156 |                           <div>1157 |                             <p className="dashboard-text-primary font-medium">{client.fullName}</p>1158 |                             <p className="dashboard-text-secondary text-sm">1159 |                               {client.language === 'en' ? '🇺🇸' : '🇪🇸'} {client.birthPlace}1160 |                             </p>1161 |                           </div>1162 |                         </div>1163 |                       </td>1164 |                       <td className="dashboard-table-row td">1165 |                         <div>1166 |                           <p className="dashboard-text-primary">{client.email}</p>1167 |                           <p className="dashboard-text-secondary text-sm">1168 |                             Born: {formatDate(client.birthDate)}1169 |                           </p>1170 |                         </div>1171 |                       </td>1172 |                       <td className="dashboard-table-row td">1173 |                         {getStatusBadge(client.status)}1174 |                       </td>1175 |                       <td className="dashboard-table-row td">1176 |                         <div className="flex items-center space-x-2">1177 |                           <span className="dashboard-text-primary">{client.totalBookings || 0}</span>1178 |                           {client.isRecurrent && (1179 |                             <Star size={14} className="text-[#FFD700]" />1180 |                           )}1181 |                         </div>1182 |                       </td>1183 |                       <td className="dashboard-table-row td">1184 |                         <p className="dashboard-text-primary">1185 |                           {formatDate(client.createdAt)}1186 |                         </p>1187 |                       </td>1188 |                       <td className="dashboard-table-row td">1189 |                         <div className="flex items-center space-x-2">1190 |                           <BaseButton1191 |                             variant="outline"1192 |                             size="sm"1193 |                             onClick={() => handleViewClient(client)}1194 |                             className="dashboard-button-outline"1195 |                           >1196 |                             <Eye size={14} />1197 |                           </BaseButton>1198 |                           <BaseButton1199 |                             variant="outline"1200 |                             size="sm"1201 |                             onClick={() => handleEditClient(client)}1202 |                             className="dashboard-button-outline"1203 |                           >1204 |                             <Edit size={14} />1205 |                           </BaseButton>1206 |                           {(client.totalBookings || 0) > 0 && (1207 |                             <BaseButton1208 |                               variant="outline"1209 |                               size="sm"1210 |                               onClick={() => handleViewHistory(client)}1211 |                               className="dashboard-button-outline"1212 |                             >1213 |                               <History size={14} />1214 |                             </BaseButton>1215 |                           )}1216 |                           <BaseButton1217 |                             variant="outline"1218 |                             size="sm"1219 |                             onClick={() => handleDeleteClient(client)}1220 |                             className="dashboard-button-danger"1221 |                           >1222 |                             <Trash2 size={14} />1223 |                           </BaseButton>1224 |                         </div>1225 |                       </td>1226 |                     </tr>1227 |                   ))}1228 |                 </tbody>1229 |               </table>1230 |             </div>1231 |           </CardContent>1232 |         </Card>1233 |       ) : (1234 |         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">1235 |           {filteredClients.map((client) => (1236 |             <Card key={client.id} className="dashboard-card hover:border-[#ffd700]/30 transition-colors">1237 |               <CardContent className="p-6">1238 |                 <div className="flex items-start justify-between mb-4">1239 |                   <div className="flex items-center space-x-3">1240 |                     <div className="w-12 h-12 bg-[#FFD700]/20 rounded-full flex items-center justify-center">1241 |                       <User size={20} className="text-[#FFD700]" />1242 |                     </div>1243 |                     <div>1244 |                       <h3 className="dashboard-text-primary font-medium">{client.fullName}</h3>1245 |                       <p className="dashboard-text-secondary text-sm">1246 |                         {client.language === 'en' ? '🇺🇸' : '🇪🇸'} {client.email}1247 |                       </p>1248 |                     </div>1249 |                   </div>1250 |                   {client.isRecurrent && (1251 |                     <Star size={16} className="text-[#FFD700]" />1252 |                   )}1253 |                 </div>1254 | 1255 |                 <div className="space-y-3 mb-4">1256 |                   <div className="flex items-center justify-between">1257 |                     <span className="dashboard-text-secondary text-sm">Status:</span>1258 |                     {getStatusBadge(client.status)}1259 |                   </div>1260 |                   <div className="flex items-center justify-between">1261 |                     <span className="dashboard-text-secondary text-sm">Bookings:</span>1262 |                     <span className="dashboard-text-primary">{client.totalBookings || 0}</span>1263 |                   </div>1264 |                   <div className="flex items-center justify-between">1265 |                     <span className="dashboard-text-secondary text-sm">Birth Date:</span>1266 |                     <span className="dashboard-text-primary">1267 |                       {formatDate(client.birthDate)}1268 |                     </span>1269 |                   </div>1270 |                   {client.birthPlace && (1271 |                     <div className="flex items-center justify-between">1272 |                       <span className="dashboard-text-secondary text-sm">Birth Place:</span>1273 |                       <span className="dashboard-text-primary text-sm">{client.birthPlace}</span>1274 |                     </div>1275 |                   )}1276 |                 </div>1277 | 1278 |                 <div className="flex items-center space-x-2">1279 |                   <BaseButton1280 |                     variant="outline"1281 |                     size="sm"1282 |                     onClick={() => handleViewClient(client)}1283 |                     className="flex-1 dashboard-button-outline"1284 |                   >1285 |                     <Eye size={14} className="mr-2" />1286 |                     View1287 |                   </BaseButton>1288 |                   <BaseButton1289 |                     variant="outline"1290 |                     size="sm"1291 |                     onClick={() => handleCreateBooking(client)}1292 |                     className="dashboard-button-outline"1293 |                   >1294 |                     <Calendar size={14} className="mr-2" />1295 |                     Book1296 |                   </BaseButton>1297 |                   <BaseButton1298 |                     variant="outline"1299 |                     size="sm"1300 |                     onClick={() => handleEditClient(client)}1301 |                     className="dashboard-button-outline"1302 |                   >1303 |                     <Edit size={14} />1304 |                   </BaseButton>1305 |                   {(client.totalBookings || 0) > 0 && (1306 |                     <BaseButton1307 |                       variant="outline"1308 |                       size="sm"1309 |                       onClick={() => handleViewHistory(client)}1310 |                       className="dashboard-button-outline"1311 |                     >1312 |                       <History size={14} />1313 |                     </BaseButton>1314 |                   )}1315 |                   <BaseButton1316 |                     variant="outline"1317 |                     size="sm"1318 |                     onClick={() => handleDeleteClient(client)}1319 |                     className="dashboard-button-danger"1320 |                   >1321 |                     <Trash2 size={14} />1322 |                   </BaseButton>1323 |                 </div>1324 |               </CardContent>1325 |             </Card>1326 |           ))}1327 |         </div>1328 |       )}1329 | 1330 |       {}1331 |       <AnimatePresence>1332 |         {modalState.mode === 'history' ? (1333 |           <BookingHistoryModal1334 |             client={selectedClient}1335 |             isOpen={modalState.isOpen}1336 |             onClose={() => {1337 |               setModalState({ isOpen: false, mode: 'view' });1338 |               setSelectedClient(null);1339 |             }}1340 |           />1341 |         ) : (1342 |           <ClientModal1343 |             client={selectedClient}1344 |             isOpen={modalState.isOpen}1345 |             mode={modalState.mode as 'create' | 'edit' | 'view'}1346 |             onClose={() => {1347 |               setModalState({ isOpen: false, mode: 'view' });1348 |               setSelectedClient(null);1349 |             }}1350 |             onSave={handleSaveClient}1351 |           />1352 |         )}1353 |       </AnimatePresence>1354 | 1355 |       {}1356 |       {selectedClientForBooking && (1357 |         <CreateBookingModal1358 |           isOpen={showCreateBookingModal}1359 |           onClose={() => {1360 |             setShowCreateBookingModal(false);1361 |             setSelectedClientForBooking(null);1362 |           }}1363 |           client={selectedClientForBooking}1364 |           onSuccess={() => {1365 | 1366 |             loadClients();1367 |           }}1368 |         />1369 |       )}1370 |     </div>1371 |   );1372 | }
============================================================END: frontend/components/ClientManagement.tsx============================================================


============================================================FILE: frontend/components/ConstellationBackground.tsxSIZE: 16.86 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useMemo } from 'react';  4 | import { motion } from 'framer-motion';  5 |   6 | export function ConstellationBackground() {  7 |   8 |   const generateStars = (count: number, type: 'small' | 'medium' | 'large' | 'cosmic') => {  9 |     return [...Array(count)].map((_, i) => { 10 |       const seed = i * 1000 + (type === 'small' ? 0 : type === 'medium' ? 100 : type === 'large' ? 200 : 250); 11 |       const random = (min: number, max: number) => { 12 |         const x = Math.sin(seed) * 10000; 13 |         const result = min + (x - Math.floor(x)) * (max - min); 14 |  15 |         return Math.round(result * 10000) / 10000; 16 |       }; 17 |  18 |       return { 19 |         id: i, 20 |         x: random(0, 100), 21 |         y: random(0, 100), 22 |         size: type === 'small' ? random(1, 3) : type === 'medium' ? random(3, 6) : type === 'large' ? random(6, 10) : random(10, 15), 23 |         brightness: random(0.3, 1), 24 |         speed: random(0.5, 2), 25 |         direction: random(0, 360), 26 |         pulseDuration: random(2, 6), 27 |         delay: random(0, 5), 28 |         type 29 |       }; 30 |     }); 31 |   }; 32 |  33 |   const generateOrbitals = (count: number) => { 34 |     return [...Array(count)].map((_, i) => { 35 |       const seed = i * 1000 + 100; 36 |       const random = (min: number, max: number) => { 37 |         const x = Math.sin(seed) * 10000; 38 |         const result = min + (x - Math.floor(x)) * (max - min); 39 |  40 |         return Math.round(result * 10000) / 10000; 41 |       }; 42 |  43 |       return { 44 |         id: i, 45 |         centerX: random(20, 80), 46 |         centerY: random(20, 80), 47 |         radius: random(15, 40), 48 |         speed: random(0.5, 2), 49 |         startAngle: random(0, 360), 50 |         size: random(2, 6), 51 |         opacity: random(0.3, 0.8), 52 |         color: `hsl(${random(200, 280)}, 70%, 60%)` 53 |       }; 54 |     }); 55 |   }; 56 |  57 |   const generateShootingStars = (count: number) => { 58 |     return [...Array(count)].map((_, i) => { 59 |       const seed = i * 1000 + 200; 60 |       const random = (min: number, max: number) => { 61 |         const x = Math.sin(seed) * 10000; 62 |         const result = min + (x - Math.floor(x)) * (max - min); 63 |  64 |         return Math.round(result * 10000) / 10000; 65 |       }; 66 |  67 |       return { 68 |         id: i, 69 |         startX: random(0, 100), 70 |         startY: random(0, 100), 71 |         endX: random(0, 100), 72 |         endY: random(0, 100), 73 |         duration: random(3, 8), 74 |         delay: random(0, 10), 75 |         size: random(2, 5) 76 |       }; 77 |     }); 78 |   }; 79 |  80 |   const smallStars = useMemo(() => generateStars(60, 'small'), []); 81 |   const mediumStars = useMemo(() => generateStars(25, 'medium'), []); 82 |   const largeStars = useMemo(() => generateStars(12, 'large'), []); 83 |   const cosmicStars = useMemo(() => generateStars(8, 'cosmic'), []); 84 |  85 |   const orbitals = useMemo(() => generateOrbitals(15), []); 86 |   const shootingStars = useMemo(() => generateShootingStars(6), []); 87 |  88 |   const nebulaData = useMemo(() => { 89 |     return [...Array(8)].map((_, i) => { 90 |       const seed = i * 1000 + 300; 91 |       const random = (min: number, max: number) => { 92 |         const x = Math.sin(seed) * 10000; 93 |         const result = min + (x - Math.floor(x)) * (max - min); 94 |  95 |         return Math.round(result * 10000) / 10000; 96 |       }; 97 |  98 |       return { 99 |         id: i,100 |         x: random(0, 100),101 |         y: random(0, 100),102 |         width: random(20, 60),103 |         height: random(20, 60),104 |         duration: random(8, 15)105 |       };106 |     });107 |   }, []);108 | 109 |   const trailData = useMemo(() => {110 |     return [...Array(12)].map((_, i) => {111 |       const seed = i * 1000 + 400;112 |       const random = (min: number, max: number) => {113 |         const x = Math.sin(seed) * 10000;114 |         const result = min + (x - Math.floor(x)) * (max - min);115 | 116 |         return Math.round(result * 10000) / 10000;117 |       };118 | 119 |       return {120 |         id: i,121 |         x: random(0, 100),122 |         y: random(0, 100),123 |         duration: random(5, 12)124 |       };125 |     });126 |   }, []);127 | 128 |   const interactiveData = useMemo(() => {129 |     return [...Array(20)].map((_, i) => {130 |       const seed = i * 1000 + 500;131 |       const random = (min: number, max: number) => {132 |         const x = Math.sin(seed) * 10000;133 |         const result = min + (x - Math.floor(x)) * (max - min);134 | 135 |         return Math.round(result * 10000) / 10000;136 |       };137 | 138 |       return {139 |         id: i,140 |         x: random(0, 100),141 |         y: random(0, 100),142 |         size: random(3, 8),143 |         color: `hsl(${random(200, 280)}, 70%, 60%)`,144 |         shadowSize: random(10, 25),145 |         duration: random(3, 8)146 |       };147 |     });148 |   }, []);149 | 150 |   return (151 |     <div className="fixed inset-0 overflow-hidden pointer-events-none">152 |       {}153 |       <div className="absolute inset-0 opacity-15">154 |         {smallStars.map((star) => (155 |           <motion.div156 |             key={`small-${star.id}`}157 |             className="absolute bg-white rounded-full"158 |             style={{159 |               left: `${Math.round(star.x * 100) / 100}%`,160 |               top: `${Math.round(star.y * 100) / 100}%`,161 |               width: `${Math.round(star.size * 100) / 100}px`,162 |               height: `${Math.round(star.size * 100) / 100}px`,163 |             }}164 |             animate={{165 |               opacity: [star.brightness * 0.3, star.brightness, star.brightness * 0.3],166 |               scale: [0.8, 1.3, 0.8],167 |               x: [0, Math.sin(star.direction) * 5, 0],168 |               y: [0, Math.cos(star.direction) * 3, 0],169 |             }}170 |             transition={{171 |               duration: star.pulseDuration,172 |               repeat: Infinity,173 |               delay: star.delay,174 |               ease: "easeInOut"175 |             }}176 |           />177 |         ))}178 |       </div>179 | 180 |       {}181 |       <div className="absolute inset-0 opacity-25">182 |         {mediumStars.map((star) => (183 |           <motion.div184 |             key={`medium-${star.id}`}185 |             className="absolute bg-white rounded-full shadow-sm"186 |             style={{187 |               left: `${Math.round(star.x * 100) / 100}%`,188 |               top: `${Math.round(star.y * 100) / 100}%`,189 |               width: `${Math.round(star.size * 100) / 100}px`,190 |               height: `${Math.round(star.size * 100) / 100}px`,191 |               filter: 'blur(0.5px)',192 |             }}193 |             animate={{194 |               opacity: [star.brightness * 0.2, star.brightness * 0.8, star.brightness * 0.2],195 |               scale: [1, 1.4, 1],196 |               x: [0, Math.sin(star.direction) * 8, Math.sin(star.direction + 90) * 4, 0],197 |               y: [0, Math.cos(star.direction) * 6, Math.cos(star.direction + 90) * 3, 0],198 |             }}199 |             transition={{200 |               duration: star.pulseDuration,201 |               repeat: Infinity,202 |               delay: star.delay,203 |               ease: "easeInOut"204 |             }}205 |           />206 |         ))}207 |       </div>208 | 209 |       {}210 |       <div className="absolute inset-0 opacity-35">211 |         {largeStars.map((star) => {212 |           const isGolden = (star.id % 5) === 0;213 |           return (214 |             <motion.div215 |               key={`large-${star.id}`}216 |               className="absolute rounded-full"217 |               style={{218 |                 left: `${Math.round(star.x * 100) / 100}%`,219 |                 top: `${Math.round(star.y * 100) / 100}%`,220 |                 width: `${Math.round(star.size * 100) / 100}px`,221 |                 height: `${Math.round(star.size * 100) / 100}px`,222 |                 background: isGolden ? '#FFD700' : '#FFFFFF',223 |                 boxShadow: `0 0 ${Math.round(star.size * 2 * 100) / 100}px rgba(255, 215, 0, 0.3)`,224 |                 filter: 'blur(0.5px)',225 |               }}226 |               animate={{227 |                 opacity: [star.brightness * 0.4, star.brightness, star.brightness * 0.4],228 |                 scale: [1, 1.6, 1],229 |                 x: [0, Math.sin(star.direction) * 12, Math.sin(star.direction + 180) * 6, 0],230 |                 y: [0, Math.cos(star.direction) * 10, Math.cos(star.direction + 180) * 5, 0],231 |                 rotate: [0, 360],232 |               }}233 |               transition={{234 |                 duration: star.pulseDuration,235 |                 repeat: Infinity,236 |                 delay: star.delay,237 |                 ease: "easeInOut"238 |               }}239 |             />240 |           );241 |         })}242 |       </div>243 | 244 |       {}245 |       <div className="absolute inset-0 opacity-20">246 |         {cosmicStars.map((star) => (247 |           <motion.div248 |             key={`cosmic-${star.id}`}249 |             className="absolute rounded-full"250 |             style={{251 |               left: `${Math.round(star.x * 100) / 100}%`,252 |               top: `${Math.round(star.y * 100) / 100}%`,253 |               width: `${Math.round(star.size * 100) / 100}px`,254 |               height: `${Math.round(star.size * 100) / 100}px`,255 |               background: 'radial-gradient(circle, #FFD700 0%, rgba(255, 215, 0, 0.3) 70%, transparent 100%)',256 |               filter: 'blur(1px)',257 |             }}258 |             animate={{259 |               opacity: [0.1, 0.6, 0.1],260 |               scale: [0.5, 2, 0.5],261 |               x: [0, Math.sin(star.direction) * 20, Math.sin(star.direction + 120) * 15, Math.sin(star.direction + 240) * 10, 0],262 |               y: [0, Math.cos(star.direction) * 15, Math.cos(star.direction + 120) * 12, Math.cos(star.direction + 240) * 8, 0],263 |             }}264 |             transition={{265 |               duration: star.pulseDuration * 1.5,266 |               repeat: Infinity,267 |               delay: star.delay,268 |               ease: "easeInOut"269 |             }}270 |           />271 |         ))}272 |       </div>273 | 274 |       {}275 |       <div className="absolute inset-0 opacity-10">276 |         {orbitals.map((orbital) => (277 |           <motion.div278 |             key={`orbital-${orbital.id}`}279 |             className="absolute rounded-full"280 |             style={{281 |               width: `${Math.round(orbital.size * 100) / 100}px`,282 |               height: `${Math.round(orbital.size * 100) / 100}px`,283 |               background: orbital.color,284 |               boxShadow: `0 0 ${Math.round(orbital.size * 2 * 100) / 100}px ${orbital.color}`,285 |             }}286 |             animate={{287 |               x: [288 |                 Math.round((orbital.centerX + orbital.radius * Math.cos((orbital.startAngle * Math.PI) / 180)) * 100) / 100,289 |                 Math.round((orbital.centerX + orbital.radius * Math.cos(((orbital.startAngle + 90) * Math.PI) / 180)) * 100) / 100,290 |                 Math.round((orbital.centerX + orbital.radius * Math.cos(((orbital.startAngle + 180) * Math.PI) / 180)) * 100) / 100,291 |                 Math.round((orbital.centerX + orbital.radius * Math.cos(((orbital.startAngle + 270) * Math.PI) / 180)) * 100) / 100,292 |                 Math.round((orbital.centerX + orbital.radius * Math.cos((orbital.startAngle * Math.PI) / 180)) * 100) / 100,293 |               ],294 |               y: [295 |                 Math.round((orbital.centerY + orbital.radius * Math.sin((orbital.startAngle * Math.PI) / 180)) * 100) / 100,296 |                 Math.round((orbital.centerY + orbital.radius * Math.sin(((orbital.startAngle + 90) * Math.PI) / 180)) * 100) / 100,297 |                 Math.round((orbital.centerY + orbital.radius * Math.sin(((orbital.startAngle + 180) * Math.PI) / 180)) * 100) / 100,298 |                 Math.round((orbital.centerY + orbital.radius * Math.sin(((orbital.startAngle + 270) * Math.PI) / 180)) * 100) / 100,299 |                 Math.round((orbital.centerY + orbital.radius * Math.sin((orbital.startAngle * Math.PI) / 180)) * 100) / 100,300 |               ],301 |               opacity: [orbital.opacity * 0.3, orbital.opacity, orbital.opacity * 0.3],302 |             }}303 |             transition={{304 |               duration: 15 + orbital.speed * 10,305 |               repeat: Infinity,306 |               ease: "linear",307 |               delay: orbital.id * 0.5,308 |             }}309 |           />310 |         ))}311 |       </div>312 | 313 |       {}314 |       <div className="absolute inset-0 opacity-40">315 |         {shootingStars.map((star) => (316 |           <motion.div317 |             key={`shooting-${star.id}`}318 |             className="absolute"319 |             style={{320 |               left: `${star.startX}%`,321 |               top: `${star.startY}%`,322 |             }}323 |             animate={{324 |               x: [`0%`, `${star.endX - star.startX}%`],325 |               y: [`0%`, `${star.endY - star.startY}%`],326 |               opacity: [0, 1, 0.8, 0],327 |             }}328 |             transition={{329 |               duration: star.duration,330 |               repeat: Infinity,331 |               delay: star.delay,332 |               ease: "easeOut",333 |               repeatDelay: 10 + (star.id % 10),334 |             }}335 |           >336 |             <div337 |               className="w-1 h-1 bg-gradient-to-r from-transparent via-white to-transparent rounded-full"338 |               style={{339 |                 width: `${Math.round((20 + star.size * 10) * 100) / 100}px`,340 |                 height: `${Math.round(star.size * 100) / 100}px`,341 |                 boxShadow: `0 0 ${Math.round(star.size * 3 * 100) / 100}px rgba(255, 255, 255, 0.6)`,342 |                 filter: 'blur(0.5px)',343 |               }}344 |             />345 |           </motion.div>346 |         ))}347 |       </div>348 | 349 |       {}350 |       <div className="absolute inset-0 opacity-5">351 |         {nebulaData.map((nebula) => (352 |           <motion.div353 |             key={`nebula-${nebula.id}`}354 |             className="absolute rounded-full"355 |             style={{356 |               left: `${nebula.x}%`,357 |               top: `${nebula.y}%`,358 |               width: `${nebula.width}px`,359 |               height: `${nebula.height}px`,360 |               background: `radial-gradient(ellipse,361 |                 rgba(255, 215, 0, 0.1) 0%,362 |                 rgba(192, 192, 192, 0.05) 30%,363 |                 rgba(25, 25, 112, 0.03) 60%,364 |                 transparent 100%)`,365 |               filter: 'blur(3px)',366 |             }}367 |             animate={{368 |               scale: [1, 1.2, 0.9, 1],369 |               opacity: [0.3, 0.6, 0.4, 0.3],370 |               rotate: [0, 180, 360],371 |             }}372 |             transition={{373 |               duration: nebula.duration,374 |               repeat: Infinity,375 |               delay: nebula.id * 2,376 |               ease: "easeInOut"377 |             }}378 |           />379 |         ))}380 |       </div>381 | 382 |       {}383 |       <div className="absolute inset-0 opacity-8">384 |         {trailData.map((trail) => (385 |           <motion.div386 |             key={`trail-${trail.id}`}387 |             className="absolute"388 |             style={{389 |               left: `${trail.x}%`,390 |               top: `${trail.y}%`,391 |             }}392 |           >393 |             {[...Array(5)].map((_, j) => (394 |               <motion.div395 |                 key={j}396 |                 className="absolute w-0.5 h-0.5 bg-white rounded-full"397 |                 style={{398 |                   left: `${j * 3}px`,399 |                   top: `${j * 2}px`,400 |                 }}401 |                 animate={{402 |                   opacity: [0, 0.6, 0],403 |                   scale: [0.5, 1, 0.5],404 |                   x: [0, Math.sin(trail.id * 30) * 15, 0],405 |                   y: [0, Math.cos(trail.id * 30) * 10, 0],406 |                 }}407 |                 transition={{408 |                   duration: trail.duration,409 |                   repeat: Infinity,410 |                   delay: j * 0.3 + trail.id * 0.5,411 |                   ease: "easeInOut"412 |                 }}413 |               />414 |             ))}415 |           </motion.div>416 |         ))}417 |       </div>418 | 419 |       {}420 |       <div className="absolute inset-0 opacity-15">421 |         {interactiveData.map((particle) => (422 |           <motion.div423 |             key={`interactive-${particle.id}`}424 |             className="absolute rounded-full"425 |             style={{426 |               left: `${particle.x}%`,427 |               top: `${particle.y}%`,428 |               width: `${particle.size}px`,429 |               height: `${particle.size}px`,430 |               background: particle.color,431 |               boxShadow: `0 0 ${particle.shadowSize}px rgba(255, 215, 0, 0.4)`,432 |             }}433 |             animate={{434 |               opacity: [0.2, 0.8, 0.2],435 |               scale: [0.8, 1.5, 0.8],436 |               x: [0, Math.sin(particle.id * 45) * 10, Math.sin(particle.id * 90) * 15, 0],437 |               y: [0, Math.cos(particle.id * 45) * 8, Math.cos(particle.id * 90) * 12, 0],438 |               rotate: [0, 180, 360],439 |             }}440 |             transition={{441 |               duration: particle.duration,442 |               repeat: Infinity,443 |               delay: particle.id * 0.2,444 |               ease: "easeInOut"445 |             }}446 |             whileHover={{447 |               scale: 2,448 |               opacity: 1,449 |               transition: { duration: 0.3 }450 |             }}451 |           />452 |         ))}453 |       </div>454 |     </div>455 |   );456 | }
============================================================END: frontend/components/ConstellationBackground.tsx============================================================


============================================================FILE: frontend/components/ContentManagement.tsxSIZE: 22.01 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect, useCallback, useRef } from 'react';  4 | import { Settings, FileText, Globe, RefreshCw, Save, AlertCircle, Loader2, Database } from 'lucide-react';  5 | import { BaseButton } from './ui/BaseButton';  6 | import { useAuth } from '../hooks/useAuth';  7 |   8 | import { SectionConfig, DEFAULT_SECTIONS } from '@/lib/content-config';  9 | import { CMSTabs } from './cms/CMSTabs'; 10 | import { ContentEditor } from './cms/ContentEditor'; 11 | import { SectionManager } from './cms/SectionManager'; 12 | import { TranslationManager } from './cms/TranslationManager'; 13 | import { useToast, ToastContainer } from './cms/Toast'; 14 | import { CMSButton } from './cms/CMSButton'; 15 |  16 | interface ContentStructure { 17 |   [key: string]: string | Record<string, string>; 18 | } 19 |  20 | interface ContentManagementProps { 21 |   onClose?: () => void; 22 | } 23 |  24 | const DEFAULT_CONTENT: ContentStructure = { 25 |   heroTitleEn: 'MatMax Yoga Studio', 26 |   heroTitleEs: 'MatMax Yoga Studio', 27 |   heroSubtitleEn: 'Your journey to wellness starts here', 28 |   heroSubtitleEs: 'Tu camino al bienestar comienza aquí', 29 |   aboutTitleEn: 'About Us', 30 |   aboutTitleEs: 'Sobre Nosotros', 31 |   aboutContentEn: 'We are dedicated to helping you achieve your wellness goals.', 32 |   aboutContentEs: 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.', 33 |   approachTitleEn: 'Our Approach', 34 |   approachTitleEs: 'Nuestro Enfoque', 35 |   approachContentEn: 'We use a holistic approach to wellness.', 36 |   approachContentEs: 'Usamos un enfoque holístico para el bienestar.', 37 |   servicesTitleEn: 'Our Services', 38 |   servicesTitleEs: 'Nuestros Servicios', 39 |   servicesContentEn: 'Professional wellness services in a peaceful environment.', 40 |   servicesContentEs: 'Servicios profesionales de bienestar en un ambiente pacífico.' 41 | }; 42 |  43 | export function ContentManagement({ }: ContentManagementProps) { 44 |   const { user } = useAuth(); 45 |   const { toasts, showSuccess, showError, showWarning } = useToast(); 46 |  47 |   const [content, setContent] = useState<ContentStructure>(DEFAULT_CONTENT); 48 |   const [sections, setSections] = useState<SectionConfig[]>(DEFAULT_SECTIONS); 49 |   const [isLoading, setIsLoading] = useState(true); 50 |   const [isSaving, setIsSaving] = useState(false); 51 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null); 52 |   const [activeTab, setActiveTab] = useState<'content' | 'sections' | 'i18n'>('content'); 53 |   const [lastSaved, setLastSaved] = useState<Date | null>(null); 54 |   const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false); 55 |   const [error, setError] = useState<string | null>(null); 56 |   const [retryCount, setRetryCount] = useState(0); 57 |   const isLoadingRef = useRef(false); 58 |  59 |   const loadContent = useCallback(async () => { 60 |     try { 61 |       if (!user?.access_token) { 62 |         setError('Authentication required to load content'); 63 |         return; 64 |       } 65 |  66 |       const controller = new AbortController(); 67 |       const timeoutId = setTimeout(() => controller.abort(), 10000); 68 |  69 |       const response = await fetch('/api/admin/content', { 70 |         signal: controller.signal, 71 |         headers: { 72 |           'Authorization': `Bearer ${user.access_token}`, 73 |           'Content-Type': 'application/json' 74 |         } 75 |       }); 76 |  77 |       clearTimeout(timeoutId); 78 |  79 |       if (!response.ok) { 80 |         throw new Error(`HTTP ${response.status}: ${response.statusText}`); 81 |       } 82 |  83 |       const data = await response.json(); 84 |  85 |       if (data.success && data.content && typeof data.content === 'object') { 86 |         .length, 'fields'); 87 |         setContent({ ...DEFAULT_CONTENT, ...data.content }); 88 |         setHasUnsavedChanges(false); 89 |         setLastLoaded(new Date()); 90 |         setError(null); 91 |         setRetryCount(0); 92 |  93 |         if (lastLoaded) { 94 |           showSuccess('Content Refreshed', 'Content data has been updated successfully.', 3000); 95 |         } 96 |  97 |         if (data.isDefault) { 98 |           '); 99 |         }100 |       } else {101 |         throw new Error(data.message || 'Invalid API response format');102 |       }103 |     } catch (error) {104 |       if (error instanceof Error && error.name === 'AbortError') {105 |         setError('Request timeout - please try again');106 |         showError('Timeout', 'Request timed out. Please try again.', 5000);107 |       } else {108 |         setError('Failed to load content data');109 |         showError('Load Failed', 'Failed to load content from server.', 5000);110 |       }111 | 112 |       setContent(prev => Object.keys(prev).length > 0 ? prev : DEFAULT_CONTENT);113 |     }114 |   }, [user?.access_token, showError, showSuccess, lastLoaded]);115 | 116 |   const loadSections = useCallback(async () => {117 |     try {118 |       const controller = new AbortController();119 |       const timeoutId = setTimeout(() => controller.abort(), 8000);120 | 121 |       const response = await fetch('/api/sections', {122 |         signal: controller.signal,123 |         headers: {124 |           'Content-Type': 'application/json'125 |         }126 |       });127 | 128 |       clearTimeout(timeoutId);129 | 130 |       if (!response.ok) {131 |         throw new Error(`HTTP ${response.status}: ${response.statusText}`);132 |       }133 | 134 |       const data = await response.json();135 | 136 |       if (data.success && data.sections && Array.isArray(data.sections)) {137 |         setSections(data.sections);138 |         setError(null);139 | 140 |         if (data.source) {141 |           }142 |         if (data.message) {143 |           }144 |       } else {145 |         throw new Error(data.message || 'Invalid API response format');146 |       }147 |     } catch (error) {148 |       if (error instanceof Error && error.name === 'AbortError') {149 |         showWarning('Timeout', 'Request timed out loading sections.', 4000);150 |       } else {151 |         showWarning('Sections Warning', 'Using default section configuration.', 4000);152 |       }153 | 154 |       setSections(prev => prev.length > 0 ? prev : DEFAULT_SECTIONS);155 |     }156 |   }, [showWarning]);157 | 158 |   const fetchAllData = useCallback(async () => {159 | 160 |     if (isLoadingRef.current) {161 |       return;162 |     }163 | 164 |     try {165 |       if (!user?.access_token) {166 |         setError('Authentication required');167 |         setIsLoading(false);168 |         return;169 |       }170 | 171 |       isLoadingRef.current = true;172 |       setIsLoading(true);173 |       setError(null);174 | 175 |       const loadPromise = Promise.allSettled([176 |         loadContent(),177 |         loadSections()178 |       ]);179 | 180 |       const results = await loadPromise;181 | 182 |       const failures = results.filter(result => result.status === 'rejected');183 |       if (failures.length > 0) {184 |         }185 | 186 |       const successes = results.filter(result => result.status === 'fulfilled');187 |       if (successes.length > 0) {188 |         setRetryCount(0);189 |       }190 | 191 |       setLastLoaded(new Date());192 | 193 |     } catch (error) {194 |       setError('Failed to load data');195 |       showError('Data Load Error', 'Failed to load content data. Please try again.', 5000);196 |     } finally {197 |       isLoadingRef.current = false;198 |       setIsLoading(false);199 |     }200 |   }, [user?.access_token, loadContent, loadSections, showError]);201 | 202 |   const refreshContentData = useCallback(() => {203 |     if (user?.access_token) {204 |       setRetryCount(prev => prev + 1);205 |       fetchAllData();206 |     } else {207 |       }208 |   }, [user?.access_token, fetchAllData]);209 | 210 |   useEffect(() => {211 |     if (user?.access_token && !lastLoaded && !isLoadingRef.current) {212 |       fetchAllData();213 |     } else if (!user?.access_token && lastLoaded) {214 |       setContent(DEFAULT_CONTENT);215 |       setSections(DEFAULT_SECTIONS);216 |       setIsLoading(false);217 |       setError('Authentication required');218 |       setLastLoaded(null);219 |     }220 |   }, [user?.access_token, lastLoaded, fetchAllData]);221 | 222 |   useEffect(() => {223 |     const handleVisibilityChange = () => {224 |       if (document.visibilityState === 'visible' && user?.access_token && lastLoaded && !isLoadingRef.current) {225 |         const timeSinceLastLoad = Date.now() - lastLoaded.getTime();226 | 227 |         if (timeSinceLastLoad > 5 * 60 * 1000) {228 |           fetchAllData();229 |         }230 |       }231 |     };232 | 233 |     document.addEventListener('visibilitychange', handleVisibilityChange);234 |     return () => document.removeEventListener('visibilitychange', handleVisibilityChange);235 |   }, [user?.access_token, lastLoaded, fetchAllData]);236 | 237 |   useEffect(() => {238 | 239 |     window.refreshContentData = refreshContentData;240 | 241 |     return () => {242 | 243 |       delete window.refreshContentData;244 |     };245 |   }, [refreshContentData]);246 | 247 |   const saveContent = useCallback(async () => {248 |     if (!user?.access_token) {249 |       showError('Authentication Error', 'Please log in to save content.', 6000);250 |       return;251 |     }252 | 253 |     try {254 |       setIsSaving(true);255 |       setError(null);256 | 257 |       const controller = new AbortController();258 |       const timeoutId = setTimeout(() => controller.abort(), 15000);259 | 260 |       const response = await fetch('/api/admin/content', {261 |         method: 'PUT',262 |         signal: controller.signal,263 |         headers: {264 |           'Authorization': `Bearer ${user.access_token}`,265 |           'Content-Type': 'application/json'266 |         },267 |         body: JSON.stringify({ content })268 |       });269 | 270 |       clearTimeout(timeoutId);271 | 272 |       if (!response.ok) {273 |         const errorData = await response.json();274 |         throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);275 |       }276 | 277 |       const savedData = await response.json();278 | 279 |       if (savedData.success && savedData.content) {280 |         setContent(savedData.content);281 |         setLastSaved(new Date());282 |         setHasUnsavedChanges(false);283 |         setError(null);284 | 285 |         showSuccess('Content Saved!', savedData.message || 'Your changes have been saved successfully.', 4000);286 | 287 |         if (savedData.processingTime) {288 |           }289 | 290 |         } else {291 |         throw new Error(savedData.message || 'Invalid API response format');292 |       }293 | 294 |     } catch (error) {295 |       if (error instanceof Error && error.name === 'AbortError') {296 |         setError('Save request timed out');297 |         showError('Timeout', 'Save request timed out. Please try again.', 5000);298 |       } else {299 |         const errorMessage = error instanceof Error ? error.message : 'Unknown error';300 |         setError(`Save failed: ${errorMessage}`);301 |         showError('Save Failed', `Failed to save content: ${errorMessage}`, 6000);302 |       }303 |     } finally {304 |       setIsSaving(false);305 |     }306 |   }, [user?.access_token, content, showError, showSuccess]);307 | 308 |   const handleContentChange = useCallback((newContent: ContentStructure) => {309 |     setContent(newContent);310 |     setHasUnsavedChanges(true);311 |     setError(null);312 |   }, []);313 | 314 |   const handleSectionsChange = useCallback((newSections: SectionConfig[]) => {315 |     setSections(newSections);316 |     setHasUnsavedChanges(true);317 |   }, []);318 | 319 |   const handleTabChange = useCallback((tabId: string) => {320 |     if (hasUnsavedChanges) {321 |       const confirmed = window.confirm(322 |         'You have unsaved changes. Are you sure you want to switch tabs? Your changes will be lost.'323 |       );324 |       if (!confirmed) return;325 |       setHasUnsavedChanges(false);326 |     }327 |     setActiveTab(tabId as 'content' | 'sections' | 'i18n');328 |   }, [hasUnsavedChanges]);329 | 330 |   const handleRefresh = useCallback(async () => {331 |     if (hasUnsavedChanges) {332 |       const confirmed = window.confirm(333 |         'You have unsaved changes. Refreshing will discard them. Continue?'334 |       );335 |       if (!confirmed) return;336 |     }337 | 338 |     setError(null);339 |     await fetchAllData();340 |     setHasUnsavedChanges(false);341 |   }, [hasUnsavedChanges, fetchAllData]);342 | 343 |   const handleRetry = useCallback(() => {344 |     setRetryCount(prev => prev + 1);345 |     fetchAllData();346 |   }, [fetchAllData]);347 | 348 |   if (isLoading && !lastLoaded) {349 |     return (350 |       <div className="flex items-center justify-center min-h-[400px]">351 |         <div className="text-center">352 |           <Loader2 className="w-16 h-16 animate-spin mx-auto mb-4 text-[#FFD700]" />353 |           <p className="text-[#FFD700] text-lg font-semibold">Loading Content Management</p>354 |           <p className="text-gray-400 text-sm mt-2">355 |             {retryCount > 0 ? `Retrying... (attempt ${retryCount + 1})` : 'Fetching data from server...'}356 |           </p>357 |         </div>358 |       </div>359 |     );360 |   }361 | 362 |   if (error && !isLoading) {363 |     return (364 |       <div className="flex items-center justify-center min-h-[400px]">365 |         <div className="text-center max-w-md">366 |           <AlertCircle className="w-16 h-16 mx-auto mb-4 text-red-500" />367 |           <h2 className="text-xl font-semibold text-white mb-2">Content Loading Error</h2>368 |           <p className="text-gray-400 text-sm mb-6">{error}</p>369 |           <div className="flex gap-3 justify-center">370 |             <BaseButton371 |               variant="outline"372 |               onClick={handleRetry}373 |               className="dashboard-button-outline"374 |             >375 |               <RefreshCw className="w-4 h-4 mr-2" />376 |               Retry377 |             </BaseButton>378 |             <BaseButton379 |               variant="outline"380 |               onClick={refreshContentData}381 |               className="dashboard-button-outline"382 |             >383 |               <Database className="w-4 h-4 mr-2" />384 |               Refresh All385 |             </BaseButton>386 |           </div>387 |         </div>388 |       </div>389 |     );390 |   }391 | 392 |   const tabs = [393 |     {394 |       id: 'content',395 |       label: 'Content Editor',396 |       icon: <FileText size={16} />,397 |       content: (398 |         <ContentEditor399 |           content={content}400 |           onContentChange={handleContentChange}401 |           onSave={saveContent}402 |           onRefresh={handleRefresh}403 |           isLoading={isLoading}404 |           isSaving={isSaving}405 |         />406 |       )407 |     },408 |     {409 |       id: 'sections',410 |       label: 'Section Management',411 |       icon: <Settings size={16} />,412 |       content: (413 |         <SectionManager414 |           sections={sections}415 |           onSectionsChange={handleSectionsChange}416 |         />417 |       )418 |     },419 |     {420 |       id: 'i18n',421 |       label: 'Translation Manager',422 |       icon: <Globe size={16} />,423 |       content: (424 |         <TranslationManager425 |           content={content}426 |           onContentChange={handleContentChange}427 |           onSave={saveContent}428 |           onRefresh={handleRefresh}429 |           isLoading={isLoading}430 |           isSaving={isSaving}431 |         />432 |       )433 |     }434 |   ];435 | 436 |   if (!user?.access_token && !lastLoaded) {437 |     return (438 |       <div className="min-h-screen bg-[#0A0A23] flex items-center justify-center">439 |         <div className="text-center">440 |           <Loader2 className="w-12 h-12 animate-spin mx-auto mb-4 text-[#FFD700]" />441 |           <p className="text-[#EAEAEA] text-lg">Authenticating...</p>442 |           <p className="text-[#9CA3AF] text-sm mt-2">Please wait while we verify your session</p>443 |         </div>444 |       </div>445 |     );446 |   }447 | 448 |   return (449 |     <div className="dashboard-container p-6 space-y-6">450 |       <div className="max-w-7xl mx-auto">451 |         {}452 |         <div className="mb-8">453 |           <div className="flex items-center justify-between mb-4">454 |             <div>455 |               <h1 className="dashboard-text-primary text-3xl font-bold mb-2">Content Management System</h1>456 |               <p className="dashboard-text-secondary">Manage your website content, sections, and translations with ISR support</p>457 |               {lastLoaded && (458 |                 <p className="dashboard-text-muted text-sm mt-1">459 |                   Last loaded: {lastLoaded.toLocaleString()}460 |                 </p>461 |               )}462 |               {retryCount > 0 && (463 |                 <p className="dashboard-text-muted text-sm mt-1">464 |                   Retry attempts: {retryCount}465 |                 </p>466 |               )}467 |             </div>468 | 469 |             <div className="flex items-center space-x-4">470 |               <BaseButton471 |                 variant="outline"472 |                 className="dashboard-button-outline"473 |                 onClick={refreshContentData}474 |                 disabled={isLoading}475 |               >476 |                 <RefreshCw className={`w-4 h-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />477 |                 Refresh478 |               </BaseButton>479 | 480 |               {hasUnsavedChanges && (481 |                 <div className="flex items-center space-x-2 px-3 py-2 bg-[#FFD700]/20 border border-[#FFD700]/30 rounded-lg">482 |                   <AlertCircle size={16} className="text-[#FFD700]" />483 |                   <span className="text-[#FFD700] text-sm font-medium">Unsaved changes</span>484 |                 </div>485 |               )}486 | 487 |               {lastSaved && (488 |                 <div className="text-right">489 |                   <p className="text-[#9CA3AF] text-sm">Last saved</p>490 |                   <p className="text-[#EAEAEA] text-sm font-medium">491 |                     {lastSaved.toLocaleString()}492 |                   </p>493 |                 </div>494 |               )}495 |             </div>496 |           </div>497 | 498 |           {}499 |           <div className="bg-[#1A1A2E] p-4 rounded-lg border border-[#2D2D44]">500 |             <div className="flex items-center justify-between">501 |               <div className="flex items-center space-x-6">502 |                 <div className="flex items-center space-x-2">503 |                   <div className={`w-3 h-3 rounded-full ${user?.access_token ? 'bg-[#10B981]' : 'bg-red-500'}`}></div>504 |                   <span className="text-[#EAEAEA] text-sm">505 |                     {user?.access_token ? 'Authenticated' : 'Not Authenticated'}506 |                   </span>507 |                 </div>508 |                 <div className="flex items-center space-x-2">509 |                   <div className={`w-3 h-3 rounded-full ${error ? 'bg-red-500' : 'bg-[#10B981]'}`}></div>510 |                   <span className="text-[#EAEAEA] text-sm">511 |                     {error ? 'Error' : 'Operational'}512 |                   </span>513 |                 </div>514 |                 <div className="flex items-center space-x-2">515 |                   <div className="w-3 h-3 bg-[#3B82F6] rounded-full"></div>516 |                   <span className="text-[#EAEAEA] text-sm">ISR Enabled</span>517 |                 </div>518 |                 <div className="flex items-center space-x-2">519 |                   <div className="w-3 h-3 bg-[#8B5CF6] rounded-full"></div>520 |                   <span className="text-[#EAEAEA] text-sm">521 |                     {Object.keys(content).length} fields loaded522 |                   </span>523 |                 </div>524 |               </div>525 | 526 |               <div className="flex items-center space-x-3">527 |                 <CMSButton528 |                   onClick={handleRefresh}529 |                   disabled={isLoading}530 |                   variant="secondary"531 |                   size="sm"532 |                 >533 |                   <RefreshCw size={16} className="mr-2" />534 |                   Refresh All535 |                 </CMSButton>536 | 537 |                 {hasUnsavedChanges && (538 |                   <CMSButton539 |                     onClick={saveContent}540 |                     disabled={isSaving}541 |                     variant="primary"542 |                     size="sm"543 |                   >544 |                     <Save size={16} className="mr-2" />545 |                     {isSaving ? 'Saving...' : 'Save Changes'}546 |                   </CMSButton>547 |                 )}548 |               </div>549 |             </div>550 |           </div>551 |         </div>552 | 553 |         {}554 |         <div className="bg-[#1A1A2E] rounded-lg border border-[#2D2D44] overflow-hidden">555 |           <CMSTabs556 |             tabs={tabs}557 |             activeTab={activeTab}558 |             onTabChange={handleTabChange}559 |           />560 |         </div>561 |       </div>562 | 563 |       {}564 |       <ToastContainer toasts={toasts} onRemove={() => {}} />565 |     </div>566 |   );567 | }
============================================================END: frontend/components/ContentManagement.tsx============================================================


============================================================FILE: frontend/components/CustomerBookingFlow.tsxSIZE: 47.90 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { motion, AnimatePresence } from 'framer-motion';  5 | import Image from 'next/image';  6 | import {  7 |   Calendar,  8 |   Clock,  9 |   Package, 10 |   User, 11 |   CheckCircle, 12 |   AlertCircle, 13 |   ArrowRight, 14 |   ArrowLeft, 15 |  16 |   MapPin, 17 |   MessageSquare, 18 |   Zap 19 | } from 'lucide-react'; 20 | import { Card, CardContent, CardHeader, CardTitle } from './ui/card'; 21 | import { BaseButton } from './ui/BaseButton'; 22 | import { Badge } from './ui/badge'; 23 | import { Input } from './ui/input'; 24 | import { Label } from './ui/label'; 25 | import { Textarea } from './ui/textarea'; 26 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select'; 27 | import { toast } from 'sonner'; 28 | import { useAuth } from '../hooks/useAuth'; 29 | import { formatDate, formatTime } from '@/lib/utils'; 30 | import { StripeInlineForm } from './stripe/StripeInlineForm'; 31 | import { CreditCard, ChevronDown, Check } from 'lucide-react'; 32 |  33 | interface CustomerPackage { 34 |   id: string; 35 |   name: string; 36 |   description: string; 37 |   sessionsRemaining: number; 38 |   totalSessions: number; 39 |   expiresAt: string; 40 |   status: 'active' | 'expired' | 'completed'; 41 |   purchaseDate: string; 42 |   price: number; 43 |   sessionDuration: number; 44 | } 45 |  46 | interface AvailableSchedule { 47 |   id: string; 48 |   date: string; 49 |   time: string; 50 |   isAvailable: boolean; 51 |   capacity: number; 52 |   bookedCount: number; 53 |   sessionType: string; 54 |   price: number; 55 | } 56 |  57 | interface BookingStep { 58 |   id: string; 59 |   title: string; 60 |   description: string; 61 |   completed: boolean; 62 | } 63 |  64 | interface PaymentMethod { 65 |   id: number; 66 |   name: string; 67 |   type: string; 68 |   description: string; 69 |   icon: string; 70 |   requiresConfirmation: boolean; 71 |   autoAssignPackage: boolean; 72 |   isActive: boolean; 73 | } 74 |  75 | interface BookingFormData { 76 |   selectedPackage: CustomerPackage | null; 77 |   selectedSchedule: AvailableSchedule | null; 78 |   selectedPaymentMethod: PaymentMethod | null; 79 |   clientName: string; 80 |   clientEmail: string; 81 |   clientPhone: string; 82 |   birthDate: string; 83 |   birthTime: string; 84 |   birthPlace: string; 85 |   question: string; 86 |   specialRequests: string; 87 |   language: string; 88 | } 89 |  90 | export function CustomerBookingFlow() { 91 |   const { user } = useAuth(); 92 |   const [packages, setPackages] = useState<CustomerPackage[]>([]); 93 |   const [schedules, setSchedules] = useState<AvailableSchedule[]>([]); 94 |   const [paymentMethods, setPaymentMethods] = useState<PaymentMethod[]>([]); 95 |   const [loading, setLoading] = useState(true); 96 |   const [currentStep, setCurrentStep] = useState(0); 97 |   const [processing, setProcessing] = useState(false); 98 |   const [selectedDate, setSelectedDate] = useState(''); 99 |   const [paymentIntentId, setPaymentIntentId] = useState<string | null>(null);100 |   const [paymentStatus, setPaymentStatus] = useState<'idle' | 'success' | 'error'>('idle');101 |   const [showPaymentMethodDropdown, setShowPaymentMethodDropdown] = useState(false);102 |   const [formData, setFormData] = useState<BookingFormData>({103 |     selectedPackage: null,104 |     selectedSchedule: null,105 |     selectedPaymentMethod: null,106 |     clientName: '',107 |     clientEmail: '',108 |     clientPhone: '',109 |     birthDate: '',110 |     birthTime: '',111 |     birthPlace: '',112 |     question: '',113 |     specialRequests: '',114 |     language: 'en'115 |   });116 | 117 |   const steps: BookingStep[] = [118 |     { id: 'package', title: 'Select Package', description: 'Choose your package for booking', completed: false },119 |     { id: 'schedule', title: 'Select Schedule', description: 'Pick your preferred date and time', completed: false },120 |     { id: 'details', title: 'Session Details', description: 'Provide your information and questions', completed: false },121 |     { id: 'payment', title: 'Payment', description: 'Secure payment processing', completed: false },122 |     { id: 'confirmation', title: 'Confirm Booking', description: 'Review and confirm your booking', completed: false }123 |   ];124 | 125 |   useEffect(() => {126 |     const handleClickOutside = (event: MouseEvent) => {127 |       if (showPaymentMethodDropdown && !(event.target as Element).closest('.payment-method-dropdown')) {128 |         setShowPaymentMethodDropdown(false);129 |       }130 |     };131 | 132 |     document.addEventListener('mousedown', handleClickOutside);133 |     return () => document.removeEventListener('mousedown', handleClickOutside);134 |   }, [showPaymentMethodDropdown]);135 | 136 |   const loadPackages = useCallback(async () => {137 |     try {138 |       const response = await fetch('/api/client/my-packages', {139 |         headers: {140 |           'Authorization': `Bearer ${user?.access_token}`,141 |           'Content-Type': 'application/json'142 |         }143 |       });144 | 145 |       if (response.ok) {146 |         const data = await response.json();147 |         if (data.success) {148 |           const activePackages = data.data.filter((pkg: CustomerPackage) =>149 |             pkg.status === 'active' && pkg.sessionsRemaining > 0150 |           );151 |           setPackages(activePackages);152 |         }153 |       }154 |     } catch (error) {155 |       }156 |   }, [user?.access_token]);157 | 158 |   const loadSchedules = useCallback(async () => {159 |     try {160 |       const response = await fetch('/api/client/schedule-slots', {161 |         headers: {162 |           'Authorization': `Bearer ${user?.access_token}`,163 |           'Content-Type': 'application/json'164 |         }165 |       });166 | 167 |       if (response.ok) {168 |         const data = await response.json();169 |         if (data.success) {170 |           setSchedules(data.data || []);171 |         }172 |       }173 |     } catch (error) {174 |       }175 |   }, [user?.access_token]);176 | 177 |   const loadPaymentMethods = useCallback(async () => {178 |     try {179 |       const response = await fetch('/api/client/payment-methods', {180 |         headers: {181 |           'Authorization': `Bearer ${user?.access_token}`,182 |           'Content-Type': 'application/json'183 |         }184 |       });185 | 186 |       if (response.ok) {187 |         const data = await response.json();188 |         if (data.success) {189 |           setPaymentMethods(data.data);190 | 191 |           const stripeMethod = data.data.find((method: PaymentMethod) => method.type === 'stripe');192 |           if (stripeMethod) {193 |             setFormData(prev => ({ ...prev, selectedPaymentMethod: stripeMethod }));194 |           }195 |         }196 |       } else {197 | 198 |         const defaultStripeMethod = {199 |           id: 1,200 |           name: 'Credit Card',201 |           type: 'stripe',202 |           description: 'Pay with Visa, Mastercard, or American Express',203 |           icon: 'https:204 |           requiresConfirmation: false,205 |           autoAssignPackage: true,206 |           isActive: true207 |         };208 |         setPaymentMethods([defaultStripeMethod]);209 |         setFormData(prev => ({ ...prev, selectedPaymentMethod: defaultStripeMethod }));210 |       }211 |     } catch (error) {212 |       }213 |   }, [user?.access_token]);214 | 215 |   const loadCustomerData = useCallback(async () => {216 |     try {217 |       setLoading(true);218 |       await Promise.all([219 |         loadPackages(),220 |         loadSchedules(),221 |         loadPaymentMethods()222 |       ]);223 |     } catch (error) {224 |       toast.error('Failed to load booking data');225 |     } finally {226 |       setLoading(false);227 |     }228 |   }, [loadPackages, loadSchedules, loadPaymentMethods]);229 | 230 |   useEffect(() => {231 |     if (user?.access_token) {232 |       loadCustomerData();233 |     }234 |   }, [user?.access_token, loadCustomerData]);235 | 236 |   const handlePaymentMethodSelect = (method: PaymentMethod) => {237 |     setFormData(prev => ({ ...prev, selectedPaymentMethod: method }));238 |     setShowPaymentMethodDropdown(false);239 |   };240 | 241 |   const handlePackageSelect = (pkg: CustomerPackage) => {242 |     setFormData(prev => ({ ...prev, selectedPackage: pkg }));243 |     setCurrentStep(1);244 |     updateStepCompletion(0, true);245 |   };246 | 247 |   const handleScheduleSelect = (schedule: AvailableSchedule) => {248 |     setFormData(prev => ({ ...prev, selectedSchedule: schedule }));249 |     setSelectedDate(schedule.date);250 |     setCurrentStep(2);251 |     updateStepCompletion(1, true);252 |   };253 | 254 |   const handleFormChange = (field: keyof BookingFormData, value: string | Date | number | boolean | null | undefined) => {255 |     setFormData(prev => ({ ...prev, [field]: value }));256 |   };257 | 258 |   const updateStepCompletion = (stepIndex: number, completed: boolean) => {259 |     const updatedSteps = [...steps];260 |     updatedSteps[stepIndex].completed = completed;261 |   };262 | 263 |   const handlePaymentSuccess = (intentId: string) => {264 |     setPaymentIntentId(intentId);265 |     setPaymentStatus('success');266 |     setCurrentStep(4);267 |     updateStepCompletion(3, true);268 |     toast.success('Payment processed successfully!');269 |   };270 | 271 |   const handlePaymentError = (error: string) => {272 |     setPaymentStatus('error');273 |     toast.error(`Payment failed: ${error}`);274 |   };275 | 276 |     const handleSubmitBooking = async () => {277 |     if (!formData.selectedPackage || !formData.selectedSchedule || !formData.selectedPaymentMethod) {278 |       toast.error('Missing required information');279 |       return;280 |     }281 | 282 |     setProcessing(true);283 | 284 |     try {285 |       const bookingData = {286 |         scheduleSlotId: parseInt(formData.selectedSchedule.id),287 |         userPackageId: parseInt(formData.selectedPackage.id),288 |         sessionType: 'Session',289 |         notes: formData.specialRequests || formData.question,290 |         phoneNumber: formData.clientPhone291 |       };292 | 293 |       const response = await fetch('/api/client/bookings', {294 |         method: 'POST',295 |         headers: {296 |           'Authorization': `Bearer ${user?.access_token}`,297 |           'Content-Type': 'application/json'298 |         },299 |         body: JSON.stringify(bookingData)300 |       });301 | 302 |       const result = await response.json();303 | 304 |       if (result.success) {305 |         toast.success('Booking created successfully!');306 |         setCurrentStep(5);307 |         updateStepCompletion(4, true);308 | 309 |         loadPackages();310 |       } else {311 |         toast.error(result.error || 'Failed to create booking');312 |       }313 |     } catch (error) {314 |       toast.error('Failed to create booking');315 |     } finally {316 |       setProcessing(false);317 |     }318 |   };319 | 320 |   const handleBackToPackages = () => {321 |     setCurrentStep(0);322 |     setFormData(prev => ({ ...prev, selectedPackage: null, selectedSchedule: null }));323 |     setSelectedDate('');324 |   };325 | 326 |   const handleBackToSchedule = () => {327 |     setCurrentStep(1);328 |     setFormData(prev => ({ ...prev, selectedSchedule: null }));329 |     setSelectedDate('');330 |   };331 | 332 |   const handleBackToDetails = () => {333 |     setCurrentStep(2);334 |   };335 | 336 |   const handleBackToPayment = () => {337 |     setCurrentStep(3);338 |   };339 | 340 |   const handleProceedToPayment = () => {341 |     setCurrentStep(3);342 |     updateStepCompletion(2, true);343 |   };344 | 345 |   const getStatusBadge = (status: string) => {346 |     const statusConfig = {347 |       'active': { color: 'bg-green-500/20 text-green-400', label: 'Active' },348 |       'expired': { color: 'bg-gray-500/20 text-gray-400', label: 'Expired' },349 |       'completed': { color: 'bg-blue-500/20 text-blue-400', label: 'Completed' }350 |     };351 | 352 |     const config = statusConfig[status as keyof typeof statusConfig] || statusConfig.active;353 |     return <Badge className={config.color}>{config.label}</Badge>;354 |   };355 | 356 |   const availableDates = [...new Set(schedules357 |     .filter(s => s.isAvailable && s.bookedCount < s.capacity)358 |     .map(s => s.date)359 |     .sort()360 |   )];361 | 362 |   const availableTimes = schedules363 |     .filter(s => s.date === selectedDate && s.isAvailable && s.bookedCount < s.capacity)364 |     .sort((a, b) => a.time.localeCompare(b.time));365 | 366 |   if (loading) {367 |     return (368 |       <div className="flex items-center justify-center h-64">369 |         <motion.div370 |           animate={{ rotate: 360 }}371 |           transition={{ duration: 2, repeat: Infinity, ease: "linear" }}372 |           className="w-8 h-8 border-4 border-[#FFD700] border-t-transparent rounded-full"373 |         />374 |       </div>375 |     );376 |   }377 | 378 |   if (packages.length === 0) {379 |     return (380 |       <div className="text-center py-12">381 |         <Package size={48} className="mx-auto text-gray-400/50 mb-4" />382 |         <h3 className="text-lg font-heading text-white mb-2">No Active Packages</h3>383 |         <p className="text-gray-400 mb-4">You need to purchase a package before you can book a session</p>384 |         <a href="/account/purchase">385 |           <BaseButton className="dashboard-button-primary">386 |             <Package size={16} className="mr-2" />387 |             Buy Packages388 |           </BaseButton>389 |         </a>390 |       </div>391 |     );392 |   }393 | 394 |   return (395 |     <div className="space-y-6">396 |       {}397 |       <div className="text-center">398 |         <h1 className="text-3xl font-bold text-white mb-2">Book Your Session</h1>399 |         <p className="text-gray-400">Schedule your spiritual consultation</p>400 |       </div>401 | 402 |       {}403 |       <div className="flex items-center justify-center space-x-4 mb-8">404 |         {steps.map((step, index) => (405 |           <div key={step.id} className="flex items-center">406 |             <div className={`flex items-center justify-center w-10 h-10 rounded-full border-2 ${407 |               index <= currentStep408 |                 ? 'border-[#ffd700] bg-[#ffd700] text-black'409 |                 : 'border-gray-600 text-gray-400'410 |             }`}>411 |               {step.completed ? (412 |                 <CheckCircle size={20} />413 |               ) : (414 |                 <span className="text-sm font-medium">{index + 1}</span>415 |               )}416 |             </div>417 |             {index < steps.length - 1 && (418 |               <div className={`w-16 h-0.5 mx-2 ${419 |                 index < currentStep ? 'bg-[#ffd700]' : 'bg-gray-600'420 |               }`} />421 |             )}422 |           </div>423 |         ))}424 |       </div>425 | 426 |       <AnimatePresence mode="wait">427 |         {currentStep === 0 && (428 |           <motion.div429 |             key="packages"430 |             initial={{ opacity: 0, x: 20 }}431 |             animate={{ opacity: 1, x: 0 }}432 |             exit={{ opacity: 0, x: -20 }}433 |             transition={{ duration: 0.3 }}434 |           >435 |             {}436 |             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">437 |               {packages.map((pkg) => (438 |                 <Card439 |                   key={pkg.id}440 |                   className={`cursor-pointer transition-all ${441 |                     formData.selectedPackage?.id === pkg.id442 |                       ? 'ring-2 ring-[#ffd700] bg-[#1a1a2e]'443 |                       : 'bg-[#1a1a2e] border-[#16213e] hover:border-[#ffd700]/50'444 |                   }`}445 |                   onClick={() => handlePackageSelect(pkg)}446 |                 >447 |                   <CardHeader>448 |                     <div className="flex items-center justify-between">449 |                       <CardTitle className="text-white">{pkg.name}</CardTitle>450 |                       {getStatusBadge(pkg.status)}451 |                     </div>452 |                   </CardHeader>453 |                   <CardContent className="space-y-4">454 |                     <p className="text-gray-300 text-sm">{pkg.description}</p>455 | 456 |                     <div className="space-y-2">457 |                       <div className="flex justify-between text-sm">458 |                         <span className="text-gray-400">Sessions Remaining:</span>459 |                         <span className="text-white font-medium">{pkg.sessionsRemaining}/{pkg.totalSessions}</span>460 |                       </div>461 |                       <div className="flex justify-between text-sm">462 |                         <span className="text-gray-400">Session Duration:</span>463 |                         <span className="text-white">{pkg.sessionDuration} minutes</span>464 |                       </div>465 |                       {pkg.expiresAt && (466 |                         <div className="flex justify-between text-sm">467 |                           <span className="text-gray-400">Expires:</span>468 |                           <span className="text-white">{formatDate(pkg.expiresAt)}</span>469 |                         </div>470 |                       )}471 |                     </div>472 | 473 |                     <BaseButton474 |                       className="w-full dashboard-button-primary"475 |                       onClick={() => handlePackageSelect(pkg)}476 |                     >477 |                       Use This Package478 |                       <ArrowRight size={16} className="ml-2" />479 |                     </BaseButton>480 |                   </CardContent>481 |                 </Card>482 |               ))}483 |             </div>484 |           </motion.div>485 |         )}486 | 487 |         {currentStep === 1 && formData.selectedPackage && (488 |           <motion.div489 |             key="schedule"490 |             initial={{ opacity: 0, x: 20 }}491 |             animate={{ opacity: 1, x: 0 }}492 |             exit={{ opacity: 0, x: -20 }}493 |             transition={{ duration: 0.3 }}494 |           >495 |             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">496 |               {}497 |               <Card className="bg-[#1a1a2e] border-[#16213e]">498 |                 <CardHeader>499 |                   <CardTitle className="text-white flex items-center">500 |                     <Calendar size={20} className="mr-2 text-[#ffd700]" />501 |                     Select Date502 |                   </CardTitle>503 |                 </CardHeader>504 |                 <CardContent>505 |                   <div className="grid grid-cols-2 md:grid-cols-3 gap-3">506 |                     {availableDates.slice(0, 12).map((date) => (507 |                       <BaseButton508 |                         key={date}509 |                         variant="outline"510 |                         onClick={() => setSelectedDate(date)}511 |                         className={`${512 |                           selectedDate === date513 |                             ? 'border-[#ffd700] bg-[#ffd700]/10 text-[#ffd700]'514 |                             : 'border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white'515 |                         }`}516 |                       >517 |                         {formatDate(date)}518 |                       </BaseButton>519 |                     ))}520 |                   </div>521 |                 </CardContent>522 |               </Card>523 | 524 |               {}525 |               {selectedDate && (526 |                 <Card className="bg-[#1a1a2e] border-[#16213e]">527 |                   <CardHeader>528 |                     <CardTitle className="text-white flex items-center">529 |                       <Clock size={20} className="mr-2 text-[#ffd700]" />530 |                       Select Time531 |                     </CardTitle>532 |                   </CardHeader>533 |                   <CardContent>534 |                     {availableTimes.length === 0 ? (535 |                       <div className="text-center py-8">536 |                         <AlertCircle size={48} className="mx-auto text-gray-400/50 mb-4" />537 |                         <p className="text-gray-400">No available times for this date</p>538 |                       </div>539 |                     ) : (540 |                       <div className="grid grid-cols-2 gap-3">541 |                         {availableTimes.map((schedule) => (542 |                           <BaseButton543 |                             key={schedule.id}544 |                             variant="outline"545 |                             onClick={() => handleScheduleSelect(schedule)}546 |                             className={`${547 |                               formData.selectedSchedule?.id === schedule.id548 |                                 ? 'border-[#ffd700] bg-[#ffd700]/10 text-[#ffd700]'549 |                                 : 'border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white'550 |                             }`}551 |                           >552 |                             <div className="text-center">553 |                               <div className="font-medium">{formatTime(schedule.time)}</div>554 |                               <div className="text-xs opacity-75">555 |                                 {schedule.bookedCount}/{schedule.capacity} booked556 |                               </div>557 |                             </div>558 |                           </BaseButton>559 |                         ))}560 |                       </div>561 |                     )}562 |                   </CardContent>563 |                 </Card>564 |               )}565 |             </div>566 | 567 |             <div className="flex justify-between mt-6">568 |               <BaseButton569 |                 variant="outline"570 |                 onClick={handleBackToPackages}571 |                 className="border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white"572 |               >573 |                 <ArrowLeft size={16} className="mr-2" />574 |                 Back to Packages575 |               </BaseButton>576 |             </div>577 |           </motion.div>578 |         )}579 | 580 |         {currentStep === 2 && formData.selectedPackage && formData.selectedSchedule && (581 |           <motion.div582 |             key="details"583 |             initial={{ opacity: 0, x: 20 }}584 |             animate={{ opacity: 1, x: 0 }}585 |             exit={{ opacity: 0, x: -20 }}586 |             transition={{ duration: 0.3 }}587 |           >588 |             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">589 |               {}590 |               <Card className="bg-[#1a1a2e] border-[#16213e]">591 |                 <CardHeader>592 |                   <CardTitle className="text-white flex items-center">593 |                     <User size={20} className="mr-2 text-[#ffd700]" />594 |                     Session Details595 |                   </CardTitle>596 |                 </CardHeader>597 |                 <CardContent className="space-y-4">598 |                   <div className="grid grid-cols-1 md:grid-cols-2 gap-4">599 |                     <div>600 |                       <Label htmlFor="clientName" className="text-gray-300">Full Name *</Label>601 |                       <Input602 |                         id="clientName"603 |                         value={formData.clientName}604 |                         onChange={(e) => handleFormChange('clientName', e.target.value)}605 |                         className="bg-[#16213e] border-[#0a0a23] text-white"606 |                         required607 |                       />608 |                     </div>609 | 610 |                     <div>611 |                       <Label htmlFor="clientEmail" className="text-gray-300">Email *</Label>612 |                       <Input613 |                         id="clientEmail"614 |                         type="email"615 |                         value={formData.clientEmail}616 |                         onChange={(e) => handleFormChange('clientEmail', e.target.value)}617 |                         className="bg-[#16213e] border-[#0a0a23] text-white"618 |                         required619 |                       />620 |                     </div>621 | 622 |                     <div>623 |                       <Label htmlFor="clientPhone" className="text-gray-300">Phone</Label>624 |                       <Input625 |                         id="clientPhone"626 |                         type="tel"627 |                         value={formData.clientPhone}628 |                         onChange={(e) => handleFormChange('clientPhone', e.target.value)}629 |                         className="bg-[#16213e] border-[#0a0a23] text-white"630 |                         placeholder="+1 (555) 123-4567"631 |                       />632 |                     </div>633 | 634 |                     <div>635 |                       <Label htmlFor="language" className="text-gray-300">Language</Label>636 |                       <Select637 |                         value={formData.language}638 |                         onValueChange={(value) => handleFormChange('language', value)}639 |                       >640 |                         <SelectTrigger className="bg-[#16213e] border-[#0a0a23] text-white">641 |                           <SelectValue />642 |                         </SelectTrigger>643 |                         <SelectContent className="bg-[#16213e] border-[#0a0a23] text-white">644 |                           <SelectItem value="en">🇺🇸 English</SelectItem>645 |                           <SelectItem value="es">🇪🇸 Español</SelectItem>646 |                         </SelectContent>647 |                       </Select>648 |                     </div>649 | 650 |                     <div>651 |                       <Label htmlFor="birthDate" className="text-gray-300">Birth Date *</Label>652 |                       <Input653 |                         id="birthDate"654 |                         type="date"655 |                         value={formData.birthDate}656 |                         onChange={(e) => handleFormChange('birthDate', e.target.value)}657 |                         className="bg-[#16213e] border-[#0a0a23] text-white"658 |                         required659 |                       />660 |                     </div>661 | 662 |                     <div>663 |                       <Label htmlFor="birthTime" className="text-gray-300">Birth Time (Optional)</Label>664 |                       <Input665 |                         id="birthTime"666 |                         type="time"667 |                         value={formData.birthTime}668 |                         onChange={(e) => handleFormChange('birthTime', e.target.value)}669 |                         className="bg-[#16213e] border-[#0a0a23] text-white"670 |                       />671 |                     </div>672 |                   </div>673 | 674 |                   <div>675 |                     <Label htmlFor="birthPlace" className="text-gray-300">Birth Place *</Label>676 |                     <Input677 |                       id="birthPlace"678 |                       value={formData.birthPlace}679 |                       onChange={(e) => handleFormChange('birthPlace', e.target.value)}680 |                       className="bg-[#16213e] border-[#0a0a23] text-white"681 |                       placeholder="City, Country"682 |                       required683 |                     />684 |                   </div>685 | 686 |                   <div>687 |                     <Label htmlFor="question" className="text-gray-300">Question/Focus Areas *</Label>688 |                     <Textarea689 |                       id="question"690 |                       value={formData.question}691 |                       onChange={(e) => handleFormChange('question', e.target.value)}692 |                       className="bg-[#16213e] border-[#0a0a23] text-white min-h-[100px]"693 |                       placeholder="What would you like to explore in your reading?"694 |                       required695 |                     />696 |                   </div>697 | 698 |                   <div>699 |                     <Label htmlFor="specialRequests" className="text-gray-300">Special Requests</Label>700 |                     <Textarea701 |                       id="specialRequests"702 |                       value={formData.specialRequests}703 |                       onChange={(e) => handleFormChange('specialRequests', e.target.value)}704 |                       className="bg-[#16213e] border-[#0a0a23] text-white min-h-[80px]"705 |                       placeholder="Any special requests or additional information..."706 |                     />707 |                   </div>708 |                 </CardContent>709 |               </Card>710 | 711 |               {}712 |               <div className="space-y-4">713 |                 <Card className="bg-[#1a1a2e] border-[#16213e]">714 |                   <CardHeader>715 |                     <CardTitle className="text-white">Booking Summary</CardTitle>716 |                   </CardHeader>717 |                   <CardContent className="space-y-4">718 |                     <div className="flex items-center space-x-3 p-3 bg-[#16213e] rounded-lg">719 |                       <Package size={24} className="text-[#ffd700]" />720 |                       <div className="flex-1">721 |                         <p className="text-white font-medium">{formData.selectedPackage.name}</p>722 |                         <p className="text-sm text-gray-400">723 |                           {formData.selectedPackage.sessionsRemaining} sessions remaining724 |                         </p>725 |                       </div>726 |                     </div>727 | 728 |                     <div className="flex items-center space-x-3 p-3 bg-[#16213e] rounded-lg">729 |                       <Calendar size={24} className="text-[#ffd700]" />730 |                       <div className="flex-1">731 |                         <p className="text-white font-medium">732 |                           {formatDate(formData.selectedSchedule!.date)}733 |                         </p>734 |                         <p className="text-sm text-gray-400">735 |                           {formatTime(formData.selectedSchedule!.time)} • {formData.selectedPackage.sessionDuration} min736 |                         </p>737 |                       </div>738 |                     </div>739 | 740 |                     <div className="space-y-3 pt-4 border-t border-[#2a2a4a]">741 |                       <div className="flex items-center space-x-2 text-sm text-gray-400">742 |                         <Zap size={16} />743 |                         <span>Instant confirmation</span>744 |                       </div>745 |                       <div className="flex items-center space-x-2 text-sm text-gray-400">746 |                         <MessageSquare size={16} />747 |                         <span>Email reminders sent</span>748 |                       </div>749 |                       <div className="flex items-center space-x-2 text-sm text-gray-400">750 |                         <MapPin size={16} />751 |                         <span>Online session via Zoom</span>752 |                       </div>753 |                     </div>754 |                   </CardContent>755 |                 </Card>756 |               </div>757 |             </div>758 | 759 |             <div className="flex justify-between mt-6">760 |               <BaseButton761 |                 variant="outline"762 |                 onClick={handleBackToSchedule}763 |                 className="border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white"764 |               >765 |                 <ArrowLeft size={16} className="mr-2" />766 |                 Back to Schedule767 |               </BaseButton>768 |               <BaseButton769 |                 onClick={handleProceedToPayment}770 |                 className="dashboard-button-primary"771 |               >772 |                 Proceed to Payment773 |                 <ArrowRight size={16} className="ml-2" />774 |               </BaseButton>775 |             </div>776 |           </motion.div>777 |         )}778 | 779 |         {currentStep === 3 && formData.selectedPackage && formData.selectedSchedule && (780 |           <motion.div781 |             key="payment"782 |             initial={{ opacity: 0, x: 20 }}783 |             animate={{ opacity: 1, x: 0 }}784 |             exit={{ opacity: 0, x: -20 }}785 |             transition={{ duration: 0.3 }}786 |           >787 |             <div className="space-y-6">788 |               <div className="text-center">789 |                 <h2 className="text-2xl font-bold text-white mb-2">Choose Payment Method</h2>790 |                 <p className="text-gray-400">Select how you&apos;d like to pay for your session</p>791 |               </div>792 | 793 |               {}794 |               <Card className="bg-[#1a1a2e] border-[#16213e]">795 |                 <CardHeader>796 |                   <CardTitle className="text-white flex items-center">797 |                     <CreditCard size={20} className="mr-2 text-[#ffd700]" />798 |                     Payment Summary799 |                   </CardTitle>800 |                 </CardHeader>801 |                 <CardContent className="space-y-4">802 |                   <div className="flex justify-between items-center p-4 bg-[#16213e] rounded-lg">803 |                     <div>804 |                       <p className="text-white font-medium">{formData.selectedPackage.name}</p>805 |                       <p className="text-sm text-gray-400">806 |                         {formatDate(formData.selectedSchedule.date)} at {formatTime(formData.selectedSchedule.time)}807 |                       </p>808 |                     </div>809 |                     <div className="text-right">810 |                       <p className="text-2xl font-bold text-[#ffd700]">811 |                         ${(formData.selectedSchedule.price / 100).toFixed(2)}812 |                       </p>813 |                       <p className="text-sm text-gray-400">USD</p>814 |                     </div>815 |                   </div>816 |                 </CardContent>817 |               </Card>818 | 819 |               {}820 |               <div className="flex items-center justify-between">821 |                 <div className="flex items-center space-x-3">822 |                   {formData.selectedPaymentMethod && (823 |                     <>824 |                       <Image825 |                         src={formData.selectedPaymentMethod.icon}826 |                         alt={formData.selectedPaymentMethod.name}827 |                         width={24}828 |                         height={24}829 |                         className="w-6 h-6 object-contain"830 |                       />831 |                       <div>832 |                         <p className="text-white font-medium text-sm">{formData.selectedPaymentMethod.name}</p>833 |                         <p className="text-xs text-gray-400">{formData.selectedPaymentMethod.description}</p>834 |                       </div>835 |                     </>836 |                   )}837 |                 </div>838 | 839 |                 {}840 |                 <div className="relative payment-method-dropdown">841 |                   <button842 |                     onClick={() => setShowPaymentMethodDropdown(!showPaymentMethodDropdown)}843 |                     className="flex items-center space-x-2 px-3 py-2 bg-[#16213e] border border-[#2a2a4a] rounded-lg hover:border-[#ffd700]/50 transition-colors text-xs"844 |                   >845 |                     <span className="text-gray-300">Change Method</span>846 |                     <ChevronDown847 |                       size={14}848 |                       className={`text-gray-400 transition-transform ${849 |                         showPaymentMethodDropdown ? 'rotate-180' : ''850 |                       }`}851 |                     />852 |                   </button>853 | 854 |                   {}855 |                   {showPaymentMethodDropdown && (856 |                     <div className="absolute top-full right-0 mt-2 bg-[#16213e] border border-[#2a2a4a] rounded-lg shadow-xl z-10 min-w-[200px]">857 |                       {paymentMethods.map((method) => (858 |                         <button859 |                           key={method.id}860 |                           onClick={() => handlePaymentMethodSelect(method)}861 |                           className="w-full flex items-center space-x-3 p-3 hover:bg-[#2a2a4a] transition-colors first:rounded-t-lg last:rounded-b-lg"862 |                         >863 |                           <Image864 |                             src={method.icon}865 |                             alt={method.name}866 |                             width={20}867 |                             height={20}868 |                             className="w-5 h-5 object-contain"869 |                           />870 |                           <div className="flex-1 text-left">871 |                             <p className="text-white font-medium text-sm">{method.name}</p>872 |                           </div>873 |                           {formData.selectedPaymentMethod?.id === method.id && (874 |                             <Check size={16} className="text-[#ffd700]" />875 |                           )}876 |                         </button>877 |                       ))}878 |                     </div>879 |                   )}880 |                 </div>881 |               </div>882 | 883 |               {}884 |               {formData.selectedPaymentMethod?.type === 'stripe' ? (885 | 886 |                 <div className="space-y-4">887 |                   <StripeInlineForm888 |                     amount={formData.selectedSchedule.price}889 |                     currency="usd"890 |                     description={`Booking: ${formData.selectedPackage.name}`}891 |                     customerEmail={formData.clientEmail}892 |                     metadata={{893 |                       booking_type: 'session',894 |                       package_id: formData.selectedPackage.id,895 |                       package_name: formData.selectedPackage.name,896 |                       schedule_id: formData.selectedSchedule.id,897 |                       session_date: formData.selectedSchedule.date,898 |                       session_time: formData.selectedSchedule.time,899 |                       client_name: formData.clientName,900 |                       client_email: formData.clientEmail901 |                     }}902 |                     onSuccess={handlePaymentSuccess}903 |                     onError={handlePaymentError}904 |                     appearance={{905 |                       theme: 'night',906 |                       variables: {907 |                         colorPrimary: '#ffd700',908 |                         colorBackground: '#1a1a2e',909 |                         colorText: '#ffffff',910 |                         colorDanger: '#ef4444',911 |                         fontFamily: 'Inter, system-ui, sans-serif',912 |                         spacingUnit: '2px',913 |                         borderRadius: '6px',914 |                       },915 |                     }}916 |                   />917 |                 </div>918 |               ) : formData.selectedPaymentMethod ? (919 | 920 |                 <div className="space-y-4">921 |                   <Card className="bg-[#1a1a2e] border-[#16213e]">922 |                     <CardContent className="pt-6">923 |                       <div className="text-center space-y-4">924 |                         <Image925 |                           src={formData.selectedPaymentMethod.icon}926 |                           alt={formData.selectedPaymentMethod.name}927 |                           width={64}928 |                           height={64}929 |                           className="w-16 h-16 object-contain mx-auto"930 |                         />931 |                         <div>932 |                           <h3 className="text-xl font-semibold text-white mb-2">933 |                             Pay with {formData.selectedPaymentMethod.name}934 |                           </h3>935 |                           <p className="text-gray-400 mb-4">936 |                             {formData.selectedPaymentMethod.description}937 |                           </p>938 |                         </div>939 | 940 |                         {formData.selectedPaymentMethod.requiresConfirmation ? (941 |                           <div className="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4">942 |                             <p className="text-yellow-400 text-sm">943 |                               ⚠️ This payment method requires manual confirmation.944 |                               You&apos;ll receive payment instructions after booking.945 |                             </p>946 |                           </div>947 |                         ) : (948 |                           <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4">949 |                             <p className="text-green-400 text-sm">950 |                               ✅ Instant processing available for this payment method.951 |                             </p>952 |                           </div>953 |                         )}954 | 955 |                         <BaseButton956 |                           onClick={() => setCurrentStep(4)}957 |                           className="dashboard-button-primary"958 |                           disabled={processing}959 |                         >960 |                           Continue with {formData.selectedPaymentMethod.name}961 |                           <ArrowRight size={16} className="ml-2" />962 |                         </BaseButton>963 |                       </div>964 |                     </CardContent>965 |                   </Card>966 |                 </div>967 |               ) : (968 | 969 |                 <Card className="bg-[#1a1a2e] border-[#16213e]">970 |                   <CardContent className="pt-6">971 |                     <div className="text-center space-y-4">972 |                       <div className="w-8 h-8 border-4 border-[#ffd700] border-t-transparent rounded-full animate-spin mx-auto"></div>973 |                       <p className="text-gray-400">Loading payment options...</p>974 |                     </div>975 |                   </CardContent>976 |                 </Card>977 |               )}978 | 979 |               <div className="flex justify-between">980 |                 <BaseButton981 |                   variant="outline"982 |                   onClick={handleBackToDetails}983 |                   className="border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white"984 |                 >985 |                   <ArrowLeft size={16} className="mr-2" />986 |                   Back to Details987 |                 </BaseButton>988 | 989 |                 {}990 |                 {formData.selectedPaymentMethod && formData.selectedPaymentMethod.type !== 'stripe' && (991 |                   <BaseButton992 |                     onClick={() => setCurrentStep(4)}993 |                     className="dashboard-button-primary"994 |                   >995 |                     Continue to Confirmation996 |                     <ArrowRight size={16} className="ml-2" />997 |                   </BaseButton>998 |                 )}999 |               </div>1000 |             </div>1001 |           </motion.div>1002 |         )}1003 | 1004 |         {currentStep === 4 && (1005 |           <motion.div1006 |             key="confirmation"1007 |             initial={{ opacity: 0, x: 20 }}1008 |             animate={{ opacity: 1, x: 0 }}1009 |             exit={{ opacity: 0, x: -20 }}1010 |             transition={{ duration: 0.3 }}1011 |           >1012 |             <Card className="bg-[#1a1a2e] border-[#16213e]">1013 |               <CardHeader>1014 |                 <CardTitle className="text-white flex items-center">1015 |                   <CheckCircle size={20} className="mr-2 text-[#ffd700]" />1016 |                   Confirm Your Booking1017 |                 </CardTitle>1018 |               </CardHeader>1019 |               <CardContent className="space-y-6">1020 |                 <div className="grid grid-cols-1 md:grid-cols-2 gap-6">1021 |                   <div className="space-y-4">1022 |                     <h3 className="text-lg font-semibold text-white">Session Details</h3>1023 |                     <div className="space-y-3">1024 |                       <div className="flex justify-between">1025 |                         <span className="text-gray-400">Package:</span>1026 |                         <span className="text-white">{formData.selectedPackage?.name}</span>1027 |                       </div>1028 |                       <div className="flex justify-between">1029 |                         <span className="text-gray-400">Date:</span>1030 |                         <span className="text-white">{formatDate(formData.selectedSchedule!.date)}</span>1031 |                       </div>1032 |                       <div className="flex justify-between">1033 |                         <span className="text-gray-400">Time:</span>1034 |                         <span className="text-white">{formatTime(formData.selectedSchedule!.time)}</span>1035 |                       </div>1036 |                       <div className="flex justify-between">1037 |                         <span className="text-gray-400">Duration:</span>1038 |                         <span className="text-white">{formData.selectedPackage?.sessionDuration} minutes</span>1039 |                       </div>1040 |                     </div>1041 |                   </div>1042 | 1043 |                   <div className="space-y-4">1044 |                     <h3 className="text-lg font-semibold text-white">Personal Information</h3>1045 |                     <div className="space-y-3">1046 |                       <div className="flex justify-between">1047 |                         <span className="text-gray-400">Name:</span>1048 |                         <span className="text-white">{formData.clientName}</span>1049 |                       </div>1050 |                       <div className="flex justify-between">1051 |                         <span className="text-gray-400">Email:</span>1052 |                         <span className="text-white">{formData.clientEmail}</span>1053 |                       </div>1054 |                       <div className="flex justify-between">1055 |                         <span className="text-gray-400">Birth Date:</span>1056 |                         <span className="text-white">{formatDate(formData.birthDate)}</span>1057 |                       </div>1058 |                       <div className="flex justify-between">1059 |                         <span className="text-gray-400">Birth Place:</span>1060 |                         <span className="text-white">{formData.birthPlace}</span>1061 |                       </div>1062 |                     </div>1063 |                   </div>1064 |                 </div>1065 | 1066 |                 <div className="pt-4 border-t border-[#2a2a4a]">1067 |                   <h3 className="text-lg font-semibold text-white mb-3">Your Question</h3>1068 |                   <p className="text-gray-300 bg-[#16213e] p-3 rounded-lg">1069 |                     {formData.question}1070 |                   </p>1071 |                 </div>1072 | 1073 |                 <div className="flex justify-between pt-4">1074 |                   <BaseButton1075 |                     variant="outline"1076 |                     onClick={handleBackToPayment}1077 |                     className="border-[#2a2a4a] text-gray-400 hover:bg-[#2a2a4a] hover:text-white"1078 |                   >1079 |                     <ArrowLeft size={16} className="mr-2" />1080 |                     Back to Payment1081 |                   </BaseButton>1082 | 1083 |                   {}1084 |                   {paymentStatus === 'success' && (1085 |                     <div className="flex items-center text-green-400">1086 |                       <CheckCircle size={16} className="mr-2" />1087 |                       Payment Completed1088 |                     </div>1089 |                   )}1090 |                   <BaseButton1091 |                     onClick={handleSubmitBooking}1092 |                     disabled={processing}1093 |                     className="dashboard-button-primary"1094 |                   >1095 |                     {processing ? (1096 |                       <div className="flex items-center space-x-2">1097 |                         <motion.div1098 |                           animate={{ rotate: 360 }}1099 |                           transition={{ duration: 2, repeat: Infinity, ease: "linear" }}1100 |                           className="w-4 h-4 border-2 border-white border-t-transparent rounded-full"1101 |                         />1102 |                         <span>Creating Booking...</span>1103 |                       </div>1104 |                     ) : (1105 |                       <div className="flex items-center space-x-2">1106 |                         <CheckCircle size={16} />1107 |                         <span>Confirm Booking</span>1108 |                       </div>1109 |                     )}1110 |                   </BaseButton>1111 |                 </div>1112 |               </CardContent>1113 |             </Card>1114 |           </motion.div>1115 |         )}1116 | 1117 |         {currentStep === 5 && (1118 |           <motion.div1119 |             key="success"1120 |             initial={{ opacity: 0, scale: 0.95 }}1121 |             animate={{ opacity: 1, scale: 1 }}1122 |             transition={{ duration: 0.3 }}1123 |           >1124 |             <Card className="bg-[#1a1a2e] border-[#16213e] text-center">1125 |               <CardContent className="pt-8 pb-8">1126 |                 <div className="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6">1127 |                   <CheckCircle size={40} className="text-green-400" />1128 |                 </div>1129 | 1130 |                 <h2 className="text-3xl font-bold text-white mb-4">Booking Confirmed!</h2>1131 | 1132 |                 <p className="text-gray-300 mb-6">1133 |                   Your session has been successfully booked and paid for. You will receive a confirmation email shortly.1134 |                 </p>1135 | 1136 |                 <div className="bg-[#16213e] rounded-lg p-6 mb-6">1137 |                   <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">1138 |                     <div>1139 |                       <p className="text-gray-400 text-sm">Session Details</p>1140 |                       <p className="text-white font-medium">{formData.selectedPackage?.name}</p>1141 |                       <p className="text-gray-400 text-sm">1142 |                         {formatDate(formData.selectedSchedule!.date)} at {formatTime(formData.selectedSchedule!.time)}1143 |                       </p>1144 |                     </div>1145 |                     <div>1146 |                       <p className="text-gray-400 text-sm">Payment</p>1147 |                       <p className="text-green-400 font-medium">1148 |                         ${(formData.selectedSchedule!.price / 100).toFixed(2)} USD1149 |                       </p>1150 |                       <p className="text-gray-400 text-sm">Payment ID: {paymentIntentId?.slice(-8)}</p>1151 |                     </div>1152 |                   </div>1153 |                 </div>1154 | 1155 |                 <div className="space-y-3">1156 |                   <p className="text-gray-400 text-sm">1157 |                     📧 Check your email for session details and Zoom link1158 |                   </p>1159 |                   <p className="text-gray-400 text-sm">1160 |                     📅 Add this session to your calendar1161 |                   </p>1162 |                   <p className="text-gray-400 text-sm">1163 |                     📞 Join 5 minutes before your scheduled time1164 |                   </p>1165 |                 </div>1166 | 1167 |                 <div className="mt-8">1168 |                   <a href="/account/sessions">1169 |                     <BaseButton className="dashboard-button-primary">1170 |                       View My Sessions1171 |                     </BaseButton>1172 |                   </a>1173 |                 </div>1174 |               </CardContent>1175 |             </Card>1176 |           </motion.div>1177 |         )}1178 |       </AnimatePresence>1179 |     </div>1180 |   );1181 | }
============================================================END: frontend/components/CustomerBookingFlow.tsx============================================================


============================================================FILE: frontend/components/DynamicSectionRenderer.tsxSIZE: 3.05 KB============================================================
  1 | import React from 'react';  2 | import { motion } from 'framer-motion';  3 | import { SectionConfig } from '@/lib/content-config';  4 | import { HeroSection } from './HeroSection';  5 | import { ApproachSection } from './ApproachSection';  6 | import { SessionSection } from './SessionSection';  7 | import { AboutSection } from './AboutSection';  8 | import { BookingSection } from './BookingSection';  9 |  10 | interface DynamicSectionRendererProps { 11 |   section: SectionConfig; 12 |   t: Record<string, string | Record<string, string>>; 13 |   language: string; 14 |   scrollToSection: (section: string) => void; 15 | } 16 |  17 | const DynamicSectionRenderer: React.FC<DynamicSectionRendererProps> = ({ 18 |   section, 19 |   t, 20 |   language, 21 |   scrollToSection 22 | }) => { 23 |  24 |   const getResponsiveConfig = () => { 25 |     if (typeof window !== 'undefined') { 26 |       const isMobile = window.innerWidth < 768; 27 |       return isMobile ? section.mobileConfig : section.desktopConfig; 28 |     } 29 |     return section.desktopConfig; 30 |   }; 31 |  32 |   const config = getResponsiveConfig(); 33 |   const padding = config?.padding || 'pt-20 sm:pt-24 lg:pt-28 pb-12'; 34 |   const layout = config?.layout || 'center'; 35 |  36 |   const getSectionWrapperClasses = () => { 37 |     const baseClasses = `h-full flex flex-col justify-center px-3 sm:px-4 md:px-6 lg:px-8 ${padding} overflow-hidden safe-padding`; 38 |  39 |     switch (layout) { 40 |       case 'stack': 41 |         return `${baseClasses} items-center text-center space-y-4 sm:space-y-6 md:space-y-8`; 42 |       case 'grid': 43 |         return `${baseClasses} items-center`; 44 |       case 'center': 45 |         return `${baseClasses} items-center text-center space-y-4 sm:space-y-6 md:space-y-8`; 46 |       default: 47 |         return `${baseClasses} space-y-4 sm:space-y-6 md:space-y-8`; 48 |     } 49 |   }; 50 |  51 |   const renderSection = () => { 52 |     switch (section.component) { 53 |       case 'HeroSection': 54 |         return <HeroSection t={t} />; 55 |       case 'ApproachSection': 56 |         return <ApproachSection t={t} />; 57 |       case 'SessionSection': 58 |         return <SessionSection t={t} scrollToSection={scrollToSection} />; 59 |       case 'AboutSection': 60 |         return <AboutSection t={t} />; 61 |       case 'BookingSection': 62 |         return <BookingSection t={t} language={language} />; 63 |       default: 64 |         return ( 65 |           <div className="text-center"> 66 |             <h2 className="text-2xl sm:text-3xl lg:text-4xl font-bold text-[#FFD700] mb-4"> 67 |               {section.title} 68 |             </h2> 69 |             <p className="text-[#C0C0C0] text-lg"> 70 |               {section.description || 'Section content coming soon...'} 71 |             </p> 72 |           </div> 73 |         ); 74 |     } 75 |   }; 76 |  77 |   return ( 78 |     <motion.section 79 |       key={section.id} 80 |       initial={{ opacity: 0, y: 20 }} 81 |       animate={{ opacity: 1, y: 0 }} 82 |       exit={{ opacity: 0, y: -20 }} 83 |       transition={{ 84 |         duration: 0.5, 85 |         ease: [0.4, 0.0, 0.2, 1], 86 |         scale: { duration: 0.4 } 87 |       }} 88 |       className={getSectionWrapperClasses()} 89 |     > 90 |       {renderSection()} 91 |     </motion.section> 92 |   ); 93 | }; 94 |  95 | export default DynamicSectionRenderer;
============================================================END: frontend/components/DynamicSectionRenderer.tsx============================================================


============================================================FILE: frontend/components/EmailManagement.tsxSIZE: 56.53 KB============================================================
  1 | import { useState, useEffect, useCallback, useMemo } from 'react';  2 | import { motion, AnimatePresence } from 'framer-motion';  3 | import { Card, CardContent, CardHeader, CardTitle } from './ui/card';  4 | import { BaseButton } from './ui/BaseButton';  5 | import { BaseInput } from './ui/BaseInput';  6 | import { Label } from './ui/label';  7 | import { Textarea } from './ui/textarea';  8 | import { Switch } from './ui/switch';  9 | import { Tabs, TabsContent, TabsList, TabsTrigger } from './ui/tabs'; 10 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select'; 11 | import { Badge } from './ui/badge'; 12 | import { Mail, Send, TestTube, Save, Eye, Settings, Video, Info, AlertCircle, X } from 'lucide-react'; 13 | import { useAuth } from '../hooks/useAuth'; 14 |  15 | interface EmailTemplate { 16 |   en: { 17 |     subject: string; 18 |     html: string; 19 |     videoConferenceLink?: { 20 |       isActive: boolean; 21 |       url: string; 22 |       includeInTemplate?: boolean; 23 |     }; 24 |   }; 25 |   es: { 26 |     subject: string; 27 |     html: string; 28 |     videoConferenceLink?: { 29 |       isActive: boolean; 30 |       url: string; 31 |       includeInTemplate?: boolean; 32 |     }; 33 |   }; 34 | } 35 |  36 | interface EmailConfig { 37 |   brevoApiKey: string; 38 |   senderEmail: string; 39 |   senderName: string; 40 |   adminEmail: string; 41 |   defaultVideoLinks?: { 42 |     en?: string; 43 |     es?: string; 44 |   }; 45 | } 46 |  47 | interface Placeholder { 48 |   key: string; 49 |   description: string; 50 |   isConditional?: boolean; 51 |   isNew?: boolean; 52 | } 53 |  54 | const AVAILABLE_PLACEHOLDERS: Record<string, Placeholder[]> = { 55 |   basic: [ 56 |     { key: '{{userName}}', description: 'User\'s full name' }, 57 |     { key: '{{userEmail}}', description: 'User\'s email address' }, 58 |     { key: '{{bookingId}}', description: 'Unique booking ID' }, 59 |     { key: '{{language}}', description: 'Session language (English/Spanish)' }, 60 |     { key: '{{adminEmail}}', description: 'Admin contact email' }, 61 |     { key: '{{submissionDate}}', description: 'When the booking was submitted' } 62 |   ], 63 |   booking: [ 64 |     { key: '{{birthDate}}', description: 'Client\'s birth date' }, 65 |     { key: '{{birthTime}}', description: 'Client\'s birth time' }, 66 |     { key: '{{birthPlace}}', description: 'Client\'s birth location' }, 67 |     { key: '{{clientQuestion}}', description: 'Client\'s specific question' }, 68 |     { key: '{{bookingDate}}', description: 'Scheduled session date' }, 69 |     { key: '{{bookingTime}}', description: 'Scheduled session time' }, 70 |     { key: '{{reminderDate}}', description: 'Date reminder was sent' } 71 |   ], 72 |   scheduling: [ 73 |     { key: '{{newDate}}', description: 'New rescheduled date' }, 74 |     { key: '{{newTime}}', description: 'New rescheduled time' }, 75 |     { key: '{{oldDate}}', description: 'Previous date' }, 76 |     { key: '{{oldTime}}', description: 'Previous time' }, 77 |     { key: '{{rescheduleReason}}', description: 'Reason for rescheduling' }, 78 |     { key: '{{rescheduleDate}}', description: 'Date of reschedule' } 79 |   ], 80 |   video: [ 81 |     { key: '{{videoConferenceLink}}', description: 'Video session link (when active)', isConditional: true }, 82 |     { key: '{{VIDEO_LINK}}', description: 'Direct video link placeholder', isNew: true }, 83 |     { key: '{{#if videoConferenceLink}}...{{/if}}', description: 'Conditional video link block', isConditional: true } 84 |   ] 85 | }; 86 |  87 | export function EmailManagement() { 88 |   const { user } = useAuth(); 89 |   const [emailConfig, setEmailConfig] = useState<EmailConfig>({ 90 |     brevoApiKey: '', 91 |     senderEmail: '', 92 |     senderName: '', 93 |     adminEmail: '', 94 |     defaultVideoLinks: { 95 |       en: '', 96 |       es: '' 97 |     } 98 |   }); 99 |   const [emailTemplates, setEmailTemplates] = useState<Record<string, EmailTemplate>>({});100 |   const [activeTemplate, setActiveTemplate] = useState('userBookingConfirmation');101 |   const [activeLanguage, setActiveLanguage] = useState<'en' | 'es'>('en');102 |   const [showPreview, setShowPreview] = useState(false);103 |   const [testEmail, setTestEmail] = useState('');104 |   const [isSaving, setIsSaving] = useState(false);105 |   const [isTesting, setIsTesting] = useState(false);106 |   const [isLoading, setIsLoading] = useState(true);107 |   const [error, setError] = useState('');108 |   const [previewHtml, setPreviewHtml] = useState('');109 |   const [showPlaceholderHelper, setShowPlaceholderHelper] = useState(false);110 | 111 |   const defaultTemplates: Record<string, EmailTemplate> = useMemo(() => ({112 |     userBookingConfirmation: {113 |       en: {114 |         subject: 'Booking Confirmation - MatMax Yoga Studio',115 |         html: `<!DOCTYPE html>116 | <html>117 | <head>118 |     <meta charset="UTF-8">119 |     <meta name="viewport" content="width=device-width, initial-scale=1.0">120 |     <title>Booking Confirmation</title>121 |     <style>122 |         body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #f7f7f7; margin: 0; padding: 20px; }123 |         .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }124 |         .header { background: linear-gradient(135deg, #191970, #0A0A23); color: #FFD700; padding: 30px 20px; text-align: center; }125 |         .header h1 { margin: 0; font-size: 28px; font-weight: bold; }126 |         .content { padding: 30px; }127 |         .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #FFD700; }128 |         .detail-row { margin: 10px 0; }129 |         .label { font-weight: bold; color: #191970; }130 |         .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; }131 |         .video-link { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }132 |         .video-link a { color: #1976d2; text-decoration: none; font-weight: bold; }133 |     </style>134 | </head>135 | <body>136 |     <div class="container">137 |         <div class="header">138 |             <h1>✨ MatMax Yoga Studio ✨</h1>139 |             <p>Your cosmic journey begins here</p>140 |         </div>141 |         <div class="content">142 |             <h2>Thank you for your booking, {{userName}}!</h2>143 |             <p>We're excited to guide you through your astrological reading. Your booking has been received and is being processed.</p>144 | 145 |             <div class="booking-details">146 |                 <h3>📋 Booking Details</h3>147 |                 <div class="detail-row"><span class="label">Booking ID:</span> {{bookingId}}</div>148 |                 <div class="detail-row"><span class="label">Email:</span> {{userEmail}}</div>149 |                 <div class="detail-row"><span class="label">Language:</span> {{language}}</div>150 |                 <div class="detail-row"><span class="label">Birth Date:</span> {{birthDate}}</div>151 |                 <div class="detail-row"><span class="label">Birth Time:</span> {{birthTime}}</div>152 |                 <div class="detail-row"><span class="label">Birth Place:</span> {{birthPlace}}</div>153 |                 <div class="detail-row"><span class="label">Your Question:</span> {{clientQuestion}}</div>154 |                 <div class="detail-row"><span class="label">Submitted:</span> {{submissionDate}}</div>155 |             </div>156 | 157 |             {{#if videoConferenceLink}}158 |             <div class="video-link">159 |                 <h3>🎥 Your Video Conference Link</h3>160 |                 <p>Join your astrology reading session using the link below:</p>161 |                 <a href="{{VIDEO_LINK}}" target="_blank">Join Video Session</a>162 |                 <p><small>This link will be active 15 minutes before your scheduled session.</small></p>163 |             </div>164 |             {{/if}}165 | 166 |             <p><strong>What's Next?</strong></p>167 |             <ul>168 |                 <li>José will review your birth chart information</li>169 |                 <li>You'll receive a scheduling email within 24-48 hours</li>170 |                 <li>Your personalized reading will be conducted via video call</li>171 |             </ul>172 | 173 |             <p>If you have any questions, please don't hesitate to contact us at {{adminEmail}}.</p>174 |         </div>175 |         <div class="footer">176 |             <p>© 2024 MatMax Yoga Studio<br>177 |             Guiding souls through the wisdom of the stars</p>178 |         </div>179 |     </div>180 | </body>181 | </html>`,182 |         videoConferenceLink: {183 |           isActive: false,184 |           url: '',185 |           includeInTemplate: true186 |         }187 |       },188 |       es: {189 |         subject: 'Confirmación de Reserva - MatMax Yoga Studio',190 |         html: `<!DOCTYPE html>191 | <html>192 | <head>193 |     <meta charset="UTF-8">194 |     <meta name="viewport" content="width=device-width, initial-scale=1.0">195 |     <title>Confirmación de Cita</title>196 |     <style>197 |         body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #f7f7f7; margin: 0; padding: 20px; }198 |         .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }199 |         .header { background: linear-gradient(135deg, #191970, #0A0A23); color: #FFD700; padding: 30px 20px; text-align: center; }200 |         .header h1 { margin: 0; font-size: 28px; font-weight: bold; }201 |         .content { padding: 30px; }202 |         .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #FFD700; }203 |         .detail-row { margin: 10px 0; }204 |         .label { font-weight: bold; color: #191970; }205 |         .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; }206 |         .video-link { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }207 |         .video-link a { color: #1976d2; text-decoration: none; font-weight: bold; }208 |     </style>209 | </head>210 | <body>211 |     <div class="container">212 |         <div class="header">213 |             <h1>✨ MatMax Yoga Studio ✨</h1>214 |             <p>Tu viaje cósmico comienza aquí</p>215 |         </div>216 |         <div class="content">217 |             <h2>¡Gracias por tu reserva, {{userName}}!</h2>218 |             <p>Estamos emocionados de guiarte a través de tu lectura astrológica. Tu reserva ha sido recibida y está siendo procesada.</p>219 | 220 |             <div class="booking-details">221 |                 <h3>📋 Detalles de la Reserva</h3>222 |                 <div class="detail-row"><span class="label">ID de Reserva:</span> {{bookingId}}</div>223 |                 <div class="detail-row"><span class="label">Email:</span> {{userEmail}}</div>224 |                 <div class="detail-row"><span class="label">Idioma:</span> {{language}}</div>225 |                 <div class="detail-row"><span class="label">Fecha de Nacimiento:</span> {{birthDate}}</div>226 |                 <div class="detail-row"><span class="label">Hora de Nacimiento:</span> {{birthTime}}</div>227 |                 <div class="detail-row"><span class="label">Lugar de Nacimiento:</span> {{birthPlace}}</div>228 |                 <div class="detail-row"><span class="label">Tu Pregunta:</span> {{clientQuestion}}</div>229 |                 <div class="detail-row"><span class="label">Enviado:</span> {{submissionDate}}</div>230 |             </div>231 | 232 |             {{#if videoConferenceLink}}233 |             <div class="video-link">234 |                 <h3>🎥 Tu Enlace de Videoconferencia</h3>235 |                 <p>Únete a tu sesión de lectura astrológica usando el enlace de abajo:</p>236 |                 <a href="{{VIDEO_LINK}}" target="_blank">Unirse a la Sesión de Video</a>237 |                 <p><small>Este enlace estará activo 15 minutos antes de tu sesión programada.</small></p>238 |             </div>239 |             {{/if}}240 | 241 |             <p><strong>¿Qué sigue?</strong></p>242 |             <ul>243 |                 <li>José revisará la información de tu carta natal</li>244 |                 <li>Recibirás un email de programación dentro de 24-48 horas</li>245 |                 <li>Tu lectura personalizada se realizará por videollamada</li>246 |             </ul>247 | 248 |             <p>Si tienes alguna pregunta, no dudes en contactarnos en {{adminEmail}}.</p>249 |         </div>250 |         <div class="footer">251 |             <p>© 2024 MatMax Yoga Studio<br>252 |             Guiando almas a través de la sabiduría de las estrellas</p>253 |         </div>254 |     </div>255 | </body>256 | </html>`,257 |         videoConferenceLink: {258 |           isActive: false,259 |           url: '',260 |           includeInTemplate: true261 |         }262 |       }263 |     },264 |     bookingReminder: {265 |       en: {266 |         subject: 'Reminder: Your MatMax Yoga Class',267 |         html: `<!DOCTYPE html>268 | <html>269 | <head>270 |     <meta charset="UTF-8">271 |     <meta name="viewport" content="width=device-width, initial-scale=1.0">272 |     <title>Reading Reminder</title>273 |     <style>274 |         body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #f7f7f7; margin: 0; padding: 20px; }275 |         .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }276 |         .header { background: linear-gradient(135deg, #191970, #0A0A23); color: #FFD700; padding: 30px 20px; text-align: center; }277 |         .header h1 { margin: 0; font-size: 28px; font-weight: bold; }278 |         .content { padding: 30px; }279 |         .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #FFD700; }280 |         .detail-row { margin: 10px 0; }281 |         .label { font-weight: bold; color: #191970; }282 |         .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; }283 |         .video-link { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }284 |         .video-link a { color: #1976d2; text-decoration: none; font-weight: bold; }285 |         .reminder-alert { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }286 |     </style>287 | </head>288 | <body>289 |     <div class="container">290 |         <div class="header">291 |             <h1>🌟 Reading Reminder</h1>292 |             <p>Your cosmic guidance awaits</p>293 |         </div>294 |         <div class="content">295 |             <div class="reminder-alert">296 |                 <h3>⏰ Upcoming Session</h3>297 |                 <p>This is a friendly reminder about your upcoming astrology reading.</p>298 |             </div>299 | 300 |             <h2>Hello {{userName}},</h2>301 |             <p>We're looking forward to your astrology reading session!</p>302 | 303 |             <div class="booking-details">304 |                 <h3>📅 Session Details</h3>305 |                 <div class="detail-row"><span class="label">Date:</span> {{bookingDate}}</div>306 |                 <div class="detail-row"><span class="label">Time:</span> {{bookingTime}}</div>307 |                 <div class="detail-row"><span class="label">Language:</span> {{language}}</div>308 |                 <div class="detail-row"><span class="label">Booking ID:</span> {{bookingId}}</div>309 |             </div>310 | 311 |             {{#if videoConferenceLink}}312 |             <div class="video-link">313 |                 <h3>🎥 Join Your Session</h3>314 |                 <p>Click the link below to join your reading:</p>315 |                 <a href="{{VIDEO_LINK}}" target="_blank">Join Video Session</a>316 |                 <p><small>Link will be active 15 minutes before your session.</small></p>317 |             </div>318 |             {{/if}}319 | 320 |             <p><strong>What to expect:</strong></p>321 |             <ul>322 |                 <li>Detailed analysis of your birth chart</li>323 |                 <li>Insights into your cosmic influences</li>324 |                 <li>Guidance on your spiritual path</li>325 |                 <li>Time for your questions and discussion</li>326 |             </ul>327 | 328 |             <p>If you need to reschedule or have any questions, please contact us at {{adminEmail}}.</p>329 |         </div>330 |         <div class="footer">331 |             <p>© 2024 MatMax Yoga Studio<br>332 |             Reminder sent on {{reminderDate}}</p>333 |         </div>334 |     </div>335 | </body>336 | </html>`,337 |         videoConferenceLink: {338 |           isActive: false,339 |           url: '',340 |           includeInTemplate: true341 |         }342 |       },343 |       es: {344 |         subject: 'Recordatorio: Tu Clase en MatMax Yoga Studio',345 |         html: `<!DOCTYPE html>346 | <html>347 | <head>348 |     <meta charset="UTF-8">349 |     <meta name="viewport" content="width=device-width, initial-scale=1.0">350 |     <title>Recordatorio de Lectura</title>351 |     <style>352 |         body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #f7f7f7; margin: 0; padding: 20px; }353 |         .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }354 |         .header { background: linear-gradient(135deg, #191970, #0A0A23); color: #FFD700; padding: 30px 20px; text-align: center; }355 |         .header h1 { margin: 0; font-size: 28px; font-weight: bold; }356 |         .content { padding: 30px; }357 |         .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #FFD700; }358 |         .detail-row { margin: 10px 0; }359 |         .label { font-weight: bold; color: #191970; }360 |         .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; }361 |         .video-link { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }362 |         .video-link a { color: #1976d2; text-decoration: none; font-weight: bold; }363 |         .reminder-alert { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }364 |     </style>365 | </head>366 | <body>367 |     <div class="container">368 |         <div class="header">369 |             <h1>🌟 Recordatorio de Lectura</h1>370 |             <p>Tu guía cósmica te espera</p>371 |         </div>372 |         <div class="content">373 |             <div class="reminder-alert">374 |                 <h3>⏰ Sesión Próxima</h3>375 |                 <p>Este es un recordatorio amistoso sobre tu próxima lectura astrológica.</p>376 |             </div>377 | 378 |             <h2>Hola {{userName}},</h2>379 |             <p>¡Estamos esperando con ansias tu sesión de lectura astrológica!</p>380 | 381 |             <div class="booking-details">382 |                 <h3>📅 Detalles de la Sesión</h3>383 |                 <div class="detail-row"><span class="label">Fecha:</span> {{bookingDate}}</div>384 |                 <div class="detail-row"><span class="label">Hora:</span> {{bookingTime}}</div>385 |                 <div class="detail-row"><span class="label">Idioma:</span> {{language}}</div>386 |                 <div class="detail-row"><span class="label">ID de Reserva:</span> {{bookingId}}</div>387 |             </div>388 | 389 |             {{#if videoConferenceLink}}390 |             <div class="video-link">391 |                 <h3>🎥 Únete a tu Sesión</h3>392 |                 <p>Haz clic en el enlace de abajo para unirte a tu lectura:</p>393 |                 <a href="{{VIDEO_LINK}}" target="_blank">Unirse a la Sesión de Video</a>394 |                 <p><small>El enlace estará activo 15 minutos antes de tu sesión.</small></p>395 |             </div>396 |             {{/if}}397 | 398 |             <p><strong>Qué esperar:</strong></p>399 |             <ul>400 |                 <li>Análisis detallado de tu carta natal</li>401 |                 <li>Perspectivas sobre tus influencias cósmicas</li>402 |                 <li>Guía en tu camino espiritual</li>403 |                 <li>Tiempo para tus preguntas y discusión</li>404 |             </ul>405 | 406 |             <p>Si necesitas reprogramar o tienes alguna pregunta, por favor contáctanos en {{adminEmail}}.</p>407 |         </div>408 |         <div class="footer">409 |             <p>© 2024 MatMax Yoga Studio<br>410 |             Recordatorio enviado el {{reminderDate}}</p>411 |         </div>412 |     </div>413 | </body>414 | </html>`,415 |         videoConferenceLink: {416 |           isActive: false,417 |           url: '',418 |           includeInTemplate: true419 |         }420 |       }421 |     },422 |     adminBookingNotification: {423 |       en: {424 |         subject: 'New Booking Received - MatMax Yoga Studio',425 |         html: `<!DOCTYPE html>426 | <html>427 | <head>428 |     <meta charset="UTF-8">429 |     <meta name="viewport" content="width=device-width, initial-scale=1.0">430 |     <title>New Booking Notification</title>431 |     <style>432 |         body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #f7f7f7; margin: 0; padding: 20px; }433 |         .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }434 |         .header { background: linear-gradient(135deg, #191970, #0A0A23); color: #FFD700; padding: 30px 20px; text-align: center; }435 |         .header h1 { margin: 0; font-size: 28px; font-weight: bold; }436 |         .content { padding: 30px; }437 |         .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #FFD700; }438 |         .detail-row { margin: 10px 0; }439 |         .label { font-weight: bold; color: #191970; }440 |         .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; }441 |         .alert { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 8px; margin: 20px 0; }442 |     </style>443 | </head>444 | <body>445 |     <div class="container">446 |         <div class="header">447 |             <h1>🔔 New Booking Alert</h1>448 |             <p>MatMax Yoga Studio - Admin Notification</p>449 |         </div>450 |         <div class="content">451 |             <div class="alert">452 |                 <h3>📋 New Client Booking Received</h3>453 |                 <p>A new astrology reading has been booked. Please review the details below and schedule the session.</p>454 |             </div>455 | 456 |             <div class="booking-details">457 |                 <h3>👤 Client Information</h3>458 |                 <div class="detail-row"><span class="label">Name:</span> {{userName}}</div>459 |                 <div class="detail-row"><span class="label">Email:</span> {{userEmail}}</div>460 |                 <div class="detail-row"><span class="label">Booking ID:</span> {{bookingId}}</div>461 |                 <div class="detail-row"><span class="label">Language:</span> {{language}}</div>462 |                 <div class="detail-row"><span class="label">Submitted:</span> {{submissionDate}}</div>463 |             </div>464 | 465 |             <div class="booking-details">466 |                 <h3>🌟 Birth Chart Details</h3>467 |                 <div class="detail-row"><span class="label">Birth Date:</span> {{birthDate}}</div>468 |                 <div class="detail-row"><span class="label">Birth Time:</span> {{birthTime}}</div>469 |                 <div class="detail-row"><span class="label">Birth Place:</span> {{birthPlace}}</div>470 |                 <div class="detail-row"><span class="label">Client's Question:</span> {{clientQuestion}}</div>471 |             </div>472 | 473 |             <p><strong>Next Steps:</strong></p>474 |             <ul>475 |                 <li>Review the client's birth chart information</li>476 |                 <li>Schedule the session in the admin dashboard</li>477 |                 <li>Send scheduling confirmation to the client</li>478 |                 <li>Prepare personalized reading materials</li>479 |             </ul>480 | 481 |             <p>Login to the admin dashboard to manage this booking.</p>482 |         </div>483 |         <div class="footer">484 |             <p>© 2024 MatMax Yoga Studio - Admin System<br>485 |             Booking notification sent automatically</p>486 |         </div>487 |     </div>488 | </body>489 | </html>`,490 |         videoConferenceLink: {491 |           isActive: false,492 |           url: '',493 |           includeInTemplate: false494 |         }495 |       },496 |       es: {497 |         subject: 'Nueva Reserva Recibida - MatMax Yoga Studio',498 |         html: `<!DOCTYPE html>499 | <html>500 | <head>501 |     <meta charset="UTF-8">502 |     <meta name="viewport" content="width=device-width, initial-scale=1.0">503 |     <title>Notificación de Nueva Reserva</title>504 |     <style>505 |         body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #f7f7f7; margin: 0; padding: 20px; }506 |         .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }507 |         .header { background: linear-gradient(135deg, #191970, #0A0A23); color: #FFD700; padding: 30px 20px; text-align: center; }508 |         .header h1 { margin: 0; font-size: 28px; font-weight: bold; }509 |         .content { padding: 30px; }510 |         .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #FFD700; }511 |         .detail-row { margin: 10px 0; }512 |         .label { font-weight: bold; color: #191970; }513 |         .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; }514 |         .alert { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 8px; margin: 20px 0; }515 |     </style>516 | </head>517 | <body>518 |     <div class="container">519 |         <div class="header">520 |             <h1>🔔 Nueva Alerta de Reserva</h1>521 |             <p>MatMax Yoga Studio - Notificación Admin</p>522 |         </div>523 |         <div class="content">524 |             <div class="alert">525 |                 <h3>📋 Nueva Reserva de Cliente Recibida</h3>526 |                 <p>Se ha reservado una nueva lectura astrológica. Por favor revisa los detalles abajo y programa la sesión.</p>527 |             </div>528 | 529 |             <div class="booking-details">530 |                 <h3>👤 Información del Cliente</h3>531 |                 <div class="detail-row"><span class="label">Nombre:</span> {{userName}}</div>532 |                 <div class="detail-row"><span class="label">Email:</span> {{userEmail}}</div>533 |                 <div class="detail-row"><span class="label">ID de Reserva:</span> {{bookingId}}</div>534 |                 <div class="detail-row"><span class="label">Idioma:</span> {{language}}</div>535 |                 <div class="detail-row"><span class="label">Enviado:</span> {{submissionDate}}</div>536 |             </div>537 | 538 |             <div class="booking-details">539 |                 <h3>🌟 Detalles de la Carta Natal</h3>540 |                 <div class="detail-row"><span class="label">Fecha de Nacimiento:</span> {{birthDate}}</div>541 |                 <div class="detail-row"><span class="label">Hora de Nacimiento:</span> {{birthTime}}</div>542 |                 <div class="detail-row"><span class="label">Lugar de Nacimiento:</span> {{birthPlace}}</div>543 |                 <div class="detail-row"><span class="label">Pregunta del Cliente:</span> {{clientQuestion}}</div>544 |             </div>545 | 546 |             <p><strong>Próximos Pasos:</strong></p>547 |             <ul>548 |                 <li>Revisar la información de la carta natal del cliente</li>549 |                 <li>Programar la sesión en el panel administrativo</li>550 |                 <li>Enviar confirmación de programación al cliente</li>551 |                 <li>Preparar materiales de lectura personalizados</li>552 |             </ul>553 | 554 |             <p>Inicia sesión en el panel administrativo para gestionar esta reserva.</p>555 |         </div>556 |         <div class="footer">557 |             <p>© 2024 MatMax Yoga Studio - Sistema Admin<br>558 |             Notificación de reserva enviada automáticamente</p>559 |         </div>560 |     </div>561 | </body>562 | </html>`,563 |         videoConferenceLink: {564 |           isActive: false,565 |           url: '',566 |           includeInTemplate: false567 |         }568 |       }569 |     }570 |   }), []);571 | 572 |   const loadEmailConfig = useCallback(async () => {573 |     try {574 |       const authToken = user?.access_token;575 |       if (!authToken) {576 |         return;577 |       }578 | 579 |       const response = await fetch(`/api/admin/email/config`, {580 |         headers: {581 |           'Authorization': `Bearer ${authToken}`,582 |           'Content-Type': 'application/json'583 |         }584 |       });585 | 586 |       if (response.ok) {587 |         const data = await response.json();588 |         setEmailConfig(data.config || emailConfig);589 |       } else {590 |         }591 |     } catch (error) {592 |       }593 |   }, [user?.access_token, emailConfig]);594 | 595 |   const loadEmailTemplates = useCallback(async () => {596 |     try {597 |       const authToken = user?.access_token;598 |       if (!authToken) {599 |         return;600 |       }601 | 602 |       const response = await fetch(`/api/admin/email/templates`, {603 |         headers: {604 |           'Authorization': `Bearer ${authToken}`,605 |           'Content-Type': 'application/json'606 |         }607 |       });608 | 609 |       if (response.ok) {610 |         const data = await response.json();611 | 612 |         const mergedTemplates = { ...defaultTemplates };613 |         if (data.templates && Object.keys(data.templates).length > 0) {614 |           Object.assign(mergedTemplates, data.templates);615 |         }616 | 617 |         setEmailTemplates(mergedTemplates);618 |       } else {619 | 620 |         setEmailTemplates(defaultTemplates);621 |       }622 |     } catch (error) {623 | 624 |       setEmailTemplates(defaultTemplates);625 |     }626 |   }, [user?.access_token, defaultTemplates]);627 | 628 |   useEffect(() => {629 |     const initializeEmailManagement = async () => {630 |       if (user?.access_token) {631 |         setIsLoading(true);632 |         setError('');633 |         try {634 |           await Promise.all([635 |             loadEmailConfig(),636 |             loadEmailTemplates()637 |           ]);638 |         } catch (error) {639 |           setError('Failed to load email settings. Using defaults.');640 |         } finally {641 |           setIsLoading(false);642 |         }643 |       } else {644 | 645 |         setEmailTemplates(defaultTemplates);646 |         setIsLoading(false);647 |       }648 |     };649 | 650 |     initializeEmailManagement();651 |   }, [user?.access_token, loadEmailConfig, loadEmailTemplates, defaultTemplates]);652 | 653 |   const saveEmailConfig = async () => {654 |     if (!user?.access_token) return;655 | 656 |     try {657 |       setIsSaving(true);658 |       const response = await fetch(`/api/admin/email/config`, {659 |         method: 'PUT',660 |         headers: {661 |           'Authorization': `Bearer ${user.access_token}`,662 |           'Content-Type': 'application/json'663 |         },664 |         body: JSON.stringify({ config: emailConfig })665 |       });666 | 667 |       if (!response.ok) {668 |         throw new Error('Failed to save email config');669 |       }670 | 671 |       alert('Email configuration saved successfully!');672 |     } catch (error) {673 |       alert('Failed to save email configuration. Please try again.');674 |     } finally {675 |       setIsSaving(false);676 |     }677 |   };678 | 679 |   const saveEmailTemplates = async () => {680 |     if (!user?.access_token) return;681 | 682 |     try {683 |       setIsSaving(true);684 |       const response = await fetch(`/api/admin/email/templates`, {685 |         method: 'PUT',686 |         headers: {687 |           'Authorization': `Bearer ${user.access_token}`,688 |           'Content-Type': 'application/json'689 |         },690 |         body: JSON.stringify({ templates: emailTemplates })691 |       });692 | 693 |       if (!response.ok) {694 |         throw new Error('Failed to save email templates');695 |       }696 | 697 |       alert('Email templates saved successfully!');698 |     } catch (error) {699 |       alert('Failed to save email templates. Please try again.');700 |     } finally {701 |       setIsSaving(false);702 |     }703 |   };704 | 705 |   const testEmailSending = async () => {706 |     if (!testEmail || !user?.access_token) return;707 | 708 |     try {709 |       setIsTesting(true);710 |       const response = await fetch(`/api/admin/email/test`, {711 |         method: 'POST',712 |         headers: {713 |           'Authorization': `Bearer ${user.access_token}`,714 |           'Content-Type': 'application/json'715 |         },716 |         body: JSON.stringify({717 |           to: testEmail,718 |           language: activeLanguage719 |         })720 |       });721 | 722 |       if (!response.ok) {723 |         throw new Error('Failed to send test email');724 |       }725 | 726 |       alert(`Test email sent successfully to ${testEmail}!`);727 |     } catch (error) {728 |       alert('Failed to send test email. Please check your configuration.');729 |     } finally {730 |       setIsTesting(false);731 |     }732 |   };733 | 734 |   const handlePreview = () => {735 |     try {736 |       if (!emailTemplates[activeTemplate]?.[activeLanguage]) {737 |         setError('No template available for preview');738 |         return;739 |       }740 | 741 |       const template = emailTemplates[activeTemplate][activeLanguage];742 | 743 |       let previewContent = template.html;744 | 745 |       const sampleData = {746 |         '{{userName}}': 'María García',747 |         '{{userEmail}}': 'maria@example.com',748 |         '{{bookingId}}': 'BK-2024-001',749 |         '{{language}}': activeLanguage === 'en' ? 'English' : 'Español',750 |         '{{adminEmail}}': emailConfig.adminEmail || 'admin@soulpath.lat',751 |         '{{submissionDate}}': new Date().toLocaleDateString(),752 |         '{{birthDate}}': '1985-06-15',753 |         '{{birthTime}}': '14:30',754 |         '{{birthPlace}}': 'Lima, Peru',755 |         '{{clientQuestion}}': activeLanguage === 'en' ? 'What does my birth chart reveal about my career path?' : '¿Qué revela mi carta natal sobre mi camino profesional?',756 |         '{{bookingDate}}': '2024-01-15',757 |         '{{bookingTime}}': '15:00',758 |         '{{reminderDate}}': new Date().toLocaleDateString(),759 |         '{{VIDEO_LINK}}': 'https:760 |       };761 | 762 |       Object.entries(sampleData).forEach(([placeholder, value]) => {763 |         previewContent = previewContent.replace(new RegExp(placeholder.replace(/[{}]/g, '\\$&'), 'g'), value);764 |       });765 | 766 |       const videoLinkSettings = template.videoConferenceLink;767 |       if (videoLinkSettings?.isActive && videoLinkSettings?.includeInTemplate) {768 | 769 |         previewContent = previewContent.replace(/\{\{#if videoConferenceLink\}\}/g, '');770 |         previewContent = previewContent.replace(/\{\{\/if\}\}/g, '');771 |       } else {772 | 773 |         previewContent = previewContent.replace(/\{\{#if videoConferenceLink\}\}[\s\S]*?\{\{\/if\}\}/g, '');774 |       }775 | 776 |       setPreviewHtml(previewContent);777 |       setShowPreview(true);778 |     } catch (error) {779 |       setError('Failed to generate preview');780 |     }781 |   };782 | 783 |   const updateTemplate = (field: string, value: string) => {784 |     setEmailTemplates(prev => ({785 |       ...prev,786 |       [activeTemplate]: {787 |         ...prev[activeTemplate],788 |         [activeLanguage]: {789 |           ...prev[activeTemplate][activeLanguage],790 |           [field]: value791 |         }792 |       }793 |     }));794 |   };795 | 796 |   const updateVideoLinkSettings = (field: string, value: string | boolean) => {797 |     setEmailTemplates(prev => ({798 |       ...prev,799 |       [activeTemplate]: {800 |         ...prev[activeTemplate],801 |         [activeLanguage]: {802 |           ...prev[activeTemplate][activeLanguage],803 |           videoConferenceLink: {804 |             ...prev[activeTemplate][activeLanguage].videoConferenceLink,805 |             [field]: value806 |           }807 |         }808 |       }809 |     }));810 |   };811 | 812 |   if (isLoading) {813 |     return (814 |       <div className="flex items-center justify-center h-64">815 |         <motion.div816 |           animate={{ rotate: 360 }}817 |           transition={{ duration: 2, repeat: Infinity, ease: "linear" }}818 |           className="w-8 h-8 border-4 border-[#FFD700] border-t-transparent rounded-full"819 |         />820 |       </div>821 |     );822 |   }823 | 824 |   const currentTemplate = emailTemplates[activeTemplate]?.[activeLanguage];825 | 826 |   return (827 |     <div className="dashboard-container p-6 space-y-6">828 |       <div className="flex items-center justify-between">829 |         <div>830 |           <h1 className="dashboard-text-primary text-3xl font-bold">Email Management</h1>831 |           <p className="dashboard-text-secondary">Configure email templates and settings for automated communications</p>832 |         </div>833 | 834 |         <div className="flex gap-2">835 |           <BaseButton836 |             onClick={saveEmailConfig}837 |             disabled={isSaving}838 |             className="dashboard-button-primary"839 |           >840 |             {isSaving ? (841 |               <motion.div842 |                 animate={{ rotate: 360 }}843 |                 transition={{ duration: 1, repeat: Infinity, ease: "linear" }}844 |                 className="w-4 h-4 border-2 border-[#0A0A23] border-t-transparent rounded-full mr-2"845 |               />846 |             ) : (847 |               <Save size={16} className="mr-2" />848 |             )}849 |             Save Config850 |         </BaseButton>851 | 852 |           <BaseButton853 |             onClick={saveEmailTemplates}854 |             disabled={isSaving}855 |             className="dashboard-button-primary"856 |           >857 |             {isSaving ? (858 |               <motion.div859 |                 animate={{ rotate: 360 }}860 |                 transition={{ duration: 1, repeat: Infinity, ease: "linear" }}861 |                 className="w-4 h-4 border-t-transparent rounded-full mr-2"862 |               />863 |             ) : (864 |               <Save size={16} className="mr-2" />865 |             )}866 |             Save Templates867 |           </BaseButton>868 |             </div>869 |       </div>870 | 871 |       {error && (872 |         <div className="bg-red-500/10 border border-red-500/20 rounded-lg p-4 flex items-center space-x-3">873 |           <AlertCircle size={20} className="text-red-400" />874 |           <span className="text-red-400">{error}</span>875 |       </div>876 |       )}877 | 878 |       <Tabs defaultValue="config" className="w-full">879 |         <TabsList className="dashboard-tabs">880 |           <TabsTrigger value="config" className="dashboard-tab">881 |             <Settings size={16} className="mr-2" />882 |             Configuration883 |           </TabsTrigger>884 |           <TabsTrigger value="templates" className="dashboard-tab">885 |             <Mail size={16} className="mr-2" />886 |             Templates887 |           </TabsTrigger>888 |           <TabsTrigger value="test" className="dashboard-tab">889 |             <TestTube size={16} className="mr-2" />890 |             Testing891 |           </TabsTrigger>892 |         </TabsList>893 | 894 |         {}895 |         <TabsContent value="config" className="space-y-4">896 |           <Card className="dashboard-card">897 |         <CardHeader>898 |               <CardTitle className="dashboard-card-title flex items-center space-x-2">899 |                 <Settings size={20} />900 |                 <span>Email Service Configuration</span>901 |               </CardTitle>902 |         </CardHeader>903 |             <CardContent className="space-y-6">904 |               <div className="grid grid-cols-1 md:grid-cols-2 gap-6">905 |                 <div className="space-y-4">906 |                   <div>907 |                     <Label className="text-[#C0C0C0]">Brevo API Key</Label>908 |                     <BaseInput909 |                 type="password"910 |                 value={emailConfig.brevoApiKey}911 |                 onChange={(e) => setEmailConfig(prev => ({ ...prev, brevoApiKey: e.target.value }))}912 |                       placeholder="Enter your Brevo API key"913 |                       className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"914 |               />915 |             </div>916 | 917 |                   <div>918 |                     <Label className="text-[#C0C0C0]">Sender Email</Label>919 |                     <BaseInput920 |                 type="email"921 |                 value={emailConfig.senderEmail}922 |                 onChange={(e) => setEmailConfig(prev => ({ ...prev, senderEmail: e.target.value }))}923 |                       placeholder="noreply@yourdomain.com"924 |                       className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"925 |               />926 |                   </div>927 |             </div>928 | 929 |                 <div className="space-y-4">930 |                   <div>931 |                     <Label className="text-[#C0C0C0]">Sender Name</Label>932 |                     <BaseInput933 |                 value={emailConfig.senderName}934 |                 onChange={(e) => setEmailConfig(prev => ({ ...prev, senderName: e.target.value }))}935 |                       placeholder="SoulPath Astrology"936 |                       className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"937 |               />938 |             </div>939 | 940 |                   <div>941 |                     <Label className="text-[#C0C0C0]">Admin Email</Label>942 |                     <BaseInput943 |                 type="email"944 |                 value={emailConfig.adminEmail}945 |                 onChange={(e) => setEmailConfig(prev => ({ ...prev, adminEmail: e.target.value }))}946 |                       placeholder="admin@yourdomain.com"947 |                       className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"948 |               />949 |                   </div>950 |             </div>951 |           </div>952 | 953 |               {}954 |               <div className="space-y-4 border-t border-[#C0C0C0]/20 pt-6">955 |                 <h3 className="text-[#EAEAEA] font-heading text-lg flex items-center space-x-2">956 |                   <Video size={18} />957 |                   <span>Default Video Conference Links</span>958 |                 </h3>959 | 960 |                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">961 |                   <div>962 |                     <Label className="text-[#C0C0C0]">English Sessions</Label>963 |                     <BaseInput964 |                       value={emailConfig.defaultVideoLinks?.en || ''}965 |                       onChange={(e) => setEmailConfig(prev => ({966 |                         ...prev,967 |                         defaultVideoLinks: {968 |                           ...prev.defaultVideoLinks,969 |                           en: e.target.value970 |                         }971 |                       }))}972 |                       placeholder="https:973 |                       className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"974 |                     />975 |           </div>976 | 977 |                   <div>978 |                     <Label className="text-[#C0C0C0]">Spanish Sessions</Label>979 |                     <BaseInput980 |                       value={emailConfig.defaultVideoLinks?.es || ''}981 |                       onChange={(e) => setEmailConfig(prev => ({982 |                         ...prev,983 |                         defaultVideoLinks: {984 |                           ...prev.defaultVideoLinks,985 |                           es: e.target.value986 |                         }987 |                       }))}988 |                       placeholder="https:989 |                       className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"990 |                     />991 |             </div>992 |             </div>993 |               </div>994 |         </CardContent>995 |       </Card>996 |         </TabsContent>997 | 998 |         {}999 |         <TabsContent value="templates">1000 |           <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">1001 |             {}1002 |             <div className="lg:col-span-1">1003 |               <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">1004 |         <CardHeader>1005 |                   <CardTitle className="text-[#EAEAEA] text-sm">Templates</CardTitle>1006 |         </CardHeader>1007 |                 <CardContent className="space-y-2">1008 |                   {Object.keys(emailTemplates).map((templateKey) => (1009 |                     <button1010 |                       key={templateKey}1011 |                       onClick={() => setActiveTemplate(templateKey)}1012 |                       className={`w-full text-left px-3 py-2 rounded-lg transition-colors text-sm ${1013 |                         activeTemplate === templateKey1014 |                           ? 'bg-[#FFD700]/10 text-[#FFD700] border border-[#FFD700]/30'1015 |                           : 'text-[#C0C0C0] hover:text-[#EAEAEA] hover:bg-[#C0C0C0]/5'1016 |                       }`}1017 |                     >1018 |                       {templateKey === 'userBookingConfirmation' && '📧 User Confirmation'}1019 |                       {templateKey === 'adminBookingNotification' && '🔔 Admin Notification'}1020 |                       {templateKey === 'bookingReminder' && '⏰ Booking Reminder'}1021 |                     </button>1022 |                   ))}1023 | 1024 |                   {}1025 |                   <div className="pt-4 border-t border-[#C0C0C0]/20">1026 |                     <Label className="text-[#C0C0C0] text-xs">Language</Label>1027 |                     <div className="flex bg-[#0A0A23]/50 rounded-lg p-1 mt-1">1028 |                       <button1029 |                         onClick={() => setActiveLanguage('en')}1030 |                         className={`flex-1 px-2 py-1 text-xs rounded-md transition-colors ${1031 |                           activeLanguage === 'en'1032 |                             ? 'bg-[#FFD700] text-[#0A0A23]'1033 |                             : 'text-[#C0C0C0] hover:text-[#FFD700]'1034 |                         }`}1035 |                       >1036 |                         🇺🇸 EN1037 |                       </button>1038 |                       <button1039 |                         onClick={() => setActiveLanguage('es')}1040 |                         className={`flex-1 px-2 py-1 text-xs rounded-md transition-colors ${1041 |                           activeLanguage === 'es'1042 |                             ? 'bg-[#FFD700] text-[#0A0A23]'1043 |                             : 'text-[#C0C0C0] hover:text-[#FFD700]'1044 |                         }`}1045 |                       >1046 |                         🇪🇸 ES1047 |                       </button>1048 |                     </div>1049 |           </div>1050 |         </CardContent>1051 |       </Card>1052 |             </div>1053 | 1054 |             {}1055 |             <div className="lg:col-span-3">1056 |               <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">1057 |         <CardHeader>1058 |                   <CardTitle className="text-[#EAEAEA] flex items-center justify-between">1059 |                     <span>Edit Template - {activeLanguage === 'en' ? 'English' : 'Español'}</span>1060 |                     <div className="flex items-center space-x-2">1061 |                       <BaseButton1062 |                         onClick={() => setShowPlaceholderHelper(!showPlaceholderHelper)}1063 |                         variant="outline"1064 |                         size="sm"1065 |                         className="border-[#C0C0C0]/30 text-[#C0C0C0] hover:bg-[#C0C0C0]/10"1066 |                       >1067 |                         <Info size={14} className="mr-1" />1068 |                         Placeholders1069 |                       </BaseButton>1070 |                       <BaseButton1071 |                         onClick={handlePreview}1072 |                         variant="outline"1073 |                         size="sm"1074 |                         className="border-[#FFD700]/30 text-[#FFD700] hover:bg-[#FFD700]/10"1075 |                       >1076 |                         <Eye size={14} className="mr-1" />1077 |                         Preview1078 |                       </BaseButton>1079 |                     </div>1080 |                   </CardTitle>1081 |                 </CardHeader>1082 |                 <CardContent className="space-y-4">1083 |                   {currentTemplate && (1084 |                     <>1085 |                       {}1086 |                       <div>1087 |                         <Label className="text-[#C0C0C0]">Subject Line</Label>1088 |                         <BaseInput1089 |                           value={currentTemplate.subject || ''}1090 |                           onChange={(e) => updateTemplate('subject', e.target.value)}1091 |                           className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"1092 |                         />1093 |                   </div>1094 | 1095 |                       {}1096 |                       <div className="space-y-3 border border-[#C0C0C0]/20 rounded-lg p-4">1097 |                         <h4 className="text-[#EAEAEA] font-medium flex items-center space-x-2">1098 |                           <Video size={16} />1099 |                           <span>Video Conference Settings</span>1100 |                         </h4>1101 | 1102 |                         <div className="flex items-center space-x-3">1103 |                           <Switch1104 |                             checked={currentTemplate.videoConferenceLink?.isActive || false}1105 |                             onCheckedChange={(checked) => updateVideoLinkSettings('isActive', checked)}1106 |                           />1107 |                           <Label className="text-[#C0C0C0]">Enable video conference links</Label>1108 |                   </div>1109 | 1110 |                         {currentTemplate.videoConferenceLink?.isActive && (1111 |                           <>1112 |                             <div className="flex items-center space-x-3">1113 |                               <Switch1114 |                                 checked={currentTemplate.videoConferenceLink?.includeInTemplate !== false}1115 |                                 onCheckedChange={(checked) => updateVideoLinkSettings('includeInTemplate', checked)}1116 |                               />1117 |                               <Label className="text-[#C0C0C0]">Include video link in template</Label>1118 |                     </div>1119 | 1120 |                             <div>1121 |                               <Label className="text-[#C0C0C0]">Default Video Conference URL</Label>1122 |                               <BaseInput1123 |                                 value={currentTemplate.videoConferenceLink?.url || ''}1124 |                                 onChange={(e) => updateVideoLinkSettings('url', e.target.value)}1125 |                                 placeholder="https:1126 |                                 className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"1127 |                               />1128 |                     </div>1129 |                           </>1130 |                   )}1131 |                 </div>1132 | 1133 |                       {}1134 |                       <div>1135 |                         <Label className="text-[#C0C0C0]">HTML Content</Label>1136 |                         <Textarea1137 |                           value={currentTemplate.html || ''}1138 |                           onChange={(e) => updateTemplate('html', e.target.value)}1139 |                           className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA] min-h-[400px] font-mono text-sm"1140 |                           placeholder="Enter your HTML email template..."1141 |                         />1142 |                 </div>1143 |                     </>1144 |           )}1145 |         </CardContent>1146 |       </Card>1147 |         </div>1148 |           </div>1149 | 1150 |           {}1151 |       <AnimatePresence>1152 |             {showPlaceholderHelper && (1153 |           <motion.div1154 |                 initial={{ opacity: 0, height: 0 }}1155 |                 animate={{ opacity: 1, height: 'auto' }}1156 |                 exit={{ opacity: 0, height: 0 }}1157 |                 className="mt-4"1158 |               >1159 |                 <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">1160 |                   <CardHeader>1161 |                     <CardTitle className="text-[#EAEAEA] text-lg">Available Placeholders</CardTitle>1162 |                   </CardHeader>1163 |                   <CardContent>1164 |                     <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">1165 |                       {Object.entries(AVAILABLE_PLACEHOLDERS).map(([category, placeholders]) => (1166 |                         <div key={category}>1167 |                           <h4 className="text-[#FFD700] font-medium mb-2 capitalize">{category}</h4>1168 |                           <div className="space-y-1">1169 |                             {placeholders.map((placeholder) => (1170 |                               <div1171 |                                 key={placeholder.key}1172 |                                 className={`text-xs p-2 rounded bg-[#0A0A23]/50 border ${1173 |                                   placeholder.isNew ? 'border-[#FFD700]/50 bg-[#FFD700]/5' : 'border-[#C0C0C0]/20'1174 |                                 }`}1175 |                               >1176 |                                 <code className="text-[#FFD700]">{placeholder.key}</code>1177 |                                 <p className="text-[#C0C0C0] mt-1">{placeholder.description}</p>1178 |                                 {placeholder.isNew && (1179 |                                   <Badge className="mt-1 bg-[#FFD700] text-[#0A0A23] text-xs">NEW</Badge>1180 |                                 )}1181 |                                 {placeholder.isConditional && (1182 |                                   <Badge className="mt-1 bg-blue-500 text-white text-xs">CONDITIONAL</Badge>1183 |                                 )}1184 |                               </div>1185 |                             ))}1186 |                           </div>1187 |                         </div>1188 |                       ))}1189 |                     </div>1190 |                   </CardContent>1191 |                 </Card>1192 |           </motion.div>1193 |         )}1194 |       </AnimatePresence>1195 |         </TabsContent>1196 | 1197 |         {}1198 |         <TabsContent value="test">1199 |           <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">1200 |             <CardHeader>1201 |               <CardTitle className="text-[#EAEAEA] flex items-center space-x-2">1202 |                 <TestTube size={20} />1203 |                 <span>Email Testing</span>1204 |               </CardTitle>1205 |             </CardHeader>1206 |             <CardContent className="space-y-4">1207 |               <div className="grid grid-cols-1 md:grid-cols-3 gap-4">1208 |                 <div>1209 |                   <Label className="text-[#C0C0C0]">Test Email Address</Label>1210 |                   <BaseInput1211 |                     type="email"1212 |                     value={testEmail}1213 |                     onChange={(e) => setTestEmail(e.target.value)}1214 |                     placeholder="test@example.com"1215 |                     className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"1216 |                   />1217 |                 </div>1218 | 1219 |                 <div>1220 |                   <Label className="text-[#C0C0C0]">Template</Label>1221 |                   <Select value={activeTemplate} onValueChange={setActiveTemplate}>1222 |                     <SelectTrigger className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]">1223 |                       <SelectValue />1224 |                     </SelectTrigger>1225 |                     <SelectContent>1226 |                       <SelectItem value="userBookingConfirmation">User Confirmation</SelectItem>1227 |                       <SelectItem value="adminBookingNotification">Admin Notification</SelectItem>1228 |                       <SelectItem value="bookingReminder">Booking Reminder</SelectItem>1229 |                     </SelectContent>1230 |                   </Select>1231 |                 </div>1232 | 1233 |                 <div>1234 |                   <Label className="text-[#C0C0C0]">Language</Label>1235 |                   <Select value={activeLanguage} onValueChange={(value: 'en' | 'es') => setActiveLanguage(value)}>1236 |                     <SelectTrigger className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]">1237 |                       <SelectValue />1238 |                     </SelectTrigger>1239 |                     <SelectContent>1240 |                       <SelectItem value="en">🇺🇸 English</SelectItem>1241 |                       <SelectItem value="es">🇪🇸 Español</SelectItem>1242 |                     </SelectContent>1243 |                   </Select>1244 |                 </div>1245 |               </div>1246 | 1247 |               <BaseButton1248 |                 onClick={testEmailSending}1249 |                 disabled={isTesting || !testEmail}1250 |                 className="dashboard-button-primary"1251 |               >1252 |                 {isTesting ? (1253 |             <motion.div1254 |                     animate={{ rotate: 360 }}1255 |                     transition={{ duration: 1, repeat: Infinity, ease: "linear" }}1256 |                     className="w-4 h-4 border-2 border-[#0A0A23] border-t-transparent rounded-full mr-2"1257 |                   />1258 |                 ) : (1259 |                   <Send size={16} className="mr-2" />1260 |                 )}1261 |                 Send Test Email1262 |               </BaseButton>1263 |             </CardContent>1264 |           </Card>1265 |         </TabsContent>1266 |       </Tabs>1267 | 1268 |       {}1269 |       <AnimatePresence>1270 |         {showPreview && (1271 |           <motion.div1272 |             initial={{ opacity: 0 }}1273 |             animate={{ opacity: 1 }}1274 |             exit={{ opacity: 0 }}1275 |             className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"1276 |             onClick={() => setShowPreview(false)}1277 |           >1278 |             <motion.div1279 |               initial={{ scale: 0.95 }}1280 |               animate={{ scale: 1 }}1281 |               exit={{ scale: 0.95 }}1282 |               className="w-full max-w-4xl max-h-[90vh] bg-[#0A0A23] rounded-lg border border-[#C0C0C0]/20 overflow-hidden"1283 |               onClick={(e) => e.stopPropagation()}1284 |             >1285 |               <div className="flex items-center justify-between p-4 border-b border-[#C0C0C0]/20">1286 |                 <h3 className="text-[#EAEAEA] font-heading text-lg">Email Preview</h3>1287 |                 <BaseButton1288 |                   onClick={() => setShowPreview(false)}1289 |                   variant="ghost"1290 |                   size="sm"1291 |                   className="text-[#C0C0C0] hover:text-[#EAEAEA]"1292 |                 >1293 |                   <X size={20} />1294 |                 </BaseButton>1295 |               </div>1296 | 1297 |               <div className="p-4 h-[calc(90vh-80px)] overflow-auto">1298 |                 <div className="bg-white rounded-lg">1299 |                   <iframe1300 |                     srcDoc={previewHtml}1301 |                     className="w-full h-full min-h-[600px] rounded-lg"1302 |                     title="Email Preview"1303 |                   />1304 |                 </div>1305 |               </div>1306 |             </motion.div>1307 |           </motion.div>1308 |         )}1309 |       </AnimatePresence>1310 |     </div>1311 |   );1312 | }
============================================================END: frontend/components/EmailManagement.tsx============================================================


============================================================FILE: frontend/components/ErrorBoundary.tsxSIZE: 1.50 KB============================================================
  1 | 'use client';  2 |   3 | import React, { Component, ReactNode } from 'react';  4 |   5 | interface Props {  6 |   children: ReactNode;  7 |   fallback?: ReactNode;  8 | }  9 |  10 | interface State { 11 |   hasError: boolean; 12 |   error?: Error; 13 | } 14 |  15 | export class ErrorBoundary extends Component<Props, State> { 16 |   constructor(props: Props) { 17 |     super(props); 18 |     this.state = { hasError: false }; 19 |   } 20 |  21 |   static getDerivedStateFromError(error: Error): State { 22 |     return { hasError: true, error }; 23 |   } 24 |  25 |   componentDidCatch(error: Error, errorInfo: React.ErrorInfo) { 26 |     } 27 |  28 |   render() { 29 |     if (this.state.hasError) { 30 |       if (this.props.fallback) { 31 |         return this.props.fallback; 32 |       } 33 |  34 |       return ( 35 |         <div className="bg-red-500/10 border border-red-500/20 max-w-md mx-auto mt-8 p-6 rounded-lg"> 36 |           <div className="flex items-center space-x-2 mb-4"> 37 |             <div className="w-5 h-5 bg-red-500 rounded-full"></div> 38 |             <h4 className="text-red-400 font-medium">Something went wrong</h4> 39 |           </div> 40 |           <p className="text-red-300 text-sm mb-4"> 41 |             {this.state.error?.message || 'An unexpected error occurred.'} 42 |           </p> 43 |           <button 44 |             onClick={() => this.setState({ hasError: false, error: undefined })} 45 |             className="px-4 py-2 border border-red-500/30 text-red-400 hover:bg-red-500/10 rounded transition-colors" 46 |           > 47 |             Try Again 48 |           </button> 49 |         </div> 50 |       ); 51 |     } 52 |  53 |     return this.props.children; 54 |   } 55 | }
============================================================END: frontend/components/ErrorBoundary.tsx============================================================


============================================================FILE: frontend/components/ExternalAPIManagement.tsxSIZE: 27.18 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { motion, AnimatePresence } from 'framer-motion';  5 | import {  6 |   Settings,  7 |   Plus,  8 |   Edit,  9 |   Trash2, 10 |   Play, 11 |   CheckCircle, 12 |   XCircle, 13 |   AlertTriangle, 14 |   Eye, 15 |   EyeOff, 16 |   RefreshCw, 17 |   Database, 18 |   Zap, 19 |   MessageSquare, 20 |   CreditCard, 21 |   Globe, 22 |   Shield, 23 |   Clock 24 | } from 'lucide-react'; 25 | import { BaseCard } from '@/components/ui/BaseCard'; 26 | import { BaseButton } from '@/components/ui/BaseButton'; 27 | import { useAuth } from '../hooks/useAuth'; 28 |  29 | interface ExternalAPIConfig { 30 |   id?: string; 31 |   name: string; 32 |   provider: string; 33 |   category: string; 34 |   apiKey?: string; 35 |   apiSecret?: string; 36 |   apiUrl?: string; 37 |   webhookUrl?: string; 38 |   webhookSecret?: string; 39 |   config?: Record<string, unknown>; 40 |   isActive: boolean; 41 |   testMode: boolean; 42 |   description?: string; 43 |   version?: string; 44 |   rateLimit?: number; 45 |   timeout?: number; 46 |   lastTestedAt?: string; 47 |   lastTestResult?: string; 48 |   healthStatus?: string; 49 |   createdAt?: string; 50 |   updatedAt?: string; 51 |   createdBy?: string; 52 |   updatedBy?: string; 53 | } 54 |  55 | interface APIConfigFormData { 56 |   name: string; 57 |   provider: string; 58 |   category: string; 59 |   apiKey: string; 60 |   apiSecret: string; 61 |   apiUrl: string; 62 |   webhookUrl: string; 63 |   webhookSecret: string; 64 |   config: string; 65 |   isActive: boolean; 66 |   testMode: boolean; 67 |   description: string; 68 |   version: string; 69 |   rateLimit: number; 70 |   timeout: number; 71 | } 72 |  73 | const initialFormData: APIConfigFormData = { 74 |   name: '', 75 |   provider: '', 76 |   category: 'ai', 77 |   apiKey: '', 78 |   apiSecret: '', 79 |   apiUrl: '', 80 |   webhookUrl: '', 81 |   webhookSecret: '', 82 |   config: '{}', 83 |   isActive: false, 84 |   testMode: true, 85 |   description: '', 86 |   version: '', 87 |   rateLimit: 100, 88 |   timeout: 30000, 89 | }; 90 |  91 | const categoryIcons = { 92 |   ai: Zap, 93 |   communication: MessageSquare, 94 |   payment: CreditCard, 95 |   other: Globe, 96 | }; 97 |  98 | const categoryColors = { 99 |   ai: 'text-blue-400',100 |   communication: 'text-green-400',101 |   payment: 'text-purple-400',102 |   other: 'text-gray-400',103 | };104 | 105 | export function ExternalAPIManagement() {106 |   const { user } = useAuth();107 |   const [configs, setConfigs] = useState<ExternalAPIConfig[]>([]);108 |   const [loading, setLoading] = useState(true);109 |   const [showForm, setShowForm] = useState(false);110 |   const [editingConfig, setEditingConfig] = useState<ExternalAPIConfig | null>(null);111 |   const [formData, setFormData] = useState<APIConfigFormData>(initialFormData);112 |   const [showPasswords, setShowPasswords] = useState<{[key: string]: boolean}>({});113 |   const [testingConfig, setTestingConfig] = useState<string | null>(null);114 |   const [testResults, setTestResults] = useState<{[key: string]: Record<string, unknown>}>({});115 | 116 |   const loadConfigs = useCallback(async () => {117 |     try {118 |       const response = await fetch('/api/admin/external-apis?action=list', {119 |         headers: {120 |           'Authorization': `Bearer ${user?.access_token}`,121 |         },122 |       });123 | 124 |       if (response.ok) {125 |         const data = await response.json();126 |         setConfigs(data.data || []);127 |       }128 |     } catch (error) {129 |       } finally {130 |       setLoading(false);131 |     }132 |   }, [user?.access_token]);133 | 134 |   useEffect(() => {135 |     loadConfigs();136 |   }, [loadConfigs]);137 | 138 |   const handleSubmit = async (e: React.FormEvent) => {139 |     e.preventDefault();140 | 141 |     try {142 |       let configData;143 |       try {144 |         configData = JSON.parse(formData.config);145 |       } catch {146 |         configData = {};147 |       }148 | 149 |       const payload = {150 |         ...formData,151 |         config: configData,152 |       };153 | 154 |       const url = editingConfig155 |         ? `/api/admin/external-apis?id=${editingConfig.id}`156 |         : '/api/admin/external-apis';157 | 158 |       const method = editingConfig ? 'PUT' : 'POST';159 |       const action = editingConfig ? undefined : 'create';160 | 161 |       const response = await fetch(url, {162 |         method,163 |         headers: {164 |           'Content-Type': 'application/json',165 |           'Authorization': `Bearer ${user?.access_token}`,166 |         },167 |         body: JSON.stringify(action ? { action, data: payload } : payload),168 |       });169 | 170 |       if (response.ok) {171 |         await loadConfigs();172 |         setShowForm(false);173 |         setEditingConfig(null);174 |         setFormData(initialFormData);175 |       }176 |     } catch (error) {177 |       }178 |   };179 | 180 |   const handleEdit = (config: ExternalAPIConfig) => {181 |     setEditingConfig(config);182 |     setFormData({183 |       name: config.name,184 |       provider: config.provider,185 |       category: config.category,186 |       apiKey: config.apiKey || '',187 |       apiSecret: config.apiSecret || '',188 |       apiUrl: config.apiUrl || '',189 |       webhookUrl: config.webhookUrl || '',190 |       webhookSecret: config.webhookSecret || '',191 |       config: JSON.stringify(config.config || {}, null, 2),192 |       isActive: config.isActive,193 |       testMode: config.testMode,194 |       description: config.description || '',195 |       version: config.version || '',196 |       rateLimit: config.rateLimit || 100,197 |       timeout: config.timeout || 30000,198 |     });199 |     setShowForm(true);200 |   };201 | 202 |   const handleDelete = async (id: string) => {203 |     if (!confirm('¿Estás seguro de que quieres eliminar esta configuración?')) {204 |       return;205 |     }206 | 207 |     try {208 |       const response = await fetch(`/api/admin/external-apis?id=${id}`, {209 |         method: 'DELETE',210 |         headers: {211 |           'Authorization': `Bearer ${user?.access_token}`,212 |         },213 |       });214 | 215 |       if (response.ok) {216 |         await loadConfigs();217 |       }218 |     } catch (error) {219 |       }220 |   };221 | 222 |   const handleTest = async (config: ExternalAPIConfig) => {223 |     if (!config.id) return;224 | 225 |     setTestingConfig(config.id);226 | 227 |     try {228 |       const response = await fetch('/api/admin/external-apis', {229 |         method: 'POST',230 |         headers: {231 |           'Content-Type': 'application/json',232 |           'Authorization': `Bearer ${user?.access_token}`,233 |         },234 |         body: JSON.stringify({235 |           action: 'test',236 |           data: { id: config.id },237 |         }),238 |       });239 | 240 |       const result = await response.json();241 |       setTestResults(prev => ({242 |         ...prev,243 |         [config.id as string]: result.data,244 |       }));245 |     } catch (error) {246 |       setTestResults(prev => ({247 |         ...prev,248 |         [config.id as string]: { success: false, message: 'Test failed' },249 |       }));250 |     } finally {251 |       setTestingConfig(null);252 |     }253 |   };254 | 255 |   const togglePasswordVisibility = (field: string) => {256 |     setShowPasswords(prev => ({257 |       ...prev,258 |       [field]: !prev[field],259 |     }));260 |   };261 | 262 |   const getHealthStatusIcon = (status?: string) => {263 |     switch (status) {264 |       case 'healthy':265 |         return <CheckCircle className="w-4 h-4 text-green-400" />;266 |       case 'unhealthy':267 |         return <XCircle className="w-4 h-4 text-red-400" />;268 |       default:269 |         return <AlertTriangle className="w-4 h-4 text-yellow-400" />;270 |     }271 |   };272 | 273 |   const getHealthStatusColor = (status?: string) => {274 |     switch (status) {275 |       case 'healthy':276 |         return 'text-green-400';277 |       case 'unhealthy':278 |         return 'text-red-400';279 |       default:280 |         return 'text-yellow-400';281 |     }282 |   };283 | 284 |   if (loading) {285 |     return (286 |       <div className="flex items-center justify-center p-8">287 |         <RefreshCw className="w-6 h-6 animate-spin text-blue-400" />288 |         <span className="ml-2 text-gray-400">Cargando configuraciones...</span>289 |       </div>290 |     );291 |   }292 | 293 |   return (294 |     <div className="space-y-6">295 |       <div className="flex items-center justify-between">296 |         <div>297 |           <h2 className="text-2xl font-bold text-white">Configuración de APIs Externas</h2>298 |           <p className="text-gray-400">Gestiona las integraciones con servicios externos</p>299 |         </div>300 |         <BaseButton301 |           variant="primary"302 |           onClick={() => {303 |             setEditingConfig(null);304 |             setFormData(initialFormData);305 |             setShowForm(true);306 |           }}307 |           leftIcon={<Plus className="w-4 h-4" />}308 |         >309 |           Nueva Configuración310 |         </BaseButton>311 |       </div>312 | 313 |       {}314 |       <div className="grid gap-4">315 |         {configs.map((config) => {316 |           const CategoryIcon = categoryIcons[config.category as keyof typeof categoryIcons] || Globe;317 |           const testResult = testResults[config.id!];318 | 319 |           return (320 |             <BaseCard key={config.id} variant="default" size="lg">321 |               <BaseCard.Content>322 |                 <div className="flex items-center justify-between">323 |                   <div className="flex items-center space-x-4">324 |                     <div className={`p-3 rounded-lg bg-gray-800 ${categoryColors[config.category as keyof typeof categoryColors] || 'text-gray-400'}`}>325 |                       <CategoryIcon className="w-6 h-6" />326 |                     </div>327 |                     <div>328 |                       <h3 className="text-lg font-semibold text-white">{config.provider}</h3>329 |                       <p className="text-gray-400">{config.name}</p>330 |                       <div className="flex items-center space-x-4 mt-1">331 |                         <span className={`text-sm px-2 py-1 rounded ${332 |                           config.isActive333 |                             ? 'bg-green-900/20 text-green-400 border border-green-500/30'334 |                             : 'bg-red-900/20 text-red-400 border border-red-500/30'335 |                         }`}>336 |                           {config.isActive ? 'Activo' : 'Inactivo'}337 |                         </span>338 |                         {config.testMode && (339 |                           <span className="text-sm px-2 py-1 rounded bg-yellow-900/20 text-yellow-400 border border-yellow-500/30">340 |                             Modo Test341 |                           </span>342 |                         )}343 |                       </div>344 |                     </div>345 |                   </div>346 | 347 |                   <div className="flex items-center space-x-3">348 |                     {}349 |                     <div className="flex items-center space-x-2">350 |                       {getHealthStatusIcon(config.healthStatus)}351 |                       <span className={`text-sm ${getHealthStatusColor(config.healthStatus)}`}>352 |                         {config.healthStatus || 'Desconocido'}353 |                       </span>354 |                     </div>355 | 356 |                     {}357 |                     {config.lastTestedAt && (358 |                       <div className="text-xs text-gray-500 flex items-center space-x-1">359 |                         <Clock className="w-3 h-3" />360 |                         <span>{new Date(config.lastTestedAt).toLocaleDateString()}</span>361 |                       </div>362 |                     )}363 | 364 |                     {}365 |                     <div className="flex space-x-2">366 |                       <BaseButton367 |                         variant="outline"368 |                         size="sm"369 |                         onClick={() => handleTest(config)}370 |                         loading={testingConfig === config.id}371 |                         leftIcon={<Play className="w-3 h-3" />}372 |                       >373 |                         Test374 |                       </BaseButton>375 | 376 |                       <BaseButton377 |                         variant="outline"378 |                         size="sm"379 |                         onClick={() => handleEdit(config)}380 |                         leftIcon={<Edit className="w-3 h-3" />}381 |                       >382 |                         Editar383 |                       </BaseButton>384 | 385 |                       <BaseButton386 |                         variant="outline"387 |                         size="sm"388 |                         onClick={() => handleDelete(config.id!)}389 |                         leftIcon={<Trash2 className="w-3 h-3" />}390 |                         className="text-red-400 hover:text-red-300"391 |                       >392 |                         Eliminar393 |                       </BaseButton>394 |                     </div>395 |                   </div>396 |                 </div>397 | 398 |                 {}399 |                 {testResult && (400 |                   <motion.div401 |                     initial={{ opacity: 0, height: 0 }}402 |                     animate={{ opacity: 1, height: 'auto' }}403 |                     className={`mt-4 p-3 rounded-lg border ${404 |                       testResult.success405 |                         ? 'bg-green-900/20 border-green-500/30 text-green-400'406 |                         : 'bg-red-900/20 border-red-500/30 text-red-400'407 |                     }`}408 |                   >409 |                     <div className="flex items-center space-x-2">410 |                       {testResult.success ? (411 |                         <CheckCircle className="w-4 h-4" />412 |                       ) : (413 |                         <XCircle className="w-4 h-4" />414 |                       )}415 |                       <span className="font-medium">Resultado del Test</span>416 |                     </div>417 |                     <p className="text-sm mt-1">{String(testResult.message || '')}</p>418 |                     {Boolean(testResult.details) && (419 |                       <pre className="text-xs mt-2 bg-black/30 p-2 rounded overflow-x-auto">420 |                         {JSON.stringify(testResult.details, null, 2)}421 |                       </pre>422 |                     )}423 |                   </motion.div>424 |                 )}425 | 426 |                 {}427 |                 {config.description && (428 |                   <p className="text-gray-400 text-sm mt-3">{config.description}</p>429 |                 )}430 |               </BaseCard.Content>431 |             </BaseCard>432 |           );433 |         })}434 | 435 |         {configs.length === 0 && (436 |           <BaseCard variant="default" size="lg">437 |             <BaseCard.Content>438 |               <div className="text-center py-8">439 |                 <Database className="w-12 h-12 text-gray-600 mx-auto mb-4" />440 |                 <h3 className="text-lg font-medium text-white mb-2">No hay configuraciones</h3>441 |                 <p className="text-gray-400 mb-4">442 |                   Crea tu primera configuración de API externa para comenzar443 |                 </p>444 |                 <BaseButton445 |                   variant="primary"446 |                   onClick={() => setShowForm(true)}447 |                   leftIcon={<Plus className="w-4 h-4" />}448 |                 >449 |                   Crear Configuración450 |                 </BaseButton>451 |               </div>452 |             </BaseCard.Content>453 |           </BaseCard>454 |         )}455 |       </div>456 | 457 |       {}458 |       <AnimatePresence>459 |         {showForm && (460 |           <motion.div461 |             initial={{ opacity: 0 }}462 |             animate={{ opacity: 1 }}463 |             exit={{ opacity: 0 }}464 |             className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"465 |             onClick={() => setShowForm(false)}466 |           >467 |             <motion.div468 |               initial={{ scale: 0.9, opacity: 0 }}469 |               animate={{ scale: 1, opacity: 1 }}470 |               exit={{ scale: 0.9, opacity: 0 }}471 |               className="bg-gray-900 border border-gray-700 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"472 |               onClick={(e) => e.stopPropagation()}473 |             >474 |               <div className="p-6 border-b border-gray-700">475 |                 <h3 className="text-xl font-bold text-white">476 |                   {editingConfig ? 'Editar Configuración' : 'Nueva Configuración'}477 |                 </h3>478 |               </div>479 | 480 |               <form onSubmit={handleSubmit} className="p-6 space-y-6">481 |                 {}482 |                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">483 |                   <div>484 |                     <label className="block text-sm font-medium text-gray-300 mb-2">485 |                       Nombre *486 |                     </label>487 |                     <input488 |                       type="text"489 |                       value={formData.name}490 |                       onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}491 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"492 |                       placeholder="openrouter"493 |                       required494 |                     />495 |                   </div>496 | 497 |                   <div>498 |                     <label className="block text-sm font-medium text-gray-300 mb-2">499 |                       Proveedor *500 |                     </label>501 |                     <input502 |                       type="text"503 |                       value={formData.provider}504 |                       onChange={(e) => setFormData(prev => ({ ...prev, provider: e.target.value }))}505 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"506 |                       placeholder="OpenRouter"507 |                       required508 |                     />509 |                   </div>510 |                 </div>511 | 512 |                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">513 |                   <div>514 |                     <label className="block text-sm font-medium text-gray-300 mb-2">515 |                       Categoría *516 |                     </label>517 |                     <select518 |                       value={formData.category}519 |                       onChange={(e) => setFormData(prev => ({ ...prev, category: e.target.value }))}520 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"521 |                       required522 |                     >523 |                       <option value="ai">Inteligencia Artificial</option>524 |                       <option value="communication">Comunicación</option>525 |                       <option value="payment">Pagos</option>526 |                       <option value="other">Otro</option>527 |                     </select>528 |                   </div>529 | 530 |                   <div>531 |                     <label className="block text-sm font-medium text-gray-300 mb-2">532 |                       Versión533 |                     </label>534 |                     <input535 |                       type="text"536 |                       value={formData.version}537 |                       onChange={(e) => setFormData(prev => ({ ...prev, version: e.target.value }))}538 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"539 |                       placeholder="v1.0"540 |                     />541 |                   </div>542 |                 </div>543 | 544 |                 {}545 |                 <div className="space-y-4">546 |                   <h4 className="text-lg font-medium text-white flex items-center">547 |                     <Shield className="w-5 h-5 mr-2" />548 |                     Credenciales549 |                   </h4>550 | 551 |                   <div>552 |                     <label className="block text-sm font-medium text-gray-300 mb-2">553 |                       API Key554 |                     </label>555 |                     <div className="relative">556 |                       <input557 |                         type={showPasswords.apiKey ? "text" : "password"}558 |                         value={formData.apiKey}559 |                         onChange={(e) => setFormData(prev => ({ ...prev, apiKey: e.target.value }))}560 |                         className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 pr-10 text-white focus:outline-none focus:border-blue-500"561 |                         placeholder="sk-or-v1-xxxxxxxxxxxxx"562 |                       />563 |                       <button564 |                         type="button"565 |                         onClick={() => togglePasswordVisibility('apiKey')}566 |                         className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"567 |                       >568 |                         {showPasswords.apiKey ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}569 |                       </button>570 |                     </div>571 |                   </div>572 | 573 |                   <div>574 |                     <label className="block text-sm font-medium text-gray-300 mb-2">575 |                       API Secret576 |                     </label>577 |                     <div className="relative">578 |                       <input579 |                         type={showPasswords.apiSecret ? "text" : "password"}580 |                         value={formData.apiSecret}581 |                         onChange={(e) => setFormData(prev => ({ ...prev, apiSecret: e.target.value }))}582 |                         className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 pr-10 text-white focus:outline-none focus:border-blue-500"583 |                         placeholder="secret-key"584 |                       />585 |                       <button586 |                         type="button"587 |                         onClick={() => togglePasswordVisibility('apiSecret')}588 |                         className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"589 |                       >590 |                         {showPasswords.apiSecret ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}591 |                       </button>592 |                     </div>593 |                   </div>594 |                 </div>595 | 596 |                 {}597 |                 <div className="space-y-4">598 |                   <h4 className="text-lg font-medium text-white flex items-center">599 |                     <Globe className="w-5 h-5 mr-2" />600 |                     URLs y Configuración601 |                   </h4>602 | 603 |                   <div>604 |                     <label className="block text-sm font-medium text-gray-300 mb-2">605 |                       API URL606 |                     </label>607 |                     <input608 |                       type="url"609 |                       value={formData.apiUrl}610 |                       onChange={(e) => setFormData(prev => ({ ...prev, apiUrl: e.target.value }))}611 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"612 |                       placeholder="https:613 |                     />614 |                   </div>615 | 616 |                   <div>617 |                     <label className="block text-sm font-medium text-gray-300 mb-2">618 |                       Webhook URL619 |                     </label>620 |                     <input621 |                       type="url"622 |                       value={formData.webhookUrl}623 |                       onChange={(e) => setFormData(prev => ({ ...prev, webhookUrl: e.target.value }))}624 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"625 |                       placeholder="https:626 |                     />627 |                   </div>628 | 629 |                   <div>630 |                     <label className="block text-sm font-medium text-gray-300 mb-2">631 |                       Configuración JSON632 |                     </label>633 |                     <textarea634 |                       value={formData.config}635 |                       onChange={(e) => setFormData(prev => ({ ...prev, config: e.target.value }))}636 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500 font-mono text-sm"637 |                       rows={4}638 |                       placeholder='{"model": "gpt-3.5-turbo", "temperature": 0.7}'639 |                     />640 |                   </div>641 |                 </div>642 | 643 |                 {}644 |                 <div className="space-y-4">645 |                   <h4 className="text-lg font-medium text-white flex items-center">646 |                     <Settings className="w-5 h-5 mr-2" />647 |                     Configuración Avanzada648 |                   </h4>649 | 650 |                   <div className="grid grid-cols-1 md:grid-cols-2 gap-4">651 |                     <div>652 |                       <label className="block text-sm font-medium text-gray-300 mb-2">653 |                         Rate Limit654 |                       </label>655 |                       <input656 |                         type="number"657 |                         value={formData.rateLimit}658 |                         onChange={(e) => setFormData(prev => ({ ...prev, rateLimit: parseInt(e.target.value) }))}659 |                         className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"660 |                         min="1"661 |                         max="10000"662 |                       />663 |                     </div>664 | 665 |                     <div>666 |                       <label className="block text-sm font-medium text-gray-300 mb-2">667 |                         Timeout (ms)668 |                       </label>669 |                       <input670 |                         type="number"671 |                         value={formData.timeout}672 |                         onChange={(e) => setFormData(prev => ({ ...prev, timeout: parseInt(e.target.value) }))}673 |                         className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"674 |                         min="1000"675 |                         max="120000"676 |                       />677 |                     </div>678 |                   </div>679 | 680 |                   <div>681 |                     <label className="block text-sm font-medium text-gray-300 mb-2">682 |                       Descripción683 |                     </label>684 |                     <textarea685 |                       value={formData.description}686 |                       onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}687 |                       className="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500"688 |                       rows={2}689 |                       placeholder="Descripción del servicio..."690 |                     />691 |                   </div>692 | 693 |                   <div className="flex items-center space-x-6">694 |                     <label className="flex items-center space-x-2">695 |                       <input696 |                         type="checkbox"697 |                         checked={formData.isActive}698 |                         onChange={(e) => setFormData(prev => ({ ...prev, isActive: e.target.checked }))}699 |                         className="rounded border-gray-600 text-blue-600 focus:ring-blue-500"700 |                       />701 |                       <span className="text-sm text-gray-300">Activo</span>702 |                     </label>703 | 704 |                     <label className="flex items-center space-x-2">705 |                       <input706 |                         type="checkbox"707 |                         checked={formData.testMode}708 |                         onChange={(e) => setFormData(prev => ({ ...prev, testMode: e.target.checked }))}709 |                         className="rounded border-gray-600 text-blue-600 focus:ring-blue-500"710 |                       />711 |                       <span className="text-sm text-gray-300">Modo Test</span>712 |                     </label>713 |                   </div>714 |                 </div>715 | 716 |                 {}717 |                 <div className="flex justify-end space-x-3 pt-6 border-t border-gray-700">718 |                   <BaseButton719 |                     variant="outline"720 |                     onClick={() => setShowForm(false)}721 |                   >722 |                     Cancelar723 |                   </BaseButton>724 |                   <BaseButton725 |                     variant="primary"726 |                     type="submit"727 |                   >728 |                     {editingConfig ? 'Actualizar' : 'Crear'} Configuración729 |                   </BaseButton>730 |                 </div>731 |               </form>732 |             </motion.div>733 |           </motion.div>734 |         )}735 |       </AnimatePresence>736 |     </div>737 |   );738 | }
============================================================END: frontend/components/ExternalAPIManagement.tsx============================================================


============================================================FILE: frontend/components/FullPageSlider.tsxSIZE: 40.70 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';  4 | import { ChevronLeft, ChevronRight, Plus, Play, Pause, Settings, X, Edit3, Save, Trash2, Eye, EyeOff } from 'lucide-react';  5 |   6 | interface SectionData {  7 |   id: string;  8 |   title: string;  9 |   content?: string; 10 |   backgroundVideo?: VideoConfig; 11 |   backgroundImage?: string; 12 |   backgroundColor?: string; 13 |   verticalSlides?: VerticalSlide[]; 14 |   isVisible?: boolean; 15 | } 16 |  17 | interface VerticalSlide { 18 |   id: string; 19 |   title: string; 20 |   content: string; 21 |   backgroundColor?: string; 22 | } 23 |  24 | interface VideoConfig { 25 |   src: string; 26 |   poster?: string; 27 |   fallback?: { 28 |     image?: string; 29 |     color?: string; 30 |   }; 31 |   options?: { 32 |     autoplay?: boolean; 33 |     loop?: boolean; 34 |     muted?: boolean; 35 |   }; 36 | } 37 |  38 | interface HeaderConfig { 39 |   show: boolean; 40 |   transparent: boolean; 41 |   blur: boolean; 42 |   title: string; 43 | } 44 |  45 | interface NavigationConfig { 46 |   show: boolean; 47 |   position: 'left' | 'right'; 48 |   type: 'dots' | 'numbers'; 49 | } 50 |  51 | const VideoBackground = React.memo(({ config }: { config: VideoConfig }) => { 52 |   const [videoError, setVideoError] = useState(false); 53 |   const [isPlaying, setIsPlaying] = useState(false); 54 |   const [isLoading, setIsLoading] = useState(true); 55 |   const videoRef = useRef<HTMLVideoElement>(null); 56 |  57 |   const togglePlay = useCallback(() => { 58 |     if (videoRef.current) { 59 |       if (isPlaying) { 60 |         videoRef.current.pause(); 61 |       } else { 62 |         videoRef.current.play().catch(() => setVideoError(true)); 63 |       } 64 |     } 65 |   }, [isPlaying]); 66 |  67 |   const handleLoadStart = () => setIsLoading(true); 68 |   const handleCanPlay = () => setIsLoading(false); 69 |   const handlePlay = () => setIsPlaying(true); 70 |   const handlePause = () => setIsPlaying(false); 71 |   const handleError = () => { 72 |     setVideoError(true); 73 |     setIsLoading(false); 74 |   }; 75 |  76 |   if (videoError || !config.src) { 77 |     return ( 78 |       <div 79 |         className="absolute inset-0 bg-cover bg-center" 80 |         style={{ 81 |           backgroundImage: config.fallback?.image ? `url(${config.fallback.image})` : 'none', 82 |           backgroundColor: config.fallback?.color || '#1f2937' 83 |         }} 84 |       /> 85 |     ); 86 |   } 87 |  88 |   return ( 89 |     <div className="absolute inset-0 overflow-hidden"> 90 |       <video 91 |         ref={videoRef} 92 |         className="w-full h-full object-cover" 93 |         autoPlay={config.options?.autoplay ?? true} 94 |         loop={config.options?.loop ?? true} 95 |         muted={config.options?.muted ?? true} 96 |         poster={config.poster} 97 |         onLoadStart={handleLoadStart} 98 |         onCanPlay={handleCanPlay} 99 |         onError={handleError}100 |         onPlay={handlePlay}101 |         onPause={handlePause}102 |         preload="metadata"103 |         playsInline104 |       >105 |         <source src={config.src} type="video/mp4" />106 |       </video>107 | 108 |       {isLoading && (109 |         <div className="absolute inset-0 flex items-center justify-center bg-gray-900">110 |           <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>111 |         </div>112 |       )}113 | 114 |       <button115 |         onClick={togglePlay}116 |         className="absolute bottom-4 right-4 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50"117 |         aria-label={isPlaying ? 'Pause video' : 'Play video'}118 |       >119 |         {isPlaying ? <Pause size={16} /> : <Play size={16} />}120 |       </button>121 | 122 |       <div className="absolute inset-0 bg-black/20" />123 |     </div>124 |   );125 | });126 | 127 | VideoBackground.displayName = 'VideoBackground';128 | 129 | const Header = React.memo(({ config, currentSlide, totalSlides, onSlideClick }: {130 |   config: HeaderConfig;131 |   currentSlide: number;132 |   totalSlides: number;133 |   onSlideClick: (index: number) => void;134 | }) => {135 |   if (!config.show) return null;136 | 137 |   return (138 |     <header className={`139 |       fixed top-0 left-0 right-0 z-50 p-4140 |       ${config.transparent ? 'bg-transparent' : 'bg-white/90'}141 |       ${config.blur ? 'backdrop-blur-sm' : ''}142 |       transition-all duration-300143 |     `}>144 |       <div className="flex items-center justify-between max-w-6xl mx-auto">145 |         <h1 className="text-xl font-bold text-white drop-shadow-lg">146 |           {config.title}147 |         </h1>148 | 149 |         <nav className="flex space-x-2" role="navigation" aria-label="Slide navigation">150 |           {Array.from({ length: totalSlides }, (_, i) => (151 |             <button152 |               key={i}153 |               onClick={() => onSlideClick(i)}154 |               className={`155 |                 px-3 py-1 rounded text-sm font-medium transition-all duration-200156 |                 focus:outline-none focus:ring-2 focus:ring-white/50157 |                 ${currentSlide === i158 |                   ? 'bg-white text-gray-900'159 |                   : 'text-white hover:bg-white/20'160 |                 }161 |               `}162 |               aria-label={`Go to slide ${i + 1}`}163 |               aria-current={currentSlide === i ? 'page' : undefined}164 |             >165 |               {i + 1}166 |             </button>167 |           ))}168 |         </nav>169 |       </div>170 |     </header>171 |   );172 | });173 | 174 | Header.displayName = 'Header';175 | 176 | const Navigation = React.memo(({ config, currentSlide, totalSlides, onNavigate }: {177 |   config: NavigationConfig;178 |   currentSlide: number;179 |   totalSlides: number;180 |   onNavigate: (index: number) => void;181 | }) => {182 |   if (!config.show) return null;183 | 184 |   return (185 |     <nav className={`186 |       fixed ${config.position === 'right' ? 'right-6' : 'left-6'}187 |       top-1/2 transform -translate-y-1/2 z-40188 |       flex flex-col space-y-3189 |     `} role="navigation" aria-label="Page navigation">190 |       {Array.from({ length: totalSlides }, (_, i) => (191 |         <button192 |           key={i}193 |           onClick={() => onNavigate(i)}194 |           className={`195 |             transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50196 |             ${config.type === 'dots'197 |               ? `w-3 h-3 rounded-full border-2 border-white198 |                  ${currentSlide === i ? 'bg-white' : 'bg-transparent'}`199 |               : `w-8 h-8 rounded-full bg-white/20 hover:bg-white/40200 |                  flex items-center justify-center text-white text-sm font-medium201 |                  ${currentSlide === i ? 'bg-white text-gray-900' : ''}`202 |             }203 |           `}204 |           aria-label={`Go to slide ${i + 1}`}205 |           aria-current={currentSlide === i ? 'page' : undefined}206 |         >207 |           {config.type === 'numbers' && (i + 1)}208 |         </button>209 |       ))}210 |     </nav>211 |   );212 | });213 | 214 | Navigation.displayName = 'Navigation';215 | 216 | const ContentEditor = ({ content, onSave, onCancel }: {217 |   content: string;218 |   onSave: (newContent: string) => void;219 |   onCancel: () => void;220 | }) => {221 |   const [editContent, setEditContent] = useState(content);222 | 223 |   return (224 |     <div className="fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4">225 |       <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl">226 |         <div className="flex items-center justify-between p-4 border-b">227 |           <h3 className="text-lg font-semibold">Edit Content</h3>228 |           <button229 |             onClick={onCancel}230 |             className="p-1 hover:bg-gray-100 rounded"231 |           >232 |             <X size={20} />233 |           </button>234 |         </div>235 | 236 |         <div className="p-4">237 |           <textarea238 |             value={editContent}239 |             onChange={(e) => setEditContent(e.target.value)}240 |             className="w-full h-64 p-3 border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"241 |             placeholder="Enter your content..."242 |           />243 |         </div>244 | 245 |         <div className="flex justify-end gap-2 p-4 border-t">246 |           <button247 |             onClick={onCancel}248 |             className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded transition-colors"249 |           >250 |             Cancel251 |           </button>252 |           <button253 |             onClick={() => onSave(editContent)}254 |             className="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded transition-colors flex items-center gap-2"255 |           >256 |             <Save size={16} />257 |             Save258 |           </button>259 |         </div>260 |       </div>261 |     </div>262 |   );263 | };264 | 265 | const SlideManagementPanel = ({266 |   sections,267 |   setSections,268 |   currentSlide,269 |   currentVerticalSlide,270 |   setCurrentVerticalSlide,271 |   goToSlide272 | }: {273 |   sections: SectionData[];274 |   setSections: React.Dispatch<React.SetStateAction<SectionData[]>>;275 |   currentSlide: number;276 |   currentVerticalSlide: number;277 |   setCurrentVerticalSlide: React.Dispatch<React.SetStateAction<number>>;278 |   goToSlide: (index: number) => void;279 | }) => {280 |   const [isOpen, setIsOpen] = useState(false);281 |   const [activeTab, setActiveTab] = useState<'horizontal' | 'vertical'>('horizontal');282 |   const [editingContent, setEditingContent] = useState<{ type: 'main' | 'vertical', index?: number } | null>(null);283 | 284 |   const addHorizontalSlide = () => {285 |     const newSlide: SectionData = {286 |       id: `slide-${Date.now()}`,287 |       title: `New Slide ${sections.length + 1}`,288 |       content: 'This is a new slide. Click to edit content.',289 |       backgroundColor: `hsl(${Math.random() * 360}, 70%, 50%)`,290 |       verticalSlides: [],291 |       isVisible: true292 |     };293 |     setSections([...sections, newSlide]);294 |   };295 | 296 |   const deleteHorizontalSlide = (index: number) => {297 |     if (sections.length > 1) {298 |       const newSections = sections.filter((_, i) => i !== index);299 |       setSections(newSections);300 |       if (currentSlide >= index && currentSlide > 0) {301 |         goToSlide(currentSlide - 1);302 |       }303 |     }304 |   };305 | 306 |   const toggleSlideVisibility = (index: number) => {307 |     const updatedSections = sections.map((section, i) =>308 |       i === index ? { ...section, isVisible: !section.isVisible } : section309 |     );310 |     setSections(updatedSections);311 |   };312 | 313 |   const updateSlideContent = (content: string) => {314 |     if (editingContent?.type === 'main') {315 |       const updatedSections = [...sections];316 |       updatedSections[currentSlide] = { ...updatedSections[currentSlide], content };317 |       setSections(updatedSections);318 |     } else if (editingContent?.type === 'vertical' && editingContent.index !== undefined) {319 |       const updatedSections = [...sections];320 |       const currentSection = updatedSections[currentSlide];321 |       if (currentSection.verticalSlides) {322 |         currentSection.verticalSlides[editingContent.index] = {323 |           ...currentSection.verticalSlides[editingContent.index],324 |           content325 |         };326 |       }327 |       setSections(updatedSections);328 |     }329 |     setEditingContent(null);330 |   };331 | 332 |   const addVerticalSlide = () => {333 |     const currentSection = sections[currentSlide];334 |     if (!currentSection) return;335 | 336 |     const newVerticalSlide: VerticalSlide = {337 |       id: `vertical-${Date.now()}`,338 |       title: `Vertical Slide ${(currentSection.verticalSlides?.length || 0) + 1}`,339 |       content: 'This is a new vertical slide.',340 |       backgroundColor: `hsl(${Math.random() * 360}, 70%, 60%)`341 |     };342 | 343 |     const updatedSections = [...sections];344 |     updatedSections[currentSlide] = {345 |       ...currentSection,346 |       verticalSlides: [...(currentSection.verticalSlides || []), newVerticalSlide]347 |     };348 |     setSections(updatedSections);349 |   };350 | 351 |   const deleteVerticalSlide = (verticalIndex: number) => {352 |     const currentSection = sections[currentSlide];353 |     if (!currentSection?.verticalSlides) return;354 | 355 |     const updatedSections = [...sections];356 |     updatedSections[currentSlide] = {357 |       ...currentSection,358 |       verticalSlides: currentSection.verticalSlides.filter((_, i) => i !== verticalIndex)359 |     };360 |     setSections(updatedSections);361 | 362 |     if (currentVerticalSlide >= verticalIndex && currentVerticalSlide > 0) {363 |       setCurrentVerticalSlide(currentVerticalSlide - 1);364 |     }365 |   };366 | 367 |   return (368 |     <>369 |       <button370 |         onClick={() => setIsOpen(true)}371 |         className="fixed bottom-6 left-6 z-50 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-blue-400"372 |         aria-label="Open slide management"373 |       >374 |         <Settings size={20} />375 |       </button>376 | 377 |       {isOpen && (378 |         <div className="fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4">379 |           <div className="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden">380 |             <div className="flex items-center justify-between p-4 border-b">381 |               <h3 className="text-lg font-semibold">Slide Management</h3>382 |               <button383 |                 onClick={() => setIsOpen(false)}384 |                 className="p-1 hover:bg-gray-100 rounded"385 |               >386 |                 <X size={20} />387 |               </button>388 |             </div>389 | 390 |             <div className="flex border-b">391 |               <button392 |                 onClick={() => setActiveTab('horizontal')}393 |                 className={`flex-1 p-3 text-sm font-medium ${394 |                   activeTab === 'horizontal'395 |                     ? 'border-b-2 border-blue-500 text-blue-600'396 |                     : 'text-gray-600 hover:text-gray-800'397 |                 }`}398 |               >399 |                 Horizontal Slides400 |               </button>401 |               <button402 |                 onClick={() => setActiveTab('vertical')}403 |                 className={`flex-1 p-3 text-sm font-medium ${404 |                   activeTab === 'vertical'405 |                     ? 'border-b-2 border-blue-500 text-blue-600'406 |                     : 'text-gray-600 hover:text-gray-800'407 |                 }`}408 |               >409 |                 Vertical Slides410 |               </button>411 |             </div>412 | 413 |             <div className="p-4 overflow-y-auto max-h-96">414 |               {activeTab === 'horizontal' && (415 |                 <div className="space-y-3">416 |                   <button417 |                     onClick={addHorizontalSlide}418 |                     className="w-full flex items-center justify-center gap-2 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors"419 |                   >420 |                     <Plus size={16} />421 |                     Add Horizontal Slide422 |                   </button>423 | 424 |                   {sections.map((section, index) => (425 |                     <div426 |                       key={section.id}427 |                       className={`p-3 border rounded-lg ${428 |                         currentSlide === index ? 'border-blue-500 bg-blue-50' : 'border-gray-200'429 |                       }`}430 |                     >431 |                       <div className="flex items-center justify-between mb-2">432 |                         <div>433 |                           <h4 className="font-medium">{section.title}</h4>434 |                           <p className="text-sm text-gray-500">435 |                             {section.verticalSlides?.length || 0} vertical slides436 |                           </p>437 |                         </div>438 |                         <div className="flex items-center gap-1">439 |                           <button440 |                             onClick={() => toggleSlideVisibility(index)}441 |                             className="p-1 text-gray-500 hover:bg-gray-100 rounded"442 |                             title={section.isVisible ? 'Hide slide' : 'Show slide'}443 |                           >444 |                             {section.isVisible ? <Eye size={16} /> : <EyeOff size={16} />}445 |                           </button>446 |                           <button447 |                             onClick={() => setEditingContent({ type: 'main' })}448 |                             className="p-1 text-blue-500 hover:bg-blue-50 rounded"449 |                             title="Edit content"450 |                           >451 |                             <Edit3 size={16} />452 |                           </button>453 |                           <button454 |                             onClick={() => deleteHorizontalSlide(index)}455 |                             disabled={sections.length <= 1}456 |                             className="p-1 text-red-500 hover:bg-red-50 rounded disabled:opacity-50 disabled:cursor-not-allowed"457 |                             title="Delete slide"458 |                           >459 |                             <Trash2 size={16} />460 |                           </button>461 |                         </div>462 |                       </div>463 |                     </div>464 |                   ))}465 |                 </div>466 |               )}467 | 468 |               {activeTab === 'vertical' && (469 |                 <div className="space-y-3">470 |                   <button471 |                     onClick={addVerticalSlide}472 |                     className="w-full flex items-center justify-center gap-2 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors"473 |                   >474 |                     <Plus size={16} />475 |                     Add Vertical Slide476 |                   </button>477 | 478 |                   {sections[currentSlide]?.verticalSlides?.map((verticalSlide, index) => (479 |                     <div480 |                       key={verticalSlide.id}481 |                       className={`p-3 border rounded-lg ${482 |                         currentVerticalSlide === index ? 'border-green-500 bg-green-50' : 'border-gray-200'483 |                       }`}484 |                     >485 |                       <div className="flex items-center justify-between">486 |                         <h4 className="font-medium">{verticalSlide.title}</h4>487 |                         <div className="flex items-center gap-1">488 |                           <button489 |                             onClick={() => setEditingContent({ type: 'vertical', index })}490 |                             className="p-1 text-blue-500 hover:bg-blue-50 rounded"491 |                             title="Edit content"492 |                           >493 |                             <Edit3 size={16} />494 |                           </button>495 |                           <button496 |                             onClick={() => deleteVerticalSlide(index)}497 |                             className="p-1 text-red-500 hover:bg-red-50 rounded"498 |                             title="Delete vertical slide"499 |                           >500 |                             <Trash2 size={16} />501 |                           </button>502 |                         </div>503 |                       </div>504 |                     </div>505 |                   )) || (506 |                     <p className="text-gray-500 text-center py-4">507 |                       No vertical slides in current horizontal slide508 |                     </p>509 |                   )}510 |                 </div>511 |               )}512 |             </div>513 |           </div>514 |         </div>515 |       )}516 | 517 |       {editingContent && (518 |         <ContentEditor519 |           content={520 |             editingContent.type === 'main'521 |               ? sections[currentSlide]?.content || ''522 |               : sections[currentSlide]?.verticalSlides?.[editingContent.index!]?.content || ''523 |           }524 |           onSave={updateSlideContent}525 |           onCancel={() => setEditingContent(null)}526 |         />527 |       )}528 |     </>529 |   );530 | };531 | 532 | const FullPageSlider = () => {533 |   const [sections, setSections] = useState<SectionData[]>([534 |     {535 |       id: 'hero',536 |       title: 'Hero Section',537 |       content: 'Welcome to our amazing fullpage scroller! This content can scroll vertically within this slide.',538 |       backgroundVideo: {539 |         src: 'https:540 |         poster: 'https:541 |         fallback: {542 |           image: 'https:543 |           color: '#1f2937'544 |         },545 |         options: { autoplay: true, loop: true, muted: true }546 |       },547 |       verticalSlides: [548 |         {549 |           id: 'hero-sub1',550 |           title: 'Hero Subsection 1',551 |           content: 'This is the first vertical slide within the hero section.',552 |           backgroundColor: 'rgba(59, 130, 246, 0.8)'553 |         },554 |         {555 |           id: 'hero-sub2',556 |           title: 'Hero Subsection 2',557 |           content: 'This is the second vertical slide within the hero section.',558 |           backgroundColor: 'rgba(16, 185, 129, 0.8)'559 |         }560 |       ],561 |       isVisible: true562 |     },563 |     {564 |       id: 'about',565 |       title: 'About Section',566 |       content: 'Learn more about us in this section. This slide has a background image.',567 |       backgroundImage: 'https:568 |       verticalSlides: [],569 |       isVisible: true570 |     },571 |     {572 |       id: 'services',573 |       title: 'Services Section',574 |       content: 'Our services are amazing! This slide has a solid background color.',575 |       backgroundColor: '#7c3aed',576 |       verticalSlides: [577 |         {578 |           id: 'services-sub1',579 |           title: 'Service Category 1',580 |           content: 'Details about our first service category.',581 |           backgroundColor: 'rgba(239, 68, 68, 0.8)'582 |         }583 |       ],584 |       isVisible: true585 |     }586 |   ]);587 | 588 |   const [currentSlide, setCurrentSlide] = useState(0);589 |   const [currentVerticalSlide, setCurrentVerticalSlide] = useState(0);590 |   const [isTransitioning, setIsTransitioning] = useState(false);591 |   const [touchStart, setTouchStart] = useState<{ x: number; y: number } | null>(null);592 |   const [isAutoPlaying, setIsAutoPlaying] = useState(false);593 |   const slideRefs = useRef<{ [key: string]: number }>({});594 |   const autoPlayRef = useRef<NodeJS.Timeout | null>(null);595 | 596 |   const visibleSections = useMemo(() =>597 |     sections.filter(section => section.isVisible !== false),598 |     [sections]599 |   );600 | 601 |   const headerConfig: HeaderConfig = {602 |     show: true,603 |     transparent: true,604 |     blur: true,605 |     title: 'Enhanced FullPage Scroller'606 |   };607 | 608 |   const navigationConfig: NavigationConfig = {609 |     show: true,610 |     position: 'right',611 |     type: 'dots'612 |   };613 | 614 |   const goToSlide = useCallback((index: number) => {615 |     if (index >= 0 && index < visibleSections.length && index !== currentSlide && !isTransitioning) {616 | 617 |       const currentSectionId = visibleSections[currentSlide]?.id;618 |       if (currentSectionId) {619 |         const slideElement = document.querySelector(`[data-slide-id="${currentSectionId}"]`);620 |         if (slideElement) {621 |           slideRefs.current[currentSectionId] = slideElement.scrollTop;622 |         }623 |       }624 | 625 |       setIsTransitioning(true);626 |       setCurrentSlide(index);627 |       setCurrentVerticalSlide(0);628 | 629 |       setTimeout(() => {630 |         setIsTransitioning(false);631 | 632 |         const newSectionId = visibleSections[index]?.id;633 |         if (newSectionId && slideRefs.current[newSectionId] !== undefined) {634 |           const slideElement = document.querySelector(`[data-slide-id="${newSectionId}"]`);635 |           if (slideElement) {636 |             slideElement.scrollTop = slideRefs.current[newSectionId];637 |           }638 |         }639 |       }, 600);640 |     }641 |   }, [currentSlide, visibleSections, isTransitioning]);642 | 643 |   const nextSlide = useCallback(() => {644 |     goToSlide((currentSlide + 1) % visibleSections.length);645 |   }, [currentSlide, visibleSections.length, goToSlide]);646 | 647 |   const prevSlide = useCallback(() => {648 |     goToSlide(currentSlide === 0 ? visibleSections.length - 1 : currentSlide - 1);649 |   }, [currentSlide, visibleSections.length, goToSlide]);650 | 651 |   const goToFirstSlide = useCallback(() => {652 |     goToSlide(0);653 |   }, [goToSlide]);654 | 655 |   const goToLastSlide = useCallback(() => {656 |     goToSlide(visibleSections.length - 1);657 |   }, [visibleSections.length, goToSlide]);658 | 659 |   const handleVerticalNavigation = useCallback((direction: 'up' | 'down') => {660 |     const currentSection = visibleSections[currentSlide];661 |     if (!currentSection?.verticalSlides?.length) return;662 | 663 |     if (direction === 'down' && currentVerticalSlide < currentSection.verticalSlides.length - 1) {664 |       setCurrentVerticalSlide(currentVerticalSlide + 1);665 |     } else if (direction === 'up' && currentVerticalSlide > 0) {666 |       setCurrentVerticalSlide(currentVerticalSlide - 1);667 |     }668 |   }, [currentSlide, currentVerticalSlide, visibleSections]);669 | 670 |   const toggleAutoPlay = useCallback(() => {671 |     if (isAutoPlaying) {672 |       if (autoPlayRef.current) {673 |         clearInterval(autoPlayRef.current);674 |         autoPlayRef.current = null;675 |       }676 |       setIsAutoPlaying(false);677 |     } else {678 |       autoPlayRef.current = setInterval(() => {679 |         setCurrentSlide(prev => (prev + 1) % visibleSections.length);680 |       }, 5000);681 |       setIsAutoPlaying(true);682 |     }683 |   }, [isAutoPlaying, visibleSections.length]);684 | 685 |   useEffect(() => {686 |     const handleKeyDown = (e: KeyboardEvent) => {687 |       if (isTransitioning) return;688 | 689 |       if (e.target && (e.target as HTMLElement).contentEditable === 'true') return;690 | 691 |       switch (e.key) {692 |         case 'ArrowLeft':693 |         case 'PageUp':694 |           e.preventDefault();695 |           prevSlide();696 |           break;697 |         case 'ArrowRight':698 |         case 'PageDown':699 |         case ' ':700 |           e.preventDefault();701 |           nextSlide();702 |           break;703 |         case 'ArrowUp':704 |           e.preventDefault();705 |           handleVerticalNavigation('up');706 |           break;707 |         case 'ArrowDown':708 |           e.preventDefault();709 |           handleVerticalNavigation('down');710 |           break;711 |         case 'Home':712 |           e.preventDefault();713 |           goToFirstSlide();714 |           break;715 |         case 'End':716 |           e.preventDefault();717 |           goToLastSlide();718 |           break;719 |         case 'Escape':720 |           e.preventDefault();721 |           if (isAutoPlaying) toggleAutoPlay();722 |           break;723 |       }724 |     };725 | 726 |     window.addEventListener('keydown', handleKeyDown);727 |     return () => window.removeEventListener('keydown', handleKeyDown);728 |   }, [nextSlide, prevSlide, handleVerticalNavigation, isTransitioning, goToFirstSlide, goToLastSlide, isAutoPlaying, toggleAutoPlay]);729 | 730 |   const handleTouchStart = (e: React.TouchEvent) => {731 |     const touch = e.touches[0];732 |     setTouchStart({733 |       x: touch.clientX,734 |       y: touch.clientY735 |     });736 |   };737 | 738 |   const handleTouchEnd = (e: React.TouchEvent) => {739 |     if (!touchStart) return;740 | 741 |     const touch = e.changedTouches[0];742 |     const deltaX = touch.clientX - touchStart.x;743 |     const deltaY = touch.clientY - touchStart.y;744 |     const minSwipeDistance = 50;745 |     const maxVerticalDeviation = 100;746 | 747 |     if (Math.abs(deltaX) > minSwipeDistance && Math.abs(deltaY) < maxVerticalDeviation) {748 |       e.preventDefault();749 |       if (deltaX > 0) {750 |         prevSlide();751 |       } else {752 |         nextSlide();753 |       }754 |     }755 | 756 |     else if (Math.abs(deltaY) > minSwipeDistance && Math.abs(deltaX) < maxVerticalDeviation) {757 |       e.preventDefault();758 |       if (deltaY > 0) {759 |         handleVerticalNavigation('up');760 |       } else {761 |         handleVerticalNavigation('down');762 |       }763 |     }764 | 765 |     setTouchStart(null);766 |   };767 | 768 |   useEffect(() => {769 |     return () => {770 |       if (autoPlayRef.current) {771 |         clearInterval(autoPlayRef.current);772 |       }773 |     };774 |   }, []);775 | 776 |   useEffect(() => {777 |     if (isAutoPlaying && (isTransitioning || touchStart)) {778 |       if (autoPlayRef.current) {779 |         clearInterval(autoPlayRef.current);780 |       }781 |       setTimeout(() => {782 |         if (isAutoPlaying) {783 |           autoPlayRef.current = setInterval(() => {784 |             setCurrentSlide(prev => (prev + 1) % visibleSections.length);785 |           }, 5000);786 |         }787 |       }, 10000);788 |     }789 |   }, [isTransitioning, touchStart, isAutoPlaying, visibleSections.length]);790 | 791 |   if (visibleSections.length === 0) {792 |     return (793 |       <div className="h-screen w-screen flex items-center justify-center bg-gray-900 text-white">794 |         <div className="text-center">795 |           <h2 className="text-2xl font-bold mb-4">No visible slides</h2>796 |           <p>Please add some slides or make existing slides visible.</p>797 |         </div>798 |       </div>799 |     );800 |   }801 | 802 |   return (803 |     <div className="h-screen w-screen overflow-hidden relative bg-gray-900">804 |       <Header805 |         config={headerConfig}806 |         currentSlide={currentSlide}807 |         totalSlides={visibleSections.length}808 |         onSlideClick={goToSlide}809 |       />810 | 811 |       <div812 |         className="flex h-full transition-transform duration-700 ease-out"813 |         style={{814 |           transform: `translateX(-${currentSlide * 100}vw)`,815 |           width: `${visibleSections.length * 100}vw`816 |         }}817 |         onTouchStart={handleTouchStart}818 |         onTouchEnd={handleTouchEnd}819 |       >820 |         {visibleSections.map((section, index) => {821 |           const isActive = index === currentSlide;822 |           const verticalSlides = section.verticalSlides || [];823 |           const hasVerticalSlides = verticalSlides.length > 0;824 | 825 |           return (826 |             <div827 |               key={section.id}828 |               data-slide-id={section.id}829 |               className="min-w-full h-full relative overflow-y-auto overflow-x-hidden scroll-smooth"830 |               style={{831 |                 scrollBehavior: 'smooth',832 |                 WebkitOverflowScrolling: 'touch'833 |               }}834 |             >835 |               {}836 |               {section.backgroundVideo && isActive && (837 |                 <VideoBackground config={section.backgroundVideo} />838 |               )}839 |               {section.backgroundImage && (840 |                 <div841 |                   className="absolute inset-0 bg-cover bg-center"842 |                   style={{ backgroundImage: `url(${section.backgroundImage})` }}843 |                 >844 |                   <div className="absolute inset-0 bg-black/30" />845 |                 </div>846 |               )}847 |               {section.backgroundColor && (848 |                 <div849 |                   className="absolute inset-0"850 |                   style={{ backgroundColor: section.backgroundColor }}851 |                 />852 |               )}853 | 854 |               {}855 |               <div className="relative z-10 min-h-full flex flex-col">856 |                 {}857 |                 <div className="flex-1 flex items-center justify-center p-8">858 |                   <div className="text-center text-white max-w-4xl">859 |                     <h2 className="text-4xl md:text-6xl font-bold mb-6 drop-shadow-lg">860 |                       {section.title}861 |                     </h2>862 |                     <p className="text-xl md:text-2xl mb-8 drop-shadow">863 |                       {section.content}864 |                     </p>865 | 866 |                     {hasVerticalSlides && (867 |                       <div className="text-sm opacity-75 mb-4">868 |                         Vertical Slides: {currentVerticalSlide + 1} of {verticalSlides.length}869 |                       </div>870 |                     )}871 | 872 |                     <div className="space-y-4">873 |                       <div className="text-lg">874 |                         This content can scroll vertically within the slide.875 |                       </div>876 |                       <div className="h-64 bg-white/10 rounded-lg p-4 backdrop-blur-sm">877 |                         <p>This is scrollable content within the slide. The horizontal navigation works independently from this vertical scroll.</p>878 |                         <div className="mt-4 space-y-2">879 |                           <div className="h-2 bg-white/20 rounded"></div>880 |                           <div className="h-2 bg-white/20 rounded w-3/4"></div>881 |                           <div className="h-2 bg-white/20 rounded w-1/2"></div>882 |                         </div>883 |                       </div>884 |                     </div>885 |                   </div>886 |                 </div>887 | 888 |                 {}889 |                 {hasVerticalSlides && verticalSlides.map((verticalSlide, vIndex) => (890 |                   <div891 |                     key={verticalSlide.id}892 |                     className={`min-h-screen flex items-center justify-center p-8 transition-all duration-500 ${893 |                       currentVerticalSlide === vIndex && isActive ? 'opacity-100 scale-100' : 'opacity-40 scale-95'894 |                     }`}895 |                     style={{896 |                       backgroundColor: verticalSlide.backgroundColor || 'rgba(0,0,0,0.5)'897 |                     }}898 |                   >899 |                     <div className="text-center text-white max-w-4xl">900 |                       <h3 className="text-3xl md:text-4xl font-bold mb-4 drop-shadow-lg">901 |                         {verticalSlide.title}902 |                       </h3>903 |                       <p className="text-lg md:text-xl drop-shadow">904 |                         {verticalSlide.content}905 |                       </p>906 |                       <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">907 |                         {Array.from({ length: 3 }, (_, i) => (908 |                           <div key={i} className="bg-white/10 backdrop-blur-sm rounded-lg p-4">909 |                             <h4 className="font-semibold mb-2">Feature {i + 1}</h4>910 |                             <p className="text-sm opacity-75">Description of this amazing feature.</p>911 |                           </div>912 |                         ))}913 |                       </div>914 |                     </div>915 |                   </div>916 |                 ))}917 | 918 |                 {}919 |                 <div className="bg-black/20 backdrop-blur-sm m-8 rounded-lg p-8 text-white">920 |                   <h3 className="text-2xl font-bold mb-4">Additional Content</h3>921 |                   <p className="mb-4">This demonstrates that each slide can have its own vertical scrolling content that works independently from horizontal navigation.</p>922 |                   <div className="grid grid-cols-1 md:grid-cols-2 gap-4">923 |                     {Array.from({ length: 8 }, (_, i) => (924 |                       <div key={i} className="p-4 bg-white/10 rounded transition-all duration-200 hover:bg-white/20">925 |                         <h4 className="font-semibold mb-2">Content Block {i + 1}</h4>926 |                         <p className="text-sm opacity-75">This content scrolls vertically within the slide and demonstrates the independent scrolling behavior.</p>927 |                         <div className="mt-2 flex space-x-2">928 |                           <div className="w-2 h-2 bg-blue-400 rounded-full"></div>929 |                           <div className="w-2 h-2 bg-green-400 rounded-full"></div>930 |                           <div className="w-2 h-2 bg-purple-400 rounded-full"></div>931 |                         </div>932 |                       </div>933 |                     ))}934 |                   </div>935 |                 </div>936 |               </div>937 | 938 |               {}939 |               <div className="absolute top-4 right-4 bg-black/50 text-white px-3 py-1 rounded text-sm backdrop-blur-sm">940 |                 Slide {index + 1} of {visibleSections.length}941 |               </div>942 | 943 |               {}944 |               {section.backgroundVideo && !isActive && (945 |                 <div className="absolute inset-0 bg-gray-800 flex items-center justify-center">946 |                   <div className="text-white text-center">947 |                     <div className="animate-pulse w-16 h-16 bg-white/20 rounded-full mb-4 mx-auto"></div>948 |                     <p>Loading...</p>949 |                   </div>950 |                 </div>951 |               )}952 |             </div>953 |           );954 |         })}955 |       </div>956 | 957 |       <Navigation958 |         config={navigationConfig}959 |         currentSlide={currentSlide}960 |         totalSlides={visibleSections.length}961 |         onNavigate={goToSlide}962 |       />963 | 964 |       {}965 |       <button966 |         onClick={prevSlide}967 |         disabled={isTransitioning}968 |         className="fixed left-4 top-1/2 transform -translate-y-1/2 z-40 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full disabled:opacity-50 transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50"969 |         aria-label="Previous slide"970 |       >971 |         <ChevronLeft size={24} />972 |       </button>973 | 974 |       <button975 |         onClick={nextSlide}976 |         disabled={isTransitioning}977 |         className="fixed right-20 top-1/2 transform -translate-y-1/2 z-40 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full disabled:opacity-50 transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50"978 |         aria-label="Next slide"979 |       >980 |         <ChevronRight size={24} />981 |       </button>982 | 983 |       {}984 |       <button985 |         onClick={toggleAutoPlay}986 |         className={`fixed right-4 bottom-20 z-40 text-white p-2 rounded-full transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50 ${987 |           isAutoPlaying ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'988 |         }`}989 |         aria-label={isAutoPlaying ? 'Stop auto-play' : 'Start auto-play'}990 |         title={isAutoPlaying ? 'Stop auto-play' : 'Start auto-play'}991 |       >992 |         {isAutoPlaying ? <Pause size={16} /> : <Play size={16} />}993 |       </button>994 | 995 |       {}996 |       {visibleSections[currentSlide]?.verticalSlides && visibleSections[currentSlide].verticalSlides!.length > 0 && (997 |         <div className="fixed bottom-32 left-1/2 transform -translate-x-1/2 z-40 flex flex-col items-center space-y-2">998 |           <div className="text-white text-sm bg-black/50 px-3 py-1 rounded backdrop-blur-sm">999 |             ↕ Vertical: {currentVerticalSlide + 1}/{visibleSections[currentSlide].verticalSlides!.length}1000 |           </div>1001 |           <div className="flex flex-col space-y-1">1002 |             {visibleSections[currentSlide].verticalSlides!.map((_, vIndex) => (1003 |               <button1004 |                 key={vIndex}1005 |                 onClick={() => setCurrentVerticalSlide(vIndex)}1006 |                 className={`w-2 h-2 rounded-full border border-white transition-all duration-200 hover:scale-125 ${1007 |                   currentVerticalSlide === vIndex ? 'bg-white' : 'bg-transparent'1008 |                 }`}1009 |                 aria-label={`Go to vertical slide ${vIndex + 1}`}1010 |               />1011 |             ))}1012 |           </div>1013 |         </div>1014 |       )}1015 | 1016 |       {}1017 |       <div className="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40 bg-black/70 text-white px-4 py-2 rounded text-sm text-center backdrop-blur-sm max-w-md">1018 |         <div className="mb-1">← → / PgUp PgDn / Space: Navigate slides</div>1019 |         <div className="mb-1">↑ ↓: Navigate vertical content</div>1020 |         <div className="mb-1">Home / End: First / Last slide</div>1021 |         <div>Swipe / Scroll within slides / ESC: Stop autoplay</div>1022 |       </div>1023 | 1024 |       {}1025 |       <div className="fixed bottom-0 left-0 right-0 z-40">1026 |         <div className="h-1 bg-black/30">1027 |           <div1028 |             className="h-full bg-white transition-all duration-700 ease-out"1029 |             style={{ width: `${((currentSlide + 1) / visibleSections.length) * 100}%` }}1030 |           />1031 |         </div>1032 |       </div>1033 | 1034 |       <SlideManagementPanel1035 |         sections={sections}1036 |         setSections={setSections}1037 |         currentSlide={currentSlide}1038 |         currentVerticalSlide={currentVerticalSlide}1039 |         setCurrentVerticalSlide={setCurrentVerticalSlide}1040 |         goToSlide={goToSlide}1041 |       />1042 |     </div>1043 |   );1044 | };1045 | 1046 | export default FullPageSlider;
============================================================END: frontend/components/FullPageSlider.tsx============================================================


============================================================FILE: frontend/components/Header.tsxSIZE: 16.19 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useEffect } from 'react';  4 | import { Menu, X, LogIn, Settings, User, Package, Calendar } from 'lucide-react';  5 | import { motion, AnimatePresence } from 'framer-motion';  6 | import Link from 'next/link';  7 | import Image from 'next/image';  8 | import { useRouter } from 'next/navigation';  9 |  10 | import { useLogo } from '../hooks/useLogo'; 11 |  12 | interface HeaderProps { 13 |   language: "en" | "es"; 14 |   setLanguage: (language: "en" | "es") => void; 15 |   scrollToSection: (section: string) => void; 16 |   t: Record<string, string | Record<string, string>>; 17 |   isMenuOpen: boolean; 18 |   setIsMenuOpen: (isOpen: boolean) => void; 19 |   onLoginClick: () => void; 20 |   user: { email: string } | null; 21 |   isAdmin: boolean; 22 | } 23 |  24 | export function Header({ 25 |   language, 26 |   setLanguage, 27 |   scrollToSection, 28 |   t, 29 |   isMenuOpen, 30 |   setIsMenuOpen, 31 |   onLoginClick, 32 |   user, 33 |   isAdmin 34 | }: HeaderProps) { 35 |   const { logoSettings, isLoading } = useLogo(); 36 |   const router = useRouter(); 37 |  38 |   useEffect(() => { 39 |     if (!isMenuOpen) return; 40 |  41 |     let touchStartX = 0; 42 |     let touchStartY = 0; 43 |  44 |     const handleTouchStart = (e: TouchEvent) => { 45 |       touchStartX = e.touches[0].clientX; 46 |       touchStartY = e.touches[0].clientY; 47 |     }; 48 |  49 |     const handleTouchEnd = (e: TouchEvent) => { 50 |       const touchEndX = e.changedTouches[0].clientX; 51 |       const touchEndY = e.changedTouches[0].clientY; 52 |       const deltaX = touchEndX - touchStartX; 53 |       const deltaY = Math.abs(touchEndY - touchStartY); 54 |  55 |       if (deltaX > 100 && deltaY < 50 && touchStartX < 50) { 56 |         setIsMenuOpen(false); 57 |       } 58 |     }; 59 |  60 |     const handleEscape = (e: KeyboardEvent) => { 61 |       if (e.key === 'Escape') { 62 |         setIsMenuOpen(false); 63 |       } 64 |     }; 65 |  66 |     document.addEventListener('touchstart', handleTouchStart, { passive: true }); 67 |     document.addEventListener('touchend', handleTouchEnd, { passive: true }); 68 |     document.addEventListener('keydown', handleEscape); 69 |  70 |     document.body.style.overflow = 'hidden'; 71 |  72 |     return () => { 73 |       document.removeEventListener('touchstart', handleTouchStart); 74 |       document.removeEventListener('touchend', handleTouchEnd); 75 |       document.removeEventListener('keydown', handleEscape); 76 |       document.body.style.overflow = 'unset'; 77 |     }; 78 |   }, [isMenuOpen, setIsMenuOpen]); 79 |  80 |   return ( 81 |     <header className="fixed top-0 left-0 right-0 z-[9997] bg-white shadow-sm border-b border-gray-200 safe-padding"> 82 |       <div className="container mx-auto px-3 sm:px-4 lg:px-6 py-0 flex items-center justify-between header-container h-10"> 83 |         <motion.div 84 |           className="flex items-center space-x-2 cursor-pointer touch-manipulation min-h-[24px] min-w-[24px] flex items-center justify-center" 85 |           onClick={() => scrollToSection('invitation')} 86 |           whileHover={{ scale: 1.05 }} 87 |           whileTap={{ scale: 0.95 }} 88 |         > 89 |           {isLoading ? ( 90 |             <div className="h-16 sm:h-20 md:h-24 lg:h-28 w-20 bg-gray-300 animate-pulse rounded"></div> 91 |           ) : logoSettings.isActive ? ( 92 |             logoSettings.type === 'text' ? ( 93 |               <span className="font-heading text-base sm:text-lg md:text-xl lg:text-2xl text-gray-800 font-semibold"> 94 |                 {logoSettings.text || 'MatMax'} 95 |               </span> 96 |             ) : logoSettings.imageUrl ? ( 97 |               <Image 98 |                 src={logoSettings.imageUrl} 99 |                 alt="MatMax Yoga Studio Logo"100 |                 width={120}101 |                 height={120}102 |                 className="h-16 sm:h-20 md:h-24 lg:h-28 object-contain"103 |               />104 |             ) : (105 |               <span className="font-heading text-base sm:text-lg md:text-xl lg:text-2xl text-gray-800 font-semibold">MatMax</span>106 |             )107 |           ) : (108 |             <span className="font-heading text-base sm:text-lg md:text-xl lg:text-2xl text-gray-800 font-semibold">MatMax</span>109 |           )}110 |         </motion.div>111 | 112 |         <div className="flex items-center justify-center sm:justify-end space-x-2 sm:space-x-4 lg:space-x-6 flex-1 sm:flex-none">113 |           {}114 |           <div className="flex sm:hidden items-center space-x-1">115 |             <button116 |               onClick={() => setLanguage('en')}117 |               className={`px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-200 touch-manipulation min-h-[36px] min-w-[36px] flex items-center justify-center ${118 |                 language === 'en'119 |                   ? 'bg-[#6ea058] text-white shadow-sm'120 |                   : 'text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10'121 |               }`}122 |             >123 |               EN124 |             </button>125 |             <span className="text-gray-400 text-xs">|</span>126 |             <button127 |               onClick={() => setLanguage('es')}128 |               className={`px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-200 touch-manipulation min-h-[36px] min-w-[36px] flex items-center justify-center ${129 |                 language === 'es'130 |                   ? 'bg-[#6ea058] text-white shadow-sm'131 |                   : 'text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10'132 |               }`}133 |             >134 |               ES135 |             </button>136 |           </div>137 | 138 |           {}139 |           <div className="hidden sm:flex items-center space-x-2">140 |             <button141 |               onClick={() => setLanguage('en')}142 |               className={`touch-manipulation px-3 py-1.5 text-sm font-medium rounded-lg transition-all duration-200 min-h-[36px] min-w-[36px] flex items-center justify-center ${143 |                 language === 'en' ? 'header-button-language-active' : 'header-button-language-inactive'144 |               }`}145 |             >146 |               EN147 |             </button>148 |             <span className="text-gray-400">|</span>149 |             <button150 |               onClick={() => setLanguage('es')}151 |               className={`touch-manipulation px-3 py-1.5 text-sm font-medium rounded-lg transition-all duration-200 min-h-[36px] min-w-[36px] flex items-center justify-center ${152 |                 language === 'es' ? 'header-button-language-active' : 'header-button-language-inactive'153 |               }`}154 |             >155 |               ES156 |             </button>157 |           </div>158 | 159 |           {}160 |           <Link href="/account/book">161 |             <motion.button162 |               whileHover={{ scale: 1.05 }}163 |               whileTap={{ scale: 0.95 }}164 |               className="hidden sm:flex items-center space-x-1 header-button-account"165 |             >166 |               <Calendar size={14} />167 |               <span>Schedule</span>168 |             </motion.button>169 |           </Link>170 | 171 |           {}172 |           <Link href="/packages">173 |             <motion.button174 |               whileHover={{ scale: 1.05 }}175 |               whileTap={{ scale: 0.95 }}176 |               className="hidden sm:flex items-center space-x-1 header-button-account"177 |             >178 |               <Package size={14} />179 |               <span>Packages</span>180 |             </motion.button>181 |           </Link>182 | 183 |           {}184 |           {user && !isAdmin && (185 |             <Link href="/account">186 |               <motion.button187 |                 whileHover={{ scale: 1.05 }}188 |                 whileTap={{ scale: 0.95 }}189 |                 className="hidden sm:flex items-center space-x-1 header-button-account"190 |               >191 |                 <User size={14} />192 |                 <span>Account</span>193 |               </motion.button>194 |             </Link>195 |           )}196 | 197 |           {}198 |           {user && isAdmin ? (199 |             <motion.button200 |               onClick={onLoginClick}201 |               whileHover={{ scale: 1.05 }}202 |               whileTap={{ scale: 0.95 }}203 |               className="hidden sm:flex items-center space-x-1 header-button-account"204 |             >205 |               <Settings size={14} />206 |               <span>Dashboard</span>207 |             </motion.button>208 |           ) : (209 |             <motion.button210 |               onClick={() => router.push('/login')}211 |               whileHover={{ scale: 1.05 }}212 |               whileTap={{ scale: 0.95 }}213 |               className="hidden sm:flex items-center space-x-1 header-button-language-inactive"214 |             >215 |               <LogIn size={14} />216 |               <span>{(t.nav as Record<string, string>).login || 'Login'}</span>217 |             </motion.button>218 |           )}219 | 220 |           <motion.button221 |             onClick={() => setIsMenuOpen(!isMenuOpen)}222 |             whileHover={{ scale: 1.05 }}223 |             whileTap={{ scale: 0.95 }}224 |             className="flex items-center justify-center rounded-lg header-button-menu touch-manipulation focus-visible px-4 py-2 sm:px-3 sm:py-2 min-h-[44px] min-w-[44px] relative overflow-hidden"225 |             aria-label={isMenuOpen ? 'Close menu' : 'Open menu'}226 |             aria-expanded={isMenuOpen}227 |           >228 |             {}229 |             <div className="flex sm:hidden items-center space-x-2">230 |               <span className="text-sm font-medium">231 |                 {isMenuOpen ? 'Close' : 'Menu'}232 |               </span>233 |               <motion.div234 |                 animate={{ rotate: isMenuOpen ? 180 : 0 }}235 |                 transition={{ duration: 0.3 }}236 |               >237 |                 {isMenuOpen ? <X size={16} /> : <Menu size={16} />}238 |               </motion.div>239 |             </div>240 | 241 |             {}242 |             <motion.div243 |               animate={{ rotate: isMenuOpen ? 180 : 0 }}244 |               transition={{ duration: 0.3 }}245 |               className="hidden sm:block"246 |             >247 |               {isMenuOpen ? <X size={20} /> : <Menu size={20} />}248 |             </motion.div>249 | 250 |             {}251 |             <motion.div252 |               className="absolute inset-0 bg-white/10 rounded-lg"253 |               initial={{ scale: 0, opacity: 0 }}254 |               whileTap={{ scale: 1, opacity: 1 }}255 |               transition={{ duration: 0.2 }}256 |             />257 |           </motion.button>258 |         </div>259 |       </div>260 | 261 |       {}262 |       <AnimatePresence>263 |         {isMenuOpen && (264 |           <>265 |             <motion.div266 |               initial={{ opacity: 0 }}267 |               animate={{ opacity: 1 }}268 |               exit={{ opacity: 0 }}269 |               className="fixed inset-0 bg-black/50 z-[9998] backdrop-blur-sm"270 |               onClick={() => setIsMenuOpen(false)}271 |             />272 |             <motion.div273 |               initial={{ x: '-100%' }}274 |               animate={{ x: 0 }}275 |               exit={{ x: '-100%' }}276 |               transition={{ type: "spring", stiffness: 300, damping: 30 }}277 |               className="fixed top-0 left-0 h-full w-80 max-w-[85vw] bg-white shadow-xl z-[9999] mobile-menu"278 |             >279 |               <div className="flex flex-col h-full p-4 sm:p-6 safe-padding">280 |                 <div className="flex items-center justify-between mb-6 sm:mb-8">281 |                   <span className="font-heading text-lg sm:text-xl text-black font-semibold">MatMax</span>282 |                   <button283 |                     onClick={() => setIsMenuOpen(false)}284 |                     className="w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-lg hover:bg-gray-100 text-gray-600 hover:text-black transition-colors touch-manipulation min-h-[44px] min-w-[44px]"285 |                   >286 |                     <X size={20} />287 |                   </button>288 |                 </div>289 | 290 |                 <nav className="flex-1 space-y-2 sm:space-y-3">291 |                   <Link href="/account/book">292 |                     <motion.button293 |                       whileHover={{ scale: 1.02 }}294 |                       whileTap={{ scale: 0.98 }}295 |                       className="w-full text-center px-4 sm:px-6 py-4 sm:py-5 rounded-xl transition-all duration-200 flex items-center justify-center space-x-3 sm:space-x-4 touch-manipulation min-h-[52px] text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10 active:bg-[#6ea058]/15 border border-gray-200 hover:border-[#6ea058]/30"296 |                     >297 |                       <Calendar size={18} />298 |                       <span className="text-base sm:text-lg font-medium">Schedule</span>299 |                     </motion.button>300 |                   </Link>301 | 302 |                   <Link href="/packages">303 |                     <motion.button304 |                       whileHover={{ scale: 1.02 }}305 |                       whileTap={{ scale: 0.98 }}306 |                       className="w-full text-center px-4 sm:px-6 py-4 sm:py-5 rounded-xl transition-all duration-200 flex items-center justify-center space-x-3 sm:space-x-4 touch-manipulation min-h-[52px] text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10 active:bg-[#6ea058]/15 border border-gray-200 hover:border-[#6ea058]/30"307 |                     >308 |                       <Package size={18} />309 |                       <span className="text-base sm:text-lg font-medium">Packages</span>310 |                     </motion.button>311 |                   </Link>312 | 313 |                   {user && !isAdmin && (314 |                     <Link href="/account">315 |                       <motion.button316 |                         whileHover={{ scale: 1.02 }}317 |                         whileTap={{ scale: 0.98 }}318 |                         className="w-full text-center px-4 sm:px-6 py-4 sm:py-5 rounded-xl transition-all duration-200 flex items-center justify-center space-x-3 sm:space-x-4 touch-manipulation min-h-[52px] text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10 active:bg-[#6ea058]/15 border border-gray-200 hover:border-[#6ea058]/30"319 |                       >320 |                         <User size={18} />321 |                         <span className="text-base sm:text-lg font-medium">Account</span>322 |                       </motion.button>323 |                     </Link>324 |                   )}325 | 326 |                   <motion.button327 |                     onClick={() => {328 |                       if (user && isAdmin) {329 |                         router.push('/admin');330 |                       } else {331 |                         router.push('/login');332 |                       }333 |                     }}334 |                     whileHover={{ scale: 1.02 }}335 |                     whileTap={{ scale: 0.98 }}336 |                     className="w-full text-center px-4 sm:px-6 py-4 sm:py-5 rounded-xl transition-all duration-200 flex items-center justify-center space-x-3 sm:space-x-4 touch-manipulation min-h-[52px] text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10 active:bg-[#6ea058]/15 border border-gray-200 hover:border-[#6ea058]/30"337 |                   >338 |                     <LogIn size={18} />339 |                     <span className="text-base sm:text-lg font-medium">340 |                       {user && isAdmin ? 'Dashboard' : (t.nav as Record<string, string>).login || 'Login'}341 |                     </span>342 |                   </motion.button>343 |                 </nav>344 | 345 |                 {}346 |                 <div className="pt-4 border-t border-gray-200">347 |                   <div className="flex items-center justify-center space-x-3">348 |                     <button349 |                       onClick={() => setLanguage('en')}350 |                       className={`px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 touch-manipulation min-h-[40px] min-w-[40px] flex items-center justify-center ${351 |                         language === 'en'352 |                           ? 'bg-[#6ea058] text-white shadow-sm'353 |                           : 'text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10 border border-gray-200'354 |                       }`}355 |                     >356 |                       EN357 |                     </button>358 |                     <span className="text-gray-400">|</span>359 |                     <button360 |                       onClick={() => setLanguage('es')}361 |                       className={`px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 touch-manipulation min-h-[40px] min-w-[40px] flex items-center justify-center ${362 |                         language === 'es'363 |                           ? 'bg-[#6ea058] text-white shadow-sm'364 |                           : 'text-black hover:text-[#6ea058] hover:bg-[#6ea058]/10 border border-gray-200'365 |                       }`}366 |                     >367 |                       ES368 |                     </button>369 |                   </div>370 |                 </div>371 |               </div>372 |             </motion.div>373 |           </>374 |         )}375 |       </AnimatePresence>376 | 377 |     </header>378 |   );379 | }
============================================================END: frontend/components/Header.tsx============================================================


============================================================FILE: frontend/components/HeroSection.tsxSIZE: 2.46 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { motion } from 'framer-motion';  5 | import { ChevronDown } from 'lucide-react';  6 |   7 | interface HeroSectionProps {  8 |   t: Record<string, string | Record<string, string>>;  9 | } 10 |  11 | export function HeroSection({ t }: HeroSectionProps) { 12 |   return ( 13 |     <section className="h-full flex flex-col items-center justify-center text-center px-3 sm:px-4 md:px-6 lg:px-8 relative safe-padding"> 14 |       {} 15 |       <div className="w-full max-w-7xl mx-auto flex flex-col items-center justify-center min-h-[calc(100vh-120px)] sm:min-h-[calc(100vh-140px)]"> 16 |         <motion.div 17 |           initial={{ scale: 0, opacity: 0 }} 18 |           animate={{ scale: 1, opacity: 1 }} 19 |           transition={{ duration: 1, ease: "easeOut" }} 20 |           className="w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 bg-[#FFD700] rounded-full mb-4 sm:mb-6 md:mb-8 shadow-lg shadow-[#FFD700]/50 cosmic-glow" 21 |         /> 22 |  23 |         <motion.h1 24 |           initial={{ opacity: 0, y: 30 }} 25 |           animate={{ opacity: 1, y: 0 }} 26 |           transition={{ duration: 0.8, delay: 0.5 }} 27 |           className="text-2xl xs:text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-heading text-[#EAEAEA] mb-3 sm:mb-4 md:mb-6 max-w-6xl leading-[1.1] sm:leading-tight px-2 font-bold" 28 |         > 29 |           {(t.hero as Record<string, string>).title} 30 |         </motion.h1> 31 |  32 |         <motion.p 33 |           initial={{ opacity: 0, y: 20 }} 34 |           animate={{ opacity: 1, y: 0 }} 35 |           transition={{ duration: 0.8, delay: 0.8 }} 36 |           className="text-sm xs:text-base sm:text-lg md:text-xl lg:text-2xl text-[#EAEAEA]/90 max-w-4xl mb-6 sm:mb-8 md:mb-12 leading-relaxed px-3 sm:px-4 font-light" 37 |         > 38 |           {(t.hero as Record<string, string>).subtitle} 39 |         </motion.p> 40 |  41 |         <motion.div 42 |           initial={{ opacity: 0 }} 43 |           animate={{ opacity: 1 }} 44 |           transition={{ duration: 0.8, delay: 1.2 }} 45 |           className="flex items-center space-x-2 sm:space-x-3 text-[#C0C0C0] mt-2 sm:mt-4" 46 |         > 47 |           <span className="text-xs sm:text-sm md:text-base font-body">{(t.hero as Record<string, string>).scrollDown}</span> 48 |           <motion.div 49 |             animate={{ y: [0, 8, 0] }} 50 |             transition={{ duration: 2, repeat: Infinity }} 51 |             className="flex items-center justify-center" 52 |           > 53 |             <ChevronDown size={18} className="sm:w-5 sm:h-5 md:w-6 md:h-6" /> 54 |           </motion.div> 55 |         </motion.div> 56 |       </div> 57 |     </section> 58 |   ); 59 | }
============================================================END: frontend/components/HeroSection.tsx============================================================


============================================================FILE: frontend/components/ImageManagement.tsxSIZE: 26.63 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 |   5 | import {  6 |   Upload, Image, HardDrive, Globe, Clock, Edit, Trash2,  7 |   Filter, RefreshCw  8 | } from 'lucide-react';  9 | import { BaseButton } from './ui/BaseButton'; 10 | import { BaseInput } from './ui/BaseInput'; 11 | import { BaseModal, ConfirmationModal } from './ui/BaseModal'; 12 | import { useAuth } from '../hooks/useAuth'; 13 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from './ui/card'; 14 | import { Label } from './ui/label'; 15 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select'; 16 | import { Badge } from './ui/badge'; 17 | import { colors, spacing, typography, borders } from '@/lib/design-system'; 18 |  19 | interface ImageData { 20 |   profileImage?: string; 21 | } 22 |  23 | export function ImageManagement() { 24 |   const { user } = useAuth(); 25 |   const [images, setImages] = useState<ImageData>({}); 26 |   const [isLoading, setIsLoading] = useState(true); 27 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null); 28 |   const [error, setError] = useState<string | null>(null); 29 |   const [success, setSuccess] = useState<string | null>(null); 30 |   const [showUploadModal, setShowUploadModal] = useState(false); 31 |   const [showEditModal, setShowEditModal] = useState(false); 32 |   const [showDeleteModal, setShowDeleteModal] = useState(false); 33 |   const [editingImage, setEditingImage] = useState<{ id: string; name: string; url: string; alt?: string; category?: string } | null>(null); 34 |   const [deletingImage, setDeletingImage] = useState<{ id: string; name: string; url: string; alt?: string; category?: string } | null>(null); 35 |   const [editFormData, setEditFormData] = useState({ 36 |     name: '', 37 |     alt: '', 38 |     category: 'general' 39 |   }); 40 |   const [filters, setFilters] = useState({ 41 |     type: 'all', 42 |     isPublic: 'all', 43 |     size: 'all' 44 |   }); 45 |   const [totalSize] = useState(0); 46 |   const [lastUpload] = useState<string | null>(null); 47 |  48 |   const formatFileSize = (bytes: number) => { 49 |     if (bytes === 0) return '0 Bytes'; 50 |     const k = 1024; 51 |     const sizes = ['Bytes', 'KB', 'MB', 'GB']; 52 |     const i = Math.floor(Math.log(bytes) / Math.log(k)); 53 |     return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]; 54 |   }; 55 |  56 |   const formatDate = (date: string) => { 57 |     return new Date(date).toLocaleDateString(); 58 |   }; 59 |  60 |   const loadImages = useCallback(async () => { 61 |     try { 62 |       setIsLoading(true); 63 |       setError(null); 64 |  65 |       if (!user?.access_token) { 66 |         setError('Authentication required'); 67 |         return; 68 |       } 69 |  70 |       const response = await fetch(`/api/admin/images`, { 71 |         headers: { 72 |           'Authorization': `Bearer ${user.access_token}`, 73 |           'Content-Type': 'application/json' 74 |         } 75 |       }); 76 |  77 |       if (!response.ok) { 78 |         const errorText = await response.text(); 79 |         throw new Error(`Failed to load images: ${response.status}`); 80 |       } 81 |  82 |       const data = await response.json(); 83 |       .length, 'items'); 84 |       setImages(data.images || {}); 85 |     } catch (err: unknown) { 86 |       setError(`Failed to load images: ${(err as Error).message}`); 87 |     } finally { 88 |       setIsLoading(false); 89 |     } 90 |   }, [user?.access_token]); 91 |  92 |   const refreshImageData = useCallback(async () => { 93 |     if (user?.access_token) { 94 |       setIsLoading(true); 95 |       try { 96 |         await loadImages(); 97 |         setLastLoaded(new Date()); 98 |         } catch (error) { 99 |         } finally {100 |         setIsLoading(false);101 |       }102 |     }103 |   }, [user?.access_token, loadImages]);104 | 105 |   useEffect(() => {106 |     if (user?.access_token) {107 |       setIsLoading(true);108 |       loadImages().then(() => {109 |         setLastLoaded(new Date());110 |         setIsLoading(false);111 |       }).catch((error) => {112 |         setIsLoading(false);113 |       });114 |     } else {115 |       setImages({});116 |       setIsLoading(false);117 |     }118 |   }, [user?.access_token, loadImages]);119 | 120 |   const handleEdit = (image: Record<string, unknown>) => {121 |     setEditingImage(image as { id: string; name: string; url: string; alt?: string; category?: string });122 |     setEditFormData({123 |       name: String(image.name || ''),124 |       alt: String(image.alt || ''),125 |       category: String(image.category || 'general')126 |     });127 |     setShowEditModal(true);128 |   };129 | 130 |   const handleDelete = (image: Record<string, unknown>) => {131 |     setDeletingImage(image as { id: string; name: string; url: string; alt?: string; category?: string });132 |     setShowDeleteModal(true);133 |   };134 | 135 |   const confirmDelete = async () => {136 |     if (!deletingImage) return;137 | 138 |     try {139 |       const response = await fetch(`/api/admin/images?id=${deletingImage.id}`, {140 |         method: 'DELETE',141 |         headers: {142 |           'Authorization': `Bearer ${user?.access_token}`,143 |           'Content-Type': 'application/json'144 |         }145 |       });146 | 147 |       if (response.ok) {148 |         setSuccess('Image deleted successfully');149 |         loadImages();150 |         setShowDeleteModal(false);151 |         setDeletingImage(null);152 |       } else {153 |         setError('Failed to delete image');154 |       }155 |     } catch (err: unknown) {156 |       setError(`Error deleting image: ${(err as Error).message}`);157 |     }158 |   };159 | 160 |   const handleEditSubmit = async (e: React.FormEvent) => {161 |     e.preventDefault();162 | 163 |     if (!editingImage) return;164 | 165 |     try {166 |       const response = await fetch(`/api/admin/images?id=${editingImage.id}`, {167 |         method: 'PUT',168 |         headers: {169 |           'Authorization': `Bearer ${user?.access_token}`,170 |           'Content-Type': 'application/json'171 |         },172 |         body: JSON.stringify(editFormData)173 |       });174 | 175 |       if (response.ok) {176 |         setSuccess('Image updated successfully');177 |         loadImages();178 |         setShowEditModal(false);179 |         setEditingImage(null);180 |       } else {181 |         setError('Failed to update image');182 |       }183 |     } catch (err: unknown) {184 |       setError(`Error updating image: ${(err as Error).message}`);185 |     }186 |   };187 | 188 |   const applyFilters = () => {189 | 190 |     };191 | 192 |   const clearFilters = () => {193 |     setFilters({194 |       type: 'all',195 |       isPublic: 'all',196 |       size: 'all'197 |     });198 |   };199 | 200 |   if (isLoading) {201 |     return (202 |       <div className={`flex items-center justify-center min-h-[400px]`}>203 |         <div className="text-center">204 |           <div className={`w-16 h-16 border-4 border-[${colors.accent[500]}] border-t-transparent rounded-full animate-spin mx-auto mb-[${spacing[4]}]`}></div>205 |           <p className={`text-[${colors.accent[500]}] text-lg font-semibold`}>Loading images...</p>206 |         </div>207 |       </div>208 |     );209 |   }210 | 211 |   if (error && !images || Object.keys(images).length === 0) {212 |     return (213 |       <div className={`text-center py-[${spacing[12]}]`}>214 |         <div className={`w-24 h-24 bg-[${colors.semantic.surface.secondary}] rounded-full flex items-center justify-center mx-auto mb-[${spacing[4]}]`}>215 |           {}216 |           <Image className={`w-12 h-12 text-[${colors.text.secondary}]`} />217 |         </div>218 |         <h3 className={`text-[${typography.fontSize.xl}] font-[${typography.fontWeight.semibold}] text-[${colors.text.primary}] mb-[${spacing[2]}]`}>219 |           No images found220 |         </h3>221 |         <p className={`text-[${colors.text.secondary}] mb-[${spacing[6]}]`}>222 |           Upload your first image to get started223 |         </p>224 |         <BaseButton225 |           onClick={() => setShowUploadModal(true)}226 |           variant="primary"227 |           size="lg"228 |           leftIcon={<Upload className="w-5 h-5" />}229 |         >230 |           Upload First Image231 |         </BaseButton>232 |       </div>233 |     );234 |   }235 | 236 |   return (237 |     <div className="dashboard-container p-6 space-y-6">238 |       {}239 |       <div className="flex items-center justify-between">240 |         <div>241 |           <h2 className="dashboard-text-primary text-3xl font-bold">242 |             Image Management243 |           </h2>244 |           <p className="dashboard-text-secondary">245 |             Manage website images, logos, and visual assets246 |           </p>247 |           {lastLoaded && (248 |             <p className="dashboard-text-muted text-sm mt-1">249 |               Last updated: {lastLoaded.toLocaleTimeString()}250 |             </p>251 |           )}252 |         </div>253 |         <div className="flex gap-2">254 |           <BaseButton255 |             onClick={refreshImageData}256 |             disabled={isLoading}257 |             variant="outline"258 |             size="lg"259 |             leftIcon={<RefreshCw className={`w-4 h-4 ${isLoading ? 'animate-spin' : ''}`} />}260 |           >261 |             Refresh262 |           </BaseButton>263 |           <BaseButton264 |             onClick={() => setShowUploadModal(true)}265 |             variant="primary"266 |             size="lg"267 |             leftIcon={<Upload className="w-4 h-4" />}268 |           >269 |             Upload Image270 |           </BaseButton>271 |         </div>272 |       </div>273 | 274 |       {}275 |       <div className={`grid gap-[${spacing[4]}] md:grid-cols-2 lg:grid-cols-4`}>276 |         <Card className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}]`}>277 |           <CardHeader className={`flex flex-row items-center justify-between space-y-0 pb-[${spacing[2]}]`}>278 |             <CardTitle className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>279 |               Total Images280 |             </CardTitle>281 |             {}282 |             <Image className={`h-4 w-4 text-[${colors.text.tertiary}]`} />283 |           </CardHeader>284 |           <CardContent>285 |             <div className={`text-[${typography.fontSize['2xl']}] font-[${typography.fontWeight.bold}] text-[${colors.text.primary}]`}>286 |               {Object.keys(images).length}287 |             </div>288 |             <p className={`text-[${typography.fontSize.sm}] text-[${colors.text.secondary}]`}>289 |               Stored images290 |             </p>291 |           </CardContent>292 |         </Card>293 | 294 |         <Card className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}]`}>295 |           <CardHeader className={`flex flex-row items-center justify-between space-y-0 pb-[${spacing[2]}]`}>296 |             <CardTitle className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>297 |               Total Size298 |             </CardTitle>299 |             <HardDrive className={`h-4 w-4 text-[${colors.text.tertiary}]`} />300 |           </CardHeader>301 |           <CardContent>302 |             <div className={`text-[${typography.fontSize['2xl']}] font-[${typography.fontWeight.bold}] text-[${colors.text.primary}]`}>303 |               {formatFileSize(totalSize)}304 |             </div>305 |             <p className={`text-[${typography.fontSize.sm}] text-[${colors.text.secondary}]`}>306 |               Storage used307 |             </p>308 |           </CardContent>309 |         </Card>310 | 311 |         <Card className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}]`}>312 |           <CardHeader className={`flex flex-row items-center justify-between space-y-0 pb-[${spacing[2]}]`}>313 |             <CardTitle className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>314 |               Public Images315 |             </CardTitle>316 |             <Globe className={`h-4 w-4 text-[${colors.text.tertiary}]`} />317 |           </CardHeader>318 |           <CardContent>319 |             <div className={`text-[${typography.fontSize['2xl']}] font-[${typography.fontWeight.bold}] text-[${colors.text.primary}]`}>320 |               {Object.values(images).filter((img: Record<string, unknown>) => img.isPublic).length}321 |             </div>322 |             <p className={`text-[${typography.fontSize.sm}] text-[${colors.text.secondary}]`}>323 |               Publicly accessible324 |             </p>325 |           </CardContent>326 |         </Card>327 | 328 |         <Card className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}]`}>329 |           <CardHeader className={`flex flex-row items-center justify-between space-y-0 pb-[${spacing[2]}]`}>330 |             <CardTitle className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>331 |               Last Upload332 |             </CardTitle>333 |             <Clock className={`h-4 w-4 text-[${colors.text.tertiary}]`} />334 |           </CardHeader>335 |           <CardContent>336 |             <div className={`text-[${typography.fontSize['2xl']}] font-[${typography.fontWeight.bold}] text-[${colors.text.primary}]`}>337 |               {lastUpload ? formatDate(lastUpload) : 'N/A'}338 |             </div>339 |             <p className={`text-[${typography.fontSize.sm}] text-[${colors.text.secondary}]`}>340 |               Last backup341 |             </p>342 |           </CardContent>343 |         </Card>344 |       </div>345 | 346 |       {}347 |       {error && (348 |         <div className={`bg-[${colors.status.error}]/10 border border-[${colors.status.error}]/20 rounded-[${borders.radius.lg}] p-[${spacing[4]}] mb-[${spacing[4]}]`}>349 |           <p className={`text-[${colors.status.error}]`}>{error}</p>350 |         </div>351 |       )}352 | 353 |       {success && (354 |         <div className={`bg-[${colors.status.success}]/10 border border-[${colors.status.success}]/20 rounded-[${borders.radius.lg}] p-[${spacing[4]}] mb-[${spacing[4]}]`}>355 |           <p className={`text-[${colors.status.success}]`}>{success}</p>356 |         </div>357 |       )}358 | 359 |       {}360 |       <BaseModal361 |         isOpen={showUploadModal}362 |         onClose={() => setShowUploadModal(false)}363 |         title="Upload Image"364 |         description="Upload modal functionality coming soon..."365 |         size="md"366 |         variant="default"367 |       >368 |         <BaseModal.Content>369 |           <div className="text-center py-4">370 |             <p className="dashboard-text-secondary mb-4">371 |               Upload functionality will be implemented soon.372 |             </p>373 |             <BaseButton374 |               onClick={() => setShowUploadModal(false)}375 |               variant="primary"376 |               className="w-full"377 |             >378 |               Close379 |             </BaseButton>380 |           </div>381 |         </BaseModal.Content>382 |       </BaseModal>383 | 384 |       {}385 |       <Card className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}]`}>386 |         <CardHeader>387 |           <CardTitle className={`text-[${typography.fontSize.lg}] text-[${colors.text.primary}]`}>Filters</CardTitle>388 |         </CardHeader>389 |         <CardContent>390 |           <div className={`grid grid-cols-1 md:grid-cols-3 gap-[${spacing[4]}]`}>391 |             <div className={`space-y-[${spacing[2]}]`}>392 |               <Label htmlFor="filter_type" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>393 |                 Image Type394 |               </Label>395 |               <Select value={filters.type} onValueChange={(value) => setFilters(prev => ({ ...prev, type: value }))}>396 |                 <SelectTrigger className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}]`}>397 |                   <SelectValue />398 |                 </SelectTrigger>399 |                 <SelectContent className="dashboard-dropdown-content">400 |                   <SelectItem value="all" className="dashboard-dropdown-item">All types</SelectItem>401 |                   <SelectItem value="logo" className="dashboard-dropdown-item">Logo</SelectItem>402 |                   <SelectItem value="hero" className="dashboard-dropdown-item">Hero</SelectItem>403 |                   <SelectItem value="gallery" className="dashboard-dropdown-item">Gallery</SelectItem>404 |                   <SelectItem value="icon" className="dashboard-dropdown-item">Icon</SelectItem>405 |                 </SelectContent>406 |               </Select>407 |             </div>408 | 409 |             <div className={`space-y-[${spacing[2]}]`}>410 |               <Label htmlFor="filter_status" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>411 |                 Status412 |               </Label>413 |               <Select value={filters.isPublic} onValueChange={(value) => setFilters(prev => ({ ...prev, isPublic: value }))}>414 |                 <SelectTrigger className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}]`}>415 |                   <SelectValue />416 |                 </SelectTrigger>417 |                 <SelectContent className="dashboard-dropdown-content">418 |                   <SelectItem value="all" className="dashboard-dropdown-item">All statuses</SelectItem>419 |                   <SelectItem value="true" className="dashboard-dropdown-item">Public</SelectItem>420 |                   <SelectItem value="false" className="dashboard-dropdown-item">Private</SelectItem>421 |                 </SelectContent>422 |               </Select>423 |             </div>424 | 425 |             <div className={`space-y-[${spacing[2]}]`}>426 |               <Label htmlFor="filter_size" className={`text-[${typography.fontSize.sm}] font-[${typography.fontWeight.medium}] text-[${colors.text.secondary}]`}>427 |                 File Size428 |               </Label>429 |               <Select value={filters.size} onValueChange={(value) => setFilters(prev => ({ ...prev, size: value }))}>430 |                 <SelectTrigger className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}] text-[${colors.text.primary}]`}>431 |                   <SelectValue />432 |                 </SelectTrigger>433 |                 <SelectContent className="dashboard-dropdown-content">434 |                   <SelectItem value="all" className="dashboard-dropdown-item">All sizes</SelectItem>435 |                   <SelectItem value="small" className="dashboard-dropdown-item">Small (&lt; 1MB)</SelectItem>436 |                   <SelectItem value="medium" className="dashboard-dropdown-item">Medium (1-5MB)</SelectItem>437 |                   <SelectItem value="large" className="dashboard-dropdown-item">Large (&gt; 5MB)</SelectItem>438 |                 </SelectContent>439 |               </Select>440 |             </div>441 |           </div>442 | 443 |           <div className={`flex justify-end space-x-[${spacing[2]}] pt-[${spacing[4]}]`}>444 |             <BaseButton445 |               onClick={applyFilters}446 |               variant="primary"447 |               leftIcon={<Filter className="w-4 h-4" />}448 |             >449 |               Apply Filters450 |             </BaseButton>451 |             <BaseButton452 |               onClick={clearFilters}453 |               variant="outline"454 |               className={`border-[${colors.border[500]}] text-[${colors.text.secondary}] hover:bg-[${colors.semantic.surface.secondary}] hover:text-[${colors.text.primary}]`}455 |             >456 |               Clear457 |             </BaseButton>458 |           </div>459 |         </CardContent>460 |       </Card>461 | 462 |       {}463 |       <Card className={`bg-[${colors.semantic.surface.primary}] border-[${colors.border[500]}]`}>464 |         <CardHeader>465 |           <CardTitle className={`text-[${typography.fontSize.lg}] text-[${colors.text.primary}]`}>All Images</CardTitle>466 |           <CardDescription className={`text-[${colors.text.secondary}]`}>467 |             Manage and organize your image assets468 |           </CardDescription>469 |         </CardHeader>470 |         <CardContent>471 |           {isLoading ? (472 |             <div className={`text-center py-[${spacing[12]}]`}>473 |               <div className={`w-16 h-16 border-4 border-[${colors.accent[500]}] border-t-transparent rounded-full animate-spin mx-auto mb-[${spacing[4]}]`}></div>474 |               <p className={`text-[${colors.text.secondary}]`}>Loading images...</p>475 |             </div>476 |           ) : (477 |             <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-[${spacing[4]}]`}>478 |               {Object.entries(images).map(([key, image]: [string, Record<string, unknown>]) => (479 |                 <div key={key} className={`bg-[${colors.semantic.surface.secondary}] rounded-[${borders.radius.lg}] p-[${spacing[4]}] border border-[${colors.border[500]}]`}>480 |                   <div className={`flex items-center justify-between mb-[${spacing[3]}]`}>481 |                     {image.isPublic ? (482 |                       <Badge variant="secondary" className={`bg-[${colors.status.success}] text-white`}>Public</Badge>483 |                     ) : (484 |                       <Badge variant="secondary" className={`bg-[${colors.status.error}] text-white`}>Private</Badge>485 |                     )}486 |                   </div>487 | 488 |                   <div className={`h-32 bg-[${colors.semantic.surface.tertiary}] rounded-[${borders.radius.md}] mb-[${spacing[3]}] flex items-center justify-center`}>489 |                     {}490 |                     <Image className={`w-8 h-8 text-[${colors.text.tertiary}]`} />491 |                   </div>492 | 493 |                   <div className={`space-y-[${spacing[2]}]`}>494 |                     <span className={`text-[${colors.text.primary}] font-[${typography.fontWeight.medium}] truncate block`}>495 |                       {String(image.name || '')}496 |                     </span>497 | 498 |                     <div className={`flex space-x-[${spacing[2]}]`}>499 |                       <BaseButton500 |                         variant="outline"501 |                         size="sm"502 |                         onClick={() => handleEdit(image)}503 |                         className="flex-1"504 |                         leftIcon={<Edit className="w-4 h-4" />}505 |                       >506 |                         Edit507 |                       </BaseButton>508 |                       <BaseButton509 |                         variant="danger"510 |                         size="sm"511 |                         onClick={() => handleDelete(image)}512 |                         leftIcon={<Trash2 className="w-4 h-4" />}513 |                       >514 |                         Delete515 |                       </BaseButton>516 |                     </div>517 | 518 |                     <div className={`text-[${typography.fontSize.xs}] text-[${colors.text.tertiary}]`}>519 |                       {Boolean(image.uploadedAt) && String(`Uploaded: ${formatDate(String(image.uploadedAt))}`)}520 |                     </div>521 |                   </div>522 |                 </div>523 |               ))}524 |             </div>525 |           )}526 | 527 |           {!isLoading && Object.keys(images).length === 0 && (528 |             <div className={`text-center py-[${spacing[12]}]`}>529 |               <div className={`w-16 h-16 bg-[${colors.semantic.surface.secondary}] rounded-full flex items-center justify-center mx-auto mb-[${spacing[4]}]`}>530 |                 {}531 |                 <Image className={`w-8 h-8 text-[${colors.text.tertiary}]`} />532 |               </div>533 |               <p className={`text-[${colors.text.secondary}]`}>No images found</p>534 |             </div>535 |           )}536 |         </CardContent>537 |       </Card>538 | 539 |       {}540 |       <BaseModal541 |         isOpen={showEditModal}542 |         onClose={() => setShowEditModal(false)}543 |         title="Edit Image"544 |         description="Update image details and settings"545 |         size="md"546 |         variant="default"547 |       >548 |         <BaseModal.Content>549 |           <form onSubmit={handleEditSubmit} className="space-y-4">550 |             <div className="space-y-2">551 |               <Label htmlFor="edit_name" className="dashboard-label">552 |                 Name553 |               </Label>554 |               <BaseInput555 |                 id="edit_name"556 |                 value={editFormData.name}557 |                 onChange={(e) => setEditFormData(prev => ({ ...prev, name: e.target.value }))}558 |                 placeholder="Image name"559 |                 className="dashboard-input"560 |               />561 |             </div>562 | 563 |             <div className="space-y-2">564 |               <Label htmlFor="edit_alt" className="dashboard-label">565 |                 Alt Text566 |               </Label>567 |               <BaseInput568 |                 id="edit_alt"569 |                 value={editFormData.alt}570 |                 onChange={(e) => setEditFormData(prev => ({ ...prev, alt: e.target.value }))}571 |                 placeholder="Alternative text for accessibility"572 |                 className="dashboard-input"573 |               />574 |             </div>575 | 576 |             <div className="space-y-2">577 |               <Label htmlFor="edit_category" className="dashboard-label">578 |                 Category579 |               </Label>580 |               <Select value={editFormData.category} onValueChange={(value) => setEditFormData(prev => ({ ...prev, category: value }))}>581 |                 <SelectTrigger className="dashboard-select">582 |                   <SelectValue />583 |                 </SelectTrigger>584 |                 <SelectContent className="dashboard-dropdown-content">585 |                   <SelectItem value="general" className="dashboard-dropdown-item">General</SelectItem>586 |                   <SelectItem value="hero" className="dashboard-dropdown-item">Hero</SelectItem>587 |                   <SelectItem value="gallery" className="dashboard-dropdown-item">Gallery</SelectItem>588 |                   <SelectItem value="logo" className="dashboard-dropdown-item">Logo</SelectItem>589 |                   <SelectItem value="background" className="dashboard-dropdown-item">Background</SelectItem>590 |                 </SelectContent>591 |               </Select>592 |             </div>593 |           </form>594 |         </BaseModal.Content>595 | 596 |         <BaseModal.Footer>597 |           <BaseButton598 |             variant="outline"599 |             onClick={() => setShowEditModal(false)}600 |             className="dashboard-button-outline"601 |           >602 |             Cancel603 |           </BaseButton>604 |           <BaseButton605 |             variant="primary"606 |             onClick={handleEditSubmit}607 |             className="dashboard-button-primary"608 |           >609 |             Update610 |           </BaseButton>611 |         </BaseModal.Footer>612 |       </BaseModal>613 | 614 |       {}615 |       <ConfirmationModal616 |         isOpen={showDeleteModal}617 |         onClose={() => setShowDeleteModal(false)}618 |         onConfirm={confirmDelete}619 |         title="Delete Image"620 |         description={`Are you sure you want to delete "${deletingImage?.name}"? This action cannot be undone.`}621 |         confirmText="Delete"622 |         cancelText="Cancel"623 |         variant="danger"624 |         icon={<Trash2 className="w-5 h-5" />}625 |       />626 |     </div>627 |   );628 | }
============================================================END: frontend/components/ImageManagement.tsx============================================================


============================================================FILE: frontend/components/LiveSessionConfigManagement.tsxSIZE: 27.25 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Input } from '@/components/ui/input';  7 | import { Label } from '@/components/ui/label';  8 | import { Switch } from '@/components/ui/switch';  9 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 10 | import { Badge } from '@/components/ui/badge'; 11 | import { Video, Settings, Save, TestTube, CheckCircle, XCircle, ExternalLink } from 'lucide-react'; 12 | import { toast } from 'sonner'; 13 | import { useAuth } from '@/hooks/useAuth'; 14 |  15 | interface LiveSessionConfig { 16 |   id: string; 17 |   name: string; 18 |   provider: 'zoom' | 'meet' | 'teams' | 'weebly' | 'custom'; 19 |   apiKey: string; 20 |   apiSecret?: string; 21 |   webhookUrl?: string; 22 |   isActive: boolean; 23 |   settings: { 24 |     allowVideo: boolean; 25 |     allowAudio: boolean; 26 |     allowChat: boolean; 27 |     allowScreenShare: boolean; 28 |     maxParticipants: number; 29 |     recordingEnabled: boolean; 30 |     autoStart: boolean; 31 |     waitingRoom: boolean; 32 |     muteOnEntry: boolean; 33 |   }; 34 |   weeblySettings?: { 35 |     siteId: string; 36 |     appId: string; 37 |     clientId: string; 38 |     clientSecret: string; 39 |     redirectUri: string; 40 |     scope: string[]; 41 |   }; 42 | } 43 |  44 | const PROVIDERS = [ 45 |   { value: 'zoom', label: 'Zoom', description: 'Zoom Video Communications' }, 46 |   { value: 'meet', label: 'Google Meet', description: 'Google Meet integration' }, 47 |   { value: 'teams', label: 'Microsoft Teams', description: 'Microsoft Teams integration' }, 48 |   { value: 'weebly', label: 'Weebly', description: 'Weebly API integration' }, 49 |   { value: 'custom', label: 'Custom', description: 'Custom video conferencing solution' } 50 | ]; 51 |  52 | const WEBEBBLY_SCOPES = [ 53 |   'read:site', 54 |   'write:site', 55 |   'read:blog', 56 |   'write:blog', 57 |   'read:store', 58 |   'write:store', 59 |   'read:user', 60 |   'write:user' 61 | ]; 62 |  63 | export function LiveSessionConfigManagement() { 64 |   const { user } = useAuth(); 65 |   const [config, setConfig] = useState<LiveSessionConfig | null>(null); 66 |   const [loading, setLoading] = useState(true); 67 |   const [saving, setSaving] = useState(false); 68 |   const [testing, setTesting] = useState(false); 69 |   const [testResult, setTestResult] = useState<{ success: boolean; message: string } | null>(null); 70 |  71 |   const [formData, setFormData] = useState({ 72 |     name: '', 73 |     provider: 'zoom' as 'zoom' | 'meet' | 'teams' | 'weebly' | 'custom', 74 |     apiKey: '', 75 |     apiSecret: '', 76 |     webhookUrl: '', 77 |     isActive: true, 78 |     allowVideo: true, 79 |     allowAudio: true, 80 |     allowChat: true, 81 |     allowScreenShare: true, 82 |     maxParticipants: 10, 83 |     recordingEnabled: true, 84 |     autoStart: false, 85 |     waitingRoom: true, 86 |     muteOnEntry: false, 87 |  88 |     siteId: '', 89 |     appId: '', 90 |     clientId: '', 91 |     clientSecret: '', 92 |     redirectUri: '', 93 |     scope: ['read:site', 'write:site'] as string[] 94 |   }); 95 |  96 |   const loadConfig = useCallback(async () => { 97 |     if (!user?.access_token) return; 98 |  99 |     try {100 |       const response = await fetch('/api/admin/live-session-config', {101 |         headers: {102 |           'Authorization': `Bearer ${user.access_token}`,103 |           'Content-Type': 'application/json'104 |         }105 |       });106 | 107 |       if (response.ok) {108 |         const data = await response.json();109 |         if (data.success) {110 |           setConfig(data.data);111 |           setFormData({112 |             name: data.data.name || '',113 |             provider: data.data.provider || 'zoom',114 |             apiKey: data.data.apiKey || '',115 |             apiSecret: data.data.apiSecret || '',116 |             webhookUrl: data.data.webhookUrl || '',117 |             isActive: data.data.isActive || false,118 |             allowVideo: data.data.settings?.allowVideo || true,119 |             allowAudio: data.data.settings?.allowAudio || true,120 |             allowChat: data.data.settings?.allowChat || true,121 |             allowScreenShare: data.data.settings?.allowScreenShare || true,122 |             maxParticipants: data.data.settings?.maxParticipants || 10,123 |             recordingEnabled: data.data.settings?.recordingEnabled || false,124 |             autoStart: data.data.settings?.autoStart || false,125 |             waitingRoom: data.data.settings?.waitingRoom || true,126 |             muteOnEntry: data.data.settings?.muteOnEntry || false,127 |             siteId: data.data.weeblySettings?.siteId || '',128 |             appId: data.data.weeblySettings?.appId || '',129 |             clientId: data.data.weeblySettings?.clientId || '',130 |             clientSecret: data.data.weeblySettings?.clientSecret || '',131 |             redirectUri: data.data.weeblySettings?.redirectUri || '',132 |             scope: data.data.weeblySettings?.scope || ['read:site', 'write:site']133 |           });134 |         }135 |       }136 |     } catch (error) {137 |       toast.error('Failed to load configuration');138 |     }139 |   }, [user?.access_token]);140 | 141 |   useEffect(() => {142 |     if (user?.access_token) {143 |       loadConfig();144 |     }145 |   }, [user?.access_token, loadConfig]);146 | 147 |   useEffect(() => {148 |     setLoading(false);149 |   }, [config]);150 | 151 |   const handleInputChange = (field: string, value: string | number | boolean) => {152 |     setFormData(prev => ({ ...prev, [field]: value }));153 |   };154 | 155 |   const handleScopeToggle = (scope: string) => {156 |     setFormData(prev => ({157 |       ...prev,158 |       scope: prev.scope.includes(scope)159 |         ? prev.scope.filter(s => s !== scope)160 |         : [...prev.scope, scope]161 |     }));162 |   };163 | 164 |   const handleSave = async () => {165 |     setSaving(true);166 |     try {167 |       const response = await fetch('/api/admin/live-session-config', {168 |         method: 'POST',169 |         headers: {170 |           'Authorization': `Bearer ${user?.access_token}`,171 |           'Content-Type': 'application/json'172 |         },173 |         body: JSON.stringify({174 |           name: formData.name,175 |           provider: formData.provider,176 |           apiKey: formData.apiKey,177 |           apiSecret: formData.apiSecret,178 |           webhookUrl: formData.webhookUrl,179 |           isActive: formData.isActive,180 |           settings: {181 |             allowVideo: formData.allowVideo,182 |             allowAudio: formData.allowAudio,183 |             allowChat: formData.allowChat,184 |             allowScreenShare: formData.allowScreenShare,185 |             maxParticipants: formData.maxParticipants,186 |             recordingEnabled: formData.recordingEnabled,187 |             autoStart: formData.autoStart,188 |             waitingRoom: formData.waitingRoom,189 |             muteOnEntry: formData.muteOnEntry190 |           },191 |           weeblySettings: formData.provider === 'weebly' ? {192 |             siteId: formData.siteId,193 |             appId: formData.appId,194 |             clientId: formData.clientId,195 |             clientSecret: formData.clientSecret,196 |             redirectUri: formData.redirectUri,197 |             scope: formData.scope198 |           } : undefined199 |         })200 |       });201 | 202 |       const result = await response.json();203 | 204 |       if (result.success) {205 |         toast.success('Configuration saved successfully');206 |         setConfig(result.data);207 |       } else {208 |         toast.error(result.message || 'Failed to save configuration');209 |       }210 |     } catch (error) {211 |       toast.error('Failed to save configuration');212 |     } finally {213 |       setSaving(false);214 |     }215 |   };216 | 217 |   const handleTest = async () => {218 |     setTesting(true);219 |     setTestResult(null);220 | 221 |     try {222 |       const response = await fetch('/api/admin/live-session-config/test', {223 |         method: 'POST',224 |         headers: {225 |           'Authorization': `Bearer ${user?.access_token}`,226 |           'Content-Type': 'application/json'227 |         },228 |         body: JSON.stringify({229 |           provider: formData.provider,230 |           apiKey: formData.apiKey,231 |           apiSecret: formData.apiSecret,232 |           weeblySettings: formData.provider === 'weebly' ? {233 |             siteId: formData.siteId,234 |             clientId: formData.clientId,235 |             clientSecret: formData.clientSecret236 |           } : undefined237 |         })238 |       });239 | 240 |       const result = await response.json();241 |       setTestResult({242 |         success: result.success,243 |         message: result.message || (result.success ? 'Connection successful' : 'Connection failed')244 |       });245 | 246 |       if (result.success) {247 |         toast.success('Test connection successful');248 |       } else {249 |         toast.error('Test connection failed');250 |       }251 |     } catch (error) {252 |       setTestResult({253 |         success: false,254 |         message: 'Test connection failed'255 |       });256 |       toast.error('Test connection failed');257 |     } finally {258 |       setTesting(false);259 |     }260 |   };261 | 262 |   if (loading) {263 |     return (264 |       <div className="flex items-center justify-center min-h-[400px]">265 |         <div className="text-center">266 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>267 |           <p className="text-[#FFD700] text-lg font-semibold">Loading configuration...</p>268 |         </div>269 |       </div>270 |     );271 |   }272 | 273 |   return (274 |     <div className="space-y-6">275 |       <div className="text-center mb-8">276 |         <h1 className="text-4xl font-bold text-white mb-4">Live Session Configuration</h1>277 |         <p className="text-gray-400 text-lg">Configure video conferencing and Weebly API integration</p>278 |       </div>279 | 280 |       <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">281 |         {}282 |         <div className="lg:col-span-2 space-y-6">283 |           {}284 |           <Card className="bg-[#1a1a2e] border-[#16213e]">285 |             <CardHeader>286 |               <CardTitle className="text-white flex items-center space-x-2">287 |                 <Video className="w-5 h-5 text-[#ffd700]" />288 |                 <span>Video Conferencing Provider</span>289 |               </CardTitle>290 |             </CardHeader>291 |             <CardContent className="space-y-4">292 |               <div>293 |                 <Label htmlFor="provider" className="text-gray-300">Provider</Label>294 |                 <Select value={formData.provider} onValueChange={(value) => handleInputChange('provider', value)}>295 |                   <SelectTrigger className="bg-[#16213e] border-[#0a0a23] text-white">296 |                     <SelectValue placeholder="Select provider" />297 |                   </SelectTrigger>298 |                   <SelectContent className="bg-[#16213e] border-[#0a0a23] text-white">299 |                     {PROVIDERS.map((provider) => (300 |                       <SelectItem key={provider.value} value={provider.value}>301 |                         <div>302 |                           <div className="font-medium">{provider.label}</div>303 |                           <div className="text-sm text-gray-400">{provider.description}</div>304 |                         </div>305 |                       </SelectItem>306 |                     ))}307 |                   </SelectContent>308 |                 </Select>309 |               </div>310 | 311 |               <div>312 |                 <Label htmlFor="name" className="text-gray-300">Configuration Name</Label>313 |                 <Input314 |                   id="name"315 |                   value={formData.name}316 |                   onChange={(e) => handleInputChange('name', e.target.value)}317 |                   className="bg-[#16213e] border-[#0a0a23] text-white"318 |                   placeholder="e.g., SoulPath Live Sessions"319 |                 />320 |               </div>321 | 322 |               <div className="flex items-center space-x-2">323 |                 <Switch324 |                   id="isActive"325 |                   checked={formData.isActive}326 |                   onCheckedChange={(checked) => handleInputChange('isActive', checked)}327 |                 />328 |                 <Label htmlFor="isActive" className="text-gray-300">Active</Label>329 |               </div>330 |             </CardContent>331 |           </Card>332 | 333 |           {}334 |           <Card className="bg-[#1a1a2e] border-[#16213e]">335 |             <CardHeader>336 |               <CardTitle className="text-white">API Configuration</CardTitle>337 |             </CardHeader>338 |             <CardContent className="space-y-4">339 |               <div>340 |                 <Label htmlFor="apiKey" className="text-gray-300">API Key</Label>341 |                 <Input342 |                   id="apiKey"343 |                   type="password"344 |                   value={formData.apiKey}345 |                   onChange={(e) => handleInputChange('apiKey', e.target.value)}346 |                   className="bg-[#16213e] border-[#0a0a23] text-white"347 |                   placeholder="Enter your API key"348 |                 />349 |               </div>350 | 351 |               {formData.provider !== 'weebly' && (352 |                 <div>353 |                   <Label htmlFor="apiSecret" className="text-gray-300">API Secret</Label>354 |                   <Input355 |                     id="apiSecret"356 |                     type="password"357 |                     value={formData.apiSecret}358 |                     onChange={(e) => handleInputChange('apiSecret', e.target.value)}359 |                     className="bg-[#16213e] border-[#0a0a23] text-white"360 |                     placeholder="Enter your API secret"361 |                   />362 |                 </div>363 |               )}364 | 365 |               <div>366 |                 <Label htmlFor="webhookUrl" className="text-gray-300">Webhook URL</Label>367 |                 <Input368 |                   id="webhookUrl"369 |                   value={formData.webhookUrl}370 |                   onChange={(e) => handleInputChange('webhookUrl', e.target.value)}371 |                   className="bg-[#16213e] border-[#0a0a23] text-white"372 |                   placeholder="https:373 |                 />374 |               </div>375 |             </CardContent>376 |           </Card>377 | 378 |           {}379 |           {formData.provider === 'weebly' && (380 |             <Card className="bg-[#1a1a2e] border-[#16213e]">381 |               <CardHeader>382 |                 <CardTitle className="text-white flex items-center space-x-2">383 |                   <ExternalLink className="w-5 h-5 text-[#ffd700]" />384 |                   <span>Weebly API Configuration</span>385 |                 </CardTitle>386 |               </CardHeader>387 |               <CardContent className="space-y-4">388 |                 <div className="grid grid-cols-2 gap-4">389 |                   <div>390 |                     <Label htmlFor="siteId" className="text-gray-300">Site ID</Label>391 |                     <Input392 |                       id="siteId"393 |                       value={formData.siteId}394 |                       onChange={(e) => handleInputChange('siteId', e.target.value)}395 |                       className="bg-[#16213e] border-[#0a0a23] text-white"396 |                       placeholder="Your Weebly site ID"397 |                     />398 |                   </div>399 |                   <div>400 |                     <Label htmlFor="appId" className="text-gray-300">App ID</Label>401 |                     <Input402 |                       id="appId"403 |                       value={formData.appId}404 |                       onChange={(e) => handleInputChange('appId', e.target.value)}405 |                       className="bg-[#16213e] border-[#0a0a23] text-white"406 |                       placeholder="Your Weebly app ID"407 |                     />408 |                   </div>409 |                 </div>410 | 411 |                 <div className="grid grid-cols-2 gap-4">412 |                   <div>413 |                     <Label htmlFor="clientId" className="text-gray-300">Client ID</Label>414 |                     <Input415 |                       id="clientId"416 |                       value={formData.clientId}417 |                       onChange={(e) => handleInputChange('clientId', e.target.value)}418 |                       className="bg-[#16213e] border-[#0a0a23] text-white"419 |                       placeholder="OAuth client ID"420 |                     />421 |                   </div>422 |                   <div>423 |                     <Label htmlFor="clientSecret" className="text-gray-300">Client Secret</Label>424 |                     <Input425 |                       id="clientSecret"426 |                       type="password"427 |                       value={formData.clientSecret}428 |                       onChange={(e) => handleInputChange('clientSecret', e.target.value)}429 |                       className="bg-[#16213e] border-[#0a0a23] text-white"430 |                       placeholder="OAuth client secret"431 |                     />432 |                   </div>433 |                 </div>434 | 435 |                 <div>436 |                   <Label htmlFor="redirectUri" className="text-gray-300">Redirect URI</Label>437 |                   <Input438 |                     id="redirectUri"439 |                     value={formData.redirectUri}440 |                     onChange={(e) => handleInputChange('redirectUri', e.target.value)}441 |                     className="bg-[#16213e] border-[#0a0a23] text-white"442 |                     placeholder="https:443 |                   />444 |                 </div>445 | 446 |                 <div>447 |                   <Label className="text-gray-300">OAuth Scopes</Label>448 |                   <div className="grid grid-cols-2 gap-2 mt-2">449 |                     {WEBEBBLY_SCOPES.map((scope) => (450 |                       <div key={scope} className="flex items-center space-x-2">451 |                         <input452 |                           type="checkbox"453 |                           id={scope}454 |                           checked={formData.scope.includes(scope)}455 |                           onChange={() => handleScopeToggle(scope)}456 |                           className="rounded border-gray-300"457 |                         />458 |                         <Label htmlFor={scope} className="text-sm text-gray-300">459 |                           {scope}460 |                         </Label>461 |                       </div>462 |                     ))}463 |                   </div>464 |                 </div>465 |               </CardContent>466 |             </Card>467 |           )}468 | 469 |           {}470 |           <Card className="bg-[#1a1a2e] border-[#16213e]">471 |             <CardHeader>472 |               <CardTitle className="text-white">Session Settings</CardTitle>473 |             </CardHeader>474 |             <CardContent className="space-y-4">475 |               <div className="grid grid-cols-2 gap-4">476 |                 <div className="flex items-center space-x-2">477 |                   <Switch478 |                     id="allowVideo"479 |                     checked={formData.allowVideo}480 |                     onCheckedChange={(checked) => handleInputChange('allowVideo', checked)}481 |                   />482 |                   <Label htmlFor="allowVideo" className="text-gray-300">Allow Video</Label>483 |                 </div>484 |                 <div className="flex items-center space-x-2">485 |                   <Switch486 |                     id="allowAudio"487 |                     checked={formData.allowAudio}488 |                     onCheckedChange={(checked) => handleInputChange('allowAudio', checked)}489 |                   />490 |                   <Label htmlFor="allowAudio" className="text-gray-300">Allow Audio</Label>491 |                 </div>492 |               </div>493 | 494 |               <div className="grid grid-cols-2 gap-4">495 |                 <div className="flex items-center space-x-2">496 |                   <Switch497 |                     id="allowChat"498 |                     checked={formData.allowChat}499 |                     onCheckedChange={(checked) => handleInputChange('allowChat', checked)}500 |                   />501 |                   <Label htmlFor="allowChat" className="text-gray-300">Allow Chat</Label>502 |                 </div>503 |                 <div className="flex items-center space-x-2">504 |                   <Switch505 |                     id="allowScreenShare"506 |                     checked={formData.allowScreenShare}507 |                     onCheckedChange={(checked) => handleInputChange('allowScreenShare', checked)}508 |                   />509 |                   <Label htmlFor="allowScreenShare" className="text-gray-300">Allow Screen Share</Label>510 |                 </div>511 |               </div>512 | 513 |               <div className="grid grid-cols-2 gap-4">514 |                 <div className="flex items-center space-x-2">515 |                   <Switch516 |                     id="recordingEnabled"517 |                     checked={formData.recordingEnabled}518 |                     onCheckedChange={(checked) => handleInputChange('recordingEnabled', checked)}519 |                   />520 |                   <Label htmlFor="recordingEnabled" className="text-gray-300">Enable Recording</Label>521 |                 </div>522 |                 <div className="flex items-center space-x-2">523 |                   <Switch524 |                     id="autoStart"525 |                     checked={formData.autoStart}526 |                     onCheckedChange={(checked) => handleInputChange('autoStart', checked)}527 |                   />528 |                   <Label htmlFor="autoStart" className="text-gray-300">Auto Start</Label>529 |                 </div>530 |               </div>531 | 532 |               <div className="grid grid-cols-2 gap-4">533 |                 <div className="flex items-center space-x-2">534 |                   <Switch535 |                     id="waitingRoom"536 |                     checked={formData.waitingRoom}537 |                     onCheckedChange={(checked) => handleInputChange('waitingRoom', checked)}538 |                   />539 |                   <Label htmlFor="waitingRoom" className="text-gray-300">Waiting Room</Label>540 |                 </div>541 |                 <div className="flex items-center space-x-2">542 |                   <Switch543 |                     id="muteOnEntry"544 |                     checked={formData.muteOnEntry}545 |                     onCheckedChange={(checked) => handleInputChange('muteOnEntry', checked)}546 |                   />547 |                   <Label htmlFor="muteOnEntry" className="text-gray-300">Mute on Entry</Label>548 |                 </div>549 |               </div>550 | 551 |               <div>552 |                 <Label htmlFor="maxParticipants" className="text-gray-300">Max Participants</Label>553 |                 <Input554 |                   id="maxParticipants"555 |                   type="number"556 |                   min="1"557 |                   max="100"558 |                   value={formData.maxParticipants}559 |                   onChange={(e) => handleInputChange('maxParticipants', parseInt(e.target.value) || 10)}560 |                   className="bg-[#16213e] border-[#0a0a23] text-white"561 |                 />562 |               </div>563 |             </CardContent>564 |           </Card>565 |         </div>566 | 567 |         {}568 |         <div className="space-y-6">569 |           {}570 |           <Card className="bg-[#1a1a2e] border-[#16213e]">571 |             <CardHeader>572 |               <CardTitle className="text-white">Status</CardTitle>573 |             </CardHeader>574 |             <CardContent className="space-y-4">575 |               <div className="flex items-center justify-between">576 |                 <span className="text-gray-300">Configuration</span>577 |                 <Badge className={config?.isActive ? 'bg-green-500' : 'bg-red-500'}>578 |                   {config?.isActive ? 'Active' : 'Inactive'}579 |                 </Badge>580 |               </div>581 |               <div className="flex items-center justify-between">582 |                 <span className="text-gray-300">Provider</span>583 |                 <span className="text-white">{formData.provider}</span>584 |               </div>585 |               <div className="flex items-center justify-between">586 |                 <span className="text-gray-300">API Key</span>587 |                 <span className="text-white">{formData.apiKey ? 'Set' : 'Not Set'}</span>588 |               </div>589 |             </CardContent>590 |           </Card>591 | 592 |           {}593 |           <Card className="bg-[#1a1a2e] border-[#16213e]">594 |             <CardHeader>595 |               <CardTitle className="text-white">Test Connection</CardTitle>596 |             </CardHeader>597 |             <CardContent className="space-y-4">598 |               <Button599 |                 onClick={handleTest}600 |                 disabled={testing || !formData.apiKey}601 |                 className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"602 |               >603 |                 {testing ? (604 |                   <div className="flex items-center space-x-2">605 |                     <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-black"></div>606 |                     <span>Testing...</span>607 |                   </div>608 |                 ) : (609 |                   <div className="flex items-center space-x-2">610 |                     <TestTube className="w-4 h-4" />611 |                     <span>Test Connection</span>612 |                   </div>613 |                 )}614 |               </Button>615 | 616 |               {testResult && (617 |                 <div className={`p-3 rounded-lg flex items-center space-x-2 ${618 |                   testResult.success ? 'bg-green-900/20 border border-green-500' : 'bg-red-900/20 border border-red-500'619 |                 }`}>620 |                   {testResult.success ? (621 |                     <CheckCircle className="w-4 h-4 text-green-500" />622 |                   ) : (623 |                     <XCircle className="w-4 h-4 text-red-500" />624 |                   )}625 |                   <span className={`text-sm ${626 |                     testResult.success ? 'text-green-400' : 'text-red-400'627 |                   }`}>628 |                     {testResult.message}629 |                   </span>630 |                 </div>631 |               )}632 |             </CardContent>633 |           </Card>634 | 635 |           {}636 |           <Card className="bg-[#1a1a2e] border-[#16213e]">637 |             <CardHeader>638 |               <CardTitle className="text-white">Actions</CardTitle>639 |             </CardHeader>640 |             <CardContent className="space-y-3">641 |               <Button642 |                 onClick={handleSave}643 |                 disabled={saving}644 |                 className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"645 |               >646 |                 {saving ? (647 |                   <div className="flex items-center space-x-2">648 |                     <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-black"></div>649 |                     <span>Saving...</span>650 |                   </div>651 |                 ) : (652 |                   <div className="flex items-center space-x-2">653 |                     <Save className="w-4 h-4" />654 |                     <span>Save Configuration</span>655 |                   </div>656 |                 )}657 |               </Button>658 | 659 |               <Button660 |                 onClick={loadConfig}661 |                 variant="outline"662 |                 className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"663 |               >664 |                 <Settings className="w-4 h-4 mr-2" />665 |                 Reset to Saved666 |               </Button>667 |             </CardContent>668 |           </Card>669 | 670 |           {}671 |           <Card className="bg-[#1a1a2e] border-[#16213e]">672 |             <CardHeader>673 |               <CardTitle className="text-white">Documentation</CardTitle>674 |             </CardHeader>675 |             <CardContent className="space-y-3">676 |               <Button677 |                 variant="outline"678 |                 className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"679 |                 onClick={() => window.open('https:680 |               >681 |                 <ExternalLink className="w-4 h-4 mr-2" />682 |                 Zoom API Docs683 |               </Button>684 |               <Button685 |                 variant="outline"686 |                 className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"687 |                 onClick={() => window.open('https:688 |               >689 |                 <ExternalLink className="w-4 h-4 mr-2" />690 |                 Google Meet API691 |               </Button>692 |               <Button693 |                 variant="outline"694 |                 className="w-full bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"695 |                 onClick={() => window.open('https:696 |               >697 |                 <ExternalLink className="w-4 h-4 mr-2" />698 |                 Weebly API Docs699 |               </Button>700 |             </CardContent>701 |           </Card>702 |         </div>703 |       </div>704 |     </div>705 |   );706 | }
============================================================END: frontend/components/LiveSessionConfigManagement.tsx============================================================


============================================================FILE: frontend/components/LoginModal.tsxSIZE: 5.42 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { BaseModal } from '@/components/ui/BaseModal';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { Label } from '@/components/ui/label';  8 | import { User, Eye, EyeOff } from 'lucide-react';  9 | import { toast } from 'sonner'; 10 |  11 | interface LoginModalProps { 12 |   isOpen: boolean; 13 |   onClose: () => void; 14 |   onLogin: (email: string, password: string) => Promise<boolean>; 15 | } 16 |  17 | const LoginModal: React.FC<LoginModalProps> = ({ 18 |   isOpen, 19 |   onClose, 20 |   onLogin 21 | }) => { 22 |   const [email, setEmail] = useState(''); 23 |   const [password, setPassword] = useState(''); 24 |   const [showPassword, setShowPassword] = useState(false); 25 |   const [loading, setLoading] = useState(false); 26 |   const [rememberEmail, setRememberEmail] = useState(false); 27 |  28 |   useEffect(() => { 29 |     if (isOpen) { 30 |       const savedEmail = localStorage.getItem('soulpath_remembered_email'); 31 |       const shouldRemember = localStorage.getItem('soulpath_remember_email') === 'true'; 32 |  33 |       if (savedEmail && shouldRemember) { 34 |         setEmail(savedEmail); 35 |         setRememberEmail(true); 36 |       } 37 |     } 38 |   }, [isOpen]); 39 |  40 |   const handleSubmit = async (e: React.FormEvent) => { 41 |     e.preventDefault(); 42 |  43 |     if (!email || !password) { 44 |       toast.error('Please fill in all fields'); 45 |       return; 46 |     } 47 |  48 |     setLoading(true); 49 |  50 |     try { 51 |       const success = await onLogin(email, password); 52 |  53 |       if (success) { 54 |  55 |         if (rememberEmail) { 56 |           localStorage.setItem('soulpath_remembered_email', email); 57 |           localStorage.setItem('soulpath_remember_email', 'true'); 58 |         } else { 59 |           localStorage.removeItem('soulpath_remembered_email'); 60 |           localStorage.removeItem('soulpath_remember_email'); 61 |         } 62 |  63 |         toast.success('Login successful!'); 64 |         handleClose(); 65 |       } else { 66 |         toast.error('Invalid credentials'); 67 |       } 68 |     } catch { 69 |       toast.error('Login failed. Please try again.'); 70 |     } finally { 71 |       setLoading(false); 72 |     } 73 |   }; 74 |  75 |   const handleClose = () => { 76 |     setEmail(''); 77 |     setPassword(''); 78 |     setShowPassword(false); 79 |     setLoading(false); 80 |  81 |     onClose(); 82 |   }; 83 |  84 |   return ( 85 |     <BaseModal 86 |       isOpen={isOpen} 87 |       onClose={handleClose} 88 |       size="sm" 89 |       variant="default" 90 |     > 91 |       <BaseModal.Header icon={<User className="w-5 h-5 text-[#6ea058]" />}> 92 |         <div className="text-center"> 93 |           <p className="text-gray-600 text-sm"> 94 |             Enter your credentials to continue 95 |           </p> 96 |         </div> 97 |       </BaseModal.Header> 98 |  99 |       <BaseModal.Content>100 |         <form onSubmit={handleSubmit} className="space-y-4">101 |           <div className="space-y-2">102 |             <Label htmlFor="email" className="text-gray-700 text-sm font-medium">103 |               Email104 |             </Label>105 |             <BaseInput106 |               id="email"107 |               type="email"108 |               value={email}109 |               onChange={(e) => setEmail(e.target.value)}110 |               placeholder="admin@soulpath.lat"111 |               required112 |               className="w-full"113 |             />114 |           </div>115 | 116 |           <div className="space-y-2">117 |             <Label htmlFor="password" className="text-gray-700 text-sm font-medium">118 |               Password119 |             </Label>120 |             <div className="relative">121 |               <BaseInput122 |                 id="password"123 |                 type={showPassword ? 'text' : 'password'}124 |                 value={password}125 |                 onChange={(e) => setPassword(e.target.value)}126 |                 placeholder="Enter your password"127 |                 required128 |                 className="w-full pr-10"129 |                 rightIcon={130 |                   <button131 |                     type="button"132 |                     onClick={() => setShowPassword(!showPassword)}133 |                     className="text-gray-500 hover:text-[#6ea058] transition-colors"134 |                   >135 |                     {showPassword ? <EyeOff size={16} /> : <Eye size={16} />}136 |                   </button>137 |                 }138 |               />139 |             </div>140 |           </div>141 | 142 |           {}143 |           <div className="flex items-center space-x-2">144 |             <input145 |               id="rememberEmail"146 |               type="checkbox"147 |               checked={rememberEmail}148 |               onChange={(e) => setRememberEmail(e.target.checked)}149 |               className="w-4 h-4 text-[#6ea058] bg-white border-gray-300 rounded focus:ring-[#6ea058] focus:ring-2"150 |             />151 |             <Label152 |               htmlFor="rememberEmail"153 |               className="text-sm text-gray-600 cursor-pointer select-none"154 |             >155 |               Remember my email address156 |             </Label>157 |           </div>158 | 159 |           <BaseButton160 |             type="submit"161 |             variant="primary"162 |             size="login"163 |             loading={loading}164 |             className="w-full mt-6 relative overflow-hidden group"165 |           >166 |             <span className="relative z-10 font-bold text-lg tracking-wide">167 |               {loading ? 'Signing In...' : 'Sign In'}168 |             </span>169 |             <div className="absolute inset-0 bg-gradient-to-r from-[#FFD700] to-[#FFD700]/80 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>170 |           </BaseButton>171 |         </form>172 |       </BaseModal.Content>173 |     </BaseModal>174 |   );175 | };176 | 177 | export default LoginModal;
============================================================END: frontend/components/LoginModal.tsx============================================================


============================================================FILE: frontend/components/MainPageClient.tsxSIZE: 14.03 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useRef } from 'react';  4 | import { motion, AnimatePresence } from 'framer-motion';  5 | import { ChevronRight } from 'lucide-react';  6 | import { useProfileImage } from '@/hooks/useProfileImage';  7 | import { useTranslations, useLanguage } from '@/hooks/useTranslations';  8 | import { AdminDashboard } from '@/components/AdminDashboard';  9 | import { BookingSection } from '@/components/BookingSection'; 10 | import { Header } from '@/components/Header'; 11 | import { themeClasses } from '@/lib/theme/theme-utils'; 12 |  13 | interface TranslationProps { 14 |   t: Record<string, string | Record<string, string>>; 15 | } 16 |  17 | interface SessionSectionProps extends TranslationProps { 18 |   scrollToSection: (sectionId: string) => void; 19 | } 20 |  21 | interface MainPageClientProps { 22 |   content: Record<string, string>; 23 |   initialContent: Record<string, unknown>; 24 |   initialProfileImage: string | undefined; 25 | } 26 |  27 | function HeroSection({ t }: TranslationProps) { 28 |   return ( 29 |     <motion.section 30 |       initial={{ opacity: 0 }} 31 |       animate={{ opacity: 1 }} 32 |       transition={{ duration: 1 }} 33 |       className="relative h-screen flex items-center justify-center text-center px-6" 34 |     > 35 |       <div className="max-w-4xl mx-auto"> 36 |         <motion.h1 37 |           initial={{ y: 50, opacity: 0 }} 38 |           animate={{ y: 0, opacity: 1 }} 39 |           transition={{ delay: 0.3, duration: 0.8 }} 40 |           className={`text-5xl sm:text-6xl md:text-7xl font-heading ${themeClasses.text.primary} mb-6 leading-tight`} 41 |         > 42 |           {typeof t?.hero === 'object' && t.hero?.title || 'MatMax Yoga Studio'} 43 |         </motion.h1> 44 |  45 |         <motion.p 46 |           initial={{ y: 50, opacity: 0 }} 47 |           animate={{ y: 0, opacity: 1 }} 48 |           transition={{ delay: 0.5, duration: 0.8 }} 49 |           className={`text-xl sm:text-2xl ${themeClasses.text.primary} mb-8 max-w-2xl mx-auto leading-relaxed`} 50 |         > 51 |           {typeof t?.hero === 'object' && t.hero?.subtitle || 'Tu camino al bienestar comienza aquí'} 52 |         </motion.p> 53 |  54 |         <motion.div 55 |           initial={{ y: 50, opacity: 0 }} 56 |           animate={{ y: 0, opacity: 1 }} 57 |           transition={{ delay: 0.7, duration: 0.8 }} 58 |           className={`text-sm ${themeClasses.text.secondary}`} 59 |         > 60 |           {typeof t?.hero === 'object' && t.hero?.scrollHint || 'Scroll to explore'} 61 |         </motion.div> 62 |       </div> 63 |     </motion.section> 64 |   ); 65 | } 66 |  67 | function ApproachSection({ t }: TranslationProps) { 68 |   return ( 69 |     <motion.section 70 |       initial={{ opacity: 0 }} 71 |       animate={{ opacity: 1 }} 72 |       transition={{ duration: 1 }} 73 |       className="relative h-screen flex items-center justify-center px-6" 74 |     > 75 |       <div className="max-w-6xl mx-auto text-center"> 76 |         <motion.h2 77 |           initial={{ y: 50, opacity: 0 }} 78 |           animate={{ y: 0, opacity: 1 }} 79 |           transition={{ delay: 0.3, duration: 0.8 }} 80 |           className={`text-4xl sm:text-5xl font-heading ${themeClasses.text.primary} mb-12`} 81 |         > 82 |           {typeof t?.approach === 'object' && t.approach?.title || 'Our Approach'} 83 |         </motion.h2> 84 |  85 |         <div className="grid grid-cols-1 md:grid-cols-3 gap-8"> 86 |           {[1, 2, 3].map((i) => ( 87 |             <motion.div 88 |               key={i} 89 |               initial={{ y: 50, opacity: 0 }} 90 |               animate={{ y: 0, opacity: 1 }} 91 |               transition={{ delay: 0.5 + i * 0.1, duration: 0.8 }} 92 |               className={`rounded-2xl p-6 ${themeClasses.card.default}`} 93 |             > 94 |               <h3 className={`text-xl font-heading ${themeClasses.text.primary} mb-4`}> 95 |                 {typeof t?.approach === 'object' && t.approach?.[`step${i}Title`] || `Step ${i}`} 96 |               </h3> 97 |               <p className={`${themeClasses.text.secondary} leading-relaxed`}> 98 |                 {typeof t?.approach === 'object' && t.approach?.[`step${i}Description`] || `Description for step ${i}`} 99 |               </p>100 |             </motion.div>101 |           ))}102 |         </div>103 |       </div>104 |     </motion.section>105 |   );106 | }107 | 108 | function SessionSection({ t, scrollToSection }: SessionSectionProps) {109 |   return (110 |     <motion.section111 |       initial={{ opacity: 0 }}112 |       animate={{ opacity: 1 }}113 |       transition={{ duration: 1 }}114 |       className="relative h-screen flex items-center justify-center px-6"115 |     >116 |       <div className="max-w-4xl mx-auto text-center">117 |         <motion.h2118 |           initial={{ y: 50, opacity: 0 }}119 |           animate={{ y: 0, opacity: 1 }}120 |           transition={{ delay: 0.3, duration: 0.8 }}121 |           className={`text-4xl sm:text-5xl font-heading ${themeClasses.text.primary} mb-8`}122 |         >123 |           {typeof t?.session === 'object' && t.session?.title || 'Book Your Session'}124 |         </motion.h2>125 | 126 |         <motion.p127 |           initial={{ y: 50, opacity: 0 }}128 |           animate={{ y: 0, opacity: 1 }}129 |           transition={{ delay: 0.5, duration: 0.8 }}130 |           className={`text-xl ${themeClasses.text.secondary} mb-8 leading-relaxed`}131 |         >132 |           {typeof t?.session === 'object' && t.session?.description || 'Ready to begin your spiritual journey?'}133 |         </motion.p>134 | 135 |         <motion.button136 |           initial={{ y: 50, opacity: 0 }}137 |           animate={{ y: 0, opacity: 1 }}138 |           transition={{ delay: 0.7, duration: 0.8 }}139 |           onClick={() => scrollToSection('apply')}140 |           className={`px-8 py-4 rounded-lg font-medium transition-all duration-300 shadow-lg hover:shadow-xl text-lg ${themeClasses.button.primary}`}141 |         >142 |           {typeof t?.session === 'object' && t.session?.cta || 'Get Started'}143 |         </motion.button>144 |       </div>145 |     </motion.section>146 |   );147 | }148 | 149 | function AboutSection({ t }: TranslationProps) {150 |   return (151 |     <motion.section152 |       initial={{ opacity: 0 }}153 |       animate={{ opacity: 1 }}154 |       transition={{ duration: 1 }}155 |       className="relative h-screen flex items-center justify-center px-6"156 |     >157 |       <div className="max-w-4xl mx-auto text-center">158 |         <motion.h2159 |           initial={{ y: 50, opacity: 0 }}160 |           animate={{ y: 0, opacity: 1 }}161 |           transition={{ delay: 0.3, duration: 0.8 }}162 |           className={`text-4xl sm:text-5xl font-heading ${themeClasses.text.primary} mb-8`}163 |         >164 |           {typeof t?.about === 'object' && t.about?.title || 'About Us'}165 |         </motion.h2>166 | 167 |         <motion.p168 |           initial={{ y: 50, opacity: 0 }}169 |           animate={{ y: 0, opacity: 1 }}170 |           transition={{ delay: 0.5, duration: 0.8 }}171 |           className={`text-xl ${themeClasses.text.secondary} mb-8 leading-relaxed`}172 |         >173 |           {typeof t?.about === 'object' && t.about?.description || 'Learn more about our mission and approach to spiritual healing.'}174 |         </motion.p>175 |       </div>176 |     </motion.section>177 |   );178 | }179 | 180 | function ConstellationBackground() {181 |   return (182 |     <div className="fixed inset-0 pointer-events-none overflow-hidden">183 |       <div className="absolute inset-0 bg-gradient-to-br from-[#191970]/20 via-transparent to-[#0A0A23]/20"></div>184 |       {Array.from({ length: 50 }).map((_, i) => (185 |         <div186 |           key={i}187 |           className="absolute w-1 h-1 bg-[#FFD700] rounded-full animate-pulse"188 |           style={{189 |             left: `${Math.random() * 100}%`,190 |             top: `${Math.random() * 100}%`,191 |             animationDelay: `${Math.random() * 3}s`,192 |             animationDuration: `${2 + Math.random() * 2}s`193 |           }}194 |         />195 |       ))}196 |     </div>197 |   );198 | }199 | 200 | export default function MainPageClient({201 |   initialContent,202 |   initialProfileImage203 | }: MainPageClientProps) {204 |   const { language, setLanguage } = useLanguage();205 |   const { t, isLoading: isLoadingTranslations } = useTranslations(initialContent || {});206 |   const translations = t as Record<string, string | Record<string, string>>;207 |   const { } = useProfileImage(initialProfileImage);208 | 209 |   const [currentSection, setCurrentSection] = useState(0);210 |   const [isMenuOpen, setIsMenuOpen] = useState(false);211 |   const [showAdmin, setShowAdmin] = useState(false);212 |   const [isScrolling, setIsScrolling] = useState(false);213 | 214 |   const scrollTimeout = useRef<NodeJS.Timeout | null>(null);215 |   const sections = ['invitation', 'approach', 'session', 'about', 'apply'];216 | 217 |   useEffect(() => {218 |     const handleWheel = (e: WheelEvent) => {219 |       if (showAdmin || isMenuOpen || isScrolling) return;220 |       e.preventDefault();221 |       setIsScrolling(true);222 | 223 |       const direction = e.deltaY > 0 ? 1 : -1;224 |       setCurrentSection((prev) => {225 |         const next = prev + direction;226 |         return Math.max(0, Math.min(sections.length - 1, next));227 |       });228 | 229 |       if (scrollTimeout.current) clearTimeout(scrollTimeout.current);230 |       scrollTimeout.current = setTimeout(() => setIsScrolling(false), 800);231 |     };232 | 233 |     let touchStartY = 0;234 |     const handleTouchStart = (e: TouchEvent) => {235 |       if (showAdmin || isMenuOpen) return;236 |       touchStartY = e.touches[0].clientY;237 |     };238 | 239 |     const handleTouchEnd = (e: TouchEvent) => {240 |       if (showAdmin || isMenuOpen || isScrolling) return;241 |       const touchEndY = e.changedTouches[0].clientY;242 |       const diff = touchStartY - touchEndY;243 |       const minSwipeDistance = 50;244 | 245 |       if (Math.abs(diff) > minSwipeDistance) {246 |         setIsScrolling(true);247 |         if (diff > 0) {248 |           setCurrentSection((prev) => Math.min(sections.length - 1, prev + 1));249 |         } else {250 |           setCurrentSection((prev) => Math.max(0, prev - 1));251 |         }252 |         if (scrollTimeout.current) clearTimeout(scrollTimeout.current);253 |         scrollTimeout.current = setTimeout(() => setIsScrolling(false), 800);254 |       }255 |     };256 | 257 |     document.addEventListener('wheel', handleWheel, { passive: false });258 |     document.addEventListener('touchstart', handleTouchStart, { passive: true });259 |     document.addEventListener('touchend', handleTouchEnd, { passive: true });260 | 261 |     return () => {262 |       document.removeEventListener('wheel', handleWheel);263 |       document.removeEventListener('touchstart', handleTouchStart);264 |       document.removeEventListener('touchend', handleTouchEnd);265 |       if (scrollTimeout.current) clearTimeout(scrollTimeout.current);266 |     };267 |   }, [showAdmin, isMenuOpen, sections.length, isScrolling]);268 | 269 |   const scrollToSection = (sectionName: string) => {270 |     const index = sections.indexOf(sectionName);271 |     if (index !== -1) {272 |       setCurrentSection(index);273 |     }274 |     setIsMenuOpen(false);275 |   };276 | 277 |   const scrollToSectionByIndex = (index: number) => {278 |     setCurrentSection(index);279 |   };280 | 281 |   const handleLoginClick = () => {282 |     setShowAdmin(true);283 |   };284 | 285 |   if (showAdmin) {286 |     return (287 |       <AdminDashboard onClose={() => setShowAdmin(false)} />288 |     );289 |   }290 | 291 |   if (isLoadingTranslations) {292 |     return (293 |       <div className={`h-screen overflow-hidden ${themeClasses.background.primary} ${themeClasses.text.primary} flex items-center justify-center`}>294 |         <motion.div295 |           animate={{ rotate: 360 }}296 |           transition={{ duration: 2, repeat: Infinity, ease: "linear" }}297 |           className="w-12 h-12 border-4 border-[var(--color-primary-main)] border-t-transparent rounded-full"298 |         />299 |       </div>300 |     );301 |   }302 | 303 |   return (304 |     <div className={`h-screen overflow-hidden ${themeClasses.background.primary} ${themeClasses.text.primary} mobile-container`}>305 |       <ConstellationBackground />306 | 307 |       <Header308 |         language={language}309 |         setLanguage={setLanguage}310 |         scrollToSection={scrollToSection}311 |         t={translations}312 |         isMenuOpen={isMenuOpen}313 |         setIsMenuOpen={setIsMenuOpen}314 |         onLoginClick={handleLoginClick}315 |         user={null}316 |         isAdmin={false}317 |       />318 | 319 |       <div320 |         className="fullpage-container"321 |         style={{ transform: `translateY(-${currentSection * 100}vh)` }}322 |       >323 |         <section id="invitation">324 |           <HeroSection t={translations} />325 |         </section>326 |         <section id="approach">327 |           <ApproachSection t={translations} />328 |         </section>329 |         <section id="session">330 |           <SessionSection t={translations} scrollToSection={scrollToSection} />331 |         </section>332 |         <section id="about">333 |           <AboutSection t={translations} />334 |         </section>335 |         <section id="apply">336 |           <BookingSection t={translations} language={language} />337 |         </section>338 |       </div>339 | 340 |       {}341 |       <div className="fixed right-2 sm:right-3 lg:right-6 top-1/2 -translate-y-1/2 z-40 flex flex-col space-y-2 sm:space-y-3 lg:space-y-4 navigation-dots">342 |         {sections.map((section, index) => (343 |           <motion.button344 |             key={section}345 |             onClick={() => scrollToSectionByIndex(index)}346 |             whileHover={{ scale: 1.2 }}347 |             whileTap={{ scale: 0.9 }}348 |             className={`w-3 h-3 sm:w-4 sm:h-4 rounded-full border-2 transition-all duration-300 touch-manipulation relative ${349 |               currentSection === index350 |                 ? 'bg-[var(--color-primary-main)] border-[var(--color-primary-main)] shadow-lg shadow-[var(--color-primary-main)]/30'351 |                 : 'bg-transparent border-[var(--color-primary-main)]/50 hover:border-[var(--color-primary-main)] hover:bg-[var(--color-primary-main)]/10'352 |             }`}353 |             title={section}354 |             aria-label={`Go to ${section} section`}355 |           />356 |         ))}357 |       </div>358 | 359 |       {}360 |       <AnimatePresence>361 |         {currentSection < sections.length - 1 && (362 |           <motion.button363 |             initial={{ opacity: 0 }}364 |             animate={{ opacity: 1 }}365 |             exit={{ opacity: 0 }}366 |             whileHover={{ scale: 1.1 }}367 |             whileTap={{ scale: 0.9 }}368 |             onClick={() => scrollToSectionByIndex(currentSection + 1)}369 |             className="fixed bottom-6 right-6 w-12 h-12 rounded-full border-2 border-[var(--color-text-secondary)]/30 bg-[var(--color-surface-primary)]/80 backdrop-blur-md flex items-center justify-center text-[var(--color-text-secondary)] hover:text-[var(--color-primary-main)] hover:border-[var(--color-primary-main)]/50 transition-all duration-300 z-[9995] navigation-arrow touch-manipulation"370 |             aria-label="Next section"371 |           >372 |             <ChevronRight size={20} />373 |           </motion.button>374 |         )}375 |       </AnimatePresence>376 | 377 |     </div>378 |   );379 | }
============================================================END: frontend/components/MainPageClient.tsx============================================================


============================================================FILE: frontend/components/MatmaxHomepage.tsxSIZE: 14.74 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import Image from 'next/image';  5 | import { Users, Heart, Star } from 'lucide-react';  6 | import { Header } from './Header';  7 | import { useTranslations, useLanguage } from '@/hooks/useTranslations';  8 |   9 | export function MatmaxHomepage() { 10 |   const [isMenuOpen, setIsMenuOpen] = React.useState(false); 11 |   const { language, setLanguage } = useLanguage(); 12 |   const { t } = useTranslations(); 13 |   const translations = t as Record<string, string | Record<string, string>>; 14 |  15 |   const handleLoginClick = () => { 16 |  17 |     }; 18 |  19 |   const scrollToSection = (section: string) => { 20 |  21 |     }; 22 |  23 |   return ( 24 |     <div className="min-h-screen bg-white"> 25 |       <Header 26 |         language={language} 27 |         setLanguage={setLanguage} 28 |         scrollToSection={scrollToSection} 29 |         t={translations} 30 |         isMenuOpen={isMenuOpen} 31 |         setIsMenuOpen={setIsMenuOpen} 32 |         onLoginClick={handleLoginClick} 33 |         user={null} 34 |         isAdmin={false} 35 |       /> 36 |  37 |       {} 38 |       <section id="home" className="relative h-screen flex items-center justify-center"> 39 |         {} 40 |         <div 41 |           className="absolute inset-0 bg-cover bg-center bg-no-repeat" 42 |           style={{ 43 |             backgroundImage: 'url("/matmaxstudio.png")', 44 |           }} 45 |         > 46 |           <div className="absolute inset-0 bg-black bg-opacity-40"></div> 47 |         </div> 48 |  49 |         {} 50 |         <div className="relative z-10 text-center text-white px-4 max-w-4xl mx-auto"> 51 |           {} 52 |           <div className="mb-8 flex justify-center"> 53 |             <Image 54 |               src="/logo_matmax.png" 55 |               alt="MatMax Yoga Studio Logo" 56 |               width={200} 57 |               height={200} 58 |               className="h-32 w-32 md:h-40 md:w-40 lg:h-48 lg:w-48 object-contain drop-shadow-2xl brightness-0 invert" 59 |               priority 60 |             /> 61 |           </div> 62 |  63 |           <h1 64 |             className="text-4xl md:text-6xl font-bold mb-6 leading-tight" 65 |             style={{ fontFamily: 'var(--font-heading)' }} 66 |           > 67 |             Find Your Flow, Transform Your Body & Mind 68 |           </h1> 69 |           <p 70 |             className="text-xl mb-8 leading-relaxed" 71 |             style={{ fontFamily: 'var(--font-body)' }} 72 |           > 73 |             Daily Vinyasa and Hatha Yoga for all levels. 74 |           </p> 75 |           <div className="flex flex-col sm:flex-row gap-4 justify-center"> 76 |             <a 77 |               href="/account/book" 78 |               className="btn-primary" 79 |             > 80 |               Class Schedule 81 |             </a> 82 |             <a 83 |               href="/packages" 84 |               className="btn-secondary" 85 |             > 86 |               View Packages 87 |             </a> 88 |           </div> 89 |         </div> 90 |       </section> 91 |  92 |       {} 93 |       <section id="about" className="py-24 bg-light"> 94 |         <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> 95 |           <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center"> 96 |             {} 97 |             <div> 98 |               <h2 99 |                 className="text-4xl font-bold text-primary mb-6"100 |                 style={{ fontFamily: 'var(--font-heading)' }}101 |               >102 |                 A Space to Breathe and Grow103 |               </h2>104 |               <p105 |                 className="text-lg text-muted leading-relaxed"106 |                 style={{ fontFamily: 'var(--font-body)' }}107 |               >108 |                 At Matmax Yoga Studio, we believe that yoga is more than just physical exercise—it&apos;s a journey of self-discovery, healing, and transformation. Our welcoming community provides a safe space for practitioners of all levels to explore their practice, build strength, and find inner peace.109 |               </p>110 |             </div>111 | 112 |             {}113 |             <div className="card-base card-hover hover-lift">114 |               <Image115 |                 src="https:116 |                 alt="Yoga studio interior"117 |                 width={1000}118 |                 height={400}119 |                 className="w-full h-64 object-cover rounded-lg"120 |               />121 |             </div>122 |           </div>123 |         </div>124 |       </section>125 | 126 |       {}127 |       <section id="classes" className="py-24 bg-white">128 |         <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">129 |           <div className="text-center mb-16">130 |             <h2131 |               className="text-4xl font-bold text-black mb-4"132 |               style={{ fontFamily: 'var(--font-heading)' }}133 |             >134 |               Our Classes135 |             </h2>136 |             <p137 |               className="text-lg text-muted"138 |               style={{ fontFamily: 'var(--font-body)' }}139 |             >140 |               Choose from our variety of yoga classes designed for every level and need141 |             </p>142 |           </div>143 | 144 |           <div className="product-grid">145 |             {}146 |             <div className="card-base card-hover hover-scale">147 |               <div className="text-center">148 |                 <div className="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">149 |                   <Heart className="w-8 h-8 text-purple-600" />150 |                 </div>151 |                 <h3152 |                   className="text-2xl font-bold text-black mb-3"153 |                   style={{ fontFamily: 'var(--font-heading)' }}154 |                 >155 |                   Vinyasa Flow156 |                 </h3>157 |                 <p158 |                   className="text-gray-600 mb-6"159 |                   style={{ fontFamily: 'var(--font-body)' }}160 |                 >161 |                   Dynamic, flowing sequences that connect breath with movement for a powerful, energizing practice.162 |                 </p>163 |                 <button className="btn-outline">Learn More</button>164 |               </div>165 |             </div>166 | 167 |             {}168 |             <div className="card-base card-hover hover-scale">169 |               <div className="text-center">170 |                 <div className="w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4">171 |                   <Users className="w-8 h-8 text-teal-600" />172 |                 </div>173 |                 <h3174 |                   className="text-2xl font-bold text-black mb-3"175 |                   style={{ fontFamily: 'var(--font-heading)' }}176 |                 >177 |                   Hatha Yoga178 |                 </h3>179 |                 <p180 |                   className="text-gray-600 mb-6"181 |                   style={{ fontFamily: 'var(--font-body)' }}182 |                 >183 |                   Gentle, slower-paced practice focusing on basic postures and breathing techniques.184 |                 </p>185 |                 <button className="btn-outline">Learn More</button>186 |               </div>187 |             </div>188 | 189 |             {}190 |             <div className="card-base card-hover hover-scale">191 |               <div className="text-center">192 |                 <div className="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">193 |                   <Star className="w-8 h-8 text-orange-600" />194 |                 </div>195 |                 <h3196 |                   className="text-2xl font-bold text-black mb-3"197 |                   style={{ fontFamily: 'var(--font-heading)' }}198 |                 >199 |                   Restorative Yin200 |                 </h3>201 |                 <p202 |                   className="text-gray-600 mb-6"203 |                   style={{ fontFamily: 'var(--font-body)' }}204 |                 >205 |                   Deep relaxation through long-held poses that target connective tissues and promote healing.206 |                 </p>207 |                 <button className="btn-outline">Learn More</button>208 |               </div>209 |             </div>210 |           </div>211 |         </div>212 |       </section>213 | 214 |       {}215 |       <section className="py-24 gradient-purple">216 |         <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">217 |           <div className="matpass-card">218 |             <h2219 |               className="text-4xl font-bold text-white mb-6"220 |               style={{ fontFamily: 'var(--font-heading)' }}221 |             >222 |               Unlock Unlimited Yoga with MatPass223 |             </h2>224 |             <p225 |               className="text-lg text-white mb-8"226 |               style={{ fontFamily: 'var(--font-body)' }}227 |             >228 |               Get unlimited access to all our classes, workshops, and special events. Join our community and transform your practice with MatPass.229 |             </p>230 |             <button className="btn-secondary">Get Your MatPass</button>231 |           </div>232 |         </div>233 |       </section>234 | 235 |       {}236 |       <section id="schedule" className="py-24 bg-white">237 |         <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">238 |           <div className="text-center mb-16">239 |             <h2240 |               className="text-4xl font-bold text-black mb-4"241 |               style={{ fontFamily: 'var(--font-heading)' }}242 |             >243 |               Class Schedule244 |             </h2>245 |             <p246 |               className="text-lg text-muted"247 |               style={{ fontFamily: 'var(--font-body)' }}248 |             >249 |               Find the perfect time for your practice250 |             </p>251 |           </div>252 | 253 |           <div className="schedule-grid">254 |             {}255 |             <div className="schedule-cell font-semibold bg-gray-100">Time</div>256 |             <div className="schedule-cell font-semibold bg-gray-100">Monday</div>257 |             <div className="schedule-cell font-semibold bg-gray-100">Tuesday</div>258 |             <div className="schedule-cell font-semibold bg-gray-100">Wednesday</div>259 |             <div className="schedule-cell font-semibold bg-gray-100">Thursday</div>260 |             <div className="schedule-cell font-semibold bg-gray-100">Friday</div>261 |             <div className="schedule-cell font-semibold bg-gray-100">Saturday</div>262 |             <div className="schedule-cell font-semibold bg-gray-100">Sunday</div>263 | 264 |             {}265 |             <div className="schedule-cell font-medium">6:00 AM</div>266 |             <div className="schedule-cell">Vinyasa Flow</div>267 |             <div className="schedule-cell">Hatha Yoga</div>268 |             <div className="schedule-cell">Vinyasa Flow</div>269 |             <div className="schedule-cell">Hatha Yoga</div>270 |             <div className="schedule-cell">Vinyasa Flow</div>271 |             <div className="schedule-cell">Morning Flow</div>272 |             <div className="schedule-cell">Restorative</div>273 | 274 |             <div className="schedule-cell font-medium">9:00 AM</div>275 |             <div className="schedule-cell">Hatha Yoga</div>276 |             <div className="schedule-cell">Vinyasa Flow</div>277 |             <div className="schedule-cell">Hatha Yoga</div>278 |             <div className="schedule-cell">Vinyasa Flow</div>279 |             <div className="schedule-cell">Hatha Yoga</div>280 |             <div className="schedule-cell">Family Yoga</div>281 |             <div className="schedule-cell">Meditation</div>282 | 283 |             <div className="schedule-cell font-medium">6:00 PM</div>284 |             <div className="schedule-cell">Power Vinyasa</div>285 |             <div className="schedule-cell">Restorative Yin</div>286 |             <div className="schedule-cell">Power Vinyasa</div>287 |             <div className="schedule-cell">Restorative Yin</div>288 |             <div className="schedule-cell">Power Vinyasa</div>289 |             <div className="schedule-cell">Evening Flow</div>290 |             <div className="schedule-cell">Yin Yoga</div>291 |           </div>292 |         </div>293 |       </section>294 | 295 |       {}296 |       <footer className="bg-gray-100 py-16">297 |         <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">298 |           <div className="grid grid-cols-1 md:grid-cols-4 gap-8">299 |             {}300 |             <div className="col-span-1 md:col-span-2">301 |               <h3302 |                 className="text-2xl font-bold text-black mb-4"303 |                 style={{ fontFamily: 'var(--font-heading)' }}304 |               >305 |                 Matmax Yoga Studio306 |               </h3>307 |               <p308 |                 className="text-gray-600 mb-4"309 |                 style={{ fontFamily: 'var(--font-body)' }}310 |               >311 |                 Your sanctuary for wellness, growth, and transformation. Join our community and discover the power of yoga.312 |               </p>313 |               <div className="flex space-x-4">314 |                 <a href="/account/book" className="btn-primary">Get Started</a>315 |               </div>316 |             </div>317 | 318 |             {}319 |             <div>320 |               <h4321 |                 className="text-lg font-semibold text-black mb-4"322 |                 style={{ fontFamily: 'var(--font-heading)' }}323 |               >324 |                 Quick Links325 |               </h4>326 |               <ul className="space-y-2">327 |                 <li><a href="#about" className="nav-link" style={{ color: 'var(--matmax-gray-600)' }}>About Us</a></li>328 |                 <li><a href="#classes" className="nav-link" style={{ color: 'var(--matmax-gray-600)' }}>Classes</a></li>329 |                 <li><a href="#schedule" className="nav-link" style={{ color: 'var(--matmax-gray-600)' }}>Schedule</a></li>330 |                 <li><a href="#contact" className="nav-link" style={{ color: 'var(--matmax-gray-600)' }}>Contact</a></li>331 |               </ul>332 |             </div>333 | 334 |             {}335 |             <div>336 |               <h4337 |                 className="text-lg font-semibold text-black mb-4"338 |                 style={{ fontFamily: 'var(--font-heading)' }}339 |               >340 |                 Newsletter341 |               </h4>342 |               <p343 |                 className="text-gray-600 mb-4"344 |                 style={{ fontFamily: 'var(--font-body)' }}345 |               >346 |                 Stay updated with our latest classes and events.347 |               </p>348 |               <div className="flex">349 |                 <input350 |                   type="email"351 |                   placeholder="Enter your email"352 |                   className="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-purple-500"353 |                 />354 |                 <button className="btn-primary rounded-l-none">Subscribe</button>355 |               </div>356 |             </div>357 |           </div>358 | 359 |           {}360 |           <div className="mt-12 pt-8 border-t border-gray-200">361 |             <div className="text-center">362 |               <p363 |                 className="text-sm text-gray-600"364 |                 style={{ fontFamily: 'var(--font-body)' }}365 |               >366 |                 © 2024 Matmax Yoga Studio. All rights reserved.367 |               </p>368 |             </div>369 |           </div>370 |         </div>371 |       </footer>372 |     </div>373 |   );374 | }
============================================================END: frontend/components/MatmaxHomepage.tsx============================================================


============================================================FILE: frontend/components/MobileMenu.tsxSIZE: 7.02 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { motion, AnimatePresence } from 'framer-motion';  5 | import { X, LogIn, Settings } from 'lucide-react';  6 |   7 | interface User {  8 |   id: string;  9 |   email?: string; 10 |   user_metadata?: { 11 |     full_name?: string; 12 |     avatar_url?: string; 13 |   }; 14 | } 15 |  16 | interface MobileMenuProps { 17 |   isOpen: boolean; 18 |   onClose: () => void; 19 |   sections: string[]; 20 |   currentSection: number; 21 |   scrollToSection: (section: string) => void; 22 |   language: string; 23 |   setLanguage: (lang: 'en' | 'es') => void; 24 |   t: Record<string, string | Record<string, string>>; 25 |   user: User | null; 26 |   isAdmin: boolean; 27 |   onLoginClick: () => void; 28 |   onAdminClick: () => void; 29 | } 30 |  31 | export function MobileMenu({ 32 |   isOpen, 33 |   onClose, 34 |   sections, 35 |   currentSection, 36 |   scrollToSection, 37 |   language, 38 |   setLanguage, 39 |   t, 40 |   user, 41 |   isAdmin, 42 |   onLoginClick, 43 |   onAdminClick 44 | }: MobileMenuProps) { 45 |   return ( 46 |     <div className="mobile-menu-container"> 47 |       <AnimatePresence> 48 |         {isOpen && ( 49 |           <> 50 |             <motion.div 51 |               initial={{ opacity: 0 }} 52 |               animate={{ opacity: 1 }} 53 |               exit={{ opacity: 0 }} 54 |               className="fixed inset-0 bg-black/50 z-[9998] backdrop-blur-sm" 55 |               onClick={onClose} 56 |             /> 57 |             <motion.div 58 |               initial={{ x: '-100%' }} 59 |               animate={{ x: 0 }} 60 |               exit={{ x: '-100%' }} 61 |               transition={{ type: "spring", stiffness: 300, damping: 30 }} 62 |               className="fixed top-0 left-0 h-full w-80 max-w-[90vw] bg-gradient-to-b from-[#191970]/98 to-[#0A0A23]/98 backdrop-blur-xl border-r border-[#C0C0C0]/30 z-[9999] mobile-menu shadow-2xl" 63 |             > 64 |               <div className="flex flex-col h-full p-4 sm:p-6 safe-padding"> 65 |                 <div className="flex items-center justify-between mb-6 sm:mb-8"> 66 |                   <span className="font-heading text-lg sm:text-xl text-[#FFD700] font-semibold">MatMax</span> 67 |                   <button 68 |                     onClick={onClose} 69 |                     className="w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-lg hover:bg-[#C0C0C0]/10 text-[#C0C0C0] hover:text-[#FFD700] transition-colors touch-manipulation min-h-[44px] min-w-[44px]" 70 |                   > 71 |                     <X size={20} /> 72 |                   </button> 73 |                 </div> 74 |  75 |                 <nav className="flex-1 space-y-1 sm:space-y-2"> 76 |                   {sections.map((section, index) => ( 77 |                     <motion.button 78 |                       key={section} 79 |                       onClick={() => scrollToSection(section)} 80 |                       whileHover={{ scale: 1.02 }} 81 |                       whileTap={{ scale: 0.98 }} 82 |                       className={`w-full text-left px-4 sm:px-6 py-3 sm:py-4 rounded-xl transition-all duration-200 flex items-center space-x-3 sm:space-x-4 touch-manipulation min-h-[48px] ${ 83 |                         currentSection === index 84 |                           ? 'bg-[#FFD700]/20 text-[#FFD700] border border-[#FFD700]/50 shadow-lg shadow-[#FFD700]/15' 85 |                           : 'text-[#C0C0C0] hover:text-[#EAEAEA] hover:bg-[#C0C0C0]/10 active:bg-[#C0C0C0]/15' 86 |                       }`} 87 |                     > 88 |                       <div className={`w-3 h-3 sm:w-4 sm:h-4 rounded-full flex-shrink-0 ${ 89 |                         currentSection === index ? 'bg-[#FFD700] shadow-sm' : 'bg-[#C0C0C0]/50' 90 |                       }`} /> 91 |                       <span className="text-sm sm:text-base font-medium truncate"> 92 |                         {typeof t.nav === 'object' && t.nav ? t.nav[section as keyof typeof t.nav] || section : section} 93 |                       </span> 94 |                     </motion.button> 95 |                   ))} 96 |                 </nav> 97 |  98 |                 <div className="border-t border-[#C0C0C0]/20 pt-4 sm:pt-6 mt-4 sm:mt-6"> 99 |                   <div className="flex items-center justify-center space-x-2 sm:space-x-3 mb-4 sm:mb-6">100 |                     <motion.button101 |                       onClick={() => setLanguage('en')}102 |                       whileHover={{ scale: 1.05 }}103 |                       whileTap={{ scale: 0.95 }}104 |                       className={`px-4 sm:px-6 py-2 sm:py-3 rounded-xl transition-all duration-200 touch-manipulation font-medium text-sm sm:text-base min-h-[40px] ${105 |                         language === 'en' ? 'text-[#FFD700] bg-[#FFD700]/15 border border-[#FFD700]/30' : 'text-[#C0C0C0] hover:text-[#FFD700] hover:bg-[#C0C0C0]/10'106 |                       }`}107 |                     >108 |                       English109 |                     </motion.button>110 |                     <motion.button111 |                       onClick={() => setLanguage('es')}112 |                       whileHover={{ scale: 1.05 }}113 |                       whileTap={{ scale: 0.95 }}114 |                       className={`px-4 sm:px-6 py-2 sm:py-3 rounded-xl transition-all duration-200 touch-manipulation font-medium text-sm sm:text-base min-h-[40px] ${115 |                         language === 'es' ? 'text-[#FFD700] bg-[#FFD700]/15 border border-[#FFD700]/30' : 'text-[#C0C0C0] hover:text-[#FFD700] hover:bg-[#C0C0C0]/10'116 |                       }`}117 |                     >118 |                       Español119 |                     </motion.button>120 |                   </div>121 | 122 |                   {}123 |                   {!user && (124 |                     <motion.button125 |                       onClick={() => {126 |                         onClose();127 |                         onLoginClick();128 |                       }}129 |                       whileHover={{ scale: 1.02 }}130 |                       whileTap={{ scale: 0.98 }}131 |                       className="w-full flex items-center justify-center space-x-2 sm:space-x-3 text-[#C0C0C0] hover:text-[#FFD700] transition-all duration-200 px-4 sm:px-6 py-3 sm:py-4 rounded-xl hover:bg-[#FFD700]/10 border border-[#C0C0C0]/20 hover:border-[#FFD700]/30 touch-manipulation font-medium min-h-[48px] text-sm sm:text-base"132 |                     >133 |                       <LogIn size={16} className="sm:w-5 sm:h-5" />134 |                       <span>{typeof t.nav === 'object' && t.nav?.login || 'Login'}</span>135 |                     </motion.button>136 |                   )}137 | 138 |                   {user && isAdmin && (139 |                     <motion.button140 |                       onClick={() => {141 |                         onClose();142 |                         onAdminClick();143 |                       }}144 |                       whileHover={{ scale: 1.02 }}145 |                       whileTap={{ scale: 0.98 }}146 |                       className="w-full flex items-center justify-center space-x-2 sm:space-x-3 text-[#FFD700] bg-[#FFD700]/15 px-4 sm:px-6 py-3 sm:py-4 rounded-xl border border-[#FFD700]/40 touch-manipulation font-medium shadow-lg shadow-[#FFD700]/10 min-h-[48px] text-sm sm:text-base"147 |                     >148 |                       <Settings size={16} className="sm:w-5 sm:h-5" />149 |                       <span>Dashboard</span>150 |                     </motion.button>151 |                   )}152 |                 </div>153 |               </div>154 |             </motion.div>155 |           </>156 |         )}157 |       </AnimatePresence>158 |     </div>159 |   );160 | }
============================================================END: frontend/components/MobileMenu.tsx============================================================


============================================================FILE: frontend/components/PackageDisplay.tsxSIZE: 4.71 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { motion } from 'framer-motion';  5 | import { Star, Clock, Users, Calendar } from 'lucide-react';  6 |   7 | export interface Package {  8 |   id: number;  9 |   name: string; 10 |   description: string; 11 |   price: number; 12 |   currency: string; 13 |   sessionsCount: number; 14 |   duration: number; 15 |   isPopular?: boolean; 16 |   packageType?: string; 17 |   maxGroupSize?: number; 18 | } 19 |  20 | interface PackageDisplayProps { 21 |   packages: Package[]; 22 |   onPackageSelect?: (selectedPackage: Package) => void; 23 |   className?: string; 24 | } 25 |  26 | export function PackageDisplay({ packages, onPackageSelect, className = '' }: PackageDisplayProps) { 27 |   if (!packages || packages.length === 0) { 28 |     return ( 29 |       <div className={`p-4 text-center text-[#C0C0C0] ${className}`}> 30 |         <p>No hay paquetes disponibles en este momento.</p> 31 |       </div> 32 |     ); 33 |   } 34 |  35 |   return ( 36 |     <div className={`space-y-3 ${className}`}> 37 |       <div className="text-[#FFD700] font-medium text-sm mb-3"> 38 |         🌟 Paquetes de Astrología Disponibles 39 |       </div> 40 |  41 |       {packages.map((pkg, index) => ( 42 |         <motion.div 43 |           key={pkg.id} 44 |           initial={{ opacity: 0, y: 10 }} 45 |           animate={{ opacity: 1, y: 0 }} 46 |           transition={{ delay: index * 0.1 }} 47 |           className="bg-[#1a1a2e] border border-[#FFD700]/20 rounded-lg p-3 hover:border-[#FFD700]/40 transition-colors duration-200" 48 |         > 49 |           <div className="flex items-start justify-between mb-2"> 50 |             <div className="flex items-center space-x-2"> 51 |               <h3 className="text-[#FFD700] font-medium text-sm"> 52 |                 {pkg.name} 53 |               </h3> 54 |               {pkg.isPopular && ( 55 |                 <div className="flex items-center space-x-1 text-yellow-400"> 56 |                   <Star size={12} /> 57 |                   <span className="text-xs">POPULAR</span> 58 |                 </div> 59 |               )} 60 |             </div> 61 |             <div className="text-[#FFD700] font-bold text-sm"> 62 |               {pkg.currency}{(typeof pkg.price === 'number' && !isNaN(pkg.price) ? pkg.price.toFixed(0) : 'Consultar precio')} 63 |             </div> 64 |           </div> 65 |  66 |           <p className="text-[#C0C0C0] text-xs mb-3 leading-relaxed"> 67 |             {pkg.description} 68 |           </p> 69 |  70 |           <div className="flex items-center space-x-4 text-[#A0A0A0] text-xs"> 71 |             <div className="flex items-center space-x-1"> 72 |               <Calendar size={12} /> 73 |               <span>{pkg.sessionsCount} sesión{pkg.sessionsCount !== 1 ? 'es' : ''}</span> 74 |             </div> 75 |             <div className="flex items-center space-x-1"> 76 |               <Clock size={12} /> 77 |               <span>{pkg.duration} min</span> 78 |             </div> 79 |             {pkg.maxGroupSize && pkg.maxGroupSize > 1 && ( 80 |               <div className="flex items-center space-x-1"> 81 |                 <Users size={12} /> 82 |                 <span>Hasta {pkg.maxGroupSize}</span> 83 |               </div> 84 |             )} 85 |           </div> 86 |  87 |           {onPackageSelect && ( 88 |             <motion.button 89 |               whileHover={{ scale: 1.02 }} 90 |               whileTap={{ scale: 0.98 }} 91 |               onClick={() => onPackageSelect(pkg)} 92 |               className="w-full mt-3 bg-[#FFD700] text-[#0A0A23] py-2 px-3 rounded-md text-xs font-medium hover:bg-[#FFD700]/90 transition-colors duration-200" 93 |             > 94 |               Seleccionar Paquete 95 |             </motion.button> 96 |           )} 97 |         </motion.div> 98 |       ))} 99 | 100 |       <div className="text-center text-[#C0C0C0] text-xs mt-4">101 |         💫 ¿Listo para reservar? Solo dime qué paquete te interesa y te ayudo a comenzar.102 |       </div>103 |     </div>104 |   );105 | }106 | 107 | export function parsePackagesFromText(text: string): Package[] {108 |   const packages: Package[] = [];109 | 110 |   const packageRegex = /\*\*(\d+)\.\s*([^*]+)\*\*([^*]*)\n\s*💰\s*Precio:\s*([^\n]+)\n\s*📅\s*Sesiones:\s*(\d+)\n\s*⏱️\s*Duración:\s*(\d+)\s*minutos?\s*cada\s*una?\n\s*📝\s*([^\n]+)/g;111 | 112 |   let match;113 |   while ((match = packageRegex.exec(text)) !== null) {114 |     const [, index, name, popularBadge, priceText, sessions, duration, description] = match;115 | 116 |     const priceMatch = priceText.match(/([^\d]*)(\d+)/);117 |     const currency = priceMatch ? priceMatch[1].trim() : '$';118 |     const price = priceMatch ? parseFloat(priceMatch[2]) : 0;119 | 120 |     packages.push({121 |       id: parseInt(index),122 |       name: name.trim(),123 |       description: description.trim(),124 |       price: price,125 |       currency: currency,126 |       sessionsCount: parseInt(sessions),127 |       duration: parseInt(duration),128 |       isPopular: popularBadge.includes('⭐') || popularBadge.includes('POPULAR'),129 |       packageType: 'Standard',130 |       maxGroupSize: 1131 |     });132 |   }133 | 134 |   return packages;135 | }
============================================================END: frontend/components/PackageDisplay.tsx============================================================


============================================================FILE: frontend/components/PackagePurchaseFlow.tsxSIZE: 30.95 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import Image from 'next/image';  5 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  6 | import { Button } from '@/components/ui/button';  7 | import { BaseButton } from '@/components/ui/BaseButton';  8 | import { Input } from '@/components/ui/input';  9 | import { Label } from '@/components/ui/label'; 10 | import { Textarea } from '@/components/ui/textarea'; 11 | import { Package, Users, CheckCircle, CreditCard, ShoppingCart, User, Calendar } from 'lucide-react'; 12 | import { toast } from 'sonner'; 13 | import { useAuth } from '@/hooks/useAuth'; 14 | import { StripeInlineForm } from '@/components/stripe/StripeInlineForm'; 15 | import { IzipayForm } from '@/components/izipay/IzipayForm'; 16 |  17 | interface PackagePrice { 18 |   id: number; 19 |   price: number; 20 |   packageDefinition: { 21 |     id: number; 22 |     name: string; 23 |     description: string; 24 |     sessionsCount: number; 25 |     isActive: boolean; 26 |   }; 27 |   currency: { 28 |     id: number; 29 |     code: string; 30 |     symbol: string; 31 |     name: string; 32 |   }; 33 | } 34 |  35 | interface PaymentMethod { 36 |   id: number; 37 |   name: string; 38 |   type: string; 39 |   description: string; 40 |   icon: string; 41 |   requiresConfirmation: boolean; 42 |   autoAssignPackage: boolean; 43 |   isActive: boolean; 44 |   providerConfig?: { 45 |     izipayConfig?: { 46 |       publicKey: string; 47 |       username?: string; 48 |       password?: string; 49 |       hmacKey?: string; 50 |       environment: 'TEST' | 'PRODUCTION'; 51 |     }; 52 |   }; 53 | } 54 |  55 | interface PurchaseFormData { 56 |   selectedPackage: PackagePrice | null; 57 |   selectedPaymentMethod: PaymentMethod | null; 58 |   quantity: number; 59 |   notes: string; 60 |  61 |   clientName: string; 62 |   clientEmail: string; 63 |   clientPhone: string; 64 |   birthDate: string; 65 |   birthTime: string; 66 |   birthPlace: string; 67 |   question: string; 68 |   language: string; 69 | } 70 |  71 | export function PackagePurchaseFlow() { 72 |   const { user } = useAuth(); 73 |   const [packages, setPackages] = useState<PackagePrice[]>([]); 74 |   const [paymentMethods, setPaymentMethods] = useState<PaymentMethod[]>([]); 75 |   const [loading, setLoading] = useState(true); 76 |   const [processing, setProcessing] = useState(false); 77 |   const [currentStep, setCurrentStep] = useState(0); 78 |   const [showPaymentMethodDropdown, setShowPaymentMethodDropdown] = useState(false); 79 |  80 |   const [formData, setFormData] = useState<PurchaseFormData>({ 81 |     selectedPackage: null, 82 |     selectedPaymentMethod: null, 83 |     quantity: 1, 84 |     notes: '', 85 |     clientName: '', 86 |     clientEmail: '', 87 |     clientPhone: '', 88 |     birthDate: '', 89 |     birthTime: '', 90 |     birthPlace: '', 91 |     question: '', 92 |     language: 'en' 93 |   }); 94 |  95 |   const steps = [ 96 |     { id: 0, name: 'Select Package', description: 'Choose your package' }, 97 |     { id: 1, name: 'Review Details', description: 'Confirm your information' }, 98 |     { id: 2, name: 'Payment', description: 'Complete your purchase' } 99 |   ];100 | 101 |   const loadUserProfile = useCallback(async () => {102 |     if (!user?.access_token) return;103 | 104 |     try {105 |       const response = await fetch('/api/client/me', {106 |         headers: {107 |           'Authorization': `Bearer ${user.access_token}`,108 |           'Content-Type': 'application/json'109 |         }110 |       });111 | 112 |       if (response.ok) {113 |         const data = await response.json();114 |         if (data.success) {115 |           const profile = data.data;116 | 117 |           setFormData(prev => ({118 |             ...prev,119 |             clientName: profile.fullName || '',120 |             clientEmail: profile.email || '',121 |             clientPhone: profile.phone || '',122 |             birthDate: profile.birthDate || '',123 |             birthTime: profile.birthTime || '',124 |             birthPlace: profile.birthPlace || '',125 |             question: profile.question || '',126 |             language: profile.language || 'en'127 |           }));128 |         }129 |       }130 |     } catch (error) {131 |       }132 |   }, [user?.access_token]);133 | 134 |   const loadPackages = useCallback(async () => {135 |     if (!user?.access_token) return;136 | 137 |     try {138 |       const response = await fetch('/api/client/packages', {139 |         headers: {140 |           'Authorization': `Bearer ${user.access_token}`,141 |           'Content-Type': 'application/json'142 |         }143 |       });144 | 145 |       if (response.ok) {146 |         const data = await response.json();147 |         if (data.success) {148 |           setPackages(data.data || []);149 |         }150 |       }151 |     } catch (error) {152 |       }153 |   }, [user?.access_token]);154 | 155 |   const loadPaymentMethods = useCallback(async () => {156 |     if (!user?.access_token) return;157 | 158 |     try {159 |       const response = await fetch('/api/client/payment-methods', {160 |         headers: {161 |           'Authorization': `Bearer ${user.access_token}`,162 |           'Content-Type': 'application/json'163 |         }164 |       });165 | 166 |       if (response.ok) {167 |         const data = await response.json();168 |         if (data.success) {169 |           setPaymentMethods(data.data);170 | 171 |           const stripeMethod = data.data.find((method: PaymentMethod) => method.type === 'stripe');172 |           if (stripeMethod) {173 |             setFormData(prev => ({ ...prev, selectedPaymentMethod: stripeMethod }));174 |           }175 |         }176 |       } else {177 | 178 |         const defaultStripeMethod = {179 |           id: 1,180 |           name: 'Credit Card',181 |           type: 'stripe',182 |           description: 'Pay with Visa, Mastercard, or American Express',183 |           icon: 'https:184 |           requiresConfirmation: false,185 |           autoAssignPackage: true,186 |           isActive: true187 |         };188 |         setPaymentMethods([defaultStripeMethod]);189 |         setFormData(prev => ({ ...prev, selectedPaymentMethod: defaultStripeMethod }));190 |       }191 |     } catch (error) {192 |       }193 |   }, [user?.access_token]);194 | 195 |   const loadData = useCallback(async () => {196 |     setLoading(true);197 |     try {198 |       await Promise.all([199 |         loadUserProfile(),200 |         loadPackages(),201 |         loadPaymentMethods()202 |       ]);203 |     } catch (error) {204 |       toast.error('Failed to load data');205 |     } finally {206 |       setLoading(false);207 |     }208 |   }, [loadUserProfile, loadPackages, loadPaymentMethods]);209 | 210 |   useEffect(() => {211 |     if (user?.access_token) {212 |       loadData();213 |     }214 |   }, [user?.access_token, loadData]);215 | 216 |   const handlePackageSelect = (pkg: PackagePrice) => {217 |     setFormData(prev => ({ ...prev, selectedPackage: pkg }));218 |     setCurrentStep(1);219 |   };220 | 221 |   const handlePaymentMethodSelect = (method: PaymentMethod) => {222 |     setFormData(prev => ({ ...prev, selectedPaymentMethod: method }));223 |     setShowPaymentMethodDropdown(false);224 |   };225 | 226 |   const handleInputChange = (field: keyof PurchaseFormData, value: string | number) => {227 |     setFormData(prev => ({ ...prev, [field]: value }));228 |   };229 | 230 |   const handleQuantityChange = (value: string) => {231 |     const quantity = parseInt(value) || 1;232 |     setFormData(prev => ({ ...prev, quantity: Math.max(1, Math.min(10, quantity)) }));233 |   };234 | 235 |   const handlePurchase = async (token?: string) => {236 |     if (!formData.selectedPackage || !formData.selectedPaymentMethod) {237 |       toast.error('Please select a package and payment method');238 |       return;239 |     }240 | 241 |     setProcessing(true);242 | 243 |     try {244 |       const requestBody: {245 |         packagePriceId: number;246 |         paymentMethodId: number;247 |         quantity: number;248 |         notes: string;249 |         paymentToken?: string;250 |       } = {251 |         packagePriceId: formData.selectedPackage.id,252 |         paymentMethodId: formData.selectedPaymentMethod.id,253 |         quantity: formData.quantity,254 |         notes: formData.notes255 |       };256 | 257 |       if (formData.selectedPaymentMethod.type === 'izipay' && token) {258 |         requestBody.paymentToken = token;259 |       }260 | 261 |       const response = await fetch('/api/client/purchase', {262 |         method: 'POST',263 |         headers: {264 |           'Authorization': `Bearer ${user?.access_token}`,265 |           'Content-Type': 'application/json'266 |         },267 |         body: JSON.stringify(requestBody)268 |       });269 | 270 |       const result = await response.json();271 | 272 |       if (result.success) {273 |         toast.success('Purchase completed successfully!');274 | 275 |         setFormData(prev => ({276 |           ...prev,277 |           selectedPackage: null,278 |           selectedPaymentMethod: null,279 |           quantity: 1,280 |           notes: ''281 |         }));282 |         setCurrentStep(0);283 |       } else {284 |         toast.error(result.message || 'Failed to complete purchase');285 |       }286 |     } catch (error) {287 |       toast.error('Failed to process purchase');288 |     } finally {289 |       setProcessing(false);290 |     }291 |   };292 | 293 |   const renderStepContent = () => {294 |     switch (currentStep) {295 |       case 0:296 |         return (297 |           <div className="space-y-6">298 |             <div className="text-center">299 |               <h2 className="text-2xl font-bold text-white mb-2">Select Your Package</h2>300 |               <p className="text-gray-400">Choose the perfect package for your spiritual journey</p>301 |             </div>302 | 303 |             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">304 |               {packages.map((pkg) => (305 |                 <Card306 |                   key={pkg.id}307 |                   className={`cursor-pointer transition-all ${308 |                     formData.selectedPackage?.id === pkg.id309 |                       ? 'ring-2 ring-[#ffd700] bg-[#1a1a2e]'310 |                       : 'bg-[#1a1a2e] border-[#16213e] hover:border-[#ffd700]/50'311 |                   }`}312 |                   onClick={() => handlePackageSelect(pkg)}313 |                 >314 |                   <CardHeader className="pb-3">315 |                     <div className="flex justify-between items-start">316 |                       <div className="flex items-center space-x-2">317 |                         <Package className="w-5 h-5 text-[#ffd700]" />318 |                         <CardTitle className="text-lg text-white">{pkg.packageDefinition.name}</CardTitle>319 |                       </div>320 |                       <div className="text-right">321 |                         <div className="text-2xl font-bold text-[#ffd700]">322 |                           {pkg.currency.symbol}{pkg.price}323 |                         </div>324 |                         <div className="text-sm text-gray-400">{pkg.currency.code}</div>325 |                       </div>326 |                     </div>327 |                   </CardHeader>328 |                   <CardContent className="space-y-3">329 |                     <p className="text-gray-300 text-sm">{pkg.packageDefinition.description}</p>330 | 331 |                     <div className="flex items-center space-x-4 text-sm text-gray-400">332 |                       <div className="flex items-center space-x-1">333 |                         <Users className="w-4 h-4" />334 |                         <span>{pkg.packageDefinition.sessionsCount} sessions</span>335 |                       </div>336 |                     </div>337 | 338 |                     <div className="space-y-2">339 |                       <h4 className="text-sm font-medium text-white">What&apos;s included:</h4>340 |                       <ul className="space-y-1">341 |                         <li className="flex items-center space-x-2 text-sm text-gray-300">342 |                           <CheckCircle className="w-3 h-3 text-[#ffd700]" />343 |                           <span>Personalized spiritual guidance</span>344 |                         </li>345 |                         <li className="flex items-center space-x-2 text-sm text-gray-300">346 |                           <CheckCircle className="w-3 h-3 text-[#ffd700]" />347 |                           <span>Flexible scheduling</span>348 |                         </li>349 |                         <li className="flex items-center space-x-2 text-sm text-gray-300">350 |                           <CheckCircle className="w-3 h-3 text-[#ffd700]" />351 |                           <span>Email support</span>352 |                         </li>353 |                       </ul>354 |                     </div>355 |                   </CardContent>356 |                 </Card>357 |               ))}358 |             </div>359 |           </div>360 |         );361 | 362 |       case 1:363 |         return (364 |           <div className="space-y-6">365 |             <div className="text-center">366 |               <h2 className="text-2xl font-bold text-white mb-2">Review Your Information</h2>367 |               <p className="text-gray-400">Please review and update your details if needed</p>368 |             </div>369 | 370 |             <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">371 |               {}372 |               <Card className="bg-[#1a1a2e] border-[#16213e]">373 |                 <CardHeader>374 |                   <CardTitle className="text-white flex items-center space-x-2">375 |                     <User className="w-5 h-5 text-[#ffd700]" />376 |                     <span>Personal Information</span>377 |                   </CardTitle>378 |                 </CardHeader>379 |                 <CardContent className="space-y-4">380 |                   <div>381 |                     <Label htmlFor="clientName" className="text-gray-300">Full Name</Label>382 |                     <Input383 |                       id="clientName"384 |                       value={formData.clientName}385 |                       onChange={(e) => handleInputChange('clientName', e.target.value)}386 |                       className="bg-[#16213e] border-[#0a0a23] text-white"387 |                     />388 |                   </div>389 | 390 |                   <div>391 |                     <Label htmlFor="clientEmail" className="text-gray-300">Email</Label>392 |                     <Input393 |                       id="clientEmail"394 |                       type="email"395 |                       value={formData.clientEmail}396 |                       onChange={(e) => handleInputChange('clientEmail', e.target.value)}397 |                       className="bg-[#16213e] border-[#0a0a23] text-white"398 |                     />399 |                   </div>400 | 401 |                   <div>402 |                     <Label htmlFor="clientPhone" className="text-gray-300">Phone</Label>403 |                     <Input404 |                       id="clientPhone"405 |                       value={formData.clientPhone}406 |                       onChange={(e) => handleInputChange('clientPhone', e.target.value)}407 |                       className="bg-[#16213e] border-[#0a0a23] text-white"408 |                     />409 |                   </div>410 |                 </CardContent>411 |               </Card>412 | 413 |               {}414 |               <Card className="bg-[#1a1a2e] border-[#16213e]">415 |                 <CardHeader>416 |                   <CardTitle className="text-white flex items-center space-x-2">417 |                     <Calendar className="w-5 h-5 text-[#ffd700]" />418 |                     <span>Birth Information</span>419 |                   </CardTitle>420 |                 </CardHeader>421 |                 <CardContent className="space-y-4">422 |                   <div className="grid grid-cols-2 gap-4">423 |                     <div>424 |                       <Label htmlFor="birthDate" className="text-gray-300">Birth Date</Label>425 |                       <Input426 |                         id="birthDate"427 |                         type="date"428 |                         value={formData.birthDate}429 |                         onChange={(e) => handleInputChange('birthDate', e.target.value)}430 |                         className="bg-[#16213e] border-[#0a0a23] text-white"431 |                       />432 |                     </div>433 |                     <div>434 |                       <Label htmlFor="birthTime" className="text-gray-300">Birth Time</Label>435 |                       <Input436 |                         id="birthTime"437 |                         type="time"438 |                         value={formData.birthTime}439 |                         onChange={(e) => handleInputChange('birthTime', e.target.value)}440 |                         className="bg-[#16213e] border-[#0a0a23] text-white"441 |                       />442 |                     </div>443 |                   </div>444 | 445 |                   <div>446 |                     <Label htmlFor="birthPlace" className="text-gray-300">Birth Place</Label>447 |                     <Input448 |                       id="birthPlace"449 |                       value={formData.birthPlace}450 |                       onChange={(e) => handleInputChange('birthPlace', e.target.value)}451 |                       className="bg-[#16213e] border-[#0a0a23] text-white"452 |                     />453 |                   </div>454 | 455 |                   <div>456 |                     <Label htmlFor="question" className="text-gray-300">Your Question</Label>457 |                     <Textarea458 |                       id="question"459 |                       value={formData.question}460 |                       onChange={(e) => handleInputChange('question', e.target.value)}461 |                       className="bg-[#16213e] border-[#0a0a23] text-white"462 |                       rows={3}463 |                       placeholder="What would you like guidance on?"464 |                     />465 |                   </div>466 |                 </CardContent>467 |               </Card>468 |             </div>469 | 470 |             {}471 |             {formData.selectedPackage && (472 |               <Card className="bg-[#1a1a2e] border-[#16213e]">473 |                 <CardHeader>474 |                   <CardTitle className="text-white">Package Summary</CardTitle>475 |                 </CardHeader>476 |                 <CardContent>477 |                   <div className="flex justify-between items-center mb-4">478 |                     <div>479 |                       <h3 className="text-lg font-semibold text-white">{formData.selectedPackage.packageDefinition.name}</h3>480 |                       <p className="text-gray-400">{formData.selectedPackage.packageDefinition.description}</p>481 |                     </div>482 |                     <div className="text-right">483 |                       <div className="text-2xl font-bold text-[#ffd700]">484 |                         {formData.selectedPackage.currency.symbol}{formData.selectedPackage.price}485 |                       </div>486 |                       <div className="text-sm text-gray-400">per package</div>487 |                     </div>488 |                   </div>489 | 490 |                   <div className="flex justify-between items-center">491 |                     <div className="flex items-center space-x-2">492 |                       <Label htmlFor="quantity" className="text-gray-300">Quantity:</Label>493 |                       <Input494 |                         id="quantity"495 |                         type="number"496 |                         min="1"497 |                         max="10"498 |                         value={formData.quantity}499 |                         onChange={(e) => handleQuantityChange(e.target.value)}500 |                         className="w-20 bg-[#16213e] border-[#0a0a23] text-white text-center"501 |                       />502 |                     </div>503 |                     <div className="text-right">504 |                       <div className="text-lg font-bold text-white">505 |                         Total: {formData.selectedPackage.currency.symbol}506 |                         {typeof formData.selectedPackage.price === 'number' && !isNaN(formData.selectedPackage.price)507 |                           ? (formData.selectedPackage.price * formData.quantity).toFixed(2)508 |                           : <span className="text-red-400 text-sm" title={`Raw price: ${formData.selectedPackage.price}`}>509 |                               {formData.selectedPackage.price !== undefined && formData.selectedPackage.price !== null ? String(formData.selectedPackage.price) : 'Contact for pricing'}510 |                             </span>511 |                         }512 |                       </div>513 |                     </div>514 |                   </div>515 |                 </CardContent>516 |               </Card>517 |             )}518 |           </div>519 |         );520 | 521 |       case 2:522 |         return (523 |           <div className="space-y-6">524 |             <div className="text-center">525 |               <h2 className="text-2xl font-bold text-white mb-2">Complete Your Purchase</h2>526 |               <p className="text-gray-400">Choose your payment method and complete the transaction</p>527 |             </div>528 | 529 |             {}530 |             <Card className="bg-[#1a1a2e] border-[#16213e]">531 |               <CardHeader>532 |                 <CardTitle className="text-white">Payment Method</CardTitle>533 |               </CardHeader>534 |               <CardContent>535 |                 <div className="space-y-4">536 |                   <div className="flex items-center space-x-2">537 |                     <Button538 |                       variant="outline"539 |                       onClick={() => setShowPaymentMethodDropdown(!showPaymentMethodDropdown)}540 |                       className="bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23]"541 |                     >542 |                       <CreditCard className="w-4 h-4 mr-2" />543 |                       {formData.selectedPaymentMethod ? formData.selectedPaymentMethod.name : 'Select Payment Method'}544 |                     </Button>545 |                   </div>546 | 547 |                   {showPaymentMethodDropdown && (548 |                     <div className="space-y-2">549 |                       {paymentMethods.map((method) => (550 |                         <div551 |                           key={method.id}552 |                           onClick={() => handlePaymentMethodSelect(method)}553 |                           className="p-3 border border-[#0a0a23] rounded-lg cursor-pointer hover:bg-[#0a0a23] transition-colors"554 |                         >555 |                           <div className="flex items-center space-x-3">556 |                             <Image src={method.icon} alt={method.name} width={24} height={24} className="w-6 h-6" />557 |                             <div>558 |                               <div className="text-white font-medium">{method.name}</div>559 |                               <div className="text-gray-400 text-sm">{method.description}</div>560 |                             </div>561 |                           </div>562 |                         </div>563 |                       ))}564 |                     </div>565 |                   )}566 | 567 |                   {}568 |                   {formData.selectedPaymentMethod?.type === 'stripe' && (569 |                     <div className="mt-4">570 |                       <StripeInlineForm571 |                         amount={formData.selectedPackage ? formData.selectedPackage.price * formData.quantity * 100 : 0}572 |                         currency={formData.selectedPackage?.currency.code || 'usd'}573 |                         description={`Purchase of ${formData.selectedPackage?.packageDefinition.name || 'package'} (${formData.quantity} ${formData.quantity === 1 ? 'unit' : 'units'})`}574 |                         customerEmail={formData.clientEmail}575 |                         onSuccess={() => {576 |                           toast.success('Payment successful!');577 |                           handlePurchase();578 |                         }}579 |                         onError={(error) => {580 |                           toast.error(`Payment failed: ${error}`);581 |                         }}582 |                       />583 |                     </div>584 |                   )}585 | 586 |                   {}587 |                   {formData.selectedPaymentMethod?.type === 'izipay' && formData.selectedPaymentMethod.providerConfig?.izipayConfig && (588 |                     <div className="mt-4">589 |                       <IzipayForm590 |                         publicKey={formData.selectedPaymentMethod.providerConfig.izipayConfig.publicKey}591 |                         amountInCents={formData.selectedPackage ? Math.round(formData.selectedPackage.price * formData.quantity * 100) : 0}592 |                         currency={formData.selectedPackage?.currency.code || 'PEN'}593 |                         onSuccess={(token) => {594 |                           toast.success('Payment token created successfully!');595 |                           handlePurchase(token);596 |                         }}597 |                         onError={(error) => {598 |                           toast.error(`Payment failed: ${error}`);599 |                         }}600 |                       />601 |                     </div>602 |                   )}603 | 604 |                   {}605 |                   {formData.selectedPaymentMethod?.type !== 'stripe' &&606 |                    formData.selectedPaymentMethod?.type !== 'izipay' &&607 |                    formData.selectedPaymentMethod && (608 |                     <div className="mt-4 p-4 bg-[#16213e] rounded-lg">609 |                       <p className="text-gray-300 text-sm">610 |                         You selected {formData.selectedPaymentMethod.name}.611 |                         {formData.selectedPaymentMethod.requiresConfirmation612 |                           ? ' Please contact us to complete your payment.'613 |                           : ' Click the button below to complete your purchase.'}614 |                       </p>615 |                     </div>616 |                   )}617 |                 </div>618 |               </CardContent>619 |             </Card>620 | 621 |             {}622 |             {formData.selectedPackage && (623 |               <Card className="bg-[#1a1a2e] border-[#16213e]">624 |                 <CardHeader>625 |                   <CardTitle className="text-white">Order Summary</CardTitle>626 |                 </CardHeader>627 |                 <CardContent className="space-y-4">628 |                   <div className="flex justify-between items-center">629 |                     <span className="text-gray-300">Package:</span>630 |                     <span className="text-white font-medium">{formData.selectedPackage.packageDefinition.name}</span>631 |                   </div>632 | 633 |                   <div className="flex justify-between items-center">634 |                     <span className="text-gray-300">Quantity:</span>635 |                     <span className="text-white font-medium">{formData.quantity}</span>636 |                   </div>637 | 638 |                   <div className="flex justify-between items-center">639 |                     <span className="text-gray-300">Price per package:</span>640 |                     <span className="text-white font-medium">641 |                       {formData.selectedPackage.currency.symbol}{formData.selectedPackage.price}642 |                     </span>643 |                   </div>644 | 645 |                   <div className="flex justify-between items-center text-lg font-bold border-t border-[#0a0a23] pt-4">646 |                     <span className="text-gray-300">Total:</span>647 |                     <span className="text-[#ffd700]">648 |                       {formData.selectedPackage.currency.symbol}649 |                       {typeof formData.selectedPackage.price === 'number' && !isNaN(formData.selectedPackage.price)650 |                         ? (formData.selectedPackage.price * formData.quantity).toFixed(2)651 |                         : <span className="text-red-400 text-sm" title={`Raw price: ${formData.selectedPackage.price}`}>652 |                             {formData.selectedPackage.price !== undefined && formData.selectedPackage.price !== null ? String(formData.selectedPackage.price) : 'Contact for pricing'}653 |                           </span>654 |                       }655 |                     </span>656 |                   </div>657 | 658 |                   {formData.selectedPaymentMethod?.type !== 'stripe' &&659 |                    formData.selectedPaymentMethod?.type !== 'izipay' && (660 |                     <Button661 |                       onClick={() => handlePurchase()}662 |                       disabled={!formData.selectedPaymentMethod || processing}663 |                       className="w-full bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"664 |                     >665 |                       {processing ? (666 |                         <div className="flex items-center space-x-2">667 |                           <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-black"></div>668 |                           <span>Processing...</span>669 |                         </div>670 |                       ) : (671 |                         <div className="flex items-center space-x-2">672 |                           <ShoppingCart className="w-4 h-4" />673 |                           <span>Complete Purchase</span>674 |                         </div>675 |                       )}676 |                     </Button>677 |                   )}678 |                 </CardContent>679 |               </Card>680 |             )}681 |           </div>682 |         );683 | 684 |       default:685 |         return null;686 |     }687 |   };688 | 689 |   if (loading) {690 |     return (691 |       <div className="flex items-center justify-center min-h-[400px]">692 |         <div className="text-center">693 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>694 |           <p className="text-[#FFD700] text-lg font-semibold">Loading purchase options...</p>695 |         </div>696 |       </div>697 |     );698 |   }699 | 700 |   if (packages.length === 0) {701 |     return (702 |       <div className="text-center py-12">703 |         <Package size={48} className="mx-auto text-gray-400/50 mb-4" />704 |         <h3 className="text-lg font-heading text-white mb-2">No Packages Available</h3>705 |         <p className="text-gray-400 mb-4">There are currently no packages available for purchase. Please check back later.</p>706 |         <BaseButton707 |           className="dashboard-button-primary"708 |           onClick={() => window.location.reload()}709 |         >710 |           <Package size={16} className="mr-2" />711 |           Refresh712 |         </BaseButton>713 |       </div>714 |     );715 |   }716 | 717 |   return (718 |     <div className="max-w-6xl mx-auto p-6">719 |       {}720 |       <div className="mb-8">721 |         <div className="flex items-center justify-between">722 |           {steps.map((step, index) => (723 |             <div key={step.id} className="flex items-center">724 |               <div className={`flex items-center justify-center w-10 h-10 rounded-full ${725 |                 currentStep >= step.id726 |                   ? 'bg-[#ffd700] text-black'727 |                   : 'bg-[#16213e] text-gray-400'728 |               }`}>729 |                 {currentStep > step.id ? (730 |                   <CheckCircle className="w-5 h-5" />731 |                 ) : (732 |                   <span className="font-semibold">{step.id + 1}</span>733 |                 )}734 |               </div>735 |               <div className="ml-3">736 |                 <div className={`text-sm font-medium ${737 |                   currentStep >= step.id ? 'text-white' : 'text-gray-400'738 |                 }`}>739 |                   {step.name}740 |                 </div>741 |                 <div className="text-xs text-gray-500">{step.description}</div>742 |               </div>743 |               {index < steps.length - 1 && (744 |                 <div className={`w-16 h-0.5 mx-4 ${745 |                   currentStep > step.id ? 'bg-[#ffd700]' : 'bg-[#16213e]'746 |                 }`} />747 |               )}748 |             </div>749 |           ))}750 |         </div>751 |       </div>752 | 753 |       {}754 |       {renderStepContent()}755 | 756 |       {}757 |       <div className="flex justify-between mt-8">758 |         <Button759 |           onClick={() => setCurrentStep(Math.max(0, currentStep - 1))}760 |           disabled={currentStep === 0}761 |           variant="outline"762 |           className="bg-[#16213e] border-[#0a0a23] text-white hover:bg-[#0a0a23] disabled:opacity-50"763 |         >764 |           Previous765 |         </Button>766 | 767 |         {currentStep < 2 && (768 |           <Button769 |             onClick={() => setCurrentStep(currentStep + 1)}770 |             disabled={!formData.selectedPackage || (currentStep === 1 && !formData.clientName)}771 |             className="bg-[#ffd700] text-black hover:bg-[#ffd700]/90 disabled:opacity-50"772 |           >773 |             Next774 |           </Button>775 |         )}776 |       </div>777 |     </div>778 |   );779 | }
============================================================END: frontend/components/PackagePurchaseFlow.tsx============================================================


============================================================FILE: frontend/components/PackagesAndPricing.tsxSIZE: 46.83 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { Label } from '@/components/ui/label';  7 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  8 | import { Badge } from '@/components/ui/badge';  9 | import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; 10 | import { Package, DollarSign, Plus, Edit, Trash2, Filter, RefreshCw } from 'lucide-react'; 11 | import { toast } from 'sonner'; 12 | import { useAuth } from '../hooks/useAuth'; 13 | import PackageDefinitionModal from './modals/PackageDefinitionModal'; 14 | import PackagePriceModal from './modals/PackagePriceModal'; 15 | import DeleteConfirmationModal from './modals/DeleteConfirmationModal'; 16 |  17 | interface Currency { 18 |   id: number; 19 |   code: string; 20 |   name: string; 21 |   symbol: string; 22 |   isDefault: boolean; 23 |   exchangeRate: number; 24 | } 25 |  26 | interface SessionDuration { 27 |   id: number; 28 |   name: string; 29 |   duration_minutes: number; 30 |   description: string; 31 |   isActive: boolean; 32 | } 33 |  34 | interface PackageDefinition { 35 |   id: number; 36 |   name: string; 37 |   description: string; 38 |   sessionsCount: number; 39 |   sessionDurationId: number; 40 |   packageType: 'individual' | 'group' | 'mixed'; 41 |   maxGroupSize: number | null; 42 |   isActive: boolean; 43 |   createdAt: string; 44 |   updatedAt: string; 45 |   sessionDuration: SessionDuration; 46 |   packagePrices: PackagePrice[]; 47 | } 48 |  49 | interface PackagePrice { 50 |   id: number; 51 |   packageDefinitionId: number; 52 |   currencyId: number; 53 |   price: number; 54 |   pricingMode: 'custom' | 'calculated'; 55 |   isActive: boolean; 56 |   createdAt: string; 57 |   updatedAt: string; 58 |   packageDefinition: PackageDefinition; 59 |   currency: Currency; 60 | } 61 |  62 | const PackagesAndPricing: React.FC = () => { 63 |   const { user } = useAuth(); 64 |   const [packageDefinitions, setPackageDefinitions] = useState<PackageDefinition[]>([]); 65 |   const [packagePrices, setPackagePrices] = useState<PackagePrice[]>([]); 66 |   const [currencies, setCurrencies] = useState<Currency[]>([]); 67 |   const [sessionDurations, setSessionDurations] = useState<SessionDuration[]>([]); 68 |   const [loading, setLoading] = useState(true); 69 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null); 70 |   const [activeTab, setActiveTab] = useState('definitions'); 71 |  72 |   const [definitionFilters, setDefinitionFilters] = useState({ 73 |     packageType: 'all', 74 |     isActive: 'all', 75 |     sessionDurationId: 'all' 76 |   }); 77 |  78 |   const [priceFilters, setPriceFilters] = useState({ 79 |     packageDefinitionId: 'all', 80 |     currencyId: 'all', 81 |     pricingMode: 'all', 82 |     isActive: 'all' 83 |   }); 84 |  85 |   const [showCreateDefinitionModal, setShowCreateDefinitionModal] = useState(false); 86 |   const [showEditDefinitionModal, setShowEditDefinitionModal] = useState(false); 87 |   const [showCreatePriceModal, setShowCreatePriceModal] = useState(false); 88 |   const [showEditPriceModal, setShowEditPriceModal] = useState(false); 89 |   const [showDeleteModal, setShowDeleteModal] = useState(false); 90 |   const [selectedItem, setSelectedItem] = useState<PackageDefinition | PackagePrice | null>(null); 91 |   const [deleteType, setDeleteType] = useState<'definition' | 'price'>('definition'); 92 |  93 |   const [definitionFormData, setDefinitionFormData] = useState({ 94 |     name: '', 95 |     description: '', 96 |     sessionsCount: '', 97 |     sessionDurationId: '', 98 |     packageType: 'individual' as const, 99 |     maxGroupSize: '',100 |     isActive: true101 |   });102 | 103 |   const [priceFormData, setPriceFormData] = useState({104 |     packageDefinitionId: '',105 |     currencyId: '',106 |     price: '',107 |     pricingMode: 'calculated' as const,108 |     isActive: true109 |   });110 | 111 |   const fetchPackageDefinitions = useCallback(async () => {112 |     if (!user?.access_token) return;113 | 114 |     try {115 |       const params = new URLSearchParams();116 | 117 |       Object.entries(definitionFilters).forEach(([key, value]) => {118 |         if (value && value !== 'all') params.append(key, value);119 |       });120 | 121 |       const response = await fetch(`/api/admin/package-definitions?${params}&enhanced=true`, {122 |         headers: {123 |           'Authorization': `Bearer ${user.access_token}`,124 |           'Content-Type': 'application/json'125 |         }126 |       });127 |       const data = await response.json();128 | 129 |       if (data.success) {130 |         setPackageDefinitions(data.data);131 |       } else {132 |         toast.error('Failed to fetch package definitions');133 |       }134 |     } catch {135 |       toast.error('Error fetching package definitions');136 |     }137 |   }, [user?.access_token, definitionFilters]);138 | 139 |   const fetchPackagePrices = useCallback(async () => {140 |     if (!user?.access_token) return;141 | 142 |     try {143 |       const params = new URLSearchParams();144 | 145 |       Object.entries(priceFilters).forEach(([key, value]) => {146 |         if (value && value !== 'all') params.append(key, value);147 |       });148 | 149 |       const response = await fetch(`/api/admin/package-prices?${params}`, {150 |         headers: {151 |           'Authorization': `Bearer ${user.access_token}`,152 |           'Content-Type': 'application/json'153 |         }154 |       });155 |       const data = await response.json();156 | 157 |       if (data.success) {158 |         setPackagePrices(data.data);159 |       } else {160 |         toast.error('Failed to fetch package prices');161 |       }162 |     } catch {163 |       toast.error('Error fetching package prices');164 |     }165 |   }, [user?.access_token, priceFilters]);166 | 167 |   const fetchCurrencies = useCallback(async () => {168 |     if (!user?.access_token) return;169 |     try {170 |       const response = await fetch('/api/admin/currencies', {171 |         headers: {172 |           'Authorization': `Bearer ${user.access_token}`,173 |           'Content-Type': 'application/json'174 |         }175 |       });176 |       const data = await response.json();177 | 178 |       if (data.success) {179 |         setCurrencies(data.data);180 |       }181 |     } catch {182 |       toast.error('Error fetching currencies');183 |     }184 |   }, [user?.access_token]);185 | 186 |   const fetchSessionDurations = useCallback(async () => {187 |     if (!user?.access_token) return;188 |     try {189 |       const response = await fetch('/api/admin/session-durations', {190 |         headers: {191 |           'Authorization': `Bearer ${user.access_token}`,192 |           'Content-Type': 'application/json'193 |         }194 |       });195 |       const data = await response.json();196 | 197 |       if (data.success) {198 |         setSessionDurations(data.data);199 |       }200 |     } catch {201 |       toast.error('Error fetching session durations');202 |     }203 |   }, [user?.access_token]);204 | 205 |   const fetchAllData = useCallback(async () => {206 |     try {207 |       if (!user?.access_token) {208 |         toast.error('Please log in to access this feature');209 |         return;210 |       }211 | 212 |       setLoading(true);213 |       await Promise.all([214 |         fetchCurrencies(),215 |         fetchSessionDurations(),216 |         fetchPackageDefinitions(),217 |         fetchPackagePrices()218 |       ]);219 | 220 |       setLastLoaded(new Date());221 |       toast.success('Packages data loaded successfully');222 |     } catch (error) {223 |       toast.error('Failed to load packages data');224 |     } finally {225 |       setLoading(false);226 |     }227 |   }, [user, fetchCurrencies, fetchSessionDurations, fetchPackageDefinitions, fetchPackagePrices]);228 | 229 |   const refreshPackagesData = useCallback(() => {230 |     if (user?.access_token) {231 |       fetchAllData();232 |     }233 |   }, [user?.access_token, fetchAllData]);234 | 235 |   useEffect(() => {236 |     if (user?.access_token) {237 |       fetchAllData();238 |     } else {239 |       setPackageDefinitions([]);240 |       setPackagePrices([]);241 |       setCurrencies([]);242 |       setSessionDurations([]);243 |       setLoading(false);244 |     }245 |   }, [user?.access_token, fetchAllData]);246 | 247 |   useEffect(() => {248 |     const handleVisibilityChange = () => {249 |       if (document.visibilityState === 'visible' && user?.access_token && packageDefinitions.length === 0) {250 |         fetchAllData();251 |       }252 |     };253 | 254 |     document.addEventListener('visibilitychange', handleVisibilityChange);255 |     return () => document.removeEventListener('visibilitychange', handleVisibilityChange);256 |   }, [user?.access_token, packageDefinitions.length, fetchAllData]);257 | 258 |   useEffect(() => {259 |     if (user?.access_token && packageDefinitions.length === 0) {260 |       fetchAllData();261 |     }262 |   }, [user?.access_token, packageDefinitions.length, fetchAllData]);263 | 264 |   useEffect(() => {265 | 266 |     window.refreshPackagesData = refreshPackagesData;267 | 268 |     return () => {269 | 270 |       delete window.refreshPackagesData;271 |     };272 |   }, [refreshPackagesData]);273 | 274 |   useEffect(() => {275 |     const handleNavigation = () => {276 | 277 |       setTimeout(() => {278 |         if (user?.access_token && packageDefinitions.length === 0) {279 |           fetchAllData();280 |         }281 |       }, 100);282 |     };283 | 284 |     window.addEventListener('popstate', handleNavigation);285 |     return () => window.removeEventListener('popstate', handleNavigation);286 |   }, [user?.access_token, packageDefinitions.length, fetchAllData]);287 | 288 |   const handleCreateDefinition = async () => {289 |     if (!user?.access_token) return;290 |     try {291 |       const response = await fetch('/api/admin/package-definitions', {292 |         method: 'POST',293 |         headers: {294 |           'Authorization': `Bearer ${user.access_token}`,295 |           'Content-Type': 'application/json'296 |         },297 |         body: JSON.stringify({298 |           name: definitionFormData.name,299 |           description: definitionFormData.description,300 |           sessionsCount: parseInt(definitionFormData.sessionsCount),301 |           sessionDurationId: parseInt(definitionFormData.sessionDurationId),302 |           packageType: definitionFormData.packageType,303 |           maxGroupSize: definitionFormData.maxGroupSize ? parseInt(definitionFormData.maxGroupSize) : null,304 |           isActive: definitionFormData.isActive305 |         })306 |       });307 | 308 |       const data = await response.json();309 | 310 |       if (data.success) {311 |         toast.success('Package definition created successfully');312 |         setShowCreateDefinitionModal(false);313 |         resetDefinitionForm();314 |         fetchPackageDefinitions();315 |       } else {316 |         toast.error(data.message || 'Failed to create package definition');317 |       }318 |     } catch {319 |       toast.error('Error creating package definition');320 |     }321 |   };322 | 323 |   const handleCreatePrice = async () => {324 |     if (!user?.access_token) return;325 |     try {326 |       const response = await fetch('/api/admin/package-prices', {327 |         method: 'POST',328 |         headers: {329 |           'Authorization': `Bearer ${user.access_token}`,330 |           'Content-Type': 'application/json'331 |         },332 |         body: JSON.stringify({333 |           packageDefinitionId: parseInt(priceFormData.packageDefinitionId),334 |           currencyId: parseInt(priceFormData.currencyId),335 |           price: parseFloat(priceFormData.price),336 |           pricingMode: priceFormData.pricingMode,337 |           isActive: priceFormData.isActive338 |         })339 |       });340 | 341 |       const data = await response.json();342 | 343 |       if (data.success) {344 |         toast.success('Package price created successfully');345 |         setShowCreatePriceModal(false);346 |         resetPriceForm();347 |         fetchPackagePrices();348 |       } else {349 |         toast.error(data.message || 'Failed to create package price');350 |       }351 |     } catch {352 |       toast.error('Error creating package price');353 |     }354 |   };355 | 356 |   const handleEditDefinition = async (data: unknown) => {357 |     if (!user?.access_token || !selectedItem) {358 |       return;359 |     }360 | 361 |     try {362 |       const formData = data as Record<string, unknown>;363 |       const requestBody: Record<string, unknown> = {364 |         id: selectedItem.id365 |       };366 | 367 |       const packageDef = selectedItem as PackageDefinition;368 | 369 |       if (formData.name && formData.name !== packageDef.name) {370 |         requestBody.name = formData.name;371 |       }372 |       if (formData.description !== undefined && formData.description !== packageDef.description) {373 |         requestBody.description = formData.description;374 |       }375 |       if (formData.sessionsCount) {376 |         const newSessionsCount = parseInt(formData.sessionsCount as string);377 |         if (newSessionsCount !== packageDef.sessionsCount) {378 |           requestBody.sessionsCount = newSessionsCount;379 |         }380 |       }381 |       if (formData.sessionDurationId) {382 |         const newSessionDurationId = parseInt(formData.sessionDurationId as string);383 |         if (newSessionDurationId !== packageDef.sessionDurationId) {384 |           requestBody.sessionDurationId = newSessionDurationId;385 |         }386 |       }387 |       if (formData.packageType && formData.packageType !== packageDef.packageType) {388 |         requestBody.packageType = formData.packageType;389 |       }390 |       if (formData.maxGroupSize !== undefined) {391 |         const newMaxGroupSize = formData.maxGroupSize ? parseInt(formData.maxGroupSize as string) : null;392 |         if (newMaxGroupSize !== packageDef.maxGroupSize) {393 |           requestBody.maxGroupSize = newMaxGroupSize;394 |         }395 |       }396 |       if (formData.isActive !== undefined && formData.isActive !== packageDef.isActive) {397 |         requestBody.isActive = formData.isActive;398 |       }399 | 400 |       const response = await fetch('/api/admin/package-definitions', {401 |         method: 'PUT',402 |         headers: {403 |           'Authorization': `Bearer ${user.access_token}`,404 |           'Content-Type': 'application/json'405 |         },406 |         body: JSON.stringify(requestBody)407 |       });408 | 409 |       const responseData = await response.json();410 |       if (responseData.success) {411 |         toast.success('Package definition updated successfully');412 |         setShowEditDefinitionModal(false);413 |         setSelectedItem(null);414 |         fetchPackageDefinitions();415 |       } else {416 |         toast.error(responseData.message || 'Failed to update package definition');417 |       }418 |     } catch (error) {419 |       toast.error('Error updating package definition');420 |     }421 |   };422 | 423 |   const handleEditPrice = async (data: unknown) => {424 |     if (!user?.access_token || !selectedItem || 'package_prices' in selectedItem) {425 |       :', selectedItem ? 'package_prices' in selectedItem : 'N/A');426 |       return;427 |     }428 | 429 |     try {430 |       const formData = data as Record<string, unknown>;431 |       const requestBody: Record<string, unknown> = {432 |         id: selectedItem.id433 |       };434 | 435 |       const packagePrice = selectedItem as PackagePrice;436 | 437 |       const newPackageDefinitionId = formData.packageDefinitionId ? parseInt(formData.packageDefinitionId as string) : undefined;438 |       const newCurrencyId = formData.currencyId ? parseInt(formData.currencyId as string) : undefined;439 |       const newPrice = formData.price ? parseFloat(formData.price as string) : undefined;440 | 441 |       if (newPackageDefinitionId && newPackageDefinitionId !== packagePrice.packageDefinitionId) {442 |         requestBody.packageDefinitionId = newPackageDefinitionId;443 |       }444 |       if (newCurrencyId && newCurrencyId !== packagePrice.currencyId) {445 |         requestBody.currencyId = newCurrencyId;446 |       }447 |       if (newPrice !== undefined && newPrice !== packagePrice.price) {448 |         requestBody.price = newPrice;449 |       }450 |       if (formData.pricingMode && formData.pricingMode !== packagePrice.pricingMode) {451 |         requestBody.pricingMode = formData.pricingMode;452 |       }453 |       if (formData.isActive !== undefined && formData.isActive !== packagePrice.isActive) {454 |         requestBody.isActive = formData.isActive;455 |       }456 | 457 |       const response = await fetch('/api/admin/package-prices', {458 |         method: 'PUT',459 |         headers: {460 |           'Authorization': `Bearer ${user.access_token}`,461 |           'Content-Type': 'application/json'462 |         },463 |         body: JSON.stringify(requestBody)464 |       });465 | 466 |       const responseData = await response.json();467 |       if (responseData.success) {468 |         toast.success('Package price updated successfully');469 |         setShowEditPriceModal(false);470 |         setSelectedItem(null);471 |         fetchPackagePrices();472 |       } else {473 |         toast.error(responseData.message || 'Failed to update package price');474 |       }475 |     } catch (error) {476 |       toast.error('Error updating package price');477 |     }478 |   };479 | 480 |   const handleDelete = async () => {481 |     if (!user?.access_token || !selectedItem) {482 |       return;483 |     }484 | 485 |     if (!selectedItem.id) {486 |       );487 |       toast.error('Invalid item selected for deletion');488 |       return;489 |     }490 | 491 |     try {492 |       const endpoint = deleteType === 'definition' ? 'package-definitions' : 'package-prices';493 |       const response = await fetch(`/api/admin/${endpoint}?id=${selectedItem.id}`, {494 |         method: 'DELETE',495 |         headers: {496 |           'Authorization': `Bearer ${user.access_token}`,497 |           'Content-Type': 'application/json'498 |         }499 |       });500 | 501 |       const data = await response.json();502 |       if (data.success) {503 |         toast.success(`${deleteType === 'definition' ? 'Package definition' : 'Package price'} deleted successfully`);504 |         setShowDeleteModal(false);505 |         setSelectedItem(null);506 |         if (deleteType === 'definition') {507 |           fetchPackageDefinitions();508 |         } else {509 |           fetchPackagePrices();510 |         }511 |       } else {512 | 513 |         if (data.message?.includes('active user packages')) {514 |           if (deleteType === 'definition') {515 |             toast.error('Cannot delete package definition with active user packages. Click "Edit" to deactivate it instead.', {516 |               duration: 6000,517 |               action: {518 |                 label: 'Edit Instead',519 |                 onClick: () => {520 |                   setShowDeleteModal(false);521 |                   setShowEditDefinitionModal(true);522 |                 }523 |               }524 |             });525 |           } else {526 |             toast.error('Cannot delete package price with active user packages. Click "Edit" to deactivate it instead.', {527 |               duration: 6000,528 |               action: {529 |                 label: 'Edit Instead',530 |                 onClick: () => {531 |                   setShowDeleteModal(false);532 |                   setShowEditPriceModal(true);533 |                 }534 |               }535 |             });536 |           }537 |         } else {538 |           toast.error(data.message || `Failed to delete ${deleteType}`);539 |         }540 |       }541 |     } catch (error) {542 |       toast.error(`Error deleting ${deleteType}`);543 |     }544 |   };545 | 546 |   const togglePackageStatus = async (packageId: number, isActive: boolean) => {547 |     if (!user?.access_token) return;548 | 549 |     try {550 |       const response = await fetch('/api/admin/package-definitions', {551 |         method: 'PUT',552 |         headers: {553 |           'Authorization': `Bearer ${user.access_token}`,554 |           'Content-Type': 'application/json'555 |         },556 |         body: JSON.stringify({557 |           id: packageId,558 |           isActive: isActive559 |         })560 |       });561 | 562 |       const data = await response.json();563 | 564 |       if (data.success) {565 |         toast.success(`Package ${isActive ? 'activated' : 'deactivated'} successfully`);566 |         fetchPackageDefinitions();567 |       } else {568 |         toast.error(data.message || 'Failed to update package status');569 |       }570 |     } catch {571 |       toast.error('Error updating package status');572 |     }573 |   };574 | 575 |   const togglePriceStatus = async (priceId: number, isActive: boolean) => {576 |     if (!user?.access_token) return;577 | 578 |     try {579 |       const response = await fetch('/api/admin/package-prices', {580 |         method: 'PUT',581 |         headers: {582 |           'Authorization': `Bearer ${user.access_token}`,583 |           'Content-Type': 'application/json'584 |         },585 |         body: JSON.stringify({586 |           id: priceId,587 |           isActive: isActive588 |         })589 |       });590 | 591 |       const data = await response.json();592 | 593 |       if (data.success) {594 |         toast.success(`Price ${isActive ? 'activated' : 'deactivated'} successfully`);595 |         fetchPackagePrices();596 |       } else {597 |         toast.error(data.message || 'Failed to update price status');598 |       }599 |     } catch {600 |       toast.error('Error updating price status');601 |     }602 |   };603 | 604 |   const resetDefinitionForm = () => {605 |     setDefinitionFormData({606 |       name: '',607 |       description: '',608 |       sessionsCount: '',609 |       sessionDurationId: '',610 |       packageType: 'individual',611 |       maxGroupSize: '',612 |       isActive: true613 |     });614 |   };615 | 616 |   const resetPriceForm = () => {617 |     setPriceFormData({618 |       packageDefinitionId: '',619 |       currencyId: '',620 |       price: '',621 |       pricingMode: 'calculated',622 |       isActive: true623 |     });624 |   };625 | 626 |   const getPackageTypeBadge = (type: string) => {627 |     const variants = {628 |       individual: 'dashboard-badge-info',629 |       group: 'dashboard-badge-success',630 |       mixed: 'dashboard-badge-warning'631 |     };632 |     return <Badge className={variants[type as keyof typeof variants]}>{type}</Badge>;633 |   };634 | 635 |   const getPricingModeBadge = (mode: string) => {636 |     const variants = {637 |       custom: 'dashboard-badge-gold',638 |       calculated: 'dashboard-badge-info'639 |     };640 |     return <Badge className={variants[mode as keyof typeof variants]}>{mode}</Badge>;641 |   };642 | 643 |   if (loading) {644 |     return (645 |       <div className="flex items-center justify-center min-h-[400px]">646 |         <div className="text-center">647 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>648 |           <p className="text-[#FFD700] text-lg font-semibold">Loading packages and pricing...</p>649 |         </div>650 |       </div>651 |     );652 |   }653 | 654 |   return (655 |     <div className="dashboard-container p-6 space-y-6">656 |       <div className="flex items-center justify-between">657 |         <div>658 |           <h1 className="dashboard-text-primary text-3xl font-bold">Packages & Pricing</h1>659 |           <p className="dashboard-text-secondary">Manage package definitions and multi-currency pricing</p>660 |           {lastLoaded && (661 |             <p className="text-sm text-gray-400 mt-1">662 |               Last updated: {lastLoaded.toLocaleTimeString()}663 |             </p>664 |           )}665 |         </div>666 |         <div className="flex gap-2">667 |           <BaseButton668 |             variant="outline"669 |             className="dashboard-button-outline"670 |             onClick={refreshPackagesData}671 |             disabled={loading}672 |           >673 |             <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />674 |             Refresh675 |           </BaseButton>676 |           <BaseButton677 |             className="dashboard-button-primary"678 |             onClick={() => setShowCreateDefinitionModal(true)}679 |           >680 |             <Plus className="w-4 h-4 mr-2" />681 |             New Package682 |           </BaseButton>683 |           <BaseButton684 |             variant="outline"685 |             className="dashboard-button-outline"686 |             onClick={() => setShowCreatePriceModal(true)}687 |           >688 |             <DollarSign className="w-4 h-4 mr-2" />689 |             New Price690 |           </BaseButton>691 |         </div>692 |       </div>693 | 694 |       <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">695 |         <TabsList className="dashboard-tabs">696 |           <TabsTrigger value="definitions" className="dashboard-tab">697 |             <Package className="w-4 h-4 mr-2" />698 |             Package Definitions699 |           </TabsTrigger>700 |           <TabsTrigger value="pricing" className="dashboard-tab">701 |             <DollarSign className="w-4 h-4 mr-2" />702 |             Package Pricing703 |           </TabsTrigger>704 |         </TabsList>705 | 706 |         <TabsContent value="definitions" className="space-y-4">707 |           {}708 |           <Card className="dashboard-card">709 |             <CardHeader>710 |               <CardTitle className="dashboard-card-title">Package Definitions</CardTitle>711 |               <CardDescription className="dashboard-card-description">712 |                 Core package configurations and settings713 |               </CardDescription>714 |             </CardHeader>715 |             <CardContent>716 |               {}717 |               <div className="flex gap-4 mb-6">718 |                 <div className="flex-1">719 |                   <Label className="dashboard-label">Package Type</Label>720 |                   <Select721 |                     value={definitionFilters.packageType}722 |                     onValueChange={(value) => setDefinitionFilters(prev => ({ ...prev, packageType: value }))}723 |                   >724 |                     <SelectTrigger className="dashboard-select">725 |                       <SelectValue />726 |                     </SelectTrigger>727 |                     <SelectContent className="dashboard-dropdown-content">728 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Types</SelectItem>729 |                       <SelectItem value="individual" className="dashboard-dropdown-item">Individual</SelectItem>730 |                       <SelectItem value="group" className="dashboard-dropdown-item">Group</SelectItem>731 |                       <SelectItem value="mixed" className="dashboard-dropdown-item">Mixed</SelectItem>732 |                     </SelectContent>733 |                   </Select>734 |                 </div>735 |                 <div className="flex-1">736 |                   <Label className="dashboard-label">Session Duration</Label>737 |                   <Select738 |                     value={definitionFilters.sessionDurationId}739 |                     onValueChange={(value) => setDefinitionFilters(prev => ({ ...prev, sessionDurationId: value }))}740 |                   >741 |                     <SelectTrigger className="dashboard-select">742 |                       <SelectValue />743 |                     </SelectTrigger>744 |                     <SelectContent className="dashboard-dropdown-content">745 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Durations</SelectItem>746 |                       {sessionDurations.map((duration) => (747 |                         <SelectItem key={duration.id} value={duration.id.toString()} className="dashboard-dropdown-item">748 |                           {duration.name}749 |                         </SelectItem>750 |                       ))}751 |                     </SelectContent>752 |                   </Select>753 |                 </div>754 |                 <div className="flex-1">755 |                   <Label className="dashboard-label">Status</Label>756 |                   <Select757 |                     value={definitionFilters.isActive}758 |                     onValueChange={(value) => setDefinitionFilters(prev => ({ ...prev, isActive: value }))}759 |                   >760 |                     <SelectTrigger className="dashboard-select">761 |                       <SelectValue />762 |                     </SelectTrigger>763 |                     <SelectContent className="dashboard-dropdown-content">764 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Status</SelectItem>765 |                       <SelectItem value="true" className="dashboard-dropdown-item">Active</SelectItem>766 |                       <SelectItem value="false" className="dashboard-dropdown-item">Inactive</SelectItem>767 |                     </SelectContent>768 |                   </Select>769 |                 </div>770 |                 <BaseButton771 |                   variant="outline"772 |                   className="dashboard-button-outline"773 |                   onClick={fetchPackageDefinitions}774 |                 >775 |                   <Filter className="w-4 h-4 mr-2" />776 |                   Apply Filters777 |                 </BaseButton>778 |               </div>779 | 780 |               {}781 |               <div className="overflow-x-auto">782 |                 <table className="dashboard-table">783 |                   <thead className="dashboard-table-header">784 |                     <tr>785 |                       <th>Name</th>786 |                       <th>Type</th>787 |                       <th>Sessions</th>788 |                       <th>Duration</th>789 |                       <th>Group Size</th>790 |                       <th>Prices</th>791 |                       <th>Status</th>792 |                       <th>Actions</th>793 |                     </tr>794 |                   </thead>795 |                   <tbody>796 |                     {packageDefinitions.map((pkg) => (797 |                       <tr key={pkg.id} className="dashboard-table-row">798 |                         <td className="font-medium">{pkg.name}</td>799 |                         <td>{getPackageTypeBadge(pkg.packageType)}</td>800 |                         <td>{pkg.sessionsCount}</td>801 |                         <td>{pkg.sessionDuration?.name || 'N/A'}</td>802 |                         <td>{pkg.maxGroupSize || '-'}</td>803 |                         <td>804 |                           <div className="space-y-1">805 |                             {pkg.packagePrices && pkg.packagePrices.filter(p => p.isActive).length > 0 ? (806 |                               pkg.packagePrices807 |                                 .filter(p => p.isActive)808 |                                 .slice(0, 3)809 |                                 .map((price, index) => (810 |                                 <div key={index} className="text-sm">811 |                                   <span className="font-mono">812 |                                     {price.currency?.symbol || ''}813 |                                     {typeof price.price === 'number' && !isNaN(price.price)814 |                                       ? price.price.toFixed(2)815 |                                       : price.price || 'N/A'816 |                                     }817 |                                   </span>818 |                                   <span className="text-dashboard-text-secondary ml-1">819 |                                     {price.currency?.code || 'N/A'}820 |                                   </span>821 |                                 </div>822 |                               ))823 |                             ) : (824 |                               <span className="text-dashboard-text-secondary text-sm">No prices</span>825 |                             )}826 |                             {pkg.packagePrices && pkg.packagePrices.filter(p => p.isActive).length > 3 && (827 |                               <div className="text-xs text-dashboard-text-secondary">828 |                                 +{pkg.packagePrices.filter(p => p.isActive).length - 3} more829 |                               </div>830 |                             )}831 |                           </div>832 |                         </td>833 |                         <td>834 |                           <Badge className={pkg.isActive ? 'dashboard-badge-success' : 'dashboard-badge-error'}>835 |                             {pkg.isActive ? 'Active' : 'Inactive'}836 |                           </Badge>837 |                         </td>838 |                         <td>839 |                           <div className="flex gap-2">840 |                             <BaseButton841 |                               size="sm"842 |                               variant="outline"843 |                               className={pkg.isActive ? "dashboard-button-warning" : "dashboard-button-success"}844 |                               onClick={() => togglePackageStatus(pkg.id, !pkg.isActive)}845 |                             >846 |                               {pkg.isActive ? 'Deactivate' : 'Activate'}847 |                             </BaseButton>848 |                             <BaseButton849 |                               size="sm"850 |                               variant="outline"851 |                               className="dashboard-button-outline"852 |                               onClick={() => {853 |                                 setSelectedItem(pkg);854 |                                 setShowEditDefinitionModal(true);855 |                               }}856 |                             >857 |                               <Edit className="w-4 h-4" />858 |                             </BaseButton>859 |                             <BaseButton860 |                               size="sm"861 |                               variant="outline"862 |                               className="dashboard-button-danger"863 |                               onClick={() => {864 |                                 setSelectedItem(pkg);865 |                                 setDeleteType('definition');866 |                                 setShowDeleteModal(true);867 |                               }}868 |                             >869 |                               <Trash2 className="w-4 h-4" />870 |                             </BaseButton>871 |                           </div>872 |                         </td>873 |                       </tr>874 |                     ))}875 |                   </tbody>876 |                 </table>877 |               </div>878 |             </CardContent>879 |           </Card>880 |         </TabsContent>881 | 882 |         <TabsContent value="pricing" className="space-y-4">883 |           {}884 |           <Card className="dashboard-card">885 |             <CardHeader>886 |               <CardTitle className="dashboard-card-title">Package Pricing</CardTitle>887 |               <CardDescription className="dashboard-card-description">888 |                 Multi-currency pricing with custom and calculated modes889 |               </CardDescription>890 |             </CardHeader>891 |             <CardContent>892 |               {}893 |               <div className="flex gap-4 mb-6">894 |                 <div className="flex-1">895 |                   <Label className="dashboard-label">Package</Label>896 |                   <Select897 |                     value={priceFilters.packageDefinitionId}898 |                     onValueChange={(value) => setPriceFilters(prev => ({ ...prev, packageDefinitionId: value }))}899 |                   >900 |                     <SelectTrigger className="dashboard-select">901 |                       <SelectValue />902 |                     </SelectTrigger>903 |                     <SelectContent className="dashboard-dropdown-content">904 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Packages</SelectItem>905 |                       {packageDefinitions.map((pkg) => (906 |                         <SelectItem key={pkg.id} value={pkg.id.toString()} className="dashboard-dropdown-item">907 |                           {pkg.name}908 |                         </SelectItem>909 |                       ))}910 |                     </SelectContent>911 |                   </Select>912 |                 </div>913 |                 <div className="flex-1">914 |                   <Label className="dashboard-label">Currency</Label>915 |                   <Select916 |                     value={priceFilters.currencyId}917 |                     onValueChange={(value) => setPriceFilters(prev => ({ ...prev, currencyId: value }))}918 |                   >919 |                     <SelectTrigger className="dashboard-select">920 |                       <SelectValue />921 |                     </SelectTrigger>922 |                     <SelectContent className="dashboard-dropdown-content">923 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Currencies</SelectItem>924 |                       {currencies.map((currency) => (925 |                         <SelectItem key={currency.id} value={currency.id.toString()} className="dashboard-dropdown-item">926 |                           {currency.code} - {currency.name}927 |                         </SelectItem>928 |                       ))}929 |                     </SelectContent>930 |                   </Select>931 |                 </div>932 |                 <div className="flex-1">933 |                   <Label className="dashboard-label">Pricing Mode</Label>934 |                   <Select935 |                     value={priceFilters.pricingMode}936 |                     onValueChange={(value) => setPriceFilters(prev => ({ ...prev, pricingMode: value }))}937 |                   >938 |                     <SelectTrigger className="dashboard-select">939 |                       <SelectValue />940 |                     </SelectTrigger>941 |                     <SelectContent className="dashboard-dropdown-content">942 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Modes</SelectItem>943 |                       <SelectItem value="custom" className="dashboard-dropdown-item">Custom</SelectItem>944 |                       <SelectItem value="calculated" className="dashboard-dropdown-item">Calculated</SelectItem>945 |                     </SelectContent>946 |                   </Select>947 |                 </div>948 |                 <BaseButton949 |                   variant="outline"950 |                   className="dashboard-button-outline"951 |                   onClick={fetchPackagePrices}952 |                 >953 |                   <Filter className="w-4 h-4 mr-2" />954 |                   Apply Filters955 |                 </BaseButton>956 |               </div>957 | 958 |               {}959 |               <div className="overflow-x-auto">960 |                 <table className="dashboard-table">961 |                   <thead className="dashboard-table-header">962 |                     <tr>963 |                       <th>Package</th>964 |                       <th>Currency</th>965 |                       <th>Price</th>966 |                       <th>Mode</th>967 |                       <th>Status</th>968 |                       <th>Actions</th>969 |                     </tr>970 |                   </thead>971 |                   <tbody>972 |                     {packagePrices.map((price) => (973 |                       <tr key={price.id} className="dashboard-table-row">974 |                         <td className="font-medium">{price.packageDefinition?.name || 'N/A'}</td>975 |                         <td>976 |                           <Badge className="dashboard-badge">977 |                             {price.currency?.code || 'N/A'} {price.currency?.symbol || ''}978 |                           </Badge>979 |                         </td>980 |                         <td className="font-mono">981 |                           {price.currency?.symbol || ''}982 |                           {typeof price.price === 'number' && !isNaN(price.price)983 |                             ? price.price.toFixed(2)984 |                             : <span className="text-red-400 text-xs" title={`Raw value: ${price.price}`}>985 |                                 {price.price !== undefined && price.price !== null ? String(price.price) : 'N/A'}986 |                               </span>987 |                           }988 |                         </td>989 |                         <td>{getPricingModeBadge(price.pricingMode)}</td>990 |                         <td>991 |                           <Badge className={price.isActive ? 'dashboard-badge-success' : 'dashboard-badge-error'}>992 |                             {price.isActive ? 'Active' : 'Inactive'}993 |                           </Badge>994 |                         </td>995 |                         <td>996 |                           <div className="flex gap-2">997 |                             <BaseButton998 |                               size="sm"999 |                               variant="outline"1000 |                               className={price.isActive ? "dashboard-button-warning" : "dashboard-button-success"}1001 |                               onClick={() => togglePriceStatus(price.id, !price.isActive)}1002 |                             >1003 |                               {price.isActive ? 'Deactivate' : 'Activate'}1004 |                             </BaseButton>1005 |                             <BaseButton1006 |                               size="sm"1007 |                               variant="outline"1008 |                               className="dashboard-button-outline"1009 |                               onClick={() => {1010 |                                 setSelectedItem(price);1011 |                                 setShowEditPriceModal(true);1012 |                               }}1013 |                             >1014 |                               <Edit className="w-4 h-4" />1015 |                             </BaseButton>1016 |                             <BaseButton1017 |                               size="sm"1018 |                               variant="outline"1019 |                               className="dashboard-button-danger"1020 |                               onClick={() => {1021 |                                 setSelectedItem(price);1022 |                                 setDeleteType('price');1023 |                                 setShowDeleteModal(true);1024 |                               }}1025 |                             >1026 |                               <Trash2 className="w-4 h-4" />1027 |                             </BaseButton>1028 |                           </div>1029 |                         </td>1030 |                       </tr>1031 |                     ))}1032 |                   </tbody>1033 |                 </table>1034 |               </div>1035 |             </CardContent>1036 |           </Card>1037 |         </TabsContent>1038 |       </Tabs>1039 | 1040 |       {}1041 |       <PackageDefinitionModal1042 |         isOpen={showCreateDefinitionModal}1043 |         onClose={() => setShowCreateDefinitionModal(false)}1044 |         onSubmit={handleCreateDefinition}1045 |         sessionDurations={sessionDurations}1046 |         mode="create"1047 |       />1048 | 1049 |       <PackageDefinitionModal1050 |         isOpen={showEditDefinitionModal}1051 |         onClose={() => setShowEditDefinitionModal(false)}1052 |         onSubmit={handleEditDefinition}1053 |         packageDefinition={selectedItem && !('package_prices' in selectedItem) ? selectedItem as unknown as PackageDefinition : null}1054 |         sessionDurations={sessionDurations}1055 |         mode="edit"1056 |       />1057 | 1058 |       <PackagePriceModal1059 |         isOpen={showCreatePriceModal}1060 |         onClose={() => setShowCreatePriceModal(false)}1061 |         onSubmit={handleCreatePrice}1062 |         packageDefinitions={packageDefinitions}1063 |         currencies={currencies}1064 |         mode="create"1065 |       />1066 | 1067 |       <PackagePriceModal1068 |         isOpen={showEditPriceModal}1069 |         onClose={() => setShowEditPriceModal(false)}1070 |         onSubmit={handleEditPrice}1071 |         packagePrice={selectedItem && !('package_prices' in selectedItem) ? selectedItem as unknown as PackagePrice : null}1072 |         packageDefinitions={packageDefinitions}1073 |         currencies={currencies}1074 |         mode="edit"1075 |       />1076 | 1077 |       <DeleteConfirmationModal1078 |         isOpen={showDeleteModal}1079 |         onClose={() => setShowDeleteModal(false)}1080 |         onConfirm={handleDelete}1081 |         title={`Delete ${deleteType === 'definition' ? 'Package Definition' : 'Package Price'}`}1082 |         description={1083 |           deleteType === 'definition'1084 |             ? 'Are you sure you want to delete this package definition? Note: This action will fail if there are active user packages associated with it. Consider deactivating it instead.'1085 |             : 'Are you sure you want to delete this package price? Note: This action will fail if there are active user packages associated with it.'1086 |         }1087 |         itemName={selectedItem ? ('packagePrices' in selectedItem ? (selectedItem as unknown as PackagePrice).packageDefinition?.name || 'N/A' : (selectedItem as unknown as PackageDefinition).name) : undefined}1088 |         itemType={deleteType}1089 |       />1090 |     </div>1091 |   );1092 | };1093 | 1094 | export default PackagesAndPricing;
============================================================END: frontend/components/PackagesAndPricing.tsx============================================================


============================================================FILE: frontend/components/PaymentMethodManagement.tsxSIZE: 28.89 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { Label } from '@/components/ui/label';  8 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  9 | import { Switch } from '@/components/ui/switch'; 10 | import { Textarea } from '@/components/ui/textarea'; 11 | import { Badge } from '@/components/ui/badge'; 12 | import { Plus, Edit, Trash2, Save, X, CreditCard, Wallet, Banknote, QrCode, Bitcoin, Clock, Zap, RefreshCw, Eye, EyeOff } from 'lucide-react'; 13 | import { toast } from 'sonner'; 14 | import { PaymentMethodConfig, PaymentMethod } from '@/lib/types'; 15 | import { useAuth } from '../hooks/useAuth'; 16 | import StripeConfigModal from './modals/StripeConfigModal'; 17 |  18 | interface IzipayConfig { 19 |   username: string; 20 |   password?: string; 21 |   publicKey: string; 22 |   hmacKey?: string; 23 |   environment: 'TEST' | 'PRODUCTION'; 24 | } 25 |  26 | interface PaymentMethodFormData { 27 |   name: string; 28 |   type: PaymentMethod; 29 |   description: string; 30 |   icon: string; 31 |   requiresConfirmation: boolean; 32 |   autoAssignPackage: boolean; 33 |   izipayConfig?: IzipayConfig; 34 | } 35 |  36 | interface StripeConfig { 37 |   publishableKey: string; 38 |   secretKey: string; 39 |   webhookSecret: string; 40 |   currency: string; 41 |   supportedCountries: string[]; 42 |   automaticTaxes: boolean; 43 |   allowPromotionCodes: boolean; 44 | } 45 |  46 | interface StripeConfigData { 47 |   publishableKey: string; 48 |   secretKey: string; 49 |   webhookSecret: string; 50 |   mode: 'test' | 'live'; 51 | } 52 |  53 | const PaymentMethodManagement: React.FC = () => { 54 |   const { user, isLoading: authLoading } = useAuth(); 55 |   const [paymentMethods, setPaymentMethods] = useState<PaymentMethodConfig[]>([]); 56 |   const [loading, setLoading] = useState(true); 57 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null); 58 |   const [showCreateModal, setShowCreateModal] = useState(false); 59 |   const [showStripeConfig, setShowStripeConfig] = useState(false); 60 |   const [editingMethod, setEditingMethod] = useState<PaymentMethodConfig | null>(null); 61 |   const [stripeConfig, setStripeConfig] = useState<StripeConfig | StripeConfigData | null>(null); 62 |   const [showSecrets, setShowSecrets] = useState({ password: false, hmacKey: false }); 63 |  64 |   const [formData, setFormData] = useState<PaymentMethodFormData>({ 65 |     name: '', 66 |     type: 'cash', 67 |     description: '', 68 |     icon: '', 69 |     requiresConfirmation: false, 70 |     autoAssignPackage: true, 71 |     izipayConfig: { 72 |       username: '', 73 |       password: '', 74 |       publicKey: '', 75 |       hmacKey: '', 76 |       environment: 'TEST', 77 |     }, 78 |   }); 79 |  80 |   const fetchPaymentMethods = useCallback(async () => { 81 |     try { 82 |       const authToken = user?.access_token; 83 |       if (!authToken) { 84 |         return; 85 |       } 86 |  87 |       const response = await fetch('/api/admin/payment-methods', { 88 |         headers: { 89 |           'Authorization': `Bearer ${authToken}`, 90 |           'Content-Type': 'application/json' 91 |         } 92 |       }); 93 |  94 |       if (!response.ok) { 95 |         const errorText = await response.text(); 96 |         throw new Error('Failed to fetch payment methods'); 97 |       } 98 |  99 |       const result = await response.json();100 |       setPaymentMethods(result.data || []);101 |     } catch (error) {102 |       toast.error('Failed to fetch payment methods');103 |     }104 |   }, [user?.access_token]);105 | 106 |   const fetchAllData = useCallback(async () => {107 |     try {108 |       if (authLoading) {109 |         return;110 |       }111 |       if (!user?.access_token) {112 |         return;113 |       }114 | 115 |       setLoading(true);116 |       await fetchPaymentMethods();117 | 118 |       setLastLoaded(new Date());119 |       } catch (error) {120 |       } finally {121 |       setLoading(false);122 |     }123 |   }, [user, authLoading, fetchPaymentMethods]);124 | 125 |   const refreshPaymentMethodsData = useCallback(() => {126 |     if (user?.access_token) {127 |       fetchAllData();128 |     }129 |   }, [user?.access_token, fetchAllData]);130 | 131 |   useEffect(() => {132 |     if (authLoading) {133 |       return;134 |     }135 |     if (user?.access_token) {136 |       fetchAllData();137 |     } else {138 |       ');139 |       setLoading(false);140 |     }141 |   }, [user?.access_token, authLoading, fetchAllData]);142 | 143 |   useEffect(() => {144 |     const handleVisibilityChange = () => {145 |       if (document.visibilityState === 'visible' && !authLoading && user?.access_token && paymentMethods.length === 0) {146 |         fetchAllData();147 |       }148 |     };149 | 150 |     document.addEventListener('visibilitychange', handleVisibilityChange);151 |     return () => document.removeEventListener('visibilitychange', handleVisibilityChange);152 |   }, [user?.access_token, authLoading, paymentMethods.length, fetchAllData]);153 | 154 |   useEffect(() => {155 |     if (user?.access_token && paymentMethods.length === 0) {156 |       fetchAllData();157 |     }158 |   }, [user?.access_token, paymentMethods.length, fetchAllData]);159 | 160 |   useEffect(() => {161 | 162 |     window.refreshPaymentMethodsData = refreshPaymentMethodsData;163 | 164 |     return () => {165 | 166 |       delete window.refreshPaymentMethodsData;167 |     };168 |   }, [refreshPaymentMethodsData]);169 | 170 |   useEffect(() => {171 |     const handleNavigation = () => {172 | 173 |       setTimeout(() => {174 |         if (!authLoading && user?.access_token && paymentMethods.length === 0) {175 |           fetchAllData();176 |         }177 |       }, 100);178 |     };179 | 180 |     window.addEventListener('popstate', handleNavigation);181 |     return () => window.removeEventListener('popstate', handleNavigation);182 |   }, [user?.access_token, authLoading, paymentMethods.length, fetchAllData]);183 | 184 |   const handleSubmit = async (e: React.FormEvent) => {185 |     e.preventDefault();186 |     if (formData.type === 'izipay' && (!formData.izipayConfig?.username || !formData.izipayConfig?.publicKey)) {187 |       toast.error('Izipay username and public key are required.');188 |       return;189 |     }190 | 191 |     try {192 |       const authToken = user?.access_token;193 |       if (!authToken) {194 |         toast.error('Authentication required');195 |         return;196 |       }197 |       const url = editingMethod ? '/api/admin/payment-methods' : '/api/admin/payment-methods';198 |       const method = editingMethod ? 'PUT' : 'POST';199 | 200 |       let providerConfig = {};201 |       if (formData.type === 'stripe') {202 |         providerConfig = { stripeConfig };203 |       } else if (formData.type === 'izipay') {204 |         providerConfig = { izipayConfig: formData.izipayConfig };205 |       }206 | 207 |       const body = {208 |         ...(editingMethod && { id: editingMethod.id }),209 |         ...formData,210 |         providerConfig211 |       };212 | 213 |       const response = await fetch(url, {214 |         method,215 |         headers: { 'Authorization': `Bearer ${authToken}`, 'Content-Type': 'application/json' },216 |         body: JSON.stringify(body)217 |       });218 |       if (!response.ok) throw new Error('Failed to save payment method');219 |       toast.success(editingMethod ? 'Payment method updated' : 'Payment method created');220 |       setShowCreateModal(false);221 |       setEditingMethod(null);222 |       resetForm();223 |       fetchPaymentMethods();224 |     } catch {225 |       toast.error('Failed to save payment method');226 |     }227 |   };228 | 229 |   const handleEdit = (method: PaymentMethodConfig) => {230 |     setEditingMethod(method);231 |     setFormData({232 |       name: method.name,233 |       type: method.type,234 |       description: method.description || '',235 |       icon: method.icon || '',236 |       requiresConfirmation: method.requiresConfirmation,237 |       autoAssignPackage: method.autoAssignPackage,238 |       izipayConfig: method.izipayConfig || {239 |         username: '', password: '', publicKey: '', hmacKey: '', environment: 'TEST',240 |       },241 |     });242 |     setStripeConfig(method.stripeConfig || null);243 |     setShowCreateModal(true);244 |   };245 | 246 |   const handleDelete = async (id: number) => {247 |     if (!confirm('Are you sure you want to delete this payment method?')) return;248 | 249 |     try {250 |       const authToken = user?.access_token;251 |       if (!authToken) {252 |         toast.error('Authentication required');253 |         return;254 |       }255 | 256 |       const response = await fetch(`/api/admin/payment-methods?id=${id}`, {257 |         method: 'DELETE',258 |         headers: {259 |           'Authorization': `Bearer ${authToken}`,260 |           'Content-Type': 'application/json'261 |         }262 |       });263 | 264 |       if (!response.ok) throw new Error('Failed to delete payment method');265 | 266 |       toast.success('Payment method deleted');267 |       fetchPaymentMethods();268 |     } catch (error) {269 |       toast.error('Failed to delete payment method');270 |     }271 |   };272 | 273 |   const resetForm = () => {274 |     setFormData({275 |       name: '', type: 'cash', description: '', icon: '',276 |       requiresConfirmation: false, autoAssignPackage: true,277 |       izipayConfig: {278 |         username: '', password: '', publicKey: '', hmacKey: '', environment: 'TEST',279 |       },280 |     });281 |     setStripeConfig(null);282 |   };283 | 284 |   const handleStripeConfigSave = (config: StripeConfig) => {285 |     setStripeConfig(config);286 |     setShowStripeConfig(false);287 |   };288 | 289 |   const handleTypeChange = (type: PaymentMethod) => {290 |     setFormData(prev => ({ ...prev, type }));291 |     if (type !== 'stripe') setStripeConfig(null);292 |   };293 | 294 |   const getMethodIcon = (type: PaymentMethod) => {295 |     switch (type) {296 |       case 'cash': return <Banknote className="h-4 w-4" />;297 |       case 'bank_transfer': return <CreditCard className="h-4 w-4" />;298 |       case 'qr_payment': return <QrCode className="h-4 w-4" />;299 |       case 'credit_card': return <CreditCard className="h-4 w-4" />;300 |       case 'stripe': return <Zap className="h-4 w-4" />;301 |       case 'izipay': return <CreditCard className="h-4 w-4" />;302 |       case 'crypto': return <Bitcoin className="h-4 w-4" />;303 |       case 'pay_later': return <Clock className="h-4 w-4" />;304 |       default: return <Wallet className="h-4 w-4" />;305 |     }306 |   };307 | 308 |   const getMethodTypeLabel = (type: PaymentMethod) => {309 |     switch (type) {310 |       case 'cash': return 'Cash';311 |       case 'bank_transfer': return 'Bank Transfer';312 |       case 'qr_payment': return 'QR Payment';313 |       case 'credit_card': return 'Credit Card';314 |       case 'stripe': return 'Stripe (Credit Card)';315 |       case 'izipay': return 'Izipay (JS Client)';316 |       case 'crypto': return 'Cryptocurrency';317 |       case 'pay_later': return 'Pay Later';318 |       default: return type;319 |     }320 |   };321 | 322 |   if (loading || authLoading) {323 |     return (324 |       <div className="flex items-center justify-center min-h-[400px]">325 |         <div className="text-center">326 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>327 |           <p className="text-[#FFD700] text-lg font-semibold">Loading payment methods...</p>328 |         </div>329 |       </div>330 |     );331 |   }332 | 333 |   if (!user?.access_token) {334 |     return (335 |       <div className="dashboard-container p-6">336 |         <div className="dashboard-loading">337 |           <div className="dashboard-loading-spinner">Authentication required...</div>338 |         </div>339 |       </div>340 |     );341 |   }342 | 343 |   return (344 |     <div className="dashboard-container p-6 space-y-6">345 |       {}346 |       <div className="flex items-center justify-between">347 |         <div>348 |           <h2 className="dashboard-text-primary text-3xl font-bold tracking-tight">349 |             Payment Methods350 |           </h2>351 |           <p className="dashboard-text-secondary">352 |             Configure payment methods and their behavior for package purchases and bookings353 |           </p>354 |           {lastLoaded && (355 |             <p className="text-sm text-gray-400 mt-1">356 |               Last updated: {lastLoaded.toLocaleTimeString()}357 |             </p>358 |           )}359 |         </div>360 |         <div className="flex gap-2">361 |           <BaseButton362 |             onClick={refreshPaymentMethodsData}363 |             disabled={loading}364 |             variant="outline"365 |             className="dashboard-button-outline"366 |           >367 |             <RefreshCw className={`mr-2 h-4 w-4 ${loading ? 'animate-spin' : ''}`} />368 |             Refresh369 |           </BaseButton>370 |           <BaseButton371 |             onClick={() => setShowCreateModal(true)}372 |             className="dashboard-button-primary"373 |           >374 |             <Plus className="mr-2 h-4 w-4" />375 |             Add Payment Method376 |           </BaseButton>377 |         </div>378 |       </div>379 | 380 |       {}381 |       <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">382 |         {paymentMethods.filter(method => method).map((method) => (383 |           <Card key={method.id} className="dashboard-card">384 |             <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">385 |               <div className="flex items-center gap-2">386 |                 {getMethodIcon(method?.type || 'custom')}387 |                 <CardTitle className="dashboard-card-title">{method?.name || 'Unnamed Method'}</CardTitle>388 |               </div>389 |               <Badge390 |                 variant={method?.isActive ? 'default' : 'secondary'}391 |                 className="dashboard-badge"392 |               >393 |                 {method?.isActive ? 'Active' : 'Inactive'}394 |               </Badge>395 |             </CardHeader>396 |             <CardContent className="space-y-3">397 |               <div className="flex items-center justify-between">398 |                 <span className="dashboard-text-secondary text-sm">Type:</span>399 |                 <Badge variant="outline" className="dashboard-badge">400 |                   {getMethodTypeLabel(method?.type || 'custom')}401 |                 </Badge>402 |               </div>403 | 404 |               {method?.description && (405 |                 <p className="dashboard-text-secondary text-sm">{method.description}</p>406 |               )}407 | 408 |               {method?.type === 'stripe' && method?.stripeConfig && (409 |                 <div className="flex items-center gap-2 text-sm text-blue-600">410 |                   <Zap className="w-4 h-4" />411 |                   <span>Stripe configured</span>412 |                 </div>413 |               )}414 | 415 |               <div className="flex items-center justify-between">416 |                 <span className="dashboard-text-secondary text-sm">Requires Confirmation:</span>417 |                 <Switch checked={method?.requiresConfirmation || false} disabled />418 |               </div>419 | 420 |               <div className="flex items-center justify-between">421 |                 <span className="dashboard-text-secondary text-sm">Auto-assign Package:</span>422 |                 <Switch checked={method?.autoAssignPackage || false} disabled />423 |               </div>424 | 425 |               <div className="flex gap-2 pt-2">426 |                 <BaseButton427 |                   size="sm"428 |                   onClick={() => handleEdit(method)}429 |                   className="dashboard-button-outline"430 |                 >431 |                   <Edit className="mr-2 h-4 w-4" />432 |                   Edit433 |                 </BaseButton>434 |                 <BaseButton435 |                   size="sm"436 |                   onClick={() => handleDelete(method?.id || 0)}437 |                   className="dashboard-button-danger"438 |                 >439 |                   <Trash2 className="mr-2 h-4 w-4" />440 |                   Delete441 |                 </BaseButton>442 |               </div>443 |             </CardContent>444 |           </Card>445 |         ))}446 |       </div>447 | 448 |       {}449 |       {showCreateModal && (450 |         <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">451 |           <Card className="dashboard-card w-full max-w-md mx-4">452 |             <CardHeader>453 |               <CardTitle className="dashboard-card-title">454 |                 {editingMethod ? 'Edit Payment Method' : 'Add Payment Method'}455 |               </CardTitle>456 |               <CardDescription className="dashboard-card-description">457 |                 Configure payment method settings and behavior458 |               </CardDescription>459 |             </CardHeader>460 |             <CardContent>461 |               <form onSubmit={handleSubmit} className="space-y-4">462 |                 <div className="space-y-2">463 |                   <Label htmlFor="name" className="dashboard-filter-label">Name</Label>464 |                   <BaseInput465 |                     id="name"466 |                     value={formData.name}467 |                     onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}468 |                     placeholder="Payment method name"469 |                     className="dashboard-input"470 |                     required471 |                   />472 |                 </div>473 | 474 |                 <div className="space-y-2">475 |                   <Label htmlFor="type" className="dashboard-filter-label">Type</Label>476 |                   <Select477 |                     value={formData.type}478 |                     onValueChange={handleTypeChange}479 |                   >480 |                     <SelectTrigger className="dashboard-select">481 |                       <SelectValue placeholder="Select payment type" />482 |                     </SelectTrigger>483 |                     <SelectContent className="dashboard-dropdown-content">484 |                       <SelectItem value="cash" className="dashboard-dropdown-item">Cash</SelectItem>485 |                       <SelectItem value="bank_transfer" className="dashboard-dropdown-item">Bank Transfer</SelectItem>486 |                       <SelectItem value="qr_payment" className="dashboard-dropdown-item">QR Payment</SelectItem>487 |                       <SelectItem value="credit_card" className="dashboard-dropdown-item">Credit Card</SelectItem>488 |                       <SelectItem value="stripe" className="dashboard-dropdown-item">Stripe (Credit Card)</SelectItem>489 |                       <SelectItem value="izipay" className="dashboard-dropdown-item">Izipay (JS Client)</SelectItem>490 |                       <SelectItem value="crypto" className="dashboard-dropdown-item">Cryptocurrency</SelectItem>491 |                       <SelectItem value="pay_later" className="dashboard-dropdown-item">Pay Later</SelectItem>492 |                     </SelectContent>493 |                   </Select>494 |                 </div>495 | 496 |                 {}497 |                 {formData.type === 'stripe' && (498 |                   <div className="space-y-4 p-4 border border-[var(--color-accent-200)] rounded-lg bg-[var(--color-accent-50)]">499 |                     <div className="flex items-center justify-between">500 |                       <div className="flex items-center gap-2">501 |                         <Zap className="w-5 h-5 text-[var(--color-accent-600)]" />502 |                         <h4 className="text-sm font-medium text-[var(--color-accent-900)]">Stripe Configuration</h4>503 |                       </div>504 |                       <BaseButton505 |                         type="button"506 |                         onClick={() => setShowStripeConfig(true)}507 |                         className="bg-[var(--color-accent-800)] text-white hover:bg-[var(--color-primary-500)] hover:text-[var(--color-text-inverse)] border border-[var(--color-accent-600)] hover:border-[var(--color-primary-500)] rounded-md px-4 py-2 font-medium transition-all duration-200"508 |                       >509 |                         {stripeConfig ? 'Edit Configuration' : 'Configure Stripe'}510 |                       </BaseButton>511 |                     </div>512 | 513 |                     {stripeConfig ? (514 |                       <div className="text-sm text-[var(--color-accent-800)]">515 |                         <p>✅ Stripe is configured</p>516 |                         <p className="text-xs text-[var(--color-accent-700)] mt-1">517 |                           Currency: {'currency' in stripeConfig ? stripeConfig.currency?.toUpperCase() || 'USD' : 'USD'} |518 |                           Countries: {'supportedCountries' in stripeConfig ? stripeConfig.supportedCountries?.length || 0 : 0} supported519 |                         </p>520 |                       </div>521 |                     ) : (522 |                       <div className="text-sm text-[var(--color-accent-800)]">523 |                         <p className="text-[var(--color-text-primary)] font-medium">⚠️ Stripe configuration required</p>524 |                         <p className="text-xs text-[var(--color-accent-700)] mt-1">525 |                           Click &ldquo;Configure Stripe&rdquo; to set up your payment gateway526 |                         </p>527 |                       </div>528 |                     )}529 |                   </div>530 |                 )}531 | 532 |                 {}533 |                 {formData.type === 'izipay' && (534 |                   <div className="space-y-4 p-4 border border-blue-500/30 rounded-lg bg-blue-900/10">535 |                     <h4 className="text-sm font-medium text-blue-300">Izipay Configuration</h4>536 |                     <div className="space-y-2">537 |                       <Label className="dashboard-label">Environment</Label>538 |                       <Select539 |                         value={formData.izipayConfig?.environment}540 |                         onValueChange={(value) => setFormData(prev => ({ ...prev, izipayConfig: { ...prev.izipayConfig!, environment: value as 'TEST' | 'PRODUCTION' }}))}541 |                       >542 |                         <SelectTrigger className="dashboard-select"><SelectValue /></SelectTrigger>543 |                         <SelectContent className="dashboard-dropdown-content">544 |                           <SelectItem value="TEST">Test</SelectItem>545 |                           <SelectItem value="PRODUCTION">Production</SelectItem>546 |                         </SelectContent>547 |                       </Select>548 |                     </div>549 |                     <div className="space-y-2">550 |                       <Label className="dashboard-label">Username / Merchant ID</Label>551 |                       <BaseInput552 |                         value={formData.izipayConfig?.username}553 |                         onChange={(e) => setFormData(prev => ({ ...prev, izipayConfig: { ...prev.izipayConfig!, username: e.target.value }}))}554 |                         className="dashboard-input"555 |                       />556 |                     </div>557 |                     <div className="space-y-2">558 |                       <Label className="dashboard-label">Password</Label>559 |                        <div className="relative">560 |                         <BaseInput561 |                           type={showSecrets.password ? 'text' : 'password'}562 |                           value={formData.izipayConfig?.password}563 |                           onChange={(e) => setFormData(prev => ({ ...prev, izipayConfig: { ...prev.izipayConfig!, password: e.target.value }}))}564 |                           className="dashboard-input pr-10"565 |                         />566 |                         <button type="button" onClick={() => setShowSecrets(p => ({...p, password: !p.password}))} className="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400">567 |                           {showSecrets.password ? <EyeOff size={16}/> : <Eye size={16}/>}568 |                         </button>569 |                       </div>570 |                     </div>571 |                     <div className="space-y-2">572 |                       <Label className="dashboard-label">Client-Side Public Key</Label>573 |                       <BaseInput574 |                         value={formData.izipayConfig?.publicKey}575 |                         onChange={(e) => setFormData(prev => ({ ...prev, izipayConfig: { ...prev.izipayConfig!, publicKey: e.target.value }}))}576 |                         className="dashboard-input"577 |                       />578 |                     </div>579 |                      <div className="space-y-2">580 |                       <Label className="dashboard-label">Webhook HMAC Secret Key</Label>581 |                       <div className="relative">582 |                         <BaseInput583 |                           type={showSecrets.hmacKey ? 'text' : 'password'}584 |                           value={formData.izipayConfig?.hmacKey}585 |                           onChange={(e) => setFormData(prev => ({ ...prev, izipayConfig: { ...prev.izipayConfig!, hmacKey: e.target.value }}))}586 |                           className="dashboard-input pr-10"587 |                         />588 |                         <button type="button" onClick={() => setShowSecrets(p => ({...p, hmacKey: !p.hmacKey}))} className="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400">589 |                           {showSecrets.hmacKey ? <EyeOff size={16}/> : <Eye size={16}/>}590 |                         </button>591 |                       </div>592 |                     </div>593 |                   </div>594 |                 )}595 |                 {}596 | 597 |                 <div className="space-y-2">598 |                   <Label htmlFor="description" className="dashboard-filter-label">Description</Label>599 |                   <Textarea600 |                     id="description"601 |                     value={formData.description}602 |                     onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}603 |                     placeholder="Payment method description"604 |                     className="dashboard-input"605 |                     rows={3}606 |                   />607 |                 </div>608 | 609 |                 <div className="space-y-2">610 |                   <Label htmlFor="icon" className="dashboard-filter-label">Icon (optional)</Label>611 |                   <BaseInput612 |                     id="icon"613 |                     value={formData.icon}614 |                     onChange={(e) => setFormData(prev => ({ ...prev, icon: e.target.value }))}615 |                     placeholder="Icon class or identifier"616 |                     className="dashboard-input"617 |                   />618 |                 </div>619 | 620 |                 <div className="flex items-center justify-between">621 |                   <Label htmlFor="requiresConfirmation" className="dashboard-filter-label">622 |                     Requires Manual Confirmation623 |                   </Label>624 |                   <Switch625 |                     id="requiresConfirmation"626 |                     checked={formData.requiresConfirmation}627 |                     onCheckedChange={(checked) => setFormData(prev => ({ ...prev, requiresConfirmation: checked }))}628 |                   />629 |                 </div>630 | 631 |                 <div className="flex items-center justify-between">632 |                   <Label htmlFor="autoAssignPackage" className="dashboard-filter-label">633 |                     Auto-assign Package on Payment634 |                   </Label>635 |                   <Switch636 |                     id="autoAssignPackage"637 |                     checked={formData.autoAssignPackage}638 |                     onCheckedChange={(checked) => setFormData(prev => ({ ...prev, autoAssignPackage: checked }))}639 |                   />640 |                 </div>641 | 642 |                 <div className="flex gap-2 pt-4">643 |                   <BaseButton type="submit" className="dashboard-button-primary flex-1">644 |                     <Save className="mr-2 h-4 w-4" />645 |                     {editingMethod ? 'Update' : 'Create'}646 |                   </BaseButton>647 |                   <BaseButton648 |                     type="button"649 |                     onClick={() => {650 |                       setShowCreateModal(false);651 |                       setEditingMethod(null);652 |                       resetForm();653 |                     }}654 |                     className="dashboard-button-outline"655 |                   >656 |                     <X className="mr-2 h-4 w-4" />657 |                     Cancel658 |                   </BaseButton>659 |                 </div>660 |               </form>661 |             </CardContent>662 |           </Card>663 |         </div>664 |       )}665 | 666 |       {}667 |       <StripeConfigModal668 |         isOpen={showStripeConfig}669 |         onClose={() => setShowStripeConfig(false)}670 |         onSave={handleStripeConfigSave}671 |         initialConfig={stripeConfig && 'currency' in stripeConfig ? stripeConfig : undefined}672 |       />673 |     </div>674 |   );675 | };676 | 677 | export default PaymentMethodManagement;
============================================================END: frontend/components/PaymentMethodManagement.tsx============================================================


============================================================FILE: frontend/components/PaymentRecordsManagement.tsxSIZE: 30.19 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { Label } from '@/components/ui/label';  8 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  9 | import { Textarea } from '@/components/ui/textarea'; 10 | import { Badge } from '@/components/ui/badge'; 11 | import { Search, Plus, Edit, Trash2, DollarSign, Calendar, User, Package, Save } from 'lucide-react'; 12 | import { toast } from 'sonner'; 13 | import { useAuth } from '../hooks/useAuth'; 14 |  15 | interface Purchase { 16 |   id: number; 17 |   userId: string; 18 |   totalAmount: number; 19 |   currencyCode: string; 20 |   paymentMethod: string; 21 |   paymentStatus: string; 22 |   transactionId?: string; 23 |   notes?: string; 24 |   purchasedAt?: string; 25 |   confirmedAt?: string; 26 |   createdAt?: string; 27 |   updatedAt?: string; 28 |   user?: { 29 |     id: string; 30 |     email: string; 31 |     fullName?: string; 32 |   }; 33 |   userPackages?: UserPackage[]; 34 | } 35 |  36 | interface UserPackage { 37 |   id: number; 38 |   userId: string; 39 |   purchaseId: number; 40 |   packagePriceId: number; 41 |   quantity?: number; 42 |   sessionsUsed?: number; 43 |   isActive?: boolean; 44 |   expiresAt?: string; 45 |   createdAt?: string; 46 |   updatedAt?: string; 47 |   packagePrice?: { 48 |     id: number; 49 |     price: number; 50 |     packageDefinition?: { 51 |       id: number; 52 |       name: string; 53 |       sessionsCount: number; 54 |     }; 55 |   }; 56 | } 57 |  58 | interface PurchaseFormData { 59 |   userId: string; 60 |   totalAmount: number; 61 |   currencyCode: string; 62 |   paymentMethod: string; 63 |   paymentStatus: string; 64 |   transactionId: string; 65 |   notes: string; 66 | } 67 |  68 | interface PurchaseFilters { 69 |   userId: string; 70 |   paymentMethod: string; 71 |   paymentStatus: string; 72 |   dateFrom: string; 73 |   dateTo: string; 74 |   amountMin?: number; 75 |   amountMax?: number; 76 | } 77 |  78 | const PaymentRecordsManagement: React.FC = () => { 79 |   const { user } = useAuth(); 80 |   const [purchases, setPurchases] = useState<Purchase[]>([]); 81 |   const [users, setUsers] = useState<Array<{ id: string; email: string; fullName?: string }>>([]); 82 |   const [loading, setLoading] = useState(true); 83 |   const [showCreateModal, setShowCreateModal] = useState(false); 84 |   const [editingPurchase, setEditingPurchase] = useState<Purchase | null>(null); 85 |   const [formData, setFormData] = useState<PurchaseFormData>({ 86 |     userId: '', 87 |     totalAmount: 0, 88 |     currencyCode: 'USD', 89 |     paymentMethod: 'cash', 90 |     paymentStatus: 'pending', 91 |     transactionId: '', 92 |     notes: '' 93 |   }); 94 |   const [filters, setFilters] = useState<PurchaseFilters>({ 95 |     userId: 'all', 96 |     paymentMethod: 'all', 97 |     paymentStatus: 'all', 98 |     dateFrom: '', 99 |     dateTo: '',100 |     amountMin: undefined,101 |     amountMax: undefined102 |   });103 |   const [pagination, setPagination] = useState({104 |     page: 1,105 |     limit: 50,106 |     total: 0,107 |     totalPages: 0108 |   });109 | 110 |   const fetchPurchases = useCallback(async () => {111 |     try {112 |       setLoading(true);113 |       const authToken = user?.access_token;114 |       if (!authToken) {115 |         return;116 |       }117 | 118 |       + '...');119 | 120 |       const params = new URLSearchParams();121 | 122 |       if (filters.userId && filters.userId !== 'all') params.append('userId', filters.userId);123 |       if (filters.paymentMethod && filters.paymentMethod !== 'all') params.append('paymentMethod', filters.paymentMethod);124 |       if (filters.paymentStatus && filters.paymentStatus !== 'all') params.append('paymentStatus', filters.paymentStatus);125 |       if (filters.dateFrom) params.append('dateFrom', filters.dateFrom);126 |       if (filters.dateTo) params.append('dateTo', filters.dateTo);127 |       if (filters.amountMin !== undefined) params.append('amountMin', filters.amountMin.toString());128 |       if (filters.amountMax !== undefined) params.append('amountMax', filters.amountMax.toString());129 | 130 |       params.append('page', pagination.page.toString());131 |       params.append('limit', pagination.limit.toString());132 | 133 |       const url = `/api/admin/purchases?${params}`;134 |       const response = await fetch(url, {135 |         headers: {136 |           'Authorization': `Bearer ${authToken}`,137 |           'Content-Type': 'application/json'138 |         }139 |       });140 | 141 |       if (!response.ok) {142 |         const errorText = await response.text();143 |         toast.error(`Failed to fetch purchases: ${response.status} ${response.statusText}`);144 |         return;145 |       }146 | 147 |       const result = await response.json();148 |       if (!result.success) {149 |         toast.error(result.message || 'Failed to fetch purchases');150 |         return;151 |       }152 | 153 |       setPurchases(result.data || []);154 |       setPagination(prev => ({155 |         ...prev,156 |         total: result.pagination?.total || 0,157 |         totalPages: result.pagination?.totalPages || 0158 |       }));159 |     } catch (error) {160 |       toast.error('Failed to fetch purchases');161 |     } finally {162 |       setLoading(false);163 |     }164 |   }, [user?.access_token, filters.userId, filters.paymentMethod, filters.paymentStatus, filters.dateFrom, filters.dateTo, filters.amountMin, filters.amountMax, pagination.page, pagination.limit]);165 | 166 |   const fetchUsers = useCallback(async () => {167 |     try {168 |       const authToken = user?.access_token;169 |       if (!authToken) return;170 | 171 |       const response = await fetch('/api/admin/users', {172 |         headers: {173 |           'Authorization': `Bearer ${authToken}`,174 |           'Content-Type': 'application/json'175 |         }176 |       });177 | 178 |       if (response.ok) {179 |         const result = await response.json();180 |         setUsers(result.data || []);181 |       }182 |     } catch (error) {183 |       }184 |   }, [user?.access_token]);185 | 186 |   const refreshData = useCallback(() => {187 |     if (user?.access_token) {188 |       fetchPurchases();189 |       fetchUsers();190 |     }191 |   }, [user?.access_token, fetchPurchases, fetchUsers]);192 | 193 |   useEffect(() => {194 |     if (user?.access_token) {195 |       fetchPurchases();196 |       fetchUsers();197 |     }198 |   }, [user, user?.access_token, fetchPurchases, fetchUsers]);199 | 200 |   useEffect(() => {201 |     if (user?.access_token) {202 |       fetchPurchases();203 |     }204 |   }, [user?.access_token, filters.userId, filters.paymentMethod, filters.paymentStatus, filters.dateFrom, filters.dateTo, filters.amountMin, filters.amountMax, pagination.page, fetchPurchases]);205 | 206 |   useEffect(() => {207 | 208 |     window.refreshPaymentRecordsData = refreshData;209 | 210 |     return () => {211 | 212 |       delete window.refreshPaymentRecordsData;213 |     };214 |   }, [refreshData]);215 | 216 |   const handleSubmit = async (e: React.FormEvent) => {217 |     e.preventDefault();218 | 219 |     try {220 |       const authToken = user?.access_token;221 |       if (!authToken) {222 |         toast.error('Authentication required');223 |         return;224 |       }225 | 226 |       const url = editingPurchase227 |         ? `/api/admin/purchases/${editingPurchase.id}`228 |         : '/api/admin/purchases';229 | 230 |       const method = editingPurchase ? 'PUT' : 'POST';231 |       const body = editingPurchase232 |         ? { ...formData }233 |         : formData;234 | 235 |       const response = await fetch(url, {236 |         method,237 |         headers: {238 |           'Authorization': `Bearer ${authToken}`,239 |           'Content-Type': 'application/json'240 |         },241 |         body: JSON.stringify(body)242 |       });243 | 244 |       if (!response.ok) throw new Error('Failed to save purchase');245 | 246 |       toast.success(editingPurchase ? 'Purchase updated' : 'Purchase created');247 |       setShowCreateModal(false);248 |       setEditingPurchase(null);249 |       resetForm();250 |       fetchPurchases();251 |     } catch (error) {252 |       toast.error('Failed to save purchase');253 |     }254 |   };255 | 256 |   const handleEdit = (purchase: Purchase) => {257 |     setEditingPurchase(purchase);258 |     setFormData({259 |       userId: purchase.userId,260 |       totalAmount: purchase.totalAmount,261 |       currencyCode: purchase.currencyCode,262 |       paymentMethod: purchase.paymentMethod,263 |       paymentStatus: purchase.paymentStatus,264 |       transactionId: purchase.transactionId || '',265 |       notes: purchase.notes || ''266 |     });267 |     setShowCreateModal(true);268 |   };269 | 270 |   const handleDelete = async (id: number) => {271 |     if (!confirm('Are you sure you want to delete this purchase?')) return;272 | 273 |     try {274 |       const authToken = user?.access_token;275 |       if (!authToken) {276 |         toast.error('Authentication required');277 |         return;278 |       }279 | 280 |       const response = await fetch(`/api/admin/purchases/${id}`, {281 |         method: 'DELETE',282 |         headers: {283 |           'Authorization': `Bearer ${authToken}`,284 |           'Content-Type': 'application/json'285 |         }286 |       });287 | 288 |       if (!response.ok) throw new Error('Failed to delete purchase');289 | 290 |       toast.success('Purchase deleted');291 |       fetchPurchases();292 |     } catch (error) {293 |       toast.error('Failed to delete purchase');294 |     }295 |   };296 | 297 |   const resetForm = () => {298 |     setFormData({299 |       userId: '',300 |       totalAmount: 0,301 |       currencyCode: 'USD',302 |       paymentMethod: 'cash',303 |       paymentStatus: 'pending',304 |       transactionId: '',305 |       notes: ''306 |     });307 |   };308 | 309 |   const clearFilters = () => {310 |     setFilters({311 |       userId: 'all',312 |       paymentMethod: 'all',313 |       paymentStatus: 'all',314 |       dateFrom: '',315 |       dateTo: '',316 |       amountMin: undefined,317 |       amountMax: undefined318 |     });319 |   };320 | 321 |   const getPaymentStatusColor = (status: string) => {322 |     switch (status) {323 |       case 'completed': return 'dashboard-badge-success';324 |       case 'pending': return 'dashboard-badge-warning';325 |       case 'failed': return 'dashboard-badge-error';326 |       case 'refunded': return 'dashboard-badge-info';327 |       case 'cancelled': return 'dashboard-badge-error';328 |       default: return 'dashboard-badge';329 |     }330 |   };331 | 332 |   const getPaymentMethodIcon = (method: string) => {333 |     switch (method) {334 |       case 'cash': return <DollarSign className="h-4 w-4 dashboard-text-muted" />;335 |       case 'bank_transfer': return <DollarSign className="h-4 w-4 dashboard-text-muted" />;336 |       case 'credit_card': return <DollarSign className="h-4 w-4 dashboard-text-muted" />;337 |       case 'qr_payment': return <DollarSign className="h-4 w-4 dashboard-text-muted" />;338 |       case 'crypto': return <DollarSign className="h-4 w-4 dashboard-text-muted" />;339 |       case 'pay_later': return <DollarSign className="h-4 w-4 dashboard-text-muted" />;340 |       default: return <DollarSign className="h-4 w-4 dashboard-text-muted" />;341 |     }342 |   };343 | 344 |   const formatCurrency = (amount: number, currency: string) => {345 |     return new Intl.NumberFormat('en-US', {346 |       style: 'currency',347 |       currency: currency348 |     }).format(amount);349 |   };350 | 351 |   const formatDate = (dateString?: string) => {352 |     if (!dateString) return 'N/A';353 |     return new Date(dateString).toLocaleDateString();354 |   };355 | 356 |   if (!user) {357 |     return (358 |       <div className="dashboard-container p-6">359 |         <div className="text-center">360 |           <h2 className="dashboard-text-primary text-2xl font-bold mb-4">Authentication Required</h2>361 |           <p className="dashboard-text-secondary">Please log in to access this feature.</p>362 |         </div>363 |       </div>364 |     );365 |   }366 | 367 |   return (368 |     <div className="dashboard-container p-6 space-y-6">369 |       {}370 |       <div className="flex items-center justify-between">371 |         <div>372 |           <h2 className="dashboard-text-primary text-3xl font-bold tracking-tight">373 |             Purchase Management374 |           </h2>375 |           <p className="dashboard-text-secondary">376 |             Track and manage all purchase transactions for packages377 |           </p>378 |         </div>379 |         <div className="flex gap-2">380 |           <BaseButton381 |             onClick={() => setShowCreateModal(true)}382 |             className="dashboard-button-primary"383 |           >384 |             <Plus className="mr-2 h-4 w-4" />385 |             Add Purchase386 |           </BaseButton>387 |         </div>388 |       </div>389 | 390 |       {}391 |       <Card className="dashboard-card">392 |         <CardHeader>393 |           <CardTitle className="dashboard-card-title">Filters</CardTitle>394 |         </CardHeader>395 |         <CardContent>396 |           <div className="dashboard-filter-grid">397 |             <div className="dashboard-filter-item">398 |               <Label htmlFor="user_id" className="dashboard-filter-label">User</Label>399 |               <Select400 |                 value={filters.userId}401 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, userId: value }))}402 |               >403 |                 <SelectTrigger className="dashboard-select">404 |                   <SelectValue placeholder="All users" />405 |                 </SelectTrigger>406 |                 <SelectContent className="dashboard-dropdown-content">407 |                   <SelectItem value="all" className="dashboard-dropdown-item">All users</SelectItem>408 |                   {users.map((user) => (409 |                     <SelectItem key={user.id} value={user.id} className="dashboard-dropdown-item">410 |                       {user.fullName || user.email}411 |                     </SelectItem>412 |                   ))}413 |                 </SelectContent>414 |               </Select>415 |             </div>416 | 417 |             <div className="dashboard-filter-item">418 |               <Label htmlFor="payment_method" className="dashboard-filter-label">Payment Method</Label>419 |               <Select420 |                 value={filters.paymentMethod}421 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, paymentMethod: value }))}422 |               >423 |                 <SelectTrigger className="dashboard-select">424 |                   <SelectValue placeholder="All payment methods" />425 |                 </SelectTrigger>426 |                 <SelectContent className="dashboard-dropdown-content">427 |                   <SelectItem value="all" className="dashboard-dropdown-item">All methods</SelectItem>428 |                   <SelectItem value="cash" className="dashboard-dropdown-item">Cash</SelectItem>429 |                   <SelectItem value="bank_transfer" className="dashboard-dropdown-item">Bank Transfer</SelectItem>430 |                   <SelectItem value="qr_payment" className="dashboard-dropdown-item">QR Payment</SelectItem>431 |                   <SelectItem value="credit_card" className="dashboard-dropdown-item">Credit Card</SelectItem>432 |                   <SelectItem value="crypto" className="dashboard-dropdown-item">Cryptocurrency</SelectItem>433 |                   <SelectItem value="pay_later" className="dashboard-dropdown-item">Pay Later</SelectItem>434 |                 </SelectContent>435 |               </Select>436 |             </div>437 | 438 |             <div className="dashboard-filter-item">439 |               <Label htmlFor="payment_status" className="dashboard-filter-label">Payment Status</Label>440 |               <Select441 |                 value={filters.paymentStatus}442 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, paymentStatus: value }))}443 |               >444 |                 <SelectTrigger className="dashboard-select">445 |                   <SelectValue placeholder="All statuses" />446 |                 </SelectTrigger>447 |                 <SelectContent className="dashboard-dropdown-content">448 |                   <SelectItem value="all" className="dashboard-dropdown-item">All statuses</SelectItem>449 |                   <SelectItem value="pending" className="dashboard-dropdown-item">Pending</SelectItem>450 |                   <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>451 |                   <SelectItem value="failed" className="dashboard-dropdown-item">Failed</SelectItem>452 |                   <SelectItem value="refunded" className="dashboard-dropdown-item">Refunded</SelectItem>453 |                   <SelectItem value="cancelled" className="dashboard-dropdown-item">Cancelled</SelectItem>454 |                 </SelectContent>455 |               </Select>456 |             </div>457 | 458 |             <div className="dashboard-filter-item">459 |               <Label htmlFor="date_from" className="dashboard-filter-label">From Date</Label>460 |               <BaseInput461 |                 id="date_from"462 |                 type="date"463 |                 value={filters.dateFrom || ''}464 |                 onChange={(e) => setFilters(prev => ({ ...prev, dateFrom: e.target.value }))}465 |                 className="dashboard-input"466 |               />467 |             </div>468 | 469 |             <div className="dashboard-filter-item">470 |               <Label htmlFor="date_to" className="dashboard-filter-label">To Date</Label>471 |               <BaseInput472 |                 id="date_to"473 |                 type="date"474 |                 value={filters.dateTo || ''}475 |                 onChange={(e) => setFilters(prev => ({ ...prev, dateTo: e.target.value }))}476 |                 className="dashboard-input"477 |               />478 |             </div>479 | 480 |             <div className="dashboard-filter-item">481 |               <Label htmlFor="amount_min" className="dashboard-filter-label">Min Amount</Label>482 |               <BaseInput483 |                 id="amount_min"484 |                 type="number"485 |                 step="0.01"486 |                 placeholder="0.00"487 |                 value={filters.amountMin || ''}488 |                 onChange={(e) => setFilters(prev => ({ ...prev, amountMin: e.target.value ? parseFloat(e.target.value) : undefined }))}489 |                 className="dashboard-input"490 |               />491 |             </div>492 | 493 |             <div className="dashboard-filter-item">494 |               <Label htmlFor="amount_max" className="dashboard-filter-label">Max Amount</Label>495 |               <BaseInput496 |                 id="amount_max"497 |                 type="number"498 |                 step="0.01"499 |                 placeholder="0.00"500 |                 value={filters.amountMax || ''}501 |                 onChange={(e) => setFilters(prev => ({ ...prev, amountMax: e.target.value ? parseFloat(e.target.value) : undefined }))}502 |                 className="dashboard-input"503 |               />504 |             </div>505 |           </div>506 | 507 |           <div className="flex gap-2 mt-4">508 |             <BaseButton onClick={fetchPurchases} className="dashboard-button-primary">509 |               <Search className="mr-2 h-4 w-4" />510 |               Apply Filters511 |             </BaseButton>512 |             <BaseButton513 |               onClick={clearFilters}514 |               className="dashboard-button-outline"515 |             >516 |               Clear Filters517 |             </BaseButton>518 |           </div>519 |         </CardContent>520 |       </Card>521 | 522 |       {}523 |       <Card className="dashboard-card">524 |         <CardHeader>525 |           <CardTitle className="dashboard-card-title">Purchases</CardTitle>526 |           <CardDescription className="dashboard-card-description">527 |             All purchase transactions and their current status528 |           </CardDescription>529 |         </CardHeader>530 |         <CardContent>531 |           {loading ? (532 |             <div className="text-center py-8">533 |               <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-[#FFD700] mx-auto"></div>534 |               <p className="dashboard-text-secondary mt-2">Loading purchases...</p>535 |             </div>536 |           ) : purchases.length === 0 ? (537 |             <div className="text-center py-8">538 |               <p className="dashboard-text-secondary">No purchases found</p>539 |             </div>540 |           ) : (541 |             <div className="space-y-4">542 |               {purchases.map((purchase) => (543 |                 <div key={purchase.id} className="border border-[#C0C0C0]/20 rounded-lg p-4 space-y-3 bg-[#191970]/30">544 |                   <div className="flex items-center justify-between">545 |                     <div className="flex items-center gap-3">546 |                       <div className="flex items-center gap-2">547 |                         <User className="h-4 w-4 dashboard-text-muted" />548 |                         <span className="dashboard-text-primary font-medium">549 |                           {purchase.user?.fullName || purchase.user?.email || 'Unknown User'}550 |                         </span>551 |                       </div>552 |                       <Badge553 |                         variant="outline"554 |                         className={`dashboard-badge ${getPaymentStatusColor(purchase.paymentStatus)}`}555 |                       >556 |                         {purchase.paymentStatus}557 |                       </Badge>558 |                     </div>559 |                     <div className="flex gap-2">560 |                       <BaseButton561 |                         size="sm"562 |                         onClick={() => handleEdit(purchase)}563 |                         className="dashboard-button-outline"564 |                       >565 |                         <Edit className="mr-2 h-4 w-4" />566 |                         Edit567 |                       </BaseButton>568 |                       <BaseButton569 |                         size="sm"570 |                         onClick={() => handleDelete(purchase.id)}571 |                         className="dashboard-button-danger"572 |                       >573 |                         <Trash2 className="mr-2 h-4 w-4" />574 |                         Delete575 |                       </BaseButton>576 |                     </div>577 |                   </div>578 | 579 |                   <div className="grid gap-2 md:grid-cols-4">580 |                     <div className="flex items-center gap-2">581 |                       <DollarSign className="h-4 w-4 dashboard-text-muted" />582 |                       <span className="dashboard-text-primary">583 |                         {formatCurrency(purchase.totalAmount, purchase.currencyCode)}584 |                       </span>585 |                     </div>586 |                     <div className="flex items-center gap-2">587 |                       {getPaymentMethodIcon(purchase.paymentMethod)}588 |                       <span className="dashboard-text-primary capitalize">589 |                         {purchase.paymentMethod.replace('_', ' ')}590 |                       </span>591 |                     </div>592 |                     <div className="flex items-center gap-2">593 |                       <Calendar className="h-4 w-4 dashboard-text-muted" />594 |                       <span className="dashboard-text-primary">595 |                         {formatDate(purchase.purchasedAt)}596 |                       </span>597 |                     </div>598 |                     <div className="flex items-center gap-2">599 |                       <Package className="h-4 w-4 dashboard-text-muted" />600 |                       <span className="dashboard-text-primary">601 |                         {purchase.userPackages?.length || 0} packages602 |                       </span>603 |                     </div>604 |                   </div>605 | 606 |                   {purchase.transactionId && (607 |                     <div className="flex items-center gap-2">608 |                       <span className="dashboard-text-secondary text-sm">Transaction ID:</span>609 |                       <span className="dashboard-text-primary font-mono text-sm">{purchase.transactionId}</span>610 |                     </div>611 |                   )}612 | 613 |                   {purchase.notes && (614 |                     <div className="dashboard-text-muted text-sm">615 |                       <strong>Notes:</strong> {purchase.notes}616 |                     </div>617 |                   )}618 |                 </div>619 |               ))}620 |             </div>621 |           )}622 |         </CardContent>623 |       </Card>624 | 625 |       {}626 |       {showCreateModal && (627 |         <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">628 |           <div className="bg-[#191970] border border-[#C0C0C0]/20 rounded-lg p-6 w-full max-w-md">629 |             <h3 className="dashboard-text-primary text-xl font-bold mb-4">630 |               {editingPurchase ? 'Edit Purchase' : 'Create Purchase'}631 |             </h3>632 | 633 |             <form onSubmit={handleSubmit} className="space-y-4">634 |               <div>635 |                 <Label htmlFor="user_id" className="dashboard-label">User</Label>636 |                 <Select637 |                   value={formData.userId}638 |                   onValueChange={(value) => setFormData(prev => ({ ...prev, userId: value }))}639 |                 >640 |                   <SelectTrigger className="dashboard-select">641 |                     <SelectValue placeholder="Select user" />642 |                   </SelectTrigger>643 |                   <SelectContent className="dashboard-dropdown-content">644 |                     {users.map((user) => (645 |                       <SelectItem key={user.id} value={user.id} className="dashboard-dropdown-item">646 |                         {user.fullName || user.email}647 |                       </SelectItem>648 |                     ))}649 |                   </SelectContent>650 |                 </Select>651 |               </div>652 | 653 |               <div>654 |                 <Label htmlFor="total_amount" className="dashboard-label">Total Amount</Label>655 |                 <BaseInput656 |                   id="total_amount"657 |                   type="number"658 |                   step="0.01"659 |                   value={formData.totalAmount}660 |                   onChange={(e) => setFormData(prev => ({ ...prev, totalAmount: parseFloat(e.target.value) || 0 }))}661 |                   className="dashboard-input"662 |                   required663 |                 />664 |               </div>665 | 666 |               <div>667 |                 <Label htmlFor="currency_code" className="dashboard-label">Currency</Label>668 |                 <Select669 |                   value={formData.currencyCode}670 |                   onValueChange={(value) => setFormData(prev => ({ ...prev, currencyCode: value }))}671 |                 >672 |                   <SelectTrigger className="dashboard-select">673 |                     <SelectValue />674 |                   </SelectTrigger>675 |                   <SelectContent className="dashboard-dropdown-content">676 |                     <SelectItem value="USD" className="dashboard-dropdown-item">USD</SelectItem>677 |                     <SelectItem value="EUR" className="dashboard-dropdown-item">EUR</SelectItem>678 |                     <SelectItem value="GBP" className="dashboard-dropdown-item">GBP</SelectItem>679 |                   </SelectContent>680 |                 </Select>681 |               </div>682 | 683 |               <div>684 |                 <Label htmlFor="payment_method" className="dashboard-label">Payment Method</Label>685 |                 <Select686 |                   value={formData.paymentMethod}687 |                   onValueChange={(value) => setFormData(prev => ({ ...prev, paymentMethod: value }))}688 |                 >689 |                   <SelectTrigger className="dashboard-select">690 |                     <SelectValue />691 |                   </SelectTrigger>692 |                   <SelectContent className="dashboard-dropdown-content">693 |                     <SelectItem value="cash" className="dashboard-dropdown-item">Cash</SelectItem>694 |                     <SelectItem value="bank_transfer" className="dashboard-dropdown-item">Bank Transfer</SelectItem>695 |                     <SelectItem value="qr_payment" className="dashboard-dropdown-item">QR Payment</SelectItem>696 |                     <SelectItem value="credit_card" className="dashboard-dropdown-item">Credit Card</SelectItem>697 |                     <SelectItem value="crypto" className="dashboard-dropdown-item">Cryptocurrency</SelectItem>698 |                     <SelectItem value="pay_later" className="dashboard-dropdown-item">Pay Later</SelectItem>699 |                   </SelectContent>700 |                 </Select>701 |               </div>702 | 703 |               <div>704 |                 <Label htmlFor="payment_status" className="dashboard-label">Payment Status</Label>705 |                 <Select706 |                   value={formData.paymentStatus}707 |                   onValueChange={(value) => setFormData(prev => ({ ...prev, paymentStatus: value }))}708 |                 >709 |                   <SelectTrigger className="dashboard-select">710 |                     <SelectValue />711 |                   </SelectTrigger>712 |                   <SelectContent className="dashboard-dropdown-content">713 |                     <SelectItem value="pending" className="dashboard-dropdown-item">Pending</SelectItem>714 |                     <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>715 |                     <SelectItem value="failed" className="dashboard-dropdown-item">Failed</SelectItem>716 |                     <SelectItem value="refunded" className="dashboard-dropdown-item">Refunded</SelectItem>717 |                     <SelectItem value="cancelled" className="dashboard-dropdown-item">Cancelled</SelectItem>718 |                   </SelectContent>719 |                 </Select>720 |               </div>721 | 722 |               <div>723 |                 <Label htmlFor="transaction_id" className="dashboard-label">Transaction ID</Label>724 |                 <BaseInput725 |                   id="transaction_id"726 |                   value={formData.transactionId}727 |                   onChange={(e) => setFormData(prev => ({ ...prev, transactionId: e.target.value }))}728 |                   className="dashboard-input"729 |                   placeholder="Optional"730 |                 />731 |               </div>732 | 733 |               <div>734 |                 <Label htmlFor="notes" className="dashboard-label">Notes</Label>735 |                 <Textarea736 |                   id="notes"737 |                   value={formData.notes}738 |                   onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}739 |                   className="dashboard-input"740 |                   placeholder="Optional notes"741 |                   rows={3}742 |                 />743 |               </div>744 | 745 |               <div className="flex gap-2 pt-4">746 |                 <BaseButton type="submit" className="dashboard-button-primary flex-1">747 |                   <Save className="mr-2 h-4 w-4" />748 |                   {editingPurchase ? 'Update' : 'Create'}749 |                 </BaseButton>750 |                 <BaseButton751 |                   type="button"752 |                   onClick={() => {753 |                     setShowCreateModal(false);754 |                     setEditingPurchase(null);755 |                     resetForm();756 |                   }}757 |                   className="dashboard-button-outline"758 |                 >759 |                   Cancel760 |                 </BaseButton>761 |               </div>762 |             </form>763 |           </div>764 |         </div>765 |       )}766 |     </div>767 |   );768 | };769 | 770 | export default PaymentRecordsManagement;
============================================================END: frontend/components/PaymentRecordsManagement.tsx============================================================


============================================================FILE: frontend/components/PurchaseHistory.tsxSIZE: 18.11 KB============================================================
  1 | import React, { useState, useEffect, useCallback } from 'react';  2 | import { motion } from 'framer-motion';  3 | import {  4 |   Package, CreditCard, Users, Clock, DollarSign,  5 |   TrendingUp, RefreshCw, Wallet, QrCode, Bitcoin  6 | } from 'lucide-react';  7 | import { Button } from './ui/button';  8 | import { Card, CardContent, CardHeader, CardTitle } from './ui/card';  9 | import { Badge } from './ui/badge'; 10 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select'; 11 | import { Tabs, TabsContent, TabsList, TabsTrigger } from './ui/tabs'; 12 | import { toast } from 'sonner'; 13 | import { useAuth } from '../hooks/useAuth'; 14 | import { PaymentMethod, PaymentStatus } from '../lib/types'; 15 |  16 | interface UserPackage { 17 |   id: number; 18 |   package: { 19 |     id: number; 20 |     name: string; 21 |     packageType: string; 22 |     packagePrice: number; 23 |     currency: { 24 |       symbol: string; 25 |       code: string; 26 |     }; 27 |   }; 28 |   purchasedAt: string; 29 |   purchasePrice: number; 30 |   originalPrice: number; 31 |   discountApplied?: number; 32 |   paymentMethod?: PaymentMethod; 33 |   paymentStatus: PaymentStatus; 34 |   paymentConfirmedAt?: string; 35 |   sessionsRemaining: number; 36 |   sessionsUsed: number; 37 |   groupSessionsRemaining: number; 38 |   groupSessionsUsed: number; 39 |   expiresAt?: string; 40 |   isActive: boolean; 41 | } 42 |  43 | interface PurchaseStats { 44 |   totalPackages: number; 45 |   totalSpent: number; 46 |   totalSessions: number; 47 |   activePackages: number; 48 |   expiredPackages: number; 49 |   pendingPayments: number; 50 |   completedPayments: number; 51 |   failedPayments: number; 52 | } 53 |  54 | export function PurchaseHistory() { 55 |   const [userPackages, setUserPackages] = useState<UserPackage[]>([]); 56 |   const [isLoading, setIsLoading] = useState(true); 57 |   const [activeTab, setActiveTab] = useState('overview'); 58 |   const [dateFilter, setDateFilter] = useState('all'); 59 |   const [statusFilter, setStatusFilter] = useState('all'); 60 |   const [paymentStatusFilter, setPaymentStatusFilter] = useState<PaymentStatus | 'all'>('all'); 61 |   const { user } = useAuth(); 62 |  63 |   const loadPurchaseHistory = useCallback(async () => { 64 |     if (!user?.access_token) return; 65 |  66 |     setIsLoading(true); 67 |     try { 68 |  69 |       const packagesResponse = await fetch(`/api/client/my-packages`, { 70 |         headers: { 71 |           'Authorization': `Bearer ${user.access_token}`, 72 |           'Content-Type': 'application/json' 73 |         } 74 |       }); 75 |       if (packagesResponse.ok) { 76 |         const packagesData = await packagesResponse.json(); 77 |         setUserPackages(packagesData.data || []); 78 |       } 79 |  80 |       const purchaseResponse = await fetch(`/api/client/purchase-history`, { 81 |         headers: { 82 |           'Authorization': `Bearer ${user.access_token}`, 83 |           'Content-Type': 'application/json' 84 |         } 85 |       }); 86 |               if (purchaseResponse.ok) { 87 |  88 |         } 89 |     } catch { 90 |  91 |       toast.error('Failed to load purchase history'); 92 |     } finally { 93 |       setIsLoading(false); 94 |     } 95 |   }, [user?.access_token]); 96 |  97 |   useEffect(() => { 98 |     if (user?.access_token) { 99 |       loadPurchaseHistory();100 |     }101 |   }, [user?.access_token, loadPurchaseHistory]);102 | 103 |   const calculateStats = (): PurchaseStats => {104 |     const totalPackages = userPackages.length;105 |     const totalSpent = userPackages.reduce((sum, pkg) => sum + Number(pkg.purchasePrice), 0);106 |     const totalSessions = userPackages.reduce((sum, pkg) =>107 |       sum + pkg.sessionsUsed + pkg.groupSessionsUsed, 0);108 |     const activePackages = userPackages.filter(pkg => pkg.isActive).length;109 |     const expiredPackages = userPackages.filter(pkg =>110 |       pkg.expiresAt && new Date(pkg.expiresAt) < new Date()111 |     ).length;112 |     const pendingPayments = userPackages.filter(pkg => pkg.paymentStatus === 'pending').length;113 |     const completedPayments = userPackages.filter(pkg => pkg.paymentStatus === 'completed').length;114 |     const failedPayments = userPackages.filter(pkg => pkg.paymentStatus === 'failed').length;115 | 116 |     return {117 |       totalPackages,118 |       totalSpent,119 |       totalSessions,120 |       activePackages,121 |       expiredPackages,122 |       pendingPayments,123 |       completedPayments,124 |       failedPayments125 |     };126 |   };127 | 128 |   const getPaymentStatusBadge = (status: PaymentStatus) => {129 |     const statusConfig = {130 |       'completed': { color: 'bg-green-500/20 text-green-400', label: 'Paid' },131 |       'pending': { color: 'bg-yellow-500/20 text-yellow-400', label: 'Pending' },132 |       'failed': { color: 'bg-red-500/20 text-red-400', label: 'Failed' },133 |       'refunded': { color: 'bg-blue-500/20 text-blue-400', label: 'Refunded' },134 |       'cancelled': { color: 'bg-gray-500/20 text-gray-400', label: 'Cancelled' }135 |     };136 | 137 |     const config = statusConfig[status] || statusConfig.pending;138 |     return <Badge className={config.color}>{config.label}</Badge>;139 |   };140 | 141 |   const getPaymentMethodIcon = (method?: PaymentMethod) => {142 |     switch (method) {143 |       case 'credit_card': return <CreditCard size={16} />;144 |       case 'cash': return <DollarSign size={16} />;145 |       case 'bank_transfer': return <TrendingUp size={16} />;146 |       case 'qr_payment': return <QrCode size={16} />;147 |       case 'crypto': return <Bitcoin size={16} />;148 |       case 'pay_later': return <Clock size={16} />;149 |       default: return <Wallet size={16} />;150 |     }151 |   };152 | 153 |   const getPaymentMethodLabel = (method?: PaymentMethod) => {154 |     switch (method) {155 |       case 'credit_card': return 'Credit Card';156 |       case 'cash': return 'Cash';157 |       case 'bank_transfer': return 'Bank Transfer';158 |       case 'qr_payment': return 'QR Payment';159 |       case 'crypto': return 'Cryptocurrency';160 |       case 'pay_later': return 'Pay Later';161 |       default: return 'Unknown';162 |     }163 |   };164 | 165 |   const formatCurrency = (amount: number, symbol: string) => {166 |     return `${symbol}${amount.toFixed(2)}`;167 |   };168 | 169 |   const stats = calculateStats();170 | 171 |   if (isLoading) {172 |     return (173 |       <div className="flex items-center justify-center h-64">174 |         <motion.div175 |           animate={{ rotate: 360 }}176 |           transition={{ duration: 2, repeat: Infinity, ease: "linear" }}177 |           className="w-8 h-8 border-4 border-[#FFD700] border-t-transparent rounded-full"178 |         />179 |       </div>180 |     );181 |   }182 | 183 |   return (184 |     <div className="space-y-6">185 |       {}186 |       <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">187 |         <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">188 |           <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">189 |             <CardTitle className="text-sm font-medium text-white">Total Packages</CardTitle>190 |             <Package className="h-4 w-4 text-[#FFD700]" />191 |           </CardHeader>192 |           <CardContent>193 |             <div className="text-2xl font-bold text-white">{stats.totalPackages}</div>194 |             <p className="text-xs text-gray-400">Purchased packages</p>195 |           </CardContent>196 |         </Card>197 | 198 |         <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">199 |           <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">200 |             <CardTitle className="text-sm font-medium text-white">Total Spent</CardTitle>201 |             <DollarSign className="h-4 w-4 text-[#FFD700]" />202 |           </CardHeader>203 |           <CardContent>204 |             <div className="text-2xl font-bold text-white">205 |               {formatCurrency(stats.totalSpent, '$')}206 |             </div>207 |             <p className="text-xs text-gray-400">Total investment</p>208 |           </CardContent>209 |         </Card>210 | 211 |         <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">212 |           <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">213 |             <CardTitle className="text-sm font-medium text-white">Active Sessions</CardTitle>214 |             <Users className="h-4 w-4 text-[#FFD700]" />215 |           </CardHeader>216 |           <CardContent>217 |             <div className="text-2xl font-bold text-white">{stats.totalSessions}</div>218 |             <p className="text-xs text-gray-400">Sessions used</p>219 |           </CardContent>220 |         </Card>221 | 222 |         <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">223 |           <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">224 |             <CardTitle className="text-sm font-medium text-white">Payment Status</CardTitle>225 |             <CreditCard className="h-4 w-4 text-[#FFD700]" />226 |           </CardHeader>227 |           <CardContent>228 |             <div className="text-2xl font-bold text-white">{stats.completedPayments}</div>229 |             <p className="text-xs text-gray-400">230 |               {stats.pendingPayments > 0 && `${stats.pendingPayments} pending`}231 |             </p>232 |           </CardContent>233 |         </Card>234 |       </div>235 | 236 |       {}237 |       <div className="flex flex-wrap gap-4 items-center">238 |         <Select value={dateFilter} onValueChange={setDateFilter}>239 |           <SelectTrigger className="w-[180px] bg-[#191970]/30 border-[#C0C0C0]/20 text-white">240 |             <SelectValue placeholder="Date Filter" />241 |           </SelectTrigger>242 |                           <SelectContent className="dashboard-dropdown-content">243 |                   <SelectItem value="all" className="dashboard-dropdown-item">All Time</SelectItem>244 |                   <SelectItem value="30" className="dashboard-dropdown-item">Last 30 Days</SelectItem>245 |                   <SelectItem value="90" className="dashboard-dropdown-item">Last 90 Days</SelectItem>246 |                   <SelectItem value="365" className="dashboard-dropdown-item">Last Year</SelectItem>247 |                 </SelectContent>248 |         </Select>249 | 250 |         <Select value={statusFilter} onValueChange={setStatusFilter}>251 |           <SelectTrigger className="w-[180px] bg-[#191970]/30 border-[#C0C0C0]/20 text-white">252 |             <SelectValue placeholder="Status Filter" />253 |           </SelectTrigger>254 |                           <SelectContent className="dashboard-dropdown-content">255 |                   <SelectItem value="all" className="dashboard-dropdown-item">All Statuses</SelectItem>256 |                   <SelectItem value="active" className="dashboard-dropdown-item">Active</SelectItem>257 |                   <SelectItem value="expired" className="dashboard-dropdown-item">Expired</SelectItem>258 |                   <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>259 |                 </SelectContent>260 |         </Select>261 | 262 |         <Select value={paymentStatusFilter} onValueChange={(value: PaymentStatus | 'all') => setPaymentStatusFilter(value)}>263 |           <SelectTrigger className="w-[180px] bg-[#191970]/30 border-[#C0C0C0]/20 text-white">264 |             <SelectValue placeholder="Payment Status" />265 |           </SelectTrigger>266 |                           <SelectContent className="dashboard-dropdown-content">267 |                   <SelectItem value="all" className="dashboard-dropdown-item">All Payments</SelectItem>268 |                   <SelectItem value="completed" className="dashboard-dropdown-item">Completed</SelectItem>269 |                   <SelectItem value="pending" className="dashboard-dropdown-item">Pending</SelectItem>270 |                   <SelectItem value="failed" className="dashboard-dropdown-item">Failed</SelectItem>271 |                   <SelectItem value="refunded" className="dashboard-dropdown-item">Refunded</SelectItem>272 |                 </SelectContent>273 |         </Select>274 | 275 |         <Button276 |           onClick={loadPurchaseHistory}277 |           className="dashboard-button-reload"278 |         >279 |           <RefreshCw className="mr-2 h-4 w-4" />280 |           Refresh281 |         </Button>282 |       </div>283 | 284 |       {}285 |       <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">286 |         <TabsList className="grid w-full grid-cols-3 dashboard-tabs-list">287 |           <TabsTrigger288 |             value="overview"289 |             className="dashboard-tab-trigger"290 |           >291 |             Overview292 |           </TabsTrigger>293 |           <TabsTrigger294 |             value="packages"295 |             className="dashboard-tab-trigger"296 |           >297 |             Packages298 |           </TabsTrigger>299 |           <TabsTrigger300 |             value="sessions"301 |             className="dashboard-tab-trigger"302 |           >303 |             Sessions304 |           </TabsTrigger>305 |         </TabsList>306 | 307 |         <TabsContent value="overview" className="space-y-4">308 |           {}309 |           <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">310 |             <CardHeader>311 |               <CardTitle className="text-white">Payment Status Summary</CardTitle>312 |             </CardHeader>313 |             <CardContent>314 |               <div className="grid gap-4 md:grid-cols-3">315 |                 <div className="text-center">316 |                   <div className="text-2xl font-bold text-green-400">{stats.completedPayments}</div>317 |                   <div className="text-sm text-gray-400">Completed Payments</div>318 |                 </div>319 |                 <div className="text-center">320 |                   <div className="text-2xl font-bold text-yellow-400">{stats.pendingPayments}</div>321 |                   <div className="text-sm text-gray-400">Pending Payments</div>322 |                 </div>323 |                 <div className="text-center">324 |                   <div className="text-2xl font-bold text-red-400">{stats.failedPayments}</div>325 |                   <div className="text-sm text-gray-400">Failed Payments</div>326 |                 </div>327 |               </div>328 |             </CardContent>329 |           </Card>330 | 331 |           {}332 |           <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">333 |             <CardHeader>334 |               <CardTitle className="text-white">Recent Activity</CardTitle>335 |             </CardHeader>336 |             <CardContent>337 |               <div className="space-y-3">338 |                 {userPackages.slice(0, 5).map((pkg) => (339 |                   <div key={pkg.id} className="flex items-center justify-between p-3 bg-[#191970]/20 rounded-lg">340 |                     <div className="flex items-center gap-3">341 |                       <Package className="h-5 w-5 text-[#FFD700]" />342 |                       <div>343 |                         <div className="text-white font-medium">{pkg.package.name}</div>344 |                         <div className="text-sm text-gray-400">345 |                           {new Date(pkg.purchasedAt).toLocaleDateString()}346 |                         </div>347 |                       </div>348 |                     </div>349 |                     <div className="flex items-center gap-2">350 |                       {getPaymentStatusBadge(pkg.paymentStatus)}351 |                       {pkg.paymentMethod && (352 |                         <div className="flex items-center gap-1 text-gray-400">353 |                           {getPaymentMethodIcon(pkg.paymentMethod)}354 |                           <span className="text-xs">{getPaymentMethodLabel(pkg.paymentMethod)}</span>355 |                         </div>356 |                       )}357 |                     </div>358 |                   </div>359 |                 ))}360 |               </div>361 |             </CardContent>362 |           </Card>363 |         </TabsContent>364 | 365 |         <TabsContent value="packages" className="space-y-4">366 |           <Card className="bg-[#191970]/30 border-[#C0C0C0]/20">367 |             <CardHeader>368 |               <CardTitle className="text-white">Purchased Packages</CardTitle>369 |             </CardHeader>370 |             <CardContent>371 |               <div className="space-y-4">372 |                 {userPackages.map((pkg) => (373 |                   <div key={pkg.id} className="border border-[#C0C0C0]/20 rounded-lg p-4 bg-[#191970]/20">374 |                     <div className="flex items-center justify-between mb-3">375 |                       <div className="flex items-center gap-3">376 |                         <Package className="h-6 w-6 text-[#FFD700]" />377 |                         <div>378 |                           <h3 className="text-lg font-semibold text-white">{pkg.package.name}</h3>379 |                           <p className="text-sm text-gray-400">380 |                             {pkg.package.packageType} Package381 |                           </p>382 |                         </div>383 |                       </div>384 |                       <div className="flex items-center gap-2">385 |                         {getPaymentStatusBadge(pkg.paymentStatus)}386 |                         {pkg.paymentMethod && (387 |                           <div className="flex items-center gap-1 text-gray-400">388 |                             {getPaymentMethodIcon(pkg.paymentMethod)}389 |                             <span className="text-xs">{getPaymentMethodLabel(pkg.paymentMethod)}</span>390 |                           </div>391 |                         )}392 |                       </div>393 |                     </div>394 | 395 |                     <div className="grid gap-4 md:grid-cols-3 mb-3">396 |                       <div>397 |                         <div className="text-sm text-gray-400">Purchase Price</div>398 |                         <div className="text-white font-medium">399 |                           {formatCurrency(pkg.purchasePrice, pkg.package.currency.symbol)}400 |                         </div>401 |                       </div>402 |                       <div>403 |                         <div className="text-sm text-gray-400">Sessions Remaining</div>404 |                         <div className="text-white font-medium">405 |                           {pkg.sessionsRemaining} / {pkg.sessionsRemaining + pkg.sessionsUsed}406 |                         </div>407 |                       </div>408 |                       <div>409 |                         <div className="text-sm text-gray-400">Group Sessions</div>410 |                         <div className="text-white font-medium">411 |                           {pkg.groupSessionsRemaining} / {pkg.groupSessionsRemaining + pkg.groupSessionsUsed}412 |                         </div>413 |                       </div>414 |                     </div>415 | 416 |                     <div className="flex items-center justify-between text-sm text-gray-400">417 |                       <span>Purchased: {new Date(pkg.purchasedAt).toLocaleDateString()}</span>418 |                       {pkg.expiresAt && (419 |                         <span>Expires: {new Date(pkg.expiresAt).toLocaleDateString()}</span>420 |                       )}421 |                       {pkg.paymentConfirmedAt && (422 |                         <span>Payment Confirmed: {new Date(pkg.paymentConfirmedAt).toLocaleDateString()}</span>423 |                       )}424 |                     </div>425 |                   </div>426 |                 ))}427 | 428 |                 {userPackages.length === 0 && (429 |                   <div className="text-center py-8 text-gray-400">430 |                     No packages purchased yet.431 |                   </div>432 |                 )}433 |               </div>434 |             </CardContent>435 |           </Card>436 |         </TabsContent>437 |       </Tabs>438 |     </div>439 |   );440 | }
============================================================END: frontend/components/PurchaseHistory.tsx============================================================


============================================================FILE: frontend/components/PurchaseHistoryManagement.tsxSIZE: 30.19 KB============================================================
  1 | import { useState, useEffect, useCallback } from 'react';  2 | import {  3 |   Package, Clock, DollarSign,  4 |   Download, RefreshCw,  5 |   CheckCircle,  6 |   Calendar  7 | } from 'lucide-react';  8 | import { BaseButton } from './ui/BaseButton';  9 | import { BaseInput } from './ui/BaseInput'; 10 | import { Card, CardContent, CardHeader, CardTitle, CardDescription } from './ui/card'; 11 | import { Badge } from './ui/badge'; 12 | import { Label } from './ui/label'; 13 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select'; 14 | import { Tabs, TabsContent, TabsList, TabsTrigger } from './ui/tabs'; 15 | import { toast } from 'sonner'; 16 |  17 | import { useAuth } from '../hooks/useAuth'; 18 |  19 | interface Client { 20 |   id: number; 21 |   name: string; 22 |   email: string; 23 |   phone?: string; 24 |   status: string; 25 | } 26 |  27 | interface PackageDefinition { 28 |   id: number; 29 |   name: string; 30 |   description: string; 31 |   sessions_count: number; 32 |   package_type: 'individual' | 'group' | 'mixed'; 33 |   max_group_size: number; 34 |   session_durations: { 35 |     id: number; 36 |     name: string; 37 |     duration_minutes: number; 38 |   }; 39 | } 40 |  41 | interface PackagePrice { 42 |   id: number; 43 |   price: number; 44 |   pricing_mode: 'custom' | 'calculated'; 45 |   is_active: boolean; 46 |   currencies: { 47 |     id: number; 48 |     code: string; 49 |     name: string; 50 |     symbol: string; 51 |     exchange_rate: number; 52 |   }; 53 | } 54 |  55 | interface UserPackage { 56 |   id: number; 57 |   client_id: number; 58 |   package_price_id: number; 59 |   sessions_remaining: number; 60 |   sessions_used: number; 61 |   is_active: boolean; 62 |   created_at: string; 63 |   updated_at: string; 64 |   clients?: Client; 65 |   package_definitions?: PackageDefinition; 66 |   package_prices?: PackagePrice; 67 | } 68 |  69 | interface Booking { 70 |   id: number; 71 |   client_id: number; 72 |   clientEmail: string; 73 |   schedule_slot_id: number; 74 |   user_package_id: number; 75 |   booking_type: 'individual' | 'group'; 76 |   group_size?: number; 77 |   status: 'pending' | 'confirmed' | 'completed' | 'cancelled' | 'no-show'; 78 |   notes?: string; 79 |   total_amount?: number; 80 |   discount_amount: number; 81 |   final_amount?: number; 82 |   created_at: string; 83 |   updated_at: string; 84 |   clients?: Client; 85 |   user_packages?: UserPackage; 86 |   schedule_slots?: { 87 |     id: number; 88 |     start_time: string; 89 |     end_time: string; 90 |     capacity: number; 91 |     booked_count: number; 92 |   }; 93 | } 94 |  95 | interface PurchaseStats { 96 |   totalRevenue: number; 97 |   totalPackages: number; 98 |   totalSessions: number; 99 |   activePackages: number;100 |   expiredPackages: number;101 |   averagePackageValue: number;102 |   topPerformingPackages: Array<{103 |     name: string;104 |     revenue: number;105 |     count: number;106 |   }>;107 |   monthlyRevenue: Array<{108 |     month: string;109 |     revenue: number;110 |     packages: number;111 |   }>;112 | }113 | 114 | interface Filters {115 |   clientId: string;116 |   packageType: string;117 |   status: string;118 |   dateFrom: string;119 |   dateTo: string;120 |   paymentStatus: string;121 | }122 | 123 | const PurchaseHistoryManagement: React.FC = () => {124 |   const { user } = useAuth();125 |   const [activeTab, setActiveTab] = useState('packages');126 |   const [loading, setLoading] = useState(true);127 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null);128 |   const [userPackages, setUserPackages] = useState<UserPackage[]>([]);129 |   const [bookings, setBookings] = useState<Booking[]>([]);130 |   const [clients, setClients] = useState<Client[]>([]);131 |   const [stats, setStats] = useState<PurchaseStats | null>(null);132 |   const [filters, setFilters] = useState<Filters>({133 |     clientId: 'all',134 |     packageType: 'all',135 |     status: 'all',136 |     dateFrom: '',137 |     dateTo: '',138 |     paymentStatus: 'all'139 |   });140 | 141 |   const fetchUserPackages = useCallback(async () => {142 |     try {143 |       const params = new URLSearchParams();144 |       if (filters.clientId !== 'all') params.append('client_id', filters.clientId);145 |       if (filters.packageType !== 'all') params.append('package_type', filters.packageType);146 |       if (filters.status !== 'all') params.append('is_active', filters.status === 'active' ? 'true' : 'false');147 |       if (filters.dateFrom) params.append('date_from', filters.dateFrom);148 |       if (filters.dateTo) params.append('date_to', filters.dateTo);149 | 150 |       const response = await fetch(`/api/admin/user-packages?${params}`, {151 |         headers: {152 |           'Authorization': `Bearer ${user!.access_token}`,153 |           'Content-Type': 'application/json'154 |         }155 |       });156 | 157 |       const data = await response.json();158 |       if (data.success) {159 |         setUserPackages(data.data);160 |       } else {161 |         toast.error('Failed to fetch user packages');162 |       }163 |     } catch (error) {164 |       }165 |   }, [user, filters]);166 | 167 |   const fetchBookings = useCallback(async () => {168 |     try {169 |       const params = new URLSearchParams();170 |       if (filters.clientId !== 'all') params.append('client_id', filters.clientId);171 |       if (filters.packageType !== 'all') params.append('package_type', filters.packageType);172 |       if (filters.status !== 'all') params.append('is_active', filters.status === 'active' ? 'true' : 'false');173 |       if (filters.dateFrom) params.append('date_from', filters.dateFrom);174 |       if (filters.dateTo) params.append('date_to', filters.dateTo);175 | 176 |       const response = await fetch(`/api/admin/bookings?${params}`, {177 |         headers: {178 |           'Authorization': `Bearer ${user!.access_token}`,179 |           'Content-Type': 'application/json'180 |         }181 |       });182 | 183 |       const data = await response.json();184 |       if (data.success) {185 |         setBookings(data.data);186 |       } else {187 |         toast.error('Failed to fetch bookings');188 |       }189 |     } catch (error) {190 |       }191 |   }, [user, filters]);192 | 193 |   const fetchClients = useCallback(async () => {194 |     try {195 |       const response = await fetch('/api/admin/clients', {196 |         headers: {197 |           'Authorization': `Bearer ${user!.access_token}`,198 |           'Content-Type': 'application/json'199 |         }200 |       });201 | 202 |       const data = await response.json();203 |       if (data.success) {204 |         setClients(data.data);205 |       } else {206 |         toast.error('Failed to fetch clients');207 |       }208 |     } catch (error) {209 |       }210 |   }, [user]);211 | 212 |   const fetchStats = useCallback(async () => {213 |     try {214 |       const response = await fetch('/api/admin/stats', {215 |         headers: {216 |           'Authorization': `Bearer ${user!.access_token}`,217 |           'Content-Type': 'application/json'218 |         }219 |       });220 | 221 |       const data = await response.json();222 |       if (data.success) {223 |         setStats(data.data);224 |       } else {225 |         toast.error('Failed to fetch stats');226 |       }227 |     } catch (error) {228 |       }229 |   }, [user]);230 | 231 |   const fetchData = useCallback(async () => {232 |     try {233 |       if (!user?.access_token) {234 |         return;235 |       }236 | 237 |       setLoading(true);238 |       await Promise.all([239 |         fetchUserPackages(),240 |         fetchBookings(),241 |         fetchClients(),242 |         fetchStats()243 |       ]);244 | 245 |       setLastLoaded(new Date());246 |       } catch (error) {247 |       toast.error('Failed to fetch data');248 |     } finally {249 |       setLoading(false);250 |     }251 |   }, [user, fetchBookings, fetchClients, fetchStats, fetchUserPackages]);252 | 253 |   const refreshPurchaseHistoryData = useCallback(() => {254 |     if (user?.access_token) {255 |       fetchData();256 |     }257 |   }, [user?.access_token, fetchData]);258 | 259 |   useEffect(() => {260 |     if (user?.access_token) {261 |       fetchData();262 |     } else {263 |       setUserPackages([]);264 |       setBookings([]);265 |       setClients([]);266 |       setStats(null);267 |       setLoading(false);268 |     }269 |   }, [user?.access_token, fetchData]);270 | 271 |   useEffect(() => {272 |     const handleVisibilityChange = () => {273 |       if (document.visibilityState === 'visible' && user?.access_token && userPackages.length === 0) {274 |         fetchData();275 |       }276 |     };277 | 278 |     document.addEventListener('visibilitychange', handleVisibilityChange);279 |     return () => document.removeEventListener('visibilitychange', handleVisibilityChange);280 |   }, [user?.access_token, userPackages.length, fetchData]);281 | 282 |   useEffect(() => {283 |     if (user?.access_token && userPackages.length === 0) {284 |       fetchData();285 |     }286 |   }, [user?.access_token, userPackages.length, fetchData]);287 | 288 |   useEffect(() => {289 | 290 |     window.refreshPurchaseHistoryData = refreshPurchaseHistoryData;291 | 292 |     return () => {293 | 294 |       delete window.refreshPurchaseHistoryData;295 |     };296 |   }, [refreshPurchaseHistoryData]);297 | 298 |   useEffect(() => {299 |     const handleNavigation = () => {300 | 301 |       setTimeout(() => {302 |         if (user?.access_token && userPackages.length === 0) {303 |           fetchData();304 |         }305 |       }, 100);306 |     };307 | 308 |     window.addEventListener('popstate', handleNavigation);309 |     return () => window.removeEventListener('popstate', handleNavigation);310 |   }, [user?.access_token, userPackages.length, fetchData]);311 | 312 |   const getPackageTypeBadge = (type: string) => {313 |     const variants = {314 |       individual: 'dashboard-badge-info',315 |       group: 'dashboard-badge-success',316 |       mixed: 'dashboard-badge-warning'317 |     };318 |     return <Badge className={variants[type as keyof typeof variants]}>{type}</Badge>;319 |   };320 | 321 |   const getStatusBadge = (status: string) => {322 |     const variants = {323 |       pending: 'dashboard-badge-warning',324 |       confirmed: 'dashboard-badge-info',325 |       completed: 'dashboard-badge-success',326 |       cancelled: 'dashboard-badge-error',327 |       'no-show': 'dashboard-badge-error'328 |     };329 |     return <Badge className={variants[status as keyof typeof variants]}>{status}</Badge>;330 |   };331 | 332 |   const getPaymentStatusBadge = (isActive: boolean) => {333 |     return isActive ?334 |       <Badge className="dashboard-badge-success">Active</Badge> :335 |       <Badge className="dashboard-badge-error">Inactive</Badge>;336 |   };337 | 338 |   const formatDate = (dateString: string) => {339 |     return new Date(dateString).toLocaleDateString('en-US', {340 |       year: 'numeric',341 |       month: 'short',342 |       day: 'numeric'343 |     });344 |   };345 | 346 |   const formatDateTime = (dateString: string) => {347 |     return new Date(dateString).toLocaleString('en-US', {348 |       year: 'numeric',349 |       month: 'short',350 |       day: 'numeric',351 |       hour: 'numeric',352 |       minute: '2-digit',353 |       hour12: true354 |     });355 |   };356 | 357 |   const formatCurrency = (amount: number, currencySymbol: string) => {358 |     return `${currencySymbol}${amount.toFixed(2)}`;359 |   };360 | 361 |   const exportData = (type: 'packages' | 'bookings') => {362 | 363 |     toast.info(`Exporting ${type} data...`);364 |   };365 | 366 |   if (loading) {367 |     return (368 |       <div className="flex items-center justify-center min-h-[400px]">369 |         <div className="text-center">370 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>371 |           <p className="text-[#FFD700] text-lg font-semibold">Loading purchase history...</p>372 |         </div>373 |       </div>374 |     );375 |   }376 | 377 |   return (378 |     <div className="dashboard-container p-6 space-y-6">379 |       <div className="flex items-center justify-between">380 |         <div>381 |           <h1 className="dashboard-text-primary text-3xl font-bold">Purchase History & Analytics</h1>382 |           <p className="dashboard-text-secondary">Track package purchases, usage patterns, and revenue analytics</p>383 |           {lastLoaded && (384 |             <p className="text-sm text-gray-400 mt-1">385 |               Last updated: {lastLoaded.toLocaleTimeString()}386 |             </p>387 |           )}388 |         </div>389 |         <div className="flex gap-2">390 |           <BaseButton391 |             onClick={() => exportData(activeTab as 'packages' | 'bookings')}392 |             className="dashboard-button-outline"393 |           >394 |             <Download className="w-4 h-4 mr-2" />395 |             Export396 |           </BaseButton>397 |           <BaseButton398 |             onClick={refreshPurchaseHistoryData}399 |             disabled={loading}400 |             className="dashboard-button-reload"401 |           >402 |             <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />403 |             Refresh404 |           </BaseButton>405 |         </div>406 |       </div>407 | 408 |       {}409 |       {stats && (410 |         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">411 |           <Card className="dashboard-card">412 |             <CardContent className="p-4">413 |               <div className="flex items-center justify-between">414 |                 <div>415 |                   <p className="text-sm font-medium text-dashboard-text-secondary">Total Revenue</p>416 |                   <p className="text-2xl font-bold text-dashboard-text-primary">417 |                     ${stats.totalRevenue.toLocaleString()}418 |                   </p>419 |                 </div>420 |                 <DollarSign className="w-8 h-8 text-dashboard-accent" />421 |               </div>422 |             </CardContent>423 |           </Card>424 | 425 |           <Card className="dashboard-card">426 |             <CardContent className="p-4">427 |               <div className="flex items-center justify-between">428 |                 <div>429 |                   <p className="text-sm font-medium text-dashboard-text-secondary">Total Packages</p>430 |                   <p className="text-2xl font-bold text-dashboard-text-primary">431 |                     {stats.totalPackages}432 |                   </p>433 |                 </div>434 |                 <Package className="w-8 h-8 text-dashboard-accent" />435 |               </div>436 |             </CardContent>437 |           </Card>438 | 439 |           <Card className="dashboard-card">440 |             <CardContent className="p-4">441 |               <div className="flex items-center justify-between">442 |                 <div>443 |                   <p className="text-sm font-medium text-dashboard-text-secondary">Active Packages</p>444 |                   <p className="text-2xl font-bold text-dashboard-text-primary">445 |                     {stats.activePackages}446 |                   </p>447 |                 </div>448 |                 <CheckCircle className="w-8 h-8 text-dashboard-accent" />449 |               </div>450 |             </CardContent>451 |           </Card>452 | 453 |           <Card className="dashboard-card">454 |             <CardContent className="p-4">455 |               <div className="flex items-center justify-between">456 |                 <div>457 |                   <p className="text-sm font-medium text-dashboard-text-secondary">Total Sessions</p>458 |                   <p className="text-2xl font-bold text-dashboard-text-primary">459 |                     {stats.totalSessions}460 |                   </p>461 |                 </div>462 |                 <Clock className="w-8 h-8 text-dashboard-accent" />463 |               </div>464 |             </CardContent>465 |           </Card>466 |         </div>467 |       )}468 | 469 |       {}470 |       <Card className="dashboard-card">471 |         <CardHeader>472 |           <CardTitle className="dashboard-card-title">Filters</CardTitle>473 |         </CardHeader>474 |         <CardContent>475 |           <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">476 |             <div className="space-y-2">477 |               <Label className="dashboard-label">Client</Label>478 |               <Select479 |                 value={filters.clientId}480 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, clientId: value }))}481 |               >482 |                 <SelectTrigger className="dashboard-input">483 |                   <SelectValue placeholder="All clients" />484 |                 </SelectTrigger>485 |                 <SelectContent>486 |                   <SelectItem value="all">All clients</SelectItem>487 |                   {clients.map((client) => (488 |                     <SelectItem key={client.id} value={client.id.toString()}>489 |                       {client.name}490 |                     </SelectItem>491 |                   ))}492 |                 </SelectContent>493 |               </Select>494 |             </div>495 | 496 |             <div className="space-y-2">497 |               <Label className="dashboard-label">Package Type</Label>498 |               <Select499 |                 value={filters.packageType}500 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, packageType: value }))}501 |               >502 |                 <SelectTrigger className="dashboard-input">503 |                   <SelectValue placeholder="All types" />504 |                 </SelectTrigger>505 |                 <SelectContent>506 |                   <SelectItem value="all">All types</SelectItem>507 |                   <SelectItem value="individual">Individual</SelectItem>508 |                   <SelectItem value="group">Group</SelectItem>509 |                   <SelectItem value="mixed">Mixed</SelectItem>510 |                 </SelectContent>511 |               </Select>512 |             </div>513 | 514 |             <div className="space-y-2">515 |               <Label className="dashboard-label">Status</Label>516 |               <Select517 |                 value={filters.status}518 |                 onValueChange={(value) => setFilters(prev => ({ ...prev, status: value }))}519 |               >520 |                 <SelectTrigger className="dashboard-input">521 |                   <SelectValue placeholder="All statuses" />522 |                 </SelectTrigger>523 |                 <SelectContent>524 |                   <SelectItem value="all">All statuses</SelectItem>525 |                   <SelectItem value="active">Active</SelectItem>526 |                   <SelectItem value="inactive">Inactive</SelectItem>527 |                 </SelectContent>528 |               </Select>529 |             </div>530 | 531 |             <div className="space-y-2">532 |               <Label className="dashboard-label">Date From</Label>533 |               <BaseInput534 |                 type="date"535 |                 className="dashboard-input"536 |                 value={filters.dateFrom}537 |                 onChange={(e) => setFilters(prev => ({ ...prev, dateFrom: e.target.value }))}538 |               />539 |             </div>540 | 541 |             <div className="space-y-2">542 |               <Label className="dashboard-label">Date To</Label>543 |               <BaseInput544 |                 type="date"545 |                 className="dashboard-input"546 |                 value={filters.dateTo}547 |                 onChange={(e) => setFilters(prev => ({ ...prev, dateTo: e.target.value }))}548 |               />549 |             </div>550 |           </div>551 |         </CardContent>552 |       </Card>553 | 554 |       {}555 |       <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">556 |         <TabsList className="grid w-full grid-cols-2 dashboard-tabs">557 |           <TabsTrigger value="packages" className="dashboard-tab">558 |             <Package className="w-4 h-4 mr-2" />559 |             Package Purchases560 |           </TabsTrigger>561 |           <TabsTrigger value="bookings" className="dashboard-tab">562 |             <Calendar className="w-4 h-4 mr-2" />563 |             Session Bookings564 |           </TabsTrigger>565 |         </TabsList>566 | 567 |         {}568 |         <TabsContent value="packages" className="space-y-4">569 |           <Card className="dashboard-card">570 |             <CardHeader>571 |               <CardTitle className="dashboard-card-title">Package Purchases</CardTitle>572 |               <CardDescription>573 |                 Showing {userPackages.length} package purchases574 |               </CardDescription>575 |             </CardHeader>576 |             <CardContent>577 |               {userPackages.length === 0 ? (578 |                 <div className="text-center py-8">579 |                   <Package className="w-12 h-12 text-gray-400 mx-auto mb-4" />580 |                   <p className="text-gray-600">No package purchases found</p>581 |                   <p className="text-sm text-gray-500 mt-2">Try adjusting your filters</p>582 |                 </div>583 |               ) : (584 |                 <div className="overflow-x-auto">585 |                   <table className="w-full">586 |                     <thead>587 |                       <tr className="border-b border-gray-200">588 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Client</th>589 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Package</th>590 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Type</th>591 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Price</th>592 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Sessions</th>593 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Status</th>594 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Purchase Date</th>595 |                       </tr>596 |                     </thead>597 |                     <tbody>598 |                       {userPackages.map((userPackage) => (599 |                         <tr key={userPackage.id} className="border-b border-gray-100 hover:bg-gray-50">600 |                           <td className="py-3 px-4">601 |                             <div>602 |                                                           <p className="font-medium text-dashboard-text-primary">{userPackage.clients?.name || 'Unknown Client'}</p>603 |                             <p className="text-sm text-dashboard-text-secondary">{userPackage.clients?.email || 'No email'}</p>604 |                             </div>605 |                           </td>606 |                           <td className="py-3 px-4">607 |                             <div>608 |                               <p className="font-medium text-dashboard-text-primary">609 |                                 {userPackage.package_definitions?.name || 'No package'}610 |                               </p>611 |                               <p className="text-sm text-dashboard-text-secondary">612 |                                 {userPackage.package_definitions?.description || 'No description'}613 |                               </p>614 |                             </div>615 |                           </td>616 |                           <td className="py-3 px-4">617 |                                                           {getPackageTypeBadge(userPackage.package_definitions?.package_type || 'individual')}618 |                           </td>619 |                           <td className="py-3 px-4">620 |                             <div>621 |                               <p className="font-medium text-dashboard-text-primary">622 |                                 {formatCurrency(userPackage.package_prices?.price || 0, userPackage.package_prices?.currencies?.symbol || '$')}623 |                               </p>624 |                               <p className="text-sm text-dashboard-text-secondary">625 |                                 {userPackage.package_prices?.pricing_mode || 'custom'}626 |                               </p>627 |                             </div>628 |                           </td>629 |                           <td className="py-3 px-4">630 |                             <div>631 |                               <p className="font-medium text-dashboard-text-primary">632 |                                 {userPackage.sessions_remaining} remaining633 |                               </p>634 |                               <p className="text-sm text-dashboard-text-secondary">635 |                                 {userPackage.sessions_used} used of {userPackage.package_definitions?.sessions_count || 0}636 |                               </p>637 |                             </div>638 |                           </td>639 |                           <td className="py-3 px-4">640 |                             {getPaymentStatusBadge(userPackage.is_active)}641 |                           </td>642 |                           <td className="py-3 px-4">643 |                             <p className="text-sm text-dashboard-text-secondary">644 |                               {formatDate(userPackage.created_at)}645 |                             </p>646 |                           </td>647 |                         </tr>648 |                       ))}649 |                     </tbody>650 |                   </table>651 |                 </div>652 |               )}653 |             </CardContent>654 |           </Card>655 |         </TabsContent>656 | 657 |         {}658 |         <TabsContent value="bookings" className="space-y-4">659 |           <Card className="dashboard-card">660 |             <CardHeader>661 |               <CardTitle className="dashboard-card-title">Session Bookings</CardTitle>662 |               <CardDescription>663 |                 Showing {bookings.length} session bookings664 |               </CardDescription>665 |             </CardHeader>666 |             <CardContent>667 |               {bookings.length === 0 ? (668 |                 <div className="text-center py-8">669 |                   <Calendar className="w-12 h-12 text-gray-400 mx-auto mb-4" />670 |                   <p className="text-gray-600">No session bookings found</p>671 |                   <p className="text-sm text-gray-500 mt-2">Try adjusting your filters</p>672 |                 </div>673 |               ) : (674 |                 <div className="overflow-x-auto">675 |                   <table className="w-full">676 |                     <thead>677 |                       <tr className="border-b border-gray-200">678 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Client</th>679 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Package</th>680 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Type</th>681 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Date & Time</th>682 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Status</th>683 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Amount</th>684 |                         <th className="text-left py-3 px-4 font-medium text-dashboard-text-secondary">Created</th>685 |                       </tr>686 |                     </thead>687 |                     <tbody>688 |                       {bookings.map((booking) => (689 |                         <tr key={booking.id} className="border-b border-gray-100 hover:bg-gray-50">690 |                           <td className="py-3 px-4">691 |                             <div>692 |                               <p className="font-medium text-dashboard-text-primary">693 |                                 {booking.clients?.name || booking.clientEmail || 'Unknown Client'}694 |                               </p>695 |                               <p className="text-sm text-dashboard-text-secondary">696 |                                 {booking.clients?.email || booking.clientEmail || 'No email'}697 |                               </p>698 |                             </div>699 |                           </td>700 |                           <td className="py-3 px-4">701 |                             <div>702 |                               <p className="font-medium text-dashboard-text-primary">703 |                                 {booking.user_packages?.package_definitions?.name || 'No package'}704 |                               </p>705 |                               <p className="text-sm text-dashboard-text-secondary">706 |                                 {booking.user_packages?.package_definitions?.session_durations?.duration_minutes || '0'} min707 |                               </p>708 |                             </div>709 |                           </td>710 |                           <td className="py-3 px-4">711 |                             <div>712 |                               {getPackageTypeBadge(booking.booking_type)}713 |                               {booking.booking_type === 'group' && booking.group_size && (714 |                                 <p className="text-sm text-dashboard-text-secondary mt-1">715 |                                   Size: {booking.group_size}716 |                                 </p>717 |                               )}718 |                             </div>719 |                           </td>720 |                           <td className="py-3 px-4">721 |                             <div>722 |                               <p className="font-medium text-dashboard-text-primary">723 |                                 {booking.schedule_slots ? formatDate(booking.schedule_slots.start_time) : 'No slot'}724 |                               </p>725 |                               <p className="text-sm text-dashboard-text-secondary">726 |                                 {booking.schedule_slots ? formatDateTime(booking.schedule_slots.start_time) : 'No time'}727 |                               </p>728 |                             </div>729 |                           </td>730 |                           <td className="py-3 px-4">731 |                             {getStatusBadge(booking.status)}732 |                           </td>733 |                           <td className="py-3 px-4">734 |                             {booking.final_amount ? (735 |                               <div>736 |                                 <p className="font-medium text-dashboard-text-primary">737 |                                   ${booking.final_amount}738 |                                 </p>739 |                                 {booking.discount_amount > 0 && (740 |                                   <p className="text-sm text-dashboard-text-secondary">741 |                                     -${booking.discount_amount} discount742 |                                   </p>743 |                                 )}744 |                               </div>745 |                             ) : (746 |                               <span className="text-dashboard-text-secondary">Not set</span>747 |                             )}748 |                           </td>749 |                           <td className="py-3 px-4">750 |                             <p className="text-sm text-dashboard-text-secondary">751 |                               {formatDate(booking.created_at)}752 |                             </p>753 |                           </td>754 |                         </tr>755 |                       ))}756 |                     </tbody>757 |                   </table>758 |                 </div>759 |               )}760 |             </CardContent>761 |           </Card>762 |         </TabsContent>763 |       </Tabs>764 |     </div>765 |   );766 | };767 | 768 | export default PurchaseHistoryManagement;
============================================================END: frontend/components/PurchaseHistoryManagement.tsx============================================================


============================================================FILE: frontend/components/RasaModelTuning.tsxSIZE: 22.87 KB============================================================
  1 | import React, { useState, useEffect, useCallback } from 'react';  2 | import {  3 |   Settings,  4 |   Play,  5 |   Download,  6 |   RefreshCw,  7 |   AlertCircle,  8 |   CheckCircle,  9 |   Brain, 10 |   Target, 11 |   BarChart3, 12 |   Save, 13 |   RotateCcw 14 | } from 'lucide-react'; 15 |  16 | interface ModelConfig { 17 |   pipeline: Array<{ 18 |     name: string; 19 |     [key: string]: unknown; 20 |   }>; 21 |   policies: Array<{ 22 |     name: string; 23 |     [key: string]: unknown; 24 |   }>; 25 |   language: string; 26 |   assistant_id: string; 27 | } 28 |  29 | interface TrainingProgress { 30 |   status: 'idle' | 'training' | 'completed' | 'error'; 31 |   progress: number; 32 |   message: string; 33 |   modelVersion?: string; 34 |   error?: string; 35 | } 36 |  37 | interface ModelComparison { 38 |   modelName: string; 39 |   accuracy: number; 40 |   processingTime: number; 41 |   confidence: number; 42 |   timestamp: string; 43 | } 44 |  45 | export function RasaModelTuning() { 46 |   const [activeTab, setActiveTab] = useState('config'); 47 |   const [config, setConfig] = useState<ModelConfig | null>(null); 48 |   const [trainingProgress, setTrainingProgress] = useState<TrainingProgress>({ 49 |     status: 'idle', 50 |     progress: 0, 51 |     message: 'Ready to train' 52 |   }); 53 |   const [modelComparisons, setModelComparisons] = useState<ModelComparison[]>([]); 54 |   const [isEditing, setIsEditing] = useState(false); 55 |   const [configText, setConfigText] = useState(''); 56 |  57 |   const tabs = [ 58 |     { id: 'config', label: 'Model Configuration', icon: Settings }, 59 |     { id: 'training', label: 'Training', icon: Play }, 60 |     { id: 'comparison', label: 'Model Comparison', icon: BarChart3 }, 61 |     { id: 'evaluation', label: 'Evaluation', icon: Target } 62 |   ]; 63 |  64 |   const predefinedConfigs = { 65 |     'high-precision': { 66 |       name: 'High Precision', 67 |       description: 'Maximum accuracy, slower processing', 68 |       config: { 69 |         pipeline: [ 70 |           { name: 'WhitespaceTokenizer' }, 71 |           { name: 'RegexFeaturizer', case_sensitive: false }, 72 |           { name: 'LexicalSyntacticFeaturizer' }, 73 |           { name: 'CountVectorsFeaturizer', analyzer: 'char_wb', min_ngram: 1, max_ngram: 5 }, 74 |           { name: 'DIETClassifier', epochs: 200, entity_recognition: true, intent_classification: true, use_masked_language_model: true, constrain_similarities: true, model_confidence: 'softmax', random_seed: 42 }, 75 |           { name: 'EntitySynonymMapper' }, 76 |           { name: 'ResponseSelector', epochs: 200, constrain_similarities: true, retrieval_intent: 'chitchat/ask_name', use_gpu: false } 77 |         ], 78 |         policies: [ 79 |           { name: 'MemoizationPolicy', max_history: 5 }, 80 |           { name: 'RulePolicy' }, 81 |           { name: 'UnexpecTEDIntentPolicy', max_history: 5, epochs: 100, use_gpu: false }, 82 |           { name: 'TEDPolicy', max_history: 5, epochs: 100, constrain_similarities: true, use_gpu: false, model_confidence: 'softmax', random_seed: 42 } 83 |         ], 84 |         language: 'es', 85 |         assistant_id: 'soulpath-rasa' 86 |       } 87 |     }, 88 |     'balanced': { 89 |       name: 'Balanced', 90 |       description: 'Good balance of speed and accuracy', 91 |       config: { 92 |         pipeline: [ 93 |           { name: 'WhitespaceTokenizer' }, 94 |           { name: 'RegexFeaturizer', case_sensitive: false }, 95 |           { name: 'LexicalSyntacticFeaturizer' }, 96 |           { name: 'CountVectorsFeaturizer', analyzer: 'char_wb', min_ngram: 1, max_ngram: 3 }, 97 |           { name: 'DIETClassifier', epochs: 50, entity_recognition: true, intent_classification: true, use_masked_language_model: false, constrain_similarities: true, model_confidence: 'softmax', random_seed: 42 }, 98 |           { name: 'EntitySynonymMapper' }, 99 |           { name: 'ResponseSelector', epochs: 50, constrain_similarities: true, retrieval_intent: 'chitchat/ask_name', use_gpu: false }100 |         ],101 |         policies: [102 |           { name: 'MemoizationPolicy', max_history: 3 },103 |           { name: 'RulePolicy' },104 |           { name: 'UnexpecTEDIntentPolicy', max_history: 3, epochs: 50, use_gpu: false },105 |           { name: 'TEDPolicy', max_history: 3, epochs: 50, constrain_similarities: true, use_gpu: false, model_confidence: 'softmax', random_seed: 42 }106 |         ],107 |         language: 'es',108 |         assistant_id: 'soulpath-rasa'109 |       }110 |     },111 |     'high-speed': {112 |       name: 'High Speed',113 |       description: 'Fast processing, lower accuracy',114 |       config: {115 |         pipeline: [116 |           { name: 'WhitespaceTokenizer' },117 |           { name: 'RegexFeaturizer', case_sensitive: false },118 |           { name: 'CountVectorsFeaturizer', analyzer: 'char_wb', min_ngram: 1, max_ngram: 2 },119 |           { name: 'DIETClassifier', epochs: 20, entity_recognition: true, intent_classification: true, use_masked_language_model: false, constrain_similarities: false, model_confidence: 'softmax', random_seed: 42 }120 |         ],121 |         policies: [122 |           { name: 'MemoizationPolicy', max_history: 2 },123 |           { name: 'RulePolicy' },124 |           { name: 'UnexpecTEDIntentPolicy', max_history: 2, epochs: 20, use_gpu: false },125 |           { name: 'TEDPolicy', max_history: 2, epochs: 20, constrain_similarities: false, use_gpu: false, model_confidence: 'softmax', random_seed: 42 }126 |         ],127 |         language: 'es',128 |         assistant_id: 'soulpath-rasa'129 |       }130 |     }131 |   };132 | 133 |   const loadCurrentConfig = useCallback(async () => {134 |     try {135 |       const response = await fetch('/api/admin/rasa?action=model-info');136 |       const data = await response.json();137 |       if (data.success && data.data.currentModel) {138 | 139 |         setConfig(predefinedConfigs.balanced.config);140 |         setConfigText(JSON.stringify(predefinedConfigs.balanced.config, null, 2));141 |       }142 |     } catch (error) {143 |       }144 |   }, [predefinedConfigs.balanced.config]);145 | 146 |   const loadModelComparisons = async () => {147 | 148 |     setModelComparisons([149 |       {150 |         modelName: 'nlu-20250906-160155-amicable-rasp',151 |         accuracy: 94.2,152 |         processingTime: 245,153 |         confidence: 0.87,154 |         timestamp: '2025-01-06T16:01:55Z'155 |       },156 |       {157 |         modelName: 'nlu-20250905-120000-previous-model',158 |         accuracy: 91.8,159 |         processingTime: 198,160 |         confidence: 0.84,161 |         timestamp: '2025-01-05T12:00:00Z'162 |       }163 |     ]);164 |   };165 | 166 |   useEffect(() => {167 |     loadCurrentConfig();168 |     loadModelComparisons();169 |   }, [loadCurrentConfig]);170 | 171 |   const startTraining = async () => {172 |     setTrainingProgress({173 |       status: 'training',174 |       progress: 0,175 |       message: 'Starting training...'176 |     });177 | 178 |     const interval = setInterval(() => {179 |       setTrainingProgress(prev => {180 |         if (prev.progress >= 100) {181 |           clearInterval(interval);182 |           return {183 |             status: 'completed',184 |             progress: 100,185 |             message: 'Training completed successfully!',186 |             modelVersion: `nlu-${Date.now()}-trained-model`187 |           };188 |         }189 |         return {190 |           ...prev,191 |           progress: prev.progress + Math.random() * 10,192 |           message: `Training in progress... ${Math.round(prev.progress)}%`193 |         };194 |       });195 |     }, 1000);196 |   };197 | 198 |   const applyPredefinedConfig = (configKey: keyof typeof predefinedConfigs) => {199 |     const predefinedConfig = predefinedConfigs[configKey];200 |     setConfig(predefinedConfig.config);201 |     setConfigText(JSON.stringify(predefinedConfig.config, null, 2));202 |     setIsEditing(false);203 |   };204 | 205 |   const saveConfig = () => {206 |     try {207 |       const parsedConfig = JSON.parse(configText);208 |       setConfig(parsedConfig);209 |       setIsEditing(false);210 | 211 |     } catch {212 |       alert('Invalid JSON configuration');213 |     }214 |   };215 | 216 |   const resetConfig = () => {217 |     if (config) {218 |       setConfigText(JSON.stringify(config, null, 2));219 |       setIsEditing(false);220 |     }221 |   };222 | 223 |   const runEvaluation = async () => {224 | 225 |     alert('Evaluation started. This would run actual Rasa evaluation commands.');226 |   };227 | 228 |   const downloadModel = (modelName: string) => {229 | 230 |     alert(`Downloading model: ${modelName}`);231 |   };232 | 233 |   return (234 |     <div className="space-y-6">235 |       {}236 |       <div className="flex items-center justify-between">237 |         <div className="flex items-center space-x-3">238 |           <div className="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center">239 |             <Brain className="w-6 h-6 text-white" />240 |           </div>241 |           <div>242 |             <h2 className="text-2xl font-bold text-[var(--color-text-primary)]">243 |               Rasa Model Tuning244 |             </h2>245 |             <p className="text-[var(--color-text-secondary)]">246 |               Configure, train, and optimize your AI models247 |             </p>248 |           </div>249 |         </div>250 |       </div>251 | 252 |       {}253 |       <div className="flex space-x-1 bg-[var(--color-background-secondary)] p-1 rounded-lg">254 |         {tabs.map((tab) => {255 |           const Icon = tab.icon;256 |           return (257 |             <button258 |               key={tab.id}259 |               onClick={() => setActiveTab(tab.id)}260 |               className={`flex items-center space-x-2 px-4 py-2 rounded-md transition-colors ${261 |                 activeTab === tab.id262 |                   ? 'bg-purple-600 text-white'263 |                   : 'text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background-primary)]'264 |               }`}265 |             >266 |               <Icon className="w-4 h-4" />267 |               <span>{tab.label}</span>268 |             </button>269 |           );270 |         })}271 |       </div>272 | 273 |       {}274 |       <div className="bg-[var(--color-background-primary)] rounded-lg border border-[var(--color-border-500)] p-6">275 |         {}276 |         {activeTab === 'config' && (277 |           <div className="space-y-6">278 |             <div className="flex items-center justify-between">279 |               <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">280 |                 Model Configuration281 |               </h3>282 |               <div className="flex space-x-2">283 |                 {isEditing ? (284 |                   <>285 |                     <button286 |                       onClick={saveConfig}287 |                       className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"288 |                     >289 |                       <Save className="w-4 h-4" />290 |                       <span>Save</span>291 |                     </button>292 |                     <button293 |                       onClick={resetConfig}294 |                       className="flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700"295 |                     >296 |                       <RotateCcw className="w-4 h-4" />297 |                       <span>Reset</span>298 |                     </button>299 |                   </>300 |                 ) : (301 |                   <button302 |                     onClick={() => setIsEditing(true)}303 |                     className="flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"304 |                   >305 |                     <Settings className="w-4 h-4" />306 |                     <span>Edit</span>307 |                   </button>308 |                 )}309 |               </div>310 |             </div>311 | 312 |             {}313 |             <div className="grid grid-cols-1 md:grid-cols-3 gap-4">314 |               {Object.entries(predefinedConfigs).map(([key, config]) => (315 |                 <div key={key} className="border border-[var(--color-border-500)] rounded-lg p-4">316 |                   <h4 className="font-semibold text-[var(--color-text-primary)] mb-2">317 |                     {config.name}318 |                   </h4>319 |                   <p className="text-sm text-[var(--color-text-secondary)] mb-4">320 |                     {config.description}321 |                   </p>322 |                   <button323 |                     onClick={() => applyPredefinedConfig(key as keyof typeof predefinedConfigs)}324 |                     className="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"325 |                   >326 |                     Apply Configuration327 |                   </button>328 |                 </div>329 |               ))}330 |             </div>331 | 332 |             {}333 |             <div className="space-y-4">334 |               <h4 className="font-semibold text-[var(--color-text-primary)]">335 |                 Current Configuration336 |               </h4>337 |               {isEditing ? (338 |                 <textarea339 |                   value={configText}340 |                   onChange={(e) => setConfigText(e.target.value)}341 |                   className="w-full h-96 p-4 border border-[var(--color-border-500)] rounded-lg bg-[var(--color-background-secondary)] text-[var(--color-text-primary)] font-mono text-sm"342 |                   placeholder="Enter your configuration JSON..."343 |                 />344 |               ) : (345 |                 <pre className="w-full h-96 p-4 border border-[var(--color-border-500)] rounded-lg bg-[var(--color-background-secondary)] text-[var(--color-text-primary)] font-mono text-sm overflow-auto">346 |                   {JSON.stringify(config, null, 2)}347 |                 </pre>348 |               )}349 |             </div>350 |           </div>351 |         )}352 | 353 |         {}354 |         {activeTab === 'training' && (355 |           <div className="space-y-6">356 |             <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">357 |               Model Training358 |             </h3>359 | 360 |             {}361 |             <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">362 |               <div className="flex items-center justify-between mb-4">363 |                 <h4 className="font-semibold text-[var(--color-text-primary)]">364 |                   Training Status365 |                 </h4>366 |                 <div className="flex items-center space-x-2">367 |                   {trainingProgress.status === 'training' && (368 |                     <RefreshCw className="w-4 h-4 animate-spin text-purple-600" />369 |                   )}370 |                   {trainingProgress.status === 'completed' && (371 |                     <CheckCircle className="w-4 h-4 text-green-500" />372 |                   )}373 |                   {trainingProgress.status === 'error' && (374 |                     <AlertCircle className="w-4 h-4 text-red-500" />375 |                   )}376 |                 </div>377 |               </div>378 | 379 |               <div className="space-y-4">380 |                 <div className="flex items-center justify-between">381 |                   <span className="text-[var(--color-text-secondary)]">Progress</span>382 |                   <span className="text-[var(--color-text-primary)] font-semibold">383 |                     {Math.round(trainingProgress.progress)}%384 |                   </span>385 |                 </div>386 |                 <div className="w-full bg-gray-200 rounded-full h-2">387 |                   <div388 |                     className="bg-purple-600 h-2 rounded-full transition-all duration-300"389 |                     style={{ width: `${trainingProgress.progress}%` }}390 |                   ></div>391 |                 </div>392 |                 <p className="text-[var(--color-text-secondary)] text-sm">393 |                   {trainingProgress.message}394 |                 </p>395 |                 {trainingProgress.modelVersion && (396 |                   <div className="flex items-center space-x-2 text-green-600">397 |                     <CheckCircle className="w-4 h-4" />398 |                     <span className="text-sm">Model: {trainingProgress.modelVersion}</span>399 |                   </div>400 |                 )}401 |               </div>402 |             </div>403 | 404 |             {}405 |             <div className="flex space-x-4">406 |               <button407 |                 onClick={startTraining}408 |                 disabled={trainingProgress.status === 'training'}409 |                 className="flex items-center space-x-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"410 |               >411 |                 <Play className="w-4 h-4" />412 |                 <span>Start Training</span>413 |               </button>414 |               <button415 |                 onClick={runEvaluation}416 |                 className="flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700"417 |               >418 |                 <Target className="w-4 h-4" />419 |                 <span>Run Evaluation</span>420 |               </button>421 |             </div>422 |           </div>423 |         )}424 | 425 |         {}426 |         {activeTab === 'comparison' && (427 |           <div className="space-y-6">428 |             <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">429 |               Model Comparison430 |             </h3>431 | 432 |             <div className="overflow-x-auto">433 |               <table className="w-full">434 |                 <thead>435 |                   <tr className="border-b border-[var(--color-border-500)]">436 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Model</th>437 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Accuracy</th>438 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Processing Time</th>439 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Confidence</th>440 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Created</th>441 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Actions</th>442 |                   </tr>443 |                 </thead>444 |                 <tbody>445 |                   {modelComparisons.map((model, index) => (446 |                     <tr key={index} className="border-b border-[var(--color-border-300)]">447 |                       <td className="py-3 px-4 text-[var(--color-text-primary)] font-medium">448 |                         {model.modelName}449 |                       </td>450 |                       <td className="py-3 px-4 text-[var(--color-text-primary)]">451 |                         <div className="flex items-center space-x-2">452 |                           <div className="w-16 bg-gray-200 rounded-full h-2">453 |                             <div454 |                               className="bg-green-500 h-2 rounded-full"455 |                               style={{ width: `${model.accuracy}%` }}456 |                             ></div>457 |                           </div>458 |                           <span>{model.accuracy}%</span>459 |                         </div>460 |                       </td>461 |                       <td className="py-3 px-4 text-[var(--color-text-secondary)]">462 |                         {model.processingTime}ms463 |                       </td>464 |                       <td className="py-3 px-4 text-[var(--color-text-secondary)]">465 |                         {(model.confidence * 100).toFixed(1)}%466 |                       </td>467 |                       <td className="py-3 px-4 text-[var(--color-text-secondary)]">468 |                         {new Date(model.timestamp).toLocaleDateString()}469 |                       </td>470 |                       <td className="py-3 px-4">471 |                         <button472 |                           onClick={() => downloadModel(model.modelName)}473 |                           className="flex items-center space-x-1 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"474 |                         >475 |                           <Download className="w-3 h-3" />476 |                           <span>Download</span>477 |                         </button>478 |                       </td>479 |                     </tr>480 |                   ))}481 |                 </tbody>482 |               </table>483 |             </div>484 |           </div>485 |         )}486 | 487 |         {}488 |         {activeTab === 'evaluation' && (489 |           <div className="space-y-6">490 |             <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">491 |               Model Evaluation492 |             </h3>493 | 494 |             <div className="grid grid-cols-1 md:grid-cols-2 gap-6">495 |               <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">496 |                 <h4 className="font-semibold text-[var(--color-text-primary)] mb-4">497 |                   NLU Evaluation498 |                 </h4>499 |                 <div className="space-y-3">500 |                   <div className="flex justify-between">501 |                     <span className="text-[var(--color-text-secondary)]">Intent Accuracy:</span>502 |                     <span className="text-[var(--color-text-primary)]">94.2%</span>503 |                   </div>504 |                   <div className="flex justify-between">505 |                     <span className="text-[var(--color-text-secondary)]">Entity F1-Score:</span>506 |                     <span className="text-[var(--color-text-primary)]">91.8%</span>507 |                   </div>508 |                   <div className="flex justify-between">509 |                     <span className="text-[var(--color-text-secondary)]">Response Time:</span>510 |                     <span className="text-[var(--color-text-primary)]">245ms</span>511 |                   </div>512 |                 </div>513 |                 <button514 |                   onClick={runEvaluation}515 |                   className="w-full mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"516 |                 >517 |                   Run NLU Evaluation518 |                 </button>519 |               </div>520 | 521 |               <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">522 |                 <h4 className="font-semibold text-[var(--color-text-primary)] mb-4">523 |                   Core Evaluation524 |                 </h4>525 |                 <div className="space-y-3">526 |                   <div className="flex justify-between">527 |                     <span className="text-[var(--color-text-secondary)]">Story Accuracy:</span>528 |                     <span className="text-[var(--color-text-primary)]">89.5%</span>529 |                   </div>530 |                   <div className="flex justify-between">531 |                     <span className="text-[var(--color-text-secondary)]">Action Accuracy:</span>532 |                     <span className="text-[var(--color-text-primary)]">92.1%</span>533 |                   </div>534 |                   <div className="flex justify-between">535 |                     <span className="text-[var(--color-text-secondary)]">Fallback Rate:</span>536 |                     <span className="text-[var(--color-text-primary)]">3.2%</span>537 |                   </div>538 |                 </div>539 |                 <button540 |                   onClick={runEvaluation}541 |                   className="w-full mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"542 |                 >543 |                   Run Core Evaluation544 |                 </button>545 |               </div>546 |             </div>547 | 548 |             <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">549 |               <h4 className="font-semibold text-[var(--color-text-primary)] mb-4">550 |                 Cross-Validation Results551 |               </h4>552 |               <div className="text-[var(--color-text-secondary)] text-sm">553 |                 <p>Cross-validation provides a more robust evaluation by testing the model on multiple data splits.</p>554 |                 <div className="mt-4 flex space-x-4">555 |                   <button className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">556 |                     Run 5-Fold CV557 |                   </button>558 |                   <button className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">559 |                     Run 10-Fold CV560 |                   </button>561 |                 </div>562 |               </div>563 |             </div>564 |           </div>565 |         )}566 |       </div>567 |     </div>568 |   );569 | }
============================================================END: frontend/components/RasaModelTuning.tsx============================================================


============================================================FILE: frontend/components/RasaMonitoring.tsxSIZE: 23.15 KB============================================================
  1 | import React, { useState, useEffect, useCallback } from 'react';  2 | import {  3 |   Activity,  4 |   Brain,  5 |   AlertTriangle,  6 |   Clock,  7 |   CheckCircle,  8 |   XCircle,  9 |   BarChart3, 10 |   RefreshCw, 11 |   Zap, 12 |   Target, 13 |   MessageSquare 14 | } from 'lucide-react'; 15 |  16 | interface RasaStats { 17 |   dailyStats: Array<{ 18 |     date: string; 19 |     total_conversations: number; 20 |     successful_conversations: number; 21 |     avg_processing_time: number; 22 |     booking_attempts: number; 23 |     horoscope_queries: number; 24 |     general_questions: number; 25 |   }>; 26 |   overallStats: { 27 |     total_conversations: number; 28 |     successful_conversations: number; 29 |     avg_processing_time: number; 30 |     first_conversation: string; 31 |     last_conversation: string; 32 |   }; 33 | } 34 |  35 | interface IntentPerformance { 36 |   intent: string; 37 |   total_occurrences: number; 38 |   successful_predictions: number; 39 |   accuracy_percentage: number; 40 |   avg_processing_time: number; 41 |   avg_confidence: number; 42 | } 43 |  44 | interface ErrorAnalysis { 45 |   error_type: string; 46 |   error_message: string; 47 |   error_count: number; 48 |   last_occurrence: string; 49 |   affected_users: number; 50 | } 51 |  52 | interface PerformanceMetrics { 53 |   avg_processing_time: number; 54 |   min_processing_time: number; 55 |   max_processing_time: number; 56 |   median_processing_time: number; 57 |   p95_processing_time: number; 58 |   avg_confidence: number; 59 |   total_requests: number; 60 |   successful_requests: number; 61 |   failed_requests: number; 62 | } 63 |  64 | interface RasaHealth { 65 |   status: 'healthy' | 'unhealthy'; 66 |   rasa?: Record<string, unknown>; 67 |   error?: string; 68 |   timestamp: string; 69 | } 70 |  71 | export function RasaMonitoring() { 72 |   const [activeTab, setActiveTab] = useState('overview'); 73 |   const [loading, setLoading] = useState(false); 74 |   const [lastRefresh, setLastRefresh] = useState<Date | null>(null); 75 |  76 |   const [health, setHealth] = useState<RasaHealth | null>(null); 77 |   const [stats, setStats] = useState<RasaStats | null>(null); 78 |   const [intentPerformance, setIntentPerformance] = useState<IntentPerformance[]>([]); 79 |   const [errorAnalysis, setErrorAnalysis] = useState<ErrorAnalysis[]>([]); 80 |   const [performanceMetrics, setPerformanceMetrics] = useState<PerformanceMetrics | null>(null); 81 |   const [dateRange, setDateRange] = useState({ 82 |     from: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], 83 |     to: new Date().toISOString().split('T')[0] 84 |   }); 85 |  86 |   const fetchData = useCallback(async (action: string, params?: Record<string, string>) => { 87 |     try { 88 |       setLoading(true); 89 |       const queryParams = new URLSearchParams({ 90 |         action, 91 |         ...params, 92 |         dateFrom: dateRange.from, 93 |         dateTo: dateRange.to 94 |       }); 95 |  96 |       const response = await fetch(`/api/admin/rasa?${queryParams}`); 97 |       const data = await response.json(); 98 |  99 |       if (data.success) {100 |         switch (action) {101 |           case 'health':102 |             setHealth(data.data);103 |             break;104 |           case 'stats':105 |             setStats(data.data);106 |             break;107 |           case 'intent-performance':108 |             setIntentPerformance(data.data);109 |             break;110 |           case 'error-analysis':111 |             setErrorAnalysis(data.data.errorStats);112 |             break;113 |           case 'performance-metrics':114 |             setPerformanceMetrics(data.data.overallMetrics);115 |             break;116 |         }117 |       }118 |     } catch (error) {119 |       } finally {120 |       setLoading(false);121 |       setLastRefresh(new Date());122 |     }123 |   }, [dateRange]);124 | 125 |   const refreshAll = useCallback(async () => {126 |     await Promise.all([127 |       fetchData('health'),128 |       fetchData('stats'),129 |       fetchData('intent-performance'),130 |       fetchData('error-analysis'),131 |       fetchData('performance-metrics')132 |     ]);133 |   }, [fetchData]);134 | 135 |   useEffect(() => {136 |     refreshAll();137 |   }, [dateRange, refreshAll]);138 | 139 |   const tabs = [140 |     { id: 'overview', label: 'Overview', icon: BarChart3 },141 |     { id: 'intents', label: 'Intent Performance', icon: Target },142 |     { id: 'errors', label: 'Error Analysis', icon: AlertTriangle },143 |     { id: 'performance', label: 'Performance', icon: Zap },144 |     { id: 'health', label: 'Health Status', icon: Activity }145 |   ];146 | 147 |   const formatNumber = (num: number) => {148 |     if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';149 |     if (num >= 1000) return (num / 1000).toFixed(1) + 'K';150 |     return num.toString();151 |   };152 | 153 |   const formatTime = (ms: number) => {154 |     if (ms < 1000) return `${ms.toFixed(0)}ms`;155 |     return `${(ms / 1000).toFixed(2)}s`;156 |   };157 | 158 |   const getAccuracyColor = (accuracy: number) => {159 |     if (accuracy >= 90) return 'text-green-500';160 |     if (accuracy >= 80) return 'text-yellow-500';161 |     return 'text-red-500';162 |   };163 | 164 |   return (165 |     <div className="space-y-6">166 |       {}167 |       <div className="flex items-center justify-between">168 |         <div className="flex items-center space-x-3">169 |           <div className="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center">170 |             <Brain className="w-6 h-6 text-white" />171 |           </div>172 |           <div>173 |             <h2 className="text-2xl font-bold text-[var(--color-text-primary)]">174 |               Rasa Monitoring175 |             </h2>176 |             <p className="text-[var(--color-text-secondary)]">177 |               AI Model Performance & Analytics178 |             </p>179 |           </div>180 |         </div>181 | 182 |         <div className="flex items-center space-x-3">183 |           {}184 |           <div className="flex items-center space-x-2">185 |             <input186 |               type="date"187 |               value={dateRange.from}188 |               onChange={(e) => setDateRange(prev => ({ ...prev, from: e.target.value }))}189 |               className="px-3 py-2 border border-[var(--color-border-500)] rounded-lg bg-[var(--color-background-primary)] text-[var(--color-text-primary)]"190 |             />191 |             <span className="text-[var(--color-text-secondary)]">to</span>192 |             <input193 |               type="date"194 |               value={dateRange.to}195 |               onChange={(e) => setDateRange(prev => ({ ...prev, to: e.target.value }))}196 |               className="px-3 py-2 border border-[var(--color-border-500)] rounded-lg bg-[var(--color-background-primary)] text-[var(--color-text-primary)]"197 |             />198 |           </div>199 | 200 |           <button201 |             onClick={refreshAll}202 |             disabled={loading}203 |             className="flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 transition-colors"204 |           >205 |             <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />206 |             <span>Refresh</span>207 |           </button>208 |         </div>209 |       </div>210 | 211 |       {}212 |       {lastRefresh && (213 |         <div className="text-sm text-[var(--color-text-secondary)]">214 |           Last updated: {lastRefresh.toLocaleString()}215 |         </div>216 |       )}217 | 218 |       {}219 |       <div className="flex space-x-1 bg-[var(--color-background-secondary)] p-1 rounded-lg">220 |         {tabs.map((tab) => {221 |           const Icon = tab.icon;222 |           return (223 |             <button224 |               key={tab.id}225 |               onClick={() => setActiveTab(tab.id)}226 |               className={`flex items-center space-x-2 px-4 py-2 rounded-md transition-colors ${227 |                 activeTab === tab.id228 |                   ? 'bg-purple-600 text-white'229 |                   : 'text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background-primary)]'230 |               }`}231 |             >232 |               <Icon className="w-4 h-4" />233 |               <span>{tab.label}</span>234 |             </button>235 |           );236 |         })}237 |       </div>238 | 239 |       {}240 |       <div className="bg-[var(--color-background-primary)] rounded-lg border border-[var(--color-border-500)] p-6">241 |         {loading && (242 |           <div className="flex items-center justify-center py-8">243 |             <RefreshCw className="w-6 h-6 animate-spin text-purple-600" />244 |             <span className="ml-2 text-[var(--color-text-secondary)]">Loading...</span>245 |           </div>246 |         )}247 | 248 |         {}249 |         {activeTab === 'overview' && stats && (250 |           <div className="space-y-6">251 |             {}252 |             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">253 |               <div className="bg-gradient-to-r from-blue-500 to-blue-600 p-6 rounded-lg text-white">254 |                 <div className="flex items-center justify-between">255 |                   <div>256 |                     <p className="text-blue-100 text-sm">Total Conversations</p>257 |                     <p className="text-3xl font-bold">{formatNumber(stats.overallStats.total_conversations)}</p>258 |                   </div>259 |                   <MessageSquare className="w-8 h-8 text-blue-200" />260 |                 </div>261 |               </div>262 | 263 |               <div className="bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-lg text-white">264 |                 <div className="flex items-center justify-between">265 |                   <div>266 |                     <p className="text-green-100 text-sm">Success Rate</p>267 |                     <p className="text-3xl font-bold">268 |                       {((stats.overallStats.successful_conversations / stats.overallStats.total_conversations) * 100).toFixed(1)}%269 |                     </p>270 |                   </div>271 |                   <CheckCircle className="w-8 h-8 text-green-200" />272 |                 </div>273 |               </div>274 | 275 |               <div className="bg-gradient-to-r from-purple-500 to-purple-600 p-6 rounded-lg text-white">276 |                 <div className="flex items-center justify-between">277 |                   <div>278 |                     <p className="text-purple-100 text-sm">Avg Response Time</p>279 |                     <p className="text-3xl font-bold">{formatTime(stats.overallStats.avg_processing_time)}</p>280 |                   </div>281 |                   <Clock className="w-8 h-8 text-purple-200" />282 |                 </div>283 |               </div>284 | 285 |               <div className="bg-gradient-to-r from-orange-500 to-orange-600 p-6 rounded-lg text-white">286 |                 <div className="flex items-center justify-between">287 |                   <div>288 |                     <p className="text-orange-100 text-sm">Booking Attempts</p>289 |                     <p className="text-3xl font-bold">290 |                       {stats.dailyStats.reduce((sum, day) => sum + day.booking_attempts, 0)}291 |                     </p>292 |                   </div>293 |                   <Target className="w-8 h-8 text-orange-200" />294 |                 </div>295 |               </div>296 |             </div>297 | 298 |             {}299 |             <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">300 |               <h3 className="text-lg font-semibold text-[var(--color-text-primary)] mb-4">301 |                 Daily Conversation Trends302 |               </h3>303 |               <div className="space-y-4">304 |                 {stats.dailyStats.slice(0, 7).map((day, index) => (305 |                   <div key={index} className="flex items-center justify-between">306 |                     <span className="text-[var(--color-text-secondary)]">307 |                       {new Date(day.date).toLocaleDateString()}308 |                     </span>309 |                     <div className="flex items-center space-x-4">310 |                       <div className="flex items-center space-x-2">311 |                         <div className="w-3 h-3 bg-blue-500 rounded-full"></div>312 |                         <span className="text-sm text-[var(--color-text-primary)]">313 |                           {day.total_conversations} total314 |                         </span>315 |                       </div>316 |                       <div className="flex items-center space-x-2">317 |                         <div className="w-3 h-3 bg-green-500 rounded-full"></div>318 |                         <span className="text-sm text-[var(--color-text-primary)]">319 |                           {day.successful_conversations} successful320 |                         </span>321 |                       </div>322 |                       <span className="text-sm text-[var(--color-text-secondary)]">323 |                         {formatTime(day.avg_processing_time)}324 |                       </span>325 |                     </div>326 |                   </div>327 |                 ))}328 |               </div>329 |             </div>330 |           </div>331 |         )}332 | 333 |         {}334 |         {activeTab === 'intents' && intentPerformance.length > 0 && (335 |           <div className="space-y-6">336 |             <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">337 |               Intent Performance Analysis338 |             </h3>339 |             <div className="overflow-x-auto">340 |               <table className="w-full">341 |                 <thead>342 |                   <tr className="border-b border-[var(--color-border-500)]">343 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Intent</th>344 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Total</th>345 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Successful</th>346 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Accuracy</th>347 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Avg Time</th>348 |                     <th className="text-left py-3 px-4 text-[var(--color-text-primary)]">Confidence</th>349 |                   </tr>350 |                 </thead>351 |                 <tbody>352 |                   {intentPerformance.map((intent, index) => (353 |                     <tr key={index} className="border-b border-[var(--color-border-300)]">354 |                       <td className="py-3 px-4 text-[var(--color-text-primary)] font-medium">355 |                         {intent.intent}356 |                       </td>357 |                       <td className="py-3 px-4 text-[var(--color-text-secondary)]">358 |                         {intent.total_occurrences}359 |                       </td>360 |                       <td className="py-3 px-4 text-[var(--color-text-secondary)]">361 |                         {intent.successful_predictions}362 |                       </td>363 |                       <td className={`py-3 px-4 font-semibold ${getAccuracyColor(intent.accuracy_percentage)}`}>364 |                         {intent.accuracy_percentage}%365 |                       </td>366 |                       <td className="py-3 px-4 text-[var(--color-text-secondary)]">367 |                         {formatTime(intent.avg_processing_time)}368 |                       </td>369 |                       <td className="py-3 px-4 text-[var(--color-text-secondary)]">370 |                         {(intent.avg_confidence * 100).toFixed(1)}%371 |                       </td>372 |                     </tr>373 |                   ))}374 |                 </tbody>375 |               </table>376 |             </div>377 |           </div>378 |         )}379 | 380 |         {}381 |         {activeTab === 'errors' && errorAnalysis.length > 0 && (382 |           <div className="space-y-6">383 |             <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">384 |               Error Analysis385 |             </h3>386 |             <div className="space-y-4">387 |               {errorAnalysis.map((error, index) => (388 |                 <div key={index} className="bg-red-50 border border-red-200 rounded-lg p-4">389 |                   <div className="flex items-start justify-between">390 |                     <div className="flex-1">391 |                       <div className="flex items-center space-x-2 mb-2">392 |                         <XCircle className="w-5 h-5 text-red-500" />393 |                         <span className="font-semibold text-red-800">{error.error_type}</span>394 |                         <span className="bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm">395 |                           {error.error_count} occurrences396 |                         </span>397 |                       </div>398 |                       <p className="text-red-700 text-sm mb-2">{error.error_message}</p>399 |                       <div className="flex items-center space-x-4 text-xs text-red-600">400 |                         <span>Last: {new Date(error.last_occurrence).toLocaleString()}</span>401 |                         <span>Users affected: {error.affected_users}</span>402 |                       </div>403 |                     </div>404 |                   </div>405 |                 </div>406 |               ))}407 |             </div>408 |           </div>409 |         )}410 | 411 |         {}412 |         {activeTab === 'performance' && performanceMetrics && (413 |           <div className="space-y-6">414 |             <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">415 |               Performance Metrics416 |             </h3>417 |             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">418 |               <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">419 |                 <h4 className="font-semibold text-[var(--color-text-primary)] mb-4">Response Times</h4>420 |                 <div className="space-y-2">421 |                   <div className="flex justify-between">422 |                     <span className="text-[var(--color-text-secondary)]">Average:</span>423 |                     <span className="text-[var(--color-text-primary)]">{formatTime(performanceMetrics.avg_processing_time)}</span>424 |                   </div>425 |                   <div className="flex justify-between">426 |                     <span className="text-[var(--color-text-secondary)]">Median:</span>427 |                     <span className="text-[var(--color-text-primary)]">{formatTime(performanceMetrics.median_processing_time)}</span>428 |                   </div>429 |                   <div className="flex justify-between">430 |                     <span className="text-[var(--color-text-secondary)]">95th Percentile:</span>431 |                     <span className="text-[var(--color-text-primary)]">{formatTime(performanceMetrics.p95_processing_time)}</span>432 |                   </div>433 |                   <div className="flex justify-between">434 |                     <span className="text-[var(--color-text-secondary)]">Min:</span>435 |                     <span className="text-[var(--color-text-primary)]">{formatTime(performanceMetrics.min_processing_time)}</span>436 |                   </div>437 |                   <div className="flex justify-between">438 |                     <span className="text-[var(--color-text-secondary)]">Max:</span>439 |                     <span className="text-[var(--color-text-primary)]">{formatTime(performanceMetrics.max_processing_time)}</span>440 |                   </div>441 |                 </div>442 |               </div>443 | 444 |               <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">445 |                 <h4 className="font-semibold text-[var(--color-text-primary)] mb-4">Request Statistics</h4>446 |                 <div className="space-y-2">447 |                   <div className="flex justify-between">448 |                     <span className="text-[var(--color-text-secondary)]">Total Requests:</span>449 |                     <span className="text-[var(--color-text-primary)]">{formatNumber(performanceMetrics.total_requests)}</span>450 |                   </div>451 |                   <div className="flex justify-between">452 |                     <span className="text-[var(--color-text-secondary)]">Successful:</span>453 |                     <span className="text-green-500">{formatNumber(performanceMetrics.successful_requests)}</span>454 |                   </div>455 |                   <div className="flex justify-between">456 |                     <span className="text-[var(--color-text-secondary)]">Failed:</span>457 |                     <span className="text-red-500">{formatNumber(performanceMetrics.failed_requests)}</span>458 |                   </div>459 |                   <div className="flex justify-between">460 |                     <span className="text-[var(--color-text-secondary)]">Success Rate:</span>461 |                     <span className="text-[var(--color-text-primary)]">462 |                       {((performanceMetrics.successful_requests / performanceMetrics.total_requests) * 100).toFixed(1)}%463 |                     </span>464 |                   </div>465 |                 </div>466 |               </div>467 | 468 |               <div className="bg-[var(--color-background-secondary)] p-6 rounded-lg">469 |                 <h4 className="font-semibold text-[var(--color-text-primary)] mb-4">Confidence Scores</h4>470 |                 <div className="space-y-2">471 |                   <div className="flex justify-between">472 |                     <span className="text-[var(--color-text-secondary)]">Average:</span>473 |                     <span className="text-[var(--color-text-primary)]">{(performanceMetrics.avg_confidence * 100).toFixed(1)}%</span>474 |                   </div>475 |                 </div>476 |               </div>477 |             </div>478 |           </div>479 |         )}480 | 481 |         {}482 |         {activeTab === 'health' && (483 |           <div className="space-y-6">484 |             <h3 className="text-lg font-semibold text-[var(--color-text-primary)]">485 |               System Health Status486 |             </h3>487 |             {health ? (488 |               <div className="space-y-4">489 |                 <div className={`flex items-center space-x-3 p-4 rounded-lg ${490 |                   health.status === 'healthy'491 |                     ? 'bg-green-50 border border-green-200'492 |                     : 'bg-red-50 border border-red-200'493 |                 }`}>494 |                   <div className={`w-4 h-4 rounded-full ${495 |                     health.status === 'healthy' ? 'bg-green-500' : 'bg-red-500'496 |                   }`}></div>497 |                   <div>498 |                     <h4 className={`font-semibold ${499 |                       health.status === 'healthy' ? 'text-green-800' : 'text-red-800'500 |                     }`}>501 |                       Rasa Server: {health.status === 'healthy' ? 'Online' : 'Offline'}502 |                     </h4>503 |                     <p className={`text-sm ${504 |                       health.status === 'healthy' ? 'text-green-600' : 'text-red-600'505 |                     }`}>506 |                       {health.status === 'healthy'507 |                         ? 'Server is responding normally'508 |                         : health.error || 'Server is not responding'509 |                       }510 |                     </p>511 |                   </div>512 |                 </div>513 | 514 |                 {health.rasa && (515 |                   <div className="bg-[var(--color-background-secondary)] p-4 rounded-lg">516 |                     <h4 className="font-semibold text-[var(--color-text-primary)] mb-2">517 |                       Server Information518 |                     </h4>519 |                     <pre className="text-sm text-[var(--color-text-secondary)] overflow-x-auto">520 |                       {JSON.stringify(health.rasa, null, 2)}521 |                     </pre>522 |                   </div>523 |                 )}524 |               </div>525 |             ) : (526 |               <div className="text-center py-8">527 |                 <Activity className="w-12 h-12 text-[var(--color-text-secondary)] mx-auto mb-4" />528 |                 <p className="text-[var(--color-text-secondary)]">No health data available</p>529 |               </div>530 |             )}531 |           </div>532 |         )}533 | 534 |         {}535 |         {!loading && activeTab === 'intents' && intentPerformance.length === 0 && (536 |           <div className="text-center py-8">537 |             <Target className="w-12 h-12 text-[var(--color-text-secondary)] mx-auto mb-4" />538 |             <p className="text-[var(--color-text-secondary)]">No intent performance data available</p>539 |           </div>540 |         )}541 | 542 |         {!loading && activeTab === 'errors' && errorAnalysis.length === 0 && (543 |           <div className="text-center py-8">544 |             <CheckCircle className="w-12 h-12 text-green-500 mx-auto mb-4" />545 |             <p className="text-[var(--color-text-secondary)]">No errors found in the selected period</p>546 |           </div>547 |         )}548 |       </div>549 |     </div>550 |   );551 | }
============================================================END: frontend/components/RasaMonitoring.tsx============================================================


============================================================FILE: frontend/components/ScheduleManagement.tsxSIZE: 40.36 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { Label } from '@/components/ui/label';  8 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  9 | import { Badge } from '@/components/ui/badge'; 10 |  11 | import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; 12 | import { Calendar, Clock, Plus, Edit, Trash2, Filter, CalendarDays, Users, RefreshCw } from 'lucide-react'; 13 | import { toast } from 'sonner'; 14 | import { useAuth } from '../hooks/useAuth'; 15 | import ScheduleTemplateModal from './modals/ScheduleTemplateModal'; 16 | import DeleteConfirmationModal from './modals/DeleteConfirmationModal'; 17 |  18 | interface SessionDuration { 19 |   id: number; 20 |   name: string; 21 |   duration_minutes: number; 22 |   description: string; 23 |   isActive: boolean; 24 | } 25 |  26 | interface ScheduleTemplate { 27 |   id: number; 28 |   dayOfWeek: string; 29 |   startTime: string; 30 |   endTime: string; 31 |   capacity: number; 32 |   isAvailable: boolean; 33 |   sessionDurationId: number; 34 |   autoAvailable: boolean; 35 |   createdAt: string; 36 |   updatedAt: string; 37 |   sessionDuration: SessionDuration; 38 | } 39 |  40 | interface ScheduleSlot { 41 |   id: number; 42 |   scheduleTemplateId: number; 43 |   startTime: string; 44 |   endTime: string; 45 |   capacity: number; 46 |   bookedCount: number; 47 |   isAvailable: boolean; 48 |   createdAt: string; 49 |   updatedAt: string; 50 |   scheduleTemplate: ScheduleTemplate; 51 |   bookings: Array<{ 52 |     id: number; 53 |     clientId: number; 54 |     status: string; 55 |     bookingType: string; 56 |     groupSize: number; 57 |   }>; 58 | } 59 |  60 | const ScheduleManagement: React.FC = () => { 61 |   const { user } = useAuth(); 62 |   const [scheduleTemplates, setScheduleTemplates] = useState<ScheduleTemplate[]>([]); 63 |   const [scheduleSlots, setScheduleSlots] = useState<ScheduleSlot[]>([]); 64 |   const [sessionDurations, setSessionDurations] = useState<SessionDuration[]>([]); 65 |   const [loading, setLoading] = useState(true); 66 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null); 67 |   const [activeTab, setActiveTab] = useState('templates'); 68 |  69 |   const [templateFilters, setTemplateFilters] = useState({ 70 |     dayOfWeek: 'all', 71 |     isAvailable: 'all', 72 |     sessionDurationId: 'all' 73 |   }); 74 |  75 |   const [slotFilters, setSlotFilters] = useState({ 76 |     scheduleTemplateId: 'all', 77 |     dateFrom: '', 78 |     dateTo: '', 79 |     isAvailable: 'all', 80 |     hasCapacity: 'all' 81 |   }); 82 |  83 |   const [showCreateTemplateModal, setShowCreateTemplateModal] = useState(false); 84 |   const [showEditTemplateModal, setShowEditTemplateModal] = useState(false); 85 |   const [showDeleteModal, setShowDeleteModal] = useState(false); 86 |   const [selectedItem, setSelectedItem] = useState<ScheduleTemplate | ScheduleSlot | null>(null); 87 |   const [deleteType, setDeleteType] = useState<'template' | 'slot'>('template'); 88 |  89 |   const [showSlotGenerationModal, setShowSlotGenerationModal] = useState(false); 90 |   const [slotGenerationData, setSlotGenerationData] = useState({ 91 |     template_ids: [] as number[], 92 |     start_date: '', 93 |     end_date: '', 94 |     overwrite_existing: false 95 |   }); 96 |  97 |   const [currentDate, setCurrentDate] = useState(new Date()); 98 |   const [calendarView, setCalendarView] = useState<'week' | 'month'>('week'); 99 | 100 |   const fetchScheduleTemplates = useCallback(async () => {101 |     try {102 |       if (!user?.access_token) {103 |         return;104 |       }105 | 106 |       const params = new URLSearchParams();107 | 108 |       Object.entries(templateFilters).forEach(([key, value]) => {109 |         if (value && value !== 'all') params.append(key, value);110 |       });111 | 112 |       const response = await fetch(`/api/admin/schedule-templates?${params}`, {113 |         headers: {114 |           'Authorization': `Bearer ${user.access_token}`,115 |           'Content-Type': 'application/json'116 |         }117 |       });118 | 119 |       if (response.ok) {120 |         const data = await response.json();121 |         setScheduleTemplates(data.data || []);122 |       } else {123 |         const errorText = await response.text();124 |         toast.error('Failed to fetch schedule templates');125 |       }126 |     } catch (error) {127 |       toast.error('Error fetching schedule templates');128 |     }129 |   }, [user?.access_token, templateFilters]);130 | 131 |   const fetchScheduleSlots = useCallback(async () => {132 |     try {133 |       if (!user?.access_token) {134 |         return;135 |       }136 | 137 |       const params = new URLSearchParams();138 | 139 |       Object.entries(slotFilters).forEach(([key, value]) => {140 |         if (value && value !== 'all') params.append(key, value);141 |       });142 | 143 |       const response = await fetch(`/api/admin/schedule-slots?${params}&enhanced=true`, {144 |         headers: {145 |           'Authorization': `Bearer ${user.access_token}`,146 |           'Content-Type': 'application/json'147 |         }148 |       });149 | 150 |       if (response.ok) {151 |         const data = await response.json();152 |         setScheduleSlots(data.data || []);153 |       } else {154 |         const errorText = await response.text();155 |         toast.error('Failed to fetch schedule slots');156 |       }157 |     } catch (error) {158 |       toast.error('Error fetching schedule slots');159 |     }160 |   }, [user?.access_token, slotFilters]);161 | 162 |   const fetchSessionDurations = useCallback(async () => {163 |     try {164 |       if (!user?.access_token) {165 |         return;166 |       }167 | 168 |       const response = await fetch('/api/admin/session-durations', {169 |         headers: {170 |           'Authorization': `Bearer ${user.access_token}`,171 |           'Content-Type': 'application/json'172 |         }173 |       });174 | 175 |       if (response.ok) {176 |         const data = await response.json();177 |         setSessionDurations(data.data || []);178 |       } else {179 |         const errorText = await response.text();180 |         toast.error('Failed to load session durations');181 |       }182 |     } catch (error) {183 |       toast.error('Error fetching session durations');184 |     }185 |   }, [user?.access_token]);186 | 187 |   const fetchAllData = useCallback(async () => {188 |     try {189 |       if (!user?.access_token) {190 |         toast.error('Please log in to access this feature');191 |         return;192 |       }193 | 194 |       setLoading(true);195 |       await Promise.all([196 |         fetchSessionDurations(),197 |         fetchScheduleTemplates(),198 |         fetchScheduleSlots()199 |       ]);200 | 201 |       setLastLoaded(new Date());202 |       toast.success('Schedule data loaded successfully');203 |     } catch (error) {204 |       toast.error('Failed to load schedule data');205 |     } finally {206 |       setLoading(false);207 |     }208 |   }, [user, fetchSessionDurations, fetchScheduleTemplates, fetchScheduleSlots]);209 | 210 |   const refreshScheduleData = useCallback(() => {211 |     if (user?.access_token) {212 |       fetchAllData();213 |     }214 |   }, [user?.access_token, fetchAllData]);215 | 216 |   useEffect(() => {217 |     if (user?.access_token) {218 |       fetchAllData();219 |     } else {220 |       setScheduleTemplates([]);221 |       setScheduleSlots([]);222 |       setSessionDurations([]);223 |       setLoading(false);224 |     }225 |   }, [user?.access_token, fetchAllData]);226 | 227 |   useEffect(() => {228 |     const handleVisibilityChange = () => {229 |       if (document.visibilityState === 'visible' && user?.access_token && scheduleTemplates.length === 0) {230 |         fetchAllData();231 |       }232 |     };233 | 234 |     document.addEventListener('visibilitychange', handleVisibilityChange);235 |     return () => document.removeEventListener('visibilitychange', handleVisibilityChange);236 |   }, [user?.access_token, scheduleTemplates.length, fetchAllData]);237 | 238 |   useEffect(() => {239 |     if (user?.access_token && scheduleTemplates.length === 0) {240 |       fetchAllData();241 |     }242 |   }, [user?.access_token, scheduleTemplates.length, fetchAllData]);243 | 244 |   useEffect(() => {245 | 246 |     window.refreshScheduleData = refreshScheduleData;247 | 248 |     return () => {249 | 250 |       delete window.refreshScheduleData;251 |     };252 |   }, [refreshScheduleData]);253 | 254 |   useEffect(() => {255 |     const handleNavigation = () => {256 | 257 |       setTimeout(() => {258 |         if (user?.access_token && scheduleTemplates.length === 0) {259 |           fetchAllData();260 |         }261 |       }, 100);262 |     };263 | 264 |     window.addEventListener('popstate', handleNavigation);265 |     return () => window.removeEventListener('popstate', handleNavigation);266 |   }, [user?.access_token, scheduleTemplates.length, fetchAllData]);267 | 268 |   const handleCreateTemplate = async (data: unknown) => {269 |     if (!user?.access_token) return;270 |     try {271 |       const response = await fetch('/api/admin/schedule-templates', {272 |         method: 'POST',273 |         headers: {274 |           'Authorization': `Bearer ${user.access_token}`,275 |           'Content-Type': 'application/json'276 |         },277 |         body: JSON.stringify(data)278 |       });279 | 280 |       const responseData = await response.json();281 | 282 |       if (responseData.success) {283 |         toast.success('Schedule template created successfully');284 |         setShowCreateTemplateModal(false);285 |         fetchScheduleTemplates();286 |       } else {287 |         toast.error(responseData.message || 'Failed to create schedule template');288 |       }289 |     } catch {290 |       toast.error('Error creating schedule template');291 |     }292 |   };293 | 294 |   const handleEditTemplate = async (data: unknown) => {295 |     if (!user?.access_token || !selectedItem) return;296 | 297 |     try {298 |       const response = await fetch('/api/admin/schedule-templates', {299 |         method: 'PUT',300 |         headers: {301 |           'Authorization': `Bearer ${user.access_token}`,302 |           'Content-Type': 'application/json'303 |         },304 |         body: JSON.stringify({305 |           id: selectedItem.id,306 |           ...(data as Record<string, unknown>)307 |         })308 |       });309 | 310 |       const responseData = await response.json();311 | 312 |       if (responseData.success) {313 |         toast.success('Schedule template updated successfully');314 |         setShowEditTemplateModal(false);315 |         setSelectedItem(null);316 |         fetchScheduleTemplates();317 |       } else {318 |         toast.error(responseData.message || 'Failed to update schedule template');319 |       }320 |     } catch {321 |       toast.error('Error updating schedule template');322 |     }323 |   };324 | 325 |   const handleDelete = async () => {326 |     if (!user?.access_token || !selectedItem) return;327 | 328 |     try {329 |       const endpoint = deleteType === 'template' ? 'schedule-templates' : 'schedule-slots';330 |       const response = await fetch(`/api/admin/${endpoint}?id=${selectedItem.id}`, {331 |         method: 'DELETE',332 |         headers: {333 |           'Authorization': `Bearer ${user.access_token}`,334 |           'Content-Type': 'application/json'335 |         }336 |       });337 | 338 |       const data = await response.json();339 | 340 |       if (data.success) {341 |         toast.success(`${deleteType === 'template' ? 'Schedule template' : 'Schedule slot'} deleted successfully`);342 |         setShowDeleteModal(false);343 |         setSelectedItem(null);344 |         if (deleteType === 'template') {345 |           fetchScheduleTemplates();346 |         } else {347 |           fetchScheduleSlots();348 |         }349 |       } else {350 |         toast.error(data.message || `Failed to delete ${deleteType}`);351 |       }352 |     } catch {353 |       toast.error(`Error deleting ${deleteType}`);354 |     }355 |   };356 | 357 |   const handleGenerateSlots = async () => {358 |     if (!user?.access_token || slotGenerationData.template_ids.length === 0) return;359 | 360 |     try {361 |       const response = await fetch('/api/admin/schedule-slots', {362 |         method: 'POST',363 |         headers: {364 |           'Authorization': `Bearer ${user.access_token}`,365 |           'Content-Type': 'application/json'366 |         },367 |         body: JSON.stringify({368 |           action: 'generate_slots',369 |           ...slotGenerationData370 |         })371 |       });372 | 373 |       const data = await response.json();374 | 375 |       if (data.success) {376 |         toast.success(`Successfully generated ${data.data.slots_generated} schedule slots`);377 |         setShowSlotGenerationModal(false);378 |         setSlotGenerationData({379 |           template_ids: [],380 |           start_date: '',381 |           end_date: '',382 |           overwrite_existing: false383 |         });384 |         fetchScheduleSlots();385 |       } else {386 |         toast.error(data.message || 'Failed to generate schedule slots');387 |       }388 |     } catch {389 |       toast.error('Error generating schedule slots');390 |     }391 |   };392 | 393 |   const getDayOfWeekBadge = (day: string) => {394 |     const variants = {395 |       monday: 'dashboard-badge-info',396 |       tuesday: 'dashboard-badge-success',397 |       wednesday: 'dashboard-badge-warning',398 |       thursday: 'dashboard-badge-error',399 |       friday: 'dashboard-badge-gold',400 |       saturday: 'dashboard-badge-info',401 |       sunday: 'dashboard-badge-success'402 |     };403 |     return <Badge className={variants[day.toLowerCase() as keyof typeof variants]}>{day}</Badge>;404 |   };405 | 406 |   const getAvailabilityBadge = (isAvailable: boolean, bookedCount: number, capacity: number) => {407 |     if (!isAvailable) {408 |       return <Badge className="dashboard-badge-error">Unavailable</Badge>;409 |     }410 | 411 |     if (bookedCount >= capacity) {412 |       return <Badge className="dashboard-badge-error">Full</Badge>;413 |     }414 | 415 |     if (bookedCount > 0) {416 |       return <Badge className="dashboard-badge-warning">{bookedCount}/{capacity}</Badge>;417 |     }418 | 419 |     return <Badge className="dashboard-badge-success">Available</Badge>;420 |   };421 | 422 |   const formatTime = (time: string) => {423 |     return new Date(`2000-01-01T${time}`).toLocaleTimeString('en-US', {424 |       hour: 'numeric',425 |       minute: '2-digit',426 |       hour12: true427 |     });428 |   };429 | 430 |   const formatDateTime = (dateTime: string) => {431 |     return new Date(dateTime).toLocaleString('en-US', {432 |       month: 'short',433 |       day: 'numeric',434 |       hour: 'numeric',435 |       minute: '2-digit',436 |       hour12: true437 |     });438 |   };439 | 440 |   if (loading) {441 |     return (442 |       <div className="flex items-center justify-center min-h-[400px]">443 |         <div className="text-center">444 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>445 |           <p className="text-[#FFD700] text-lg font-semibold">Loading schedule management...</p>446 |         </div>447 |       </div>448 |     );449 |   }450 | 451 |   return (452 |     <div className="dashboard-container p-6 space-y-6">453 |       <div className="flex items-center justify-between">454 |         <div>455 |           <h1 className="dashboard-text-primary text-3xl font-bold">Schedule Management</h1>456 |           <p className="dashboard-text-secondary">Manage recurring availability patterns and generate bookable time slots</p>457 |           {lastLoaded && (458 |             <p className="text-sm text-gray-400 mt-1">459 |               Last updated: {lastLoaded.toLocaleTimeString()}460 |             </p>461 |           )}462 |         </div>463 |         <div className="flex gap-2">464 |           <BaseButton465 |             variant="outline"466 |             className="dashboard-button-outline"467 |             onClick={refreshScheduleData}468 |             disabled={loading}469 |           >470 |             <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />471 |             Refresh472 |           </BaseButton>473 |           <BaseButton474 |             className="dashboard-button-primary"475 |             onClick={() => setShowCreateTemplateModal(true)}476 |           >477 |             <Plus className="w-4 h-4 mr-2" />478 |             New Template479 |           </BaseButton>480 |           <BaseButton481 |             variant="outline"482 |             className="dashboard-button-outline"483 |             onClick={() => setShowSlotGenerationModal(true)}484 |           >485 |             <Calendar className="w-4 h-4 mr-2" />486 |             Generate Slots487 |           </BaseButton>488 |         </div>489 |       </div>490 | 491 |       <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">492 |         <TabsList className="dashboard-tabs">493 |           <TabsTrigger value="templates" className="dashboard-tab">494 |             <Clock className="w-4 h-4 mr-2" />495 |             Schedule Templates496 |           </TabsTrigger>497 |           <TabsTrigger value="calendar" className="dashboard-tab">498 |             <CalendarDays className="w-4 h-4 mr-2" />499 |             Availability Calendar500 |           </TabsTrigger>501 |         </TabsList>502 | 503 |         <TabsContent value="templates" className="space-y-4">504 |           {}505 |           <Card className="dashboard-card">506 |             <CardHeader>507 |               <CardTitle className="dashboard-card-title">Schedule Templates</CardTitle>508 |               <CardDescription className="dashboard-card-description">509 |                 Recurring availability patterns for different days and times510 |               </CardDescription>511 |             </CardHeader>512 |             <CardContent>513 |               {}514 |               <div className="flex gap-4 mb-6">515 |                 <div className="flex-1">516 |                   <Label className="dashboard-label">Day of Week</Label>517 |                   <Select518 |                     value={templateFilters.dayOfWeek}519 |                     onValueChange={(value) => setTemplateFilters(prev => ({ ...prev, dayOfWeek: value }))}520 |                   >521 |                     <SelectTrigger className="dashboard-select">522 |                       <SelectValue />523 |                     </SelectTrigger>524 |                     <SelectContent className="dashboard-dropdown-content">525 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Days</SelectItem>526 |                       <SelectItem value="monday" className="dashboard-dropdown-item">Monday</SelectItem>527 |                       <SelectItem value="tuesday" className="dashboard-dropdown-item">Tuesday</SelectItem>528 |                       <SelectItem value="wednesday" className="dashboard-dropdown-item">Wednesday</SelectItem>529 |                       <SelectItem value="thursday" className="dashboard-dropdown-item">Thursday</SelectItem>530 |                       <SelectItem value="friday" className="dashboard-dropdown-item">Friday</SelectItem>531 |                       <SelectItem value="saturday" className="dashboard-dropdown-item">Saturday</SelectItem>532 |                       <SelectItem value="sunday" className="dashboard-dropdown-item">Sunday</SelectItem>533 |                     </SelectContent>534 |                   </Select>535 |                 </div>536 |                 <div className="flex-1">537 |                   <Label className="dashboard-label">Session Duration</Label>538 |                   <Select539 |                     value={templateFilters.sessionDurationId}540 |                     onValueChange={(value) => setTemplateFilters(prev => ({ ...prev, sessionDurationId: value }))}541 |                   >542 |                     <SelectTrigger className="dashboard-select">543 |                       <SelectValue />544 |                     </SelectTrigger>545 |                     <SelectContent className="dashboard-dropdown-content">546 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Durations</SelectItem>547 |                       {sessionDurations.map((duration) => (548 |                         <SelectItem key={duration.id} value={duration.id.toString()} className="dashboard-dropdown-item">549 |                           {duration.name} ({duration.duration_minutes} min)550 |                         </SelectItem>551 |                       ))}552 |                     </SelectContent>553 |                   </Select>554 |                 </div>555 |                 <div className="flex-1">556 |                   <Label className="dashboard-label">Status</Label>557 |                   <Select558 |                     value={templateFilters.isAvailable}559 |                     onValueChange={(value) => setTemplateFilters(prev => ({ ...prev, isAvailable: value }))}560 |                   >561 |                     <SelectTrigger className="dashboard-select">562 |                       <SelectValue />563 |                     </SelectTrigger>564 |                     <SelectContent className="dashboard-dropdown-content">565 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Status</SelectItem>566 |                       <SelectItem value="true" className="dashboard-dropdown-item">Available</SelectItem>567 |                       <SelectItem value="false" className="dashboard-dropdown-item">Unavailable</SelectItem>568 |                     </SelectContent>569 |                   </Select>570 |                 </div>571 |                 <BaseButton572 |                   variant="outline"573 |                   className="dashboard-button-outline"574 |                   onClick={fetchScheduleTemplates}575 |                 >576 |                   <Filter className="w-4 h-4 mr-2" />577 |                   Apply Filters578 |                 </BaseButton>579 |               </div>580 | 581 |               {}582 |               <div className="overflow-x-auto">583 |                 <table className="dashboard-table">584 |                   <thead className="dashboard-table-header">585 |                     <tr>586 |                       <th>Day</th>587 |                       <th>Time Range</th>588 |                       <th>Capacity</th>589 |                       <th>Session Duration</th>590 |                       <th>Status</th>591 |                       <th>Auto Available</th>592 |                       <th>Actions</th>593 |                     </tr>594 |                   </thead>595 |                   <tbody>596 |                     {scheduleTemplates.map((template) => (597 |                       <tr key={template.id} className="dashboard-table-row">598 |                         <td>{getDayOfWeekBadge(template.dayOfWeek)}</td>599 |                         <td className="font-mono">600 |                           {formatTime(template.startTime)} - {formatTime(template.endTime)}601 |                         </td>602 |                         <td>603 |                           <Badge className="dashboard-badge">604 |                             <Users className="w-4 h-4 mr-1" />605 |                             {template.capacity}606 |                           </Badge>607 |                         </td>608 |                         <td>609 |                           {template.sessionDuration ? (610 |                             <Badge className="dashboard-badge-info">611 |                               {template.sessionDuration.name}612 |                             </Badge>613 |                           ) : (614 |                             <span className="text-gray-500">Any</span>615 |                           )}616 |                         </td>617 |                         <td>618 |                           <Badge className={template.isAvailable ? 'dashboard-badge-success' : 'dashboard-badge-error'}>619 |                             {template.isAvailable ? 'Available' : 'Unavailable'}620 |                           </Badge>621 |                         </td>622 |                         <td>623 |                           <Badge className={template.autoAvailable ? 'dashboard-badge-success' : 'dashboard-badge-warning'}>624 |                             {template.autoAvailable ? 'Auto' : 'Manual'}625 |                           </Badge>626 |                         </td>627 |                         <td>628 |                           <div className="flex gap-2">629 |                             <BaseButton630 |                               size="sm"631 |                               variant="outline"632 |                               className="dashboard-button-outline"633 |                               onClick={() => {634 |                                 setSelectedItem(template);635 |                                 setShowEditTemplateModal(true);636 |                               }}637 |                             >638 |                               <Edit className="w-4 h-4" />639 |                             </BaseButton>640 |                             <BaseButton641 |                               size="sm"642 |                               variant="outline"643 |                               className="dashboard-button-danger"644 |                               onClick={() => {645 |                                 setSelectedItem(template);646 |                                 setDeleteType('template');647 |                                 setShowDeleteModal(true);648 |                               }}649 |                             >650 |                               <Trash2 className="w-4 h-4" />651 |                             </BaseButton>652 |                           </div>653 |                         </td>654 |                       </tr>655 |                     ))}656 |                   </tbody>657 |                 </table>658 |               </div>659 |             </CardContent>660 |           </Card>661 |         </TabsContent>662 | 663 |         <TabsContent value="calendar" className="space-y-4">664 |           {}665 |           <Card className="dashboard-card">666 |             <CardHeader>667 |               <CardTitle className="dashboard-card-title">Availability Calendar</CardTitle>668 |               <CardDescription className="dashboard-card-description">669 |                 Generated time slots based on your schedule templates670 |               </CardDescription>671 |             </CardHeader>672 |             <CardContent>673 |               {}674 |               <div className="flex items-center justify-between mb-6">675 |                 <div className="flex items-center gap-4">676 |                   <BaseButton677 |                     variant="outline"678 |                     className="dashboard-button-outline"679 |                     onClick={() => {680 |                       const newDate = new Date(currentDate);681 |                       if (calendarView === 'week') {682 |                         newDate.setDate(newDate.getDate() - 7);683 |                       } else {684 |                         newDate.setMonth(newDate.getMonth() - 1);685 |                       }686 |                       setCurrentDate(newDate);687 |                     }}688 |                   >689 |                     Previous690 |                   </BaseButton>691 | 692 |                   <div className="flex items-center gap-2">693 |                     <BaseButton694 |                                               variant={calendarView === 'week' ? 'primary' : 'outline'}695 |                       className={calendarView === 'week' ? 'dashboard-button-primary' : 'dashboard-button-outline'}696 |                       onClick={() => setCalendarView('week')}697 |                     >698 |                       Week699 |                     </BaseButton>700 |                     <BaseButton701 |                                               variant={calendarView === 'month' ? 'primary' : 'outline'}702 |                       className={calendarView === 'month' ? 'dashboard-button-primary' : 'dashboard-button-outline'}703 |                       onClick={() => setCalendarView('month')}704 |                     >705 |                       Month706 |                     </BaseButton>707 |                   </div>708 | 709 |                   <BaseButton710 |                     variant="outline"711 |                     className="dashboard-button-outline"712 |                     onClick={() => {713 |                       const newDate = new Date(currentDate);714 |                       if (calendarView === 'week') {715 |                         newDate.setDate(newDate.getDate() + 7);716 |                       } else {717 |                         newDate.setMonth(newDate.getMonth() + 1);718 |                       }719 |                       setCurrentDate(newDate);720 |                     }}721 |                   >722 |                     Next723 |                   </BaseButton>724 |                 </div>725 | 726 |                 <div className="text-lg font-semibold text-dashboard-text-primary">727 |                   {currentDate.toLocaleDateString('en-US', {728 |                     month: 'long',729 |                     year: 'numeric'730 |                   })}731 |                 </div>732 |               </div>733 | 734 |               {}735 |               <div className="flex gap-4 mb-6">736 |                 <div className="flex-1">737 |                   <Label className="dashboard-label">Template</Label>738 |                   <Select739 |                     value={slotFilters.scheduleTemplateId}740 |                     onValueChange={(value) => setSlotFilters(prev => ({ ...prev, scheduleTemplateId: value }))}741 |                   >742 |                     <SelectTrigger className="dashboard-select">743 |                       <SelectValue />744 |                     </SelectTrigger>745 |                     <SelectContent className="dashboard-dropdown-content">746 |                       <SelectItem value="all" className="dashboard-dropdown-item">All Templates</SelectItem>747 |                       {scheduleTemplates.map((template) => (748 |                         <SelectItem key={template.id} value={template.id.toString()} className="dashboard-dropdown-item">749 |                           {template.dayOfWeek} {formatTime(template.startTime)}-{formatTime(template.endTime)}750 |                         </SelectItem>751 |                       ))}752 |                     </SelectContent>753 |                   </Select>754 |                 </div>755 |                 <div className="flex-1">756 |                   <Label className="dashboard-label">Start Date</Label>757 |                   <BaseInput758 |                     type="date"759 |                     className="dashboard-input"760 |                     value={slotFilters.dateFrom}761 |                     onChange={(e) => setSlotFilters(prev => ({ ...prev, dateFrom: e.target.value }))}762 |                   />763 |                 </div>764 |                 <div className="flex-1">765 |                   <Label className="dashboard-label">End Date</Label>766 |                   <BaseInput767 |                     type="date"768 |                     className="dashboard-input"769 |                     value={slotFilters.dateTo}770 |                     onChange={(e) => setSlotFilters(prev => ({ ...prev, dateTo: e.target.value }))}771 |                   />772 |                 </div>773 |                 <BaseButton774 |                   variant="outline"775 |                   className="dashboard-button-outline"776 |                   onClick={fetchScheduleSlots}777 |                 >778 |                   <Filter className="w-4 h-4 mr-2" />779 |                   Apply Filters780 |                 </BaseButton>781 |               </div>782 | 783 |               {}784 |               <div className="overflow-x-auto">785 |                 <table className="dashboard-table">786 |                   <thead className="dashboard-table-header">787 |                     <tr>788 |                       <th>Date & Time</th>789 |                       <th>Template</th>790 |                       <th>Capacity</th>791 |                       <th>Bookings</th>792 |                       <th>Status</th>793 |                       <th>Actions</th>794 |                     </tr>795 |                   </thead>796 |                   <tbody>797 |                     {scheduleSlots.map((slot) => (798 |                       <tr key={slot.id} className="dashboard-table-row">799 |                         <td className="font-medium">800 |                           <div className="space-y-1">801 |                             <div>{formatDateTime(slot.startTime)}</div>802 |                             <div className="text-sm text-gray-500">803 |                               {formatTime(slot.scheduleTemplate.startTime)} - {formatTime(slot.scheduleTemplate.endTime)}804 |                             </div>805 |                           </div>806 |                         </td>807 |                         <td>808 |                           <Badge className="dashboard-badge">809 |                             {slot.scheduleTemplate.dayOfWeek}810 |                           </Badge>811 |                         </td>812 |                         <td>813 |                           <Badge className="dashboard-badge">814 |                             <Users className="w-4 h-4 mr-1" />815 |                             {slot.capacity}816 |                           </Badge>817 |                         </td>818 |                         <td>819 |                           <Badge className="dashboard-badge-info">820 |                             {slot.bookings?.length || 0} bookings821 |                           </Badge>822 |                         </td>823 |                         <td>824 |                           {getAvailabilityBadge(slot.isAvailable, slot.bookedCount, slot.capacity)}825 |                         </td>826 |                         <td>827 |                           <div className="flex gap-2">828 |                             <BaseButton829 |                               size="sm"830 |                               variant="outline"831 |                               className="dashboard-button-outline"832 |                               onClick={() => {833 | 834 |                                 toast.info('Slot editing coming soon');835 |                               }}836 |                             >837 |                               <Edit className="w-4 h-4" />838 |                             </BaseButton>839 |                             <BaseButton840 |                               size="sm"841 |                               variant="outline"842 |                               className="dashboard-button-danger"843 |                               onClick={() => {844 |                                 setSelectedItem(slot);845 |                                 setDeleteType('slot');846 |                                 setShowDeleteModal(true);847 |                               }}848 |                             >849 |                               <Trash2 className="w-4 h-4" />850 |                             </BaseButton>851 |                           </div>852 |                         </td>853 |                       </tr>854 |                     ))}855 |                   </tbody>856 |                 </table>857 |               </div>858 |             </CardContent>859 |           </Card>860 |         </TabsContent>861 |       </Tabs>862 | 863 |       {}864 |       <ScheduleTemplateModal865 |         isOpen={showCreateTemplateModal}866 |         onClose={() => setShowCreateTemplateModal(false)}867 |         onSubmit={handleCreateTemplate}868 |         sessionDurations={sessionDurations}869 |         mode="create"870 |       />871 | 872 |       <ScheduleTemplateModal873 |         isOpen={showEditTemplateModal}874 |         onClose={() => setShowEditTemplateModal(false)}875 |         onSubmit={handleEditTemplate}876 |         scheduleTemplate={selectedItem && 'dayOfWeek' in selectedItem ? selectedItem : null}877 |         sessionDurations={sessionDurations}878 |         mode="edit"879 |       />880 | 881 |       {}882 |       <div className={`fixed inset-0 bg-black bg-opacity-50 z-50 ${showSlotGenerationModal ? 'block' : 'hidden'}`}>883 |         <div className="flex items-center justify-center min-h-screen p-4">884 |           <div className="dashboard-modal max-w-md">885 |             <div className="dashboard-modal-header">886 |               <h3 className="dashboard-modal-title">Generate Schedule Slots</h3>887 |               <p className="dashboard-modal-description">888 |                 Generate bookable time slots based on your schedule templates889 |               </p>890 |             </div>891 | 892 |             <div className="space-y-4 p-6">893 |               <div className="space-y-2">894 |                 <Label className="dashboard-label">Select Templates</Label>895 |                 <div className="space-y-2 max-h-40 overflow-y-auto">896 |                   {scheduleTemplates.filter(t => t.isAvailable).map((template) => (897 |                     <label key={template.id} className="flex items-center space-x-2">898 |                       <input899 |                         type="checkbox"900 |                         checked={slotGenerationData.template_ids.includes(template.id)}901 |                         onChange={(e) => {902 |                           if (e.target.checked) {903 |                             setSlotGenerationData(prev => ({904 |                               ...prev,905 |                               template_ids: [...prev.template_ids, template.id]906 |                             }));907 |                           } else {908 |                             setSlotGenerationData(prev => ({909 |                               ...prev,910 |                               template_ids: prev.template_ids.filter(id => id !== template.id)911 |                             }));912 |                           }913 |                         }}914 |                         className="dashboard-checkbox"915 |                       />916 |                       <span className="text-sm">917 |                         {template.dayOfWeek} {formatTime(template.startTime)}-{formatTime(template.endTime)}918 |                       </span>919 |                     </label>920 |                   ))}921 |                 </div>922 |               </div>923 | 924 |               <div className="grid grid-cols-2 gap-4">925 |                 <div className="space-y-2">926 |                   <Label className="dashboard-label">Start Date</Label>927 |                   <BaseInput928 |                     type="date"929 |                     className="dashboard-input"930 |                     value={slotGenerationData.start_date}931 |                     onChange={(e) => setSlotGenerationData(prev => ({ ...prev, start_date: e.target.value }))}932 |                   />933 |                 </div>934 |                 <div className="space-y-2">935 |                   <Label className="dashboard-label">End Date</Label>936 |                   <BaseInput937 |                     type="date"938 |                     className="dashboard-input"939 |                     value={slotGenerationData.end_date}940 |                     onChange={(e) => setSlotGenerationData(prev => ({ ...prev, end_date: e.target.value }))}941 |                   />942 |                 </div>943 |               </div>944 | 945 |               <div className="flex items-center space-x-2">946 |                 <input947 |                   type="checkbox"948 |                   id="overwrite_existing"949 |                   checked={slotGenerationData.overwrite_existing}950 |                   onChange={(e) => setSlotGenerationData(prev => ({ ...prev, overwrite_existing: e.target.checked }))}951 |                   className="dashboard-checkbox"952 |                 />953 |                 <Label htmlFor="overwrite_existing" className="dashboard-label">954 |                   Overwrite existing slots955 |                 </Label>956 |               </div>957 |             </div>958 | 959 |             <div className="flex justify-end gap-3 p-6 pt-0">960 |               <BaseButton961 |                 variant="outline"962 |                 className="dashboard-button-outline"963 |                 onClick={() => setShowSlotGenerationModal(false)}964 |               >965 |                 Cancel966 |               </BaseButton>967 |               <BaseButton968 |                 className="dashboard-button-primary"969 |                 onClick={handleGenerateSlots}970 |                 disabled={slotGenerationData.template_ids.length === 0 || !slotGenerationData.start_date || !slotGenerationData.end_date}971 |               >972 |                 <RefreshCw className="w-4 h-4 mr-2" />973 |                 Generate Slots974 |               </BaseButton>975 |             </div>976 |           </div>977 |         </div>978 |       </div>979 | 980 |       <DeleteConfirmationModal981 |         isOpen={showDeleteModal}982 |         onClose={() => setShowDeleteModal(false)}983 |         onConfirm={handleDelete}984 |         title={`Delete ${deleteType === 'template' ? 'Schedule Template' : 'Schedule Slot'}`}985 |         description={`Are you sure you want to delete this ${deleteType === 'template' ? 'schedule template' : 'schedule slot'}?`}986 |         itemName={selectedItem ? ('dayOfWeek' in selectedItem ? selectedItem.dayOfWeek : 'slot') : undefined}987 |         itemType={deleteType}988 |       />989 |     </div>990 |   );991 | };992 | 993 | export default ScheduleManagement;
============================================================END: frontend/components/ScheduleManagement.tsx============================================================


============================================================FILE: frontend/components/SeoManagement.tsxSIZE: 35.94 KB============================================================
  1 | import { useState, useEffect } from 'react';  2 | import { motion } from 'framer-motion';  3 | import Image from 'next/image';  4 | import { Save, Search, Globe, RefreshCw, Eye, EyeOff, Upload, Trash2 } from 'lucide-react';  5 | import { BaseButton } from './ui/BaseButton';  6 | import { BaseInput } from './ui/BaseInput';  7 | import { Card, CardContent, CardHeader, CardTitle } from './ui/card';  8 | import { Label } from './ui/label';  9 | import { Textarea } from './ui/textarea'; 10 |  11 | import { useAuth } from '../hooks/useAuth'; 12 |  13 | interface SeoSettings { 14 |  15 |   title: string; 16 |   description: string; 17 |   keywords: string; 18 |   author: string; 19 |  20 |   ogTitle: string; 21 |   ogDescription: string; 22 |   ogImage?: string; 23 |   ogImageFile?: string; 24 |  25 |   twitterTitle: string; 26 |   twitterDescription: string; 27 |   twitterImage?: string; 28 |   twitterImageFile?: string; 29 |  30 |   robots: string; 31 |   canonical: string; 32 |   language: string; 33 |  34 |   googleAnalyticsId?: string; 35 |   googleTagManagerId?: string; 36 |   facebookPixelId?: string; 37 |  38 |   organizationName: string; 39 |   organizationType: string; 40 |   contactEmail: string; 41 |   contactPhone: string; 42 |   address: string; 43 |  44 |   googleSiteVerification?: string; 45 |   bingSiteVerification?: string; 46 | } 47 |  48 | const defaultSeoSettings: SeoSettings = { 49 |   title: 'MatMax Yoga Studio', 50 |   description: 'Yoga classes for all levels. Build strength, flexibility, and inner peace with MatMax Yoga Studio.', 51 |   keywords: 'yoga, yoga classes, wellness, meditation, flexibility, strength, balance', 52 |   author: 'MatMax Yoga Studio', 53 |  54 |   ogTitle: 'MatMax Yoga Studio', 55 |   ogDescription: 'Yoga classes for all levels. Build strength, flexibility, and inner peace with MatMax Yoga Studio.', 56 |  57 |   twitterTitle: 'MatMax Yoga Studio', 58 |   twitterDescription: 'Yoga classes for all levels. Build strength, flexibility, and inner peace with MatMax Yoga Studio.', 59 |  60 |   robots: 'index, follow', 61 |   canonical: 'https: 62 |   language: 'en', 63 |  64 |   organizationName: 'MatMax Yoga Studio', 65 |   organizationType: 'HealthAndBeautyBusiness', 66 |   contactEmail: 'info@matmax.store', 67 |   contactPhone: '', 68 |   address: '' 69 | }; 70 |  71 | export function SeoManagement() { 72 |   const { user } = useAuth(); 73 |   const [seoSettings, setSeoSettings] = useState<SeoSettings>(defaultSeoSettings); 74 |   const [originalSettings, setOriginalSettings] = useState<SeoSettings>(defaultSeoSettings); 75 |   const [isLoading, setIsLoading] = useState(true); 76 |   const [isSaving, setIsSaving] = useState(false); 77 |   const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false); 78 |   const [activeSection, setActiveSection] = useState<'basic' | 'social' | 'technical' | 'analytics' | 'structured'>('basic'); 79 |   const [showPreview, setShowPreview] = useState(false); 80 |   const [uploadingImage, setUploadingImage] = useState<'og' | 'twitter' | null>(null); 81 |  82 |   useEffect(() => { 83 |     const hasChanges = JSON.stringify(seoSettings) !== JSON.stringify(originalSettings); 84 |     setHasUnsavedChanges(hasChanges); 85 |   }, [seoSettings, originalSettings]); 86 |  87 |   useEffect(() => { 88 |     loadSeoSettings(); 89 |   }, []); 90 |  91 |   const loadSeoSettings = async () => { 92 |     try { 93 |       setIsLoading(true); 94 |  95 |       const response = await fetch(`/api/seo`, { 96 |         headers: { 97 |           'Content-Type': 'application/json' 98 |         } 99 |       });100 | 101 |       if (response.ok) {102 |         const data = await response.json();103 | 104 |         const loadedSettings = { ...defaultSeoSettings, ...data.seo };105 | 106 |         setSeoSettings(loadedSettings);107 |         setOriginalSettings(loadedSettings);108 |       } else {109 | 110 |         setSeoSettings(defaultSeoSettings);111 |         setOriginalSettings(defaultSeoSettings);112 |       }113 |     } catch (error) {114 | 115 |       setSeoSettings(defaultSeoSettings);116 |       setOriginalSettings(defaultSeoSettings);117 |     } finally {118 |       setIsLoading(false);119 |     }120 |   };121 | 122 |   const saveSeoSettings = async () => {123 |     if (!user?.access_token) return;124 | 125 |     try {126 |       setIsSaving(true);127 | 128 |       const response = await fetch(`/api/admin/seo`, {129 |         method: 'POST',130 |         headers: {131 |           'Authorization': `Bearer ${user.access_token}`,132 |           'Content-Type': 'application/json'133 |         },134 |         body: JSON.stringify({ seo: seoSettings })135 |       });136 | 137 |       if (!response.ok) {138 |         throw new Error('Failed to save SEO settings');139 |       }140 | 141 |       setOriginalSettings(seoSettings);142 |       setHasUnsavedChanges(false);143 |       alert('SEO settings saved successfully!');144 |     } catch (error) {145 |       alert('Failed to save SEO settings. Please try again.');146 |     } finally {147 |       setIsSaving(false);148 |     }149 |   };150 | 151 |   const handleImageUpload = async (file: File, type: 'og' | 'twitter') => {152 |     if (!user?.access_token) return;153 | 154 |     try {155 |       setUploadingImage(type);156 | 157 |       const formData = new FormData();158 |       formData.append('image', file);159 |       formData.append('type', `seo-${type}`);160 | 161 |       const response = await fetch(`/api/admin/images/seo-${type}`, {162 |         method: 'POST',163 |         headers: {164 |           'Authorization': `Bearer ${user.access_token}`165 |         },166 |         body: formData167 |       });168 | 169 |       if (!response.ok) {170 |         throw new Error('Failed to upload image');171 |       }172 | 173 |       const data = await response.json();174 | 175 |       if (type === 'og') {176 |         setSeoSettings(prev => ({177 |           ...prev,178 |           ogImage: data.url,179 |           ogImageFile: data.filename180 |         }));181 |       } else {182 |         setSeoSettings(prev => ({183 |           ...prev,184 |           twitterImage: data.url,185 |           twitterImageFile: data.filename186 |         }));187 |       }188 | 189 |       alert(`${type === 'og' ? 'Open Graph' : 'Twitter'} image uploaded successfully!`);190 |     } catch (error) {191 |       alert('Failed to upload image. Please try again.');192 |     } finally {193 |       setUploadingImage(null);194 |     }195 |   };196 | 197 |   const resetToDefault = () => {198 |     if (confirm('This will reset all SEO settings to default values. Are you sure?')) {199 |       setSeoSettings(defaultSeoSettings);200 |     }201 |   };202 | 203 |   const discardChanges = () => {204 |     if (confirm('This will discard all unsaved changes. Are you sure?')) {205 |       setSeoSettings(originalSettings);206 |     }207 |   };208 | 209 |   const updateSetting = (key: keyof SeoSettings, value: string) => {210 |     setSeoSettings(prev => ({ ...prev, [key]: value }));211 |   };212 | 213 |   if (isLoading) {214 |     return (215 |       <div className="flex items-center justify-center min-h-[400px]">216 |         <div className="text-center">217 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>218 |           <p className="text-[#FFD700] text-lg font-semibold">Loading SEO settings...</p>219 |         </div>220 |       </div>221 |     );222 |   }223 | 224 |   const sections = [225 |     { id: 'basic', label: 'Basic SEO', icon: Search },226 |     { id: 'social', label: 'Social Media', icon: Globe },227 |     { id: 'technical', label: 'Technical', icon: Search },228 |     { id: 'analytics', label: 'Analytics', icon: Search },229 |     { id: 'structured', label: 'Structured Data', icon: Search }230 |   ] as const;231 | 232 |   return (233 |     <div className="dashboard-container p-6 space-y-6">234 |       <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">235 |         <div>236 |           <h1 className="dashboard-text-primary text-3xl font-bold">SEO Management</h1>237 |           <p className="dashboard-text-secondary">Optimize your website for search engines and social media</p>238 |         </div>239 | 240 |         <div className="flex flex-col items-center lg:items-end space-y-3">241 |           {}242 |           {hasUnsavedChanges && (243 |             <div className="flex items-center space-x-2 px-3 py-1 bg-yellow-500/10 border border-yellow-500/20 rounded-lg">244 |               <div className="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></div>245 |               <span className="text-sm text-yellow-400 font-medium">Unsaved changes</span>246 |             </div>247 |           )}248 | 249 |           {}250 |           <div className="flex flex-wrap items-center justify-center lg:justify-end gap-2 lg:gap-3">251 |             <BaseButton252 |               onClick={discardChanges}253 |               disabled={!hasUnsavedChanges}254 |               variant="outline"255 |               size="sm"256 |               className="border-[var(--color-border-500)] text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-secondary)] hover:text-[var(--color-text-primary)] transition-all duration-200"257 |             >258 |               <RefreshCw size={16} className="mr-2" />259 |               Discard260 |             </BaseButton>261 | 262 |             <BaseButton263 |               onClick={resetToDefault}264 |               variant="outline"265 |               size="sm"266 |               className="border-red-500/30 text-red-400 hover:bg-red-500/10 hover:border-red-500/50 transition-all duration-200"267 |             >268 |               <Trash2 size={16} className="mr-2" />269 |               Reset All270 |             </BaseButton>271 | 272 |             <BaseButton273 |               onClick={() => setShowPreview(!showPreview)}274 |               variant="outline"275 |               size="sm"276 |               className={`border-[var(--color-accent-500)]/30 text-[var(--color-accent-500)] hover:bg-[var(--color-accent-500)]/10 hover:border-[var(--color-accent-500)]/50 transition-all duration-200 ${277 |                 showPreview ? 'bg-[var(--color-accent-500)]/10 border-[var(--color-accent-500)]/50' : ''278 |               }`}279 |             >280 |               {showPreview ? <EyeOff size={16} className="mr-2" /> : <Eye size={16} className="mr-2" />}281 |               Preview282 |             </BaseButton>283 | 284 |             <BaseButton285 |               onClick={saveSeoSettings}286 |               disabled={isSaving || !hasUnsavedChanges}287 |               size="sm"288 |               className="dashboard-button-primary min-w-[120px]"289 |             >290 |               {isSaving ? (291 |                 <motion.div292 |                   animate={{ rotate: 360 }}293 |                   transition={{ duration: 1, repeat: Infinity, ease: "linear" }}294 |                   className="w-4 h-4 border-2 border-[var(--color-background-primary)] border-t-transparent rounded-full mr-2"295 |                 />296 |               ) : (297 |                 <Save size={16} className="mr-2" />298 |               )}299 |               Save Changes300 |             </BaseButton>301 |           </div>302 |         </div>303 |       </div>304 | 305 |       {}306 |               <Card className="bg-[var(--color-surface-primary)] border-[var(--color-accent-500)]">307 |         <CardContent className="p-4">308 |           <div className="grid grid-cols-1 sm:grid-cols-4 gap-4">309 |             <div className="text-center">310 |               <p className="text-[#FFD700] text-2xl font-heading">{seoSettings.title ? '✓' : '✗'}</p>311 |               <p className="text-sm text-[#C0C0C0]">Title Tag</p>312 |             </div>313 |             <div className="text-center">314 |               <p className="text-[#FFD700] text-2xl font-heading">{seoSettings.description ? '✓' : '✗'}</p>315 |               <p className="text-sm text-[#C0C0C0]">Meta Description</p>316 |             </div>317 |             <div className="text-center">318 |               <p className="text-[#FFD700] text-2xl font-heading">{seoSettings.ogImage ? '✓' : '✗'}</p>319 |               <p className="text-sm text-[#C0C0C0]">Social Image</p>320 |             </div>321 |             <div className="text-center">322 |               <p className="text-[#FFD700] text-2xl font-heading">{seoSettings.organizationName ? '✓' : '✗'}</p>323 |               <p className="text-sm text-[#C0C0C0]">Structured Data</p>324 |             </div>325 |           </div>326 |         </CardContent>327 |       </Card>328 | 329 |       <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">330 |         {}331 |         <div className="lg:col-span-1">332 |           <Card className="bg-[var(--color-surface-primary)] border-[var(--color-border-500)]">333 |             <CardHeader>334 |               <CardTitle className="text-[#EAEAEA] text-lg">SEO Sections</CardTitle>335 |             </CardHeader>336 |             <CardContent>337 |               <div className="space-y-2">338 |                 {sections.map((section) => {339 |                   const Icon = section.icon;340 |                   return (341 |                     <button342 |                       key={section.id}343 |                       onClick={() => setActiveSection(section.id)}344 |                       className={`w-full text-left px-3 py-2 rounded-lg transition-colors ${345 |                         activeSection === section.id346 |                           ? 'dashboard-language-tab-active'347 |                           : 'dashboard-language-tab-inactive hover:bg-[var(--color-surface-secondary)]'348 |                       }`}349 |                     >350 |                       <div className="flex items-center space-x-2">351 |                         <Icon size={14} />352 |                         <span className="text-sm">{section.label}</span>353 |                       </div>354 |                     </button>355 |                   );356 |                 })}357 |               </div>358 |             </CardContent>359 |           </Card>360 |         </div>361 | 362 |         {}363 |         <div className="lg:col-span-3">364 |           <Card className="bg-[var(--color-surface-primary)] border-[var(--color-border-500)]">365 |             <CardHeader>366 |               <CardTitle className="text-[#EAEAEA] text-lg">367 |                 {sections.find(s => s.id === activeSection)?.label} Settings368 |               </CardTitle>369 |             </CardHeader>370 |             <CardContent>371 |               <div className="space-y-4">372 |                 {}373 |                 {activeSection === 'basic' && (374 |                   <>375 |                     <div className="space-y-2">376 |                       <Label htmlFor="title" className="text-[#C0C0C0]">Page Title</Label>377 |                       <BaseInput378 |                         id="title"379 |                         value={seoSettings.title}380 |                         onChange={(e) => updateSetting('title', e.target.value)}381 |                         placeholder="Enter page title..."382 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"383 |                       />384 |                       <p className="text-xs text-[#C0C0C0]/70">385 |                         Length: {seoSettings.title.length}/60 characters (recommended: 50-60)386 |                       </p>387 |                     </div>388 | 389 |                     <div className="space-y-2">390 |                       <Label htmlFor="description" className="text-[#C0C0C0]">Meta Description</Label>391 |                       <Textarea392 |                         id="description"393 |                         value={seoSettings.description}394 |                         onChange={(e) => updateSetting('description', e.target.value)}395 |                         placeholder="Enter meta description..."396 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)] min-h-[80px]"397 |                       />398 |                       <p className="text-xs text-[#C0C0C0]/70">399 |                         Length: {seoSettings.description.length}/155 characters (recommended: 150-155)400 |                       </p>401 |                     </div>402 | 403 |                     <div className="space-y-2">404 |                       <Label htmlFor="keywords" className="text-[#C0C0C0]">Keywords</Label>405 |                       <Textarea406 |                         id="keywords"407 |                         value={seoSettings.keywords}408 |                         onChange={(e) => updateSetting('keywords', e.target.value)}409 |                         placeholder="Enter keywords separated by commas..."410 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)] min-h-[60px]"411 |                       />412 |                     </div>413 | 414 |                     <div className="space-y-2">415 |                       <Label htmlFor="author" className="text-[#C0C0C0]">Author</Label>416 |                       <BaseInput417 |                         id="author"418 |                         value={seoSettings.author}419 |                         onChange={(e) => updateSetting('author', e.target.value)}420 |                         placeholder="Enter author name..."421 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"422 |                       />423 |                     </div>424 |                   </>425 |                 )}426 | 427 |                 {}428 |                 {activeSection === 'social' && (429 |                   <>430 |                     <h3 className="text-lg font-heading text-[#FFD700]">Open Graph (Facebook)</h3>431 | 432 |                     <div className="space-y-2">433 |                       <Label htmlFor="ogTitle" className="text-[#C0C0C0]">OG Title</Label>434 |                       <BaseInput435 |                         id="ogTitle"436 |                         value={seoSettings.ogTitle}437 |                         onChange={(e) => updateSetting('ogTitle', e.target.value)}438 |                         placeholder="Enter Open Graph title..."439 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"440 |                       />441 |                     </div>442 | 443 |                     <div className="space-y-2">444 |                       <Label htmlFor="ogDescription" className="text-[#C0C0C0]">OG Description</Label>445 |                       <Textarea446 |                         id="ogDescription"447 |                         value={seoSettings.ogDescription}448 |                         onChange={(e) => updateSetting('ogDescription', e.target.value)}449 |                         placeholder="Enter Open Graph description..."450 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)] min-h-[60px]"451 |                       />452 |                     </div>453 | 454 |                     <div className="space-y-2">455 |                       <Label className="text-[#C0C0C0]">OG Image</Label>456 |                       {seoSettings.ogImage && (457 |                         <div className="p-3 bg-[var(--color-surface-secondary)] border border-[var(--color-border-500)] rounded-lg">458 |                           <Image src={seoSettings.ogImage} alt="OG Preview" width={200} height={128} className="max-h-32 object-contain" />459 |                         </div>460 |                       )}461 |                       <input462 |                         type="file"463 |                         id="og-upload"464 |                         accept="image}465 |                 {activeSection === 'technical' && (466 |                   <>467 |                     <div className="space-y-2">468 |                       <Label htmlFor="robots" className="text-[#C0C0C0]">Robots Meta Tag</Label>469 |                       <BaseInput470 |                         id="robots"471 |                         value={seoSettings.robots}472 |                         onChange={(e) => updateSetting('robots', e.target.value)}473 |                         placeholder="e.g., index, follow"474 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"475 |                       />476 |                     </div>477 | 478 |                     <div className="space-y-2">479 |                       <Label htmlFor="canonical" className="text-[#C0C0C0]">Canonical URL</Label>480 |                       <BaseInput481 |                         id="canonical"482 |                         value={seoSettings.canonical}483 |                         onChange={(e) => updateSetting('canonical', e.target.value)}484 |                         placeholder="https:485 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"486 |                       />487 |                     </div>488 | 489 |                     <div className="space-y-2">490 |                       <Label htmlFor="language" className="text-[#C0C0C0]">Language Code</Label>491 |                       <BaseInput492 |                         id="language"493 |                         value={seoSettings.language}494 |                         onChange={(e) => updateSetting('language', e.target.value)}495 |                         placeholder="en"496 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"497 |                       />498 |                     </div>499 | 500 |                     <div className="space-y-2">501 |                       <Label htmlFor="googleSiteVerification" className="text-[#C0C0C0]">Google Site Verification</Label>502 |                       <BaseInput503 |                         id="googleSiteVerification"504 |                         value={seoSettings.googleSiteVerification || ''}505 |                         onChange={(e) => updateSetting('googleSiteVerification', e.target.value)}506 |                         placeholder="Enter verification code..."507 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"508 |                       />509 |                     </div>510 | 511 |                     <div className="space-y-2">512 |                       <Label htmlFor="bingSiteVerification" className="text-[#C0C0C0]">Bing Site Verification</Label>513 |                       <BaseInput514 |                         id="bingSiteVerification"515 |                         value={seoSettings.bingSiteVerification || ''}516 |                         onChange={(e) => updateSetting('bingSiteVerification', e.target.value)}517 |                         placeholder="Enter verification code..."518 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"519 |                       />520 |                     </div>521 |                   </>522 |                 )}523 | 524 |                 {}525 |                 {activeSection === 'analytics' && (526 |                   <>527 |                     <div className="space-y-2">528 |                       <Label htmlFor="googleAnalyticsId" className="text-[#C0C0C0]">Google Analytics ID</Label>529 |                       <BaseInput530 |                         id="googleAnalyticsId"531 |                         value={seoSettings.googleAnalyticsId || ''}532 |                         onChange={(e) => updateSetting('googleAnalyticsId', e.target.value)}533 |                         placeholder="GA4-XXXXXXXXX"534 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"535 |                       />536 |                     </div>537 | 538 |                     <div className="space-y-2">539 |                       <Label htmlFor="googleTagManagerId" className="text-[#C0C0C0]">Google Tag Manager ID</Label>540 |                       <BaseInput541 |                         id="googleTagManagerId"542 |                         value={seoSettings.googleTagManagerId || ''}543 |                         onChange={(e) => updateSetting('googleTagManagerId', e.target.value)}544 |                         placeholder="GTM-XXXXXXX"545 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"546 |                       />547 |                     </div>548 | 549 |                     <div className="space-y-2">550 |                       <Label htmlFor="facebookPixelId" className="text-[#C0C0C0]">Facebook Pixel ID</Label>551 |                       <BaseInput552 |                         id="facebookPixelId"553 |                         value={seoSettings.facebookPixelId || ''}554 |                         onChange={(e) => updateSetting('facebookPixelId', e.target.value)}555 |                         placeholder="Enter Facebook Pixel ID..."556 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"557 |                       />558 |                     </div>559 |                   </>560 |                 )}561 | 562 |                 {}563 |                 {activeSection === 'structured' && (564 |                   <>565 |                     <div className="space-y-2">566 |                       <Label htmlFor="organizationName" className="text-[#C0C0C0]">Organization Name</Label>567 |                       <BaseInput568 |                         id="organizationName"569 |                         value={seoSettings.organizationName}570 |                         onChange={(e) => updateSetting('organizationName', e.target.value)}571 |                         placeholder="MatMax Yoga Studio"572 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"573 |                       />574 |                     </div>575 | 576 |                     <div className="space-y-2">577 |                       <Label htmlFor="organizationType" className="text-[#C0C0C0]">Organization Type</Label>578 |                       <BaseInput579 |                         id="organizationType"580 |                         value={seoSettings.organizationType}581 |                         onChange={(e) => updateSetting('organizationType', e.target.value)}582 |                         placeholder="ProfessionalService"583 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"584 |                       />585 |                     </div>586 | 587 |                     <div className="space-y-2">588 |                       <Label htmlFor="contactEmail" className="text-[#C0C0C0]">Contact Email</Label>589 |                       <BaseInput590 |                         id="contactEmail"591 |                         value={seoSettings.contactEmail}592 |                         onChange={(e) => updateSetting('contactEmail', e.target.value)}593 |                         placeholder="info@matmax.store"594 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"595 |                       />596 |                     </div>597 | 598 |                     <div className="space-y-2">599 |                       <Label htmlFor="contactPhone" className="text-[#C0C0C0]">Contact Phone</Label>600 |                       <BaseInput601 |                         id="contactPhone"602 |                         value={seoSettings.contactPhone}603 |                         onChange={(e) => updateSetting('contactPhone', e.target.value)}604 |                         placeholder="+1-XXX-XXX-XXXX"605 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]"606 |                       />607 |                     </div>608 | 609 |                     <div className="space-y-2">610 |                       <Label htmlFor="address" className="text-[#C0C0C0]">Business Address</Label>611 |                       <Textarea612 |                         id="address"613 |                         value={seoSettings.address}614 |                         onChange={(e) => updateSetting('address', e.target.value)}615 |                         placeholder="Enter business address..."616 |                         className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)] text-[var(--color-text-primary)] min-h-[60px]"617 |                       />618 |                     </div>619 |                   </>620 |                 )}621 |               </div>622 |             </CardContent>623 |           </Card>624 |         </div>625 |       </div>626 | 627 |       {}628 |       {showPreview && (629 |         <Card className="bg-[var(--color-surface-primary)] border-[var(--color-border-500)]">630 |           <CardHeader>631 |             <CardTitle className="text-[#EAEAEA] text-lg">SEO Preview</CardTitle>632 |           </CardHeader>633 |           <CardContent>634 |             <div className="space-y-4">635 |               {}636 |               <div>637 |                 <h3 className="text-lg font-heading text-[#FFD700] mb-3">Google Search Result</h3>638 |                 <div className="p-4 bg-white rounded-lg">639 |                   <div className="text-blue-600 text-lg hover:underline cursor-pointer">{seoSettings.title}</div>640 |                   <div className="text-green-700 text-sm">{seoSettings.canonical}</div>641 |                   <div className="text-gray-600 text-sm mt-1">{seoSettings.description}</div>642 |                 </div>643 |               </div>644 | 645 |               {}646 |               {seoSettings.ogImage && (647 |                 <div>648 |                   <h3 className="text-lg font-heading text-[#FFD700] mb-3">Facebook Preview</h3>649 |                   <div className="border border-gray-300 rounded-lg bg-white max-w-md">650 |                     <Image src={seoSettings.ogImage} alt="OG Preview" width={400} height={192} className="w-full h-48 object-cover rounded-t-lg" />651 |                     <div className="p-3">652 |                       <div className="font-semibold text-black">{seoSettings.ogTitle}</div>653 |                       <div className="text-gray-600 text-sm">{seoSettings.ogDescription}</div>654 |                       <div className="text-gray-500 text-xs uppercase">{seoSettings.canonical}</div>655 |                     </div>656 |                   </div>657 |                 </div>658 |               )}659 |             </div>660 |           </CardContent>661 |         </Card>662 |       )}663 | 664 |       {}665 |       {hasUnsavedChanges && (666 |         <motion.div667 |           initial={{ opacity: 0, y: 20 }}668 |           animate={{ opacity: 1, y: 0 }}669 |           className="fixed bottom-6 right-6 z-50"670 |         >671 |           <Card className="bg-[var(--color-surface-primary)]/95 backdrop-blur-lg border-[var(--color-accent-500)]/40 shadow-xl shadow-[var(--color-accent-500)]/30">672 |             <CardContent className="p-4">673 |               <div className="flex items-center justify-between space-x-4">674 |                 {}675 |                 <div className="flex items-center space-x-3">676 |                   <div className="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>677 |                   <span className="text-[var(--color-text-primary)] text-sm font-medium">Unsaved changes</span>678 |                 </div>679 | 680 |                 {}681 |                 <div className="flex items-center space-x-3">682 |                   <BaseButton683 |                     onClick={discardChanges}684 |                     variant="outline"685 |                     size="sm"686 |                     className="border-[var(--color-border-500)] text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-secondary)] hover:text-[var(--color-text-primary)] transition-all duration-200 min-w-[80px]"687 |                   >688 |                     <RefreshCw size={14} className="mr-1" />689 |                     Discard690 |                   </BaseButton>691 | 692 |                   <BaseButton693 |                     onClick={saveSeoSettings}694 |                     disabled={isSaving}695 |                     size="sm"696 |                     className="dashboard-button-primary min-w-[80px]"697 |                   >698 |                     {isSaving ? (699 |                       <motion.div700 |                         animate={{ rotate: 360 }}701 |                         transition={{ duration: 1, repeat: Infinity, ease: "linear" }}702 |                         className="w-3 h-3 border-2 border-[var(--color-background-primary)] border-t-transparent rounded-full mr-1"703 |                       />704 |                     ) : (705 |                       <Save size={14} className="mr-1" />706 |                     )}707 |                     Save708 |                   </BaseButton>709 |                 </div>710 |               </div>711 |             </CardContent>712 |           </Card>713 |         </motion.div>714 |       )}715 |     </div>716 |   );717 | }
============================================================END: frontend/components/SeoManagement.tsx============================================================


============================================================FILE: frontend/components/SessionSection.tsxSIZE: 5.83 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { motion } from 'framer-motion';  5 | import { Clock, FileText, Headphones } from 'lucide-react';  6 | import { Button } from '@/components/ui/button';  7 | import { AstralChart } from './AstralChart';  8 |   9 | interface SessionSectionProps { 10 |   t: Record<string, string | Record<string, string>>; 11 |   scrollToSection: (section: string) => void; 12 | } 13 |  14 | export function SessionSection({ t, scrollToSection }: SessionSectionProps) { 15 |   const deliverableIcons = [Clock, FileText, Headphones]; 16 |  17 |   return ( 18 |     <section className="h-full flex flex-col justify-start px-4 sm:px-6 lg:px-8 py-12 sm:py-16 lg:py-20 overflow-hidden safe-padding pt-20 sm:pt-24 lg:pt-28"> 19 |       <div className="container mx-auto max-w-7xl"> 20 |         <div className="grid gap-8 md:grid-cols-2 md:gap-10 lg:gap-16 items-center"> 21 |           <motion.div 22 |             initial={{ opacity: 0, x: -40 }} 23 |             whileInView={{ opacity: 1, x: 0 }} 24 |             transition={{ duration: 0.8 }} 25 |             className="order-2 md:order-1" 26 |           > 27 |             <h2 className="text-2xl xs:text-3xl sm:text-4xl md:text-3xl lg:text-4xl xl:text-5xl font-heading text-[#EAEAEA] mb-4 sm:mb-6 leading-tight"> 28 |               {typeof t.session === 'object' && t.session?.title || 'Book Your Session'} 29 |             </h2> 30 |  31 |             <div className="text-3xl xs:text-4xl sm:text-5xl md:text-3xl lg:text-4xl font-heading text-[#FFD700] mb-4 sm:mb-6 cosmic-glow"> 32 |               {typeof t.session === 'object' && t.session?.price || '$150'} 33 |             </div> 34 |  35 |             <p className="text-sm sm:text-base md:text-sm lg:text-base text-[#EAEAEA]/80 leading-relaxed mb-6 sm:mb-8 max-w-2xl"> 36 |               {typeof t.session === 'object' && t.session?.description || 'Ready to begin your spiritual journey?'} 37 |             </p> 38 |  39 |             <div className="space-y-3 sm:space-y-4 mb-8 sm:mb-10"> 40 |               {(typeof t.session === 'object' && t.session?.deliverables && Array.isArray(t.session.deliverables) ? t.session.deliverables : ['Personalized Reading', 'Detailed Analysis', 'Follow-up Support']).map((item: string, index: number) => { 41 |                 const Icon = deliverableIcons[index]; 42 |                 return ( 43 |                   <motion.div 44 |                     key={index} 45 |                     initial={{ opacity: 0, x: -20 }} 46 |                     whileInView={{ opacity: 1, x: 0 }} 47 |                     transition={{ duration: 0.5, delay: index * 0.1 }} 48 |                     className="flex items-start space-x-3 sm:space-x-4" 49 |                   > 50 |                     <div className="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-[#FFD700]/10 rounded-full flex items-center justify-center border border-[#FFD700]/20"> 51 |                       <Icon size={16} className="sm:w-5 sm:h-5 text-[#FFD700]" /> 52 |                     </div> 53 |                     <span className="text-sm sm:text-base text-[#EAEAEA] leading-relaxed pt-1 sm:pt-1.5">{item}</span> 54 |                   </motion.div> 55 |                 ); 56 |               })} 57 |             </div> 58 |  59 |             <motion.div 60 |               initial={{ opacity: 0, y: 20 }} 61 |               whileInView={{ opacity: 1, y: 0 }} 62 |               transition={{ duration: 0.6, delay: 0.4 }} 63 |             > 64 |               <Button 65 |                 onClick={() => scrollToSection('apply')} 66 |                 className="bg-[#FFD700] text-[#0A0A23] hover:bg-[#FFD700]/90 px-8 sm:px-10 py-3 sm:py-4 text-base sm:text-lg font-medium rounded-lg shadow-lg shadow-[#FFD700]/20 cosmic-glow w-full sm:w-auto touch-manipulation" 67 |               > 68 |                 {typeof t.session === 'object' && t.session?.cta || 'Get Started'} 69 |               </Button> 70 |             </motion.div> 71 |           </motion.div> 72 |  73 |           <motion.div 74 |             initial={{ opacity: 0, x: 40 }} 75 |             whileInView={{ opacity: 1, x: 0 }} 76 |             transition={{ duration: 0.8, delay: 0.3 }} 77 |             className="relative order-1 md:order-2" 78 |           > 79 |             <div className="bg-gradient-to-br from-[#191970]/30 to-[#0A0A23]/30 p-3 sm:p-6 md:p-4 lg:p-8 rounded-xl sm:rounded-2xl backdrop-blur-sm border border-[#C0C0C0]/10 relative overflow-hidden"> 80 |               {} 81 |               <div className="absolute inset-0 opacity-5"> 82 |                 <motion.div 83 |                   animate={{ rotate: 360 }} 84 |                   transition={{ duration: 60, repeat: Infinity, ease: "linear" }} 85 |                   className="absolute top-2 sm:top-4 right-2 sm:right-4 w-8 sm:w-16 h-8 sm:h-16 border border-[#FFD700]/20 rounded-full" 86 |                 /> 87 |                 <motion.div 88 |                   animate={{ rotate: -360 }} 89 |                   transition={{ duration: 40, repeat: Infinity, ease: "linear" }} 90 |                   className="absolute bottom-2 sm:bottom-4 left-2 sm:left-4 w-6 sm:w-12 h-6 sm:h-12 border border-[#C0C0C0]/20 rounded-full" 91 |                 /> 92 |               </div> 93 |  94 |               {} 95 |               <motion.div 96 |                 initial={{ scale: 0.8, opacity: 0 }} 97 |                 whileInView={{ scale: 1, opacity: 1 }} 98 |                 transition={{ duration: 1, delay: 0.5 }} 99 |                 className="relative z-10"100 |               >101 |                 <AstralChart />102 |               </motion.div>103 | 104 |               {}105 |               <motion.div106 |                 initial={{ opacity: 0, y: 20 }}107 |                 whileInView={{ opacity: 1, y: 0 }}108 |                 transition={{ duration: 0.8, delay: 1.2 }}109 |                 className="text-center mt-3 sm:mt-6"110 |               >111 |                 <p className="text-[#FFD700] font-heading text-sm sm:text-base lg:text-lg">112 |                   Your Cosmic Blueprint113 |                 </p>114 |                 <p className="text-[#EAEAEA]/60 text-xs sm:text-sm mt-1 sm:mt-2">115 |                   Personalized astrological analysis116 |                 </p>117 |               </motion.div>118 |             </div>119 |           </motion.div>120 |         </div>121 |       </div>122 |     </section>123 |   );124 | }
============================================================END: frontend/components/SessionSection.tsx============================================================


============================================================FILE: frontend/components/SettingsManagement.tsxSIZE: 14.25 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { motion } from 'framer-motion';  5 | import {  6 |   Database,  7 |   Download,  8 |   CheckCircle,  9 |   XCircle, 10 | } from 'lucide-react'; 11 | import { BaseCard } from '@/components/ui/BaseCard'; 12 | import { BaseButton } from '@/components/ui/BaseButton'; 13 | import { useAuth } from '../hooks/useAuth'; 14 |  15 | export function SettingsManagement() { 16 |   const { user } = useAuth(); 17 |   const [isSeeding, setIsSeeding] = useState(false); 18 |   const [seedStatus, setSeedStatus] = useState<'idle' | 'success' | 'error'>('idle'); 19 |   const [seedMessage, setSeedMessage] = useState(''); 20 |   const [isSeedingCustomers, setIsSeedingCustomers] = useState(false); 21 |   const [seedCustomersStatus, setSeedCustomersStatus] = useState<'idle' | 'success' | 'error'>('idle'); 22 |   const [seedCustomersMessage, setSeedCustomersMessage] = useState(''); 23 |   const [isSeedingSchedules, setIsSeedingSchedules] = useState(false); 24 |   const [seedSchedulesStatus, setSeedSchedulesStatus] = useState<'idle' | 'success' | 'error'>('idle'); 25 |   const [seedSchedulesMessage, setSeedSchedulesMessage] = useState(''); 26 |  27 |   const handleSeedContent = async () => { 28 |     if (!confirm('Are you sure you want to seed the homepage content? This will overwrite existing content.')) { 29 |       return; 30 |     } 31 |  32 |     if (!user?.access_token) { 33 |       setSeedStatus('error'); 34 |       setSeedMessage('Authentication required. Please log in again.'); 35 |       return; 36 |     } 37 |  38 |     setIsSeeding(true); 39 |     setSeedStatus('idle'); 40 |     setSeedMessage(''); 41 |  42 |     try { 43 |       const response = await fetch('/api/admin/content/seed', { 44 |         method: 'POST', 45 |         headers: { 46 |           'Content-Type': 'application/json', 47 |           'Authorization': `Bearer ${user.access_token}`, 48 |         }, 49 |       }); 50 |  51 |       if (response.ok) { 52 |         await response.json(); 53 |         setSeedStatus('success'); 54 |         setSeedMessage('Homepage content seeded successfully!'); 55 |       } else { 56 |         const error = await response.json(); 57 |         setSeedStatus('error'); 58 |         setSeedMessage(error.message || 'Failed to seed content'); 59 |       } 60 |     } catch { 61 |       setSeedStatus('error'); 62 |       setSeedMessage('Network error occurred while seeding content'); 63 |     } finally { 64 |       setIsSeeding(false); 65 |     } 66 |   }; 67 |  68 |   const handleSeedCustomers = async (clearExisting = false) => { 69 |     const message = clearExisting 70 |       ? 'Are you sure you want to clear existing sample customers and seed 3 new ones? This will overwrite any existing sample customers.' 71 |       : 'Are you sure you want to seed 3 sample customers? This will create new customer records (existing ones will be skipped).'; 72 |  73 |     if (!confirm(message)) { 74 |       return; 75 |     } 76 |  77 |     if (!user?.access_token) { 78 |       setSeedCustomersStatus('error'); 79 |       setSeedCustomersMessage('Authentication required. Please log in again.'); 80 |       return; 81 |     } 82 |  83 |     setIsSeedingCustomers(true); 84 |     setSeedCustomersStatus('idle'); 85 |     setSeedCustomersMessage(''); 86 |  87 |     try { 88 |       const url = clearExisting 89 |         ? '/api/admin/seed/users?clear=true' 90 |         : '/api/admin/seed/users'; 91 |  92 |       const response = await fetch(url, { 93 |         method: 'POST', 94 |         headers: { 95 |           'Content-Type': 'application/json', 96 |           'Authorization': `Bearer ${user.access_token}`, 97 |         }, 98 |       }); 99 | 100 |       if (response.ok) {101 |         await response.json();102 |         setSeedCustomersStatus('success');103 |         setSeedCustomersMessage(clearExisting104 |           ? 'Sample customers cleared and reseeded successfully!'105 |           : 'Sample customers seeded successfully!'106 |         );107 |       } else {108 |         const error = await response.json();109 |         setSeedCustomersStatus('error');110 |         setSeedCustomersMessage(error.message || 'Failed to seed customers');111 |       }112 |     } catch {113 |       setSeedCustomersStatus('error');114 |       setSeedCustomersMessage('Network error occurred while seeding customers');115 |     } finally {116 |       setIsSeedingCustomers(false);117 |     }118 |   };119 | 120 |   const handleSeedSchedules = async () => {121 |     if (!confirm('Are you sure you want to seed sample schedules? This will create new schedule templates.')) {122 |       return;123 |     }124 | 125 |     if (!user?.access_token) {126 |       setSeedSchedulesStatus('error');127 |       setSeedSchedulesMessage('Authentication required. Please log in again.');128 |       return;129 |     }130 | 131 |     setIsSeedingSchedules(true);132 |     setSeedSchedulesStatus('idle');133 |     setSeedSchedulesMessage('');134 | 135 |     try {136 |       const response = await fetch('/api/admin/seed/schedules', {137 |         method: 'POST',138 |         headers: {139 |           'Content-Type': 'application/json',140 |           'Authorization': `Bearer ${user.access_token}`,141 |         },142 |       });143 | 144 |       if (response.ok) {145 |         await response.json();146 |         setSeedSchedulesStatus('success');147 |         setSeedSchedulesMessage('Sample schedules seeded successfully!');148 |       } else {149 |         const error = await response.json();150 |         setSeedSchedulesStatus('error');151 |         setSeedSchedulesMessage(error.message || 'Failed to seed schedules');152 |       }153 |     } catch {154 |       setSeedSchedulesStatus('error');155 |       setSeedSchedulesMessage('Network error occurred while seeding schedules');156 |     } finally {157 |       setIsSeedingSchedules(false);158 |     }159 |   };160 | 161 |   return (162 |     <div className="dashboard-container p-6 space-y-6">163 |       <div className="flex items-center justify-between">164 |         <h2 className="dashboard-text-primary text-2xl font-bold">Settings & Configuration</h2>165 |       </div>166 | 167 |       {}168 |       <BaseCard variant="default" size="lg">169 |         <BaseCard.Header>170 |           <h3 className="dashboard-text-primary text-xl font-semibold">Content Management</h3>171 |         </BaseCard.Header>172 |         <BaseCard.Content>173 |           <div className="space-y-4">174 |             <div className="flex items-center justify-between">175 |               <div>176 |                 <h4 className="dashboard-text-primary text-lg font-medium">Seed Homepage Content</h4>177 |                 <p className="dashboard-text-secondary">Populate the homepage with sample content and sections</p>178 |               </div>179 |               <BaseButton180 |                 variant="primary"181 |                 onClick={handleSeedContent}182 |                 loading={isSeeding}183 |                 leftIcon={<Download className="w-4 h-4" />}184 |               >185 |                 Seed Content186 |               </BaseButton>187 |             </div>188 | 189 |             {seedStatus !== 'idle' && (190 |               <motion.div191 |                 initial={{ opacity: 0, x: 20 }}192 |                 animate={{ opacity: 1, x: 0 }}193 |                 className={`flex items-center space-x-2 px-[var(--spacing-3)] py-[var(--spacing-2)] rounded-[var(--border-radius-lg)] ${194 |                   seedStatus === 'success'195 |                     ? `bg-[var(--color-status-success)]/20 text-[var(--color-status-success)] border border-[var(--color-status-success)]/30`196 |                     : `bg-[var(--color-status-error)]/20 text-[var(--color-status-error)] border border-[var(--color-status-error)]/30`197 |                 }`}198 |               >199 |                 {seedStatus === 'success' ? (200 |                   <CheckCircle className="w-4 h-4" />201 |                 ) : (202 |                   <XCircle className="w-4 h-4" />203 |                 )}204 |                 <span className="text-[var(--font-size-sm)]">{seedMessage}</span>205 |               </motion.div>206 |             )}207 |           </div>208 |         </BaseCard.Content>209 |       </BaseCard>210 | 211 |       {}212 |       <BaseCard variant="default" size="lg">213 |         <BaseCard.Header>214 |           <h3 className="dashboard-text-primary text-xl font-semibold">Customer Management</h3>215 |         </BaseCard.Header>216 |         <BaseCard.Content>217 |           <div className="space-y-4">218 |             <div className="flex items-center justify-between">219 |               <div>220 |                 <h4 className="dashboard-text-primary text-lg font-medium">Seed Sample Customers</h4>221 |                 <p className="dashboard-text-secondary">Create sample customer records for testing</p>222 |               </div>223 |               <div className="flex space-x-2">224 |                 <BaseButton225 |                   variant="outline"226 |                   onClick={() => handleSeedCustomers(false)}227 |                   loading={isSeedingCustomers}228 |                   leftIcon={<Download className="w-4 h-4" />}229 |                 >230 |                   Add Customers231 |                 </BaseButton>232 |                 <BaseButton233 |                   variant="outline"234 |                   onClick={() => handleSeedCustomers(true)}235 |                   loading={isSeedingCustomers}236 |                   leftIcon={<Download className="w-4 h-4" />}237 |                 >238 |                   Replace All239 |                 </BaseButton>240 |               </div>241 |             </div>242 | 243 |             {seedCustomersStatus !== 'idle' && (244 |               <motion.div245 |                 initial={{ opacity: 0, x: 20 }}246 |                 animate={{ opacity: 1, x: 0 }}247 |                 className={`flex items-center space-x-2 px-[var(--spacing-3)] py-[var(--spacing-2)] rounded-[var(--border-radius-lg)] ${248 |                   seedCustomersStatus === 'success'249 |                     ? `bg-[var(--color-status-success)]/20 text-[var(--color-status-success)] border border-[var(--color-status-success)]/30`250 |                     : `bg-[var(--color-status-error)]/20 text-[var(--color-status-error)] border border-[var(--color-status-error)]/30`251 |                 }`}252 |               >253 |                 {seedCustomersStatus === 'success' ? (254 |                   <CheckCircle className="w-4 h-4" />255 |                 ) : (256 |                   <XCircle className="w-4 h-4" />257 |                 )}258 |                 <span className="text-[var(--font-size-sm)]">{seedCustomersMessage}</span>259 |               </motion.div>260 |             )}261 |           </div>262 |         </BaseCard.Content>263 |       </BaseCard>264 | 265 |       {}266 |       <BaseCard variant="default" size="lg">267 |         <BaseCard.Header>268 |           <h3 className="dashboard-text-primary text-xl font-semibold">Schedule Management</h3>269 |         </BaseCard.Header>270 |         <BaseCard.Content>271 |           <div className="space-y-4">272 |             <div className="flex items-center justify-between">273 |               <div>274 |                 <h4 className="dashboard-text-primary text-lg font-medium">Seed Sample Schedules</h4>275 |                 <p className="dashboard-text-secondary">Create sample schedule templates for testing</p>276 |               </div>277 |               <BaseButton278 |                 variant="outline"279 |                 onClick={handleSeedSchedules}280 |                 loading={isSeedingSchedules}281 |                 leftIcon={<Download className="w-4 h-4" />}282 |               >283 |                 Seed Schedules284 |               </BaseButton>285 |             </div>286 | 287 |             {seedSchedulesStatus !== 'idle' && (288 |               <motion.div289 |                 initial={{ opacity: 0, x: 20 }}290 |                 animate={{ opacity: 1, x: 0 }}291 |                 className={`flex items-center space-x-2 px-[var(--spacing-3)] py-[var(--spacing-2)] rounded-[var(--border-radius-lg)] ${292 |                   seedSchedulesStatus === 'success'293 |                     ? `bg-[var(--color-status-success)]/20 text-[var(--color-status-success)] border border-[var(--color-status-success)]/30`294 |                     : `bg-[var(--color-status-error)]/20 text-[var(--color-status-error)] border border-[var(--color-status-error)]/30`295 |                 }`}296 |               >297 |                 {seedSchedulesStatus === 'success' ? (298 |                   <CheckCircle className="w-4 h-4" />299 |                 ) : (300 |                   <XCircle className="w-4 h-4" />301 |                 )}302 |                 <span className="text-[var(--font-size-sm)]">{seedSchedulesMessage}</span>303 |               </motion.div>304 |             )}305 |           </div>306 |         </BaseCard.Content>307 |       </BaseCard>308 | 309 |       {}310 |       <BaseCard variant="default" size="lg">311 |         <BaseCard.Header>312 |           <h3 className="dashboard-text-primary text-xl font-semibold">System Status</h3>313 |         </BaseCard.Header>314 |         <BaseCard.Content>315 |           <div className="space-y-6">316 |             {}317 |             <div className="flex items-center justify-between p-4 bg-green-900/20 border border-green-500/30 rounded-lg">318 |               <div className="flex items-center space-x-3">319 |                 <CheckCircle className="w-5 h-5 text-green-400" />320 |                 <div>321 |                   <h4 className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-white mb-[var(--spacing-2)]">322 |                     Database Connection323 |                   </h4>324 |                   <p className="text-white">Connected</p>325 |                 </div>326 |               </div>327 |             </div>328 | 329 |             {}330 |             <div className="flex items-center justify-between p-4 bg-green-900/20 border border-green-500/30 rounded-lg">331 |               <div className="flex items-center space-x-3">332 |                 <CheckCircle className="w-5 h-5 text-green-400" />333 |                 <div>334 |                   <h4 className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-white mb-[var(--spacing-2)]">335 |                     API Service336 |                   </h4>337 |                   <p className="text-white">Operational</p>338 |                 </div>339 |               </div>340 |             </div>341 | 342 |             {}343 |             <div className="flex items-center justify-between p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg">344 |               <div className="flex items-center space-x-3">345 |                 <Database className="w-5 h-5 text-blue-400" />346 |                 <div>347 |                   <h4 className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-white mb-[var(--spacing-2)]">348 |                     Application Version349 |                   </h4>350 |                   <p className="text-white">v1.0.0</p>351 |                 </div>352 |               </div>353 |             </div>354 | 355 |             {}356 |             <div className="flex items-center justify-between p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg">357 |               <div className="flex items-center space-x-3">358 |                 <Database className="w-5 h-5 text-blue-400" />359 |                 <div>360 |                   <h4 className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-white mb-[var(--spacing-2)]">361 |                     Last Updated362 |                   </h4>363 |                   <p className="text-white">{new Date().toLocaleDateString()}</p>364 |                 </div>365 |               </div>366 |             </div>367 |           </div>368 |         </BaseCard.Content>369 |       </BaseCard>370 |     </div>371 |   );372 | }
============================================================END: frontend/components/SettingsManagement.tsx============================================================


============================================================FILE: frontend/components/TelegramConfigManagement.tsxSIZE: 14.89 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { useAuth } from '@/hooks/useAuth';  5 | import { toast } from 'sonner';  6 | import {  7 |   Bot,  8 |   TestTube,  9 |   CheckCircle, 10 |   XCircle, 11 |   AlertCircle, 12 |   Webhook, 13 |   Key, 14 |   Save, 15 |   Trash2, 16 |   RefreshCw 17 | } from 'lucide-react'; 18 |  19 | interface TelegramConfig { 20 |   id?: string; 21 |   bot_token: string; 22 |   webhook_url: string; 23 |   is_active: boolean; 24 |   bot_username: string; 25 |   bot_name: string; 26 |   webhook_set: boolean; 27 |   last_webhook_error: string | null; 28 |   created_at?: string; 29 |   updated_at?: string; 30 | } 31 |  32 | interface BotInfo { 33 |   id: number; 34 |   first_name: string; 35 |   username?: string; 36 |   can_join_groups: boolean; 37 |   can_read_all_group_messages: boolean; 38 |   supports_inline_queries: boolean; 39 | } 40 |  41 | export function TelegramConfigManagement() { 42 |   const { user } = useAuth(); 43 |   const [config, setConfig] = useState<TelegramConfig | null>(null); 44 |   const [loading, setLoading] = useState(true); 45 |   const [saving, setSaving] = useState(false); 46 |   const [testing, setTesting] = useState(false); 47 |   const [botInfo, setBotInfo] = useState<BotInfo | null>(null); 48 |   const [showToken, setShowToken] = useState(false); 49 |  50 |   const [formData, setFormData] = useState({ 51 |     bot_token: '', 52 |     webhook_url: '', 53 |     is_active: false 54 |   }); 55 |  56 |   const loadConfig = useCallback(async () => { 57 |     try { 58 |       setLoading(true); 59 |       const response = await fetch('/api/admin/telegram-config', { 60 |         headers: { 61 |           'Authorization': `Bearer ${user?.access_token}`, 62 |         }, 63 |       }); 64 |  65 |       if (response.ok) { 66 |         const result = await response.json(); 67 |         setConfig(result.config); 68 |         setFormData({ 69 |           bot_token: result.config.bot_token || '', 70 |           webhook_url: result.config.webhook_url || '', 71 |           is_active: result.config.is_active || false 72 |         }); 73 |       } else { 74 |         toast.error('Failed to load Telegram configuration'); 75 |       } 76 |     } catch (error) { 77 |       toast.error('Failed to load configuration'); 78 |     } finally { 79 |       setLoading(false); 80 |     } 81 |   }, [user?.access_token]); 82 |  83 |   useEffect(() => { 84 |     if (user?.access_token) { 85 |       loadConfig(); 86 |     } 87 |   }, [user?.access_token, loadConfig]); 88 |  89 |   const handleInputChange = (field: string, value: string | boolean) => { 90 |     setFormData(prev => ({ ...prev, [field]: value })); 91 |   }; 92 |  93 |   const testConnection = async () => { 94 |     if (!formData.bot_token) { 95 |       toast.error('Please enter a bot token first'); 96 |       return; 97 |     } 98 |  99 |     setTesting(true);100 |     try {101 |       const response = await fetch('/api/admin/telegram-config', {102 |         method: 'POST',103 |         headers: {104 |           'Authorization': `Bearer ${user?.access_token}`,105 |           'Content-Type': 'application/json'106 |         },107 |         body: JSON.stringify({108 |           bot_token: formData.bot_token,109 |           webhook_url: formData.webhook_url,110 |           is_active: false111 |         })112 |       });113 | 114 |       const result = await response.json();115 | 116 |       if (result.success) {117 |         setBotInfo(result.botInfo);118 |         toast.success('Bot connection test successful!');119 |       } else {120 |         toast.error(result.details || 'Connection test failed');121 |       }122 |     } catch (error) {123 |       toast.error('Connection test failed');124 |     } finally {125 |       setTesting(false);126 |     }127 |   };128 | 129 |   const handleSave = async () => {130 |     setSaving(true);131 |     try {132 |       const response = await fetch('/api/admin/telegram-config', {133 |         method: 'POST',134 |         headers: {135 |           'Authorization': `Bearer ${user?.access_token}`,136 |           'Content-Type': 'application/json'137 |         },138 |         body: JSON.stringify(formData)139 |       });140 | 141 |       const result = await response.json();142 | 143 |       if (result.success) {144 |         setConfig(result.config);145 |         toast.success('Telegram configuration saved successfully!');146 |         await loadConfig();147 |       } else {148 |         toast.error(result.details || 'Failed to save configuration');149 |       }150 |     } catch (error) {151 |       toast.error('Failed to save configuration');152 |     } finally {153 |       setSaving(false);154 |     }155 |   };156 | 157 |   const handleDelete = async () => {158 |     if (!confirm('Are you sure you want to delete the Telegram configuration? This will also remove the webhook.')) {159 |       return;160 |     }161 | 162 |     setSaving(true);163 |     try {164 |       const response = await fetch('/api/admin/telegram-config', {165 |         method: 'DELETE',166 |         headers: {167 |           'Authorization': `Bearer ${user?.access_token}`,168 |         }169 |       });170 | 171 |       const result = await response.json();172 | 173 |       if (result.success) {174 |         setConfig(null);175 |         setFormData({176 |           bot_token: '',177 |           webhook_url: '',178 |           is_active: false179 |         });180 |         setBotInfo(null);181 |         toast.success('Telegram configuration deleted successfully!');182 |       } else {183 |         toast.error(result.details || 'Failed to delete configuration');184 |       }185 |     } catch (error) {186 |       toast.error('Failed to delete configuration');187 |     } finally {188 |       setSaving(false);189 |     }190 |   };191 | 192 |   if (loading) {193 |     return (194 |       <div className="flex items-center justify-center p-8">195 |         <RefreshCw className="h-8 w-8 animate-spin text-blue-500" />196 |         <span className="ml-2 text-gray-600">Loading Telegram configuration...</span>197 |       </div>198 |     );199 |   }200 | 201 |   return (202 |     <div className="max-w-4xl mx-auto p-6 space-y-6">203 |       <div className="bg-white rounded-lg shadow-sm border border-gray-200">204 |         <div className="px-6 py-4 border-b border-gray-200">205 |           <div className="flex items-center space-x-3">206 |             <Bot className="h-6 w-6 text-blue-500" />207 |             <h2 className="text-xl font-semibold text-gray-900">Telegram Bot Configuration</h2>208 |           </div>209 |           <p className="text-sm text-gray-600 mt-1">210 |             Configure your Telegram bot integration for conversational AI211 |           </p>212 |         </div>213 | 214 |         <div className="p-6 space-y-6">215 |           {}216 |           <div className="space-y-2">217 |             <label className="flex items-center space-x-2 text-sm font-medium text-gray-700">218 |               <Key className="h-4 w-4" />219 |               <span>Bot Token</span>220 |             </label>221 |             <div className="relative">222 |               <input223 |                 type={showToken ? "text" : "password"}224 |                 value={formData.bot_token}225 |                 onChange={(e) => handleInputChange('bot_token', e.target.value)}226 |                 placeholder="Enter your Telegram bot token (e.g., 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz)"227 |                 className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"228 |               />229 |               <button230 |                 type="button"231 |                 onClick={() => setShowToken(!showToken)}232 |                 className="absolute right-3 top-2.5 text-gray-400 hover:text-gray-600"233 |               >234 |                 {showToken ? 'Hide' : 'Show'}235 |               </button>236 |             </div>237 |             <p className="text-xs text-gray-500">238 |               Get your bot token from @BotFather on Telegram239 |             </p>240 |           </div>241 | 242 |           {}243 |           <div className="space-y-2">244 |             <label className="flex items-center space-x-2 text-sm font-medium text-gray-700">245 |               <Webhook className="h-4 w-4" />246 |               <span>Webhook URL</span>247 |             </label>248 |             <input249 |               type="url"250 |               value={formData.webhook_url}251 |               onChange={(e) => handleInputChange('webhook_url', e.target.value)}252 |               placeholder="https:253 |               className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"254 |             />255 |             <p className="text-xs text-gray-500">256 |               The webhook URL where Telegram will send messages257 |             </p>258 |           </div>259 | 260 |           {}261 |           <div className="flex items-center space-x-3">262 |             <input263 |               type="checkbox"264 |               id="is_active"265 |               checked={formData.is_active}266 |               onChange={(e) => handleInputChange('is_active', e.target.checked)}267 |               className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"268 |             />269 |             <label htmlFor="is_active" className="text-sm font-medium text-gray-700">270 |               Activate Telegram bot271 |             </label>272 |           </div>273 | 274 |           {}275 |           <div className="flex items-center space-x-3 pt-4">276 |             <button277 |               onClick={testConnection}278 |               disabled={testing || !formData.bot_token}279 |               className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"280 |             >281 |               <TestTube className="h-4 w-4" />282 |               <span>{testing ? 'Testing...' : 'Test Connection'}</span>283 |             </button>284 | 285 |             <button286 |               onClick={handleSave}287 |               disabled={saving || !formData.bot_token}288 |               className="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"289 |             >290 |               <Save className="h-4 w-4" />291 |               <span>{saving ? 'Saving...' : 'Save Configuration'}</span>292 |             </button>293 | 294 |             {config && (295 |               <button296 |                 onClick={handleDelete}297 |                 disabled={saving}298 |                 className="flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"299 |               >300 |                 <Trash2 className="h-4 w-4" />301 |                 <span>Delete</span>302 |               </button>303 |             )}304 |           </div>305 |         </div>306 |       </div>307 | 308 |       {}309 |       {botInfo && (310 |         <div className="bg-white rounded-lg shadow-sm border border-gray-200">311 |           <div className="px-6 py-4 border-b border-gray-200">312 |             <h3 className="text-lg font-medium text-gray-900">Bot Information</h3>313 |           </div>314 |           <div className="p-6">315 |             <div className="grid grid-cols-1 md:grid-cols-2 gap-4">316 |               <div>317 |                 <label className="text-sm font-medium text-gray-500">Bot Name</label>318 |                 <p className="text-sm text-gray-900">{botInfo.first_name}</p>319 |               </div>320 |               <div>321 |                 <label className="text-sm font-medium text-gray-500">Username</label>322 |                 <p className="text-sm text-gray-900">@{botInfo.username || 'No username'}</p>323 |               </div>324 |               <div>325 |                 <label className="text-sm font-medium text-gray-500">Bot ID</label>326 |                 <p className="text-sm text-gray-900">{botInfo.id}</p>327 |               </div>328 |               <div>329 |                 <label className="text-sm font-medium text-gray-500">Can Join Groups</label>330 |                 <p className="text-sm text-gray-900">{botInfo.can_join_groups ? 'Yes' : 'No'}</p>331 |               </div>332 |             </div>333 |           </div>334 |         </div>335 |       )}336 | 337 |       {}338 |       {config && (339 |         <div className="bg-white rounded-lg shadow-sm border border-gray-200">340 |           <div className="px-6 py-4 border-b border-gray-200">341 |             <h3 className="text-lg font-medium text-gray-900">Configuration Status</h3>342 |           </div>343 |           <div className="p-6">344 |             <div className="space-y-4">345 |               <div className="flex items-center space-x-3">346 |                 {config.is_active ? (347 |                   <CheckCircle className="h-5 w-5 text-green-500" />348 |                 ) : (349 |                   <XCircle className="h-5 w-5 text-gray-400" />350 |                 )}351 |                 <span className="text-sm font-medium text-gray-700">Bot Active</span>352 |                 <span className={`text-xs px-2 py-1 rounded-full ${353 |                   config.is_active354 |                     ? 'bg-green-100 text-green-800'355 |                     : 'bg-gray-100 text-gray-800'356 |                 }`}>357 |                   {config.is_active ? 'Active' : 'Inactive'}358 |                 </span>359 |               </div>360 | 361 |               <div className="flex items-center space-x-3">362 |                 {config.webhook_set ? (363 |                   <CheckCircle className="h-5 w-5 text-green-500" />364 |                 ) : (365 |                   <XCircle className="h-5 w-5 text-red-500" />366 |                 )}367 |                 <span className="text-sm font-medium text-gray-700">Webhook Set</span>368 |                 <span className={`text-xs px-2 py-1 rounded-full ${369 |                   config.webhook_set370 |                     ? 'bg-green-100 text-green-800'371 |                     : 'bg-red-100 text-red-800'372 |                 }`}>373 |                   {config.webhook_set ? 'Set' : 'Not Set'}374 |                 </span>375 |               </div>376 | 377 |               {config.last_webhook_error && (378 |                 <div className="flex items-start space-x-3">379 |                   <AlertCircle className="h-5 w-5 text-red-500 mt-0.5" />380 |                   <div>381 |                     <span className="text-sm font-medium text-gray-700">Last Webhook Error</span>382 |                     <p className="text-xs text-red-600 mt-1">{config.last_webhook_error}</p>383 |                   </div>384 |                 </div>385 |               )}386 | 387 |               <div className="text-xs text-gray-500">388 |                 <p>Last updated: {config.updated_at ? new Date(config.updated_at).toLocaleString() : 'Never'}</p>389 |               </div>390 |             </div>391 |           </div>392 |         </div>393 |       )}394 | 395 |       {}396 |       <div className="bg-blue-50 rounded-lg p-6">397 |         <h3 className="text-lg font-medium text-blue-900 mb-3">Setup Instructions</h3>398 |         <div className="space-y-3 text-sm text-blue-800">399 |           <div className="flex items-start space-x-2">400 |             <span className="font-medium">1.</span>401 |             <span>Create a bot with @BotFather on Telegram and get your bot token</span>402 |           </div>403 |           <div className="flex items-start space-x-2">404 |             <span className="font-medium">2.</span>405 |             <span>Enter your bot token in the field above</span>406 |           </div>407 |           <div className="flex items-start space-x-2">408 |             <span className="font-medium">3.</span>409 |             <span>Set your webhook URL (usually your domain + /api/telegram/webhook)</span>410 |           </div>411 |           <div className="flex items-start space-x-2">412 |             <span className="font-medium">4.</span>413 |             <span>Test the connection to verify your bot token is valid</span>414 |           </div>415 |           <div className="flex items-start space-x-2">416 |             <span className="font-medium">5.</span>417 |             <span>Save the configuration to activate the bot</span>418 |           </div>419 |         </div>420 |       </div>421 |     </div>422 |   );423 | }
============================================================END: frontend/components/TelegramConfigManagement.tsx============================================================


============================================================FILE: frontend/components/admin/ConversationLogsManagement.tsxSIZE: 34.53 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { useAuth } from '@/hooks/useAuth';  6 | import {  7 |   ConversationLog,  8 |   ConversationStats  9 | } from '@/lib/types/conversational-orchestrator'; 10 | import { badgeStyles } from '@/lib/styles/common'; 11 | import { Button } from '@/components/ui/button'; 12 | import { Input } from '@/components/ui/input'; 13 | import { Label } from '@/components/ui/label'; 14 | import { Badge } from '@/components/ui/badge'; 15 | import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; 16 | import { 17 |   Select, 18 |   SelectContent, 19 |   SelectItem, 20 |   SelectTrigger, 21 |   SelectValue 22 | } from '@/components/ui/select'; 23 | import { 24 |   Table, 25 |   TableBody, 26 |   TableCell, 27 |   TableHead, 28 |   TableHeader, 29 |   TableRow 30 | } from '@/components/ui/table'; 31 | import { 32 |   Dialog, 33 |   DialogContent, 34 |   DialogHeader, 35 |   DialogTitle, 36 |   DialogTrigger 37 | } from '@/components/ui/dialog'; 38 | import { Textarea } from '@/components/ui/textarea'; 39 | import { 40 |   Download, 41 |   Filter, 42 |   RefreshCw, 43 |   Eye, 44 |   CheckCircle, 45 |   XCircle, 46 |   AlertTriangle, 47 |   TrendingUp, 48 |   MessageSquare, 49 |   Brain, 50 |   Star 51 | } from 'lucide-react'; 52 |  53 | export default function ConversationLogsManagement() { 54 |   const { user, isLoading, isAdmin } = useAuth(); 55 |   const [logs, setLogs] = useState<ConversationLog[]>([]); 56 |   const [stats] = useState<ConversationStats | null>(null); 57 |   const [loading, setLoading] = useState(false); 58 |   const [selectedLogs, setSelectedLogs] = useState<(string | number)[]>([]); 59 |   const [selectedLog, setSelectedLog] = useState<ConversationLog | null>(null); 60 |  61 |   const [filters, setFilters] = useState({ 62 |     userId: '', 63 |     dateFrom: '', 64 |     dateTo: '', 65 |     intent: '', 66 |     confidence: '', 67 |     hasFeedback: '', 68 |     page: 1, 69 |     limit: 50 70 |   }); 71 |  72 |   const [pagination, setPagination] = useState({ 73 |     page: 1, 74 |     limit: 50, 75 |     total: 0, 76 |     totalPages: 0, 77 |     hasNext: false, 78 |     hasPrev: false 79 |   }); 80 |  81 |   const fetchConversationLogs = useCallback(async () => { 82 |     if (!user?.access_token) { 83 |       return; 84 |     } 85 |  86 |     setLoading(true); 87 |     try { 88 |       const params = new URLSearchParams(); 89 |  90 |       Object.entries(filters).forEach(([key, value]) => { 91 |         if (value) params.append(key, value.toString()); 92 |       }); 93 |  94 |       const response = await fetch(`/api/admin/conversation-logs?${params.toString()}`, { 95 |         headers: { 96 |           'Authorization': `Bearer ${user.access_token}`, 97 |           'Content-Type': 'application/json' 98 |         } 99 |       });100 | 101 |       if (!response.ok) {102 |         throw new Error(`HTTP error! status: ${response.status}`);103 |       }104 | 105 |       const data = await response.json();106 | 107 |       if (data.success) {108 |         setLogs(data.logs || []);109 |         setPagination({110 |           page: data.pagination?.page || 1,111 |           limit: 50,112 |           totalPages: data.pagination?.totalPages || 1,113 |           total: data.pagination?.totalItems || 0,114 |           hasNext: data.pagination?.hasNext || false,115 |           hasPrev: data.pagination?.hasPrev || false116 |         });117 |       } else {118 |         throw new Error(data.error || 'Failed to fetch conversation logs');119 |       }120 |     } catch (error) {121 |       } finally {122 |       setLoading(false);123 |     }124 |   }, [user?.access_token, filters]);125 | 126 |   useEffect(() => {127 |     if (user?.access_token) {128 |       fetchConversationLogs();129 |     }130 |   }, [filters, user?.access_token, fetchConversationLogs]);131 | 132 |   if (isLoading) {133 |     return (134 |       <div className="flex items-center justify-center h-64">135 |         <div className="text-center">136 |           <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--color-primary-500)] mx-auto mb-4"></div>137 |           <p className="text-[var(--color-text-secondary)]">Loading...</p>138 |         </div>139 |       </div>140 |     );141 |   }142 | 143 |   if (!user || !user.access_token) {144 |     return (145 |       <div className="flex items-center justify-center h-64">146 |         <div className="text-center">147 |           <h2 className="text-xl font-semibold text-[var(--color-text-primary)] mb-2">148 |             Authentication Required149 |           </h2>150 |           <p className="text-[var(--color-text-secondary)] mb-4">151 |             Please sign in to access conversation logs.152 |           </p>153 |           <p className="text-sm text-[var(--color-text-tertiary)]">154 |             Use the admin access button in the main navigation to sign in.155 |           </p>156 |         </div>157 |       </div>158 |     );159 |   }160 | 161 |   if (!isAdmin) {162 |     return (163 |       <div className="flex items-center justify-center h-64">164 |         <div className="text-center">165 |           <h2 className="text-xl font-semibold text-[var(--color-text-primary)] mb-2">166 |             Admin Access Required167 |           </h2>168 |           <p className="text-[var(--color-text-secondary)]">169 |             You need admin privileges to access conversation logs.170 |           </p>171 |         </div>172 |       </div>173 |     );174 |   }175 | 176 |   const handleFilterChange = (key: string, value: string) => {177 |     setFilters(prev => ({178 |       ...prev,179 |       [key]: value,180 |       page: 1181 |     }));182 |   };183 | 184 |   const handlePageChange = (newPage: number) => {185 |     setFilters(prev => ({ ...prev, page: newPage }));186 |   };187 | 188 |   const handleSelectLog = (logId: string | number) => {189 |     setSelectedLogs(prev =>190 |       prev.includes(logId)191 |         ? prev.filter(id => id !== logId)192 |         : [...prev, logId]193 |     );194 |   };195 | 196 |   const handleSelectAll = () => {197 |     if (selectedLogs.length === logs.length) {198 |       setSelectedLogs([]);199 |     } else {200 |       setSelectedLogs(logs.map(log => log.id));201 |     }202 |   };203 | 204 |   const markForTraining = async () => {205 |     if (selectedLogs.length === 0) return;206 | 207 |     try {208 |       const response = await fetch('/api/admin/conversation-logs', {209 |         method: 'POST',210 |         headers: {211 |           'Content-Type': 'application/json',212 |           'Authorization': `Bearer ${user?.access_token}`,213 |         },214 |         body: JSON.stringify({215 |           action: 'mark_for_training',216 |           logIds: selectedLogs217 |         })218 |       });219 | 220 |       const data = await response.json();221 |       if (data.success) {222 |         alert(`Marked ${data.data.updatedCount} logs for training`);223 |         setSelectedLogs([]);224 |         fetchConversationLogs();225 |       }226 |     } catch (error) {227 |       }228 |   };229 | 230 |   const exportTrainingData = async () => {231 |     if (selectedLogs.length === 0) return;232 | 233 |     try {234 |       const response = await fetch('/api/admin/conversation-logs', {235 |         method: 'POST',236 |         headers: {237 |           'Content-Type': 'application/json',238 |           'Authorization': `Bearer ${user?.access_token}`,239 |         },240 |         body: JSON.stringify({241 |           action: 'export_training_data',242 |           logIds: selectedLogs243 |         })244 |       });245 | 246 |       const data = await response.json();247 |       if (data.success) {248 | 249 |         const blob = new Blob([data.data.content], { type: 'text/yaml' });250 |         const url = window.URL.createObjectURL(blob);251 |         const a = document.createElement('a');252 |         a.href = url;253 |         a.download = `training_data_${Date.now()}.yml`;254 |         document.body.appendChild(a);255 |         a.click();256 |         window.URL.revokeObjectURL(url);257 |         document.body.removeChild(a);258 |       }259 |     } catch (error) {260 |       }261 |   };262 | 263 |   const getConfidenceBadge = (confidence: number) => {264 |     if (confidence >= 0.8) {265 |       return <Badge variant="default" className={badgeStyles.success}>High</Badge>;266 |     } else if (confidence >= 0.6) {267 |       return <Badge variant="secondary" className={badgeStyles.warning}>Medium</Badge>;268 |     } else {269 |       return <Badge variant="destructive" className={badgeStyles.error}>Low</Badge>;270 |     }271 |   };272 | 273 |   const getFeedbackIcon = (feedback?: Record<string, unknown>) => {274 |     if (!feedback) return <XCircle className="h-4 w-4 text-[var(--color-text-tertiary)]" />;275 | 276 |     if (Number(feedback.rating) >= 4) {277 |       return <CheckCircle className="h-4 w-4 text-[var(--color-status-success)]" />;278 |     } else if (Number(feedback.rating) >= 2) {279 |       return <AlertTriangle className="h-4 w-4 text-[var(--color-status-warning)]" />;280 |     } else {281 |       return <XCircle className="h-4 w-4 text-[var(--color-status-error)]" />;282 |     }283 |   };284 | 285 |   return (286 |     <div className="dashboard-container p-6 space-y-6">287 |       <div className="flex items-center justify-between">288 |         <div>289 |           <h1 className="dashboard-text-primary text-3xl font-bold">Conversation Logs</h1>290 |           <p className="dashboard-text-secondary">Monitor and analyze conversation logs from the AI assistant</p>291 |         </div>292 |         <div className="flex gap-2">293 |           <Button294 |             onClick={fetchConversationLogs}295 |             disabled={loading}296 |             className="dashboard-button-outline"297 |             variant="outline"298 |           >299 |             <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />300 |             Refresh301 |           </Button>302 |         </div>303 |       </div>304 | 305 |       {}306 |       {stats && (307 |         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">308 |           <Card className="dashboard-card">309 |             <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">310 |               <CardTitle className="dashboard-card-title text-sm font-medium">Total Logs</CardTitle>311 |               <MessageSquare className="h-4 w-4 text-[var(--color-text-tertiary)]" />312 |             </CardHeader>313 |             <CardContent>314 |               <div className="text-2xl font-bold dashboard-text-primary">{stats.totalLogs.toLocaleString()}</div>315 |             </CardContent>316 |           </Card>317 | 318 |           <Card className="dashboard-card">319 |             <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">320 |               <CardTitle className="dashboard-card-title text-sm font-medium">Low Confidence</CardTitle>321 |               <AlertTriangle className="h-4 w-4 text-[var(--color-text-tertiary)]" />322 |             </CardHeader>323 |             <CardContent>324 |               <div className="text-2xl font-bold text-[var(--color-status-error)]">{stats.lowConfidenceLogs}</div>325 |               <p className="text-xs text-[var(--color-text-tertiary)]">326 |                 {((stats.lowConfidenceLogs / stats.totalLogs) * 100).toFixed(1)}% of total327 |               </p>328 |             </CardContent>329 |           </Card>330 | 331 |           <Card className="dashboard-card">332 |             <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">333 |               <CardTitle className="dashboard-card-title text-sm font-medium">Avg Confidence</CardTitle>334 |               <TrendingUp className="h-4 w-4 text-[var(--color-text-tertiary)]" />335 |             </CardHeader>336 |             <CardContent>337 |               <div className="text-2xl font-bold dashboard-text-primary">338 |                 {(stats.averageConfidence * 100).toFixed(1)}%339 |               </div>340 |             </CardContent>341 |           </Card>342 | 343 |           <Card className="dashboard-card">344 |             <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">345 |               <CardTitle className="dashboard-card-title text-sm font-medium">With Feedback</CardTitle>346 |               <Star className="h-4 w-4 text-[var(--color-text-tertiary)]" />347 |             </CardHeader>348 |             <CardContent>349 |               <div className="text-2xl font-bold dashboard-text-primary">{stats.logsWithFeedback}</div>350 |               <p className="text-xs text-[var(--color-text-tertiary)]">351 |                 {((stats.logsWithFeedback / stats.totalLogs) * 100).toFixed(1)}% of total352 |               </p>353 |             </CardContent>354 |           </Card>355 |         </div>356 |       )}357 | 358 |       <Tabs defaultValue="logs" className="w-full">359 |         <TabsList className="dashboard-tabs">360 |           <TabsTrigger value="logs" className="dashboard-tab">361 |             <MessageSquare className="w-4 h-4 mr-2" />362 |             Conversation Logs363 |           </TabsTrigger>364 |           <TabsTrigger value="analytics" className="dashboard-tab">365 |             <TrendingUp className="w-4 h-4 mr-2" />366 |             Analytics367 |           </TabsTrigger>368 |         </TabsList>369 | 370 |         <TabsContent value="logs" className="space-y-4">371 |           {}372 |           <Card className="dashboard-card">373 |             <CardHeader>374 |               <CardTitle className="dashboard-card-title flex items-center gap-2">375 |                 <Filter className="h-4 w-4" />376 |                 Filters377 |               </CardTitle>378 |             </CardHeader>379 |             <CardContent>380 |               <div className="flex gap-4 mb-6">381 |                 <div className="flex-1">382 |                   <Label htmlFor="userId" className="dashboard-label">User ID</Label>383 |                   <Input384 |                     id="userId"385 |                     placeholder="Filter by user ID"386 |                     value={filters.userId}387 |                     onChange={(e) => handleFilterChange('userId', e.target.value)}388 |                     className="dashboard-input"389 |                   />390 |                 </div>391 | 392 |                 <div className="flex-1">393 |                   <Label htmlFor="intent" className="dashboard-label">Intent</Label>394 |                   <Input395 |                     id="intent"396 |                     placeholder="Filter by intent"397 |                     value={filters.intent}398 |                     onChange={(e) => handleFilterChange('intent', e.target.value)}399 |                     className="dashboard-input"400 |                   />401 |                 </div>402 | 403 |                 <div className="flex-1">404 |                   <Label htmlFor="confidence" className="dashboard-label">Max Confidence</Label>405 |                   <Input406 |                     id="confidence"407 |                     type="number"408 |                     step="0.1"409 |                     min="0"410 |                     max="1"411 |                     placeholder="0.0 - 1.0"412 |                     value={filters.confidence}413 |                     className="dashboard-input"414 |                     onChange={(e) => handleFilterChange('confidence', e.target.value)}415 |                   />416 |                 </div>417 | 418 |                 <div className="flex-1">419 |                   <Label htmlFor="hasFeedback" className="dashboard-label">Feedback</Label>420 |                   <Select421 |                     value={filters.hasFeedback}422 |                     onValueChange={(value) => handleFilterChange('hasFeedback', value)}423 |                   >424 |                     <SelectTrigger className="dashboard-select">425 |                       <SelectValue placeholder="All" />426 |                     </SelectTrigger>427 |                     <SelectContent className="dashboard-dropdown-content">428 |                       <SelectItem value="all" className="dashboard-dropdown-item">All</SelectItem>429 |                       <SelectItem value="true" className="dashboard-dropdown-item">With Feedback</SelectItem>430 |                       <SelectItem value="false" className="dashboard-dropdown-item">No Feedback</SelectItem>431 |                     </SelectContent>432 |                   </Select>433 |                 </div>434 | 435 |                 <div className="flex-1">436 |                   <Label htmlFor="dateFrom" className="dashboard-label">Date From</Label>437 |                   <Input438 |                     id="dateFrom"439 |                     type="date"440 |                     value={filters.dateFrom}441 |                     onChange={(e) => handleFilterChange('dateFrom', e.target.value)}442 |                     className="dashboard-input"443 |                   />444 |                 </div>445 | 446 |                 <div className="flex-1">447 |                   <Label htmlFor="dateTo" className="dashboard-label">Date To</Label>448 |                   <Input449 |                     id="dateTo"450 |                     type="date"451 |                     value={filters.dateTo}452 |                     onChange={(e) => handleFilterChange('dateTo', e.target.value)}453 |                     className="dashboard-input"454 |                   />455 |                 </div>456 | 457 |                 <Button458 |                   onClick={fetchConversationLogs}459 |                   className="dashboard-button-outline"460 |                   variant="outline"461 |                 >462 |                   <Filter className="w-4 h-4 mr-2" />463 |                   Apply Filters464 |                 </Button>465 |               </div>466 |             </CardContent>467 |           </Card>468 | 469 |           {}470 |           {selectedLogs.length > 0 && (471 |             <Card className="dashboard-card">472 |               <CardContent className="pt-6">473 |                 <div className="flex items-center gap-4">474 |                   <span className="text-sm text-[var(--color-text-secondary)]">475 |                     {selectedLogs.length} logs selected476 |                   </span>477 |                   <Button478 |                     onClick={markForTraining}479 |                     size="sm"480 |                     className="dashboard-button-primary"481 |                   >482 |                     <Brain className="h-4 w-4 mr-2" />483 |                     Mark for Training484 |                   </Button>485 |                   <Button486 |                     onClick={exportTrainingData}487 |                     size="sm"488 |                     variant="outline"489 |                     className="dashboard-button-outline"490 |                   >491 |                     <Download className="h-4 w-4 mr-2" />492 |                     Export Training Data493 |                   </Button>494 |                 </div>495 |               </CardContent>496 |             </Card>497 |           )}498 | 499 |           {}500 |           <Card className="dashboard-card">501 |             <CardHeader>502 |               <CardTitle className="dashboard-card-title">Conversation Logs</CardTitle>503 |             </CardHeader>504 |             <CardContent>505 |               <div className="overflow-x-auto">506 |                 <Table className="dashboard-table">507 |                   <TableHeader className="dashboard-table-header">508 |                     <TableRow>509 |                     <TableHead className="w-12">510 |                       <input511 |                         type="checkbox"512 |                         checked={selectedLogs.length === logs.length && logs.length > 0}513 |                         onChange={handleSelectAll}514 |                       />515 |                     </TableHead>516 |                     <TableHead>Timestamp</TableHead>517 |                     <TableHead>User</TableHead>518 |                     <TableHead>Message</TableHead>519 |                     <TableHead>Intent</TableHead>520 |                     <TableHead>Confidence</TableHead>521 |                     <TableHead>Feedback</TableHead>522 |                     <TableHead>Actions</TableHead>523 |                   </TableRow>524 |                 </TableHeader>525 |                 <TableBody>526 |                   {logs.map((log) => (527 |                     <TableRow key={log.id}>528 |                       <TableCell>529 |                         <input530 |                           type="checkbox"531 |                           checked={selectedLogs.includes(log.id)}532 |                           onChange={() => handleSelectLog(log.id)}533 |                         />534 |                       </TableCell>535 |                       <TableCell>536 |                         {new Date(log.timestamp).toLocaleString()}537 |                       </TableCell>538 |                       <TableCell className="font-mono text-xs">539 |                         {log.userId || 'Anonymous'}540 |                       </TableCell>541 |                       <TableCell className="max-w-xs truncate">542 |                         {log.userMessage}543 |                       </TableCell>544 |                       <TableCell>545 |                         <Badge variant="outline">{log.rasaIntent}</Badge>546 |                       </TableCell>547 |                       <TableCell>548 |                         <div className="flex items-center gap-2">549 |                           {getConfidenceBadge(log.rasaConfidence || 0)}550 |                           <span className="text-xs">551 |                             {((log.rasaConfidence || 0) * 100).toFixed(1)}%552 |                           </span>553 |                         </div>554 |                       </TableCell>555 |                       <TableCell>556 |                         {getFeedbackIcon(log.feedback?.[0] as unknown as Record<string, unknown>)}557 |                       </TableCell>558 |                       <TableCell>559 |                         <Dialog>560 |                           <DialogTrigger asChild>561 |                             <Button562 |                               variant="ghost"563 |                               size="sm"564 |                               onClick={() => setSelectedLog(log)}565 |                             >566 |                               <Eye className="h-4 w-4" />567 |                             </Button>568 |                           </DialogTrigger>569 |                           <DialogContent className="max-w-4xl">570 |                             <DialogHeader>571 |                               <DialogTitle>Conversation Log Details</DialogTitle>572 |                             </DialogHeader>573 |                             {selectedLog && (574 |                               <div className="space-y-4">575 |                                 <div className="grid grid-cols-2 gap-4">576 |                                   <div>577 |                                     <Label>User ID</Label>578 |                                     <p className="font-mono text-sm">{selectedLog.userId || 'Anonymous'}</p>579 |                                   </div>580 |                                   <div>581 |                                     <Label>Timestamp</Label>582 |                                     <p className="text-sm">583 |                                       {new Date(selectedLog.timestamp).toLocaleString()}584 |                                     </p>585 |                                   </div>586 |                                   <div>587 |                                     <Label>Intent</Label>588 |                                     <Badge variant="outline">{selectedLog.rasaIntent}</Badge>589 |                                   </div>590 |                                   <div>591 |                                     <Label>Confidence</Label>592 |                                     <div className="flex items-center gap-2">593 |                                       {getConfidenceBadge(selectedLog.rasaConfidence || 0)}594 |                                       <span>{((selectedLog.rasaConfidence || 0) * 100).toFixed(1)}%</span>595 |                                     </div>596 |                                   </div>597 |                                 </div>598 | 599 |                                 <div>600 |                                   <Label>User Message</Label>601 |                                   <Textarea602 |                                     value={selectedLog.userMessage}603 |                                     readOnly604 |                                     className="min-h-[100px]"605 |                                   />606 |                                 </div>607 | 608 |                                 <div>609 |                                   <Label>Bot Response</Label>610 |                                   <Textarea611 |                                     value={selectedLog.botResponse || ''}612 |                                     readOnly613 |                                     className="min-h-[100px]"614 |                                   />615 |                                 </div>616 | 617 |                                 {selectedLog.rasaEntities && selectedLog.rasaEntities.length > 0 && (618 |                                   <div>619 |                                     <Label>Entities</Label>620 |                                     <div className="flex flex-wrap gap-2">621 |                                       {selectedLog.rasaEntities.map((entity, index) => (622 |                                         <Badge key={index} variant="secondary">623 |                                           {String(entity.entity)}: {String(entity.value)}624 |                                         </Badge>625 |                                       ))}626 |                                     </div>627 |                                   </div>628 |                                 )}629 | 630 |                                 {selectedLog.feedback && selectedLog.feedback.length > 0 && (631 |                                   <div>632 |                                     <Label>User Feedback</Label>633 |                                     <div className="space-y-2">634 |                                       <div className="flex items-center gap-2">635 |                                         <span>Rating:</span>636 |                                         <div className="flex">637 |                                           {[...Array(5)].map((_, i) => (638 |                                             <Star639 |                                               key={i}640 |                                               className={`h-4 w-4 ${641 |                                                 i < selectedLog.feedback![0].rating642 |                                                   ? 'text-[var(--color-status-warning)] fill-current'643 |                                                   : 'text-[var(--color-text-tertiary)]'644 |                                               }`}645 |                                             />646 |                                           ))}647 |                                         </div>648 |                                       </div>649 |                                       <Textarea650 |                                         value={selectedLog.feedback[0].comment || ''}651 |                                         readOnly652 |                                         className="min-h-[80px]"653 |                                       />654 |                                     </div>655 |                                   </div>656 |                                 )}657 |                               </div>658 |                             )}659 |                           </DialogContent>660 |                         </Dialog>661 |                       </TableCell>662 |                     </TableRow>663 |                   ))}664 |                 </TableBody>665 |               </Table>666 |               </div>667 | 668 |               {}669 |               <div className="flex items-center justify-between mt-4">670 |                 <div className="text-sm text-[var(--color-text-secondary)]">671 |                   Showing {((pagination.page - 1) * pagination.limit) + 1} to{' '}672 |                   {Math.min(pagination.page * pagination.limit, pagination.total)} of{' '}673 |                   {pagination.total} results674 |                 </div>675 |                 <div className="flex gap-2">676 |                   <Button677 |                     variant="outline"678 |                     size="sm"679 |                     onClick={() => handlePageChange(pagination.page - 1)}680 |                     disabled={!pagination.hasPrev}681 |                     className="dashboard-button-outline"682 |                   >683 |                     Previous684 |                   </Button>685 |                   <Button686 |                     variant="outline"687 |                     size="sm"688 |                     onClick={() => handlePageChange(pagination.page + 1)}689 |                     disabled={!pagination.hasNext}690 |                     className="dashboard-button-outline"691 |                   >692 |                     Next693 |                   </Button>694 |                 </div>695 |               </div>696 |             </CardContent>697 |           </Card>698 |         </TabsContent>699 | 700 |         <TabsContent value="analytics" className="space-y-4">701 |           {stats && (702 |             <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">703 |               <Card className="dashboard-card">704 |                 <CardHeader>705 |                   <CardTitle className="dashboard-card-title">Top Intents</CardTitle>706 |                 </CardHeader>707 |                 <CardContent>708 |                   <div className="space-y-2">709 |                     {stats.topIntents.map((intent) => (710 |                       <div key={intent.intent} className="flex items-center justify-between">711 |                         <span className="text-sm text-[var(--color-text-primary)]">{intent.intent}</span>712 |                         <Badge variant="outline">{intent.count}</Badge>713 |                       </div>714 |                     ))}715 |                   </div>716 |                 </CardContent>717 |               </Card>718 | 719 |               <Card className="dashboard-card">720 |                 <CardHeader>721 |                   <CardTitle className="dashboard-card-title">Confidence Distribution</CardTitle>722 |                 </CardHeader>723 |                 <CardContent>724 |                   <div className="space-y-4">725 |                     <div className="flex items-center justify-between">726 |                       <span className="text-sm text-[var(--color-text-primary)]">High Confidence (≥80%)</span>727 |                       <div className="flex items-center gap-2">728 |                         <div className="w-32 bg-[var(--color-surface-tertiary)] rounded-full h-2">729 |                           <div730 |                             className="bg-[var(--color-status-success)] h-2 rounded-full"731 |                             style={{732 |                               width: `${(stats.highConfidenceLogs / stats.totalLogs) * 100}%`733 |                             }}734 |                           />735 |                         </div>736 |                         <span className="text-sm text-[var(--color-text-primary)]">{stats.highConfidenceLogs}</span>737 |                       </div>738 |                     </div>739 | 740 |                     <div className="flex items-center justify-between">741 |                       <span className="text-sm text-[var(--color-text-primary)]">Low Confidence (≤60%)</span>742 |                       <div className="flex items-center gap-2">743 |                         <div className="w-32 bg-[var(--color-surface-tertiary)] rounded-full h-2">744 |                           <div745 |                             className="bg-[var(--color-status-error)] h-2 rounded-full"746 |                             style={{747 |                               width: `${(stats.lowConfidenceLogs / stats.totalLogs) * 100}%`748 |                             }}749 |                           />750 |                         </div>751 |                         <span className="text-sm text-[var(--color-text-primary)]">{stats.lowConfidenceLogs}</span>752 |                       </div>753 |                     </div>754 |                   </div>755 |                 </CardContent>756 |               </Card>757 |             </div>758 |           )}759 |         </TabsContent>760 |       </Tabs>761 |     </div>762 |   );763 | }
============================================================END: frontend/components/admin/ConversationLogsManagement.tsx============================================================


============================================================FILE: frontend/components/cms/CMSButton.tsxSIZE: 2.24 KB============================================================
  1 | import React from 'react';  2 | import { motion } from 'framer-motion';  3 |   4 | interface CMSButtonProps {  5 |   children: React.ReactNode;  6 |   onClick?: () => void;  7 |   variant?: 'primary' | 'secondary' | 'outline' | 'danger' | 'success';  8 |   size?: 'sm' | 'md' | 'lg';  9 |   disabled?: boolean; 10 |   loading?: boolean; 11 |   className?: string; 12 |   type?: 'button' | 'submit' | 'reset'; 13 | } 14 |  15 | export const CMSButton: React.FC<CMSButtonProps> = ({ 16 |   children, 17 |   onClick, 18 |   variant = 'primary', 19 |   size = 'md', 20 |   disabled = false, 21 |   loading = false, 22 |   className = '', 23 |   type = 'button' 24 | }) => { 25 |   const baseClasses = 'inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed'; 26 |  27 |   const variantClasses = { 28 |     primary: 'bg-[var(--color-primary-500)] text-[var(--color-background-primary)] hover:bg-[var(--color-primary-600)] focus:ring-[var(--color-primary-500)]/50 shadow-lg', 29 |     secondary: 'bg-[var(--color-surface-secondary)] text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)] focus:ring-[var(--color-surface-secondary)]/50 border border-[var(--color-border-300)]', 30 |     outline: 'bg-transparent text-[var(--color-text-primary)] hover:bg-[var(--color-surface-secondary)] focus:ring-[var(--color-surface-secondary)]/50 border border-[var(--color-border-300)]', 31 |     danger: 'bg-[#DC2626] text-white hover:bg-[#DC2626]/90 focus:ring-[#DC2626]/50', 32 |     success: 'bg-[var(--color-primary-500)] text-white hover:bg-[var(--color-primary-600)] focus:ring-[var(--color-primary-500)]/50' 33 |   }; 34 |  35 |   const sizeClasses = { 36 |     sm: 'px-3 py-1.5 text-sm', 37 |     md: 'px-4 py-2 text-base', 38 |     lg: 'px-6 py-3 text-lg' 39 |   }; 40 |  41 |   const classes = `${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${className}`; 42 |  43 |   return ( 44 |     <motion.button 45 |       type={type} 46 |       onClick={onClick} 47 |       disabled={disabled || loading} 48 |       className={classes} 49 |       whileHover={{ scale: disabled ? 1 : 1.02 }} 50 |       whileTap={{ scale: disabled ? 1 : 0.98 }} 51 |       transition={{ duration: 0.1 }} 52 |     > 53 |       {loading && ( 54 |         <div className="w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2" /> 55 |       )} 56 |       {children} 57 |     </motion.button> 58 |   ); 59 | };
============================================================END: frontend/components/cms/CMSButton.tsx============================================================


============================================================FILE: frontend/components/cms/CMSCard.tsxSIZE: 2.58 KB============================================================
  1 | import React from 'react';  2 | import { motion } from 'framer-motion';  3 |   4 | interface CMSCardProps {  5 |   children: React.ReactNode;  6 |   title?: string;  7 |   subtitle?: string;  8 |   className?: string;  9 |   headerActions?: React.ReactNode; 10 |   collapsible?: boolean; 11 |   defaultCollapsed?: boolean; 12 | } 13 |  14 | export const CMSCard: React.FC<CMSCardProps> = ({ 15 |   children, 16 |   title, 17 |   subtitle, 18 |   className = '', 19 |   headerActions, 20 |   collapsible = false, 21 |   defaultCollapsed = false 22 | }) => { 23 |   const [isCollapsed, setIsCollapsed] = React.useState(defaultCollapsed); 24 |  25 |   const cardClasses = `bg-[#1A1A2E] border border-[#2A2A3E] rounded-xl shadow-lg ${className}`; 26 |  27 |   return ( 28 |     <motion.div 29 |       initial={{ opacity: 0, y: 20 }} 30 |       animate={{ opacity: 1, y: 0 }} 31 |       className={cardClasses} 32 |     > 33 |       {(title || headerActions) && ( 34 |         <div className="px-6 py-4 border-b border-[#2A2A3E]"> 35 |           <div className="flex items-center justify-between"> 36 |             <div className="flex-1"> 37 |               {title && ( 38 |                 <h3 className="text-lg font-semibold text-[#EAEAEA]"> 39 |                   {title} 40 |                 </h3> 41 |               )} 42 |               {subtitle && ( 43 |                 <p className="text-sm text-[#9CA3AF] mt-1"> 44 |                   {subtitle} 45 |                 </p> 46 |               )} 47 |             </div> 48 |  49 |             <div className="flex items-center space-x-2"> 50 |               {headerActions} 51 |               {collapsible && ( 52 |                 <motion.button 53 |                   onClick={() => setIsCollapsed(!isCollapsed)} 54 |                   className="p-2 hover:bg-[#2A2A3E] rounded-lg transition-colors" 55 |                   whileHover={{ scale: 1.05 }} 56 |                   whileTap={{ scale: 0.95 }} 57 |                 > 58 |                   <motion.div 59 |                     animate={{ rotate: isCollapsed ? 0 : 180 }} 60 |                     transition={{ duration: 0.2 }} 61 |                     className="w-4 h-4" 62 |                   > 63 |                     <svg viewBox="0 0 24 24" fill="none" className="w-full h-full text-[#9CA3AF]"> 64 |                       <path d="M6 9L12 15L18 9" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/> 65 |                     </svg> 66 |                   </motion.div> 67 |                 </motion.button> 68 |               )} 69 |             </div> 70 |           </div> 71 |         </div> 72 |       )} 73 |  74 |       <motion.div 75 |         initial={false} 76 |         animate={{ height: isCollapsed ? 0 : 'auto' }} 77 |         transition={{ duration: 0.3, ease: 'easeInOut' }} 78 |         className="overflow-hidden" 79 |       > 80 |         <div className="p-6"> 81 |           {children} 82 |         </div> 83 |       </motion.div> 84 |     </motion.div> 85 |   ); 86 | };
============================================================END: frontend/components/cms/CMSCard.tsx============================================================


============================================================FILE: frontend/components/cms/CMSInput.tsxSIZE: 2.12 KB============================================================
  1 | import React from 'react';  2 | import { motion } from 'framer-motion';  3 |   4 | interface CMSInputProps {  5 |   label?: string;  6 |   placeholder?: string;  7 |   value: string;  8 |   onChange: (value: string) => void;  9 |   type?: 'text' | 'email' | 'password' | 'number' | 'url'; 10 |   required?: boolean; 11 |   disabled?: boolean; 12 |   error?: string; 13 |   className?: string; 14 |   rows?: number; 15 |   multiline?: boolean; 16 | } 17 |  18 | export const CMSInput: React.FC<CMSInputProps> = ({ 19 |   label, 20 |   placeholder, 21 |   value, 22 |   onChange, 23 |   type = 'text', 24 |   required = false, 25 |   disabled = false, 26 |   error, 27 |   className = '', 28 |   rows = 3, 29 |   multiline = false 30 | }) => { 31 |   const baseClasses = 'w-full px-4 py-3 bg-[#1A1A2E] border border-[#2A2A3E] rounded-lg text-[#EAEAEA] placeholder-[#6B7280] focus:outline-none focus:ring-2 focus:ring-[#FFD700]/50 focus:border-[#FFD700] transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed'; 32 |  33 |   const errorClasses = error ? 'border-[#DC2626] focus:ring-[#DC2626]/50 focus:border-[#DC2626]' : ''; 34 |  35 |   const classes = `${baseClasses} ${errorClasses} ${className}`; 36 |  37 |   return ( 38 |     <motion.div 39 |       initial={{ opacity: 0, y: 10 }} 40 |       animate={{ opacity: 1, y: 0 }} 41 |       className="space-y-2" 42 |     > 43 |       {label && ( 44 |         <label className="block text-sm font-medium text-[#EAEAEA]"> 45 |           {label} 46 |           {required && <span className="text-[#DC2626] ml-1">*</span>} 47 |         </label> 48 |       )} 49 |  50 |       {multiline ? ( 51 |         <textarea 52 |           value={value} 53 |           onChange={(e) => onChange(e.target.value)} 54 |           placeholder={placeholder} 55 |           disabled={disabled} 56 |           rows={rows} 57 |           className={classes} 58 |         /> 59 |       ) : ( 60 |         <input 61 |           type={type} 62 |           value={value} 63 |           onChange={(e) => onChange(e.target.value)} 64 |           placeholder={placeholder} 65 |           disabled={disabled} 66 |           required={required} 67 |           className={classes} 68 |         /> 69 |       )} 70 |  71 |       {error && ( 72 |         <motion.p 73 |           initial={{ opacity: 0, y: -5 }} 74 |           animate={{ opacity: 1, y: 0 }} 75 |           className="text-sm text-[#DC2626]" 76 |         > 77 |           {error} 78 |         </motion.p> 79 |       )} 80 |     </motion.div> 81 |   ); 82 | };
============================================================END: frontend/components/cms/CMSInput.tsx============================================================


============================================================FILE: frontend/components/cms/CMSTabs.tsxSIZE: 2.06 KB============================================================
  1 | import React from 'react';  2 | import { motion } from 'framer-motion';  3 |   4 | interface CMSTab {  5 |   id: string;  6 |   label: string;  7 |   icon?: React.ReactNode;  8 |   content: React.ReactNode;  9 | } 10 |  11 | interface CMSTabsProps { 12 |   tabs: CMSTab[]; 13 |   activeTab: string; 14 |   onTabChange: (tabId: string) => void; 15 |   className?: string; 16 | } 17 |  18 | export const CMSTabs: React.FC<CMSTabsProps> = ({ 19 |   tabs, 20 |   activeTab, 21 |   onTabChange, 22 |   className = '' 23 | }) => { 24 |  25 |   return ( 26 |     <div className={`space-y-6 ${className}`}> 27 |       {} 28 |       <div className="border-b border-[#2A2A3E]"> 29 |         <nav className="flex space-x-8"> 30 |           {tabs.map((tab) => ( 31 |             <motion.button 32 |               key={tab.id} 33 |               onClick={() => onTabChange(tab.id)} 34 |               className={`relative py-4 px-1 text-sm font-medium transition-colors duration-200 ${ 35 |                 activeTab === tab.id 36 |                   ? 'text-[#FFD700]' 37 |                   : 'text-[#9CA3AF] hover:text-[#EAEAEA]' 38 |               }`} 39 |               whileHover={{ scale: 1.02 }} 40 |               whileTap={{ scale: 0.98 }} 41 |             > 42 |               <div className="flex items-center space-x-2"> 43 |                 {tab.icon && <span className="w-4 h-4">{tab.icon}</span>} 44 |                 <span>{tab.label}</span> 45 |               </div> 46 |  47 |               {} 48 |               {activeTab === tab.id && ( 49 |                 <motion.div 50 |                   layoutId="activeTab" 51 |                   className="absolute bottom-0 left-0 right-0 h-0.5 bg-[#FFD700]" 52 |                   initial={false} 53 |                   transition={{ type: "spring", stiffness: 500, damping: 30 }} 54 |                 /> 55 |               )} 56 |             </motion.button> 57 |           ))} 58 |         </nav> 59 |       </div> 60 |  61 |       {} 62 |       <motion.div 63 |         key={activeTab} 64 |         initial={{ opacity: 0, x: 20 }} 65 |         animate={{ opacity: 1, x: 0 }} 66 |         exit={{ opacity: 0, x: -20 }} 67 |         transition={{ duration: 0.2 }} 68 |         className="min-h-[400px]" 69 |       > 70 |         {tabs.find(tab => tab.id === activeTab)?.content} 71 |       </motion.div> 72 |     </div> 73 |   ); 74 | };
============================================================END: frontend/components/cms/CMSTabs.tsx============================================================


============================================================FILE: frontend/components/cms/ContentEditor.tsxSIZE: 17.06 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { Save, RefreshCw, Eye, EyeOff, FileText, Star, User, Compass, Clock } from 'lucide-react';  5 | import { CMSInput } from './CMSInput';  6 | import { CMSButton } from './CMSButton';  7 | import { useToast } from './Toast';  8 |   9 | interface ContentStructure { 10 |   [key: string]: string | Record<string, string>; 11 | } 12 |  13 | interface ContentEditorProps { 14 |   content: ContentStructure; 15 |   onContentChange: (content: ContentStructure) => void; 16 |   onSave: () => Promise<void>; 17 |   onRefresh: () => Promise<void>; 18 |   isLoading: boolean; 19 |   isSaving: boolean; 20 | } 21 |  22 | export function ContentEditor({ 23 |   content, 24 |   onContentChange, 25 |   onSave, 26 |   onRefresh, 27 |   isLoading, 28 |   isSaving 29 | }: ContentEditorProps) { 30 |   const { showSuccess, showError } = useToast(); 31 |   const [previewMode, setPreviewMode] = useState(false); 32 |   const [localContent, setLocalContent] = useState(content); 33 |   const [hasChanges, setHasChanges] = useState(false); 34 |  35 |   useEffect(() => { 36 |     setLocalContent(content); 37 |     setHasChanges(false); 38 |   }, [content]); 39 |  40 |   const handleFieldChange = (field: string, value: string, language?: string) => { 41 |     const newContent = { ...localContent }; 42 |  43 |     if (language) { 44 |  45 |       if (!newContent[`${field}${language.charAt(0).toUpperCase() + language.slice(1)}`]) { 46 |         newContent[`${field}${language.charAt(0).toUpperCase() + language.slice(1)}`] = ''; 47 |       } 48 |       newContent[`${field}${language.charAt(0).toUpperCase() + language.slice(1)}`] = value; 49 |     } else { 50 |  51 |       newContent[field] = value; 52 |     } 53 |  54 |     setLocalContent(newContent); 55 |     setHasChanges(true); 56 |     onContentChange(newContent); 57 |   }; 58 |  59 |   const handleSave = async () => { 60 |     try { 61 |       await onSave(); 62 |       setHasChanges(false); 63 |       showSuccess('Content Saved!', 'Your changes have been saved and the page will be revalidated.', 4000); 64 |     } catch { 65 |       showError('Save Failed', 'Failed to save content. Please try again.', 6000); 66 |     } 67 |   }; 68 |  69 |   const handleRefresh = async () => { 70 |     try { 71 |       await onRefresh(); 72 |       setHasChanges(false); 73 |       showSuccess('Content Refreshed!', 'Content has been refreshed from the server.', 3000); 74 |     } catch { 75 |       showError('Refresh Failed', 'Failed to refresh content. Please try again.', 6000); 76 |     } 77 |   }; 78 |  79 |   const resetChanges = () => { 80 |     setLocalContent(content); 81 |     setHasChanges(false); 82 |   }; 83 |  84 |   if (isLoading) { 85 |     return ( 86 |       <div className="flex items-center justify-center h-64"> 87 |         <div className="text-center"> 88 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> 89 |           <p className="text-[#9CA3AF]">Loading content...</p> 90 |         </div> 91 |       </div> 92 |     ); 93 |   } 94 |  95 |   return ( 96 |     <div className="space-y-6"> 97 |       {} 98 |       <div className="flex items-center justify-between bg-[#1A1A2E] p-4 rounded-lg border border-[#2D2D44]"> 99 |         <div className="flex items-center space-x-4">100 |           <h2 className="text-xl font-semibold text-[#EAEAEA] flex items-center">101 |             <FileText size={20} className="mr-2 text-[#FFD700]" />102 |             Front Page Content Editor103 |           </h2>104 |           <div className="flex items-center space-x-2">105 |             <button106 |               onClick={() => setPreviewMode(!previewMode)}107 |               className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${108 |                 previewMode109 |                   ? 'bg-[#FFD700] text-[#0A0A23]'110 |                   : 'bg-[#2D2D44] text-[#EAEAEA] hover:bg-[#3D3D54]'111 |               }`}112 |             >113 |               {previewMode ? <EyeOff size={16} className="mr-1" /> : <Eye size={16} className="mr-1" />}114 |               {previewMode ? 'Hide Preview' : 'Show Preview'}115 |             </button>116 |           </div>117 |         </div>118 | 119 |         <div className="flex items-center space-x-3">120 |           {hasChanges && (121 |             <span className="text-[#FFD700] text-sm font-medium">Unsaved changes</span>122 |           )}123 |           <CMSButton124 |             onClick={resetChanges}125 |             disabled={!hasChanges}126 |             variant="secondary"127 |             size="sm"128 |           >129 |             Reset130 |           </CMSButton>131 |           <CMSButton132 |             onClick={handleRefresh}133 |             disabled={isLoading}134 |             variant="secondary"135 |             size="sm"136 |           >137 |             <RefreshCw size={16} className="mr-2" />138 |             Refresh139 |           </CMSButton>140 |           <CMSButton141 |             onClick={handleSave}142 |             disabled={isSaving || !hasChanges}143 |             variant="primary"144 |             size="sm"145 |           >146 |             <Save size={16} className="mr-2" />147 |             {isSaving ? 'Saving...' : 'Save & Revalidate'}148 |           </CMSButton>149 |         </div>150 |       </div>151 | 152 |       {}153 |       <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">154 |         {}155 |         <div className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">156 |           <h3 className="text-lg font-semibold text-[#FFD700] mb-4 flex items-center">157 |             <Star size={18} className="mr-2" />158 |             Hero Section159 |           </h3>160 | 161 |           <div className="space-y-4">162 |             <div>163 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Title</label>164 |               <CMSInput165 |                 value={typeof localContent.heroTitleEn === 'string' ? localContent.heroTitleEn : ''}166 |                 onChange={(value) => handleFieldChange('heroTitle', value, 'en')}167 |                 placeholder="MatMax Yoga Studio"168 |               />169 |             </div>170 | 171 |             <div>172 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Title</label>173 |               <CMSInput174 |                 value={typeof localContent.heroTitleEs === 'string' ? localContent.heroTitleEs : ''}175 |                 onChange={(value) => handleFieldChange('heroTitle', value, 'es')}176 |                 placeholder="MatMax Yoga Studio"177 |               />178 |             </div>179 | 180 |             <div>181 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Subtitle</label>182 |               <CMSInput183 |                 value={typeof localContent.heroSubtitleEn === 'string' ? localContent.heroSubtitleEn : ''}184 |                 onChange={(value) => handleFieldChange('heroSubtitle', value, 'en')}185 |                 placeholder="Your journey to wellness starts here"186 |               />187 |             </div>188 | 189 |             <div>190 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Subtitle</label>191 |               <CMSInput192 |                 value={typeof localContent.heroSubtitleEs === 'string' ? localContent.heroSubtitleEs : ''}193 |                 onChange={(value) => handleFieldChange('heroSubtitle', value, 'es')}194 |                 placeholder="Tu camino al bienestar comienza aquí"195 |               />196 |             </div>197 |           </div>198 |         </div>199 | 200 |         {}201 |         <div className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">202 |           <h3 className="text-lg font-semibold text-[#FFD700] mb-4 flex items-center">203 |             <User size={18} className="mr-2" />204 |             About Section205 |           </h3>206 | 207 |           <div className="space-y-4">208 |             <div>209 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Title</label>210 |               <CMSInput211 |                 value={typeof localContent.aboutTitleEn === 'string' ? localContent.aboutTitleEn : ''}212 |                 onChange={(value) => handleFieldChange('aboutTitle', value, 'en')}213 |                 placeholder="About Us"214 |               />215 |             </div>216 | 217 |             <div>218 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Title</label>219 |               <CMSInput220 |                 value={typeof localContent.aboutTitleEs === 'string' ? localContent.aboutTitleEs : ''}221 |                 onChange={(value) => handleFieldChange('aboutTitle', value, 'es')}222 |                 placeholder="Sobre Nosotros"223 |               />224 |             </div>225 | 226 |             <div>227 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Content</label>228 |               <textarea229 |                 value={typeof localContent.aboutContentEn === 'string' ? localContent.aboutContentEn : ''}230 |                 onChange={(e) => handleFieldChange('aboutContent', e.target.value, 'en')}231 |                 placeholder="We are dedicated to helping you achieve your wellness goals."232 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"233 |                 rows={4}234 |               />235 |             </div>236 | 237 |             <div>238 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Content</label>239 |               <textarea240 |                 value={typeof localContent.aboutContentEs === 'string' ? localContent.aboutContentEs : ''}241 |                 onChange={(e) => handleFieldChange('aboutContent', e.target.value, 'es')}242 |                 placeholder="Estamos dedicados a ayudarte a alcanzar tus metas de bienestar."243 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"244 |                 rows={4}245 |               />246 |             </div>247 |           </div>248 |         </div>249 | 250 |         {}251 |         <div className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">252 |           <h3 className="text-lg font-semibold text-[#FFD700] mb-4 flex items-center">253 |             <Compass size={18} className="mr-2" />254 |             Approach Section255 |           </h3>256 | 257 |           <div className="space-y-4">258 |             <div>259 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Title</label>260 |               <CMSInput261 |                 value={typeof localContent.approachTitleEn === 'string' ? localContent.approachTitleEn : ''}262 |                 onChange={(value) => handleFieldChange('approachTitle', value, 'en')}263 |                 placeholder="Our Approach"264 |               />265 |             </div>266 | 267 |             <div>268 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Title</label>269 |               <CMSInput270 |                 value={typeof localContent.approachTitleEs === 'string' ? localContent.approachTitleEs : ''}271 |                 onChange={(value) => handleFieldChange('approachTitle', value, 'es')}272 |                 placeholder="Nuestro Enfoque"273 |               />274 |             </div>275 | 276 |             <div>277 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Content</label>278 |               <textarea279 |                 value={typeof localContent.approachContentEn === 'string' ? localContent.approachContentEn : ''}280 |                 onChange={(e) => handleFieldChange('approachContent', e.target.value, 'en')}281 |                 placeholder="We use a holistic approach to wellness."282 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"283 |                 rows={4}284 |               />285 |             </div>286 | 287 |             <div>288 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Content</label>289 |               <textarea290 |                 value={typeof localContent.approachContentEs === 'string' ? localContent.approachContentEs : ''}291 |                 onChange={(e) => handleFieldChange('approachContent', e.target.value, 'es')}292 |                 placeholder="Usamos un enfoque holístico para el bienestar."293 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"294 |                 rows={4}295 |               />296 |             </div>297 |           </div>298 |         </div>299 | 300 |         {}301 |         <div className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">302 |           <h3 className="text-lg font-semibold text-[#FFD700] mb-4 flex items-center">303 |             <Clock size={18} className="mr-2" />304 |             Services Section305 |           </h3>306 | 307 |           <div className="space-y-4">308 |             <div>309 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Title</label>310 |               <CMSInput311 |                 value={typeof localContent.servicesTitleEn === 'string' ? localContent.servicesTitleEn : ''}312 |                 onChange={(value) => handleFieldChange('servicesTitle', value, 'en')}313 |                 placeholder="Our Services"314 |               />315 |             </div>316 | 317 |             <div>318 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Title</label>319 |               <CMSInput320 |                 value={typeof localContent.servicesTitleEs === 'string' ? localContent.servicesTitleEs : ''}321 |                 onChange={(value) => handleFieldChange('servicesTitle', value, 'es')}322 |                 placeholder="Nuestros Servicios"323 |               />324 |             </div>325 | 326 |             <div>327 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">English Content</label>328 |               <textarea329 |                 value={typeof localContent.servicesContentEn === 'string' ? localContent.servicesContentEn : ''}330 |                 onChange={(e) => handleFieldChange('servicesContent', e.target.value, 'en')}331 |                 placeholder="Professional wellness services in a peaceful environment."332 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"333 |                 rows={4}334 |               />335 |             </div>336 | 337 |             <div>338 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Spanish Content</label>339 |               <textarea340 |                 value={typeof localContent.servicesContentEs === 'string' ? localContent.servicesContentEs : ''}341 |                 onChange={(e) => handleFieldChange('servicesContent', e.target.value, 'es')}342 |                 placeholder="Servicios profesionales de bienestar en un ambiente pacífico."343 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"344 |                 rows={4}345 |               />346 |             </div>347 |           </div>348 |         </div>349 |       </div>350 | 351 |       {}352 |       {previewMode && (353 |         <div className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">354 |           <h3 className="text-lg font-semibold text-[#FFD700] mb-4">Content Preview</h3>355 |           <div className="grid grid-cols-1 md:grid-cols-2 gap-6">356 |             <div>357 |               <h4 className="text-md font-medium text-[#EAEAEA] mb-3">English Version</h4>358 |               <div className="space-y-2 text-sm">359 |                 <p><strong>Hero:</strong> {typeof localContent.heroTitleEn === 'string' ? localContent.heroTitleEn || 'MatMax Yoga Studio' : 'MatMax Yoga Studio'}</p>360 |                 <p><strong>Subtitle:</strong> {typeof localContent.heroSubtitleEn === 'string' ? localContent.heroSubtitleEn || 'Your journey to wellness starts here' : 'Your journey to wellness starts here'}</p>361 |                 <p><strong>About:</strong> {typeof localContent.aboutTitleEn === 'string' ? localContent.aboutTitleEn || 'About Us' : 'About Us'}</p>362 |                 <p><strong>Approach:</strong> {typeof localContent.approachTitleEn === 'string' ? localContent.approachTitleEn || 'Our Approach' : 'Our Approach'}</p>363 |                 <p><strong>Services:</strong> {typeof localContent.servicesTitleEn === 'string' ? localContent.servicesTitleEn || 'Our Services' : 'Our Services'}</p>364 |               </div>365 |             </div>366 |             <div>367 |               <h4 className="text-md font-medium text-[#EAEAEA] mb-3">Spanish Version</h4>368 |               <div className="space-y-2 text-sm">369 |                 <p><strong>Hero:</strong> {typeof localContent.heroTitleEs === 'string' ? localContent.heroTitleEs || 'MatMax Yoga Studio' : 'MatMax Yoga Studio'}</p>370 |                 <p><strong>Subtitle:</strong> {typeof localContent.heroSubtitleEs === 'string' ? localContent.heroSubtitleEs || 'Tu camino al bienestar comienza aquí' : 'Tu camino al bienestar comienza aquí'}</p>371 |                 <p><strong>About:</strong> {typeof localContent.aboutTitleEs === 'string' ? localContent.aboutTitleEs || 'Sobre Nosotros' : 'Sobre Nosotros'}</p>372 |                 <p><strong>Approach:</strong> {typeof localContent.approachTitleEs === 'string' ? localContent.approachTitleEs || 'Nuestro Enfoque' : 'Nuestro Enfoque'}</p>373 |                 <p><strong>Services:</strong> {typeof localContent.servicesTitleEs === 'string' ? localContent.servicesTitleEs || 'Nuestros Servicios' : 'Nuestros Servicios'}</p>374 |               </div>375 |             </div>376 |           </div>377 |         </div>378 |       )}379 |     </div>380 |   );381 | }
============================================================END: frontend/components/cms/ContentEditor.tsx============================================================


============================================================FILE: frontend/components/cms/SectionManager.tsxSIZE: 22.15 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { Settings, Eye, EyeOff, Move, Edit, Trash2, Plus, Save, X } from 'lucide-react';  5 | import { SectionConfig } from '@/lib/content-config';  6 | import { CMSButton } from './CMSButton';  7 | import { CMSInput } from './CMSInput';  8 | import { useToast } from './Toast';  9 | import { useAuth } from '@/hooks/useAuth'; 10 |  11 | interface SectionManagerProps { 12 |   sections: SectionConfig[]; 13 |   onSectionsChange: (sections: SectionConfig[]) => void; 14 | } 15 |  16 | export function SectionManager({ sections, onSectionsChange }: SectionManagerProps) { 17 |   const { showSuccess, showError } = useToast(); 18 |   const { user, isLoading: authLoading } = useAuth(); 19 |   const [localSections, setLocalSections] = useState<SectionConfig[]>(sections); 20 |   const [editingSection, setEditingSection] = useState<string | null>(null); 21 |   const [editingData, setEditingData] = useState<Partial<SectionConfig>>({}); 22 |   const [showAddForm, setShowAddForm] = useState(false); 23 |   const [newSection, setNewSection] = useState<Partial<SectionConfig>>({}); 24 |   const [hasChanges, setHasChanges] = useState(false); 25 |  26 |   useEffect(() => { 27 |     setLocalSections(sections); 28 |     setHasChanges(false); 29 |   }, [sections]); 30 |  31 |   const handleSectionToggle = (sectionId: string) => { 32 |     const updatedSections = localSections.map(section => 33 |       section.id === sectionId 34 |         ? { ...section, enabled: !section.enabled } 35 |         : section 36 |     ); 37 |     setLocalSections(updatedSections); 38 |     setHasChanges(true); 39 |     onSectionsChange(updatedSections); 40 |   }; 41 |  42 |   const handleSectionReorder = (sectionId: string, direction: 'up' | 'down') => { 43 |     const currentIndex = localSections.findIndex(s => s.id === sectionId); 44 |     if (currentIndex === -1) return; 45 |  46 |     const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1; 47 |     if (newIndex < 0 || newIndex >= localSections.length) return; 48 |  49 |     const updatedSections = [...localSections]; 50 |     const [movedSection] = updatedSections.splice(currentIndex, 1); 51 |     updatedSections.splice(newIndex, 0, movedSection); 52 |  53 |     updatedSections.forEach((section, index) => { 54 |       section.order = index; 55 |     }); 56 |  57 |     setLocalSections(updatedSections); 58 |     setHasChanges(true); 59 |     onSectionsChange(updatedSections); 60 |   }; 61 |  62 |   const startEditing = (section: SectionConfig) => { 63 |     setEditingSection(section.id); 64 |     setEditingData({ ...section }); 65 |   }; 66 |  67 |   const saveEditing = () => { 68 |     if (!editingSection) return; 69 |  70 |     const updatedSections = localSections.map(section => 71 |       section.id === editingSection 72 |         ? { ...section, ...editingData } 73 |         : section 74 |     ); 75 |  76 |     setLocalSections(updatedSections); 77 |     setEditingSection(null); 78 |     setEditingData({}); 79 |     setHasChanges(true); 80 |     onSectionsChange(updatedSections); 81 |     showSuccess('Section Updated', 'Section configuration has been updated successfully.', 1500); 82 |   }; 83 |  84 |   const cancelEditing = () => { 85 |     setEditingSection(null); 86 |     setEditingData({}); 87 |   }; 88 |  89 |   const deleteSection = async (sectionId: string) => { 90 |     if (window.confirm('Are you sure you want to delete this section? This action cannot be undone.')) { 91 |       try { 92 |         if (authLoading || !user?.access_token) { 93 |           showError('Auth Required', 'Please sign in to modify sections.', 2000); 94 |           return; 95 |         } 96 |  97 |         const updatedSections = localSections.filter(section => section.id !== sectionId); 98 |  99 |         const response = await fetch('/api/admin/sections', {100 |           method: 'PUT',101 |           headers: {102 |             'Authorization': `Bearer ${user.access_token}`,103 |             'Content-Type': 'application/json'104 |           },105 |           body: JSON.stringify({106 |             sections: updatedSections,107 |             action: 'replace'108 |           })109 |         });110 | 111 |         if (!response.ok) {112 |           const errorData = await response.json();113 |           throw new Error(errorData.error || 'Failed to delete section');114 |         }115 | 116 |         setLocalSections(updatedSections);117 |         setHasChanges(false);118 |         onSectionsChange(updatedSections);119 |         showSuccess('Section Deleted!', 'Section has been removed and saved to database.', 1500);120 | 121 |         try {122 |           await fetch('/api/revalidate?path=/&tag=sections', { method: 'POST' });123 |           } catch (revalError) {124 |           }125 | 126 |       } catch (error) {127 |         const errorMessage = error instanceof Error ? error.message : 'Unknown error';128 |         showError('Delete Failed', `Failed to delete section: ${errorMessage}`, 2000);129 |       }130 |     }131 |   };132 | 133 |   const addNewSection = async () => {134 |     if (!newSection.id || !newSection.title || !newSection.component) {135 |       showError('Validation Error', 'Please fill in all required fields.', 2000);136 |       return;137 |     }138 | 139 |     if (authLoading || !user?.access_token) {140 |       showError('Auth Required', 'Please sign in to add sections.', 2000);141 |       return;142 |     }143 | 144 |     const section: SectionConfig = {145 |       id: newSection.id,146 |       type: newSection.type || 'content',147 |       title: newSection.title,148 |       description: newSection.description || '',149 |       icon: newSection.icon || 'Circle',150 |       component: newSection.component,151 |       order: localSections.length,152 |       enabled: true,153 |       mobileConfig: {154 |         padding: 'pt-20 pb-12',155 |         layout: 'center',156 |         imageSize: 'medium'157 |       },158 |       desktopConfig: {159 |         padding: 'pt-16 pb-20',160 |         layout: 'center',161 |         imageSize: 'medium'162 |       }163 |     };164 | 165 |     try {166 | 167 |       const response = await fetch('/api/admin/sections', {168 |         method: 'PUT',169 |         headers: {170 |           'Authorization': `Bearer ${user.access_token}`,171 |           'Content-Type': 'application/json'172 |         },173 |         body: JSON.stringify({174 |           sections: [section],175 |           action: 'add'176 |         })177 |       });178 | 179 |       if (!response.ok) {180 |         const errorData = await response.json();181 |         throw new Error(errorData.error || 'Failed to save new section');182 |       }183 | 184 |       const updatedSections = [...localSections, section];185 |       setLocalSections(updatedSections);186 |       setShowAddForm(false);187 |       setNewSection({});188 |       setHasChanges(false);189 |       onSectionsChange(updatedSections);190 |       showSuccess('Section Added!', 'New section has been added and saved to the database.', 2000);191 | 192 |       try {193 |         await fetch('/api/revalidate?path=/&tag=sections', { method: 'POST' });194 |         } catch (revalError) {195 |         }196 | 197 |     } catch (error) {198 |       const errorMessage = error instanceof Error ? error.message : 'Unknown error';199 |       showError('Add Failed', `Failed to add section: ${errorMessage}`, 2000);200 |     }201 |   };202 | 203 |   const saveAllChanges = async () => {204 |     try {205 |       if (authLoading || !user?.access_token) {206 |         showError('Auth Required', 'Please sign in to save sections.', 2000);207 |         return;208 |       }209 |       const response = await fetch('/api/admin/sections', {210 |         method: 'PUT',211 |         headers: {212 |           'Authorization': `Bearer ${user.access_token}`,213 |           'Content-Type': 'application/json'214 |         },215 |         body: JSON.stringify({216 |           sections: localSections,217 |           action: 'replace'218 |         })219 |       });220 | 221 |       if (!response.ok) {222 |         const errorData = await response.json();223 |         throw new Error(errorData.error || 'Failed to save sections');224 |       }225 | 226 |       await response.json();227 |       setHasChanges(false);228 |       showSuccess('Sections Saved!', 'All section changes have been saved and the page will be revalidated.', 2000);229 | 230 |       try {231 |         await fetch('/api/revalidate?path=/&tag=sections', { method: 'POST' });232 |         } catch (revalError) {233 |         showError('Revalidation Warning', 'Sections saved but page revalidation failed. Changes may take time to appear.', 2000);234 |       }235 | 236 |     } catch (error) {237 |       const errorMessage = error instanceof Error ? error.message : 'Unknown error';238 |       showError('Save Failed', `Failed to save sections: ${errorMessage}`, 2000);239 |     }240 |   };241 | 242 |   const resetChanges = () => {243 |     setLocalSections(sections);244 |     setHasChanges(false);245 |     setEditingSection(null);246 |     setEditingData({});247 |     setShowAddForm(false);248 |     setNewSection({});249 |   };250 | 251 |   return (252 |     <div className="space-y-6">253 |       {}254 |       <div className="flex items-center justify-between bg-[#1A1A2E] p-4 rounded-lg border border-[#2D2D44]">255 |         <div className="flex items-center space-x-4">256 |           <h2 className="text-xl font-semibold text-[#EAEAEA] flex items-center">257 |             <Settings size={20} className="mr-2 text-[#FFD700]" />258 |             Section Management259 |           </h2>260 |           <span className="text-sm text-[#9CA3AF]">261 |             Manage front page sections and their configuration262 |           </span>263 |         </div>264 | 265 |         <div className="flex items-center space-x-3">266 |           {hasChanges && (267 |             <span className="text-[#FFD700] text-sm font-medium">Unsaved changes</span>268 |           )}269 |           <CMSButton270 |             onClick={resetChanges}271 |             disabled={!hasChanges}272 |             variant="secondary"273 |             size="sm"274 |           >275 |             Reset276 |           </CMSButton>277 |           <CMSButton278 |             onClick={saveAllChanges}279 |             disabled={!hasChanges}280 |             variant="primary"281 |             size="sm"282 |           >283 |             <Save size={16} className="mr-2" />284 |             Save All285 |           </CMSButton>286 |         </div>287 |       </div>288 | 289 |       {}290 |       <div className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">291 |         <div className="flex items-center justify-between mb-4">292 |           <h3 className="text-lg font-semibold text-[#FFD700]">Add New Section</h3>293 |           <CMSButton294 |             onClick={() => setShowAddForm(!showAddForm)}295 |             variant="secondary"296 |             size="sm"297 |           >298 |             {showAddForm ? <X size={16} className="mr-2" /> : <Plus size={16} className="mr-2" />}299 |             {showAddForm ? 'Cancel' : 'Add Section'}300 |           </CMSButton>301 |         </div>302 | 303 |         {showAddForm && (304 |           <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">305 |             <div>306 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Section ID *</label>307 |               <CMSInput308 |                 value={newSection.id || ''}309 |                 onChange={(value) => setNewSection({ ...newSection, id: value })}310 |                 placeholder="unique-section-id"311 |               />312 |             </div>313 | 314 |             <div>315 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Title *</label>316 |               <CMSInput317 |                 value={newSection.title || ''}318 |                 onChange={(value) => setNewSection({ ...newSection, title: value })}319 |                 placeholder="Section Title"320 |               />321 |             </div>322 | 323 |             <div>324 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Component *</label>325 |               <select326 |                 value={newSection.component || ''}327 |                 onChange={(e) => setNewSection({ ...newSection, component: e.target.value })}328 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"329 |               >330 |                 <option value="">Select Component</option>331 |                 <option value="HeroSection">Hero Section</option>332 |                 <option value="AboutSection">About Section</option>333 |                 <option value="ApproachSection">Approach Section</option>334 |                 <option value="SessionSection">Session Section</option>335 |                 <option value="BookingSection">Booking Section</option>336 |               </select>337 |             </div>338 | 339 |             <div>340 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Type</label>341 |               <select342 |                 value={newSection.type || 'content'}343 |                 onChange={(e) => setNewSection({ ...newSection, type: e.target.value as 'hero' | 'content' | 'form' | 'gallery' | 'testimonial' })}344 |                 className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"345 |               >346 |                 <option value="hero">Hero</option>347 |                 <option value="content">Content</option>348 |                 <option value="form">Form</option>349 |                 <option value="gallery">Gallery</option>350 |                 <option value="testimonial">Testimonial</option>351 |               </select>352 |             </div>353 | 354 |             <div>355 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Icon</label>356 |               <CMSInput357 |                 value={newSection.icon || 'Circle'}358 |                 onChange={(value) => setNewSection({ ...newSection, icon: value })}359 |                 placeholder="Icon name"360 |               />361 |             </div>362 | 363 |             <div>364 |               <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Description</label>365 |               <CMSInput366 |                 value={newSection.description || ''}367 |                 onChange={(value) => setNewSection({ ...newSection, description: value })}368 |                 placeholder="Section description"369 |               />370 |             </div>371 | 372 |             <div className="md:col-span-2 lg:col-span-3">373 |               <CMSButton374 |                 onClick={addNewSection}375 |                 variant="primary"376 |                 size="sm"377 |                 className="w-full"378 |               >379 |                 <Plus size={16} className="mr-2" />380 |                 Add Section381 |               </CMSButton>382 |             </div>383 |           </div>384 |         )}385 |       </div>386 | 387 |       {}388 |       <div className="space-y-4">389 |         {localSections.map((section, index) => (390 |           <div391 |             key={section.id}392 |             className={`bg-[#1A1A2E] p-4 rounded-lg border transition-all duration-200 ${393 |               section.enabled394 |                 ? 'border-[#2D2D44] hover:border-[#3D3D54]'395 |                 : 'border-[#1A1A2E] opacity-60'396 |             }`}397 |           >398 |             {editingSection === section.id ? (399 | 400 |               <div className="space-y-4">401 |                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">402 |                   <div>403 |                     <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Title</label>404 |                     <CMSInput405 |                       value={editingData.title || ''}406 |                       onChange={(value) => setEditingData({ ...editingData, title: value })}407 |                     />408 |                   </div>409 | 410 |                   <div>411 |                     <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Component</label>412 |                     <CMSInput413 |                       value={editingData.component || ''}414 |                       onChange={(value) => setEditingData({ ...editingData, component: value })}415 |                     />416 |                   </div>417 | 418 |                   <div>419 |                     <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Icon</label>420 |                     <CMSInput421 |                       value={editingData.icon || ''}422 |                       onChange={(value) => setEditingData({ ...editingData, icon: value })}423 |                     />424 |                   </div>425 | 426 |                   <div>427 |                     <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Type</label>428 |                     <select429 |                       value={editingData.type || 'content'}430 |                       onChange={(e) => setEditingData({ ...editingData, type: e.target.value as 'hero' | 'content' | 'form' | 'gallery' | 'testimonial' })}431 |                       className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"432 |                     >433 |                       <option value="hero">Hero</option>434 |                       <option value="content">Content</option>435 |                       <option value="form">Form</option>436 |                       <option value="gallery">Gallery</option>437 |                       <option value="testimonial">Testimonial</option>438 |                     </select>439 |                   </div>440 |                 </div>441 | 442 |                 <div>443 |                   <label className="block text-sm font-medium text-[#EAEAEA] mb-2">Description</label>444 |                   <textarea445 |                     value={editingData.description || ''}446 |                     onChange={(e) => setEditingData({ ...editingData, description: e.target.value })}447 |                     className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"448 |                     rows={3}449 |                   />450 |                 </div>451 | 452 |                 <div className="flex items-center justify-end space-x-3">453 |                   <CMSButton454 |                     onClick={cancelEditing}455 |                     variant="secondary"456 |                     size="sm"457 |                   >458 |                     <X size={16} className="mr-2" />459 |                     Cancel460 |                   </CMSButton>461 |                   <CMSButton462 |                     onClick={saveEditing}463 |                     variant="primary"464 |                     size="sm"465 |                   >466 |                     <Save size={16} className="mr-2" />467 |                     Save468 |                   </CMSButton>469 |                 </div>470 |               </div>471 |             ) : (472 | 473 |               <div className="flex items-center justify-between">474 |                 <div className="flex items-center space-x-4">475 |                   <div className="flex items-center space-x-2">476 |                     <button477 |                       onClick={() => handleSectionReorder(section.id, 'up')}478 |                       disabled={index === 0}479 |                       className="p-1 text-[#9CA3AF] hover:text-[#FFD700] disabled:opacity-50 disabled:cursor-not-allowed"480 |                     >481 |                       <Move size={16} className="rotate-90" />482 |                     </button>483 |                     <button484 |                       onClick={() => handleSectionReorder(section.id, 'down')}485 |                       disabled={index === localSections.length - 1}486 |                       className="p-1 text-[#9CA3AF] hover:text-[#FFD700] disabled:opacity-50 disabled:cursor-not-allowed"487 |                     >488 |                       <Move size={16} className="-rotate-90" />489 |                     </button>490 |                   </div>491 | 492 |                   <div className="flex items-center space-x-3">493 |                     <span className="text-sm text-[#9CA3AF] font-mono">#{section.order}</span>494 |                     <div className="flex items-center space-x-2">495 |                       <span className="text-[#EAEAEA] font-medium">{section.title}</span>496 |                       <span className="text-[#9CA3AF] text-sm">({section.component})</span>497 |                     </div>498 |                   </div>499 |                 </div>500 | 501 |                 <div className="flex items-center space-x-2">502 |                   <button503 |                     onClick={() => handleSectionToggle(section.id)}504 |                     className={`p-2 rounded-md transition-colors ${505 |                       section.enabled506 |                         ? 'text-[#10B981] hover:bg-[#10B981]/20'507 |                         : 'text-[#9CA3AF] hover:bg-[#9CA3AF]/20'508 |                     }`}509 |                     title={section.enabled ? 'Disable section' : 'Enable section'}510 |                   >511 |                     {section.enabled ? <Eye size={16} /> : <EyeOff size={16} />}512 |                   </button>513 | 514 |                   <CMSButton515 |                     onClick={() => startEditing(section)}516 |                     variant="secondary"517 |                     size="sm"518 |                   >519 |                     <Edit size={16} className="mr-2" />520 |                     Edit521 |                   </CMSButton>522 | 523 |                   <CMSButton524 |                     onClick={() => deleteSection(section.id)}525 |                     variant="secondary"526 |                     size="sm"527 |                     className="text-red-400 hover:text-red-300 hover:bg-red-400/20"528 |                   >529 |                     <Trash2 size={16} className="mr-2" />530 |                     Delete531 |                   </CMSButton>532 |                 </div>533 |               </div>534 |             )}535 |           </div>536 |         ))}537 |       </div>538 | 539 |       {}540 |       {localSections.length === 0 && (541 |         <div className="text-center py-12">542 |           <div className="w-16 h-16 bg-[#2D2D44] rounded-full flex items-center justify-center mx-auto mb-4">543 |             <Settings size={24} className="text-[#9CA3AF]" />544 |           </div>545 |           <h3 className="text-lg font-medium text-[#EAEAEA] mb-2">No sections configured</h3>546 |           <p className="text-[#9CA3AF] mb-4">Start by adding your first section to build your front page.</p>547 |           <CMSButton548 |             onClick={() => setShowAddForm(true)}549 |             variant="primary"550 |             size="sm"551 |           >552 |             <Plus size={16} className="mr-2" />553 |             Add First Section554 |           </CMSButton>555 |         </div>556 |       )}557 |     </div>558 |   );559 | }
============================================================END: frontend/components/cms/SectionManager.tsx============================================================


============================================================FILE: frontend/components/cms/SmsConfiguration.tsxSIZE: 12.60 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import {  5 |   Settings,  6 |   Save,  7 |   TestTube,  8 |   CheckCircle,  9 |   Loader2, 10 |   Eye, 11 |   EyeOff, 12 |   Smartphone, 13 |   MessageSquare 14 | } from 'lucide-react'; 15 | import { Button } from '../ui/button'; 16 | import { Input } from '../ui/input'; 17 | import { Label } from '../ui/label'; 18 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card'; 19 | import { Switch } from '../ui/switch'; 20 | import { useToast } from './Toast'; 21 |  22 | interface SmsConfiguration { 23 |   id?: number; 24 |   provider: string; 25 |   username: string; 26 |   tokenApi: string; 27 |   senderName: string; 28 |   isActive: boolean; 29 | } 30 |  31 | interface SmsBalance { 32 |   code: number; 33 |   credits: string; 34 | } 35 |  36 | export function SmsConfiguration() { 37 |   const [config, setConfig] = useState<SmsConfiguration>({ 38 |     provider: 'labsmobile', 39 |     username: '', 40 |     tokenApi: '', 41 |     senderName: 'SoulPath', 42 |     isActive: true 43 |   }); 44 |   const [isLoading, setIsLoading] = useState(false); 45 |   const [isTesting, setIsTesting] = useState(false); 46 |   const [showToken, setShowToken] = useState(false); 47 |   const [balance, setBalance] = useState<SmsBalance | null>(null); 48 |   const [testPhone, setTestPhone] = useState(''); 49 |   const [testMessage, setTestMessage] = useState('Test SMS from SoulPath'); 50 |   const toast = useToast(); 51 |  52 |   useEffect(() => { 53 |     loadConfiguration(); 54 |   }, []); 55 |  56 |   const loadConfiguration = async () => { 57 |     try { 58 |       const response = await fetch('/api/admin/sms-config'); 59 |       if (response.ok) { 60 |         const data = await response.json(); 61 |         if (data.config) { 62 |           setConfig(data.config); 63 |         } 64 |       } 65 |     } catch (error) { 66 |       } 67 |   }; 68 |  69 |   const handleSave = async () => { 70 |     setIsLoading(true); 71 |     try { 72 |       const response = await fetch('/api/admin/sms-config', { 73 |         method: 'POST', 74 |         headers: { 75 |           'Content-Type': 'application/json', 76 |         }, 77 |         body: JSON.stringify(config), 78 |       }); 79 |  80 |       if (response.ok) { 81 |         toast.showSuccess( 82 |           'SMS Configuration Saved', 83 |           'Your SMS settings have been updated successfully.' 84 |         ); 85 |         await loadConfiguration(); 86 |       } else { 87 |         const error = await response.json(); 88 |         toast.showError( 89 |           'Save Failed', 90 |           error.error || 'Failed to save SMS configuration.' 91 |         ); 92 |       } 93 |     } catch (error) { 94 |       toast.showError( 95 |         'Save Failed', 96 |         'Network error. Please try again.' 97 |       ); 98 |     } finally { 99 |       setIsLoading(false);100 |     }101 |   };102 | 103 |   const handleTestConnection = async () => {104 |     setIsTesting(true);105 |     try {106 |       const response = await fetch('/api/admin/sms-config/test', {107 |         method: 'POST',108 |         headers: {109 |           'Content-Type': 'application/json',110 |         },111 |         body: JSON.stringify({112 |           username: config.username,113 |           tokenApi: config.tokenApi,114 |         }),115 |       });116 | 117 |       const data = await response.json();118 | 119 |       if (response.ok) {120 |         setBalance(data.balance);121 |         toast.showSuccess(122 |           'Connection Successful',123 |           `Balance: ${data.balance.credits} credits`124 |         );125 |       } else {126 |         toast.showError(127 |           'Connection Failed',128 |           data.error || 'Failed to connect to LabsMobile API.'129 |         );130 |       }131 |     } catch (error) {132 |       toast.showError(133 |         'Connection Failed',134 |         'Network error. Please try again.'135 |       );136 |     } finally {137 |       setIsTesting(false);138 |     }139 |   };140 | 141 |   const handleSendTestSms = async () => {142 |     if (!testPhone.trim()) {143 |       toast.showError(144 |         'Phone Number Required',145 |         'Please enter a phone number for testing.'146 |       );147 |       return;148 |     }149 | 150 |     setIsTesting(true);151 |     try {152 |       const response = await fetch('/api/admin/sms-config/test-sms', {153 |         method: 'POST',154 |         headers: {155 |           'Content-Type': 'application/json',156 |         },157 |         body: JSON.stringify({158 |           phoneNumber: testPhone,159 |           message: testMessage,160 |           username: config.username,161 |           tokenApi: config.tokenApi,162 |           senderName: config.senderName,163 |         }),164 |       });165 | 166 |       const data = await response.json();167 | 168 |       if (response.ok) {169 |         toast.showSuccess(170 |           'Test SMS Sent',171 |           `SMS sent successfully to ${testPhone}`172 |         );173 |       } else {174 |         toast.showError(175 |           'SMS Send Failed',176 |           data.error || 'Failed to send test SMS.'177 |         );178 |       }179 |     } catch (error) {180 |       toast.showError(181 |         'SMS Send Failed',182 |         'Network error. Please try again.'183 |       );184 |     } finally {185 |       setIsTesting(false);186 |     }187 |   };188 | 189 |   return (190 |     <div className="space-y-6">191 |       <div className="flex items-center gap-3">192 |         <Settings className="w-6 h-6 text-blue-600" />193 |         <h2 className="text-2xl font-heading text-gray-900">SMS Configuration</h2>194 |       </div>195 | 196 |       <div className="grid gap-6 lg:grid-cols-2">197 |         {}198 |         <Card>199 |           <CardHeader>200 |             <CardTitle className="flex items-center gap-2">201 |               <MessageSquare className="w-5 h-5" />202 |               LabsMobile Settings203 |             </CardTitle>204 |             <CardDescription>205 |               Configure your LabsMobile API credentials for SMS OTP verification206 |             </CardDescription>207 |           </CardHeader>208 |           <CardContent className="space-y-4">209 |             <div className="space-y-2">210 |               <Label htmlFor="provider">Provider</Label>211 |               <Input212 |                 id="provider"213 |                 value={config.provider}214 |                 onChange={(e) => setConfig(prev => ({ ...prev, provider: e.target.value }))}215 |                 disabled216 |                 className="bg-gray-50"217 |               />218 |               <p className="text-xs text-gray-500">Currently only LabsMobile is supported</p>219 |             </div>220 | 221 |             <div className="space-y-2">222 |               <Label htmlFor="username">Username</Label>223 |               <Input224 |                 id="username"225 |                 value={config.username}226 |                 onChange={(e) => setConfig(prev => ({ ...prev, username: e.target.value }))}227 |                 placeholder="Your LabsMobile username"228 |               />229 |             </div>230 | 231 |             <div className="space-y-2">232 |               <Label htmlFor="tokenApi">API Token</Label>233 |               <div className="relative">234 |                 <Input235 |                   id="tokenApi"236 |                   type={showToken ? 'text' : 'password'}237 |                   value={config.tokenApi}238 |                   onChange={(e) => setConfig(prev => ({ ...prev, tokenApi: e.target.value }))}239 |                   placeholder="Your LabsMobile API token"240 |                 />241 |                 <button242 |                   type="button"243 |                   onClick={() => setShowToken(!showToken)}244 |                   className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"245 |                 >246 |                   {showToken ? <EyeOff size={16} /> : <Eye size={16} />}247 |                 </button>248 |               </div>249 |             </div>250 | 251 |             <div className="space-y-2">252 |               <Label htmlFor="senderName">Sender Name</Label>253 |               <Input254 |                 id="senderName"255 |                 value={config.senderName}256 |                 onChange={(e) => setConfig(prev => ({ ...prev, senderName: e.target.value }))}257 |                 placeholder="SMS sender name (e.g., SoulPath)"258 |               />259 |             </div>260 | 261 |             <div className="flex items-center space-x-2">262 |               <Switch263 |                 id="isActive"264 |                 checked={config.isActive}265 |                 onCheckedChange={(checked) => setConfig(prev => ({ ...prev, isActive: checked }))}266 |               />267 |               <Label htmlFor="isActive">Enable SMS Service</Label>268 |             </div>269 | 270 |             <div className="flex gap-2 pt-4">271 |               <Button272 |                 onClick={handleSave}273 |                 disabled={isLoading || !config.username || !config.tokenApi}274 |                 className="flex-1"275 |               >276 |                 {isLoading ? (277 |                   <>278 |                     <Loader2 size={16} className="animate-spin mr-2" />279 |                     Saving...280 |                   </>281 |                 ) : (282 |                   <>283 |                     <Save size={16} className="mr-2" />284 |                     Save Configuration285 |                   </>286 |                 )}287 |               </Button>288 |             </div>289 |           </CardContent>290 |         </Card>291 | 292 |         {}293 |         <Card>294 |           <CardHeader>295 |             <CardTitle className="flex items-center gap-2">296 |               <TestTube className="w-5 h-5" />297 |               Test & Status298 |             </CardTitle>299 |             <CardDescription>300 |               Test your SMS configuration and check account status301 |             </CardDescription>302 |           </CardHeader>303 |           <CardContent className="space-y-4">304 |             {}305 |             <div className="space-y-3">306 |               <h4 className="font-medium text-gray-900">Connection Test</h4>307 |               <Button308 |                 onClick={handleTestConnection}309 |                 disabled={isTesting || !config.username || !config.tokenApi}310 |                 variant="outline"311 |                 className="w-full"312 |               >313 |                 {isTesting ? (314 |                   <>315 |                     <Loader2 size={16} className="animate-spin mr-2" />316 |                     Testing...317 |                   </>318 |                 ) : (319 |                   <>320 |                     <CheckCircle size={16} className="mr-2" />321 |                     Test Connection322 |                   </>323 |                 )}324 |               </Button>325 | 326 |               {balance && (327 |                 <div className="p-3 bg-green-50 border border-green-200 rounded-lg">328 |                   <div className="flex items-center gap-2">329 |                     <CheckCircle size={16} className="text-green-600" />330 |                     <span className="text-sm font-medium text-green-800">331 |                       Connected Successfully332 |                     </span>333 |                   </div>334 |                   <p className="text-sm text-green-700 mt-1">335 |                     Account Balance: {balance.credits} credits336 |                   </p>337 |                 </div>338 |               )}339 |             </div>340 | 341 |             {}342 |             <div className="space-y-3">343 |               <h4 className="font-medium text-gray-900">Send Test SMS</h4>344 |               <div className="space-y-2">345 |                 <Label htmlFor="testPhone">Phone Number</Label>346 |                 <Input347 |                   id="testPhone"348 |                   value={testPhone}349 |                   onChange={(e) => setTestPhone(e.target.value)}350 |                   placeholder="+1234567890"351 |                 />352 |               </div>353 |               <div className="space-y-2">354 |                 <Label htmlFor="testMessage">Message</Label>355 |                 <Input356 |                   id="testMessage"357 |                   value={testMessage}358 |                   onChange={(e) => setTestMessage(e.target.value)}359 |                   placeholder="Test message content"360 |                 />361 |               </div>362 |               <Button363 |                 onClick={handleSendTestSms}364 |                 disabled={isTesting || !testPhone.trim() || !config.username || !config.tokenApi}365 |                 variant="outline"366 |                 className="w-full"367 |               >368 |                 {isTesting ? (369 |                   <>370 |                     <Loader2 size={16} className="animate-spin mr-2" />371 |                     Sending...372 |                   </>373 |                 ) : (374 |                   <>375 |                     <Smartphone size={16} className="mr-2" />376 |                     Send Test SMS377 |                   </>378 |                 )}379 |               </Button>380 |             </div>381 | 382 |             {}383 |             <div className="space-y-3">384 |               <h4 className="font-medium text-gray-900">Service Status</h4>385 |               <div className="flex items-center gap-2">386 |                 <div className={`w-3 h-3 rounded-full ${config.isActive ? 'bg-green-500' : 'bg-gray-400'}`} />387 |                 <span className="text-sm text-gray-700">388 |                   SMS Service: {config.isActive ? 'Active' : 'Inactive'}389 |                 </span>390 |               </div>391 |               {config.id && (392 |                 <div className="flex items-center gap-2">393 |                   <div className="w-3 h-3 rounded-full bg-blue-500" />394 |                   <span className="text-sm text-gray-700">395 |                     Configuration: Saved396 |                   </span>397 |                 </div>398 |               )}399 |             </div>400 |           </CardContent>401 |         </Card>402 |       </div>403 |     </div>404 |   );405 | }
============================================================END: frontend/components/cms/SmsConfiguration.tsx============================================================


============================================================FILE: frontend/components/cms/Toast.tsxSIZE: 4.62 KB============================================================
  1 | import React, { useEffect } from 'react';  2 | import { motion, AnimatePresence } from 'framer-motion';  3 | import { CheckCircle, XCircle, AlertCircle, Info, X } from 'lucide-react';  4 |   5 | export type ToastType = 'success' | 'error' | 'warning' | 'info';  6 |   7 | export interface Toast {  8 |   id: string;  9 |   type: ToastType; 10 |   title: string; 11 |   message?: string; 12 |   duration?: number; 13 | } 14 |  15 | interface ToastProps { 16 |   toast: Toast; 17 |   onRemove: (id: string) => void; 18 | } 19 |  20 | const ToastItem: React.FC<ToastProps> = ({ toast, onRemove }) => { 21 |   useEffect(() => { 22 |     if (toast.duration !== Infinity) { 23 |       const timer = setTimeout(() => { 24 |         onRemove(toast.id); 25 |       }, toast.duration || 5000); 26 |  27 |       return () => clearTimeout(timer); 28 |     } 29 |   }, [toast.id, toast.duration, onRemove]); 30 |  31 |   const getIcon = () => { 32 |     switch (toast.type) { 33 |       case 'success': 34 |         return <CheckCircle size={20} className="text-green-500" />; 35 |       case 'error': 36 |         return <XCircle size={20} className="text-red-500" />; 37 |       case 'warning': 38 |         return <AlertCircle size={20} className="text-yellow-500" />; 39 |       case 'info': 40 |         return <Info size={20} className="text-blue-500" />; 41 |       default: 42 |         return <Info size={20} className="text-blue-500" />; 43 |     } 44 |   }; 45 |  46 |   const getBackgroundColor = () => { 47 |     switch (toast.type) { 48 |       case 'success': 49 |         return 'bg-green-500/10 border-green-500/20'; 50 |       case 'error': 51 |         return 'bg-red-500/10 border-red-500/20'; 52 |       case 'warning': 53 |         return 'bg-yellow-500/10 border-yellow-500/20'; 54 |       case 'info': 55 |         return 'bg-blue-500/10 border-blue-500/20'; 56 |       default: 57 |         return 'bg-blue-500/10 border-blue-500/20'; 58 |     } 59 |   }; 60 |  61 |   return ( 62 |     <motion.div 63 |       initial={{ opacity: 0, y: -50, scale: 0.9 }} 64 |       animate={{ opacity: 1, y: 0, scale: 1 }} 65 |       exit={{ opacity: 0, y: -50, scale: 0.9 }} 66 |       transition={{ duration: 0.2, ease: 'easeOut' }} 67 |       className={`relative p-4 rounded-lg border ${getBackgroundColor()} backdrop-blur-sm`} 68 |     > 69 |       <div className="flex items-start space-x-3"> 70 |         <div className="flex-shrink-0 mt-0.5"> 71 |           {getIcon()} 72 |         </div> 73 |  74 |         <div className="flex-1 min-w-0"> 75 |           <h4 className="text-sm font-medium text-[#EAEAEA]"> 76 |             {toast.title} 77 |           </h4> 78 |           {toast.message && ( 79 |             <p className="text-sm text-[#9CA3AF] mt-1"> 80 |               {toast.message} 81 |             </p> 82 |           )} 83 |         </div> 84 |  85 |         <button 86 |           onClick={() => onRemove(toast.id)} 87 |           className="flex-shrink-0 p-1 hover:bg-white/10 rounded transition-colors" 88 |         > 89 |           <X size={16} className="text-[#9CA3AF]" /> 90 |         </button> 91 |       </div> 92 |  93 |       {} 94 |       {toast.duration !== Infinity && ( 95 |         <motion.div 96 |           initial={{ width: '100%' }} 97 |           animate={{ width: '0%' }} 98 |           transition={{ duration: (toast.duration || 5000) / 1000, ease: 'linear' }} 99 |           className="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-transparent to-white/20 rounded-b-lg"100 |         />101 |       )}102 |     </motion.div>103 |   );104 | };105 | 106 | interface ToastContainerProps {107 |   toasts: Toast[];108 |   onRemove: (id: string) => void;109 | }110 | 111 | export const ToastContainer: React.FC<ToastContainerProps> = ({ toasts, onRemove }) => {112 |   return (113 |     <div className="fixed top-4 right-4 z-50 space-y-3 max-w-sm">114 |       <AnimatePresence mode="popLayout">115 |         {toasts.map((toast) => (116 |           <ToastItem117 |             key={toast.id}118 |             toast={toast}119 |             onRemove={onRemove}120 |           />121 |         ))}122 |       </AnimatePresence>123 |     </div>124 |   );125 | };126 | 127 | export const useToast = () => {128 |   const [toasts, setToasts] = React.useState<Toast[]>([]);129 | 130 |   const addToast = (toast: Omit<Toast, 'id'>) => {131 |     const id = Math.random().toString(36).substr(2, 9);132 |     const newToast = { ...toast, id };133 |     setToasts(prev => [...prev, newToast]);134 |   };135 | 136 |   const removeToast = (id: string) => {137 |     setToasts(prev => prev.filter(toast => toast.id !== id));138 |   };139 | 140 |   const showSuccess = (title: string, message?: string, duration?: number) => {141 |     addToast({ type: 'success', title, message, duration });142 |   };143 | 144 |   const showError = (title: string, message?: string, duration?: number) => {145 |     addToast({ type: 'error', title, message, duration });146 |   };147 | 148 |   const showWarning = (title: string, message?: string, duration?: number) => {149 |     addToast({ type: 'warning', title, message, duration });150 |   };151 | 152 |   const showInfo = (title: string, message?: string, duration?: number) => {153 |     addToast({ type: 'info', title, message, duration });154 |   };155 | 156 |   return {157 |     toasts,158 |     showSuccess,159 |     showError,160 |     showWarning,161 |     showInfo,162 |     removeToast163 |   };164 | };
============================================================END: frontend/components/cms/Toast.tsx============================================================


============================================================FILE: frontend/components/cms/TranslationManager.tsxSIZE: 14.15 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { Globe, Save, RefreshCw, Eye, EyeOff, Languages, FileText } from 'lucide-react';  5 | import { CMSInput } from './CMSInput';  6 | import { CMSButton } from './CMSButton';  7 | import { useToast } from './Toast';  8 |   9 | interface TranslationContent { 10 |   [key: string]: string | Record<string, string>; 11 | } 12 |  13 | interface TranslationManagerProps { 14 |   content: TranslationContent; 15 |   onContentChange: (content: TranslationContent) => void; 16 |   onSave: () => Promise<void>; 17 |   onRefresh: () => Promise<void>; 18 |   isLoading: boolean; 19 |   isSaving: boolean; 20 | } 21 |  22 | export function TranslationManager({ 23 |   content, 24 |   onContentChange, 25 |   onSave, 26 |   onRefresh, 27 |   isLoading, 28 |   isSaving 29 | }: TranslationManagerProps) { 30 |   const { showSuccess, showError } = useToast(); 31 |   const [previewMode, setPreviewMode] = useState(false); 32 |   const [localContent, setLocalContent] = useState(content); 33 |   const [hasChanges, setHasChanges] = useState(false); 34 |   const [activeLanguage, setActiveLanguage] = useState<'en' | 'es'>('en'); 35 |   const [searchTerm, setSearchTerm] = useState(''); 36 |  37 |   useEffect(() => { 38 |     setLocalContent(content); 39 |     setHasChanges(false); 40 |   }, [content]); 41 |  42 |   const handleFieldChange = (field: string, value: string, language: 'en' | 'es') => { 43 |     const newContent = { ...localContent }; 44 |  45 |     const fieldKey = `${field}${language.charAt(0).toUpperCase() + language.slice(1)}`; 46 |     newContent[fieldKey] = value; 47 |  48 |     setLocalContent(newContent); 49 |     setHasChanges(true); 50 |     onContentChange(newContent); 51 |   }; 52 |  53 |   const handleSave = async () => { 54 |     try { 55 |       await onSave(); 56 |       setHasChanges(false); 57 |       showSuccess('Translations Saved!', 'Your translation changes have been saved and the page will be revalidated.', 4000); 58 |     } catch { 59 |       showError('Save Failed', 'Failed to save translations. Please try again.', 6000); 60 |     } 61 |   }; 62 |  63 |   const handleRefresh = async () => { 64 |     try { 65 |       await onRefresh(); 66 |       setHasChanges(false); 67 |       showSuccess('Translations Refreshed!', 'Translations have been refreshed from the server.', 3000); 68 |     } catch { 69 |       showError('Refresh Failed', 'Failed to refresh translations. Please try again.', 6000); 70 |     } 71 |   }; 72 |  73 |   const resetChanges = () => { 74 |     setLocalContent(content); 75 |     setHasChanges(false); 76 |   }; 77 |  78 |   const getTranslationFields = () => { 79 |     const fields = [ 80 |       { key: 'heroTitle', label: 'Hero Title', en: content.heroTitleEn, es: content.heroTitleEs }, 81 |       { key: 'heroSubtitle', label: 'Hero Subtitle', en: content.heroSubtitleEn, es: content.heroSubtitleEs }, 82 |       { key: 'aboutTitle', label: 'About Title', en: content.aboutTitleEn, es: content.aboutTitleEs }, 83 |       { key: 'aboutContent', label: 'About Content', en: content.aboutContentEn, es: content.aboutContentEs }, 84 |       { key: 'approachTitle', label: 'Approach Title', en: content.approachTitleEn, es: content.approachTitleEs }, 85 |       { key: 'approachContent', label: 'Approach Content', en: content.approachContentEn, es: content.approachContentEs }, 86 |       { key: 'servicesTitle', label: 'Services Title', en: content.servicesTitleEn, es: content.servicesTitleEs }, 87 |       { key: 'servicesContent', label: 'Services Content', en: content.servicesContentEn, es: content.servicesContentEs } 88 |     ]; 89 |  90 |     if (searchTerm) { 91 |       return fields.filter(field => 92 |         field.label.toLowerCase().includes(searchTerm.toLowerCase()) || 93 |         (typeof field.en === 'string' ? field.en.toLowerCase().includes(searchTerm.toLowerCase()) : false) || 94 |         (typeof field.es === 'string' ? field.es.toLowerCase().includes(searchTerm.toLowerCase()) : false) 95 |       ); 96 |     } 97 |  98 |     return fields; 99 |   };100 | 101 |   const getFieldValue = (fieldKey: string, language: 'en' | 'es') => {102 |     const fullKey = `${fieldKey}${language.charAt(0).toUpperCase() + language.slice(1)}`;103 |     const value = localContent[fullKey];104 |     return typeof value === 'string' ? value : '';105 |   };106 | 107 |   if (isLoading) {108 |     return (109 |       <div className="flex items-center justify-center h-64">110 |         <div className="text-center">111 |           <div className="w-16 h-16 border-4 border-[#FFD700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>112 |           <p className="text-[#9CA3AF]">Loading translations...</p>113 |         </div>114 |       </div>115 |     );116 |   }117 | 118 |   const translationFields = getTranslationFields();119 | 120 |   return (121 |     <div className="space-y-6">122 |       {}123 |       <div className="flex items-center justify-between bg-[#1A1A2E] p-4 rounded-lg border border-[#2D2D44]">124 |         <div className="flex items-center space-x-4">125 |           <h2 className="text-xl font-semibold text-[#EAEAEA] flex items-center">126 |             <Globe size={20} className="mr-2 text-[#FFD700]" />127 |             Translation Manager128 |           </h2>129 |           <div className="flex items-center space-x-2">130 |             <button131 |               onClick={() => setPreviewMode(!previewMode)}132 |               className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${133 |                 previewMode134 |                   ? 'bg-[#FFD700] text-[#0A0A23]'135 |                   : 'bg-[#2D2D44] text-[#EAEAEA] hover:bg-[#3D3D54]'136 |               }`}137 |             >138 |               {previewMode ? <EyeOff size={16} className="mr-1" /> : <Eye size={16} className="mr-1" />}139 |               {previewMode ? 'Hide Preview' : 'Show Preview'}140 |             </button>141 |           </div>142 |         </div>143 | 144 |         <div className="flex items-center space-x-3">145 |           {hasChanges && (146 |             <span className="text-[#FFD700] text-sm font-medium">Unsaved changes</span>147 |           )}148 |           <CMSButton149 |             onClick={resetChanges}150 |             disabled={!hasChanges}151 |             variant="secondary"152 |             size="sm"153 |           >154 |             Reset155 |           </CMSButton>156 |           <CMSButton157 |             onClick={handleRefresh}158 |             disabled={isLoading}159 |             variant="secondary"160 |             size="sm"161 |           >162 |             <RefreshCw size={16} className="mr-2" />163 |             Refresh164 |           </CMSButton>165 |           <CMSButton166 |             onClick={handleSave}167 |             disabled={isSaving || !hasChanges}168 |             variant="primary"169 |             size="sm"170 |           >171 |             <Save size={16} className="mr-2" />172 |             {isSaving ? 'Saving...' : 'Save & Revalidate'}173 |           </CMSButton>174 |         </div>175 |       </div>176 | 177 |       {}178 |       <div className="bg-[#1A1A2E] p-4 rounded-lg border border-[#2D2D44]">179 |         <div className="flex items-center justify-between mb-4">180 |           <h3 className="text-lg font-semibold text-[#FFD700] flex items-center">181 |             <Languages size={18} className="mr-2" />182 |             Language Selection183 |           </h3>184 |           <div className="flex items-center space-x-2">185 |             <button186 |               onClick={() => setActiveLanguage('en')}187 |               className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${188 |                 activeLanguage === 'en'189 |                   ? 'bg-[#FFD700] text-[#0A0A23]'190 |                   : 'bg-[#2D2D44] text-[#EAEAEA] hover:bg-[#3D3D54]'191 |               }`}192 |             >193 |               🇺🇸 English194 |             </button>195 |             <button196 |               onClick={() => setActiveLanguage('es')}197 |               className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${198 |                 activeLanguage === 'es'199 |                   ? 'bg-[#FFD700] text-[#0A0A23]'200 |                   : 'bg-[#2D2D44] text-[#EAEAEA] hover:bg-[#3D3D54]'201 |               }`}202 |             >203 |               🇪🇸 Español204 |             </button>205 |           </div>206 |         </div>207 | 208 |         <p className="text-[#9CA3AF] text-sm">209 |           Currently editing: <span className="text-[#FFD700] font-medium">210 |             {activeLanguage === 'en' ? 'English' : 'Spanish'}211 |           </span> translations212 |         </p>213 |       </div>214 | 215 |       {}216 |       <div className="bg-[#1A1A2E] p-4 rounded-lg border border-[#2D2D44]">217 |         <div className="relative">218 |           <input219 |             type="text"220 |             placeholder="Search translations..."221 |             value={searchTerm}222 |             onChange={(e) => setSearchTerm(e.target.value)}223 |             className="w-full px-4 py-2 pl-10 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"224 |           />225 |           <FileText size={18} className="absolute left-3 top-1/2 transform -translate-y-1/2 text-[#9CA3AF]" />226 |         </div>227 |       </div>228 | 229 |       {}230 |       <div className="space-y-4">231 |         {translationFields.map((field) => (232 |           <div key={field.key} className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">233 |             <h4 className="text-lg font-semibold text-[#FFD700] mb-4">{field.label}</h4>234 | 235 |             <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">236 |               {}237 |               <div>238 |                 <label className="block text-sm font-medium text-[#EAEAEA] mb-2">239 |                   🇺🇸 English240 |                 </label>241 |                 {field.key.includes('Content') ? (242 |                   <textarea243 |                     value={getFieldValue(field.key, 'en')}244 |                     onChange={(e) => handleFieldChange(field.key, e.target.value, 'en')}245 |                     placeholder={`Enter ${field.label.toLowerCase()} in English`}246 |                     className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"247 |                     rows={4}248 |                   />249 |                 ) : (250 |                   <CMSInput251 |                     value={getFieldValue(field.key, 'en')}252 |                     onChange={(value) => handleFieldChange(field.key, value, 'en')}253 |                     placeholder={`Enter ${field.label.toLowerCase()} in English`}254 |                   />255 |                 )}256 |               </div>257 | 258 |               {}259 |               <div>260 |                 <label className="block text-sm font-medium text-[#EAEAEA] mb-2">261 |                   🇪🇸 Español262 |                 </label>263 |                 {field.key.includes('Content') ? (264 |                   <textarea265 |                     value={getFieldValue(field.key, 'es')}266 |                     onChange={(e) => handleFieldChange(field.key, e.target.value, 'es')}267 |                     placeholder={`Enter ${field.label.toLowerCase()} in Spanish`}268 |                     className="w-full px-3 py-2 bg-[#2D2D44] border border-[#3D3D54] rounded-md text-[#EAEAEA] placeholder-[#9CA3AF] focus:outline-none focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"269 |                     rows={4}270 |                   />271 |                 ) : (272 |                   <CMSInput273 |                     value={getFieldValue(field.key, 'es')}274 |                     onChange={(value) => handleFieldChange(field.key, value, 'es')}275 |                     placeholder={`Enter ${field.label.toLowerCase()} in Spanish`}276 |                   />277 |                 )}278 |               </div>279 |             </div>280 |           </div>281 |         ))}282 |       </div>283 | 284 |       {}285 |       {previewMode && (286 |         <div className="bg-[#1A1A2E] p-6 rounded-lg border border-[#2D2D44]">287 |           <h3 className="text-lg font-semibold text-[#FFD700] mb-4">Translation Preview</h3>288 |           <div className="grid grid-cols-1 md:grid-cols-2 gap-6">289 |             <div>290 |               <h4 className="text-md font-medium text-[#EAEAEA] mb-3">🇺🇸 English Version</h4>291 |               <div className="space-y-2 text-sm">292 |                 <p><strong>Hero:</strong> {typeof localContent.heroTitleEn === 'string' ? localContent.heroTitleEn || 'MatMax Yoga Studio' : 'MatMax Yoga Studio'}</p>293 |                 <p><strong>Subtitle:</strong> {typeof localContent.heroSubtitleEn === 'string' ? localContent.heroSubtitleEn || 'Your journey to wellness starts here' : 'Your journey to wellness starts here'}</p>294 |                 <p><strong>About:</strong> {typeof localContent.aboutTitleEn === 'string' ? localContent.aboutTitleEn || 'About Us' : 'About Us'}</p>295 |                 <p><strong>Approach:</strong> {typeof localContent.approachTitleEn === 'string' ? localContent.approachTitleEn || 'Our Approach' : 'Our Approach'}</p>296 |                 <p><strong>Services:</strong> {typeof localContent.servicesTitleEn === 'string' ? localContent.servicesTitleEn || 'Our Services' : 'Our Services'}</p>297 |               </div>298 |             </div>299 |             <div>300 |               <h4 className="text-md font-medium text-[#EAEAEA] mb-3">🇪🇸 Spanish Version</h4>301 |               <div className="space-y-2 text-sm">302 |                 <p><strong>Hero:</strong> {typeof localContent.heroTitleEs === 'string' ? localContent.heroTitleEs || 'MatMax Yoga Studio' : 'MatMax Yoga Studio'}</p>303 |                 <p><strong>Subtitle:</strong> {typeof localContent.heroSubtitleEs === 'string' ? localContent.heroSubtitleEs || 'Tu camino al bienestar comienza aquí' : 'Tu camino al bienestar comienza aquí'}</p>304 |                 <p><strong>About:</strong> {typeof localContent.aboutTitleEs === 'string' ? localContent.aboutTitleEs || 'Sobre Nosotros' : 'Sobre Nosotros'}</p>305 |                 <p><strong>Approach:</strong> {typeof localContent.approachTitleEs === 'string' ? localContent.approachTitleEs || 'Nuestro Enfoque' : 'Nuestro Enfoque'}</p>306 |                 <p><strong>Services:</strong> {typeof localContent.servicesTitleEs === 'string' ? localContent.servicesTitleEs || 'Nuestros Servicios' : 'Nuestros Servicios'}</p>307 |               </div>308 |             </div>309 |           </div>310 |         </div>311 |       )}312 | 313 |       {}314 |       {translationFields.length === 0 && searchTerm && (315 |         <div className="text-center py-12">316 |           <div className="w-16 h-16 bg-[#2D2D44] rounded-full flex items-center justify-center mx-auto mb-4">317 |             <FileText size={24} className="text-[#9CA3AF]" />318 |           </div>319 |           <h3 className="text-lg font-medium text-[#EAEAEA] mb-2">No translations found</h3>320 |           <p className="text-[#9CA3AF] mb-4">Try adjusting your search terms or clear the search to see all translations.</p>321 |           <CMSButton322 |             onClick={() => setSearchTerm('')}323 |             variant="secondary"324 |             size="sm"325 |           >326 |             Clear Search327 |           </CMSButton>328 |         </div>329 |       )}330 |     </div>331 |   );332 | }
============================================================END: frontend/components/cms/TranslationManager.tsx============================================================


============================================================FILE: frontend/components/communication/CommunicationConfig.tsxSIZE: 16.56 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useCallback } from 'react';  4 | import { Card, CardContent, CardHeader, CardTitle } from '../ui/card';  5 | import { BaseButton } from '../ui/BaseButton';  6 | import { BaseInput } from '../ui/BaseInput';  7 | import { Label } from '../ui/label';  8 | import { Switch } from '../ui/switch';  9 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../ui/select'; 10 | import { 11 |   Save, 12 |   TestTube, 13 |   Eye, 14 |   EyeOff, 15 |   Mail, 16 |   Smartphone, 17 |   CheckCircle, 18 |   AlertCircle 19 | } from 'lucide-react'; 20 | import { useAuth } from '../../hooks/useAuth'; 21 |  22 | interface CommunicationConfigData { 23 |  24 |   email_enabled: boolean; 25 |   brevo_api_key: string; 26 |   sender_email: string; 27 |   sender_name: string; 28 |   admin_email: string; 29 |  30 |   sms_enabled: boolean; 31 |   sms_provider: string; 32 |   labsmobile_username: string; 33 |   labsmobile_token: string; 34 |   sms_sender_name: string; 35 | } 36 |  37 | export function CommunicationConfig() { 38 |   const { user } = useAuth(); 39 |   const [config, setConfig] = useState<CommunicationConfigData>({ 40 |     email_enabled: true, 41 |     brevo_api_key: '', 42 |     sender_email: 'noreply@matmax.store', 43 |     sender_name: 'MatMax Yoga Studio', 44 |     admin_email: 'admin@matmax.store', 45 |     sms_enabled: false, 46 |     sms_provider: 'labsmobile', 47 |     labsmobile_username: '', 48 |     labsmobile_token: '', 49 |     sms_sender_name: 'MatMax Yoga Studio' 50 |   }); 51 |  52 |   const [isLoading, setIsLoading] = useState(false); 53 |   const [isSaving, setIsSaving] = useState(false); 54 |   const [showApiKey, setShowApiKey] = useState(false); 55 |   const [showSmsToken, setShowSmsToken] = useState(false); 56 |   const [testEmail, setTestEmail] = useState(''); 57 |   const [testPhone, setTestPhone] = useState(''); 58 |   const [testMessage, setTestMessage] = useState('Test message from MatMax Yoga Studio'); 59 |   const [isTestingEmail, setIsTestingEmail] = useState(false); 60 |   const [isTestingSms, setIsTestingSms] = useState(false); 61 |   const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null); 62 |  63 |   const loadConfiguration = useCallback(async () => { 64 |     if (!user?.access_token) { 65 |       return; 66 |     } 67 |  68 |     setIsLoading(true); 69 |     try { 70 |       const response = await fetch('/api/admin/communication/config', { 71 |         headers: { 72 |           'Authorization': `Bearer ${user.access_token}`, 73 |           'Content-Type': 'application/json' 74 |         } 75 |       }); 76 |       if (response.ok) { 77 |         const data = await response.json(); 78 |         setConfig(data.config); 79 |       } else { 80 |         setMessage({ type: 'error', text: 'Failed to load configuration' }); 81 |       } 82 |     } catch (error) { 83 |       setMessage({ type: 'error', text: 'Failed to load configuration' }); 84 |     } finally { 85 |       setIsLoading(false); 86 |     } 87 |   }, [user?.access_token]); 88 |  89 |   useEffect(() => { 90 |     if (user?.access_token) { 91 |       loadConfiguration(); 92 |     } 93 |   }, [user?.access_token, loadConfiguration]); 94 |  95 |   const saveConfiguration = async () => { 96 |     setIsSaving(true); 97 |     try { 98 |       const response = await fetch('/api/admin/communication/config', { 99 |         method: 'PUT',100 |         headers: {101 |           'Content-Type': 'application/json',102 |           'Authorization': `Bearer ${user?.access_token}`103 |         },104 |         body: JSON.stringify(config)105 |       });106 | 107 |       if (response.ok) {108 |         setMessage({ type: 'success', text: 'Configuration saved successfully!' });109 |       } else {110 |         const errorData = await response.json();111 |         setMessage({ type: 'error', text: errorData.error || 'Failed to save configuration' });112 |       }113 |     } catch (error) {114 |       setMessage({ type: 'error', text: 'Failed to save configuration' });115 |     } finally {116 |       setIsSaving(false);117 |     }118 |   };119 | 120 |   const testEmailConnection = async () => {121 |     if (!testEmail) return;122 | 123 |     setIsTestingEmail(true);124 |     try {125 |       const response = await fetch('/api/admin/communication/test', {126 |         method: 'POST',127 |         headers: {128 |           'Content-Type': 'application/json',129 |           'Authorization': `Bearer ${user?.access_token}`130 |         },131 |         body: JSON.stringify({132 |           type: 'email',133 |           to: testEmail,134 |           subject: 'Test Email from MatMax Yoga Studio',135 |           content: '<p>This is a test email to verify your email configuration.</p>'136 |         })137 |       });138 | 139 |       if (response.ok) {140 |         setMessage({ type: 'success', text: 'Test email sent successfully!' });141 |       } else {142 |         const errorData = await response.json();143 |         setMessage({ type: 'error', text: errorData.error || 'Failed to send test email' });144 |       }145 |     } catch (error) {146 |       setMessage({ type: 'error', text: 'Failed to send test email' });147 |     } finally {148 |       setIsTestingEmail(false);149 |     }150 |   };151 | 152 |   const testSmsConnection = async () => {153 |     if (!testPhone) return;154 | 155 |     setIsTestingSms(true);156 |     try {157 |       const response = await fetch('/api/admin/communication/test', {158 |         method: 'POST',159 |         headers: {160 |           'Content-Type': 'application/json',161 |           'Authorization': `Bearer ${user?.access_token}`162 |         },163 |         body: JSON.stringify({164 |           type: 'sms',165 |           phoneNumber: testPhone,166 |           message: testMessage167 |         })168 |       });169 | 170 |       if (response.ok) {171 |         setMessage({ type: 'success', text: 'Test SMS sent successfully!' });172 |       } else {173 |         const errorData = await response.json();174 |         setMessage({ type: 'error', text: errorData.error || 'Failed to send test SMS' });175 |       }176 |     } catch (error) {177 |       setMessage({ type: 'error', text: 'Failed to send test SMS' });178 |     } finally {179 |       setIsTestingSms(false);180 |     }181 |   };182 | 183 |   if (isLoading) {184 |     return (185 |       <div className="flex items-center justify-center h-64">186 |         <div className="text-center">187 |           <div className="w-16 h-16 border-4 border-[#ffd700] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>188 |           <p className="dashboard-text-secondary">Loading configuration...</p>189 |         </div>190 |       </div>191 |     );192 |   }193 | 194 |   return (195 |     <div className="space-y-6">196 |       {message && (197 |         <div className={`p-4 rounded-lg flex items-center space-x-3 ${198 |           message.type === 'success'199 |             ? 'bg-green-500/10 border border-green-500/20'200 |             : 'bg-red-500/10 border border-red-500/20'201 |         }`}>202 |           {message.type === 'success' ? (203 |             <CheckCircle size={20} className="text-green-400" />204 |           ) : (205 |             <AlertCircle size={20} className="text-red-400" />206 |           )}207 |           <span className={message.type === 'success' ? 'text-green-400' : 'text-red-400'}>208 |             {message.text}209 |           </span>210 |         </div>211 |       )}212 | 213 |       <div className="flex justify-end">214 |         <BaseButton215 |           onClick={saveConfiguration}216 |           disabled={isSaving}217 |           className="dashboard-button-primary"218 |         >219 |           {isSaving ? (220 |             <>221 |               <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>222 |               Saving...223 |             </>224 |           ) : (225 |             <>226 |               <Save size={16} className="mr-2" />227 |               Save Configuration228 |             </>229 |           )}230 |         </BaseButton>231 |       </div>232 | 233 |       <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">234 |         {}235 |         <Card className="dashboard-card">236 |           <CardHeader>237 |             <CardTitle className="dashboard-card-title flex items-center gap-2">238 |               <Mail size={20} />239 |               <span>Email Configuration</span>240 |             </CardTitle>241 |           </CardHeader>242 |           <CardContent className="space-y-6">243 |             <div className="flex items-center justify-between">244 |               <div>245 |                 <Label className="dashboard-label">Enable Email Service</Label>246 |                 <p className="text-xs text-gray-500">Enable email notifications and templates</p>247 |               </div>248 |               <Switch249 |                 checked={config.email_enabled}250 |                 onCheckedChange={(checked) => setConfig(prev => ({ ...prev, email_enabled: checked }))}251 |               />252 |             </div>253 | 254 |             <div className="space-y-4">255 |               <div>256 |                 <Label className="dashboard-label">Brevo API Key</Label>257 |                 <div className="relative">258 |                   <BaseInput259 |                     type={showApiKey ? "text" : "password"}260 |                     value={config.brevo_api_key}261 |                     onChange={(e) => setConfig(prev => ({ ...prev, brevo_api_key: e.target.value }))}262 |                     placeholder="Enter your Brevo API key"263 |                     className="dashboard-input pr-10"264 |                   />265 |                   <button266 |                     type="button"267 |                     onClick={() => setShowApiKey(!showApiKey)}268 |                     className="absolute right-3 top-1/2 transform -translate-y-1/2 text-[#C0C0C0] hover:text-white"269 |                   >270 |                     {showApiKey ? <EyeOff size={16} /> : <Eye size={16} />}271 |                   </button>272 |                 </div>273 |               </div>274 | 275 |               <div>276 |                 <Label className="dashboard-label">Sender Email</Label>277 |                 <BaseInput278 |                   type="email"279 |                   value={config.sender_email}280 |                   onChange={(e) => setConfig(prev => ({ ...prev, sender_email: e.target.value }))}281 |                   placeholder="noreply@yourdomain.com"282 |                   className="dashboard-input"283 |                 />284 |               </div>285 | 286 |               <div>287 |                 <Label className="dashboard-label">Sender Name</Label>288 |                 <BaseInput289 |                   value={config.sender_name}290 |                   onChange={(e) => setConfig(prev => ({ ...prev, sender_name: e.target.value }))}291 |                   placeholder="SoulPath Astrology"292 |                   className="dashboard-input"293 |                 />294 |               </div>295 | 296 |               <div>297 |                 <Label className="dashboard-label">Admin Email</Label>298 |                 <BaseInput299 |                   type="email"300 |                   value={config.admin_email}301 |                   onChange={(e) => setConfig(prev => ({ ...prev, admin_email: e.target.value }))}302 |                   placeholder="admin@yourdomain.com"303 |                   className="dashboard-input"304 |                 />305 |               </div>306 |             </div>307 | 308 |             {}309 |             <div className="border-t border-[#C0C0C0]/20 pt-6">310 |               <h4 className="font-medium dashboard-text-primary mb-4">Test Email Configuration</h4>311 |               <div className="space-y-3">312 |                 <BaseInput313 |                   type="email"314 |                   value={testEmail}315 |                   onChange={(e) => setTestEmail(e.target.value)}316 |                   placeholder="Enter test email address"317 |                   className="dashboard-input"318 |                 />319 |                 <BaseButton320 |                   onClick={testEmailConnection}321 |                   disabled={isTestingEmail || !testEmail || !config.email_enabled}322 |                   className="dashboard-button-success w-full"323 |                 >324 |                   {isTestingEmail ? (325 |                     <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>326 |                   ) : (327 |                     <>328 |                       <TestTube size={16} className="mr-2" />329 |                       Send Test Email330 |                     </>331 |                   )}332 |                 </BaseButton>333 |               </div>334 |             </div>335 |           </CardContent>336 |         </Card>337 | 338 |         {}339 |         <Card className="bg-[#0A0A23]/30 border-[#C0C0C0]/20">340 |           <CardHeader>341 |             <CardTitle className="flex items-center gap-2 text-[#EAEAEA]">342 |               <Smartphone size={20} />343 |               <span>SMS Configuration</span>344 |             </CardTitle>345 |           </CardHeader>346 |           <CardContent className="space-y-6">347 |             <div className="flex items-center justify-between">348 |               <div>349 |                 <Label className="text-[#C0C0C0]">Enable SMS Service</Label>350 |                 <p className="text-xs text-gray-500">Enable SMS OTP verification and notifications</p>351 |               </div>352 |               <Switch353 |                 checked={config.sms_enabled}354 |                 onCheckedChange={(checked) => setConfig(prev => ({ ...prev, sms_enabled: checked }))}355 |               />356 |             </div>357 | 358 |             <div className="space-y-4">359 |               <div>360 |                 <Label className="text-[#C0C0C0]">SMS Provider</Label>361 |                 <Select value={config.sms_provider} onValueChange={(value) => setConfig(prev => ({ ...prev, sms_provider: value }))}>362 |                   <SelectTrigger className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]">363 |                     <SelectValue />364 |                   </SelectTrigger>365 |                   <SelectContent>366 |                     <SelectItem value="labsmobile">Labsmobile</SelectItem>367 |                   </SelectContent>368 |                 </Select>369 |                 <p className="text-xs text-gray-500">Currently only Labsmobile is supported</p>370 |               </div>371 | 372 |               <div>373 |                 <Label className="text-[#C0C0C0]">Labsmobile Username</Label>374 |                 <BaseInput375 |                   value={config.labsmobile_username}376 |                   onChange={(e) => setConfig(prev => ({ ...prev, labsmobile_username: e.target.value }))}377 |                   placeholder="Your Labsmobile username"378 |                   className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"379 |                 />380 |               </div>381 | 382 |               <div>383 |                 <Label className="text-[#C0C0C0]">Labsmobile API Token</Label>384 |                 <div className="relative">385 |                   <BaseInput386 |                     type={showSmsToken ? "text" : "password"}387 |                     value={config.labsmobile_token}388 |                     onChange={(e) => setConfig(prev => ({ ...prev, labsmobile_token: e.target.value }))}389 |                     placeholder="Your Labsmobile API token"390 |                     className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA] pr-10"391 |                   />392 |                   <button393 |                     type="button"394 |                     onClick={() => setShowSmsToken(!showSmsToken)}395 |                     className="absolute right-3 top-1/2 transform -translate-y-1/2 text-[#C0C0C0] hover:text-white"396 |                   >397 |                     {showSmsToken ? <EyeOff size={16} /> : <Eye size={16} />}398 |                   </button>399 |                 </div>400 |               </div>401 | 402 |               <div>403 |                 <Label className="text-[#C0C0C0]">SMS Sender Name</Label>404 |                 <BaseInput405 |                   value={config.sms_sender_name}406 |                   onChange={(e) => setConfig(prev => ({ ...prev, sms_sender_name: e.target.value }))}407 |                   placeholder="SMS sender name (e.g., SoulPath)"408 |                   className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"409 |                 />410 |               </div>411 |             </div>412 | 413 |             {}414 |             <div className="border-t border-[#C0C0C0]/20 pt-6">415 |               <h4 className="font-medium text-[#EAEAEA] mb-4">Test SMS Configuration</h4>416 |               <div className="space-y-3">417 |                 <BaseInput418 |                   value={testPhone}419 |                   onChange={(e) => setTestPhone(e.target.value)}420 |                   placeholder="+1234567890"421 |                   className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"422 |                 />423 |                 <BaseInput424 |                   value={testMessage}425 |                   onChange={(e) => setTestMessage(e.target.value)}426 |                   placeholder="Test SMS message"427 |                   className="bg-[#0A0A23]/50 border-[#C0C0C0]/30 text-[#EAEAEA]"428 |                 />429 |                 <BaseButton430 |                   onClick={testSmsConnection}431 |                   disabled={isTestingSms || !testPhone || !config.sms_enabled}432 |                   className="bg-[#10B981] hover:bg-[#059669] text-white px-4 w-full"433 |                 >434 |                   {isTestingSms ? (435 |                     <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>436 |                   ) : (437 |                     <>438 |                       <TestTube size={16} className="mr-2" />439 |                       Send Test SMS440 |                     </>441 |                   )}442 |                 </BaseButton>443 |               </div>444 |             </div>445 |           </CardContent>446 |         </Card>447 |       </div>448 |     </div>449 |   );450 | }
============================================================END: frontend/components/communication/CommunicationConfig.tsx============================================================


============================================================FILE: frontend/components/communication/CommunicationSettings.tsxSIZE: 1.78 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';  5 | import { Mail, Smartphone, Settings } from 'lucide-react';  6 | import { CommunicationConfig } from './CommunicationConfig';  7 | import { TemplateLibrary } from './TemplateLibrary';  8 |   9 | export function CommunicationSettings() { 10 |   const [activeTab, setActiveTab] = useState('config'); 11 |  12 |   return ( 13 |     <div className="dashboard-container p-6 space-y-6"> 14 |       <div className="flex items-center justify-between"> 15 |         <div> 16 |           <h1 className="dashboard-text-primary text-3xl font-bold">Communication Settings</h1> 17 |           <p className="dashboard-text-secondary mt-2">Configure email and SMS communication services and templates</p> 18 |         </div> 19 |       </div> 20 |  21 |       <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full"> 22 |         <TabsList className="dashboard-tabs"> 23 |           <TabsTrigger value="config" className="dashboard-tab"> 24 |             <Settings size={16} className="mr-2" /> 25 |             Configuration 26 |           </TabsTrigger> 27 |           <TabsTrigger value="email" className="dashboard-tab"> 28 |             <Mail size={16} className="mr-2" /> 29 |             Email Templates 30 |           </TabsTrigger> 31 |           <TabsTrigger value="sms" className="dashboard-tab"> 32 |             <Smartphone size={16} className="mr-2" /> 33 |             SMS Templates 34 |           </TabsTrigger> 35 |         </TabsList> 36 |  37 |         <TabsContent value="config" className="space-y-6"> 38 |           <CommunicationConfig /> 39 |         </TabsContent> 40 |  41 |         <TabsContent value="email" className="space-y-6"> 42 |           <TemplateLibrary type="email" /> 43 |         </TabsContent> 44 |  45 |         <TabsContent value="sms" className="space-y-6"> 46 |           <TemplateLibrary type="sms" /> 47 |         </TabsContent> 48 |       </Tabs> 49 |     </div> 50 |   ); 51 | }
============================================================END: frontend/components/communication/CommunicationSettings.tsx============================================================


============================================================FILE: frontend/components/figma/ImageWithFallback.tsxSIZE: 1.36 KB============================================================
  1 | import { useState } from 'react'  2 | import Image from 'next/image'  3 |   4 | const ERROR_IMG_SRC =  5 |   'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg=='  6 |   7 | export function ImageWithFallback(props: React.ImgHTMLAttributes<HTMLImageElement>) {  8 |   const [didError, setDidError] = useState(false)  9 |  10 |   const handleError = () => { 11 |     setDidError(true) 12 |   } 13 |  14 |   const { src, alt, style, className, width, height, ...rest } = props 15 |  16 |   return didError ? ( 17 |     <div 18 |       className={`inline-block bg-gray-100 text-center align-middle ${className ?? ''}`} 19 |       style={style} 20 |     > 21 |       <div className="flex items-center justify-center w-full h-full"> 22 |         <Image src={ERROR_IMG_SRC} alt="Error loading image" width={88} height={88} data-original-url={src} /> 23 |       </div> 24 |     </div> 25 |   ) : src ? ( 26 |     <Image 27 |       src={src} 28 |       alt={alt || ''} 29 |       width={typeof width === 'number' ? width : 400} 30 |       height={typeof height === 'number' ? height : 300} 31 |       className={className} 32 |       style={style} 33 |       onError={handleError} 34 |       {...rest} 35 |     /> 36 |   ) : null 37 | }
============================================================END: frontend/components/figma/ImageWithFallback.tsx============================================================


============================================================FILE: frontend/components/izipay/IzipayForm.tsxSIZE: 10.01 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import Script from 'next/script';  5 | import { Button } from '@/components/ui/button';  6 | import { Loader2, CreditCard, Shield, AlertCircle } from 'lucide-react';  7 |   8 | interface IzipayFormProps {  9 |   publicKey: string; 10 |   amountInCents: number; 11 |   currency: string; 12 |   onSuccess: (paymentToken: string) => void; 13 |   onError: (errorMessage: string) => void; 14 | } 15 |  16 | declare global { 17 |   interface Window { 18 |     KR: { 19 |       init: (publicKey: string) => void; 20 |       setFormConfig: (config: Record<string, unknown>) => void; 21 |       createToken: () => Promise<{ 'kr-answer': string }>; 22 |       addForm: (selector: string) => void; 23 |       on: (event: string, callback: (event: Record<string, unknown>) => void) => void; 24 |     }; 25 |   } 26 | } 27 |  28 | export const IzipayForm: React.FC<IzipayFormProps> = ({ 29 |   publicKey, 30 |   amountInCents, 31 |   currency, 32 |   onSuccess, 33 |   onError, 34 | }) => { 35 |   const [isIzipayReady, setIsIzipayReady] = useState(false); 36 |   const [isSubmitting, setIsSubmitting] = useState(false); 37 |   const [formError, setFormError] = useState<string | null>(null); 38 |  39 |   useEffect(() => { 40 |     if (isIzipayReady && window.KR) { 41 |       try { 42 |  43 |         window.KR.init(publicKey); 44 |  45 |         window.KR.setFormConfig({ 46 |           'kr-form-token': 'kr-form-token', 47 |           'kr-form-class': 'kr-form', 48 |           'kr-pan-class': 'kr-pan', 49 |           'kr-expiry-class': 'kr-expiry', 50 |           'kr-security-code-class': 'kr-security-code', 51 |           'kr-error-class': 'kr-form-error', 52 |           'kr-payment-button-class': 'kr-payment-button', 53 |           'kr-placeholder-pan': 'Número de tarjeta', 54 |           'kr-placeholder-expiry': 'MM/AA', 55 |           'kr-placeholder-security-code': 'CVV', 56 |           'kr-label-pan': 'Número de tarjeta', 57 |           'kr-label-expiry': 'Fecha de vencimiento', 58 |           'kr-label-security-code': 'Código de seguridad', 59 |           'kr-label-submit': 'Pagar con Izipay', 60 |           'kr-style': { 61 |             'kr-form': { 62 |               'background-color': 'transparent', 63 |               'border': 'none', 64 |               'padding': '0', 65 |             }, 66 |             'kr-pan': { 67 |               'border': '1px solid #d1d5db', 68 |               'border-radius': '0.375rem', 69 |               'padding': '0.75rem', 70 |               'font-size': '1rem', 71 |               'width': '100%', 72 |               'height': '2.5rem', 73 |             }, 74 |             'kr-expiry': { 75 |               'border': '1px solid #d1d5db', 76 |               'border-radius': '0.375rem', 77 |               'padding': '0.75rem', 78 |               'font-size': '1rem', 79 |               'width': '100%', 80 |               'height': '2.5rem', 81 |             }, 82 |             'kr-security-code': { 83 |               'border': '1px solid #d1d5db', 84 |               'border-radius': '0.375rem', 85 |               'padding': '0.75rem', 86 |               'font-size': '1rem', 87 |               'width': '100%', 88 |               'height': '2.5rem', 89 |             }, 90 |             'kr-payment-button': { 91 |               'background-color': '#3b82f6', 92 |               'color': 'white', 93 |               'border': 'none', 94 |               'border-radius': '0.375rem', 95 |               'padding': '0.75rem 1.5rem', 96 |               'font-size': '1rem', 97 |               'font-weight': '600', 98 |               'width': '100%', 99 |               'height': '2.5rem',100 |               'cursor': 'pointer',101 |               'transition': 'all 0.2s',102 |             },103 |             'kr-payment-button:hover': {104 |               'background-color': '#2563eb',105 |             },106 |             'kr-payment-button:disabled': {107 |               'background-color': '#9ca3af',108 |               'cursor': 'not-allowed',109 |             },110 |             'kr-form-error': {111 |               'color': '#dc2626',112 |               'font-size': '0.875rem',113 |               'margin-top': '0.5rem',114 |             },115 |           },116 |         });117 |       } catch (error) {118 |         onError('Error al inicializar el formulario de pago');119 |       }120 |     }121 |   }, [isIzipayReady, publicKey, onError]);122 | 123 |   const handleSubmit = async (e: React.FormEvent) => {124 |     e.preventDefault();125 | 126 |     if (!isIzipayReady || !window.KR) {127 |       onError('El formulario de pago no está listo');128 |       return;129 |     }130 | 131 |     setIsSubmitting(true);132 |     setFormError(null);133 | 134 |     try {135 | 136 |       const result = await window.KR.createToken();137 | 138 |       if (result && result['kr-answer']) {139 | 140 |         const krAnswer = JSON.parse(result['kr-answer']);141 | 142 |         if (krAnswer.formToken) {143 |           onSuccess(krAnswer.formToken);144 |         } else {145 |           throw new Error('No se pudo obtener el token de pago');146 |         }147 |       } else {148 |         throw new Error('Respuesta inválida del procesador de pagos');149 |       }150 |     } catch (error: unknown) {151 |       let errorMessage = 'Error al procesar el pago';152 | 153 |       if (error instanceof Error && error.message) {154 |         errorMessage = error.message;155 |       } else if (typeof error === 'object' && error !== null && 'errorMessage' in error) {156 |         errorMessage = String((error as Record<string, unknown>).errorMessage);157 |       } else if (typeof error === 'string') {158 |         errorMessage = error;159 |       }160 | 161 |       setFormError(errorMessage);162 |       onError(errorMessage);163 |     } finally {164 |       setIsSubmitting(false);165 |     }166 |   };167 | 168 |   const formatAmount = (amountInCents: number, currency: string) => {169 |     const amount = amountInCents / 100;170 |     return new Intl.NumberFormat('es-PE', {171 |       style: 'currency',172 |       currency: currency,173 |       minimumFractionDigits: 2,174 |     }).format(amount);175 |   };176 | 177 |   return (178 |     <div className="w-full max-w-md mx-auto">179 |       {}180 |       <Script181 |         src="https:182 |         onLoad={() => setIsIzipayReady(true)}183 |         onError={() => {184 |           onError('Error al cargar el procesador de pagos');185 |         }}186 |       />187 | 188 |       {}189 |       <div className="mb-6 text-center">190 |         <div className="flex items-center justify-center mb-2">191 |           <CreditCard className="h-8 w-8 text-blue-600 mr-2" />192 |           <h3 className="text-xl font-semibold text-gray-900">Pago con Izipay</h3>193 |         </div>194 |         <p className="text-sm text-gray-600">195 |           Pago seguro con tarjeta de crédito o débito196 |         </p>197 |         <div className="mt-2 p-3 bg-blue-50 rounded-lg">198 |           <p className="text-lg font-bold text-blue-900">199 |             {formatAmount(amountInCents, currency)}200 |           </p>201 |         </div>202 |       </div>203 | 204 |       {}205 |       <div className="flex items-center justify-center mb-4">206 |         <Shield className="h-4 w-4 text-green-600 mr-2" />207 |         <span className="text-sm text-green-600 font-medium">208 |           Transacción protegida con encriptación SSL209 |         </span>210 |       </div>211 | 212 |       {}213 |       <form onSubmit={handleSubmit} className="space-y-4">214 |         <div className="kr-form">215 |           {}216 |           <div className="mb-4">217 |             <label className="block text-sm font-medium text-gray-700 mb-2">218 |               Número de tarjeta219 |             </label>220 |             <div className="kr-pan"></div>221 |           </div>222 | 223 |           {}224 |           <div className="grid grid-cols-2 gap-4 mb-4">225 |             <div>226 |               <label className="block text-sm font-medium text-gray-700 mb-2">227 |                 Fecha de vencimiento228 |               </label>229 |               <div className="kr-expiry"></div>230 |             </div>231 |             <div>232 |               <label className="block text-sm font-medium text-gray-700 mb-2">233 |                 CVV234 |               </label>235 |               <div className="kr-security-code"></div>236 |             </div>237 |           </div>238 | 239 |           {}240 |           <div className="kr-form-error"></div>241 | 242 |           {}243 |           {formError && (244 |             <div className="flex items-center p-3 bg-red-50 border border-red-200 rounded-lg mb-4">245 |               <AlertCircle className="h-4 w-4 text-red-600 mr-2" />246 |               <span className="text-sm text-red-600">{formError}</span>247 |             </div>248 |           )}249 | 250 |           {}251 |           <Button252 |             type="submit"253 |             className="kr-payment-button w-full"254 |             disabled={!isIzipayReady || isSubmitting}255 |           >256 |             {isSubmitting ? (257 |               <>258 |                 <Loader2 className="h-4 w-4 mr-2 animate-spin" />259 |                 Procesando...260 |               </>261 |             ) : (262 |               <>263 |                 <CreditCard className="h-4 w-4 mr-2" />264 |                 Pagar {formatAmount(amountInCents, currency)}265 |               </>266 |             )}267 |           </Button>268 |         </div>269 |       </form>270 | 271 |       {}272 |       <div className="mt-6 text-center">273 |         <p className="text-xs text-gray-500 mb-2">Tarjetas aceptadas:</p>274 |         <div className="flex justify-center space-x-2">275 |           <div className="w-8 h-5 bg-blue-600 rounded text-white text-xs flex items-center justify-center font-bold">276 |             V277 |           </div>278 |           <div className="w-8 h-5 bg-red-600 rounded text-white text-xs flex items-center justify-center font-bold">279 |             M280 |           </div>281 |           <div className="w-8 h-5 bg-green-600 rounded text-white text-xs flex items-center justify-center font-bold">282 |             A283 |           </div>284 |           <div className="w-8 h-5 bg-orange-600 rounded text-white text-xs flex items-center justify-center font-bold">285 |             D286 |           </div>287 |         </div>288 |       </div>289 | 290 |       {}291 |       {!isIzipayReady && (292 |         <div className="text-center py-8">293 |           <Loader2 className="h-8 w-8 animate-spin mx-auto mb-2 text-blue-600" />294 |           <p className="text-sm text-gray-600">Cargando formulario de pago...</p>295 |         </div>296 |       )}297 |     </div>298 |   );299 | };300 | 301 | export default IzipayForm;
============================================================END: frontend/components/izipay/IzipayForm.tsx============================================================


============================================================FILE: frontend/components/izipay/IzipayInlineForm.tsxSIZE: 9.00 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect, useRef, useCallback } from 'react';  4 | import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Loader2, CreditCard, AlertCircle, CheckCircle } from 'lucide-react';  7 | import { Alert, AlertDescription } from '@/components/ui/alert';  8 |   9 | interface IzipayInlineFormProps { 10 |   amount: number; 11 |   currency?: string; 12 |   customerEmail: string; 13 |   customerName?: string; 14 |   description?: string; 15 |   packagePriceId?: number; 16 |   quantity?: number; 17 |   metadata?: Record<string, unknown>; 18 |   onSuccess?: (result: Record<string, unknown>) => void; 19 |   onError?: (error: string) => void; 20 |   onCancel?: () => void; 21 |   className?: string; 22 | } 23 |  24 | declare global { 25 |   interface Window { 26 |     KR: { 27 |       init: (publicKey: string) => void; 28 |       setFormConfig: (config: Record<string, unknown>) => void; 29 |       createToken: () => Promise<{ 'kr-answer': string }>; 30 |       addForm: (selector: string) => void; 31 |       on: (event: string, callback: (event: Record<string, unknown>) => void) => void; 32 |     }; 33 |   } 34 | } 35 |  36 | export function IzipayInlineForm({ 37 |   amount, 38 |   currency = 'PEN', 39 |   customerEmail, 40 |   customerName, 41 |   description, 42 |   packagePriceId, 43 |   quantity = 1, 44 |   metadata = {}, 45 |   onSuccess, 46 |   onError, 47 |   onCancel, 48 |   className = '', 49 | }: IzipayInlineFormProps) { 50 |   const [isLoading, setIsLoading] = useState(false); 51 |   const [error, setError] = useState<string | null>(null); 52 |  53 |   const [paymentStatus, setPaymentStatus] = useState<'idle' | 'processing' | 'success' | 'error' | 'valid' | 'invalid' | 'completed' | 'failed'>('idle'); 54 |   const formRef = useRef<HTMLDivElement>(null); 55 |  56 |   useEffect(() => { 57 |     const loadIzipaySDK = () => { 58 |       if (window.KR) { 59 |         return Promise.resolve(); 60 |       } 61 |  62 |       return new Promise((resolve, reject) => { 63 |         const script = document.createElement('script'); 64 |         script.src = 'https: 65 |         script.onload = resolve; 66 |         script.onerror = reject; 67 |         document.head.appendChild(script); 68 |       }); 69 |     }; 70 |  71 |     loadIzipaySDK().catch(() => { 72 |       setError('Failed to load payment form'); 73 |     }); 74 |   }, []); 75 |  76 |   const initializePaymentForm = useCallback((token: string) => { 77 |     if (!window.KR || !formRef.current) { 78 |       return; 79 |     } 80 |  81 |     try { 82 |  83 |       window.KR.setFormConfig({ 84 |         'kr-public-key': process.env.NEXT_PUBLIC_IZIPAY_PUBLIC_KEY, 85 |         'kr-form-token': token, 86 |       }); 87 |  88 |       window.KR.addForm('#izipay-payment-form'); 89 |  90 |       window.KR!.on('kr-error', (event: Record<string, unknown>) => { 91 |         setPaymentStatus('error'); 92 |         const errorMessage = (event?.error as Record<string, unknown>)?.message || 'Payment form error'; 93 |         setError(String(errorMessage)); 94 |         if (onError) { 95 |           onError(String(errorMessage)); 96 |         } 97 |       }); 98 |  99 |       window.KR!.on('kr-form-valid', () => {100 |         setPaymentStatus('valid');101 |       });102 | 103 |       window.KR!.on('kr-form-invalid', () => {104 |         setPaymentStatus('invalid');105 |       });106 | 107 |       window.KR!.on('kr-payment-completed', (event: Record<string, unknown>) => {108 |         setPaymentStatus('completed');109 |         if (onSuccess) {110 |           onSuccess(event);111 |         }112 |       });113 | 114 |       window.KR!.on('kr-payment-failed', (event: Record<string, unknown>) => {115 |         setPaymentStatus('failed');116 |         const errorMessage = (event?.error as Record<string, unknown>)?.message || 'Payment failed';117 |         setError(String(errorMessage));118 |         if (onError) {119 |           onError(String(errorMessage));120 |         }121 |       });122 | 123 |     } catch (error) {124 |       setError('Failed to initialize payment form');125 |       if (onError) {126 |         onError('Failed to initialize payment form');127 |       }128 |     }129 |   }, [onError, onSuccess]);130 | 131 |   const createFormToken = useCallback(async () => {132 |     try {133 |       setIsLoading(true);134 |       setError(null);135 | 136 |       const paymentRequest = {137 |         amount,138 |         currency: currency.toUpperCase(),139 |         customerEmail,140 |         customerName,141 |         description,142 |         packagePriceId,143 |         quantity,144 |         metadata,145 |       };146 | 147 |       const response = await fetch('/api/izipay/create-payment-intent', {148 |         method: 'POST',149 |         headers: {150 |           'Content-Type': 'application/json',151 |         },152 |         body: JSON.stringify(paymentRequest),153 |       });154 | 155 |       const result = await response.json();156 | 157 |       if (!response.ok || !result.success) {158 |         throw new Error(result.message || result.error || 'Failed to create payment form');159 |       }160 | 161 |       setTimeout(() => {162 |         initializePaymentForm(result.transactionId);163 |       }, 100);164 | 165 |     } catch (error) {166 |       const errorMessage = error instanceof Error ? error.message : 'Failed to create payment form';167 |       setError(errorMessage);168 | 169 |       if (onError) {170 |         onError(errorMessage);171 |       }172 |     } finally {173 |       setIsLoading(false);174 |     }175 |   }, [customerEmail, amount, currency, customerName, description, initializePaymentForm, metadata, onError, packagePriceId, quantity]);176 | 177 |   useEffect(() => {178 |     if (customerEmail && amount > 0) {179 |       createFormToken();180 |     }181 |   }, [customerEmail, amount, currency, createFormToken]);182 | 183 |   const formatAmount = (amount: number, currency: string) => {184 |     const formatter = new Intl.NumberFormat('es-PE', {185 |       style: 'currency',186 |       currency: currency,187 |       minimumFractionDigits: 2,188 |     });189 |     return formatter.format(amount);190 |   };191 | 192 |   if (isLoading) {193 |     return (194 |       <Card className={className}>195 |         <CardContent className="flex items-center justify-center p-8">196 |           <div className="text-center space-y-4">197 |             <Loader2 className="h-8 w-8 animate-spin mx-auto" />198 |             <p>Cargando formulario de pago...</p>199 |           </div>200 |         </CardContent>201 |       </Card>202 |     );203 |   }204 | 205 |   if (error) {206 |     return (207 |       <Card className={className}>208 |         <CardContent className="p-6">209 |           <Alert variant="destructive">210 |             <AlertCircle className="h-4 w-4" />211 |             <AlertDescription>{error}</AlertDescription>212 |           </Alert>213 |           <Button214 |             onClick={createFormToken}215 |             className="w-full mt-4"216 |             variant="outline"217 |           >218 |             Reintentar219 |           </Button>220 |         </CardContent>221 |       </Card>222 |     );223 |   }224 | 225 |   if (paymentStatus === 'success') {226 |     return (227 |       <Card className={className}>228 |         <CardContent className="flex items-center justify-center p-8">229 |           <div className="text-center space-y-4">230 |             <CheckCircle className="h-12 w-12 text-green-500 mx-auto" />231 |             <h3 className="text-lg font-semibold text-green-700">¡Pago Exitoso!</h3>232 |             <p className="text-gray-600">Tu pago ha sido procesado correctamente.</p>233 |           </div>234 |         </CardContent>235 |       </Card>236 |     );237 |   }238 | 239 |   return (240 |     <Card className={className}>241 |       <CardHeader>242 |         <CardTitle className="flex items-center">243 |           <CreditCard className="mr-2 h-5 w-5" />244 |           Pago con Izipay245 |         </CardTitle>246 |         <CardDescription>247 |           Total a pagar: <span className="font-semibold">{formatAmount(amount, currency)}</span>248 |         </CardDescription>249 |       </CardHeader>250 |       <CardContent>251 |         {paymentStatus === 'processing' && (252 |           <div className="mb-4">253 |             <Alert>254 |               <Loader2 className="h-4 w-4 animate-spin" />255 |               <AlertDescription>Procesando tu pago...</AlertDescription>256 |             </Alert>257 |           </div>258 |         )}259 | 260 |         <div261 |           ref={formRef}262 |           id="izipay-payment-form"263 |           className="min-h-[400px]"264 |         >265 |           {}266 |         </div>267 | 268 |         <div className="mt-4 text-center text-sm text-gray-500">269 |           <p>Pago seguro con Izipay</p>270 |           <p>Acepta Visa, Mastercard, American Express y Diners Club</p>271 |         </div>272 | 273 |         {onCancel && (274 |           <Button275 |             onClick={onCancel}276 |             variant="outline"277 |             className="w-full mt-4"278 |           >279 |             Cancelar280 |           </Button>281 |         )}282 |       </CardContent>283 |     </Card>284 |   );285 | }286 | 287 | export default IzipayInlineForm;
============================================================END: frontend/components/izipay/IzipayInlineForm.tsx============================================================


============================================================FILE: frontend/components/izipay/IzipayPaymentButton.tsxSIZE: 4.13 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { Button } from '@/components/ui/button';  5 | import { Loader2, CreditCard, AlertCircle } from 'lucide-react';  6 | import { Alert, AlertDescription } from '@/components/ui/alert';  7 |   8 | interface IzipayPaymentButtonProps {  9 |   amount: number; 10 |   currency?: string; 11 |   customerEmail: string; 12 |   customerName?: string; 13 |   description?: string; 14 |   packagePriceId?: number; 15 |   quantity?: number; 16 |   metadata?: Record<string, unknown>; 17 |   onSuccess?: (result: Record<string, unknown>) => void; 18 |   onError?: (error: string) => void; 19 |   onCancel?: () => void; 20 |   disabled?: boolean; 21 |   className?: string; 22 |   children?: React.ReactNode; 23 | } 24 |  25 | export function IzipayPaymentButton({ 26 |   amount, 27 |   currency = 'PEN', 28 |   customerEmail, 29 |   customerName, 30 |   description, 31 |   packagePriceId, 32 |   quantity = 1, 33 |   metadata = {}, 34 |   onSuccess, 35 |   onError, 36 |   disabled = false, 37 |   className = '', 38 |   children, 39 | }: IzipayPaymentButtonProps) { 40 |   const [isLoading, setIsLoading] = useState(false); 41 |   const [error, setError] = useState<string | null>(null); 42 |  43 |   const handlePayment = async () => { 44 |     try { 45 |       setIsLoading(true); 46 |       setError(null); 47 |  48 |       if (!amount || amount <= 0) { 49 |         throw new Error('Invalid amount'); 50 |       } 51 |  52 |       if (!customerEmail) { 53 |         throw new Error('Customer email is required'); 54 |       } 55 |  56 |       const paymentRequest = { 57 |         amount, 58 |         currency: currency.toUpperCase(), 59 |         customerEmail, 60 |         customerName, 61 |         description, 62 |         packagePriceId, 63 |         quantity, 64 |         metadata, 65 |       }; 66 |  67 |       const response = await fetch('/api/izipay/create-payment-intent', { 68 |         method: 'POST', 69 |         headers: { 70 |           'Content-Type': 'application/json', 71 |         }, 72 |         body: JSON.stringify(paymentRequest), 73 |       }); 74 |  75 |       const result = await response.json(); 76 |  77 |       if (!response.ok || !result.success) { 78 |         throw new Error(result.message || result.error || 'Failed to create payment intent'); 79 |       } 80 |  81 |       if (result.paymentUrl) { 82 |         window.location.href = result.paymentUrl; 83 |       } else { 84 |         throw new Error('No payment URL received'); 85 |       } 86 |  87 |       if (onSuccess) { 88 |         onSuccess(result); 89 |       } 90 |  91 |     } catch (error) { 92 |       const errorMessage = error instanceof Error ? error.message : 'Payment failed'; 93 |       setError(errorMessage); 94 |  95 |       if (onError) { 96 |         onError(errorMessage); 97 |       } 98 |     } finally { 99 |       setIsLoading(false);100 |     }101 |   };102 | 103 |   const formatAmount = (amount: number, currency: string) => {104 |     const formatter = new Intl.NumberFormat('es-PE', {105 |       style: 'currency',106 |       currency: currency,107 |       minimumFractionDigits: 2,108 |     });109 |     return formatter.format(amount);110 |   };111 | 112 |   return (113 |     <div className="space-y-4">114 |       {error && (115 |         <Alert variant="destructive">116 |           <AlertCircle className="h-4 w-4" />117 |           <AlertDescription>{error}</AlertDescription>118 |         </Alert>119 |       )}120 | 121 |       <Button122 |         onClick={handlePayment}123 |         disabled={disabled || isLoading}124 |         className={`w-full ${className}`}125 |         size="lg"126 |       >127 |         {isLoading ? (128 |           <>129 |             <Loader2 className="mr-2 h-4 w-4 animate-spin" />130 |             Procesando...131 |           </>132 |         ) : (133 |           <>134 |             <CreditCard className="mr-2 h-4 w-4" />135 |             {children || `Pagar ${formatAmount(amount, currency)} con Izipay`}136 |           </>137 |         )}138 |       </Button>139 | 140 |       <div className="text-center text-sm text-gray-500">141 |         <p>Pago seguro con Izipay</p>142 |         <p>Acepta Visa, Mastercard, American Express y Diners Club</p>143 |       </div>144 |     </div>145 |   );146 | }147 | 148 | export default IzipayPaymentButton;
============================================================END: frontend/components/izipay/IzipayPaymentButton.tsx============================================================


============================================================FILE: frontend/components/izipay/IzipayPaymentMethod.tsxSIZE: 6.94 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { Card, CardContent } from '@/components/ui/card';  5 | import { Button } from '@/components/ui/button';  6 | import { Badge } from '@/components/ui/badge';  7 | import { CreditCard, Shield, Clock } from 'lucide-react';  8 | import IzipayPaymentButton from './IzipayPaymentButton';  9 | import IzipayInlineForm from './IzipayInlineForm'; 10 |  11 | interface IzipayPaymentMethodProps { 12 |   amount: number; 13 |   currency?: string; 14 |   customerEmail: string; 15 |   customerName?: string; 16 |   description?: string; 17 |   packagePriceId?: number; 18 |   quantity?: number; 19 |   metadata?: Record<string, unknown>; 20 |   onSuccess?: (result: Record<string, unknown>) => void; 21 |   onError?: (error: string) => void; 22 |   onCancel?: () => void; 23 |   variant?: 'button' | 'inline' | 'card'; 24 |   showFeatures?: boolean; 25 |   className?: string; 26 | } 27 |  28 | export function IzipayPaymentMethod({ 29 |   amount, 30 |   currency = 'PEN', 31 |   customerEmail, 32 |   customerName, 33 |   description, 34 |   packagePriceId, 35 |   quantity = 1, 36 |   metadata = {}, 37 |   onSuccess, 38 |   onError, 39 |   onCancel, 40 |   variant = 'card', 41 |   showFeatures = true, 42 |   className = '', 43 | }: IzipayPaymentMethodProps) { 44 |   const [selectedPaymentType, setSelectedPaymentType] = useState<'redirect' | 'inline'>('redirect'); 45 |  46 |   const formatAmount = (amount: number, currency: string) => { 47 |     const formatter = new Intl.NumberFormat('es-PE', { 48 |       style: 'currency', 49 |       currency: currency, 50 |       minimumFractionDigits: 2, 51 |     }); 52 |     return formatter.format(amount); 53 |   }; 54 |  55 |   const features = [ 56 |     { 57 |       icon: Shield, 58 |       title: 'Pago Seguro', 59 |       description: 'Protección 3D Secure y tokenización', 60 |     }, 61 |     { 62 |       icon: CreditCard, 63 |       title: 'Múltiples Tarjetas', 64 |       description: 'Visa, Mastercard, American Express, Diners', 65 |     }, 66 |     { 67 |       icon: Clock, 68 |       title: 'Procesamiento Rápido', 69 |       description: 'Confirmación inmediata del pago', 70 |     }, 71 |   ]; 72 |  73 |   if (variant === 'button') { 74 |     return ( 75 |       <div className={className}> 76 |         <IzipayPaymentButton 77 |           amount={amount} 78 |           currency={currency} 79 |           customerEmail={customerEmail} 80 |           customerName={customerName} 81 |           description={description} 82 |           packagePriceId={packagePriceId} 83 |           quantity={quantity} 84 |           metadata={metadata} 85 |           onSuccess={onSuccess} 86 |           onError={onError} 87 |           onCancel={onCancel} 88 |         /> 89 |       </div> 90 |     ); 91 |   } 92 |  93 |   if (variant === 'inline') { 94 |     return ( 95 |       <div className={className}> 96 |         <IzipayInlineForm 97 |           amount={amount} 98 |           currency={currency} 99 |           customerEmail={customerEmail}100 |           customerName={customerName}101 |           description={description}102 |           packagePriceId={packagePriceId}103 |           quantity={quantity}104 |           metadata={metadata}105 |           onSuccess={onSuccess}106 |           onError={onError}107 |           onCancel={onCancel}108 |         />109 |       </div>110 |     );111 |   }112 | 113 |   return (114 |     <Card className={`${className} border-2 hover:border-blue-200 transition-colors`}>115 |       <CardContent className="p-6">116 |         {}117 |         <div className="flex items-center justify-between mb-4">118 |           <div className="flex items-center space-x-3">119 |             <div className="p-2 bg-blue-100 rounded-lg">120 |               <CreditCard className="h-6 w-6 text-blue-600" />121 |             </div>122 |             <div>123 |               <h3 className="font-semibold text-lg">Izipay</h3>124 |               <p className="text-sm text-gray-600">Pago con tarjeta de crédito/débito</p>125 |             </div>126 |           </div>127 |           <Badge variant="secondary" className="bg-green-100 text-green-700">128 |             Perú129 |           </Badge>130 |         </div>131 | 132 |         {}133 |         <div className="mb-4 p-3 bg-gray-50 rounded-lg">134 |           <div className="flex justify-between items-center">135 |             <span className="text-sm text-gray-600">Total a pagar:</span>136 |             <span className="font-bold text-lg">{formatAmount(amount, currency)}</span>137 |           </div>138 |         </div>139 | 140 |         {}141 |         {showFeatures && (142 |           <div className="mb-6 space-y-3">143 |             {features.map((feature, index) => (144 |               <div key={index} className="flex items-start space-x-3">145 |                 <feature.icon className="h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0" />146 |                 <div>147 |                   <p className="text-sm font-medium">{feature.title}</p>148 |                   <p className="text-xs text-gray-600">{feature.description}</p>149 |                 </div>150 |               </div>151 |             ))}152 |           </div>153 |         )}154 | 155 |         {}156 |         <div className="mb-4">157 |           <p className="text-sm font-medium mb-2">Tipo de pago:</p>158 |           <div className="flex space-x-2">159 |             <Button160 |               variant={selectedPaymentType === 'redirect' ? 'default' : 'outline'}161 |               size="sm"162 |               onClick={() => setSelectedPaymentType('redirect')}163 |               className="flex-1"164 |             >165 |               Página de Pago166 |             </Button>167 |             <Button168 |               variant={selectedPaymentType === 'inline' ? 'default' : 'outline'}169 |               size="sm"170 |               onClick={() => setSelectedPaymentType('inline')}171 |               className="flex-1"172 |             >173 |               Formulario Integrado174 |             </Button>175 |           </div>176 |         </div>177 | 178 |         {}179 |         {selectedPaymentType === 'redirect' ? (180 |           <IzipayPaymentButton181 |             amount={amount}182 |             currency={currency}183 |             customerEmail={customerEmail}184 |             customerName={customerName}185 |             description={description}186 |             packagePriceId={packagePriceId}187 |             quantity={quantity}188 |             metadata={metadata}189 |             onSuccess={onSuccess}190 |             onError={onError}191 |             onCancel={onCancel}192 |             className="w-full"193 |           />194 |         ) : (195 |           <div className="border rounded-lg p-4 bg-gray-50">196 |             <p className="text-sm text-gray-600 mb-3">197 |               El formulario de pago se mostrará aquí para completar la transacción.198 |             </p>199 |             <Button200 |               onClick={() => {201 | 202 |                 }}203 |               className="w-full"204 |               variant="outline"205 |             >206 |               Cargar Formulario de Pago207 |             </Button>208 |           </div>209 |         )}210 | 211 |         {}212 |         <div className="mt-4 pt-4 border-t border-gray-200">213 |           <div className="flex items-center justify-between text-xs text-gray-500">214 |             <span>Powered by Izipay</span>215 |             <span>Procesamiento seguro</span>216 |           </div>217 |         </div>218 |       </CardContent>219 |     </Card>220 |   );221 | }222 | 223 | export default IzipayPaymentMethod;
============================================================END: frontend/components/izipay/IzipayPaymentMethod.tsx============================================================


============================================================FILE: frontend/components/modals/CreateBookingModal.tsxSIZE: 18.39 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 |   5 | import {  6 |   Calendar,  7 |   Package,  8 |   Clock,  9 |   X, 10 |   Save, 11 |   DollarSign 12 | } from 'lucide-react'; 13 | import { BaseModal } from '@/components/ui/BaseModal'; 14 | import { BaseButton } from '@/components/ui/BaseButton'; 15 | import { BaseInput } from '@/components/ui/BaseInput'; 16 | import { Label } from '@/components/ui/label'; 17 | import { Textarea } from '@/components/ui/textarea'; 18 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 19 | import { Badge } from '@/components/ui/badge'; 20 | import { toast } from 'sonner'; 21 |  22 | interface Client { 23 |   id: string; 24 |   fullName: string; 25 |   email: string; 26 |   phone?: string; 27 |   status: string; 28 | } 29 |  30 | interface UserPackage { 31 |   id: number; 32 |   sessions_remaining: number; 33 |   sessions_used: number; 34 |   is_active: boolean; 35 |   package_definition: { 36 |     id: number; 37 |     name: string; 38 |     description: string; 39 |     sessions_count: number; 40 |     package_type: 'individual' | 'group' | 'mixed'; 41 |     max_group_size: number; 42 |     session_durations: { 43 |       id: number; 44 |       name: string; 45 |       duration_minutes: number; 46 |     }; 47 |   }; 48 |   package_price: { 49 |     id: number; 50 |     price: number; 51 |     pricing_mode: 'custom' | 'calculated'; 52 |     currencies: { 53 |       id: number; 54 |       code: string; 55 |       name: string; 56 |       symbol: string; 57 |     }; 58 |   }; 59 | } 60 |  61 | interface ScheduleSlot { 62 |   id: number; 63 |   start_time: string; 64 |   end_time: string; 65 |   capacity: number; 66 |   booked_count: number; 67 |   is_available: boolean; 68 |   schedule_templates: { 69 |     id: number; 70 |     day_of_week: string; 71 |     start_time: string; 72 |     end_time: string; 73 |     session_durations: { 74 |       id: number; 75 |       name: string; 76 |       duration_minutes: number; 77 |     }; 78 |   }; 79 | } 80 |  81 | interface CreateBookingModalProps { 82 |   isOpen: boolean; 83 |   onClose: () => void; 84 |   client: Client; 85 |   onSuccess: () => void; 86 | } 87 |  88 | const CreateBookingModal: React.FC<CreateBookingModalProps> = ({ 89 |   isOpen, 90 |   onClose, 91 |   client, 92 |   onSuccess 93 | }) => { 94 |  95 |   const [loading, setLoading] = useState(false); 96 |   const [step, setStep] = useState(1); 97 |  98 |   const [formData, setFormData] = useState({ 99 |     user_package_id: '',100 |     schedule_slot_id: '',101 |     booking_type: 'individual' as 'individual' | 'group',102 |     group_size: 1,103 |     notes: '',104 |     total_amount: '',105 |     discount_amount: '0'106 |   });107 | 108 |   const [userPackages, setUserPackages] = useState<UserPackage[]>([]);109 |   const [scheduleSlots, setScheduleSlots] = useState<ScheduleSlot[]>([]);110 |   const [selectedPackage, setSelectedPackage] = useState<UserPackage | null>(null);111 | 112 |   useEffect(() => {113 |     if (isOpen) {114 | 115 |       loadUserPackages();116 |       loadScheduleSlots();117 |     }118 |   }, [isOpen]);119 | 120 |   const loadUserPackages = async () => {121 | 122 |     const mockPackages: UserPackage[] = [123 |       {124 |         id: 1,125 |         sessions_remaining: 5,126 |         sessions_used: 2,127 |         is_active: true,128 |         package_definition: {129 |           id: 1,130 |           name: 'Individual Therapy Package',131 |           description: '10 sessions of individual therapy',132 |           sessions_count: 10,133 |           package_type: 'individual',134 |           max_group_size: 1,135 |           session_durations: {136 |             id: 1,137 |             name: 'Standard Session',138 |             duration_minutes: 60139 |           }140 |         },141 |         package_price: {142 |           id: 1,143 |           price: 1200,144 |           pricing_mode: 'custom',145 |           currencies: {146 |             id: 1,147 |             code: 'USD',148 |             name: 'US Dollar',149 |             symbol: '$'150 |           }151 |         }152 |       }153 |     ];154 |     setUserPackages(mockPackages);155 |   };156 | 157 |   const loadScheduleSlots = async () => {158 | 159 |     const mockSlots: ScheduleSlot[] = [160 |       {161 |         id: 1,162 |         start_time: '09:00',163 |         end_time: '10:00',164 |         capacity: 1,165 |         booked_count: 0,166 |         is_available: true,167 |         schedule_templates: {168 |           id: 1,169 |           day_of_week: 'Monday',170 |           start_time: '09:00',171 |           end_time: '10:00',172 |           session_durations: {173 |             id: 1,174 |             name: 'Standard Session',175 |             duration_minutes: 60176 |           }177 |         }178 |       }179 |     ];180 |     setScheduleSlots(mockSlots);181 |   };182 | 183 |   const handlePackageSelect = (packageId: string) => {184 |     setFormData(prev => ({ ...prev, user_package_id: packageId }));185 |     const pkg = userPackages.find(p => p.id.toString() === packageId);186 |     setSelectedPackage(pkg || null);187 |   };188 | 189 |   const handleSlotSelect = (slotId: string) => {190 |     setFormData(prev => ({ ...prev, schedule_slot_id: slotId }));191 |   };192 | 193 |   const handleNext = () => {194 |     if (step === 1 && !formData.user_package_id) {195 |       toast.error('Please select a package');196 |       return;197 |     }198 |     if (step === 2 && !formData.schedule_slot_id) {199 |       toast.error('Please select a time slot');200 |       return;201 |     }202 |     setStep(prev => Math.min(prev + 1, 3));203 |   };204 | 205 |   const handleBack = () => {206 |     setStep(prev => Math.max(prev - 1, 1));207 |   };208 | 209 |   const handleSubmit = async () => {210 |     if (!formData.user_package_id || !formData.schedule_slot_id) {211 |       toast.error('Please complete all required fields');212 |       return;213 |     }214 | 215 |     setLoading(true);216 |     try {217 | 218 |       await new Promise(resolve => setTimeout(resolve, 1000));219 | 220 |       toast.success('Booking created successfully!');221 |       onSuccess();222 |       handleClose();223 |     } catch {224 |       toast.error('Failed to create booking');225 |     } finally {226 |       setLoading(false);227 |     }228 |   };229 | 230 |   const handleClose = () => {231 |     setStep(1);232 |     setFormData({233 |       user_package_id: '',234 |       schedule_slot_id: '',235 |       booking_type: 'individual',236 |       group_size: 1,237 |       notes: '',238 |       total_amount: '',239 |       discount_amount: '0'240 |     });241 |     setSelectedPackage(null);242 |     onClose();243 |   };244 | 245 |   const getPackageTypeBadge = (type: string) => {246 |     const variants = {247 |       individual: `bg-[#E0F2FE] text-[#007BFF]`,248 |       group: `bg-[#FFF3CD] text-[#FFC107]`,249 |       mixed: `bg-[#FFF3CD] text-[#FFC107]`250 |     };251 |     return <Badge className={variants[type as keyof typeof variants]}>{type}</Badge>;252 |   };253 | 254 |   return (255 |     <BaseModal256 |       isOpen={isOpen}257 |       onClose={handleClose}258 |       title="Create New Booking"259 |               description={`Create a new booking for ${client.fullName} (${client.email})`}260 |       size="full"261 |       variant="default"262 |     >263 |       <BaseModal.Header icon={<Calendar className="w-5 h-5" />}>264 |         <div className="flex items-center gap-2">265 |           <Calendar className={`w-5 h-5 text-[#007BFF]`} />266 |           <h3 className={`text-[1.125rem] font-[500] text-[#1F2937]`}>267 |             Create New Booking268 |           </h3>269 |         </div>270 |       </BaseModal.Header>271 | 272 |       <BaseModal.Content>273 |         <div className="space-y-[1rem]">274 |           {}275 |           {step === 1 && (276 |             <div className="space-y-[0.5rem]">277 |               <div className="flex items-center gap-2">278 |                 <div className="w-8 h-8 bg-[#E0F2FE] text-[#007BFF] rounded-full flex items-center justify-center text-[0.75rem] font-[500]">279 |                   1280 |                 </div>281 |                 <h3 className={`text-[1.125rem] font-[600] text-[#1F2937]`}>282 |                   Select Package283 |                 </h3>284 |               </div>285 | 286 |               {userPackages.length === 0 ? (287 |                 <div className="text-center py-8">288 |                   <Package className={`w-12 h-12 text-[#9CA3AF] mx-auto mb-[0.5rem]`} />289 |                   <p className={`text-[#6B7280]`}>No active packages found for this client</p>290 |                   <p className={`text-[0.75rem] text-[#9CA3AF] mt-[0.25rem]`}>291 |                     The client needs to purchase a package first292 |                   </p>293 |                 </div>294 |               ) : (295 |                 <div className="grid gap-4">296 |                   {userPackages.map((pkg) => (297 |                     <div298 |                       key={pkg.id}299 |                       className={`p-[0.5rem] border rounded-[0.5rem] cursor-pointer transition-all hover:border-[#90CDF4] hover:bg-[#EBF8FF] ${300 |                         formData.user_package_id === pkg.id.toString()301 |                           ? `border-[#63B3ED] bg-[#EBF8FF]`302 |                           : `border-[#E2E8F0]`303 |                       }`}304 |                       onClick={() => handlePackageSelect(pkg.id.toString())}305 |                     >306 |                       <div className="flex items-start justify-between">307 |                         <div className="flex-1">308 |                           <div className="flex items-center gap-2 mb-2">309 |                             <h4 className={`font-[600] text-[#1F2937]`}>310 |                               {pkg.package_definition.name}311 |                             </h4>312 |                             {getPackageTypeBadge(pkg.package_definition.package_type)}313 |                           </div>314 |                           <p className={`text-[0.75rem] text-[#6B7280] mb-[0.25rem]`}>315 |                             {pkg.package_definition.description}316 |                           </p>317 |                           <div className="flex items-center gap-[0.5rem] text-[0.75rem] text-[#9CA3AF]">318 |                             <span className="flex items-center gap-1">319 |                               <Clock className="w-4 h-4" />320 |                               {pkg.package_definition.session_durations.duration_minutes} min321 |                             </span>322 |                             <span className="flex items-center gap-1">323 |                               <Package className="w-4 h-4" />324 |                               {pkg.sessions_remaining} of {pkg.package_definition.sessions_count} remaining325 |                             </span>326 |                             <span className="flex items-center gap-1">327 |                               <DollarSign className="w-4 h-4" />328 |                               {pkg.package_price.currencies.symbol}{pkg.package_price.price}329 |                             </span>330 |                           </div>331 |                         </div>332 |                         <div className="text-right">333 |                           <Badge className={pkg.is_active ? `bg-[#4CAF50] text-white` : `bg-[#F44336] text-white`}>334 |                             {pkg.is_active ? 'Active' : 'Inactive'}335 |                           </Badge>336 |                         </div>337 |                       </div>338 |                     </div>339 |                   ))}340 |                 </div>341 |               )}342 |             </div>343 |           )}344 | 345 |           {}346 |           {step === 2 && (347 |             <div className="space-y-[0.5rem]">348 |               <div className="flex items-center gap-2">349 |                 <div className="w-8 h-8 bg-[#E0F2FE] text-[#007BFF] rounded-full flex items-center justify-center text-[0.75rem] font-[500]">350 |                   2351 |                 </div>352 |                 <h3 className={`text-[1.125rem] font-[600] text-[#1F2937]`}>353 |                   Select Time Slot354 |                 </h3>355 |               </div>356 | 357 |               {selectedPackage && (358 |                 <div className="mb-[0.5rem] p-[0.375rem] bg-[#EBF8FF] border border-[#90CDF4] rounded-[0.5rem]">359 |                   <p className={`text-[0.75rem] text-[#4299E1]`}>360 |                     <strong>Selected Package:</strong> {selectedPackage.package_definition.name}361 |                     ({selectedPackage.package_definition.session_durations.duration_minutes} min)362 |                   </p>363 |                 </div>364 |               )}365 | 366 |               {scheduleSlots.length === 0 ? (367 |                 <div className="text-center py-8">368 |                   <Clock className={`w-12 h-12 text-[#9CA3AF] mx-auto mb-[0.5rem]`} />369 |                   <p className={`text-[#6B7280]`}>No available time slots found</p>370 |                   <p className={`text-[0.75rem] text-[#9CA3AF] mt-[0.25rem]`}>371 |                     Please try a different date or contact support372 |                   </p>373 |                 </div>374 |               ) : (375 |                 <div className="grid gap-4">376 |                   {scheduleSlots.map((slot) => (377 |                     <div378 |                       key={slot.id}379 |                       className={`p-[0.5rem] border rounded-[0.5rem] cursor-pointer transition-all hover:border-[#90CDF4] hover:bg-[#EBF8FF] ${380 |                         formData.schedule_slot_id === slot.id.toString()381 |                           ? `border-[#63B3ED] bg-[#EBF8FF]`382 |                           : `border-[#E2E8F0]`383 |                       }`}384 |                       onClick={() => handleSlotSelect(slot.id.toString())}385 |                     >386 |                       <div className="flex items-center justify-between">387 |                         <div className="flex items-center gap-4">388 |                           <div className="text-lg font-semibold">389 |                             {slot.start_time} - {slot.end_time}390 |                           </div>391 |                           <div className={`text-[0.75rem] text-[#6B7280]`}>392 |                             {slot.schedule_templates.day_of_week}393 |                           </div>394 |                         </div>395 |                         <div className="text-right">396 |                           <Badge className={`bg-[#4CAF50] text-white`}>397 |                             Available398 |                           </Badge>399 |                         </div>400 |                       </div>401 |                     </div>402 |                   ))}403 |                 </div>404 |               )}405 |             </div>406 |           )}407 | 408 |           {}409 |           {step === 3 && (410 |             <div className="space-y-[0.5rem]">411 |               <div className="flex items-center gap-2">412 |                 <div className="w-8 h-8 bg-[#E0F2FE] text-[#007BFF] rounded-full flex items-center justify-center text-[0.75rem] font-[500]">413 |                   3414 |                 </div>415 |                 <h3 className={`text-[1.125rem] font-[600] text-[#1F2937]`}>416 |                   Booking Details417 |                 </h3>418 |               </div>419 | 420 |               <div className="grid grid-cols-2 gap-[0.5rem]">421 |                 <div className="space-y-[0.25rem]">422 |                   <Label className={`text-[0.75rem] font-[500] text-[#6B7280]`}>423 |                     Booking Type424 |                   </Label>425 |                   <Select426 |                     value={formData.booking_type}427 |                     onValueChange={(value) => setFormData(prev => ({ ...prev, booking_type: value as 'individual' | 'group' }))}428 |                   >429 |                     <SelectTrigger className={`bg-[#F9FAFB] border-[#D1D5DB] text-[#1F2937]`}>430 |                       <SelectValue />431 |                     </SelectTrigger>432 |                     <SelectContent className={`bg-[#F9FAFB] border-[#D1D5DB]`}>433 |                       <SelectItem value="individual" className={`text-[#1F2937] hover:bg-[#F4F6F8]`}>434 |                         Individual435 |                       </SelectItem>436 |                       <SelectItem value="group" className={`text-[#1F2937] hover:bg-[#F4F6F8]`}>437 |                         Group438 |                       </SelectItem>439 |                     </SelectContent>440 |                   </Select>441 |                 </div>442 | 443 |                 {formData.booking_type === 'group' && (444 |                   <div className="space-y-[0.25rem]">445 |                     <Label className={`text-[0.75rem] font-[500] text-[#6B7280]`}>446 |                       Group Size447 |                     </Label>448 |                     <BaseInput449 |                       type="number"450 |                       min="2"451 |                       max="10"452 |                       value={formData.group_size.toString()}453 |                       onChange={(e) => setFormData(prev => ({ ...prev, group_size: parseInt(e.target.value) || 1 }))}454 |                     />455 |                   </div>456 |                 )}457 |               </div>458 | 459 |               <div className="space-y-[0.25rem]">460 |                 <Label className={`text-[0.75rem] font-[500] text-[#6B7280]`}>461 |                   Notes (Optional)462 |                 </Label>463 |                 <Textarea464 |                   placeholder="Add any special requirements or notes..."465 |                   value={formData.notes}466 |                   onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}467 |                   className={`bg-[#F9FAFB] border-[#D1D5DB] text-[#1F2937] placeholder:text-[#9CA3AF]`}468 |                   rows={3}469 |                 />470 |               </div>471 | 472 |               {selectedPackage && (473 |                 <div className="p-[0.5rem] bg-[#F9FAFB] rounded-[0.5rem] border border-[#D1D5DB]">474 |                   <h4 className="text-sm font-medium text-white mb-2">475 |                     Booking Summary476 |                   </h4>477 |                   <div className="space-y-2 text-sm text-gray-300">478 |                     <div className="flex items-center gap-2">479 |                       <Package className="w-4 h-4" />480 |                       <span>{selectedPackage.package_definition.name}</span>481 |                     </div>482 |                     <div className="flex items-center gap-2">483 |                       <Clock className="w-4 h-4" />484 |                       <span>{selectedPackage.package_definition.session_durations.duration_minutes} minutes</span>485 |                     </div>486 |                     <div className="flex items-center gap-2">487 |                       <DollarSign className="w-4 h-4" />488 |                       <span>{selectedPackage.package_price.currencies.symbol}{selectedPackage.package_price.price}</span>489 |                     </div>490 |                   </div>491 |                 </div>492 |               )}493 |             </div>494 |           )}495 |         </div>496 |       </BaseModal.Content>497 | 498 |       <BaseModal.Footer>499 |         <div className="flex items-center justify-between w-full">500 |           <BaseButton501 |             variant="outline"502 |             onClick={handleBack}503 |             disabled={step === 1}504 |             leftIcon={<X className="w-4 h-4" />}505 |           >506 |             Back507 |           </BaseButton>508 | 509 |           <div className="flex gap-2">510 |             <BaseButton511 |               variant="outline"512 |               onClick={handleClose}513 |             >514 |               Cancel515 |             </BaseButton>516 | 517 |             {step < 3 ? (518 |               <BaseButton519 |                 variant="primary"520 |                 onClick={handleNext}521 |                 rightIcon={<Save className="w-4 h-4" />}522 |               >523 |                 Next524 |               </BaseButton>525 |             ) : (526 |               <BaseButton527 |                 variant="primary"528 |                 onClick={handleSubmit}529 |                 loading={loading}530 |                 leftIcon={<Save className="w-4 h-4" />}531 |               >532 |                 Create Booking533 |               </BaseButton>534 |             )}535 |           </div>536 |         </div>537 |       </BaseModal.Footer>538 |     </BaseModal>539 |   );540 | };541 | 542 | export default CreateBookingModal;
============================================================END: frontend/components/modals/CreateBookingModal.tsx============================================================


============================================================FILE: frontend/components/modals/DeleteConfirmationModal.tsxSIZE: 2.83 KB============================================================
  1 | 'use client';  2 |   3 | import React from 'react';  4 | import { Package, DollarSign, Calendar } from 'lucide-react';  5 | import { ConfirmationModal } from '@/components/ui/BaseModal';  6 |   7 | interface DeleteConfirmationModalProps {  8 |   isOpen: boolean;  9 |   onClose: () => void; 10 |   onConfirm: () => void; 11 |   title: string; 12 |   description: string; 13 |   itemName?: string; 14 |   itemType: 'definition' | 'price' | 'template' | 'slot' | 'booking'; 15 |   isLoading?: boolean; 16 | } 17 |  18 | const DeleteConfirmationModal: React.FC<DeleteConfirmationModalProps> = ({ 19 |   isOpen, 20 |   onClose, 21 |   onConfirm, 22 |   title, 23 |   description, 24 |   itemName, 25 |   itemType, 26 |   isLoading = false 27 | }) => { 28 |   const getIcon = () => { 29 |     switch (itemType) { 30 |       case 'definition': 31 |         return <Package className="w-5 h-5" />; 32 |       case 'price': 33 |         return <DollarSign className="w-5 h-5" />; 34 |       case 'template': 35 |       case 'slot': 36 |         return <Calendar className="w-5 h-5" />; 37 |       case 'booking': 38 |         return <Calendar className="w-5 h-5" />; 39 |       default: 40 |         return <Package className="w-5 h-5" />; 41 |     } 42 |   }; 43 |  44 |   const getItemTypeText = () => { 45 |     switch (itemType) { 46 |       case 'definition': 47 |         return 'package definition'; 48 |       case 'price': 49 |         return 'package price'; 50 |       case 'template': 51 |         return 'schedule template'; 52 |       case 'slot': 53 |         return 'schedule slot'; 54 |       case 'booking': 55 |         return 'booking'; 56 |       default: 57 |         return 'item'; 58 |     } 59 |   }; 60 |  61 |   const getWarningMessage = () => { 62 |     const baseMessage = `Deleting this ${getItemTypeText()} will permanently remove it from the system.`; 63 |  64 |     switch (itemType) { 65 |       case 'definition': 66 |         return `${baseMessage} All associated prices will also be deleted.`; 67 |       case 'price': 68 |         return `${baseMessage} This may affect existing user packages.`; 69 |       case 'template': 70 |         return `${baseMessage} All associated schedule slots will also be deleted.`; 71 |       case 'slot': 72 |         return `${baseMessage} This may affect existing bookings.`; 73 |       case 'booking': 74 |         return `${baseMessage} This will restore the session to the user package.`; 75 |       default: 76 |         return baseMessage; 77 |     } 78 |   }; 79 |  80 |   return ( 81 |     <ConfirmationModal 82 |       isOpen={isOpen} 83 |       onClose={onClose} 84 |       onConfirm={onConfirm} 85 |       title={title} 86 |       description={description} 87 |       confirmText={isLoading ? 'Deleting...' : 'Delete'} 88 |       cancelText="Cancel" 89 |       variant="danger" 90 |       icon={getIcon()} 91 |       isLoading={isLoading} 92 |     > 93 |       <div className="space-y-2"> 94 |         {itemName && ( 95 |           <p className="font-medium"> 96 |             &ldquo;{itemName}&rdquo; 97 |           </p> 98 |         )} 99 |         <p className="text-sm">100 |           {getWarningMessage()}101 |         </p>102 |         <p className="text-sm font-medium">103 |           This action cannot be undone.104 |         </p>105 |       </div>106 |     </ConfirmationModal>107 |   );108 | };109 | 110 | export default DeleteConfirmationModal;
============================================================END: frontend/components/modals/DeleteConfirmationModal.tsx============================================================


============================================================FILE: frontend/components/modals/PackageDefinitionModal.tsxSIZE: 12.97 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { Package, Users, Clock, Save, X } from 'lucide-react';  5 | import { BaseModal } from '@/components/ui/BaseModal';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { BaseButton } from '@/components/ui/BaseButton';  8 | import { Label } from '@/components/ui/label';  9 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 10 | import { Switch } from '@/components/ui/switch'; 11 | import { Textarea } from '@/components/ui/textarea'; 12 |  13 | interface SessionDuration { 14 |   id: number; 15 |   name: string; 16 |   duration_minutes: number; 17 |   description: string; 18 |   isActive: boolean; 19 | } 20 |  21 | interface PackageDefinition { 22 |   id: number; 23 |   name: string; 24 |   description: string; 25 |   sessionsCount: number; 26 |   sessionDurationId: number; 27 |   packageType: 'individual' | 'group' | 'mixed'; 28 |   maxGroupSize: number | null; 29 |   isActive: boolean; 30 |   createdAt: string; 31 |   updatedAt: string; 32 |   sessionDuration: SessionDuration; 33 | } 34 |  35 | interface PackageDefinitionModalProps { 36 |   isOpen: boolean; 37 |   onClose: () => void; 38 |   onSubmit: (data: Record<string, unknown>) => void; 39 |   packageDefinition?: PackageDefinition | null; 40 |   sessionDurations: SessionDuration[]; 41 |   mode: 'create' | 'edit'; 42 | } 43 |  44 | const PackageDefinitionModal: React.FC<PackageDefinitionModalProps> = ({ 45 |   isOpen, 46 |   onClose, 47 |   onSubmit, 48 |   packageDefinition, 49 |   sessionDurations, 50 |   mode 51 | }) => { 52 |   const [formData, setFormData] = useState({ 53 |     name: '', 54 |     description: '', 55 |     sessionsCount: '', 56 |     sessionDurationId: '', 57 |     packageType: 'individual' as 'individual' | 'group' | 'mixed', 58 |     maxGroupSize: '', 59 |     isActive: true 60 |   }); 61 |  62 |   const [errors, setErrors] = useState<Record<string, string>>({}); 63 |  64 |   useEffect(() => { 65 |     if (packageDefinition && mode === 'edit') { 66 |  67 |       setFormData({ 68 |         name: packageDefinition.name || '', 69 |         description: packageDefinition.description || '', 70 |         sessionsCount: (packageDefinition.sessionsCount !== null && packageDefinition.sessionsCount !== undefined) 71 |           ? packageDefinition.sessionsCount.toString() 72 |           : '', 73 |         sessionDurationId: (packageDefinition.sessionDurationId !== null && packageDefinition.sessionDurationId !== undefined) 74 |           ? packageDefinition.sessionDurationId.toString() 75 |           : '', 76 |         packageType: packageDefinition.packageType || 'individual', 77 |         maxGroupSize: (packageDefinition.maxGroupSize !== null && packageDefinition.maxGroupSize !== undefined) 78 |           ? packageDefinition.maxGroupSize.toString() 79 |           : '', 80 |         isActive: packageDefinition.isActive ?? true 81 |       }); 82 |     } else { 83 |       resetForm(); 84 |     } 85 |   }, [packageDefinition, mode]); 86 |  87 |   const resetForm = () => { 88 |     setFormData({ 89 |       name: '', 90 |       description: '', 91 |       sessionsCount: '', 92 |       sessionDurationId: '', 93 |       packageType: 'individual', 94 |       maxGroupSize: '', 95 |       isActive: true 96 |     }); 97 |     setErrors({}); 98 |   }; 99 | 100 |   const validateForm = () => {101 |     const newErrors: Record<string, string> = {};102 | 103 |     if (!formData.name.trim()) {104 |       newErrors.name = 'Package name is required';105 |     }106 | 107 |     if (!formData.sessionsCount || parseInt(formData.sessionsCount) <= 0) {108 |       newErrors.sessionsCount = 'Sessions count must be a positive number';109 |     }110 | 111 |     if (!formData.sessionDurationId) {112 |       newErrors.sessionDurationId = 'Session duration is required';113 |     }114 | 115 |     if (formData.packageType === 'group' && (!formData.maxGroupSize || parseInt(formData.maxGroupSize) <= 1)) {116 |       newErrors.maxGroupSize = 'Group size must be greater than 1 for group packages';117 |     }118 | 119 |     if (formData.packageType === 'mixed' && (!formData.maxGroupSize || parseInt(formData.maxGroupSize) <= 1)) {120 |       newErrors.maxGroupSize = 'Group size must be greater than 1 for mixed packages';121 |     }122 | 123 |     setErrors(newErrors);124 |     return Object.keys(newErrors).length === 0;125 |   };126 | 127 |   const handleSubmit = (e: React.FormEvent) => {128 |     e.preventDefault();129 |     if (validateForm()) {130 |       const submitData = {131 |         ...formData,132 |         sessionsCount: parseInt(formData.sessionsCount),133 |         sessionDurationId: parseInt(formData.sessionDurationId),134 |         maxGroupSize: formData.maxGroupSize ? parseInt(formData.maxGroupSize) : null135 |       };136 |       try {137 |         onSubmit(submitData);138 |         } catch (error) {139 |         }140 |     } else {141 |       }142 |   };143 | 144 |   const handleClose = () => {145 |     resetForm();146 |     onClose();147 |   };148 | 149 |   return (150 |     <BaseModal151 |       isOpen={isOpen}152 |       onClose={handleClose}153 |       title={mode === 'create' ? 'Create Package Definition' : 'Edit Package Definition'}154 |       description="Define package settings and configuration"155 |       size="lg"156 |       variant="default"157 |     >158 |       <BaseModal.Header icon={<Package className="w-5 h-5 text-[var(--color-accent-500)]" />}>159 |         <h3 className="text-[var(--font-size-lg)] font-[var(--font-weight-medium)] text-[var(--color-text-primary)]">160 |           {mode === 'create' ? 'Create New Package Definition' : 'Edit Package Definition'}161 |         </h3>162 |       </BaseModal.Header>163 | 164 |       <BaseModal.Content>165 |         <form onSubmit={handleSubmit} className="space-y-6">166 |           {}167 |           <div className="space-y-2">168 |             <Label htmlFor="name">Package Name</Label>169 |             <BaseInput170 |               id="name"171 |               value={formData.name}172 |               onChange={(e) => setFormData({ ...formData, name: e.target.value })}173 |               placeholder="Enter package name"174 |               required175 |             />176 |             {errors.name && (177 |               <p className="text-[var(--color-status-error)] text-[var(--font-size-sm)]">178 |                 {errors.name}179 |               </p>180 |             )}181 |           </div>182 | 183 |           {}184 |           <div className="space-y-2">185 |             <Label className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-[var(--color-text-secondary)]">186 |               Package Type187 |             </Label>188 |             <Select189 |               value={formData.packageType}190 |               onValueChange={(value: 'individual' | 'group' | 'mixed') =>191 |                 setFormData({ ...formData, packageType: value })192 |               }193 |             >194 |               <SelectTrigger className="bg-[var(--color-surface-primary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]">195 |                 <SelectValue placeholder="Select package type" />196 |               </SelectTrigger>197 |               <SelectContent className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)]">198 |                 <SelectItem value="individual" className="text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)]">199 |                   <div className="flex items-center gap-2">200 |                     <Users className="w-4 h-4" />201 |                     Individual Sessions202 |                   </div>203 |                 </SelectItem>204 |                 <SelectItem value="group" className="text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)]">205 |                   <div className="flex items-center gap-2">206 |                     <Users className="w-4 h-4" />207 |                     Group Sessions208 |                   </div>209 |                 </SelectItem>210 |                 <SelectItem value="mixed" className="text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)]">211 |                   <div className="flex items-center gap-2">212 |                     <Users className="w-4 h-4" />213 |                     Mixed (Individual + Group)214 |                   </div>215 |                 </SelectItem>216 |               </SelectContent>217 |             </Select>218 |           </div>219 | 220 |           {}221 |           {(formData.packageType === 'group' || formData.packageType === 'mixed') && (222 |             <div className="space-y-2">223 |               <Label className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-[var(--color-text-secondary)]">224 |                 Maximum Group Size225 |               </Label>226 |               <BaseInput227 |                 type="number"228 |                 min="2"229 |                 value={formData.maxGroupSize}230 |                 onChange={(e) => setFormData({ ...formData, maxGroupSize: e.target.value })}231 |                 placeholder="Enter maximum group size"232 |                 required233 |               />234 |               {errors.maxGroupSize && (235 |                 <p className="text-[var(--color-status-error)] text-[var(--font-size-sm)]">236 |                   {errors.maxGroupSize}237 |                 </p>238 |               )}239 |             </div>240 |           )}241 | 242 |           {}243 |           <div className="space-y-2">244 |             <Label className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-[var(--color-text-secondary)]">245 |               Session Duration246 |             </Label>247 |             <Select248 |               value={formData.sessionDurationId}249 |               onValueChange={(value) => setFormData({ ...formData, sessionDurationId: value })}250 |             >251 |               <SelectTrigger className="bg-[var(--color-surface-primary)] border-[var(--color-border-500)] text-[var(--color-text-primary)]">252 |                 <SelectValue placeholder="Select session duration" />253 |               </SelectTrigger>254 |               <SelectContent className="bg-[var(--color-surface-secondary)] border-[var(--color-border-500)]">255 |                 {sessionDurations.map((duration) => (256 |                   <SelectItem key={duration.id} value={duration.id.toString()} className="text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)]">257 |                     <div className="flex items-center gap-2">258 |                       <Clock className="w-4 h-4" />259 |                       {duration.name} ({duration.duration_minutes} min)260 |                     </div>261 |                   </SelectItem>262 |                 ))}263 |               </SelectContent>264 |             </Select>265 |             {errors.sessionDurationId && (266 |               <p className="text-[var(--color-status-error)] text-[var(--font-size-sm)]">267 |                 {errors.sessionDurationId}268 |               </p>269 |             )}270 |           </div>271 | 272 |           {}273 |           <div className="space-y-2">274 |             <Label className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-[var(--color-text-secondary)]">275 |               Number of Sessions276 |             </Label>277 |             <BaseInput278 |               type="number"279 |               min="1"280 |               value={formData.sessionsCount}281 |               onChange={(e) => setFormData({ ...formData, sessionsCount: e.target.value })}282 |               placeholder="Enter number of sessions"283 |               required284 |             />285 |             {errors.sessionsCount && (286 |               <p className="text-[var(--color-status-error)] text-[var(--font-size-sm)]">287 |                 {errors.sessionsCount}288 |               </p>289 |             )}290 |           </div>291 | 292 |           {}293 |           <div className="space-y-2">294 |             <Label htmlFor="description">Description</Label>295 |             <Textarea296 |               id="description"297 |               value={formData.description}298 |               onChange={(e) => setFormData({ ...formData, description: e.target.value })}299 |               placeholder="Enter package description (optional)"300 |               className="bg-[var(--color-surface-primary)] border-[var(--color-border-500)] text-[var(--color-text-primary)] placeholder:text-[var(--color-text-tertiary)]"301 |               rows={3}302 |             />303 |           </div>304 | 305 |           {}306 |           <div className="flex items-center space-x-2">307 |             <Switch308 |               id="isActive"309 |               checked={formData.isActive}310 |               onCheckedChange={(checked) => setFormData({ ...formData, isActive: checked })}311 |             />312 |             <Label htmlFor="isActive" className="text-[var(--font-size-sm)] font-[var(--font-weight-medium)] text-[var(--color-text-secondary)]">313 |               Active Package314 |             </Label>315 |           </div>316 |         </form>317 |       </BaseModal.Content>318 | 319 |       <BaseModal.Footer>320 |         <div className="flex justify-end space-x-3">321 |           <BaseButton322 |             variant="outline"323 |             onClick={handleClose}324 |             leftIcon={<X className="w-4 h-4" />}325 |           >326 |             Cancel327 |           </BaseButton>328 | 329 |           <BaseButton330 |             variant="primary"331 |             onClick={handleSubmit}332 |             leftIcon={<Save className="w-4 h-4" />}333 |           >334 |             {mode === 'create' ? 'Create Package' : 'Update Package'}335 |           </BaseButton>336 |         </div>337 |       </BaseModal.Footer>338 |     </BaseModal>339 |   );340 | };341 | 342 | export default PackageDefinitionModal;
============================================================END: frontend/components/modals/PackageDefinitionModal.tsx============================================================


============================================================FILE: frontend/components/modals/PackagePriceModal.tsxSIZE: 14.02 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { BaseModal } from '@/components/ui/BaseModal';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { Label } from '@/components/ui/label';  8 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  9 | import { Switch } from '@/components/ui/switch'; 10 | import { Badge } from '@/components/ui/badge'; 11 | import { DollarSign, Calculator, Globe, Save, X, Package } from 'lucide-react'; 12 |  13 | interface Currency { 14 |   id: number; 15 |   code: string; 16 |   name: string; 17 |   symbol: string; 18 |   isDefault: boolean; 19 |   exchangeRate: number; 20 | } 21 |  22 | interface PackageDefinition { 23 |   id: number; 24 |   name: string; 25 |   sessionsCount: number; 26 |   packageType: 'individual' | 'group' | 'mixed'; 27 |   maxGroupSize: number | null; 28 | } 29 |  30 | interface PackagePrice { 31 |   id: number; 32 |   packageDefinitionId: number; 33 |   currencyId: number; 34 |   price: number; 35 |   pricingMode: 'custom' | 'calculated'; 36 |   isActive: boolean; 37 |   packageDefinition: PackageDefinition; 38 |   currency: Currency; 39 | } 40 |  41 | interface PackagePriceModalProps { 42 |   isOpen: boolean; 43 |   onClose: () => void; 44 |   onSubmit: (data: Record<string, unknown>) => void; 45 |   packagePrice?: PackagePrice | null; 46 |   packageDefinitions: PackageDefinition[]; 47 |   currencies: Currency[]; 48 |   mode: 'create' | 'edit'; 49 | } 50 |  51 | const PackagePriceModal: React.FC<PackagePriceModalProps> = ({ 52 |   isOpen, 53 |   onClose, 54 |   onSubmit, 55 |   packagePrice, 56 |   packageDefinitions, 57 |   currencies, 58 |   mode 59 | }) => { 60 |   const [formData, setFormData] = useState({ 61 |     packageDefinitionId: '', 62 |     currencyId: '', 63 |     price: '', 64 |     pricingMode: 'calculated' as 'custom' | 'calculated', 65 |     isActive: true 66 |   }); 67 |  68 |   const [errors, setErrors] = useState<Record<string, string>>({}); 69 |  70 |   const [calculatedPrice, setCalculatedPrice] = useState<number | null>(null); 71 |   const [exchangeRate, setExchangeRate] = useState<number | null>(null); 72 |  73 |   useEffect(() => { 74 |     if (packagePrice && mode === 'edit') { 75 |       setFormData({ 76 |         packageDefinitionId: (packagePrice.packageDefinitionId !== null && packagePrice.packageDefinitionId !== undefined) 77 |           ? packagePrice.packageDefinitionId.toString() 78 |           : '', 79 |         currencyId: (packagePrice.currencyId !== null && packagePrice.currencyId !== undefined) 80 |           ? packagePrice.currencyId.toString() 81 |           : '', 82 |         price: (packagePrice.price !== null && packagePrice.price !== undefined) 83 |           ? packagePrice.price.toString() 84 |           : '', 85 |         pricingMode: packagePrice.pricingMode || 'calculated', 86 |         isActive: packagePrice.isActive ?? true 87 |       }); 88 |     } else { 89 |       resetForm(); 90 |     } 91 |   }, [packagePrice, mode]); 92 |  93 |   useEffect(() => { 94 |     if (formData.packageDefinitionId && formData.currencyId && formData.pricingMode === 'calculated') { 95 |       calculatePrice(); 96 |     } 97 |   }, [formData.packageDefinitionId, formData.currencyId, formData.pricingMode]); 98 |  99 |   const resetForm = () => {100 |     setFormData({101 |       packageDefinitionId: '',102 |       currencyId: '',103 |       price: '',104 |       pricingMode: 'calculated',105 |       isActive: true106 |     });107 |     setErrors({});108 | 109 |     setCalculatedPrice(null);110 |     setExchangeRate(null);111 |   };112 | 113 |   const calculatePrice = () => {114 | 115 |     setCalculatedPrice(99.99);116 |   };117 | 118 |   const handlePricingModeChange = (mode: 'custom' | 'calculated') => {119 |     setFormData(prev => ({ ...prev, pricingMode: mode }));120 |     if (mode === 'calculated') {121 |       setFormData(prev => ({ ...prev, price: '' }));122 |     }123 |   };124 | 125 |   const validateForm = () => {126 |     const newErrors: Record<string, string> = {};127 | 128 |     if (!formData.packageDefinitionId) {129 |       newErrors.packageDefinitionId = 'Package definition is required';130 |     }131 | 132 |     if (!formData.currencyId) {133 |       newErrors.currencyId = 'Currency is required';134 |     }135 | 136 |     if (formData.pricingMode === 'custom' && !formData.price) {137 |       newErrors.price = 'Price is required for custom pricing';138 |     }139 | 140 |     if (formData.price && parseFloat(formData.price) <= 0) {141 |       newErrors.price = 'Price must be greater than 0';142 |     }143 | 144 |     setErrors(newErrors);145 |     return Object.keys(newErrors).length === 0;146 |   };147 | 148 |   const handleSubmit = (e: React.FormEvent) => {149 |     e.preventDefault();150 |     if (!validateForm()) {151 |       return;152 |     }153 | 154 |     const submitData = {155 |       ...formData,156 |       price: formData.pricingMode === 'calculated' ? calculatedPrice : parseFloat(formData.price)157 |     };158 | 159 |     try {160 |       onSubmit(submitData);161 |       } catch (error) {162 |       }163 |   };164 | 165 |   const handleClose = () => {166 |     resetForm();167 |     onClose();168 |   };169 | 170 |   const selectedPackage = packageDefinitions.find(p => p.id.toString() === formData.packageDefinitionId);171 |   const selectedCurrency = currencies.find(c => c.id.toString() === formData.currencyId);172 | 173 |   return (174 |     <BaseModal175 |       isOpen={isOpen}176 |       onClose={handleClose}177 |       title={mode === 'create' ? 'Create New Price' : 'Edit Package Price'}178 |       description={mode === 'create'179 |         ? 'Set pricing for a package in a specific currency'180 |         : 'Update the package pricing configuration'181 |       }182 |       size="xl"183 |       variant="default"184 |     >185 |       <BaseModal.Header icon={<DollarSign className="w-5 h-5" />}>186 |         <div className="flex items-center gap-2">187 |           <DollarSign className="w-5 h-5 text-yellow-500" />188 |           <h3 className="text-lg font-medium text-white">189 |             {mode === 'create' ? 'Create New Price' : 'Edit Package Price'}190 |           </h3>191 |         </div>192 |       </BaseModal.Header>193 | 194 |       <BaseModal.Content>195 |         <form onSubmit={handleSubmit} className="space-y-6">196 |           <div className="grid grid-cols-2 gap-4">197 |             <div className="space-y-2">198 |               <Label className="text-sm font-medium text-gray-300">199 |                 Package Definition *200 |               </Label>201 |               <Select202 |                 value={formData.packageDefinitionId}203 |                 onValueChange={(value) => setFormData(prev => ({ ...prev, packageDefinitionId: value }))}204 |               >205 |                 <SelectTrigger className="bg-gray-800 border-gray-600 text-white">206 |                   <SelectValue placeholder="Select package" />207 |                 </SelectTrigger>208 |                 <SelectContent className="bg-gray-700 border-gray-600">209 |                   {packageDefinitions.map((pkg) => (210 |                     <SelectItem key={pkg.id} value={pkg.id.toString()} className="text-white hover:bg-gray-600">211 |                       <div className="flex items-center gap-2">212 |                         <Package className="w-4 h-4" />213 |                         {pkg.name} ({pkg.sessionsCount} sessions)214 |                       </div>215 |                     </SelectItem>216 |                   ))}217 |                 </SelectContent>218 |               </Select>219 |               {errors.packageDefinitionId && (220 |                 <p className="text-red-500 text-sm">221 |                   {errors.packageDefinitionId}222 |                 </p>223 |               )}224 |             </div>225 | 226 |             <div className="space-y-2">227 |               <Label className="text-sm font-medium text-gray-300">228 |                 Currency *229 |               </Label>230 |               <Select231 |                 value={formData.currencyId}232 |                 onValueChange={(value) => setFormData(prev => ({ ...prev, currencyId: value }))}233 |               >234 |                 <SelectTrigger className="bg-gray-800 border-gray-600 text-white">235 |                   <SelectValue placeholder="Select currency" />236 |                 </SelectTrigger>237 |                 <SelectContent className="bg-gray-700 border-gray-600">238 |                   {currencies.map((currency) => (239 |                     <SelectItem key={currency.id} value={currency.id.toString()} className="text-white hover:bg-gray-600">240 |                       <div className="flex items-center gap-2">241 |                         <Globe className="w-4 h-4" />242 |                         {currency.code} - {currency.name}243 |                         {currency.isDefault && (244 |                           <Badge className="bg-blue-500 text-white">245 |                             Default246 |                           </Badge>247 |                         )}248 |                       </div>249 |                     </SelectItem>250 |                   ))}251 |                 </SelectContent>252 |               </Select>253 |               {errors.currencyId && (254 |                 <p className="text-red-500 text-sm">255 |                   {errors.currencyId}256 |                 </p>257 |               )}258 |             </div>259 |           </div>260 | 261 |           <div className="space-y-4">262 |             <div className="space-y-2">263 |               <Label className="text-sm font-medium text-gray-300">264 |                 Pricing Mode *265 |               </Label>266 |               <div className="flex gap-4">267 |                 <div className="flex items-center space-x-2">268 |                   <input269 |                     type="radio"270 |                     id="calculated"271 |                     name="pricingMode"272 |                     value="calculated"273 |                     checked={formData.pricingMode === 'calculated'}274 |                     onChange={() => handlePricingModeChange('calculated')}275 |                     className="rounded-full border-gray-600 bg-gray-800"276 |                   />277 |                   <Label htmlFor="calculated" className="text-sm font-medium text-gray-300 cursor-pointer">278 |                     <div className="flex items-center gap-2">279 |                       <Calculator className="w-4 h-4" />280 |                       Calculated (from Exchange Rate)281 |                     </div>282 |                   </Label>283 |                 </div>284 |                 <div className="flex items-center space-x-2">285 |                   <input286 |                     type="radio"287 |                     id="custom"288 |                     name="pricingMode"289 |                     value="custom"290 |                     checked={formData.pricingMode === 'custom'}291 |                     onChange={() => handlePricingModeChange('custom')}292 |                     className="rounded-full border-gray-600 bg-gray-800"293 |                   />294 |                   <Label htmlFor="custom" className="text-sm font-medium text-gray-300 cursor-pointer">295 |                     <div className="flex items-center gap-2">296 |                       <DollarSign className="w-4 h-4" />297 |                       Custom Price298 |                     </div>299 |                   </Label>300 |                 </div>301 |               </div>302 |             </div>303 | 304 |             {formData.pricingMode === 'custom' && (305 |               <div className="space-y-2">306 |                 <Label className="text-sm font-medium text-gray-300">307 |                   Custom Price *308 |                 </Label>309 |                 <BaseInput310 |                   type="number"311 |                   step="0.01"312 |                   min="0"313 |                   placeholder="0.00"314 |                   value={formData.price}315 |                   onChange={(e) => setFormData(prev => ({ ...prev, price: e.target.value }))}316 |                   variant={errors.price ? 'error' : 'default'}317 |                   error={errors.price}318 |                 />319 |               </div>320 |             )}321 | 322 |             {formData.pricingMode === 'calculated' && calculatedPrice && (323 |               <div className="p-4 bg-gray-800 rounded-md border border-gray-600">324 |                 <div className="flex items-center justify-between">325 |                   <span className="text-sm text-gray-300">326 |                     Calculated Price:327 |                   </span>328 |                   <span className="text-lg font-bold text-white">329 |                     {selectedCurrency?.symbol} {calculatedPrice}330 |                   </span>331 |                 </div>332 |                 {exchangeRate && (333 |                   <div className="text-xs text-gray-400 mt-1">334 |                     Exchange Rate: 1 USD = {exchangeRate} {selectedCurrency?.code}335 |                   </div>336 |                 )}337 |               </div>338 |             )}339 |           </div>340 | 341 |           <div className="flex items-center space-x-2">342 |             <Switch343 |               id="isActive"344 |               checked={formData.isActive}345 |               onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isActive: checked }))}346 |             />347 |             <Label htmlFor="isActive" className="text-sm font-medium text-gray-300">348 |               Active Price349 |             </Label>350 |           </div>351 | 352 |           {selectedPackage && selectedCurrency && (353 |             <div className="p-4 bg-gray-800 rounded-md border border-gray-600">354 |               <h4 className="text-sm font-medium text-white mb-2">355 |                 Package Summary356 |               </h4>357 |               <div className="space-y-2 text-sm text-gray-300">358 |                 <div className="flex items-center gap-2">359 |                   <Package className="w-4 h-4" />360 |                   <span>{selectedPackage.name}</span>361 |                 </div>362 |                 <div className="flex items-center gap-2">363 |                   <Calculator className="w-4 h-4" />364 |                   <span>{selectedPackage.sessionsCount} sessions</span>365 |                 </div>366 |                 <div className="flex items-center gap-2">367 |                   <Globe className="w-4 h-4" />368 |                   <span>{selectedCurrency.code} - {selectedCurrency.name}</span>369 |                 </div>370 |               </div>371 |             </div>372 |           )}373 |         </form>374 |       </BaseModal.Content>375 | 376 |       <BaseModal.Footer>377 |         <BaseButton378 |           variant="outline"379 |           onClick={handleClose}380 |           leftIcon={<X className="w-4 h-4" />}381 |         >382 |           Cancel383 |         </BaseButton>384 |         <BaseButton385 |           variant="primary"386 |           onClick={handleSubmit}387 |           leftIcon={<Save className="w-4 h-4" />}388 |         >389 |           {mode === 'create' ? 'Create Price' : 'Update Price'}390 |         </BaseButton>391 |       </BaseModal.Footer>392 |     </BaseModal>393 |   );394 | };395 | 396 | export default PackagePriceModal;
============================================================END: frontend/components/modals/PackagePriceModal.tsx============================================================


============================================================FILE: frontend/components/modals/PhoneVerificationModal.tsxSIZE: 14.16 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { motion, AnimatePresence } from 'framer-motion';  5 | import { X, Phone, ArrowLeft, CheckCircle, AlertCircle, Loader2 } from 'lucide-react';  6 | import { useToast } from '../cms/Toast';  7 |   8 | interface Country {  9 |   code: string; 10 |   name: string; 11 |   flag: string; 12 |   prefix: string; 13 |   example: string; 14 | } 15 |  16 | interface UserData { 17 |   id?: string; 18 |   email?: string; 19 |   fullName?: string; 20 |   phone?: string; 21 |   birthDate?: string; 22 |   birthTime?: string; 23 |   birthPlace?: string; 24 |   language?: string; 25 |   status?: string; 26 | } 27 |  28 | interface PhoneVerificationModalProps { 29 |   isOpen: boolean; 30 |   onClose: () => void; 31 |   onVerificationSuccess: (userData: UserData, isExistingCustomer: boolean) => void; 32 | } 33 |  34 | const countries: Country[] = [ 35 |   { code: 'US', name: 'United States', flag: '🇺🇸', prefix: '+1', example: '5551234567' }, 36 |   { code: 'CO', name: 'Colombia', flag: '🇨🇴', prefix: '+57', example: '3001234567' }, 37 |   { code: 'MX', name: 'Mexico', flag: '🇲🇽', prefix: '+52', example: '5512345678' }, 38 |   { code: 'ES', name: 'Spain', flag: '🇪🇸', prefix: '+34', example: '612345678' }, 39 |   { code: 'CA', name: 'Canada', flag: '🇨🇦', prefix: '+1', example: '5551234567' }, 40 |   { code: 'BR', name: 'Brazil', flag: '🇧🇷', prefix: '+55', example: '11987654321' }, 41 |   { code: 'AR', name: 'Argentina', flag: '🇦🇷', prefix: '+54', example: '91123456789' }, 42 |   { code: 'CL', name: 'Chile', flag: '🇨🇱', prefix: '+56', example: '912345678' }, 43 |   { code: 'PE', name: 'Peru', flag: '🇵🇪', prefix: '+51', example: '912345678' }, 44 | ]; 45 |  46 | export function PhoneVerificationModal({ 47 |   isOpen, 48 |   onClose, 49 |   onVerificationSuccess 50 | }: PhoneVerificationModalProps) { 51 |   const [step, setStep] = useState<'phone' | 'otp'>('phone'); 52 |   const [selectedCountry, setSelectedCountry] = useState<Country>(countries[0]); 53 |   const [phoneNumber, setPhoneNumber] = useState(''); 54 |   const [otpCode, setOtpCode] = useState(''); 55 |   const [isLoading, setIsLoading] = useState(false); 56 |   const [error, setError] = useState(''); 57 |   const [, setOtpSent] = useState(false); 58 |   const [timeRemaining, setTimeRemaining] = useState(0); 59 |   const toast = useToast(); 60 |  61 |   useEffect(() => { 62 |     let interval: NodeJS.Timeout; 63 |     if (timeRemaining > 0) { 64 |       interval = setInterval(() => { 65 |         setTimeRemaining(prev => prev - 1); 66 |       }, 1000); 67 |     } 68 |     return () => clearInterval(interval); 69 |   }, [timeRemaining]); 70 |  71 |   const handleSendOtp = async () => { 72 |     if (!phoneNumber.trim()) { 73 |       setError('Please enter your phone number'); 74 |       return; 75 |     } 76 |  77 |     const cleanNumber = phoneNumber.trim().replace(/\D/g, ''); 78 |     if (cleanNumber.length < 7 || cleanNumber.length > 15) { 79 |       setError('Phone number must be between 7 and 15 digits'); 80 |       return; 81 |     } 82 |  83 |     setIsLoading(true); 84 |     setError(''); 85 |  86 |     try { 87 |       const response = await fetch('/api/otp/send', { 88 |         method: 'POST', 89 |         headers: { 90 |           'Content-Type': 'application/json', 91 |         }, 92 |         body: JSON.stringify({ 93 |           phoneNumber: phoneNumber.trim(), 94 |           countryCode: selectedCountry.code, 95 |         }), 96 |       }); 97 |  98 |       const data = await response.json(); 99 | 100 |       if (response.ok) {101 |         setOtpSent(true);102 |         setStep('otp');103 |         setTimeRemaining(60);104 |         toast.showSuccess(105 |           'OTP Sent',106 |           `Verification code sent to ${selectedCountry.prefix} ${phoneNumber}`107 |         );108 |       } else {109 | 110 |         if (data.error && data.error.includes('Invalid phone number format')) {111 |           setError(`Invalid phone number format for ${selectedCountry.name}. Expected format: ${selectedCountry.example} (${selectedCountry.example.length} digits)`);112 |         } else {113 |           setError(data.error || 'Failed to send OTP');114 |         }115 |       }116 |     } catch (error) {117 |       setError('Network error. Please try again.');118 |     } finally {119 |       setIsLoading(false);120 |     }121 |   };122 | 123 |   const handleVerifyOtp = async () => {124 |     if (!otpCode.trim() || otpCode.length !== 6) {125 |       setError('Please enter a valid 6-digit OTP code');126 |       return;127 |     }128 | 129 |     setIsLoading(true);130 |     setError('');131 | 132 |     try {133 |       const fullPhoneNumber = `${selectedCountry.prefix}${phoneNumber}`;134 |       const response = await fetch('/api/otp/verify', {135 |         method: 'POST',136 |         headers: {137 |           'Content-Type': 'application/json',138 |         },139 |         body: JSON.stringify({140 |           phoneNumber: fullPhoneNumber,141 |           otpCode: otpCode.trim(),142 |         }),143 |       });144 | 145 |       const data = await response.json();146 | 147 |       if (response.ok) {148 |         toast.showSuccess(149 |           'Verification Successful',150 |           data.isExistingCustomer151 |             ? 'Welcome back! Your information has been loaded.'152 |             : 'Phone number verified successfully.'153 |         );154 | 155 |         onVerificationSuccess(data.user, data.isExistingCustomer);156 |         onClose();157 |       } else {158 |         setError(data.error || 'Invalid OTP code');159 |       }160 |     } catch (error) {161 |       setError('Network error. Please try again.');162 |     } finally {163 |       setIsLoading(false);164 |     }165 |   };166 | 167 |   const handleResendOtp = async () => {168 |     if (timeRemaining > 0) return;169 | 170 |     setOtpCode('');171 |     setError('');172 |     await handleSendOtp();173 |   };174 | 175 |   const handleBackToPhone = () => {176 |     setStep('phone');177 |     setOtpCode('');178 |     setError('');179 |     setOtpSent(false);180 |     setTimeRemaining(0);181 |   };182 | 183 |   const formatTime = (seconds: number) => {184 |     const mins = Math.floor(seconds / 60);185 |     const secs = seconds % 60;186 |     return `${mins}:${secs.toString().padStart(2, '0')}`;187 |   };188 | 189 |   if (!isOpen) return null;190 | 191 |   return (192 |     <AnimatePresence>193 |       <div className="fixed inset-0 z-50 flex items-center justify-center p-4">194 |         {}195 |         <motion.div196 |           initial={{ opacity: 0 }}197 |           animate={{ opacity: 1 }}198 |           exit={{ opacity: 0 }}199 |           className="absolute inset-0 bg-black/50 backdrop-blur-sm"200 |           onClick={onClose}201 |         />202 | 203 |         {}204 |         <motion.div205 |           initial={{ opacity: 0, scale: 0.95, y: 20 }}206 |           animate={{ opacity: 1, scale: 1, y: 0 }}207 |           exit={{ opacity: 0, scale: 0.95, y: 20 }}208 |           className="relative w-full max-w-md bg-gradient-to-br from-[#191970]/95 to-[#0A0A23]/95 backdrop-blur-sm rounded-2xl border border-[#C0C0C0]/20 shadow-2xl overflow-hidden"209 |         >210 |           {}211 |           <div className="flex items-center justify-between p-6 border-b border-[#C0C0C0]/20">212 |             <div className="flex items-center gap-3">213 |               {step === 'otp' && (214 |                 <button215 |                   onClick={handleBackToPhone}216 |                   className="p-1 hover:bg-[#191970]/20 rounded-full transition-colors"217 |                 >218 |                   <ArrowLeft size={20} className="text-[#EAEAEA]" />219 |                 </button>220 |               )}221 |               <div className="flex items-center gap-2">222 |                 <Phone size={20} className="text-[#FFD700]" />223 |                 <h2 className="text-lg font-semibold text-[#EAEAEA]">224 |                   {step === 'phone' ? 'Verify Phone Number' : 'Enter Verification Code'}225 |                 </h2>226 |               </div>227 |             </div>228 |             <button229 |               onClick={onClose}230 |               className="p-1 hover:bg-[#191970]/20 rounded-full transition-colors"231 |             >232 |               <X size={20} className="text-[#EAEAEA]" />233 |             </button>234 |           </div>235 | 236 |           {}237 |           <div className="p-6">238 |             {step === 'phone' ? (239 |               <div className="space-y-6">240 |                 <div className="text-center">241 |                   <p className="text-[#EAEAEA]/80">242 |                     Enter your phone number to receive a verification code243 |                   </p>244 |                 </div>245 | 246 |                 {}247 |                 <div className="space-y-2">248 |                   <label className="text-sm font-medium text-[#EAEAEA]">249 |                     Country250 |                   </label>251 |                   <div className="relative">252 |                     <select253 |                       value={selectedCountry.code}254 |                       onChange={(e) => {255 |                         const country = countries.find(c => c.code === e.target.value);256 |                         if (country) setSelectedCountry(country);257 |                       }}258 |                       className="w-full p-3 bg-[#191970]/10 border border-[#C0C0C0]/20 text-[#EAEAEA] rounded-lg focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"259 |                     >260 |                       {countries.map((country) => (261 |                         <option key={country.code} value={country.code}>262 |                           {country.flag} {country.name} ({country.prefix})263 |                         </option>264 |                       ))}265 |                     </select>266 |                   </div>267 |                 </div>268 | 269 |                 {}270 |                 <div className="space-y-2">271 |                   <label className="text-sm font-medium text-[#EAEAEA]">272 |                     Phone Number273 |                   </label>274 |                   <div className="flex gap-2">275 |                     <div className="flex items-center px-3 py-3 bg-[#191970]/20 border border-[#C0C0C0]/20 rounded-lg">276 |                       <span className="text-[#EAEAEA]">{selectedCountry.prefix}</span>277 |                     </div>278 |                     <input279 |                       type="tel"280 |                       value={phoneNumber}281 |                       onChange={(e) => setPhoneNumber(e.target.value.replace(/\D/g, ''))}282 |                       placeholder={selectedCountry.example}283 |                       className="flex-1 p-3 bg-[#191970]/10 border border-[#C0C0C0]/20 text-[#EAEAEA] placeholder-[#C0C0C0]/50 rounded-lg focus:ring-2 focus:ring-[#FFD700] focus:border-transparent"284 |                     />285 |                   </div>286 |                   <p className="text-xs text-[#C0C0C0]/70">287 |                     Example: {selectedCountry.example} (without country code)288 |                   </p>289 |                   <p className="text-xs text-[#FFD700]">290 |                     💡 Enter only the local number, the country code {selectedCountry.prefix} will be added automatically291 |                   </p>292 |                 </div>293 | 294 |                 {error && (295 |                   <div className="flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/20 rounded-lg">296 |                     <AlertCircle size={16} className="text-red-400" />297 |                     <span className="text-sm text-red-400">{error}</span>298 |                   </div>299 |                 )}300 | 301 |                 <button302 |                   onClick={handleSendOtp}303 |                   disabled={isLoading || !phoneNumber.trim()}304 |                   className="w-full py-3 px-4 bg-[#FFD700] text-[#0A0A23] rounded-lg font-medium hover:bg-[#FFD700]/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"305 |                 >306 |                   {isLoading ? (307 |                     <>308 |                       <Loader2 size={16} className="animate-spin" />309 |                       Sending...310 |                     </>311 |                   ) : (312 |                     'Send Verification Code'313 |                   )}314 |                 </button>315 |               </div>316 |             ) : (317 |               <div className="space-y-6">318 |                 <div className="text-center">319 |                   <CheckCircle size={48} className="mx-auto text-[#FFD700] mb-3" />320 |                   <p className="text-[#EAEAEA]/80">321 |                     We sent a 6-digit code to322 |                   </p>323 |                   <p className="font-medium text-[#EAEAEA]">324 |                     {selectedCountry.prefix} {phoneNumber}325 |                   </p>326 |                 </div>327 | 328 |                 {}329 |                 <div className="space-y-2">330 |                   <label className="text-sm font-medium text-[#EAEAEA]">331 |                     Verification Code332 |                   </label>333 |                   <input334 |                     type="text"335 |                     value={otpCode}336 |                     onChange={(e) => setOtpCode(e.target.value.replace(/\D/g, '').slice(0, 6))}337 |                     placeholder="000000"338 |                     className="w-full p-3 text-center text-2xl font-mono bg-[#191970]/10 border border-[#C0C0C0]/20 text-[#EAEAEA] rounded-lg focus:ring-2 focus:ring-[#FFD700] focus:border-transparent tracking-widest"339 |                     maxLength={6}340 |                   />341 |                 </div>342 | 343 |                 {error && (344 |                   <div className="flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/20 rounded-lg">345 |                     <AlertCircle size={16} className="text-red-400" />346 |                     <span className="text-sm text-red-400">{error}</span>347 |                   </div>348 |                 )}349 | 350 |                 <button351 |                   onClick={handleVerifyOtp}352 |                   disabled={isLoading || otpCode.length !== 6}353 |                   className="w-full py-3 px-4 bg-[#FFD700] text-[#0A0A23] rounded-lg font-medium hover:bg-[#FFD700]/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"354 |                 >355 |                   {isLoading ? (356 |                     <>357 |                       <Loader2 size={16} className="animate-spin" />358 |                       Verifying...359 |                     </>360 |                   ) : (361 |                     'Verify Code'362 |                   )}363 |                 </button>364 | 365 |                 {}366 |                 <div className="text-center">367 |                   <p className="text-sm text-[#EAEAEA]/80">368 |                     Didn&apos;t receive the code?{' '}369 |                     <button370 |                       onClick={handleResendOtp}371 |                       disabled={timeRemaining > 0}372 |                       className="text-[#FFD700] hover:text-[#FFD700]/80 disabled:text-[#C0C0C0]/50 disabled:cursor-not-allowed font-medium"373 |                     >374 |                       {timeRemaining > 0 ? `Resend in ${formatTime(timeRemaining)}` : 'Resend Code'}375 |                     </button>376 |                   </p>377 |                 </div>378 |               </div>379 |             )}380 |           </div>381 |         </motion.div>382 |       </div>383 |     </AnimatePresence>384 |   );385 | }
============================================================END: frontend/components/modals/PhoneVerificationModal.tsx============================================================


============================================================FILE: frontend/components/modals/StripeConfigModal.tsxSIZE: 14.21 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { BaseModal } from '@/components/ui/BaseModal';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseInput } from '@/components/ui/BaseInput';  7 | import { Label } from '@/components/ui/label';  8 | import { Switch } from '@/components/ui/switch';  9 | import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; 10 |  11 | import { CreditCard, Settings, Eye, EyeOff } from 'lucide-react'; 12 |  13 | interface StripeConfig { 14 |   publishableKey: string; 15 |   secretKey: string; 16 |   webhookSecret: string; 17 |   currency: string; 18 |   supportedCountries: string[]; 19 |   automaticTaxes: boolean; 20 |   allowPromotionCodes: boolean; 21 | } 22 |  23 | interface StripeConfigModalProps { 24 |   isOpen: boolean; 25 |   onClose: () => void; 26 |   onSave: (config: StripeConfig) => void; 27 |   initialConfig?: StripeConfig; 28 | } 29 |  30 | const CURRENCIES = [ 31 |   { code: 'usd', name: 'US Dollar ($)' }, 32 |   { code: 'eur', name: 'Euro (€)' }, 33 |   { code: 'gbp', name: 'British Pound (£)' }, 34 |   { code: 'cad', name: 'Canadian Dollar (C$)' }, 35 |   { code: 'aud', name: 'Australian Dollar (A$)' }, 36 |   { code: 'jpy', name: 'Japanese Yen (¥)' }, 37 |   { code: 'mxn', name: 'Mexican Peso (MXN$)' }, 38 |   { code: 'brl', name: 'Brazilian Real (R$)' }, 39 |   { code: 'pen', name: 'Peruvian Sol (S/)' }, 40 | ]; 41 |  42 | const COUNTRIES = [ 43 |   { code: 'US', name: 'United States' }, 44 |   { code: 'CA', name: 'Canada' }, 45 |   { code: 'GB', name: 'United Kingdom' }, 46 |   { code: 'DE', name: 'Germany' }, 47 |   { code: 'FR', name: 'France' }, 48 |   { code: 'ES', name: 'Spain' }, 49 |   { code: 'IT', name: 'Italy' }, 50 |   { code: 'MX', name: 'Mexico' }, 51 |   { code: 'BR', name: 'Brazil' }, 52 |   { code: 'AR', name: 'Argentina' }, 53 |   { code: 'CL', name: 'Chile' }, 54 |   { code: 'CO', name: 'Colombia' }, 55 |   { code: 'PE', name: 'Peru' }, 56 | ]; 57 |  58 | const StripeConfigModal: React.FC<StripeConfigModalProps> = ({ 59 |   isOpen, 60 |   onClose, 61 |   onSave, 62 |   initialConfig, 63 | }) => { 64 |   const [config, setConfig] = useState<StripeConfig>( 65 |     initialConfig || { 66 |       publishableKey: '', 67 |       secretKey: '', 68 |       webhookSecret: '', 69 |       currency: 'usd', 70 |       supportedCountries: ['US', 'CA', 'MX'], 71 |       automaticTaxes: true, 72 |       allowPromotionCodes: true, 73 |     } 74 |   ); 75 |  76 |   const [showSecretKey, setShowSecretKey] = useState(false); 77 |   const [showWebhookSecret, setShowWebhookSecret] = useState(false); 78 |   const [errors, setErrors] = useState<Record<string, string>>({}); 79 |  80 |   const validateConfig = (): boolean => { 81 |     const newErrors: Record<string, string> = {}; 82 |  83 |     if (!config.publishableKey.trim()) { 84 |       newErrors.publishableKey = 'Publishable key is required'; 85 |     } else if (!config.publishableKey.startsWith('pk_')) { 86 |       newErrors.publishableKey = 'Invalid publishable key format (should start with pk_)'; 87 |     } 88 |  89 |     if (!config.secretKey.trim()) { 90 |       newErrors.secretKey = 'Secret key is required'; 91 |     } else if (!config.secretKey.startsWith('sk_')) { 92 |       newErrors.secretKey = 'Invalid secret key format (should start with sk_)'; 93 |     } 94 |  95 |     if (!config.webhookSecret.trim()) { 96 |       newErrors.webhookSecret = 'Webhook secret is required'; 97 |     } else if (!config.webhookSecret.startsWith('whsec_')) { 98 |       newErrors.webhookSecret = 'Invalid webhook secret format (should start with whsec_)'; 99 |     }100 | 101 |     if (config.supportedCountries.length === 0) {102 |       newErrors.supportedCountries = 'At least one country must be selected';103 |     }104 | 105 |     setErrors(newErrors);106 |     return Object.keys(newErrors).length === 0;107 |   };108 | 109 |   const handleSave = () => {110 |     if (validateConfig()) {111 |       onSave(config);112 |       onClose();113 |     }114 |   };115 | 116 |   const handleCountryToggle = (countryCode: string) => {117 |     setConfig(prev => ({118 |       ...prev,119 |       supportedCountries: prev.supportedCountries.includes(countryCode)120 |         ? prev.supportedCountries.filter(c => c !== countryCode)121 |         : [...prev.supportedCountries, countryCode],122 |     }));123 |   };124 | 125 |   const handleReset = () => {126 |     setConfig(initialConfig || {127 |       publishableKey: '',128 |       secretKey: '',129 |       webhookSecret: '',130 |       currency: 'usd',131 |       supportedCountries: ['US', 'CA', 'MX'],132 |       automaticTaxes: true,133 |       allowPromotionCodes: true,134 |     });135 |     setErrors({});136 |   };137 | 138 |   return (139 |     <BaseModal140 |       isOpen={isOpen}141 |       onClose={onClose}142 |       title="Stripe Configuration"143 |       size="6xl"144 |     >145 |       <div className="space-y-4 max-h-[70vh] overflow-y-auto">146 |         {}147 |         <div className="flex items-center gap-3 pb-3 border-b border-[var(--color-border-500)]">148 |           <div className="w-8 h-8 bg-[var(--color-accent-100)] rounded-lg flex items-center justify-center">149 |             <CreditCard className="w-4 h-4 text-[var(--color-accent-600)]" />150 |           </div>151 |           <div>152 |             <h3 className="text-base font-semibold text-[var(--color-text-primary)]">Configure Stripe Payment Gateway</h3>153 |             <p className="text-xs text-[var(--color-text-secondary)]">154 |               Set up your Stripe account credentials and payment preferences155 |             </p>156 |           </div>157 |         </div>158 | 159 |         {}160 |         <div className="space-y-3">161 |           <h4 className="text-sm font-medium text-[var(--color-text-primary)] flex items-center gap-2">162 |             <Settings className="w-4 h-4" />163 |             API Configuration164 |           </h4>165 | 166 |           <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">167 |             <div className="space-y-2">168 |               <Label htmlFor="publishableKey" className="text-sm font-medium text-[var(--color-text-primary)]">169 |                 Publishable Key170 |               </Label>171 |               <BaseInput172 |                 id="publishableKey"173 |                 type="text"174 |                 value={config.publishableKey}175 |                 onChange={(e) => setConfig(prev => ({ ...prev, publishableKey: e.target.value }))}176 |                 placeholder="pk_test_..."177 |                 className={errors.publishableKey ? 'border-[var(--color-status-error)]' : ''}178 |               />179 |               {errors.publishableKey && (180 |                 <p className="text-sm text-[var(--color-status-error)]">{errors.publishableKey}</p>181 |               )}182 |               <p className="text-xs text-[var(--color-text-tertiary)]">183 |                 Found in your Stripe Dashboard under Developers → API keys184 |               </p>185 |             </div>186 | 187 |             <div className="space-y-2">188 |               <Label htmlFor="secretKey" className="text-sm font-medium text-[var(--color-text-primary)]">189 |                 Secret Key190 |               </Label>191 |               <div className="relative">192 |                 <BaseInput193 |                   id="secretKey"194 |                   type={showSecretKey ? 'text' : 'password'}195 |                   value={config.secretKey}196 |                   onChange={(e) => setConfig(prev => ({ ...prev, secretKey: e.target.value }))}197 |                   placeholder="sk_test_..."198 |                   className={errors.secretKey ? 'border-[var(--color-status-error)]' : ''}199 |                 />200 |                 <button201 |                   type="button"202 |                   onClick={() => setShowSecretKey(!showSecretKey)}203 |                   className="absolute right-3 top-1/2 transform -translate-y-1/2 text-[var(--color-text-tertiary)] hover:text-[var(--color-text-primary)]"204 |                 >205 |                   {showSecretKey ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}206 |                 </button>207 |               </div>208 |               {errors.secretKey && (209 |                 <p className="text-sm text-[var(--color-status-error)]">{errors.secretKey}</p>210 |               )}211 |               <p className="text-xs text-[var(--color-text-tertiary)]">212 |                 Keep this secure and never expose it in client-side code213 |               </p>214 |             </div>215 |           </div>216 | 217 |           <div className="space-y-2">218 |             <Label htmlFor="webhookSecret" className="text-sm font-medium text-[var(--color-text-primary)]">219 |               Webhook Secret220 |             </Label>221 |             <div className="relative">222 |               <BaseInput223 |                 id="webhookSecret"224 |                 type={showWebhookSecret ? 'text' : 'password'}225 |                 value={config.webhookSecret}226 |                 onChange={(e) => setConfig(prev => ({ ...prev, webhookSecret: e.target.value }))}227 |                 placeholder="whsec_..."228 |                 className={errors.webhookSecret ? 'border-[var(--color-status-error)]' : ''}229 |               />230 |               <button231 |                 type="button"232 |                 onClick={() => setShowWebhookSecret(!showWebhookSecret)}233 |                 className="absolute right-3 top-1/2 transform -translate-y-1/2 text-[var(--color-text-tertiary)] hover:text-[var(--color-text-primary)]"234 |               >235 |                 {showWebhookSecret ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}236 |               </button>237 |             </div>238 |             {errors.webhookSecret && (239 |               <p className="text-sm text-[var(--color-status-error)]">{errors.webhookSecret}</p>240 |             )}241 |             <p className="text-xs text-[var(--color-text-tertiary)]">242 |               Found in your Stripe Dashboard under Developers → Webhooks243 |             </p>244 |           </div>245 |         </div>246 | 247 |         {}248 |         <div className="space-y-3">249 |           <h4 className="text-sm font-medium text-[var(--color-text-primary)]">Payment Preferences</h4>250 | 251 |           <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">252 |             <div className="space-y-2">253 |               <Label htmlFor="currency" className="text-sm font-medium text-[var(--color-text-primary)]">254 |                 Default Currency255 |               </Label>256 |               <Select257 |                 value={config.currency}258 |                 onValueChange={(value) => setConfig(prev => ({ ...prev, currency: value }))}259 |               >260 |                 <SelectTrigger className="dashboard-select">261 |                   <SelectValue placeholder="Select currency" />262 |                 </SelectTrigger>263 |                 <SelectContent className="dashboard-dropdown-content">264 |                   {CURRENCIES.map((currency) => (265 |                     <SelectItem key={currency.code} value={currency.code} className="dashboard-dropdown-item">266 |                       {currency.name}267 |                     </SelectItem>268 |                   ))}269 |                 </SelectContent>270 |               </Select>271 |             </div>272 | 273 |             <div className="space-y-2">274 |               <Label className="text-sm font-medium text-[var(--color-text-primary)]">275 |                 Supported Countries276 |               </Label>277 |               <div className="max-h-32 overflow-y-auto border border-[var(--color-border-500)] rounded-md p-2 bg-[var(--color-surface-secondary)]">278 |                 {COUNTRIES.map((country) => (279 |                   <label key={country.code} className="flex items-center space-x-2 py-1">280 |                     <input281 |                       type="checkbox"282 |                       checked={config.supportedCountries.includes(country.code)}283 |                       onChange={() => handleCountryToggle(country.code)}284 |                       className="rounded border-[var(--color-border-500)] text-[var(--color-accent-500)] focus:ring-[var(--color-accent-500)] bg-[var(--color-surface-secondary)]"285 |                     />286 |                     <span className="text-sm text-[var(--color-text-primary)]">{country.name}</span>287 |                   </label>288 |                 ))}289 |               </div>290 |               {errors.supportedCountries && (291 |                 <p className="text-sm text-[var(--color-status-error)]">{errors.supportedCountries}</p>292 |               )}293 |             </div>294 |           </div>295 | 296 |           <div className="space-y-3">297 |             <div className="flex items-center justify-between">298 |               <Label htmlFor="automaticTaxes" className="text-sm font-medium text-[var(--color-text-primary)]">299 |                 Enable Automatic Tax Calculation300 |               </Label>301 |               <Switch302 |                 id="automaticTaxes"303 |                 checked={config.automaticTaxes}304 |                 onCheckedChange={(checked) => setConfig(prev => ({ ...prev, automaticTaxes: checked }))}305 |               />306 |             </div>307 |             <p className="text-xs text-[var(--color-text-tertiary)]">308 |               Automatically calculate and collect sales tax based on customer location309 |             </p>310 | 311 |             <div className="flex items-center justify-between">312 |               <Label htmlFor="allowPromotionCodes" className="text-sm font-medium text-[var(--color-text-primary)]">313 |                 Allow Promotion Codes314 |               </Label>315 |               <Switch316 |                 id="allowPromotionCodes"317 |                 checked={config.allowPromotionCodes}318 |                 onCheckedChange={(checked) => setConfig(prev => ({ ...prev, allowPromotionCodes: checked }))}319 |               />320 |             </div>321 |             <p className="text-xs text-[var(--color-text-tertiary)]">322 |               Allow customers to enter Stripe promotion codes during checkout323 |             </p>324 |           </div>325 |         </div>326 | 327 |         {}328 |         <div className="bg-[var(--color-accent-50)] border border-[var(--color-accent-200)] rounded-lg p-3">329 |           <h5 className="text-xs font-medium text-[var(--color-accent-900)] mb-1">Need Help?</h5>330 |           <ul className="text-xs text-[var(--color-accent-800)] space-y-0.5">331 |             <li>• Get your API keys from the <a href="https:332 |             <li>• Set up webhooks at <a href="https:333 |             <li>• Test with <a href="https:334 |           </ul>335 |         </div>336 | 337 |         {}338 |         <div className="flex gap-3 pt-3 border-t border-[var(--color-border-500)]">339 |           <BaseButton340 |             onClick={handleSave}341 |             variant="primary"342 |             className="flex-1"343 |           >344 |             Save Configuration345 |           </BaseButton>346 |           <BaseButton347 |             onClick={handleReset}348 |             variant="outline"349 |           >350 |             Reset351 |           </BaseButton>352 |           <BaseButton353 |             onClick={onClose}354 |             variant="ghost"355 |           >356 |             Cancel357 |           </BaseButton>358 |         </div>359 |       </div>360 |     </BaseModal>361 |   );362 | };363 | 364 | export default StripeConfigModal;
============================================================END: frontend/components/modals/StripeConfigModal.tsx============================================================


============================================================FILE: frontend/components/payment/StripePaymentMethod.tsxSIZE: 6.02 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { BaseButton } from '@/components/ui/BaseButton';  5 | import { BaseInput } from '@/components/ui/BaseInput';  6 | import { BaseCard } from '@/components/ui/BaseCard';  7 | import { CreditCard, Lock, Shield } from 'lucide-react';  8 |   9 | interface StripePaymentMethodProps { 10 |   amount: number; 11 |   currency: string; 12 |   description: string; 13 |   customerEmail?: string; 14 |   onSuccess?: (paymentIntentId: string) => void; 15 |   onError?: (error: string) => void; 16 |   className?: string; 17 | } 18 |  19 | const StripePaymentMethod: React.FC<StripePaymentMethodProps> = ({ 20 |   amount, 21 |   currency, 22 |   description, 23 |   customerEmail, 24 |   onSuccess, 25 |   onError, 26 |   className = '', 27 | }) => { 28 |   const [loading, setLoading] = useState(false); 29 |   const [cardNumber, setCardNumber] = useState(''); 30 |   const [expiryDate, setExpiryDate] = useState(''); 31 |   const [cvc, setCvc] = useState(''); 32 |   const [cardholderName, setCardholderName] = useState(''); 33 |   const [error, setError] = useState<string | null>(null); 34 |  35 |   const handleSubmit = async (e: React.FormEvent) => { 36 |     e.preventDefault(); 37 |     setLoading(true); 38 |     setError(null); 39 |  40 |     try { 41 |  42 |       const response = await fetch('/api/stripe/create-payment-intent', { 43 |         method: 'POST', 44 |         headers: { 45 |           'Content-Type': 'application/json', 46 |         }, 47 |         body: JSON.stringify({ 48 |           amount, 49 |           currency, 50 |           customerEmail, 51 |           description, 52 |           metadata: { 53 |             source: 'soulpath_payment', 54 |             timestamp: new Date().toISOString(), 55 |           }, 56 |         }), 57 |       }); 58 |  59 |       const result = await response.json(); 60 |  61 |       if (!result.success) { 62 |         throw new Error(result.error || 'Failed to create payment intent'); 63 |       } 64 |  65 |       onSuccess?.(result.paymentIntentId); 66 |     } catch (err) { 67 |       const errorMessage = err instanceof Error ? err.message : 'Payment failed'; 68 |       setError(errorMessage); 69 |       onError?.(errorMessage); 70 |     } finally { 71 |       setLoading(false); 72 |     } 73 |   }; 74 |  75 |   const formatAmount = (amount: number, currency: string) => { 76 |     return new Intl.NumberFormat('en-US', { 77 |       style: 'currency', 78 |       currency: currency.toUpperCase(), 79 |     }).format(amount / 100); 80 |   }; 81 |  82 |   return ( 83 |     <BaseCard className={`max-w-md mx-auto ${className}`}> 84 |       <div className="p-6"> 85 |         <div className="text-center mb-6"> 86 |           <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"> 87 |             <CreditCard className="w-8 h-8 text-blue-600" /> 88 |           </div> 89 |           <h3 className="text-xl font-semibold text-gray-900 mb-2">Credit Card Payment</h3> 90 |           <p className="text-gray-600">{description}</p> 91 |         </div> 92 |  93 |         <div className="bg-gray-50 rounded-lg p-4 mb-6"> 94 |           <div className="flex justify-between items-center"> 95 |             <span className="text-gray-700">Total Amount:</span> 96 |             <span className="text-2xl font-bold text-gray-900"> 97 |               {formatAmount(amount, currency)} 98 |             </span> 99 |           </div>100 |         </div>101 | 102 |         <form onSubmit={handleSubmit} className="space-y-4">103 |           <div>104 |             <label className="block text-sm font-medium text-gray-700 mb-2">105 |               Cardholder Name106 |             </label>107 |             <BaseInput108 |               type="text"109 |               value={cardholderName}110 |               onChange={(e) => setCardholderName(e.target.value)}111 |               placeholder="John Doe"112 |               required113 |             />114 |           </div>115 | 116 |           <div>117 |             <label className="block text-sm font-medium text-gray-700 mb-2">118 |               Card Number119 |             </label>120 |             <BaseInput121 |               type="text"122 |               value={cardNumber}123 |               onChange={(e) => setCardNumber(e.target.value)}124 |               placeholder="1234 5678 9012 3456"125 |               required126 |               maxLength={19}127 |             />128 |           </div>129 | 130 |           <div className="grid grid-cols-2 gap-4">131 |             <div>132 |               <label className="block text-sm font-medium text-gray-700 mb-2">133 |                 Expiry Date134 |               </label>135 |               <BaseInput136 |                 type="text"137 |                 value={expiryDate}138 |                 onChange={(e) => setExpiryDate(e.target.value)}139 |                 placeholder="MM/YY"140 |                 required141 |                 maxLength={5}142 |               />143 |             </div>144 |             <div>145 |               <label className="block text-sm font-medium text-gray-700 mb-2">146 |                 CVC147 |               </label>148 |               <BaseInput149 |                 type="text"150 |                 value={cvc}151 |                 onChange={(e) => setCvc(e.target.value)}152 |                 placeholder="123"153 |                 required154 |                 maxLength={4}155 |               />156 |             </div>157 |           </div>158 | 159 |           {error && (160 |             <div className="bg-red-50 border border-red-200 rounded-lg p-3">161 |               <p className="text-red-700 text-sm">{error}</p>162 |             </div>163 |           )}164 | 165 |           <BaseButton166 |             type="submit"167 |             disabled={loading}168 |             loading={loading}169 |             className="w-full"170 |             variant="primary"171 |           >172 |             {loading ? 'Processing...' : `Pay ${formatAmount(amount, currency)}`}173 |           </BaseButton>174 |         </form>175 | 176 |         <div className="mt-6 space-y-3">177 |           <div className="flex items-center text-sm text-gray-600">178 |             <Shield className="w-4 h-4 mr-2 text-green-500" />179 |             <span>256-bit SSL encryption</span>180 |           </div>181 |           <div className="flex items-center text-sm text-gray-600">182 |             <Lock className="w-4 h-4 mr-2 text-green-500" />183 |             <span>PCI DSS compliant</span>184 |           </div>185 |         </div>186 | 187 |         <p className="text-xs text-gray-500 text-center mt-6">188 |           By clicking &ldquo;Pay&rdquo;, you agree to our terms of service and privacy policy.189 |         </p>190 |       </div>191 |     </BaseCard>192 |   );193 | };194 | 195 | export default StripePaymentMethod;
============================================================END: frontend/components/payment/StripePaymentMethod.tsx============================================================


============================================================FILE: frontend/components/stripe/StripeCheckout.tsxSIZE: 5.11 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useEffect, useState } from 'react';  4 | import { loadStripe } from '@stripe/stripe-js';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { BaseCard } from '@/components/ui/BaseCard';  7 | import { CreditCard, Lock, Shield, CheckCircle } from 'lucide-react';  8 |   9 | interface StripeCheckoutProps { 10 |   amount: number; 11 |   currency: string; 12 |   description: string; 13 |   customerEmail?: string; 14 |   customerId?: string; 15 |   metadata?: Record<string, string>; 16 |   onSuccess?: (sessionId: string) => void; 17 |   onCancel?: () => void; 18 |   onError?: (error: string) => void; 19 |   className?: string; 20 | } 21 |  22 | const StripeCheckout: React.FC<StripeCheckoutProps> = ({ 23 |   amount, 24 |   currency, 25 |   description, 26 |   customerEmail, 27 |   customerId, 28 |   metadata, 29 |   onSuccess, 30 |  31 |   onError, 32 |   className = '', 33 | }) => { 34 |   const [loading, setLoading] = useState(false); 35 |   const [stripe, setStripe] = useState<import('@stripe/stripe-js').Stripe | null>(null); 36 |   const [error, setError] = useState<string | null>(null); 37 |  38 |   useEffect(() => { 39 |  40 |     const loadStripeClient = async () => { 41 |       try { 42 |         const stripeClient = await loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!); 43 |         setStripe(stripeClient); 44 |       } catch { 45 |         setError('Failed to load Stripe'); 46 |         onError?.('Failed to load Stripe'); 47 |       } 48 |     }; 49 |  50 |     loadStripeClient(); 51 |   }, [onError]); 52 |  53 |   const handleCheckout = async () => { 54 |     if (!stripe) { 55 |       setError('Stripe not loaded'); 56 |       onError?.('Stripe not loaded'); 57 |       return; 58 |     } 59 |  60 |     setLoading(true); 61 |     setError(null); 62 |  63 |     try { 64 |  65 |       const response = await fetch('/api/stripe/create-checkout-session', { 66 |         method: 'POST', 67 |         headers: { 68 |           'Content-Type': 'application/json', 69 |         }, 70 |         body: JSON.stringify({ 71 |           amount, 72 |           currency, 73 |           description, 74 |           customerEmail, 75 |           customerId, 76 |           metadata, 77 |           successUrl: `${window.location.origin}/payment/success?session_id={CHECKOUT_SESSION_ID}`, 78 |           cancelUrl: `${window.location.origin}/payment/cancel`, 79 |         }), 80 |       }); 81 |  82 |       const result = await response.json(); 83 |  84 |       if (!result.success) { 85 |         throw new Error(result.error || 'Failed to create checkout session'); 86 |       } 87 |  88 |       const { error: stripeError } = await stripe.redirectToCheckout({ 89 |         sessionId: result.sessionId, 90 |       }); 91 |  92 |       if (stripeError) { 93 |         throw new Error(stripeError.message); 94 |       } 95 |  96 |       onSuccess?.(result.sessionId); 97 |     } catch (err) { 98 |       const errorMessage = err instanceof Error ? err.message : 'Checkout failed'; 99 |       setError(errorMessage);100 |       onError?.(errorMessage);101 |     } finally {102 |       setLoading(false);103 |     }104 |   };105 | 106 |   const formatAmount = (amount: number, currency: string) => {107 |     return new Intl.NumberFormat('en-US', {108 |       style: 'currency',109 |       currency: currency.toUpperCase(),110 |     }).format(amount / 100);111 |   };112 | 113 |   return (114 |     <BaseCard className={`max-w-md mx-auto ${className}`}>115 |       <div className="p-6">116 |         <div className="text-center mb-6">117 |           <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">118 |             <CreditCard className="w-8 h-8 text-green-600" />119 |           </div>120 |           <h3 className="text-xl font-semibold text-gray-900 mb-2">Secure Checkout</h3>121 |           <p className="text-gray-600">{description}</p>122 |         </div>123 | 124 |         <div className="bg-gray-50 rounded-lg p-4 mb-6">125 |           <div className="flex justify-between items-center">126 |             <span className="text-gray-700">Total Amount:</span>127 |             <span className="text-2xl font-bold text-gray-900">128 |               {formatAmount(amount, currency)}129 |             </span>130 |           </div>131 |         </div>132 | 133 |         <div className="space-y-4 mb-6">134 |           <div className="flex items-center text-sm text-gray-600">135 |             <Shield className="w-4 h-4 mr-2 text-green-500" />136 |             <span>256-bit SSL encryption</span>137 |           </div>138 |           <div className="flex items-center text-sm text-gray-600">139 |             <Lock className="w-4 h-4 mr-2 text-green-500" />140 |             <span>PCI DSS compliant</span>141 |           </div>142 |           <div className="flex items-center text-sm text-gray-600">143 |             <CheckCircle className="w-4 h-4 mr-2 text-green-500" />144 |             <span>Secure payment processing</span>145 |           </div>146 |         </div>147 | 148 |         {error && (149 |           <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">150 |             <p className="text-red-700 text-sm">{error}</p>151 |           </div>152 |         )}153 | 154 |         <BaseButton155 |           onClick={handleCheckout}156 |           disabled={loading || !stripe}157 |           loading={loading}158 |           className="w-full"159 |           variant="primary"160 |         >161 |           {loading ? 'Processing...' : `Pay ${formatAmount(amount, currency)}`}162 |         </BaseButton>163 | 164 |         <p className="text-xs text-gray-500 text-center mt-4">165 |           By clicking &ldquo;Pay&rdquo;, you agree to our terms of service and privacy policy.166 |         </p>167 |       </div>168 |     </BaseCard>169 |   );170 | };171 | 172 | export default StripeCheckout;
============================================================END: frontend/components/stripe/StripeCheckout.tsx============================================================


============================================================FILE: frontend/components/stripe/StripeInlineForm.tsxSIZE: 11.58 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useEffect, useState } from 'react';  4 | import { loadStripe, Stripe } from '@stripe/stripe-js';  5 | import { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';  6 | import { BaseButton } from '@/components/ui/BaseButton';  7 | import { BaseCard } from '@/components/ui/BaseCard';  8 | import { CreditCard, Lock, Shield, CheckCircle, Link as LinkIcon, AlertCircle, Loader2 } from 'lucide-react';  9 |  10 | interface StripeInlineFormProps { 11 |   amount: number; 12 |   currency: string; 13 |   description: string; 14 |   customerEmail?: string; 15 |   customerId?: string; 16 |   metadata?: Record<string, string>; 17 |   onSuccess?: (paymentIntentId: string) => void; 18 |   onError?: (error: string) => void; 19 |   onCancel?: () => void; 20 |   className?: string; 21 |   appearance?: { 22 |     theme?: 'stripe' | 'night' | 'flat'; 23 |     variables?: Record<string, string>; 24 |     rules?: Record<string, Record<string, string>>; 25 |   }; 26 | } 27 |  28 | const cardElementOptions = { 29 |   style: { 30 |     base: { 31 |       fontSize: '16px', 32 |       color: '#32325d', 33 |       fontFamily: '"Inter", "Helvetica Neue", Helvetica, sans-serif', 34 |       '::placeholder': { 35 |         color: '#aab7c4', 36 |       }, 37 |     }, 38 |     invalid: { 39 |       color: '#fa755a', 40 |       iconColor: '#fa755a', 41 |     }, 42 |   }, 43 |   hidePostalCode: true, 44 | }; 45 |  46 | function StripeFormInner({ 47 |   amount, 48 |   currency, 49 |   description, 50 |   customerEmail, 51 |   customerId, 52 |   metadata, 53 |   onSuccess, 54 |   onError, 55 |   onCancel 56 | }: Omit<StripeInlineFormProps, 'className' | 'appearance'>) { 57 |   const stripe = useStripe(); 58 |   const elements = useElements(); 59 |  60 |   const [isLoading, setIsLoading] = useState(false); 61 |   const [error, setError] = useState<string | null>(null); 62 |   const [clientSecret, setClientSecret] = useState<string | null>(null); 63 |   const [email, setEmail] = useState(customerEmail || ''); 64 |  65 |   useEffect(() => { 66 |     const createPaymentIntent = async () => { 67 |       try { 68 |         setIsLoading(true); 69 |         const response = await fetch('/api/stripe/create-payment-intent', { 70 |           method: 'POST', 71 |           headers: { 72 |             'Content-Type': 'application/json', 73 |           }, 74 |           body: JSON.stringify({ 75 |             amount, 76 |             currency, 77 |             description, 78 |             customerEmail: email || customerEmail, 79 |             customerId, 80 |             metadata, 81 |           }), 82 |         }); 83 |  84 |         const result = await response.json(); 85 |  86 |         if (!result.success) { 87 |           throw new Error(result.error || 'Failed to create payment intent'); 88 |         } 89 |  90 |         setClientSecret(result.clientSecret); 91 |       } catch (err) { 92 |         const errorMessage = err instanceof Error ? err.message : 'Failed to initialize payment'; 93 |         setError(errorMessage); 94 |         onError?.(errorMessage); 95 |       } finally { 96 |         setIsLoading(false); 97 |       } 98 |     }; 99 | 100 |     if (stripe && elements) {101 |       createPaymentIntent();102 |     }103 |   }, [stripe, elements, amount, currency, description, customerEmail, customerId, metadata, email, onError]);104 | 105 |   const handleSubmit = async (event: React.FormEvent) => {106 |     event.preventDefault();107 | 108 |     if (!stripe || !elements || !clientSecret) {109 |       setError('Payment system not ready');110 |       return;111 |     }112 | 113 |     setIsLoading(true);114 |     setError(null);115 | 116 |     try {117 |       const cardElement = elements.getElement(CardElement);118 | 119 |       if (!cardElement) {120 |         throw new Error('Card element not found');121 |       }122 | 123 |       const { error: stripeError, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {124 |         payment_method: {125 |           card: cardElement,126 |           billing_details: {127 |             email: email || customerEmail,128 |           },129 |         },130 |         return_url: window.location.origin + '/payment/success',131 |       });132 | 133 |       if (stripeError) {134 |         throw new Error(stripeError.message || 'Payment failed');135 |       }136 | 137 |       if (paymentIntent?.status === 'succeeded') {138 |         onSuccess?.(paymentIntent.id);139 |       } else if (paymentIntent?.status === 'requires_action') {140 | 141 |         const { error: actionError } = await stripe.confirmCardPayment(clientSecret);142 |         if (actionError) {143 |           throw new Error(actionError.message || 'Authentication failed');144 |         }145 |       }146 |     } catch (err) {147 |       const errorMessage = err instanceof Error ? err.message : 'Payment failed';148 |       setError(errorMessage);149 |       onError?.(errorMessage);150 |     } finally {151 |       setIsLoading(false);152 |     }153 |   };154 | 155 |   const formatAmount = (amount: number, currency: string) => {156 |     return new Intl.NumberFormat('en-US', {157 |       style: 'currency',158 |       currency: currency.toUpperCase(),159 |     }).format(amount / 100);160 |   };161 | 162 |   return (163 |     <form onSubmit={handleSubmit} className="space-y-6">164 |       {}165 |       <div className="bg-gray-50 rounded-lg p-4">166 |         <div className="flex justify-between items-center">167 |           <span className="text-gray-700 font-medium">Total Amount:</span>168 |           <span className="text-2xl font-bold text-gray-900">169 |             {formatAmount(amount, currency)}170 |           </span>171 |         </div>172 |         <p className="text-sm text-gray-600 mt-1">{description}</p>173 |       </div>174 | 175 |       {}176 |       {!customerEmail && (177 |         <div>178 |           <label className="block text-sm font-medium text-gray-700 mb-2">179 |             Email Address180 |           </label>181 |           <input182 |             type="email"183 |             value={email}184 |             onChange={(e) => setEmail(e.target.value)}185 |             className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"186 |             placeholder="your@email.com"187 |             required188 |           />189 |         </div>190 |       )}191 | 192 |       {}193 |       <div>194 |         <label className="block text-sm font-medium text-gray-700 mb-2">195 |           Card Information196 |         </label>197 |         <div className="border border-gray-300 rounded-md p-3 focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent">198 |           <CardElement options={cardElementOptions} />199 |         </div>200 |       </div>201 | 202 |       {}203 |       <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">204 |         <div className="flex items-center">205 |           <LinkIcon className="w-5 h-5 text-blue-600 mr-2" />206 |           <span className="text-sm text-blue-800">207 |             <strong>Fast checkout:</strong> If you&apos;ve used Stripe Link before, your saved card will appear here automatically.208 |           </span>209 |         </div>210 |       </div>211 | 212 |       {}213 |       <div className="flex items-center justify-center space-x-6 text-sm text-gray-600">214 |         <div className="flex items-center">215 |           <Shield className="w-4 h-4 mr-1 text-green-500" />216 |           <span>256-bit SSL</span>217 |         </div>218 |         <div className="flex items-center">219 |           <Lock className="w-4 h-4 mr-1 text-green-500" />220 |           <span>PCI Compliant</span>221 |         </div>222 |         <div className="flex items-center">223 |           <CheckCircle className="w-4 h-4 mr-1 text-green-500" />224 |           <span>Secure Payment</span>225 |         </div>226 |       </div>227 | 228 |       {}229 |       {error && (230 |         <div className="bg-red-50 border border-red-200 rounded-lg p-3">231 |           <div className="flex items-center">232 |             <AlertCircle className="w-5 h-5 text-red-600 mr-2" />233 |             <span className="text-sm text-red-800">{error}</span>234 |           </div>235 |         </div>236 |       )}237 | 238 |       {}239 |       <BaseButton240 |         type="submit"241 |         disabled={!stripe || !elements || isLoading || !clientSecret}242 |         loading={isLoading}243 |         className="w-full"244 |         variant="primary"245 |       >246 |         {isLoading ? (247 |           <>248 |             <Loader2 className="w-4 h-4 mr-2 animate-spin" />249 |             Processing Payment...250 |           </>251 |         ) : (252 |           <>253 |             <CreditCard className="w-4 h-4 mr-2" />254 |             Pay {formatAmount(amount, currency)}255 |           </>256 |         )}257 |       </BaseButton>258 | 259 |       {}260 |       {onCancel && (261 |         <BaseButton262 |           type="button"263 |           onClick={onCancel}264 |           disabled={isLoading}265 |           variant="outline"266 |           className="w-full mt-2"267 |         >268 |           Cancel269 |         </BaseButton>270 |       )}271 | 272 |       {}273 |       <p className="text-xs text-gray-500 text-center">274 |         By clicking &ldquo;Pay&rdquo;, you agree to our terms of service and privacy policy.275 |       </p>276 |     </form>277 |   );278 | }279 | 280 | export function StripeInlineForm({281 |   amount,282 |   currency,283 |   description,284 |   customerEmail,285 |   customerId,286 |   metadata,287 |   onSuccess,288 |   onError,289 |   onCancel,290 |   className = '',291 |   appearance = {292 |     theme: 'stripe',293 |     variables: {294 |       colorPrimary: '#0066cc',295 |       colorBackground: '#ffffff',296 |       colorText: '#30313d',297 |       colorDanger: '#df1b41',298 |       fontFamily: 'Inter, system-ui, sans-serif',299 |       spacingUnit: '2px',300 |       borderRadius: '6px',301 |     },302 |   }303 | }: StripeInlineFormProps) {304 |   const [stripePromise, setStripePromise] = useState<Promise<Stripe | null> | null>(null);305 |   const [error, setError] = useState<string | null>(null);306 | 307 |   useEffect(() => {308 |     const initializeStripe = async () => {309 |       try {310 |         if (!process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY) {311 |           throw new Error('Stripe publishable key is not configured. Please contact support.');312 |         }313 | 314 |         const stripe = await loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);315 |         if (!stripe) {316 |           throw new Error('Failed to initialize Stripe');317 |         }318 |         setStripePromise(Promise.resolve(stripe));319 |       } catch (err) {320 |         const errorMessage = err instanceof Error ? err.message : 'Failed to load Stripe';321 |         setError(errorMessage);322 |         onError?.(errorMessage);323 |       }324 |     };325 | 326 |     initializeStripe();327 |   }, [onError]);328 | 329 |   if (error) {330 |     return (331 |       <BaseCard className={`max-w-md mx-auto ${className}`}>332 |         <div className="p-6 text-center">333 |           <AlertCircle className="w-12 h-12 text-red-500 mx-auto mb-4" />334 |           <h3 className="text-lg font-semibold text-gray-900 mb-2">Payment System Error</h3>335 |           <p className="text-gray-600 mb-4">{error}</p>336 |           <BaseButton onClick={() => window.location.reload()} variant="outline">337 |             Retry338 |           </BaseButton>339 |         </div>340 |       </BaseCard>341 |     );342 |   }343 | 344 |   if (!stripePromise) {345 |     return (346 |       <BaseCard className={`max-w-md mx-auto ${className}`}>347 |         <div className="p-6 text-center">348 |           <Loader2 className="w-8 h-8 animate-spin mx-auto mb-4 text-blue-500" />349 |           <p className="text-gray-600">Loading payment system...</p>350 |         </div>351 |       </BaseCard>352 |     );353 |   }354 | 355 |   const options = {356 |     mode: 'payment' as const,357 |     amount,358 |     currency: currency.toLowerCase(),359 |     appearance,360 |   };361 | 362 |   return (363 |     <BaseCard className={`max-w-md mx-auto ${className}`}>364 |       <div className="p-6">365 |         <Elements stripe={stripePromise} options={options}>366 |           <StripeFormInner367 |             amount={amount}368 |             currency={currency}369 |             description={description}370 |             customerEmail={customerEmail}371 |             customerId={customerId}372 |             metadata={metadata}373 |             onSuccess={onSuccess}374 |             onError={onError}375 |             onCancel={onCancel}376 |           />377 |         </Elements>378 |       </div>379 |     </BaseCard>380 |   );381 | }382 | 383 | export default StripeInlineForm;
============================================================END: frontend/components/stripe/StripeInlineForm.tsx============================================================


============================================================FILE: frontend/components/stripe/StripePaymentButton.tsxSIZE: 4.10 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { StripeInlineForm } from './StripeInlineForm';  5 | import { BaseButton } from '@/components/ui/BaseButton';  6 | import { CreditCard, X, CheckCircle, AlertCircle } from 'lucide-react';  7 |   8 | interface StripePaymentButtonProps {  9 |   amount: number; 10 |   currency: string; 11 |   description: string; 12 |   customerEmail?: string; 13 |   customerId?: string; 14 |   metadata?: Record<string, string>; 15 |   buttonText?: string; 16 |   buttonVariant?: 'primary' | 'secondary' | 'outline'; 17 |   onSuccess?: (paymentIntentId: string) => void; 18 |   onError?: (error: string) => void; 19 |   className?: string; 20 |   appearance?: { 21 |     theme?: 'stripe' | 'night' | 'flat'; 22 |     variables?: Record<string, string>; 23 |     rules?: Record<string, Record<string, string>>; 24 |   }; 25 | } 26 |  27 | export function StripePaymentButton({ 28 |   amount, 29 |   currency, 30 |   description, 31 |   customerEmail, 32 |   customerId, 33 |   metadata, 34 |   buttonText, 35 |   buttonVariant = 'primary', 36 |   onSuccess, 37 |   onError, 38 |   className = '', 39 |   appearance 40 | }: StripePaymentButtonProps) { 41 |   const [showPaymentForm, setShowPaymentForm] = useState(false); 42 |   const [paymentStatus, setPaymentStatus] = useState<'idle' | 'success' | 'error'>('idle'); 43 |  44 |   const formatAmount = (amount: number, currency: string) => { 45 |     return new Intl.NumberFormat('en-US', { 46 |       style: 'currency', 47 |       currency: currency.toUpperCase(), 48 |     }).format(amount / 100); 49 |   }; 50 |  51 |   const handlePaymentSuccess = (paymentIntentId: string) => { 52 |     setPaymentStatus('success'); 53 |     onSuccess?.(paymentIntentId); 54 |  55 |     setTimeout(() => { 56 |       setShowPaymentForm(false); 57 |       setPaymentStatus('idle'); 58 |     }, 3000); 59 |   }; 60 |  61 |   const handlePaymentError = (error: string) => { 62 |     setPaymentStatus('error'); 63 |     onError?.(error); 64 |  65 |     setTimeout(() => { 66 |       setPaymentStatus('idle'); 67 |     }, 5000); 68 |   }; 69 |  70 |   const handleClose = () => { 71 |     setShowPaymentForm(false); 72 |     setPaymentStatus('idle'); 73 |   }; 74 |  75 |   if (showPaymentForm) { 76 |     return ( 77 |       <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"> 78 |         <div className="relative w-full max-w-md"> 79 |           {} 80 |           <button 81 |             onClick={handleClose} 82 |             className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors" 83 |           > 84 |             <X className="w-6 h-6" /> 85 |           </button> 86 |  87 |           {} 88 |           {paymentStatus !== 'idle' && ( 89 |             <div className="absolute inset-0 bg-white bg-opacity-95 z-10 flex items-center justify-center rounded-lg"> 90 |               {paymentStatus === 'success' ? ( 91 |                 <div className="text-center"> 92 |                   <CheckCircle className="w-16 h-16 text-green-500 mx-auto mb-4" /> 93 |                   <h3 className="text-xl font-semibold text-green-800 mb-2">Payment Successful!</h3> 94 |                   <p className="text-green-600">Your payment has been processed.</p> 95 |                 </div> 96 |               ) : ( 97 |                 <div className="text-center max-w-xs"> 98 |                   <AlertCircle className="w-16 h-16 text-red-500 mx-auto mb-4" /> 99 |                   <h3 className="text-xl font-semibold text-red-800 mb-2">Payment Failed</h3>100 |                   <p className="text-red-600 text-sm">Please try again or contact support.</p>101 |                 </div>102 |               )}103 |             </div>104 |           )}105 | 106 |           <StripeInlineForm107 |             amount={amount}108 |             currency={currency}109 |             description={description}110 |             customerEmail={customerEmail}111 |             customerId={customerId}112 |             metadata={metadata}113 |             onSuccess={handlePaymentSuccess}114 |             onError={handlePaymentError}115 |             onCancel={handleClose}116 |             appearance={appearance}117 |           />118 |         </div>119 |       </div>120 |     );121 |   }122 | 123 |   return (124 |     <BaseButton125 |       onClick={() => setShowPaymentForm(true)}126 |       variant={buttonVariant}127 |       className={className}128 |     >129 |       <CreditCard className="w-4 h-4 mr-2" />130 |       {buttonText || `Pay ${formatAmount(amount, currency)}`}131 |     </BaseButton>132 |   );133 | }134 | 135 | export default StripePaymentButton;
============================================================END: frontend/components/stripe/StripePaymentButton.tsx============================================================


============================================================FILE: frontend/components/theme/ThemeManager.tsxSIZE: 10.04 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState } from 'react';  4 | import { useTheme, useThemeSwitcher } from '@/lib/theme/ThemeProvider';  5 | import { ThemeColors, currentTheme } from '@/lib/theme/theme-config';  6 | import { themeClasses } from '@/lib/theme/theme-utils';  7 | import { Settings, Palette, Save, RotateCcw } from 'lucide-react';  8 |   9 | interface ColorInputProps { 10 |   label: string; 11 |   value: string; 12 |   onChange: (value: string) => void; 13 |   description?: string; 14 | } 15 |  16 | function ColorInput({ label, value, onChange, description }: ColorInputProps) { 17 |   return ( 18 |     <div className="space-y-2"> 19 |       <label className="block text-sm font-medium text-[var(--color-text-primary)]"> 20 |         {label} 21 |       </label> 22 |       <div className="flex items-center space-x-3"> 23 |         <input 24 |           type="color" 25 |           value={value} 26 |           onChange={(e) => onChange(e.target.value)} 27 |           className="w-12 h-12 rounded-lg border border-[var(--color-border-medium)] cursor-pointer" 28 |         /> 29 |         <input 30 |           type="text" 31 |           value={value} 32 |           onChange={(e) => onChange(e.target.value)} 33 |           className="flex-1 px-3 py-2 bg-[var(--color-background-surface)] border border-[var(--color-border-medium)] rounded-lg text-[var(--color-text-primary)] text-sm" 34 |           placeholder="#000000" 35 |         /> 36 |       </div> 37 |       {description && ( 38 |         <p className="text-xs text-[var(--color-text-secondary)]">{description}</p> 39 |       )} 40 |     </div> 41 |   ); 42 | } 43 |  44 | export function ThemeManager() { 45 |   const { theme, setTheme } = useTheme(); 46 |   const { switchToTheme, currentTheme: currentThemeName } = useThemeSwitcher(); 47 |   const [isOpen, setIsOpen] = useState(false); 48 |   const [customTheme, setCustomTheme] = useState<ThemeColors>(theme); 49 |  50 |   const handleColorChange = (category: keyof ThemeColors, key: string, value: string) => { 51 |     setCustomTheme(prev => ({ 52 |       ...prev, 53 |       [category]: { 54 |         ...prev[category], 55 |         [key]: value, 56 |       }, 57 |     })); 58 |   }; 59 |  60 |   const applyCustomTheme = () => { 61 |     setTheme(customTheme, 'custom'); 62 |   }; 63 |  64 |   const resetToDefault = () => { 65 |     setCustomTheme(currentTheme); 66 |     setTheme(currentTheme, 'light'); 67 |   }; 68 |  69 |   if (!isOpen) { 70 |     return ( 71 |       <button 72 |         onClick={() => setIsOpen(true)} 73 |         className="fixed bottom-4 right-4 z-50 p-3 bg-[var(--color-primary-main)] text-[var(--color-primary-contrast)] rounded-full shadow-lg hover:bg-[var(--color-primary-hover)] transition-all duration-200" 74 |         title="Open Theme Manager" 75 |       > 76 |         <Palette className="w-5 h-5" /> 77 |       </button> 78 |     ); 79 |   } 80 |  81 |   return ( 82 |     <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"> 83 |       <div className="w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-[var(--color-background-surface)] rounded-xl shadow-2xl m-4"> 84 |         {} 85 |         <div className="sticky top-0 bg-[var(--color-background-surface)] border-b border-[var(--color-border-light)] px-6 py-4"> 86 |           <div className="flex items-center justify-between"> 87 |             <div className="flex items-center space-x-3"> 88 |               <Settings className="w-5 h-5 text-[var(--color-primary-main)]" /> 89 |               <h2 className="text-xl font-semibold text-[var(--color-text-primary)]"> 90 |                 Theme Manager 91 |               </h2> 92 |             </div> 93 |             <button 94 |               onClick={() => setIsOpen(false)} 95 |               className="p-2 hover:bg-[var(--color-background-secondary)] rounded-lg transition-colors" 96 |             > 97 |               ✕ 98 |             </button> 99 |           </div>100 |         </div>101 | 102 |         {}103 |         <div className="p-6 space-y-8">104 |           {}105 |           <div className="space-y-4">106 |             <h3 className="text-lg font-medium text-[var(--color-text-primary)]">107 |               Quick Themes108 |             </h3>109 |             <div className="flex space-x-4">110 |               <button111 |                 onClick={() => switchToTheme('light')}112 |                 className={`px-4 py-2 rounded-lg border transition-all duration-200 ${113 |                   currentThemeName === 'light'114 |                     ? 'bg-[var(--color-primary-main)] text-[var(--color-primary-contrast)] border-[var(--color-primary-main)]'115 |                     : 'bg-[var(--color-background-surface)] text-[var(--color-text-primary)] border-[var(--color-border-medium)] hover:bg-[var(--color-background-secondary)]'116 |                 }`}117 |               >118 |                 Light Theme119 |               </button>120 |               <button121 |                 onClick={() => switchToTheme('dark')}122 |                 className={`px-4 py-2 rounded-lg border transition-all duration-200 ${123 |                   currentThemeName === 'dark'124 |                     ? 'bg-[var(--color-primary-main)] text-[var(--color-primary-contrast)] border-[var(--color-primary-main)]'125 |                     : 'bg-[var(--color-background-surface)] text-[var(--color-text-primary)] border-[var(--color-border-medium)] hover:bg-[var(--color-background-secondary)]'126 |                 }`}127 |               >128 |                 Dark Theme129 |               </button>130 |             </div>131 |           </div>132 | 133 |           {}134 |           <div className="space-y-6">135 |             <h3 className="text-lg font-medium text-[var(--color-text-primary)]">136 |               Customize Colors137 |             </h3>138 | 139 |             <div className="grid grid-cols-1 md:grid-cols-2 gap-8">140 |               {}141 |               <div className="space-y-4">142 |                 <h4 className="font-medium text-[var(--color-text-primary)]">Primary Colors (Buttons)</h4>143 |                 <ColorInput144 |                   label="Main"145 |                   value={customTheme.primary.main}146 |                   onChange={(value) => handleColorChange('primary', 'main', value)}147 |                   description="Main button color"148 |                 />149 |                 <ColorInput150 |                   label="Hover"151 |                   value={customTheme.primary.hover}152 |                   onChange={(value) => handleColorChange('primary', 'hover', value)}153 |                   description="Button hover state"154 |                 />155 |               </div>156 | 157 |               {}158 |               <div className="space-y-4">159 |                 <h4 className="font-medium text-[var(--color-text-primary)]">Background Colors</h4>160 |                 <ColorInput161 |                   label="Primary"162 |                   value={customTheme.background.primary}163 |                   onChange={(value) => handleColorChange('background', 'primary', value)}164 |                   description="Main background color"165 |                 />166 |                 <ColorInput167 |                   label="Secondary"168 |                   value={customTheme.background.secondary}169 |                   onChange={(value) => handleColorChange('background', 'secondary', value)}170 |                   description="Secondary background"171 |                 />172 |               </div>173 | 174 |               {}175 |               <div className="space-y-4">176 |                 <h4 className="font-medium text-[var(--color-text-primary)]">Text Colors</h4>177 |                 <ColorInput178 |                   label="Primary"179 |                   value={customTheme.text.primary}180 |                   onChange={(value) => handleColorChange('text', 'primary', value)}181 |                   description="Main text color"182 |                 />183 |                 <ColorInput184 |                   label="Secondary"185 |                   value={customTheme.text.secondary}186 |                   onChange={(value) => handleColorChange('text', 'secondary', value)}187 |                   description="Secondary text"188 |                 />189 |               </div>190 | 191 |               {}192 |               <div className="space-y-4">193 |                 <h4 className="font-medium text-[var(--color-text-primary)]">Accent Colors</h4>194 |                 <ColorInput195 |                   label="Main"196 |                   value={customTheme.accent.main}197 |                   onChange={(value) => handleColorChange('accent', 'main', value)}198 |                   description="Accent/highlight color"199 |                 />200 |                 <ColorInput201 |                   label="Hover"202 |                   value={customTheme.accent.hover}203 |                   onChange={(value) => handleColorChange('accent', 'hover', value)}204 |                   description="Accent hover state"205 |                 />206 |               </div>207 |             </div>208 |           </div>209 | 210 |           {}211 |           <div className="space-y-4">212 |             <h3 className="text-lg font-medium text-[var(--color-text-primary)]">Preview</h3>213 |             <div className="p-6 bg-[var(--color-background-secondary)] rounded-lg space-y-4">214 |               <div className="flex space-x-4">215 |                 <button className={themeClasses.button.primary + ' px-4 py-2 rounded-lg'}>216 |                   Primary Button217 |                 </button>218 |                 <button className={themeClasses.button.accent + ' px-4 py-2 rounded-lg'}>219 |                   Accent Button220 |                 </button>221 |                 <button className={themeClasses.button.outline + ' px-4 py-2 rounded-lg'}>222 |                   Outline Button223 |                 </button>224 |               </div>225 |               <div className={themeClasses.card.default + ' p-4'}>226 |                 <h4 className={themeClasses.text.primary + ' font-medium mb-2'}>Card Example</h4>227 |                 <p className={themeClasses.text.secondary}>228 |                   This is how your theme will look in cards and components.229 |                 </p>230 |               </div>231 |             </div>232 |           </div>233 | 234 |           {}235 |           <div className="flex space-x-4 pt-4 border-t border-[var(--color-border-light)]">236 |             <button237 |               onClick={applyCustomTheme}238 |               className={themeClasses.button.primary + ' px-6 py-2 rounded-lg flex items-center space-x-2'}239 |             >240 |               <Save className="w-4 h-4" />241 |               <span>Apply Theme</span>242 |             </button>243 |             <button244 |               onClick={resetToDefault}245 |               className={themeClasses.button.outline + ' px-6 py-2 rounded-lg flex items-center space-x-2'}246 |             >247 |               <RotateCcw className="w-4 h-4" />248 |               <span>Reset to Default</span>249 |             </button>250 |           </div>251 |         </div>252 |       </div>253 |     </div>254 |   );255 | }
============================================================END: frontend/components/theme/ThemeManager.tsx============================================================


============================================================FILE: frontend/components/ui/BaseButton.tsxSIZE: 4.02 KB============================================================
  1 | import React from 'react';  2 | import { cn } from '@/lib/utils';  3 | import { buttonStyles, combineStyles } from '@/lib/styles/common';  4 | import { Loader2 } from 'lucide-react';  5 |   6 | export interface BaseButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {  7 |   variant?: 'primary' | 'secondary' | 'outline' | 'ghost' | 'danger' | 'success' | 'warning' | 'info';  8 |   size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'login';  9 |   loading?: boolean; 10 |   disabled?: boolean; 11 |   children: React.ReactNode; 12 |   leftIcon?: React.ReactNode; 13 |   rightIcon?: React.ReactNode; 14 | } 15 |  16 | export function BaseButton({ 17 |   variant = 'primary', 18 |   size = 'md', 19 |   loading = false, 20 |   disabled = false, 21 |   className, 22 |   children, 23 |   leftIcon, 24 |   rightIcon, 25 |   ...props 26 | }: BaseButtonProps) { 27 |   const baseClasses = buttonStyles.base; 28 |   const variantClasses = buttonStyles.variants[variant]; 29 |   const sizeClasses = buttonStyles.sizes[size]; 30 |  31 |   const stateClasses = combineStyles( 32 |     loading && buttonStyles.states.loading, 33 |     disabled && buttonStyles.states.disabled 34 |   ); 35 |  36 |   const classes = combineStyles( 37 |     baseClasses, 38 |     variantClasses, 39 |     sizeClasses, 40 |     stateClasses, 41 |     className 42 |   ); 43 |  44 |   const isDisabled = disabled || loading; 45 |  46 |   return ( 47 |     <button 48 |       className={classes} 49 |       disabled={isDisabled} 50 |       {...props} 51 |     > 52 |       {loading && ( 53 |         <Loader2 className="mr-2 h-4 w-4 animate-spin" /> 54 |       )} 55 |  56 |       {!loading && leftIcon && ( 57 |         <span className="mr-2">{leftIcon}</span> 58 |       )} 59 |  60 |       {children} 61 |  62 |       {!loading && rightIcon && ( 63 |         <span className="ml-2">{rightIcon}</span> 64 |       )} 65 |     </button> 66 |   ); 67 | } 68 |  69 | export interface BaseButtonGroupProps extends React.HTMLAttributes<HTMLDivElement> { 70 |   children: React.ReactNode; 71 |   orientation?: 'horizontal' | 'vertical'; 72 |   size?: 'sm' | 'md' | 'lg'; 73 | } 74 |  75 | export function BaseButtonGroup({ 76 |   orientation = 'horizontal', 77 |   size = 'md', 78 |   className, 79 |   children, 80 |   ...props 81 | }: BaseButtonGroupProps) { 82 |   const orientationClasses = orientation === 'vertical' ? 'flex-col' : 'flex-row'; 83 |   const sizeClasses = { 84 |     sm: 'gap-1', 85 |     md: 'gap-2', 86 |     lg: 'gap-3', 87 |   }[size]; 88 |  89 |   const classes = cn( 90 |     'inline-flex', 91 |     orientationClasses, 92 |     sizeClasses, 93 |     className 94 |   ); 95 |  96 |   return ( 97 |     <div className={classes} {...props}> 98 |       {React.Children.map(children, (child, index) => { 99 |         if (React.isValidElement(child)) {100 | 101 |           const isFirst = index === 0;102 |           const isLast = index === React.Children.count(children) - 1;103 | 104 |           let roundedClasses = '';105 |           if (orientation === 'horizontal') {106 |             roundedClasses = isFirst ? 'rounded-r-none' : isLast ? 'rounded-l-none' : 'rounded-none';107 |           } else {108 |             roundedClasses = isFirst ? 'rounded-b-none' : isLast ? 'rounded-t-none' : 'rounded-none';109 |           }110 | 111 |           return React.cloneElement(child, {112 |             className: cn(child.props.className, roundedClasses),113 |           });114 |         }115 |         return child;116 |       })}117 |     </div>118 |   );119 | }120 | 121 | export default BaseButton;
============================================================END: frontend/components/ui/BaseButton.tsx============================================================


============================================================FILE: frontend/components/ui/BaseCard.tsxSIZE: 3.29 KB============================================================
  1 | import React from 'react';  2 | import { cn } from '@/lib/utils';  3 | import { cardStyles, combineStyles } from '@/lib/styles/common';  4 |   5 | export interface BaseCardProps extends React.HTMLAttributes<HTMLDivElement> {  6 |   variant?: 'default' | 'elevated' | 'outlined' | 'ghost';  7 |   size?: 'sm' | 'md' | 'lg' | 'xl';  8 |   hover?: boolean;  9 |   focus?: boolean; 10 |   active?: boolean; 11 |   children: React.ReactNode; 12 | } 13 |  14 | export interface BaseCardHeaderProps extends React.HTMLAttributes<HTMLDivElement> { 15 |   children: React.ReactNode; 16 | } 17 |  18 | export interface BaseCardContentProps extends React.HTMLAttributes<HTMLDivElement> { 19 |   children: React.ReactNode; 20 | } 21 |  22 | export interface BaseCardFooterProps extends React.HTMLAttributes<HTMLDivElement> { 23 |   children: React.ReactNode; 24 | } 25 |  26 | export function BaseCard({ 27 |   variant = 'default', 28 |   size = 'md', 29 |   hover = false, 30 |   focus = false, 31 |   active = false, 32 |   className, 33 |   children, 34 |   ...props 35 | }: BaseCardProps) { 36 |   const baseClasses = cardStyles.base; 37 |   const variantClasses = cardStyles.variants[variant]; 38 |   const sizeClasses = cardStyles.sizes[size]; 39 |  40 |   const stateClasses = combineStyles( 41 |     hover && cardStyles.states.hover, 42 |     focus && cardStyles.states.focus, 43 |     active && cardStyles.states.active 44 |   ); 45 |  46 |   const classes = combineStyles( 47 |     baseClasses, 48 |     variantClasses, 49 |     sizeClasses, 50 |     stateClasses, 51 |     className 52 |   ); 53 |  54 |   return ( 55 |     <div className={classes} {...props}> 56 |       {children} 57 |     </div> 58 |   ); 59 | } 60 |  61 | BaseCard.Header = function BaseCardHeader({ 62 |   className, 63 |   children, 64 |   ...props 65 | }: BaseCardHeaderProps) { 66 |   return ( 67 |     <div 68 |       className={cn( 69 |         'border-b border-border/20 pb-4 mb-4', 70 |         className 71 |       )} 72 |       {...props} 73 |     > 74 |       {children} 75 |     </div> 76 |   ); 77 | }; 78 |  79 | BaseCard.Content = function BaseCardContent({ 80 |   className, 81 |   children, 82 |   ...props 83 | }: BaseCardContentProps) { 84 |   return ( 85 |     <div className={cn('', className)} {...props}> 86 |       {children} 87 |     </div> 88 |   ); 89 | }; 90 |  91 | BaseCard.Footer = function BaseCardFooter({ 92 |   className, 93 |   children, 94 |   ...props 95 | }: BaseCardFooterProps) { 96 |   return ( 97 |     <div 98 |       className={cn( 99 |         'border-t border-border/20 pt-4 mt-4',100 |         className101 |       )}102 |       {...props}103 |     >104 |       {children}105 |     </div>106 |   );107 | };108 | 109 | export default BaseCard;
============================================================END: frontend/components/ui/BaseCard.tsx============================================================


============================================================FILE: frontend/components/ui/BaseInput.tsxSIZE: 4.85 KB============================================================
  1 | import React, { forwardRef } from 'react';  2 | import { cn } from '@/lib/utils';  3 | import { inputStyles, combineStyles } from '@/lib/styles/common';  4 |   5 | export interface BaseInputProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'size'> {  6 |   variant?: 'default' | 'error' | 'success';  7 |   size?: 'sm' | 'md' | 'lg';  8 |   leftIcon?: React.ReactNode;  9 |   rightIcon?: React.ReactNode; 10 |   label?: string; 11 |   error?: string; 12 |   hint?: string; 13 |   required?: boolean; 14 | } 15 |  16 | export const BaseInput = forwardRef<HTMLInputElement, BaseInputProps>(({ 17 |   variant = 'default', 18 |   size = 'md', 19 |   leftIcon, 20 |   rightIcon, 21 |   label, 22 |   error, 23 |   hint, 24 |   required = false, 25 |   className, 26 |   id, 27 |   ...props 28 | }, ref) => { 29 |   const baseClasses = inputStyles.base; 30 |   const variantClasses = inputStyles.variants[variant]; 31 |   const sizeClasses = inputStyles.sizes[size]; 32 |  33 |   const iconPadding = leftIcon ? 'pl-10' : rightIcon ? 'pr-10' : ''; 34 |  35 |   const classes = combineStyles( 36 |     baseClasses, 37 |     variantClasses, 38 |     sizeClasses, 39 |     iconPadding, 40 |     className 41 |   ); 42 |  43 |   const inputId = id || `input-${Math.random().toString(36).substr(2, 9)}`; 44 |  45 |   return ( 46 |     <div className="w-full"> 47 |       {label && ( 48 |         <label 49 |           htmlFor={inputId} 50 |           className="block text-sm font-medium text-gray-400 mb-2" 51 |         > 52 |           {label} 53 |           {required && <span className="text-red-500 ml-1">*</span>} 54 |         </label> 55 |       )} 56 |  57 |       <div className="relative"> 58 |         {leftIcon && ( 59 |           <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"> 60 |             <div className="h-5 w-5 text-gray-400"> 61 |               {leftIcon} 62 |             </div> 63 |           </div> 64 |         )} 65 |  66 |         <input 67 |           ref={ref} 68 |           id={inputId} 69 |           className={classes} 70 |           aria-invalid={variant === 'error'} 71 |           aria-describedby={ 72 |             error ? `${inputId}-error` : hint ? `${inputId}-hint` : undefined 73 |           } 74 |           {...props} 75 |         /> 76 |  77 |         {rightIcon && ( 78 |           <div className="absolute inset-y-0 right-0 pr-3 flex items-center"> 79 |             <div className="h-5 w-5"> 80 |               {rightIcon} 81 |             </div> 82 |           </div> 83 |         )} 84 |       </div> 85 |  86 |       {error && ( 87 |         <p 88 |           id={`${inputId}-error`} 89 |           className="mt-1 text-sm text-red-500" 90 |           role="alert" 91 |         > 92 |           {error} 93 |         </p> 94 |       )} 95 |  96 |       {hint && !error && ( 97 |         <p 98 |           id={`${inputId}-hint`} 99 |           className="mt-1 text-sm text-gray-400"100 |         >101 |           {hint}102 |         </p>103 |       )}104 |     </div>105 |   );106 | });107 | 108 | BaseInput.displayName = 'BaseInput';109 | 110 | export interface BaseInputGroupProps extends React.HTMLAttributes<HTMLDivElement> {111 |   children: React.ReactNode;112 |   size?: 'sm' | 'md' | 'lg';113 | }114 | 115 | export function BaseInputGroup({116 |   size = 'md',117 |   className,118 |   children,119 |   ...props120 | }: BaseInputGroupProps) {121 |   const sizeClasses = {122 |     sm: 'gap-1',123 |     md: 'gap-2',124 |     lg: 'gap-3',125 |   }[size];126 | 127 |   const classes = cn(128 |     'flex',129 |     sizeClasses,130 |     className131 |   );132 | 133 |   return (134 |     <div className={classes} {...props}>135 |       {React.Children.map(children, (child, index) => {136 |         if (React.isValidElement(child)) {137 | 138 |           const isFirst = index === 0;139 |           const isLast = index === React.Children.count(children) - 1;140 | 141 |           let roundedClasses = '';142 |           if (isFirst) {143 |             roundedClasses = 'rounded-r-none';144 |           } else if (isLast) {145 |             roundedClasses = 'rounded-l-none';146 |           } else {147 |             roundedClasses = 'rounded-none';148 |           }149 | 150 |           return React.cloneElement(child, {151 |             className: cn(child.props.className, roundedClasses),152 |           });153 |         }154 |         return child;155 |       })}156 |     </div>157 |   );158 | }159 | 160 | export default BaseInput;
============================================================END: frontend/components/ui/BaseInput.tsx============================================================


============================================================FILE: frontend/components/ui/BaseModal.tsxSIZE: 9.07 KB============================================================
  1 | import React from 'react';  2 | import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';  3 | import { cn } from '@/lib/utils';  4 | import { CheckCircle, AlertTriangle, Info } from 'lucide-react';  5 | import { BaseButton } from './BaseButton';  6 | import { colors } from '@/lib/design-system';  7 |   8 | export interface BaseModalProps {  9 |   isOpen: boolean; 10 |   onClose: () => void; 11 |   title?: string; 12 |   description?: string; 13 |   size?: 'sm' | 'md' | 'lg' | 'xl' | '2xl' | '3xl' | '4xl' | '5xl' | '6xl' | '7xl' | 'full'; 14 |   variant?: 'default' | 'danger' | 'warning' | 'success' | 'info'; 15 |   children: React.ReactNode; 16 |   className?: string; 17 |   showCloseButton?: boolean; 18 |   closeOnOverlayClick?: boolean; 19 |   closeOnEscape?: boolean; 20 | } 21 |  22 | export interface BaseModalHeaderProps { 23 |   children: React.ReactNode; 24 |   className?: string; 25 |   icon?: React.ReactNode; 26 |   variant?: 'default' | 'danger' | 'warning' | 'success' | 'info'; 27 | } 28 |  29 | export interface BaseModalContentProps { 30 |   children: React.ReactNode; 31 |   className?: string; 32 |   padding?: 'none' | 'sm' | 'md' | 'lg'; 33 | } 34 |  35 | export interface BaseModalFooterProps { 36 |   children: React.ReactNode; 37 |   className?: string; 38 |   alignment?: 'left' | 'center' | 'right' | 'between'; 39 | } 40 |  41 | export function BaseModal({ 42 |   isOpen, 43 |   onClose, 44 |   title, 45 |   description, 46 |   size = 'md', 47 |   variant = 'default', 48 |   children, 49 |   className, 50 |  51 |   closeOnOverlayClick = true, 52 |  53 | }: BaseModalProps) { 54 |   const sizeClasses = { 55 |     sm: 'max-w-sm', 56 |     md: 'max-w-md', 57 |     lg: 'max-w-lg', 58 |     xl: 'max-w-xl', 59 |     '2xl': 'max-w-2xl', 60 |     '3xl': 'max-w-3xl', 61 |     '4xl': 'max-w-4xl', 62 |     '5xl': 'max-w-5xl', 63 |     '6xl': 'max-w-6xl', 64 |     '7xl': 'max-w-7xl', 65 |     full: 'max-w-[95vw]', 66 |   }; 67 |  68 |   const variantClasses = { 69 |     default: 'bg-white border-gray-200', 70 |     danger: 'bg-white border-red-500', 71 |     warning: 'bg-white border-yellow-500', 72 |     success: 'bg-white border-green-500', 73 |     info: 'bg-white border-blue-500', 74 |   }; 75 |  76 |   const modalClasses = cn( 77 |     'dashboard-modal', 78 |     sizeClasses[size], 79 |     variantClasses[variant], 80 |     'rounded-lg', 81 |     'shadow-xl', 82 |     'border', 83 |     className 84 |   ); 85 |  86 |   return ( 87 |     <Dialog 88 |       open={isOpen} 89 |       onOpenChange={closeOnOverlayClick ? onClose : undefined} 90 |     > 91 |       <DialogContent className={modalClasses}> 92 |         <DialogHeader> 93 |           <DialogTitle className={cn( 94 |             "dashboard-modal-title text-xl font-bold", 95 |             title ? "text-white" : "sr-only" 96 |           )}> 97 |             {title || "Modal"} 98 |           </DialogTitle> 99 |           {description && (100 |             <DialogDescription className="dashboard-modal-description text-gray-400 text-base">101 |               {description}102 |             </DialogDescription>103 |           )}104 |         </DialogHeader>105 | 106 |         {children}107 |       </DialogContent>108 |     </Dialog>109 |   );110 | }111 | 112 | BaseModal.Header = function BaseModalHeader({113 |   children,114 |   className,115 |   icon,116 |   variant = 'default',117 | }: BaseModalHeaderProps) {118 |   const variantIconColors = {119 |     default: colors.text.primary,120 |     danger: colors.status.error,121 |     warning: colors.status.warning,122 |     success: colors.status.success,123 |     info: colors.status.info,124 |   };125 | 126 |   return (127 |     <div className={cn(`pb-4 border-b border-gray-600/20`, className)}>128 |       <div className="flex items-center gap-2">129 |         {icon && (130 |           <div className={`text-[${variantIconColors[variant]}]`}>131 |             {icon}132 |           </div>133 |         )}134 |         <div className="flex-1">135 |           {children}136 |         </div>137 |       </div>138 |     </div>139 |   );140 | };141 | 142 | BaseModal.Content = function BaseModalContent({143 |   children,144 |   className,145 |   padding = 'md',146 | }: BaseModalContentProps) {147 |   const paddingClasses = {148 |     none: '',149 |     sm: 'p-3',150 |     md: 'p-4',151 |     lg: 'p-6',152 |   };153 | 154 |   return (155 |     <div className={cn(paddingClasses[padding], className)}>156 |       {children}157 |     </div>158 |   );159 | };160 | 161 | BaseModal.Footer = function BaseModalFooter({162 |   children,163 |   className,164 |   alignment = 'right',165 | }: BaseModalFooterProps) {166 |   const alignmentClasses = {167 |     left: 'justify-start',168 |     center: 'justify-center',169 |     right: 'justify-end',170 |     between: 'justify-between',171 |   };172 | 173 |   return (174 |     <div className={cn(175 |       'flex items-center gap-3 pt-4 border-t border-gray-600/20',176 |       alignmentClasses[alignment],177 |       className178 |     )}>179 |       {children}180 |     </div>181 |   );182 | };183 | 184 | export interface ConfirmationModalProps {185 |   isOpen: boolean;186 |   onClose: () => void;187 |   onConfirm: () => void;188 |   title: string;189 |   description: string;190 |   icon?: React.ReactNode;191 |   confirmText?: string;192 |   cancelText?: string;193 |   variant?: 'danger' | 'warning' | 'success' | 'info';194 |   children?: React.ReactNode;195 |   isLoading?: boolean;196 | }197 | 198 | export function ConfirmationModal({199 |   isOpen,200 |   onClose,201 |   onConfirm,202 |   title,203 |   description,204 |   confirmText = 'Confirm',205 |   cancelText = 'Cancel',206 |   variant = 'danger',207 |   icon,208 |   isLoading = false,209 |   children,210 | }: ConfirmationModalProps) {211 |   const variantConfig = {212 |     danger: {213 |       icon: icon || <AlertTriangle className="w-5 h-5" />,214 |       confirmVariant: 'danger' as const,215 |       borderColor: colors.status.error,216 |     },217 |     warning: {218 |       icon: icon || <AlertTriangle className="w-5 h-5" />,219 |       confirmVariant: 'warning' as const,220 |       borderColor: colors.status.warning,221 |     },222 |     success: {223 |       icon: icon || <CheckCircle className="w-5 h-5" />,224 |       confirmVariant: 'success' as const,225 |       borderColor: colors.status.success,226 |     },227 |     info: {228 |       icon: icon || <Info className="w-5 h-5" />,229 |       confirmVariant: 'info' as const,230 |       borderColor: colors.status.info,231 |     },232 |   };233 | 234 |   const config = variantConfig[variant];235 | 236 |   return (237 |     <BaseModal238 |       isOpen={isOpen}239 |       onClose={onClose}240 |       title={title}241 |       description={description}242 |       size="md"243 |       variant={variant}244 |     >245 |       <BaseModal.Content>246 |         {children && (247 |           <div className="mb-4 p-3 bg-gray-600/10 border border-gray-600/30 rounded-md">248 |             {children}249 |           </div>250 |         )}251 |       </BaseModal.Content>252 | 253 |       <BaseModal.Footer>254 |         <BaseButton255 |           variant="outline"256 |           onClick={onClose}257 |           disabled={isLoading}258 |         >259 |           {cancelText}260 |         </BaseButton>261 |         <BaseButton262 |           variant={config.confirmVariant}263 |           onClick={onConfirm}264 |           loading={isLoading}265 |         >266 |           {confirmText}267 |         </BaseButton>268 |       </BaseModal.Footer>269 |     </BaseModal>270 |   );271 | }272 | 273 | export function ModalSection({274 |   children,275 |   className,276 |   title,277 |   icon,278 |   variant = 'default',279 | }: {280 |   children: React.ReactNode;281 |   className?: string;282 |   title?: string;283 |   icon?: React.ReactNode;284 |   variant?: 'default' | 'info' | 'warning' | 'success' | 'error';285 | }) {286 |   const variantClasses = {287 |     default: `bg-[${colors.semantic.surface.secondary}] border-[${colors.border[500]}]`,288 |     info: `bg-[${colors.status.info}]/10 border-[${colors.status.info}]/30`,289 |     warning: `bg-[${colors.status.warning}]/10 border-[${colors.status.warning}]/30`,290 |     success: `bg-[${colors.status.success}]/10 border-[${colors.status.success}]/30`,291 |     error: `bg-[${colors.status.error}]/10 border-[${colors.status.error}]/30`,292 |   };293 | 294 |   return (295 |     <div className={cn(296 |       'p-4 rounded-md border',297 |       variantClasses[variant],298 |       className299 |     )}>300 |       {title && (301 |         <div className="flex items-center gap-2 mb-3">302 |           {icon && <div className="text-gray-400">{icon}</div>}303 |           <h4 className="text-base font-medium text-white">304 |             {title}305 |           </h4>306 |         </div>307 |       )}308 |       {children}309 |     </div>310 |   );311 | }312 | 313 | export default BaseModal;
============================================================END: frontend/components/ui/BaseModal.tsx============================================================


============================================================FILE: frontend/components/ui/FullScreenModal.tsxSIZE: 5.48 KB============================================================
  1 | import React, { useEffect } from 'react';  2 |   3 | import { cn } from '@/lib/utils';  4 | import { X } from 'lucide-react';  5 | import { BaseButton } from './BaseButton';  6 |   7 | export interface FullScreenModalProps {  8 |   isOpen: boolean;  9 |   onClose: () => void; 10 |   title?: string; 11 |   children: React.ReactNode; 12 |   className?: string; 13 |   showCloseButton?: boolean; 14 |   closeOnOverlayClick?: boolean; 15 |   closeOnEscape?: boolean; 16 |   headerContent?: React.ReactNode; 17 |   footerContent?: React.ReactNode; 18 | } 19 |  20 | export function FullScreenModal({ 21 |   isOpen, 22 |   onClose, 23 |   title, 24 |   children, 25 |   className, 26 |   showCloseButton = true, 27 |  28 |   closeOnEscape = true, 29 |   headerContent, 30 |   footerContent, 31 | }: FullScreenModalProps) { 32 |  33 |   useEffect(() => { 34 |     const handleEscape = (event: KeyboardEvent) => { 35 |       if (event.key === 'Escape' && closeOnEscape) { 36 |         onClose(); 37 |       } 38 |     }; 39 |  40 |     if (isOpen) { 41 |       document.addEventListener('keydown', handleEscape); 42 |  43 |       document.body.style.overflow = 'hidden'; 44 |     } 45 |  46 |     return () => { 47 |       document.removeEventListener('keydown', handleEscape); 48 |  49 |       document.body.style.overflow = 'unset'; 50 |     }; 51 |   }, [isOpen, onClose, closeOnEscape]); 52 |  53 |   const modalClasses = cn( 54 |     'fullscreen-modal', 55 |     'fixed inset-0 z-50', 56 |     'bg-gray-900/95 backdrop-blur-sm', 57 |     'flex flex-col', 58 |     className 59 |   ); 60 |  61 |   const contentClasses = cn( 62 |     'fullscreen-modal-content', 63 |     'flex-1 flex flex-col', 64 |     'bg-gray-800', 65 |     'border border-gray-600', 66 |     'shadow-2xl', 67 |     'overflow-hidden' 68 |   ); 69 |  70 |   if (!isOpen) return null; 71 |  72 |   return ( 73 |     <div className={modalClasses}> 74 |       <div className={contentClasses}> 75 |         {} 76 |         {(title || headerContent || showCloseButton) && ( 77 |           <div className="fullscreen-modal-header flex items-center justify-between p-6 border-b border-gray-600 bg-gray-800"> 78 |             <div className="flex items-center space-x-4"> 79 |               {title && ( 80 |                 <h2 className="text-2xl font-bold text-white"> 81 |                   {title} 82 |                 </h2> 83 |               )} 84 |               {headerContent && ( 85 |                 <div className="flex-1"> 86 |                   {headerContent} 87 |                 </div> 88 |               )} 89 |             </div> 90 |  91 |             {showCloseButton && ( 92 |               <BaseButton 93 |                 onClick={onClose} 94 |                 variant="ghost" 95 |                 size="sm" 96 |                 className="text-gray-400 hover:text-white hover:bg-gray-700" 97 |               > 98 |                 <X size={20} /> 99 |               </BaseButton>100 |             )}101 |           </div>102 |         )}103 | 104 |         {}105 |         <div className="fullscreen-modal-body flex-1 overflow-hidden">106 |           {children}107 |         </div>108 | 109 |         {}110 |         {footerContent && (111 |           <div className="fullscreen-modal-footer p-6 border-t border-gray-600 bg-gray-800">112 |             {footerContent}113 |           </div>114 |         )}115 |       </div>116 |     </div>117 |   );118 | }119 | 120 | FullScreenModal.Header = function FullScreenModalHeader({121 |   children,122 |   className,123 | }: {124 |   children: React.ReactNode;125 |   className?: string;126 | }) {127 |   return (128 |     <div className={cn('p-6 border-b border-gray-600 bg-gray-800', className)}>129 |       {children}130 |     </div>131 |   );132 | };133 | 134 | FullScreenModal.Content = function FullScreenModalContent({135 |   children,136 |   className,137 |   padding = 'lg',138 | }: {139 |   children: React.ReactNode;140 |   className?: string;141 |   padding?: 'none' | 'sm' | 'md' | 'lg' | 'xl';142 | }) {143 |   const paddingClasses = {144 |     none: '',145 |     sm: 'p-3',146 |     md: 'p-4',147 |     lg: 'p-6',148 |     xl: 'p-8',149 |   };150 | 151 |   return (152 |     <div className={cn('flex-1 overflow-auto', paddingClasses[padding], className)}>153 |       {children}154 |     </div>155 |   );156 | };157 | 158 | FullScreenModal.Footer = function FullScreenModalFooter({159 |   children,160 |   className,161 |   alignment = 'right',162 | }: {163 |   children: React.ReactNode;164 |   className?: string;165 |   alignment?: 'left' | 'center' | 'right' | 'between';166 | }) {167 |   const alignmentClasses = {168 |     left: 'justify-start',169 |     center: 'justify-center',170 |     right: 'justify-end',171 |     between: 'justify-between',172 |   };173 | 174 |   return (175 |     <div className={cn(176 |       'p-6 border-t border-gray-600 bg-gray-800',177 |       'flex items-center gap-3',178 |       alignmentClasses[alignment],179 |       className180 |     )}>181 |       {children}182 |     </div>183 |   );184 | };185 | 186 | export default FullScreenModal;
============================================================END: frontend/components/ui/FullScreenModal.tsx============================================================


============================================================FILE: frontend/components/ui/accordion.tsxSIZE: 2.01 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as AccordionPrimitive from "@radix-ui/react-accordion";  5 | import { ChevronDownIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function Accordion({ 10 |   ...props 11 | }: React.ComponentProps<typeof AccordionPrimitive.Root>) { 12 |   return <AccordionPrimitive.Root data-slot="accordion" {...props} />; 13 | } 14 |  15 | function AccordionItem({ 16 |   className, 17 |   ...props 18 | }: React.ComponentProps<typeof AccordionPrimitive.Item>) { 19 |   return ( 20 |     <AccordionPrimitive.Item 21 |       data-slot="accordion-item" 22 |       className={cn("border-b last:border-b-0", className)} 23 |       {...props} 24 |     /> 25 |   ); 26 | } 27 |  28 | function AccordionTrigger({ 29 |   className, 30 |   children, 31 |   ...props 32 | }: React.ComponentProps<typeof AccordionPrimitive.Trigger>) { 33 |   return ( 34 |     <AccordionPrimitive.Header className="flex"> 35 |       <AccordionPrimitive.Trigger 36 |         data-slot="accordion-trigger" 37 |         className={cn( 38 |           "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180", 39 |           className, 40 |         )} 41 |         {...props} 42 |       > 43 |         {children} 44 |         <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" /> 45 |       </AccordionPrimitive.Trigger> 46 |     </AccordionPrimitive.Header> 47 |   ); 48 | } 49 |  50 | function AccordionContent({ 51 |   className, 52 |   children, 53 |   ...props 54 | }: React.ComponentProps<typeof AccordionPrimitive.Content>) { 55 |   return ( 56 |     <AccordionPrimitive.Content 57 |       data-slot="accordion-content" 58 |       className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm" 59 |       {...props} 60 |     > 61 |       <div className={cn("pt-0 pb-4", className)}>{children}</div> 62 |     </AccordionPrimitive.Content> 63 |   ); 64 | } 65 |  66 | export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };
============================================================END: frontend/components/ui/accordion.tsx============================================================


============================================================FILE: frontend/components/ui/alert.tsxSIZE: 1.58 KB============================================================
  1 | import * as React from "react";  2 | import { cva, type VariantProps } from "class-variance-authority";  3 |   4 | import { cn } from "./utils";  5 |   6 | const alertVariants = cva(  7 |   "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",  8 |   {  9 |     variants: { 10 |       variant: { 11 |         default: "bg-card text-card-foreground", 12 |         destructive: 13 |           "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90", 14 |       }, 15 |     }, 16 |     defaultVariants: { 17 |       variant: "default", 18 |     }, 19 |   }, 20 | ); 21 |  22 | function Alert({ 23 |   className, 24 |   variant, 25 |   ...props 26 | }: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) { 27 |   return ( 28 |     <div 29 |       data-slot="alert" 30 |       role="alert" 31 |       className={cn(alertVariants({ variant }), className)} 32 |       {...props} 33 |     /> 34 |   ); 35 | } 36 |  37 | function AlertTitle({ className, ...props }: React.ComponentProps<"div">) { 38 |   return ( 39 |     <div 40 |       data-slot="alert-title" 41 |       className={cn( 42 |         "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight", 43 |         className, 44 |       )} 45 |       {...props} 46 |     /> 47 |   ); 48 | } 49 |  50 | function AlertDescription({ 51 |   className, 52 |   ...props 53 | }: React.ComponentProps<"div">) { 54 |   return ( 55 |     <div 56 |       data-slot="alert-description" 57 |       className={cn( 58 |         "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed", 59 |         className, 60 |       )} 61 |       {...props} 62 |     /> 63 |   ); 64 | } 65 |  66 | export { Alert, AlertTitle, AlertDescription };
============================================================END: frontend/components/ui/alert.tsx============================================================


============================================================FILE: frontend/components/ui/badge.tsxSIZE: 1.60 KB============================================================
  1 | import * as React from "react";  2 | import { Slot } from "@radix-ui/react-slot";  3 | import { cva, type VariantProps } from "class-variance-authority";  4 |   5 | import { cn } from "./utils";  6 |   7 | const badgeVariants = cva(  8 |   "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",  9 |   { 10 |     variants: { 11 |       variant: { 12 |         default: 13 |           "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90", 14 |         secondary: 15 |           "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90", 16 |         destructive: 17 |           "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60", 18 |         outline: 19 |           "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground", 20 |       }, 21 |     }, 22 |     defaultVariants: { 23 |       variant: "default", 24 |     }, 25 |   }, 26 | ); 27 |  28 | function Badge({ 29 |   className, 30 |   variant, 31 |   asChild = false, 32 |   ...props 33 | }: React.ComponentProps<"span"> & 34 |   VariantProps<typeof badgeVariants> & { asChild?: boolean }) { 35 |   const Comp = asChild ? Slot : "span"; 36 |  37 |   return ( 38 |     <Comp 39 |       data-slot="badge" 40 |       className={cn(badgeVariants({ variant }), className)} 41 |       {...props} 42 |     /> 43 |   ); 44 | } 45 |  46 | export { Badge, badgeVariants };
============================================================END: frontend/components/ui/badge.tsx============================================================


============================================================FILE: frontend/components/ui/breadcrumb.tsxSIZE: 2.31 KB============================================================
  1 | import * as React from "react";  2 | import { Slot } from "@radix-ui/react-slot";  3 | import { ChevronRight, MoreHorizontal } from "lucide-react";  4 |   5 | import { cn } from "./utils";  6 |   7 | function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {  8 |   return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />;  9 | } 10 |  11 | function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) { 12 |   return ( 13 |     <ol 14 |       data-slot="breadcrumb-list" 15 |       className={cn( 16 |         "text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5", 17 |         className, 18 |       )} 19 |       {...props} 20 |     /> 21 |   ); 22 | } 23 |  24 | function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) { 25 |   return ( 26 |     <li 27 |       data-slot="breadcrumb-item" 28 |       className={cn("inline-flex items-center gap-1.5", className)} 29 |       {...props} 30 |     /> 31 |   ); 32 | } 33 |  34 | function BreadcrumbLink({ 35 |   asChild, 36 |   className, 37 |   ...props 38 | }: React.ComponentProps<"a"> & { 39 |   asChild?: boolean; 40 | }) { 41 |   const Comp = asChild ? Slot : "a"; 42 |  43 |   return ( 44 |     <Comp 45 |       data-slot="breadcrumb-link" 46 |       className={cn("hover:text-foreground transition-colors", className)} 47 |       {...props} 48 |     /> 49 |   ); 50 | } 51 |  52 | function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) { 53 |   return ( 54 |     <span 55 |       data-slot="breadcrumb-page" 56 |       role="link" 57 |       aria-disabled="true" 58 |       aria-current="page" 59 |       className={cn("text-foreground font-normal", className)} 60 |       {...props} 61 |     /> 62 |   ); 63 | } 64 |  65 | function BreadcrumbSeparator({ 66 |   children, 67 |   className, 68 |   ...props 69 | }: React.ComponentProps<"li">) { 70 |   return ( 71 |     <li 72 |       data-slot="breadcrumb-separator" 73 |       role="presentation" 74 |       aria-hidden="true" 75 |       className={cn("[&>svg]:size-3.5", className)} 76 |       {...props} 77 |     > 78 |       {children ?? <ChevronRight />} 79 |     </li> 80 |   ); 81 | } 82 |  83 | function BreadcrumbEllipsis({ 84 |   className, 85 |   ...props 86 | }: React.ComponentProps<"span">) { 87 |   return ( 88 |     <span 89 |       data-slot="breadcrumb-ellipsis" 90 |       role="presentation" 91 |       aria-hidden="true" 92 |       className={cn("flex size-9 items-center justify-center", className)} 93 |       {...props} 94 |     > 95 |       <MoreHorizontal className="size-4" /> 96 |       <span className="sr-only">More</span> 97 |     </span> 98 |   ); 99 | }100 | 101 | export {102 |   Breadcrumb,103 |   BreadcrumbList,104 |   BreadcrumbItem,105 |   BreadcrumbLink,106 |   BreadcrumbPage,107 |   BreadcrumbSeparator,108 |   BreadcrumbEllipsis,109 | };
============================================================END: frontend/components/ui/breadcrumb.tsx============================================================


============================================================FILE: frontend/components/ui/button.tsxSIZE: 2.06 KB============================================================
  1 | import * as React from "react";  2 | import { Slot } from "@radix-ui/react-slot";  3 | import { cva, type VariantProps } from "class-variance-authority";  4 |   5 | import { cn } from "./utils";  6 |   7 | const buttonVariants = cva(  8 |   "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",  9 |   { 10 |     variants: { 11 |       variant: { 12 |         default: "bg-primary text-primary-foreground hover:bg-primary/90", 13 |         destructive: 14 |           "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60", 15 |         outline: 16 |           "border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50", 17 |         secondary: 18 |           "bg-secondary text-secondary-foreground hover:bg-secondary/80", 19 |         ghost: 20 |           "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50", 21 |         link: "text-primary underline-offset-4 hover:underline", 22 |       }, 23 |       size: { 24 |         default: "h-9 px-4 py-2 has-[>svg]:px-3", 25 |         sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5", 26 |         lg: "h-10 rounded-md px-6 has-[>svg]:px-4", 27 |         icon: "size-9 rounded-md", 28 |       }, 29 |     }, 30 |     defaultVariants: { 31 |       variant: "default", 32 |       size: "default", 33 |     }, 34 |   }, 35 | ); 36 |  37 | function Button({ 38 |   className, 39 |   variant, 40 |   size, 41 |   asChild = false, 42 |   ...props 43 | }: React.ComponentProps<"button"> & 44 |   VariantProps<typeof buttonVariants> & { 45 |     asChild?: boolean; 46 |   }) { 47 |   const Comp = asChild ? Slot : "button"; 48 |  49 |   return ( 50 |     <Comp 51 |       data-slot="button" 52 |       className={cn(buttonVariants({ variant, size, className }))} 53 |       {...props} 54 |     /> 55 |   ); 56 | } 57 |  58 | export { Button, buttonVariants };
============================================================END: frontend/components/ui/button.tsx============================================================


============================================================FILE: frontend/components/ui/calendar.tsxSIZE: 2.84 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import { ChevronLeft, ChevronRight } from "lucide-react";  5 | import { DayPicker } from "react-day-picker";  6 |   7 | import { cn } from "./utils";  8 | import { buttonVariants } from "./button";  9 |  10 | function Calendar({ 11 |   className, 12 |   classNames, 13 |   showOutsideDays = true, 14 |   ...props 15 | }: React.ComponentProps<typeof DayPicker>) { 16 |   return ( 17 |     <DayPicker 18 |       showOutsideDays={showOutsideDays} 19 |       className={cn("p-3", className)} 20 |       classNames={{ 21 |         months: "flex flex-col sm:flex-row gap-2", 22 |         month: "flex flex-col gap-4", 23 |         caption: "flex justify-center pt-1 relative items-center w-full", 24 |         caption_label: "text-sm font-medium", 25 |         nav: "flex items-center gap-1", 26 |         nav_button: cn( 27 |           buttonVariants({ variant: "outline" }), 28 |           "size-7 bg-transparent p-0 opacity-50 hover:opacity-100", 29 |         ), 30 |         nav_button_previous: "absolute left-1", 31 |         nav_button_next: "absolute right-1", 32 |         table: "w-full border-collapse space-x-1", 33 |         head_row: "flex", 34 |         head_cell: 35 |           "text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]", 36 |         row: "flex w-full mt-2", 37 |         cell: cn( 38 |           "relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md", 39 |           props.mode === "range" 40 |             ? "[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md" 41 |             : "[&:has([aria-selected])]:rounded-md", 42 |         ), 43 |         day: cn( 44 |           buttonVariants({ variant: "ghost" }), 45 |           "size-8 p-0 font-normal aria-selected:opacity-100", 46 |         ), 47 |         day_range_start: 48 |           "day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground", 49 |         day_range_end: 50 |           "day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground", 51 |         day_selected: 52 |           "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground", 53 |         day_today: "bg-accent text-accent-foreground", 54 |         day_outside: 55 |           "day-outside text-muted-foreground aria-selected:text-muted-foreground", 56 |         day_disabled: "text-muted-foreground opacity-50", 57 |         day_range_middle: 58 |           "aria-selected:bg-accent aria-selected:text-accent-foreground", 59 |         day_hidden: "invisible", 60 |         ...classNames, 61 |       }} 62 |       components={{ 63 |         IconLeft: ({ className, ...props }) => ( 64 |           <ChevronLeft className={cn("size-4", className)} {...props} /> 65 |         ), 66 |         IconRight: ({ className, ...props }) => ( 67 |           <ChevronRight className={cn("size-4", className)} {...props} /> 68 |         ), 69 |       }} 70 |       {...props} 71 |     /> 72 |   ); 73 | } 74 |  75 | export { Calendar };
============================================================END: frontend/components/ui/calendar.tsx============================================================


============================================================FILE: frontend/components/ui/card.tsxSIZE: 1.94 KB============================================================
  1 | import * as React from "react";  2 |   3 | import { cn } from "./utils";  4 |   5 | function Card({ className, ...props }: React.ComponentProps<"div">) {  6 |   return (  7 |     <div  8 |       data-slot="card"  9 |       className={cn( 10 |         "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border", 11 |         className, 12 |       )} 13 |       {...props} 14 |     /> 15 |   ); 16 | } 17 |  18 | function CardHeader({ className, ...props }: React.ComponentProps<"div">) { 19 |   return ( 20 |     <div 21 |       data-slot="card-header" 22 |       className={cn( 23 |         "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6", 24 |         className, 25 |       )} 26 |       {...props} 27 |     /> 28 |   ); 29 | } 30 |  31 | function CardTitle({ className, ...props }: React.ComponentProps<"div">) { 32 |   return ( 33 |     <h4 34 |       data-slot="card-title" 35 |       className={cn("leading-none", className)} 36 |       {...props} 37 |     /> 38 |   ); 39 | } 40 |  41 | function CardDescription({ className, ...props }: React.ComponentProps<"div">) { 42 |   return ( 43 |     <p 44 |       data-slot="card-description" 45 |       className={cn("text-muted-foreground", className)} 46 |       {...props} 47 |     /> 48 |   ); 49 | } 50 |  51 | function CardAction({ className, ...props }: React.ComponentProps<"div">) { 52 |   return ( 53 |     <div 54 |       data-slot="card-action" 55 |       className={cn( 56 |         "col-start-2 row-span-2 row-start-1 self-start justify-self-end", 57 |         className, 58 |       )} 59 |       {...props} 60 |     /> 61 |   ); 62 | } 63 |  64 | function CardContent({ className, ...props }: React.ComponentProps<"div">) { 65 |   return ( 66 |     <div 67 |       data-slot="card-content" 68 |       className={cn("px-6 [&:last-child]:pb-6", className)} 69 |       {...props} 70 |     /> 71 |   ); 72 | } 73 |  74 | function CardFooter({ className, ...props }: React.ComponentProps<"div">) { 75 |   return ( 76 |     <div 77 |       data-slot="card-footer" 78 |       className={cn("flex items-center px-6 pb-6 [.border-t]:pt-6", className)} 79 |       {...props} 80 |     /> 81 |   ); 82 | } 83 |  84 | export { 85 |   Card, 86 |   CardHeader, 87 |   CardFooter, 88 |   CardTitle, 89 |   CardAction, 90 |   CardDescription, 91 |   CardContent, 92 | };
============================================================END: frontend/components/ui/card.tsx============================================================


============================================================FILE: frontend/components/ui/carousel.tsxSIZE: 5.47 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import useEmblaCarousel, {  5 |   type UseEmblaCarouselType,  6 | } from "embla-carousel-react";  7 | import { ArrowLeft, ArrowRight } from "lucide-react";  8 |   9 | import { cn } from "./utils"; 10 | import { Button } from "./button"; 11 |  12 | type CarouselApi = UseEmblaCarouselType[1]; 13 | type UseCarouselParameters = Parameters<typeof useEmblaCarousel>; 14 | type CarouselOptions = UseCarouselParameters[0]; 15 | type CarouselPlugin = UseCarouselParameters[1]; 16 |  17 | type CarouselProps = { 18 |   opts?: CarouselOptions; 19 |   plugins?: CarouselPlugin; 20 |   orientation?: "horizontal" | "vertical"; 21 |   setApi?: (api: CarouselApi) => void; 22 | }; 23 |  24 | type CarouselContextProps = { 25 |   carouselRef: ReturnType<typeof useEmblaCarousel>[0]; 26 |   api: ReturnType<typeof useEmblaCarousel>[1]; 27 |   scrollPrev: () => void; 28 |   scrollNext: () => void; 29 |   canScrollPrev: boolean; 30 |   canScrollNext: boolean; 31 | } & CarouselProps; 32 |  33 | const CarouselContext = React.createContext<CarouselContextProps | null>(null); 34 |  35 | function useCarousel() { 36 |   const context = React.useContext(CarouselContext); 37 |  38 |   if (!context) { 39 |     throw new Error("useCarousel must be used within a <Carousel />"); 40 |   } 41 |  42 |   return context; 43 | } 44 |  45 | function Carousel({ 46 |   orientation = "horizontal", 47 |   opts, 48 |   setApi, 49 |   plugins, 50 |   className, 51 |   children, 52 |   ...props 53 | }: React.ComponentProps<"div"> & CarouselProps) { 54 |   const [carouselRef, api] = useEmblaCarousel( 55 |     { 56 |       ...opts, 57 |       axis: orientation === "horizontal" ? "x" : "y", 58 |     }, 59 |     plugins, 60 |   ); 61 |   const [canScrollPrev, setCanScrollPrev] = React.useState(false); 62 |   const [canScrollNext, setCanScrollNext] = React.useState(false); 63 |  64 |   const onSelect = React.useCallback((api: CarouselApi) => { 65 |     if (!api) return; 66 |     setCanScrollPrev(api.canScrollPrev()); 67 |     setCanScrollNext(api.canScrollNext()); 68 |   }, []); 69 |  70 |   const scrollPrev = React.useCallback(() => { 71 |     api?.scrollPrev(); 72 |   }, [api]); 73 |  74 |   const scrollNext = React.useCallback(() => { 75 |     api?.scrollNext(); 76 |   }, [api]); 77 |  78 |   const handleKeyDown = React.useCallback( 79 |     (event: React.KeyboardEvent<HTMLDivElement>) => { 80 |       if (event.key === "ArrowLeft") { 81 |         event.preventDefault(); 82 |         scrollPrev(); 83 |       } else if (event.key === "ArrowRight") { 84 |         event.preventDefault(); 85 |         scrollNext(); 86 |       } 87 |     }, 88 |     [scrollPrev, scrollNext], 89 |   ); 90 |  91 |   React.useEffect(() => { 92 |     if (!api || !setApi) return; 93 |     setApi(api); 94 |   }, [api, setApi]); 95 |  96 |   React.useEffect(() => { 97 |     if (!api) return; 98 |     onSelect(api); 99 |     api.on("reInit", onSelect);100 |     api.on("select", onSelect);101 | 102 |     return () => {103 |       api?.off("select", onSelect);104 |     };105 |   }, [api, onSelect]);106 | 107 |   return (108 |     <CarouselContext.Provider109 |       value={{110 |         carouselRef,111 |         api: api,112 |         opts,113 |         orientation:114 |           orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),115 |         scrollPrev,116 |         scrollNext,117 |         canScrollPrev,118 |         canScrollNext,119 |       }}120 |     >121 |       <div122 |         onKeyDownCapture={handleKeyDown}123 |         className={cn("relative", className)}124 |         role="region"125 |         aria-roledescription="carousel"126 |         data-slot="carousel"127 |         {...props}128 |       >129 |         {children}130 |       </div>131 |     </CarouselContext.Provider>132 |   );133 | }134 | 135 | function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {136 |   const { carouselRef, orientation } = useCarousel();137 | 138 |   return (139 |     <div140 |       ref={carouselRef}141 |       className="overflow-hidden"142 |       data-slot="carousel-content"143 |     >144 |       <div145 |         className={cn(146 |           "flex",147 |           orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",148 |           className,149 |         )}150 |         {...props}151 |       />152 |     </div>153 |   );154 | }155 | 156 | function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {157 |   const { orientation } = useCarousel();158 | 159 |   return (160 |     <div161 |       role="group"162 |       aria-roledescription="slide"163 |       data-slot="carousel-item"164 |       className={cn(165 |         "min-w-0 shrink-0 grow-0 basis-full",166 |         orientation === "horizontal" ? "pl-4" : "pt-4",167 |         className,168 |       )}169 |       {...props}170 |     />171 |   );172 | }173 | 174 | function CarouselPrevious({175 |   className,176 |   variant = "outline",177 |   size = "icon",178 |   ...props179 | }: React.ComponentProps<typeof Button>) {180 |   const { orientation, scrollPrev, canScrollPrev } = useCarousel();181 | 182 |   return (183 |     <Button184 |       data-slot="carousel-previous"185 |       variant={variant}186 |       size={size}187 |       className={cn(188 |         "absolute size-8 rounded-full",189 |         orientation === "horizontal"190 |           ? "top-1/2 -left-12 -translate-y-1/2"191 |           : "-top-12 left-1/2 -translate-x-1/2 rotate-90",192 |         className,193 |       )}194 |       disabled={!canScrollPrev}195 |       onClick={scrollPrev}196 |       {...props}197 |     >198 |       <ArrowLeft />199 |       <span className="sr-only">Previous slide</span>200 |     </Button>201 |   );202 | }203 | 204 | function CarouselNext({205 |   className,206 |   variant = "outline",207 |   size = "icon",208 |   ...props209 | }: React.ComponentProps<typeof Button>) {210 |   const { orientation, scrollNext, canScrollNext } = useCarousel();211 | 212 |   return (213 |     <Button214 |       data-slot="carousel-next"215 |       variant={variant}216 |       size={size}217 |       className={cn(218 |         "absolute size-8 rounded-full",219 |         orientation === "horizontal"220 |           ? "top-1/2 -right-12 -translate-y-1/2"221 |           : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",222 |         className,223 |       )}224 |       disabled={!canScrollNext}225 |       onClick={scrollNext}226 |       {...props}227 |     >228 |       <ArrowRight />229 |       <span className="sr-only">Next slide</span>230 |     </Button>231 |   );232 | }233 | 234 | export {235 |   type CarouselApi,236 |   Carousel,237 |   CarouselContent,238 |   CarouselItem,239 |   CarouselPrevious,240 |   CarouselNext,241 | };
============================================================END: frontend/components/ui/carousel.tsx============================================================


============================================================FILE: frontend/components/ui/chart.tsxSIZE: 9.62 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as RechartsPrimitive from "recharts";  5 |   6 | import { cn } from "./utils";  7 |   8 | const THEMES = { light: "", dark: ".dark" } as const;  9 |  10 | export type ChartConfig = { 11 |   [k in string]: { 12 |     label?: React.ReactNode; 13 |     icon?: React.ComponentType; 14 |   } & ( 15 |     | { color?: string; theme?: never } 16 |     | { color?: never; theme: Record<keyof typeof THEMES, string> } 17 |   ); 18 | }; 19 |  20 | type ChartContextProps = { 21 |   config: ChartConfig; 22 | }; 23 |  24 | const ChartContext = React.createContext<ChartContextProps | null>(null); 25 |  26 | function useChart() { 27 |   const context = React.useContext(ChartContext); 28 |  29 |   if (!context) { 30 |     throw new Error("useChart must be used within a <ChartContainer />"); 31 |   } 32 |  33 |   return context; 34 | } 35 |  36 | function ChartContainer({ 37 |   id, 38 |   className, 39 |   children, 40 |   config, 41 |   ...props 42 | }: React.ComponentProps<"div"> & { 43 |   config: ChartConfig; 44 |   children: React.ComponentProps< 45 |     typeof RechartsPrimitive.ResponsiveContainer 46 |   >["children"]; 47 | }) { 48 |   const uniqueId = React.useId(); 49 |   const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`; 50 |  51 |   return ( 52 |     <ChartContext.Provider value={{ config }}> 53 |       <div 54 |         data-slot="chart" 55 |         data-chart={chartId} 56 |         className={cn( 57 |           "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden", 58 |           className, 59 |         )} 60 |         {...props} 61 |       > 62 |         <ChartStyle id={chartId} config={config} /> 63 |         <RechartsPrimitive.ResponsiveContainer> 64 |           {children} 65 |         </RechartsPrimitive.ResponsiveContainer> 66 |       </div> 67 |     </ChartContext.Provider> 68 |   ); 69 | } 70 |  71 | const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => { 72 |   const colorConfig = Object.entries(config).filter( 73 |     ([, config]) => config.theme || config.color, 74 |   ); 75 |  76 |   if (!colorConfig.length) { 77 |     return null; 78 |   } 79 |  80 |   return ( 81 |     <style 82 |       dangerouslySetInnerHTML={{ 83 |         __html: Object.entries(THEMES) 84 |           .map( 85 |             ([theme, prefix]) => ` 86 | ${prefix} [data-chart=${id}] { 87 | ${colorConfig 88 |   .map(([key, itemConfig]) => { 89 |     const color = 90 |       itemConfig.theme?.[theme as keyof typeof itemConfig.theme] || 91 |       itemConfig.color; 92 |     return color ? `  --color-${key}: ${color};` : null; 93 |   }) 94 |   .join("\n")} 95 | } 96 | `, 97 |           ) 98 |           .join("\n"), 99 |       }}100 |     />101 |   );102 | };103 | 104 | const ChartTooltip = RechartsPrimitive.Tooltip;105 | 106 | function ChartTooltipContent({107 |   active,108 |   payload,109 |   className,110 |   indicator = "dot",111 |   hideLabel = false,112 |   hideIndicator = false,113 |   label,114 |   labelFormatter,115 |   labelClassName,116 |   formatter,117 |   color,118 |   nameKey,119 |   labelKey,120 | }: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &121 |   React.ComponentProps<"div"> & {122 |     hideLabel?: boolean;123 |     hideIndicator?: boolean;124 |     indicator?: "line" | "dot" | "dashed";125 |     nameKey?: string;126 |     labelKey?: string;127 |   }) {128 |   const { config } = useChart();129 | 130 |   const tooltipLabel = React.useMemo(() => {131 |     if (hideLabel || !payload?.length) {132 |       return null;133 |     }134 | 135 |     const [item] = payload;136 |     const key = `${labelKey || item?.dataKey || item?.name || "value"}`;137 |     const itemConfig = getPayloadConfigFromPayload(config, item, key);138 |     const value =139 |       !labelKey && typeof label === "string"140 |         ? config[label as keyof typeof config]?.label || label141 |         : itemConfig?.label;142 | 143 |     if (labelFormatter) {144 |       return (145 |         <div className={cn("font-medium", labelClassName)}>146 |           {labelFormatter(value, payload)}147 |         </div>148 |       );149 |     }150 | 151 |     if (!value) {152 |       return null;153 |     }154 | 155 |     return <div className={cn("font-medium", labelClassName)}>{value}</div>;156 |   }, [157 |     label,158 |     labelFormatter,159 |     payload,160 |     hideLabel,161 |     labelClassName,162 |     config,163 |     labelKey,164 |   ]);165 | 166 |   if (!active || !payload?.length) {167 |     return null;168 |   }169 | 170 |   const nestLabel = payload.length === 1 && indicator !== "dot";171 | 172 |   return (173 |     <div174 |       className={cn(175 |         "border-slate-200/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",176 |         className,177 |       )}178 |     >179 |       {!nestLabel ? tooltipLabel : null}180 |       <div className="grid gap-1.5">181 |         {payload.map((item, index) => {182 |           const key = `${nameKey || item.name || item.dataKey || "value"}`;183 |           const itemConfig = getPayloadConfigFromPayload(config, item, key);184 |           const indicatorColor = color || item.payload.fill || item.color;185 | 186 |           return (187 |             <div188 |               key={item.dataKey}189 |               className={cn(190 |                 "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",191 |                 indicator === "dot" && "items-center",192 |               )}193 |             >194 |               {formatter && item?.value !== undefined && item.name ? (195 |                 formatter(item.value, item.name, item, index, item.payload)196 |               ) : (197 |                 <>198 |                   {itemConfig?.icon ? (199 |                     <itemConfig.icon />200 |                   ) : (201 |                     !hideIndicator && (202 |                       <div203 |                         className={cn(204 |                           "shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",205 |                           {206 |                             "h-2.5 w-2.5": indicator === "dot",207 |                             "w-1": indicator === "line",208 |                             "w-0 border-[1.5px] border-dashed bg-transparent":209 |                               indicator === "dashed",210 |                             "my-0.5": nestLabel && indicator === "dashed",211 |                           },212 |                         )}213 |                         style={214 |                           {215 |                             "--color-bg": indicatorColor,216 |                             "--color-border": indicatorColor,217 |                           } as React.CSSProperties218 |                         }219 |                       />220 |                     )221 |                   )}222 |                   <div223 |                     className={cn(224 |                       "flex flex-1 justify-between leading-none",225 |                       nestLabel ? "items-end" : "items-center",226 |                     )}227 |                   >228 |                     <div className="grid gap-1.5">229 |                       {nestLabel ? tooltipLabel : null}230 |                       <span className="text-muted-foreground">231 |                         {itemConfig?.label || item.name}232 |                       </span>233 |                     </div>234 |                     {item.value && (235 |                       <span className="text-foreground font-mono font-medium tabular-nums">236 |                         {item.value.toLocaleString()}237 |                       </span>238 |                     )}239 |                   </div>240 |                 </>241 |               )}242 |             </div>243 |           );244 |         })}245 |       </div>246 |     </div>247 |   );248 | }249 | 250 | const ChartLegend = RechartsPrimitive.Legend;251 | 252 | function ChartLegendContent({253 |   className,254 |   hideIcon = false,255 |   payload,256 |   verticalAlign = "bottom",257 |   nameKey,258 | }: React.ComponentProps<"div"> &259 |   Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {260 |     hideIcon?: boolean;261 |     nameKey?: string;262 |   }) {263 |   const { config } = useChart();264 | 265 |   if (!payload?.length) {266 |     return null;267 |   }268 | 269 |   return (270 |     <div271 |       className={cn(272 |         "flex items-center justify-center gap-4",273 |         verticalAlign === "top" ? "pb-3" : "pt-3",274 |         className,275 |       )}276 |     >277 |       {payload.map((item) => {278 |         const key = `${nameKey || item.dataKey || "value"}`;279 |         const itemConfig = getPayloadConfigFromPayload(config, item, key);280 | 281 |         return (282 |           <div283 |             key={item.value}284 |             className={cn(285 |               "[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3",286 |             )}287 |           >288 |             {itemConfig?.icon && !hideIcon ? (289 |               <itemConfig.icon />290 |             ) : (291 |               <div292 |                 className="h-2 w-2 shrink-0 rounded-[2px]"293 |                 style={{294 |                   backgroundColor: item.color,295 |                 }}296 |               />297 |             )}298 |             {itemConfig?.label}299 |           </div>300 |         );301 |       })}302 |     </div>303 |   );304 | }305 | 306 | function getPayloadConfigFromPayload(307 |   config: ChartConfig,308 |   payload: unknown,309 |   key: string,310 | ) {311 |   if (typeof payload !== "object" || payload === null) {312 |     return undefined;313 |   }314 | 315 |   const payloadPayload =316 |     "payload" in payload &&317 |     typeof payload.payload === "object" &&318 |     payload.payload !== null319 |       ? payload.payload320 |       : undefined;321 | 322 |   let configLabelKey: string = key;323 | 324 |   if (325 |     key in payload &&326 |     typeof payload[key as keyof typeof payload] === "string"327 |   ) {328 |     configLabelKey = payload[key as keyof typeof payload] as string;329 |   } else if (330 |     payloadPayload &&331 |     key in payloadPayload &&332 |     typeof payloadPayload[key as keyof typeof payloadPayload] === "string"333 |   ) {334 |     configLabelKey = payloadPayload[335 |       key as keyof typeof payloadPayload336 |     ] as string;337 |   }338 | 339 |   return configLabelKey in config340 |     ? config[configLabelKey]341 |     : config[key as keyof typeof config];342 | }343 | 344 | export {345 |   ChartContainer,346 |   ChartTooltip,347 |   ChartTooltipContent,348 |   ChartLegend,349 |   ChartLegendContent,350 |   ChartStyle,351 | };
============================================================END: frontend/components/ui/chart.tsx============================================================


============================================================FILE: frontend/components/ui/checkbox.tsxSIZE: 1.21 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as CheckboxPrimitive from "@radix-ui/react-checkbox";  5 | import { CheckIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function Checkbox({ 10 |   className, 11 |   ...props 12 | }: React.ComponentProps<typeof CheckboxPrimitive.Root>) { 13 |   return ( 14 |     <CheckboxPrimitive.Root 15 |       data-slot="checkbox" 16 |       className={cn( 17 |         "peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50", 18 |         className, 19 |       )} 20 |       {...props} 21 |     > 22 |       <CheckboxPrimitive.Indicator 23 |         data-slot="checkbox-indicator" 24 |         className="flex items-center justify-center text-current transition-none" 25 |       > 26 |         <CheckIcon className="size-3.5" /> 27 |       </CheckboxPrimitive.Indicator> 28 |     </CheckboxPrimitive.Root> 29 |   ); 30 | } 31 |  32 | export { Checkbox };
============================================================END: frontend/components/ui/checkbox.tsx============================================================


============================================================FILE: frontend/components/ui/collapsible.tsxSIZE: 0.79 KB============================================================
  1 | "use client";  2 |   3 | import * as CollapsiblePrimitive from "@radix-ui/react-collapsible";  4 |   5 | function Collapsible({  6 |   ...props  7 | }: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {  8 |   return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />;  9 | } 10 |  11 | function CollapsibleTrigger({ 12 |   ...props 13 | }: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) { 14 |   return ( 15 |     <CollapsiblePrimitive.CollapsibleTrigger 16 |       data-slot="collapsible-trigger" 17 |       {...props} 18 |     /> 19 |   ); 20 | } 21 |  22 | function CollapsibleContent({ 23 |   ...props 24 | }: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) { 25 |   return ( 26 |     <CollapsiblePrimitive.CollapsibleContent 27 |       data-slot="collapsible-content" 28 |       {...props} 29 |     /> 30 |   ); 31 | } 32 |  33 | export { Collapsible, CollapsibleTrigger, CollapsibleContent };
============================================================END: frontend/components/ui/collapsible.tsx============================================================


============================================================FILE: frontend/components/ui/command.tsxSIZE: 4.55 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import { Command as CommandPrimitive } from "cmdk";  5 | import { SearchIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 | import {  9 |   Dialog, 10 |   DialogContent, 11 |   DialogDescription, 12 |   DialogHeader, 13 |   DialogTitle, 14 | } from "./dialog"; 15 |  16 | function Command({ 17 |   className, 18 |   ...props 19 | }: React.ComponentProps<typeof CommandPrimitive>) { 20 |   return ( 21 |     <CommandPrimitive 22 |       data-slot="command" 23 |       className={cn( 24 |         "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md", 25 |         className, 26 |       )} 27 |       {...props} 28 |     /> 29 |   ); 30 | } 31 |  32 | function CommandDialog({ 33 |   title = "Command Palette", 34 |   description = "Search for a command to run...", 35 |   children, 36 |   ...props 37 | }: React.ComponentProps<typeof Dialog> & { 38 |   title?: string; 39 |   description?: string; 40 | }) { 41 |   return ( 42 |     <Dialog {...props}> 43 |       <DialogHeader className="sr-only"> 44 |         <DialogTitle>{title}</DialogTitle> 45 |         <DialogDescription>{description}</DialogDescription> 46 |       </DialogHeader> 47 |       <DialogContent className="overflow-hidden p-0"> 48 |         <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5"> 49 |           {children} 50 |         </Command> 51 |       </DialogContent> 52 |     </Dialog> 53 |   ); 54 | } 55 |  56 | function CommandInput({ 57 |   className, 58 |   ...props 59 | }: React.ComponentProps<typeof CommandPrimitive.Input>) { 60 |   return ( 61 |     <div 62 |       data-slot="command-input-wrapper" 63 |       className="flex h-9 items-center gap-2 border-b px-3" 64 |     > 65 |       <SearchIcon className="size-4 shrink-0 opacity-50" /> 66 |       <CommandPrimitive.Input 67 |         data-slot="command-input" 68 |         className={cn( 69 |           "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50", 70 |           className, 71 |         )} 72 |         {...props} 73 |       /> 74 |     </div> 75 |   ); 76 | } 77 |  78 | function CommandList({ 79 |   className, 80 |   ...props 81 | }: React.ComponentProps<typeof CommandPrimitive.List>) { 82 |   return ( 83 |     <CommandPrimitive.List 84 |       data-slot="command-list" 85 |       className={cn( 86 |         "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto", 87 |         className, 88 |       )} 89 |       {...props} 90 |     /> 91 |   ); 92 | } 93 |  94 | function CommandEmpty({ 95 |   ...props 96 | }: React.ComponentProps<typeof CommandPrimitive.Empty>) { 97 |   return ( 98 |     <CommandPrimitive.Empty 99 |       data-slot="command-empty"100 |       className="py-6 text-center text-sm"101 |       {...props}102 |     />103 |   );104 | }105 | 106 | function CommandGroup({107 |   className,108 |   ...props109 | }: React.ComponentProps<typeof CommandPrimitive.Group>) {110 |   return (111 |     <CommandPrimitive.Group112 |       data-slot="command-group"113 |       className={cn(114 |         "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",115 |         className,116 |       )}117 |       {...props}118 |     />119 |   );120 | }121 | 122 | function CommandSeparator({123 |   className,124 |   ...props125 | }: React.ComponentProps<typeof CommandPrimitive.Separator>) {126 |   return (127 |     <CommandPrimitive.Separator128 |       data-slot="command-separator"129 |       className={cn("bg-border -mx-1 h-px", className)}130 |       {...props}131 |     />132 |   );133 | }134 | 135 | function CommandItem({136 |   className,137 |   ...props138 | }: React.ComponentProps<typeof CommandPrimitive.Item>) {139 |   return (140 |     <CommandPrimitive.Item141 |       data-slot="command-item"142 |       className={cn(143 |         "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",144 |         className,145 |       )}146 |       {...props}147 |     />148 |   );149 | }150 | 151 | function CommandShortcut({152 |   className,153 |   ...props154 | }: React.ComponentProps<"span">) {155 |   return (156 |     <span157 |       data-slot="command-shortcut"158 |       className={cn(159 |         "text-muted-foreground ml-auto text-xs tracking-widest",160 |         className,161 |       )}162 |       {...props}163 |     />164 |   );165 | }166 | 167 | export {168 |   Command,169 |   CommandDialog,170 |   CommandInput,171 |   CommandList,172 |   CommandEmpty,173 |   CommandGroup,174 |   CommandItem,175 |   CommandShortcut,176 |   CommandSeparator,177 | };
============================================================END: frontend/components/ui/command.tsx============================================================


============================================================FILE: frontend/components/ui/context-menu.tsxSIZE: 8.06 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as ContextMenuPrimitive from "@radix-ui/react-context-menu";  5 | import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function ContextMenu({ 10 |   ...props 11 | }: React.ComponentProps<typeof ContextMenuPrimitive.Root>) { 12 |   return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />; 13 | } 14 |  15 | function ContextMenuTrigger({ 16 |   ...props 17 | }: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) { 18 |   return ( 19 |     <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} /> 20 |   ); 21 | } 22 |  23 | function ContextMenuGroup({ 24 |   ...props 25 | }: React.ComponentProps<typeof ContextMenuPrimitive.Group>) { 26 |   return ( 27 |     <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} /> 28 |   ); 29 | } 30 |  31 | function ContextMenuPortal({ 32 |   ...props 33 | }: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) { 34 |   return ( 35 |     <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} /> 36 |   ); 37 | } 38 |  39 | function ContextMenuSub({ 40 |   ...props 41 | }: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) { 42 |   return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />; 43 | } 44 |  45 | function ContextMenuRadioGroup({ 46 |   ...props 47 | }: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) { 48 |   return ( 49 |     <ContextMenuPrimitive.RadioGroup 50 |       data-slot="context-menu-radio-group" 51 |       {...props} 52 |     /> 53 |   ); 54 | } 55 |  56 | function ContextMenuSubTrigger({ 57 |   className, 58 |   inset, 59 |   children, 60 |   ...props 61 | }: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & { 62 |   inset?: boolean; 63 | }) { 64 |   return ( 65 |     <ContextMenuPrimitive.SubTrigger 66 |       data-slot="context-menu-sub-trigger" 67 |       data-inset={inset} 68 |       className={cn( 69 |         "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4", 70 |         className, 71 |       )} 72 |       {...props} 73 |     > 74 |       {children} 75 |       <ChevronRightIcon className="ml-auto" /> 76 |     </ContextMenuPrimitive.SubTrigger> 77 |   ); 78 | } 79 |  80 | function ContextMenuSubContent({ 81 |   className, 82 |   ...props 83 | }: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) { 84 |   return ( 85 |     <ContextMenuPrimitive.SubContent 86 |       data-slot="context-menu-sub-content" 87 |       className={cn( 88 |         "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg", 89 |         className, 90 |       )} 91 |       {...props} 92 |     /> 93 |   ); 94 | } 95 |  96 | function ContextMenuContent({ 97 |   className, 98 |   ...props 99 | }: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {100 |   return (101 |     <ContextMenuPrimitive.Portal>102 |       <ContextMenuPrimitive.Content103 |         data-slot="context-menu-content"104 |         className={cn(105 |           "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",106 |           className,107 |         )}108 |         {...props}109 |       />110 |     </ContextMenuPrimitive.Portal>111 |   );112 | }113 | 114 | function ContextMenuItem({115 |   className,116 |   inset,117 |   variant = "default",118 |   ...props119 | }: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {120 |   inset?: boolean;121 |   variant?: "default" | "destructive";122 | }) {123 |   return (124 |     <ContextMenuPrimitive.Item125 |       data-slot="context-menu-item"126 |       data-inset={inset}127 |       data-variant={variant}128 |       className={cn(129 |         "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",130 |         className,131 |       )}132 |       {...props}133 |     />134 |   );135 | }136 | 137 | function ContextMenuCheckboxItem({138 |   className,139 |   children,140 |   checked,141 |   ...props142 | }: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {143 |   return (144 |     <ContextMenuPrimitive.CheckboxItem145 |       data-slot="context-menu-checkbox-item"146 |       className={cn(147 |         "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",148 |         className,149 |       )}150 |       checked={checked}151 |       {...props}152 |     >153 |       <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">154 |         <ContextMenuPrimitive.ItemIndicator>155 |           <CheckIcon className="size-4" />156 |         </ContextMenuPrimitive.ItemIndicator>157 |       </span>158 |       {children}159 |     </ContextMenuPrimitive.CheckboxItem>160 |   );161 | }162 | 163 | function ContextMenuRadioItem({164 |   className,165 |   children,166 |   ...props167 | }: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {168 |   return (169 |     <ContextMenuPrimitive.RadioItem170 |       data-slot="context-menu-radio-item"171 |       className={cn(172 |         "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",173 |         className,174 |       )}175 |       {...props}176 |     >177 |       <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">178 |         <ContextMenuPrimitive.ItemIndicator>179 |           <CircleIcon className="size-2 fill-current" />180 |         </ContextMenuPrimitive.ItemIndicator>181 |       </span>182 |       {children}183 |     </ContextMenuPrimitive.RadioItem>184 |   );185 | }186 | 187 | function ContextMenuLabel({188 |   className,189 |   inset,190 |   ...props191 | }: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {192 |   inset?: boolean;193 | }) {194 |   return (195 |     <ContextMenuPrimitive.Label196 |       data-slot="context-menu-label"197 |       data-inset={inset}198 |       className={cn(199 |         "text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",200 |         className,201 |       )}202 |       {...props}203 |     />204 |   );205 | }206 | 207 | function ContextMenuSeparator({208 |   className,209 |   ...props210 | }: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {211 |   return (212 |     <ContextMenuPrimitive.Separator213 |       data-slot="context-menu-separator"214 |       className={cn("bg-border -mx-1 my-1 h-px", className)}215 |       {...props}216 |     />217 |   );218 | }219 | 220 | function ContextMenuShortcut({221 |   className,222 |   ...props223 | }: React.ComponentProps<"span">) {224 |   return (225 |     <span226 |       data-slot="context-menu-shortcut"227 |       className={cn(228 |         "text-muted-foreground ml-auto text-xs tracking-widest",229 |         className,230 |       )}231 |       {...props}232 |     />233 |   );234 | }235 | 236 | export {237 |   ContextMenu,238 |   ContextMenuTrigger,239 |   ContextMenuContent,240 |   ContextMenuItem,241 |   ContextMenuCheckboxItem,242 |   ContextMenuRadioItem,243 |   ContextMenuLabel,244 |   ContextMenuSeparator,245 |   ContextMenuShortcut,246 |   ContextMenuGroup,247 |   ContextMenuPortal,248 |   ContextMenuSub,249 |   ContextMenuSubContent,250 |   ContextMenuSubTrigger,251 |   ContextMenuRadioGroup,252 | };
============================================================END: frontend/components/ui/context-menu.tsx============================================================


============================================================FILE: frontend/components/ui/drawer.tsxSIZE: 3.99 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import { Drawer as DrawerPrimitive } from "vaul";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Drawer({  9 |   ...props 10 | }: React.ComponentProps<typeof DrawerPrimitive.Root>) { 11 |   return <DrawerPrimitive.Root data-slot="drawer" {...props} />; 12 | } 13 |  14 | function DrawerTrigger({ 15 |   ...props 16 | }: React.ComponentProps<typeof DrawerPrimitive.Trigger>) { 17 |   return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />; 18 | } 19 |  20 | function DrawerPortal({ 21 |   ...props 22 | }: React.ComponentProps<typeof DrawerPrimitive.Portal>) { 23 |   return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />; 24 | } 25 |  26 | function DrawerClose({ 27 |   ...props 28 | }: React.ComponentProps<typeof DrawerPrimitive.Close>) { 29 |   return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />; 30 | } 31 |  32 | function DrawerOverlay({ 33 |   className, 34 |   ...props 35 | }: React.ComponentProps<typeof DrawerPrimitive.Overlay>) { 36 |   return ( 37 |     <DrawerPrimitive.Overlay 38 |       data-slot="drawer-overlay" 39 |       className={cn( 40 |         "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50", 41 |         className, 42 |       )} 43 |       {...props} 44 |     /> 45 |   ); 46 | } 47 |  48 | function DrawerContent({ 49 |   className, 50 |   children, 51 |   ...props 52 | }: React.ComponentProps<typeof DrawerPrimitive.Content>) { 53 |   return ( 54 |     <DrawerPortal data-slot="drawer-portal"> 55 |       <DrawerOverlay /> 56 |       <DrawerPrimitive.Content 57 |         data-slot="drawer-content" 58 |         className={cn( 59 |           "group/drawer-content bg-background fixed z-50 flex h-auto flex-col", 60 |           "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b", 61 |           "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t", 62 |           "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm", 63 |           "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm", 64 |           className, 65 |         )} 66 |         {...props} 67 |       > 68 |         <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" /> 69 |         {children} 70 |       </DrawerPrimitive.Content> 71 |     </DrawerPortal> 72 |   ); 73 | } 74 |  75 | function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) { 76 |   return ( 77 |     <div 78 |       data-slot="drawer-header" 79 |       className={cn("flex flex-col gap-1.5 p-4", className)} 80 |       {...props} 81 |     /> 82 |   ); 83 | } 84 |  85 | function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) { 86 |   return ( 87 |     <div 88 |       data-slot="drawer-footer" 89 |       className={cn("mt-auto flex flex-col gap-2 p-4", className)} 90 |       {...props} 91 |     /> 92 |   ); 93 | } 94 |  95 | function DrawerTitle({ 96 |   className, 97 |   ...props 98 | }: React.ComponentProps<typeof DrawerPrimitive.Title>) { 99 |   return (100 |     <DrawerPrimitive.Title101 |       data-slot="drawer-title"102 |       className={cn("text-foreground font-semibold", className)}103 |       {...props}104 |     />105 |   );106 | }107 | 108 | function DrawerDescription({109 |   className,110 |   ...props111 | }: React.ComponentProps<typeof DrawerPrimitive.Description>) {112 |   return (113 |     <DrawerPrimitive.Description114 |       data-slot="drawer-description"115 |       className={cn("text-muted-foreground text-sm", className)}116 |       {...props}117 |     />118 |   );119 | }120 | 121 | export {122 |   Drawer,123 |   DrawerPortal,124 |   DrawerOverlay,125 |   DrawerTrigger,126 |   DrawerClose,127 |   DrawerContent,128 |   DrawerHeader,129 |   DrawerFooter,130 |   DrawerTitle,131 |   DrawerDescription,132 | };
============================================================END: frontend/components/ui/drawer.tsx============================================================


============================================================FILE: frontend/components/ui/dropdown-menu.tsxSIZE: 8.12 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu";  5 | import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function DropdownMenu({ 10 |   ...props 11 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) { 12 |   return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />; 13 | } 14 |  15 | function DropdownMenuPortal({ 16 |   ...props 17 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) { 18 |   return ( 19 |     <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} /> 20 |   ); 21 | } 22 |  23 | function DropdownMenuTrigger({ 24 |   ...props 25 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) { 26 |   return ( 27 |     <DropdownMenuPrimitive.Trigger 28 |       data-slot="dropdown-menu-trigger" 29 |       {...props} 30 |     /> 31 |   ); 32 | } 33 |  34 | function DropdownMenuContent({ 35 |   className, 36 |   sideOffset = 4, 37 |   ...props 38 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) { 39 |   return ( 40 |     <DropdownMenuPrimitive.Portal> 41 |       <DropdownMenuPrimitive.Content 42 |         data-slot="dropdown-menu-content" 43 |         sideOffset={sideOffset} 44 |         className={cn( 45 |           "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md", 46 |           className, 47 |         )} 48 |         {...props} 49 |       /> 50 |     </DropdownMenuPrimitive.Portal> 51 |   ); 52 | } 53 |  54 | function DropdownMenuGroup({ 55 |   ...props 56 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) { 57 |   return ( 58 |     <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} /> 59 |   ); 60 | } 61 |  62 | function DropdownMenuItem({ 63 |   className, 64 |   inset, 65 |   variant = "default", 66 |   ...props 67 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & { 68 |   inset?: boolean; 69 |   variant?: "default" | "destructive"; 70 | }) { 71 |   return ( 72 |     <DropdownMenuPrimitive.Item 73 |       data-slot="dropdown-menu-item" 74 |       data-inset={inset} 75 |       data-variant={variant} 76 |       className={cn( 77 |         "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4", 78 |         className, 79 |       )} 80 |       {...props} 81 |     /> 82 |   ); 83 | } 84 |  85 | function DropdownMenuCheckboxItem({ 86 |   className, 87 |   children, 88 |   checked, 89 |   ...props 90 | }: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) { 91 |   return ( 92 |     <DropdownMenuPrimitive.CheckboxItem 93 |       data-slot="dropdown-menu-checkbox-item" 94 |       className={cn( 95 |         "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4", 96 |         className, 97 |       )} 98 |       checked={checked} 99 |       {...props}100 |     >101 |       <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">102 |         <DropdownMenuPrimitive.ItemIndicator>103 |           <CheckIcon className="size-4" />104 |         </DropdownMenuPrimitive.ItemIndicator>105 |       </span>106 |       {children}107 |     </DropdownMenuPrimitive.CheckboxItem>108 |   );109 | }110 | 111 | function DropdownMenuRadioGroup({112 |   ...props113 | }: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {114 |   return (115 |     <DropdownMenuPrimitive.RadioGroup116 |       data-slot="dropdown-menu-radio-group"117 |       {...props}118 |     />119 |   );120 | }121 | 122 | function DropdownMenuRadioItem({123 |   className,124 |   children,125 |   ...props126 | }: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {127 |   return (128 |     <DropdownMenuPrimitive.RadioItem129 |       data-slot="dropdown-menu-radio-item"130 |       className={cn(131 |         "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",132 |         className,133 |       )}134 |       {...props}135 |     >136 |       <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">137 |         <DropdownMenuPrimitive.ItemIndicator>138 |           <CircleIcon className="size-2 fill-current" />139 |         </DropdownMenuPrimitive.ItemIndicator>140 |       </span>141 |       {children}142 |     </DropdownMenuPrimitive.RadioItem>143 |   );144 | }145 | 146 | function DropdownMenuLabel({147 |   className,148 |   inset,149 |   ...props150 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {151 |   inset?: boolean;152 | }) {153 |   return (154 |     <DropdownMenuPrimitive.Label155 |       data-slot="dropdown-menu-label"156 |       data-inset={inset}157 |       className={cn(158 |         "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",159 |         className,160 |       )}161 |       {...props}162 |     />163 |   );164 | }165 | 166 | function DropdownMenuSeparator({167 |   className,168 |   ...props169 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {170 |   return (171 |     <DropdownMenuPrimitive.Separator172 |       data-slot="dropdown-menu-separator"173 |       className={cn("bg-border -mx-1 my-1 h-px", className)}174 |       {...props}175 |     />176 |   );177 | }178 | 179 | function DropdownMenuShortcut({180 |   className,181 |   ...props182 | }: React.ComponentProps<"span">) {183 |   return (184 |     <span185 |       data-slot="dropdown-menu-shortcut"186 |       className={cn(187 |         "text-muted-foreground ml-auto text-xs tracking-widest",188 |         className,189 |       )}190 |       {...props}191 |     />192 |   );193 | }194 | 195 | function DropdownMenuSub({196 |   ...props197 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {198 |   return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />;199 | }200 | 201 | function DropdownMenuSubTrigger({202 |   className,203 |   inset,204 |   children,205 |   ...props206 | }: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {207 |   inset?: boolean;208 | }) {209 |   return (210 |     <DropdownMenuPrimitive.SubTrigger211 |       data-slot="dropdown-menu-sub-trigger"212 |       data-inset={inset}213 |       className={cn(214 |         "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",215 |         className,216 |       )}217 |       {...props}218 |     >219 |       {children}220 |       <ChevronRightIcon className="ml-auto size-4" />221 |     </DropdownMenuPrimitive.SubTrigger>222 |   );223 | }224 | 225 | function DropdownMenuSubContent({226 |   className,227 |   ...props228 | }: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {229 |   return (230 |     <DropdownMenuPrimitive.SubContent231 |       data-slot="dropdown-menu-sub-content"232 |       className={cn(233 |         "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",234 |         className,235 |       )}236 |       {...props}237 |     />238 |   );239 | }240 | 241 | export {242 |   DropdownMenu,243 |   DropdownMenuPortal,244 |   DropdownMenuTrigger,245 |   DropdownMenuContent,246 |   DropdownMenuGroup,247 |   DropdownMenuLabel,248 |   DropdownMenuItem,249 |   DropdownMenuCheckboxItem,250 |   DropdownMenuRadioGroup,251 |   DropdownMenuRadioItem,252 |   DropdownMenuSeparator,253 |   DropdownMenuShortcut,254 |   DropdownMenuSub,255 |   DropdownMenuSubTrigger,256 |   DropdownMenuSubContent,257 | };
============================================================END: frontend/components/ui/dropdown-menu.tsx============================================================


============================================================FILE: frontend/components/ui/form.tsxSIZE: 3.70 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as LabelPrimitive from "@radix-ui/react-label";  5 | import { Slot } from "@radix-ui/react-slot";  6 | import {  7 |   Controller,  8 |   FormProvider,  9 |   useFormContext, 10 |   useFormState, 11 |   type ControllerProps, 12 |   type FieldPath, 13 |   type FieldValues, 14 | } from "react-hook-form"; 15 |  16 | import { cn } from "./utils"; 17 | import { Label } from "./label"; 18 |  19 | const Form = FormProvider; 20 |  21 | type FormFieldContextValue< 22 |   TFieldValues extends FieldValues = FieldValues, 23 |   TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>, 24 | > = { 25 |   name: TName; 26 | }; 27 |  28 | const FormFieldContext = React.createContext<FormFieldContextValue>( 29 |   {} as FormFieldContextValue, 30 | ); 31 |  32 | const FormField = < 33 |   TFieldValues extends FieldValues = FieldValues, 34 |   TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>, 35 | >({ 36 |   ...props 37 | }: ControllerProps<TFieldValues, TName>) => { 38 |   return ( 39 |     <FormFieldContext.Provider value={{ name: props.name }}> 40 |       <Controller {...props} /> 41 |     </FormFieldContext.Provider> 42 |   ); 43 | }; 44 |  45 | const useFormField = () => { 46 |   const fieldContext = React.useContext(FormFieldContext); 47 |   const itemContext = React.useContext(FormItemContext); 48 |   const { getFieldState } = useFormContext(); 49 |   const formState = useFormState({ name: fieldContext.name }); 50 |   const fieldState = getFieldState(fieldContext.name, formState); 51 |  52 |   if (!fieldContext) { 53 |     throw new Error("useFormField should be used within <FormField>"); 54 |   } 55 |  56 |   const { id } = itemContext; 57 |  58 |   return { 59 |     id, 60 |     name: fieldContext.name, 61 |     formItemId: `${id}-form-item`, 62 |     formDescriptionId: `${id}-form-item-description`, 63 |     formMessageId: `${id}-form-item-message`, 64 |     ...fieldState, 65 |   }; 66 | }; 67 |  68 | type FormItemContextValue = { 69 |   id: string; 70 | }; 71 |  72 | const FormItemContext = React.createContext<FormItemContextValue>( 73 |   {} as FormItemContextValue, 74 | ); 75 |  76 | function FormItem({ className, ...props }: React.ComponentProps<"div">) { 77 |   const id = React.useId(); 78 |  79 |   return ( 80 |     <FormItemContext.Provider value={{ id }}> 81 |       <div 82 |         data-slot="form-item" 83 |         className={cn("grid gap-2", className)} 84 |         {...props} 85 |       /> 86 |     </FormItemContext.Provider> 87 |   ); 88 | } 89 |  90 | function FormLabel({ 91 |   className, 92 |   ...props 93 | }: React.ComponentProps<typeof LabelPrimitive.Root>) { 94 |   const { error, formItemId } = useFormField(); 95 |  96 |   return ( 97 |     <Label 98 |       data-slot="form-label" 99 |       data-error={!!error}100 |       className={cn("data-[error=true]:text-destructive", className)}101 |       htmlFor={formItemId}102 |       {...props}103 |     />104 |   );105 | }106 | 107 | function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {108 |   const { error, formItemId, formDescriptionId, formMessageId } =109 |     useFormField();110 | 111 |   return (112 |     <Slot113 |       data-slot="form-control"114 |       id={formItemId}115 |       aria-describedby={116 |         !error117 |           ? `${formDescriptionId}`118 |           : `${formDescriptionId} ${formMessageId}`119 |       }120 |       aria-invalid={!!error}121 |       {...props}122 |     />123 |   );124 | }125 | 126 | function FormDescription({ className, ...props }: React.ComponentProps<"p">) {127 |   const { formDescriptionId } = useFormField();128 | 129 |   return (130 |     <p131 |       data-slot="form-description"132 |       id={formDescriptionId}133 |       className={cn("text-muted-foreground text-sm", className)}134 |       {...props}135 |     />136 |   );137 | }138 | 139 | function FormMessage({ className, ...props }: React.ComponentProps<"p">) {140 |   const { error, formMessageId } = useFormField();141 |   const body = error ? String(error?.message ?? "") : props.children;142 | 143 |   if (!body) {144 |     return null;145 |   }146 | 147 |   return (148 |     <p149 |       data-slot="form-message"150 |       id={formMessageId}151 |       className={cn("text-destructive text-sm", className)}152 |       {...props}153 |     >154 |       {body}155 |     </p>156 |   );157 | }158 | 159 | export {160 |   useFormField,161 |   Form,162 |   FormItem,163 |   FormLabel,164 |   FormControl,165 |   FormDescription,166 |   FormMessage,167 |   FormField,168 | };
============================================================END: frontend/components/ui/form.tsx============================================================


============================================================FILE: frontend/components/ui/hover-card.tsxSIZE: 1.50 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as HoverCardPrimitive from "@radix-ui/react-hover-card";  5 |   6 | import { cn } from "./utils";  7 |   8 | function HoverCard({  9 |   ...props 10 | }: React.ComponentProps<typeof HoverCardPrimitive.Root>) { 11 |   return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />; 12 | } 13 |  14 | function HoverCardTrigger({ 15 |   ...props 16 | }: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) { 17 |   return ( 18 |     <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} /> 19 |   ); 20 | } 21 |  22 | function HoverCardContent({ 23 |   className, 24 |   align = "center", 25 |   sideOffset = 4, 26 |   ...props 27 | }: React.ComponentProps<typeof HoverCardPrimitive.Content>) { 28 |   return ( 29 |     <HoverCardPrimitive.Portal data-slot="hover-card-portal"> 30 |       <HoverCardPrimitive.Content 31 |         data-slot="hover-card-content" 32 |         align={align} 33 |         sideOffset={sideOffset} 34 |         className={cn( 35 |           "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden", 36 |           className, 37 |         )} 38 |         {...props} 39 |       /> 40 |     </HoverCardPrimitive.Portal> 41 |   ); 42 | } 43 |  44 | export { HoverCard, HoverCardTrigger, HoverCardContent };
============================================================END: frontend/components/ui/hover-card.tsx============================================================


============================================================FILE: frontend/components/ui/input-otp.tsxSIZE: 2.23 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import { OTPInput, OTPInputContext } from "input-otp";  5 | import { MinusIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function InputOTP({ 10 |   className, 11 |   containerClassName, 12 |   ...props 13 | }: React.ComponentProps<typeof OTPInput> & { 14 |   containerClassName?: string; 15 | }) { 16 |   return ( 17 |     <OTPInput 18 |       data-slot="input-otp" 19 |       containerClassName={cn( 20 |         "flex items-center gap-2 has-disabled:opacity-50", 21 |         containerClassName, 22 |       )} 23 |       className={cn("disabled:cursor-not-allowed", className)} 24 |       {...props} 25 |     /> 26 |   ); 27 | } 28 |  29 | function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) { 30 |   return ( 31 |     <div 32 |       data-slot="input-otp-group" 33 |       className={cn("flex items-center gap-1", className)} 34 |       {...props} 35 |     /> 36 |   ); 37 | } 38 |  39 | function InputOTPSlot({ 40 |   index, 41 |   className, 42 |   ...props 43 | }: React.ComponentProps<"div"> & { 44 |   index: number; 45 | }) { 46 |   const inputOTPContext = React.useContext(OTPInputContext); 47 |   const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {}; 48 |  49 |   return ( 50 |     <div 51 |       data-slot="input-otp-slot" 52 |       data-active={isActive} 53 |       className={cn( 54 |         "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm bg-input-background transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]", 55 |         className, 56 |       )} 57 |       {...props} 58 |     > 59 |       {char} 60 |       {hasFakeCaret && ( 61 |         <div className="pointer-events-none absolute inset-0 flex items-center justify-center"> 62 |           <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" /> 63 |         </div> 64 |       )} 65 |     </div> 66 |   ); 67 | } 68 |  69 | function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) { 70 |   return ( 71 |     <div data-slot="input-otp-separator" role="separator" {...props}> 72 |       <MinusIcon /> 73 |     </div> 74 |   ); 75 | } 76 |  77 | export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };
============================================================END: frontend/components/ui/input-otp.tsx============================================================


============================================================FILE: frontend/components/ui/input.tsxSIZE: 0.94 KB============================================================
  1 | import * as React from "react";  2 |   3 | import { cn } from "./utils";  4 |   5 | function Input({ className, type, ...props }: React.ComponentProps<"input">) {  6 |   return (  7 |     <input  8 |       type={type}  9 |       data-slot="input" 10 |       className={cn( 11 |         "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm", 12 |         "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]", 13 |         "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive", 14 |         className, 15 |       )} 16 |       {...props} 17 |     /> 18 |   ); 19 | } 20 |  21 | export { Input };
============================================================END: frontend/components/ui/input.tsx============================================================


============================================================FILE: frontend/components/ui/label.tsxSIZE: 0.60 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as LabelPrimitive from "@radix-ui/react-label";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Label({  9 |   className, 10 |   ...props 11 | }: React.ComponentProps<typeof LabelPrimitive.Root>) { 12 |   return ( 13 |     <LabelPrimitive.Root 14 |       data-slot="label" 15 |       className={cn( 16 |         "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50", 17 |         className, 18 |       )} 19 |       {...props} 20 |     /> 21 |   ); 22 | } 23 |  24 | export { Label };
============================================================END: frontend/components/ui/label.tsx============================================================


============================================================FILE: frontend/components/ui/menubar.tsxSIZE: 8.23 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as MenubarPrimitive from "@radix-ui/react-menubar";  5 | import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function Menubar({ 10 |   className, 11 |   ...props 12 | }: React.ComponentProps<typeof MenubarPrimitive.Root>) { 13 |   return ( 14 |     <MenubarPrimitive.Root 15 |       data-slot="menubar" 16 |       className={cn( 17 |         "bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs", 18 |         className, 19 |       )} 20 |       {...props} 21 |     /> 22 |   ); 23 | } 24 |  25 | function MenubarMenu({ 26 |   ...props 27 | }: React.ComponentProps<typeof MenubarPrimitive.Menu>) { 28 |   return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />; 29 | } 30 |  31 | function MenubarGroup({ 32 |   ...props 33 | }: React.ComponentProps<typeof MenubarPrimitive.Group>) { 34 |   return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />; 35 | } 36 |  37 | function MenubarPortal({ 38 |   ...props 39 | }: React.ComponentProps<typeof MenubarPrimitive.Portal>) { 40 |   return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />; 41 | } 42 |  43 | function MenubarRadioGroup({ 44 |   ...props 45 | }: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) { 46 |   return ( 47 |     <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} /> 48 |   ); 49 | } 50 |  51 | function MenubarTrigger({ 52 |   className, 53 |   ...props 54 | }: React.ComponentProps<typeof MenubarPrimitive.Trigger>) { 55 |   return ( 56 |     <MenubarPrimitive.Trigger 57 |       data-slot="menubar-trigger" 58 |       className={cn( 59 |         "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none", 60 |         className, 61 |       )} 62 |       {...props} 63 |     /> 64 |   ); 65 | } 66 |  67 | function MenubarContent({ 68 |   className, 69 |   align = "start", 70 |   alignOffset = -4, 71 |   sideOffset = 8, 72 |   ...props 73 | }: React.ComponentProps<typeof MenubarPrimitive.Content>) { 74 |   return ( 75 |     <MenubarPortal> 76 |       <MenubarPrimitive.Content 77 |         data-slot="menubar-content" 78 |         align={align} 79 |         alignOffset={alignOffset} 80 |         sideOffset={sideOffset} 81 |         className={cn( 82 |           "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md", 83 |           className, 84 |         )} 85 |         {...props} 86 |       /> 87 |     </MenubarPortal> 88 |   ); 89 | } 90 |  91 | function MenubarItem({ 92 |   className, 93 |   inset, 94 |   variant = "default", 95 |   ...props 96 | }: React.ComponentProps<typeof MenubarPrimitive.Item> & { 97 |   inset?: boolean; 98 |   variant?: "default" | "destructive"; 99 | }) {100 |   return (101 |     <MenubarPrimitive.Item102 |       data-slot="menubar-item"103 |       data-inset={inset}104 |       data-variant={variant}105 |       className={cn(106 |         "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",107 |         className,108 |       )}109 |       {...props}110 |     />111 |   );112 | }113 | 114 | function MenubarCheckboxItem({115 |   className,116 |   children,117 |   checked,118 |   ...props119 | }: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {120 |   return (121 |     <MenubarPrimitive.CheckboxItem122 |       data-slot="menubar-checkbox-item"123 |       className={cn(124 |         "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",125 |         className,126 |       )}127 |       checked={checked}128 |       {...props}129 |     >130 |       <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">131 |         <MenubarPrimitive.ItemIndicator>132 |           <CheckIcon className="size-4" />133 |         </MenubarPrimitive.ItemIndicator>134 |       </span>135 |       {children}136 |     </MenubarPrimitive.CheckboxItem>137 |   );138 | }139 | 140 | function MenubarRadioItem({141 |   className,142 |   children,143 |   ...props144 | }: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {145 |   return (146 |     <MenubarPrimitive.RadioItem147 |       data-slot="menubar-radio-item"148 |       className={cn(149 |         "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",150 |         className,151 |       )}152 |       {...props}153 |     >154 |       <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">155 |         <MenubarPrimitive.ItemIndicator>156 |           <CircleIcon className="size-2 fill-current" />157 |         </MenubarPrimitive.ItemIndicator>158 |       </span>159 |       {children}160 |     </MenubarPrimitive.RadioItem>161 |   );162 | }163 | 164 | function MenubarLabel({165 |   className,166 |   inset,167 |   ...props168 | }: React.ComponentProps<typeof MenubarPrimitive.Label> & {169 |   inset?: boolean;170 | }) {171 |   return (172 |     <MenubarPrimitive.Label173 |       data-slot="menubar-label"174 |       data-inset={inset}175 |       className={cn(176 |         "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",177 |         className,178 |       )}179 |       {...props}180 |     />181 |   );182 | }183 | 184 | function MenubarSeparator({185 |   className,186 |   ...props187 | }: React.ComponentProps<typeof MenubarPrimitive.Separator>) {188 |   return (189 |     <MenubarPrimitive.Separator190 |       data-slot="menubar-separator"191 |       className={cn("bg-border -mx-1 my-1 h-px", className)}192 |       {...props}193 |     />194 |   );195 | }196 | 197 | function MenubarShortcut({198 |   className,199 |   ...props200 | }: React.ComponentProps<"span">) {201 |   return (202 |     <span203 |       data-slot="menubar-shortcut"204 |       className={cn(205 |         "text-muted-foreground ml-auto text-xs tracking-widest",206 |         className,207 |       )}208 |       {...props}209 |     />210 |   );211 | }212 | 213 | function MenubarSub({214 |   ...props215 | }: React.ComponentProps<typeof MenubarPrimitive.Sub>) {216 |   return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />;217 | }218 | 219 | function MenubarSubTrigger({220 |   className,221 |   inset,222 |   children,223 |   ...props224 | }: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {225 |   inset?: boolean;226 | }) {227 |   return (228 |     <MenubarPrimitive.SubTrigger229 |       data-slot="menubar-sub-trigger"230 |       data-inset={inset}231 |       className={cn(232 |         "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8",233 |         className,234 |       )}235 |       {...props}236 |     >237 |       {children}238 |       <ChevronRightIcon className="ml-auto h-4 w-4" />239 |     </MenubarPrimitive.SubTrigger>240 |   );241 | }242 | 243 | function MenubarSubContent({244 |   className,245 |   ...props246 | }: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {247 |   return (248 |     <MenubarPrimitive.SubContent249 |       data-slot="menubar-sub-content"250 |       className={cn(251 |         "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",252 |         className,253 |       )}254 |       {...props}255 |     />256 |   );257 | }258 | 259 | export {260 |   Menubar,261 |   MenubarPortal,262 |   MenubarMenu,263 |   MenubarTrigger,264 |   MenubarContent,265 |   MenubarGroup,266 |   MenubarSeparator,267 |   MenubarLabel,268 |   MenubarItem,269 |   MenubarShortcut,270 |   MenubarCheckboxItem,271 |   MenubarRadioGroup,272 |   MenubarRadioItem,273 |   MenubarSub,274 |   MenubarSubTrigger,275 |   MenubarSubContent,276 | };
============================================================END: frontend/components/ui/menubar.tsx============================================================


============================================================FILE: frontend/components/ui/modals.tsSIZE: 0.61 KB============================================================
  1 | export { BaseModal, ConfirmationModal, ModalSection } from './BaseModal';  2 | export { default as DeleteConfirmationModal } from '../modals/DeleteConfirmationModal';  3 | export { default as PackageDefinitionModal } from '../modals/PackageDefinitionModal';  4 | export { default as PackagePriceModal } from '../modals/PackagePriceModal';  5 | export { default as ScheduleTemplateModal } from '../modals/ScheduleTemplateModal';  6 | export { default as CreateBookingModal } from '../modals/CreateBookingModal';
============================================================END: frontend/components/ui/modals.ts============================================================


============================================================FILE: frontend/components/ui/pagination.tsxSIZE: 2.65 KB============================================================
  1 | import * as React from "react";  2 | import {  3 |   ChevronLeftIcon,  4 |   ChevronRightIcon,  5 |   MoreHorizontalIcon,  6 | } from "lucide-react";  7 |   8 | import { cn } from "./utils";  9 | import { Button, buttonVariants } from "./button"; 10 |  11 | function Pagination({ className, ...props }: React.ComponentProps<"nav">) { 12 |   return ( 13 |     <nav 14 |       role="navigation" 15 |       aria-label="pagination" 16 |       data-slot="pagination" 17 |       className={cn("mx-auto flex w-full justify-center", className)} 18 |       {...props} 19 |     /> 20 |   ); 21 | } 22 |  23 | function PaginationContent({ 24 |   className, 25 |   ...props 26 | }: React.ComponentProps<"ul">) { 27 |   return ( 28 |     <ul 29 |       data-slot="pagination-content" 30 |       className={cn("flex flex-row items-center gap-1", className)} 31 |       {...props} 32 |     /> 33 |   ); 34 | } 35 |  36 | function PaginationItem({ ...props }: React.ComponentProps<"li">) { 37 |   return <li data-slot="pagination-item" {...props} />; 38 | } 39 |  40 | type PaginationLinkProps = { 41 |   isActive?: boolean; 42 | } & Pick<React.ComponentProps<typeof Button>, "size"> & 43 |   React.ComponentProps<"a">; 44 |  45 | function PaginationLink({ 46 |   className, 47 |   isActive, 48 |   size = "icon", 49 |   ...props 50 | }: PaginationLinkProps) { 51 |   return ( 52 |     <a 53 |       aria-current={isActive ? "page" : undefined} 54 |       data-slot="pagination-link" 55 |       data-active={isActive} 56 |       className={cn( 57 |         buttonVariants({ 58 |           variant: isActive ? "outline" : "ghost", 59 |           size, 60 |         }), 61 |         className, 62 |       )} 63 |       {...props} 64 |     /> 65 |   ); 66 | } 67 |  68 | function PaginationPrevious({ 69 |   className, 70 |   ...props 71 | }: React.ComponentProps<typeof PaginationLink>) { 72 |   return ( 73 |     <PaginationLink 74 |       aria-label="Go to previous page" 75 |       size="default" 76 |       className={cn("gap-1 px-2.5 sm:pl-2.5", className)} 77 |       {...props} 78 |     > 79 |       <ChevronLeftIcon /> 80 |       <span className="hidden sm:block">Previous</span> 81 |     </PaginationLink> 82 |   ); 83 | } 84 |  85 | function PaginationNext({ 86 |   className, 87 |   ...props 88 | }: React.ComponentProps<typeof PaginationLink>) { 89 |   return ( 90 |     <PaginationLink 91 |       aria-label="Go to next page" 92 |       size="default" 93 |       className={cn("gap-1 px-2.5 sm:pr-2.5", className)} 94 |       {...props} 95 |     > 96 |       <span className="hidden sm:block">Next</span> 97 |       <ChevronRightIcon /> 98 |     </PaginationLink> 99 |   );100 | }101 | 102 | function PaginationEllipsis({103 |   className,104 |   ...props105 | }: React.ComponentProps<"span">) {106 |   return (107 |     <span108 |       aria-hidden109 |       data-slot="pagination-ellipsis"110 |       className={cn("flex size-9 items-center justify-center", className)}111 |       {...props}112 |     >113 |       <MoreHorizontalIcon className="size-4" />114 |       <span className="sr-only">More pages</span>115 |     </span>116 |   );117 | }118 | 119 | export {120 |   Pagination,121 |   PaginationContent,122 |   PaginationLink,123 |   PaginationItem,124 |   PaginationPrevious,125 |   PaginationNext,126 |   PaginationEllipsis,127 | };
============================================================END: frontend/components/ui/pagination.tsx============================================================


============================================================FILE: frontend/components/ui/popover.tsxSIZE: 1.60 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as PopoverPrimitive from "@radix-ui/react-popover";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Popover({  9 |   ...props 10 | }: React.ComponentProps<typeof PopoverPrimitive.Root>) { 11 |   return <PopoverPrimitive.Root data-slot="popover" {...props} />; 12 | } 13 |  14 | function PopoverTrigger({ 15 |   ...props 16 | }: React.ComponentProps<typeof PopoverPrimitive.Trigger>) { 17 |   return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />; 18 | } 19 |  20 | function PopoverContent({ 21 |   className, 22 |   align = "center", 23 |   sideOffset = 4, 24 |   ...props 25 | }: React.ComponentProps<typeof PopoverPrimitive.Content>) { 26 |   return ( 27 |     <PopoverPrimitive.Portal> 28 |       <PopoverPrimitive.Content 29 |         data-slot="popover-content" 30 |         align={align} 31 |         sideOffset={sideOffset} 32 |         className={cn( 33 |           "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden", 34 |           className, 35 |         )} 36 |         {...props} 37 |       /> 38 |     </PopoverPrimitive.Portal> 39 |   ); 40 | } 41 |  42 | function PopoverAnchor({ 43 |   ...props 44 | }: React.ComponentProps<typeof PopoverPrimitive.Anchor>) { 45 |   return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />; 46 | } 47 |  48 | export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };
============================================================END: frontend/components/ui/popover.tsx============================================================


============================================================FILE: frontend/components/ui/progress.tsxSIZE: 0.73 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as ProgressPrimitive from "@radix-ui/react-progress";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Progress({  9 |   className, 10 |   value, 11 |   ...props 12 | }: React.ComponentProps<typeof ProgressPrimitive.Root>) { 13 |   return ( 14 |     <ProgressPrimitive.Root 15 |       data-slot="progress" 16 |       className={cn( 17 |         "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full", 18 |         className, 19 |       )} 20 |       {...props} 21 |     > 22 |       <ProgressPrimitive.Indicator 23 |         data-slot="progress-indicator" 24 |         className="bg-primary h-full w-full flex-1 transition-all" 25 |         style={{ transform: `translateX(-${100 - (value || 0)}%)` }} 26 |       /> 27 |     </ProgressPrimitive.Root> 28 |   ); 29 | } 30 |  31 | export { Progress };
============================================================END: frontend/components/ui/progress.tsx============================================================


============================================================FILE: frontend/components/ui/radio-group.tsxSIZE: 1.44 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as RadioGroupPrimitive from "@radix-ui/react-radio-group";  5 | import { CircleIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function RadioGroup({ 10 |   className, 11 |   ...props 12 | }: React.ComponentProps<typeof RadioGroupPrimitive.Root>) { 13 |   return ( 14 |     <RadioGroupPrimitive.Root 15 |       data-slot="radio-group" 16 |       className={cn("grid gap-3", className)} 17 |       {...props} 18 |     /> 19 |   ); 20 | } 21 |  22 | function RadioGroupItem({ 23 |   className, 24 |   ...props 25 | }: React.ComponentProps<typeof RadioGroupPrimitive.Item>) { 26 |   return ( 27 |     <RadioGroupPrimitive.Item 28 |       data-slot="radio-group-item" 29 |       className={cn( 30 |         "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50", 31 |         className, 32 |       )} 33 |       {...props} 34 |     > 35 |       <RadioGroupPrimitive.Indicator 36 |         data-slot="radio-group-indicator" 37 |         className="relative flex items-center justify-center" 38 |       > 39 |         <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" /> 40 |       </RadioGroupPrimitive.Indicator> 41 |     </RadioGroupPrimitive.Item> 42 |   ); 43 | } 44 |  45 | export { RadioGroup, RadioGroupItem };
============================================================END: frontend/components/ui/radio-group.tsx============================================================


============================================================FILE: frontend/components/ui/resizable.tsxSIZE: 1.99 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import { GripVerticalIcon } from "lucide-react";  5 | import * as ResizablePrimitive from "react-resizable-panels";  6 |   7 | import { cn } from "./utils";  8 |   9 | function ResizablePanelGroup({ 10 |   className, 11 |   ...props 12 | }: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) { 13 |   return ( 14 |     <ResizablePrimitive.PanelGroup 15 |       data-slot="resizable-panel-group" 16 |       className={cn( 17 |         "flex h-full w-full data-[panel-group-direction=vertical]:flex-col", 18 |         className, 19 |       )} 20 |       {...props} 21 |     /> 22 |   ); 23 | } 24 |  25 | function ResizablePanel({ 26 |   ...props 27 | }: React.ComponentProps<typeof ResizablePrimitive.Panel>) { 28 |   return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />; 29 | } 30 |  31 | function ResizableHandle({ 32 |   withHandle, 33 |   className, 34 |   ...props 35 | }: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & { 36 |   withHandle?: boolean; 37 | }) { 38 |   return ( 39 |     <ResizablePrimitive.PanelResizeHandle 40 |       data-slot="resizable-handle" 41 |       className={cn( 42 |         "bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90", 43 |         className, 44 |       )} 45 |       {...props} 46 |     > 47 |       {withHandle && ( 48 |         <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border"> 49 |           <GripVerticalIcon className="size-2.5" /> 50 |         </div> 51 |       )} 52 |     </ResizablePrimitive.PanelResizeHandle> 53 |   ); 54 | } 55 |  56 | export { ResizablePanelGroup, ResizablePanel, ResizableHandle };
============================================================END: frontend/components/ui/resizable.tsx============================================================


============================================================FILE: frontend/components/ui/scroll-area.tsxSIZE: 1.61 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area";  5 |   6 | import { cn } from "./utils";  7 |   8 | function ScrollArea({  9 |   className, 10 |   children, 11 |   ...props 12 | }: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) { 13 |   return ( 14 |     <ScrollAreaPrimitive.Root 15 |       data-slot="scroll-area" 16 |       className={cn("relative", className)} 17 |       {...props} 18 |     > 19 |       <ScrollAreaPrimitive.Viewport 20 |         data-slot="scroll-area-viewport" 21 |         className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1" 22 |       > 23 |         {children} 24 |       </ScrollAreaPrimitive.Viewport> 25 |       <ScrollBar /> 26 |       <ScrollAreaPrimitive.Corner /> 27 |     </ScrollAreaPrimitive.Root> 28 |   ); 29 | } 30 |  31 | function ScrollBar({ 32 |   className, 33 |   orientation = "vertical", 34 |   ...props 35 | }: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) { 36 |   return ( 37 |     <ScrollAreaPrimitive.ScrollAreaScrollbar 38 |       data-slot="scroll-area-scrollbar" 39 |       orientation={orientation} 40 |       className={cn( 41 |         "flex touch-none p-px transition-colors select-none", 42 |         orientation === "vertical" && 43 |           "h-full w-2.5 border-l border-l-transparent", 44 |         orientation === "horizontal" && 45 |           "h-2.5 flex-col border-t border-t-transparent", 46 |         className, 47 |       )} 48 |       {...props} 49 |     > 50 |       <ScrollAreaPrimitive.ScrollAreaThumb 51 |         data-slot="scroll-area-thumb" 52 |         className="bg-border relative flex-1 rounded-full" 53 |       /> 54 |     </ScrollAreaPrimitive.ScrollAreaScrollbar> 55 |   ); 56 | } 57 |  58 | export { ScrollArea, ScrollBar };
============================================================END: frontend/components/ui/scroll-area.tsx============================================================


============================================================FILE: frontend/components/ui/select.tsxSIZE: 6.13 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as SelectPrimitive from "@radix-ui/react-select";  5 | import {  6 |   CheckIcon,  7 |   ChevronDownIcon,  8 |   ChevronUpIcon,  9 | } from "lucide-react"; 10 |  11 | import { cn } from "./utils"; 12 |  13 | function Select({ 14 |   ...props 15 | }: React.ComponentProps<typeof SelectPrimitive.Root>) { 16 |   return <SelectPrimitive.Root data-slot="select" {...props} />; 17 | } 18 |  19 | function SelectGroup({ 20 |   ...props 21 | }: React.ComponentProps<typeof SelectPrimitive.Group>) { 22 |   return <SelectPrimitive.Group data-slot="select-group" {...props} />; 23 | } 24 |  25 | function SelectValue({ 26 |   ...props 27 | }: React.ComponentProps<typeof SelectPrimitive.Value>) { 28 |   return <SelectPrimitive.Value data-slot="select-value" {...props} />; 29 | } 30 |  31 | function SelectTrigger({ 32 |   className, 33 |   size = "default", 34 |   children, 35 |   ...props 36 | }: React.ComponentProps<typeof SelectPrimitive.Trigger> & { 37 |   size?: "sm" | "default"; 38 | }) { 39 |   return ( 40 |     <SelectPrimitive.Trigger 41 |       data-slot="select-trigger" 42 |       data-size={size} 43 |       className={cn( 44 |         "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4", 45 |         className, 46 |       )} 47 |       {...props} 48 |     > 49 |       {children} 50 |       <SelectPrimitive.Icon asChild> 51 |         <ChevronDownIcon className="size-4 opacity-50" /> 52 |       </SelectPrimitive.Icon> 53 |     </SelectPrimitive.Trigger> 54 |   ); 55 | } 56 |  57 | function SelectContent({ 58 |   className, 59 |   children, 60 |   position = "popper", 61 |   ...props 62 | }: React.ComponentProps<typeof SelectPrimitive.Content>) { 63 |   return ( 64 |     <SelectPrimitive.Portal> 65 |       <SelectPrimitive.Content 66 |         data-slot="select-content" 67 |         className={cn( 68 |           "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md", 69 |           position === "popper" && 70 |             "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1", 71 |           className, 72 |         )} 73 |         position={position} 74 |         {...props} 75 |       > 76 |         <SelectScrollUpButton /> 77 |         <SelectPrimitive.Viewport 78 |           className={cn( 79 |             "p-1", 80 |             position === "popper" && 81 |               "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1", 82 |           )} 83 |         > 84 |           {children} 85 |         </SelectPrimitive.Viewport> 86 |         <SelectScrollDownButton /> 87 |       </SelectPrimitive.Content> 88 |     </SelectPrimitive.Portal> 89 |   ); 90 | } 91 |  92 | function SelectLabel({ 93 |   className, 94 |   ...props 95 | }: React.ComponentProps<typeof SelectPrimitive.Label>) { 96 |   return ( 97 |     <SelectPrimitive.Label 98 |       data-slot="select-label" 99 |       className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}100 |       {...props}101 |     />102 |   );103 | }104 | 105 | function SelectItem({106 |   className,107 |   children,108 |   ...props109 | }: React.ComponentProps<typeof SelectPrimitive.Item>) {110 |   return (111 |     <SelectPrimitive.Item112 |       data-slot="select-item"113 |       className={cn(114 |         "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",115 |         className,116 |       )}117 |       {...props}118 |     >119 |       <span className="absolute right-2 flex size-3.5 items-center justify-center">120 |         <SelectPrimitive.ItemIndicator>121 |           <CheckIcon className="size-4" />122 |         </SelectPrimitive.ItemIndicator>123 |       </span>124 |       <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>125 |     </SelectPrimitive.Item>126 |   );127 | }128 | 129 | function SelectSeparator({130 |   className,131 |   ...props132 | }: React.ComponentProps<typeof SelectPrimitive.Separator>) {133 |   return (134 |     <SelectPrimitive.Separator135 |       data-slot="select-separator"136 |       className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}137 |       {...props}138 |     />139 |   );140 | }141 | 142 | function SelectScrollUpButton({143 |   className,144 |   ...props145 | }: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {146 |   return (147 |     <SelectPrimitive.ScrollUpButton148 |       data-slot="select-scroll-up-button"149 |       className={cn(150 |         "flex cursor-default items-center justify-center py-1",151 |         className,152 |       )}153 |       {...props}154 |     >155 |       <ChevronUpIcon className="size-4" />156 |     </SelectPrimitive.ScrollUpButton>157 |   );158 | }159 | 160 | function SelectScrollDownButton({161 |   className,162 |   ...props163 | }: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {164 |   return (165 |     <SelectPrimitive.ScrollDownButton166 |       data-slot="select-scroll-down-button"167 |       className={cn(168 |         "flex cursor-default items-center justify-center py-1",169 |         className,170 |       )}171 |       {...props}172 |     >173 |       <ChevronDownIcon className="size-4" />174 |     </SelectPrimitive.ScrollDownButton>175 |   );176 | }177 | 178 | export {179 |   Select,180 |   SelectContent,181 |   SelectGroup,182 |   SelectItem,183 |   SelectLabel,184 |   SelectScrollDownButton,185 |   SelectScrollUpButton,186 |   SelectSeparator,187 |   SelectTrigger,188 |   SelectValue,189 | };
============================================================END: frontend/components/ui/select.tsx============================================================


============================================================FILE: frontend/components/ui/separator.tsxSIZE: 0.69 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as SeparatorPrimitive from "@radix-ui/react-separator";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Separator({  9 |   className, 10 |   orientation = "horizontal", 11 |   decorative = true, 12 |   ...props 13 | }: React.ComponentProps<typeof SeparatorPrimitive.Root>) { 14 |   return ( 15 |     <SeparatorPrimitive.Root 16 |       data-slot="separator-root" 17 |       decorative={decorative} 18 |       orientation={orientation} 19 |       className={cn( 20 |         "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px", 21 |         className, 22 |       )} 23 |       {...props} 24 |     /> 25 |   ); 26 | } 27 |  28 | export { Separator };
============================================================END: frontend/components/ui/separator.tsx============================================================


============================================================FILE: frontend/components/ui/sheet.tsxSIZE: 4.01 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as SheetPrimitive from "@radix-ui/react-dialog";  5 | import { XIcon } from "lucide-react";  6 |   7 | import { cn } from "./utils";  8 |   9 | function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) { 10 |   return <SheetPrimitive.Root data-slot="sheet" {...props} />; 11 | } 12 |  13 | function SheetTrigger({ 14 |   ...props 15 | }: React.ComponentProps<typeof SheetPrimitive.Trigger>) { 16 |   return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />; 17 | } 18 |  19 | function SheetClose({ 20 |   ...props 21 | }: React.ComponentProps<typeof SheetPrimitive.Close>) { 22 |   return <SheetPrimitive.Close data-slot="sheet-close" {...props} />; 23 | } 24 |  25 | function SheetPortal({ 26 |   ...props 27 | }: React.ComponentProps<typeof SheetPrimitive.Portal>) { 28 |   return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />; 29 | } 30 |  31 | function SheetOverlay({ 32 |   className, 33 |   ...props 34 | }: React.ComponentProps<typeof SheetPrimitive.Overlay>) { 35 |   return ( 36 |     <SheetPrimitive.Overlay 37 |       data-slot="sheet-overlay" 38 |       className={cn( 39 |         "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50", 40 |         className, 41 |       )} 42 |       {...props} 43 |     /> 44 |   ); 45 | } 46 |  47 | function SheetContent({ 48 |   className, 49 |   children, 50 |   side = "right", 51 |   ...props 52 | }: React.ComponentProps<typeof SheetPrimitive.Content> & { 53 |   side?: "top" | "right" | "bottom" | "left"; 54 | }) { 55 |   return ( 56 |     <SheetPortal> 57 |       <SheetOverlay /> 58 |       <SheetPrimitive.Content 59 |         data-slot="sheet-content" 60 |         className={cn( 61 |           "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500", 62 |           side === "right" && 63 |             "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm", 64 |           side === "left" && 65 |             "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm", 66 |           side === "top" && 67 |             "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b", 68 |           side === "bottom" && 69 |             "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t", 70 |           className, 71 |         )} 72 |         {...props} 73 |       > 74 |         {children} 75 |         <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none"> 76 |           <XIcon className="size-4" /> 77 |           <span className="sr-only">Close</span> 78 |         </SheetPrimitive.Close> 79 |       </SheetPrimitive.Content> 80 |     </SheetPortal> 81 |   ); 82 | } 83 |  84 | function SheetHeader({ className, ...props }: React.ComponentProps<"div">) { 85 |   return ( 86 |     <div 87 |       data-slot="sheet-header" 88 |       className={cn("flex flex-col gap-1.5 p-4", className)} 89 |       {...props} 90 |     /> 91 |   ); 92 | } 93 |  94 | function SheetFooter({ className, ...props }: React.ComponentProps<"div">) { 95 |   return ( 96 |     <div 97 |       data-slot="sheet-footer" 98 |       className={cn("mt-auto flex flex-col gap-2 p-4", className)} 99 |       {...props}100 |     />101 |   );102 | }103 | 104 | function SheetTitle({105 |   className,106 |   ...props107 | }: React.ComponentProps<typeof SheetPrimitive.Title>) {108 |   return (109 |     <SheetPrimitive.Title110 |       data-slot="sheet-title"111 |       className={cn("text-foreground font-semibold", className)}112 |       {...props}113 |     />114 |   );115 | }116 | 117 | function SheetDescription({118 |   className,119 |   ...props120 | }: React.ComponentProps<typeof SheetPrimitive.Description>) {121 |   return (122 |     <SheetPrimitive.Description123 |       data-slot="sheet-description"124 |       className={cn("text-muted-foreground text-sm", className)}125 |       {...props}126 |     />127 |   );128 | }129 | 130 | export {131 |   Sheet,132 |   SheetTrigger,133 |   SheetClose,134 |   SheetContent,135 |   SheetHeader,136 |   SheetFooter,137 |   SheetTitle,138 |   SheetDescription,139 | };
============================================================END: frontend/components/ui/sheet.tsx============================================================


============================================================FILE: frontend/components/ui/sidebar.tsxSIZE: 21.16 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import { Slot } from "@radix-ui/react-slot";  5 | import { VariantProps, cva } from "class-variance-authority";  6 | import { PanelLeftIcon } from "lucide-react";  7 |   8 | import { useIsMobile } from "./use-mobile";  9 | import { cn } from "./utils"; 10 | import { Button } from "./button"; 11 | import { Input } from "./input"; 12 | import { Separator } from "./separator"; 13 | import { 14 |   Sheet, 15 |   SheetContent, 16 |   SheetDescription, 17 |   SheetHeader, 18 |   SheetTitle, 19 | } from "./sheet"; 20 | import { Skeleton } from "./skeleton"; 21 | import { 22 |   Tooltip, 23 |   TooltipContent, 24 |   TooltipProvider, 25 |   TooltipTrigger, 26 | } from "./tooltip"; 27 |  28 | const SIDEBAR_COOKIE_NAME = "sidebar_state"; 29 | const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7; 30 | const SIDEBAR_WIDTH = "16rem"; 31 | const SIDEBAR_WIDTH_MOBILE = "18rem"; 32 | const SIDEBAR_WIDTH_ICON = "3rem"; 33 | const SIDEBAR_KEYBOARD_SHORTCUT = "b"; 34 |  35 | type SidebarContextProps = { 36 |   state: "expanded" | "collapsed"; 37 |   open: boolean; 38 |   setOpen: (open: boolean) => void; 39 |   openMobile: boolean; 40 |   setOpenMobile: (open: boolean) => void; 41 |   isMobile: boolean; 42 |   toggleSidebar: () => void; 43 | }; 44 |  45 | const SidebarContext = React.createContext<SidebarContextProps | null>(null); 46 |  47 | function useSidebar() { 48 |   const context = React.useContext(SidebarContext); 49 |   if (!context) { 50 |     throw new Error("useSidebar must be used within a SidebarProvider."); 51 |   } 52 |  53 |   return context; 54 | } 55 |  56 | function SidebarProvider({ 57 |   defaultOpen = true, 58 |   open: openProp, 59 |   onOpenChange: setOpenProp, 60 |   className, 61 |   style, 62 |   children, 63 |   ...props 64 | }: React.ComponentProps<"div"> & { 65 |   defaultOpen?: boolean; 66 |   open?: boolean; 67 |   onOpenChange?: (open: boolean) => void; 68 | }) { 69 |   const isMobile = useIsMobile(); 70 |   const [openMobile, setOpenMobile] = React.useState(false); 71 |  72 |   const [_open, _setOpen] = React.useState(defaultOpen); 73 |   const open = openProp ?? _open; 74 |   const setOpen = React.useCallback( 75 |     (value: boolean | ((value: boolean) => boolean)) => { 76 |       const openState = typeof value === "function" ? value(open) : value; 77 |       if (setOpenProp) { 78 |         setOpenProp(openState); 79 |       } else { 80 |         _setOpen(openState); 81 |       } 82 |  83 |       document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`; 84 |     }, 85 |     [setOpenProp, open], 86 |   ); 87 |  88 |   const toggleSidebar = React.useCallback(() => { 89 |     return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open); 90 |   }, [isMobile, setOpen, setOpenMobile]); 91 |  92 |   React.useEffect(() => { 93 |     const handleKeyDown = (event: KeyboardEvent) => { 94 |       if ( 95 |         event.key === SIDEBAR_KEYBOARD_SHORTCUT && 96 |         (event.metaKey || event.ctrlKey) 97 |       ) { 98 |         event.preventDefault(); 99 |         toggleSidebar();100 |       }101 |     };102 | 103 |     window.addEventListener("keydown", handleKeyDown);104 |     return () => window.removeEventListener("keydown", handleKeyDown);105 |   }, [toggleSidebar]);106 | 107 |   const state = open ? "expanded" : "collapsed";108 | 109 |   const contextValue = React.useMemo<SidebarContextProps>(110 |     () => ({111 |       state,112 |       open,113 |       setOpen,114 |       isMobile,115 |       openMobile,116 |       setOpenMobile,117 |       toggleSidebar,118 |     }),119 |     [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],120 |   );121 | 122 |   return (123 |     <SidebarContext.Provider value={contextValue}>124 |       <TooltipProvider delayDuration={0}>125 |         <div126 |           data-slot="sidebar-wrapper"127 |           style={128 |             {129 |               "--sidebar-width": SIDEBAR_WIDTH,130 |               "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,131 |               ...style,132 |             } as React.CSSProperties133 |           }134 |           className={cn(135 |             "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",136 |             className,137 |           )}138 |           {...props}139 |         >140 |           {children}141 |         </div>142 |       </TooltipProvider>143 |     </SidebarContext.Provider>144 |   );145 | }146 | 147 | function Sidebar({148 |   side = "left",149 |   variant = "sidebar",150 |   collapsible = "offcanvas",151 |   className,152 |   children,153 |   ...props154 | }: React.ComponentProps<"div"> & {155 |   side?: "left" | "right";156 |   variant?: "sidebar" | "floating" | "inset";157 |   collapsible?: "offcanvas" | "icon" | "none";158 | }) {159 |   const { isMobile, state, openMobile, setOpenMobile } = useSidebar();160 | 161 |   if (collapsible === "none") {162 |     return (163 |       <div164 |         data-slot="sidebar"165 |         className={cn(166 |           "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",167 |           className,168 |         )}169 |         {...props}170 |       >171 |         {children}172 |       </div>173 |     );174 |   }175 | 176 |   if (isMobile) {177 |     return (178 |       <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>179 |         <SheetContent180 |           data-sidebar="sidebar"181 |           data-slot="sidebar"182 |           data-mobile="true"183 |           className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"184 |           style={185 |             {186 |               "--sidebar-width": SIDEBAR_WIDTH_MOBILE,187 |             } as React.CSSProperties188 |           }189 |           side={side}190 |         >191 |           <SheetHeader className="sr-only">192 |             <SheetTitle>Sidebar</SheetTitle>193 |             <SheetDescription>Displays the mobile sidebar.</SheetDescription>194 |           </SheetHeader>195 |           <div className="flex h-full w-full flex-col">{children}</div>196 |         </SheetContent>197 |       </Sheet>198 |     );199 |   }200 | 201 |   return (202 |     <div203 |       className="group peer text-sidebar-foreground hidden md:block"204 |       data-state={state}205 |       data-collapsible={state === "collapsed" ? collapsible : ""}206 |       data-variant={variant}207 |       data-side={side}208 |       data-slot="sidebar"209 |     >210 |       {}211 |       <div212 |         data-slot="sidebar-gap"213 |         className={cn(214 |           "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",215 |           "group-data-[collapsible=offcanvas]:w-0",216 |           "group-data-[side=right]:rotate-180",217 |           variant === "floating" || variant === "inset"218 |             ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"219 |             : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",220 |         )}221 |       />222 |       <div223 |         data-slot="sidebar-container"224 |         className={cn(225 |           "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",226 |           side === "left"227 |             ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"228 |             : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",229 | 230 |           variant === "floating" || variant === "inset"231 |             ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"232 |             : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",233 |           className,234 |         )}235 |         {...props}236 |       >237 |         <div238 |           data-sidebar="sidebar"239 |           data-slot="sidebar-inner"240 |           className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"241 |         >242 |           {children}243 |         </div>244 |       </div>245 |     </div>246 |   );247 | }248 | 249 | function SidebarTrigger({250 |   className,251 |   onClick,252 |   ...props253 | }: React.ComponentProps<typeof Button>) {254 |   const { toggleSidebar } = useSidebar();255 | 256 |   return (257 |     <Button258 |       data-sidebar="trigger"259 |       data-slot="sidebar-trigger"260 |       variant="ghost"261 |       size="icon"262 |       className={cn("size-7", className)}263 |       onClick={(event) => {264 |         onClick?.(event);265 |         toggleSidebar();266 |       }}267 |       {...props}268 |     >269 |       <PanelLeftIcon />270 |       <span className="sr-only">Toggle Sidebar</span>271 |     </Button>272 |   );273 | }274 | 275 | function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {276 |   const { toggleSidebar } = useSidebar();277 | 278 |   return (279 |     <button280 |       data-sidebar="rail"281 |       data-slot="sidebar-rail"282 |       aria-label="Toggle Sidebar"283 |       tabIndex={-1}284 |       onClick={toggleSidebar}285 |       title="Toggle Sidebar"286 |       className={cn(287 |         "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",288 |         "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",289 |         "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",290 |         "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",291 |         "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",292 |         "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",293 |         className,294 |       )}295 |       {...props}296 |     />297 |   );298 | }299 | 300 | function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {301 |   return (302 |     <main303 |       data-slot="sidebar-inset"304 |       className={cn(305 |         "bg-background relative flex w-full flex-1 flex-col",306 |         "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",307 |         className,308 |       )}309 |       {...props}310 |     />311 |   );312 | }313 | 314 | function SidebarInput({315 |   className,316 |   ...props317 | }: React.ComponentProps<typeof Input>) {318 |   return (319 |     <Input320 |       data-slot="sidebar-input"321 |       data-sidebar="input"322 |       className={cn("bg-background h-8 w-full shadow-none", className)}323 |       {...props}324 |     />325 |   );326 | }327 | 328 | function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {329 |   return (330 |     <div331 |       data-slot="sidebar-header"332 |       data-sidebar="header"333 |       className={cn("flex flex-col gap-2 p-2", className)}334 |       {...props}335 |     />336 |   );337 | }338 | 339 | function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {340 |   return (341 |     <div342 |       data-slot="sidebar-footer"343 |       data-sidebar="footer"344 |       className={cn("flex flex-col gap-2 p-2", className)}345 |       {...props}346 |     />347 |   );348 | }349 | 350 | function SidebarSeparator({351 |   className,352 |   ...props353 | }: React.ComponentProps<typeof Separator>) {354 |   return (355 |     <Separator356 |       data-slot="sidebar-separator"357 |       data-sidebar="separator"358 |       className={cn("bg-sidebar-border mx-2 w-auto", className)}359 |       {...props}360 |     />361 |   );362 | }363 | 364 | function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {365 |   return (366 |     <div367 |       data-slot="sidebar-content"368 |       data-sidebar="content"369 |       className={cn(370 |         "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",371 |         className,372 |       )}373 |       {...props}374 |     />375 |   );376 | }377 | 378 | function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {379 |   return (380 |     <div381 |       data-slot="sidebar-group"382 |       data-sidebar="group"383 |       className={cn("relative flex w-full min-w-0 flex-col p-2", className)}384 |       {...props}385 |     />386 |   );387 | }388 | 389 | function SidebarGroupLabel({390 |   className,391 |   asChild = false,392 |   ...props393 | }: React.ComponentProps<"div"> & { asChild?: boolean }) {394 |   const Comp = asChild ? Slot : "div";395 | 396 |   return (397 |     <Comp398 |       data-slot="sidebar-group-label"399 |       data-sidebar="group-label"400 |       className={cn(401 |         "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",402 |         "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",403 |         className,404 |       )}405 |       {...props}406 |     />407 |   );408 | }409 | 410 | function SidebarGroupAction({411 |   className,412 |   asChild = false,413 |   ...props414 | }: React.ComponentProps<"button"> & { asChild?: boolean }) {415 |   const Comp = asChild ? Slot : "button";416 | 417 |   return (418 |     <Comp419 |       data-slot="sidebar-group-action"420 |       data-sidebar="group-action"421 |       className={cn(422 |         "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",423 | 424 |         "after:absolute after:-inset-2 md:after:hidden",425 |         "group-data-[collapsible=icon]:hidden",426 |         className,427 |       )}428 |       {...props}429 |     />430 |   );431 | }432 | 433 | function SidebarGroupContent({434 |   className,435 |   ...props436 | }: React.ComponentProps<"div">) {437 |   return (438 |     <div439 |       data-slot="sidebar-group-content"440 |       data-sidebar="group-content"441 |       className={cn("w-full text-sm", className)}442 |       {...props}443 |     />444 |   );445 | }446 | 447 | function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {448 |   return (449 |     <ul450 |       data-slot="sidebar-menu"451 |       data-sidebar="menu"452 |       className={cn("flex w-full min-w-0 flex-col gap-1", className)}453 |       {...props}454 |     />455 |   );456 | }457 | 458 | function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {459 |   return (460 |     <li461 |       data-slot="sidebar-menu-item"462 |       data-sidebar="menu-item"463 |       className={cn("group/menu-item relative", className)}464 |       {...props}465 |     />466 |   );467 | }468 | 469 | const sidebarMenuButtonVariants = cva(470 |   "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",471 |   {472 |     variants: {473 |       variant: {474 |         default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",475 |         outline:476 |           "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",477 |       },478 |       size: {479 |         default: "h-8 text-sm",480 |         sm: "h-7 text-xs",481 |         lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",482 |       },483 |     },484 |     defaultVariants: {485 |       variant: "default",486 |       size: "default",487 |     },488 |   },489 | );490 | 491 | function SidebarMenuButton({492 |   asChild = false,493 |   isActive = false,494 |   variant = "default",495 |   size = "default",496 |   tooltip,497 |   className,498 |   ...props499 | }: React.ComponentProps<"button"> & {500 |   asChild?: boolean;501 |   isActive?: boolean;502 |   tooltip?: string | React.ComponentProps<typeof TooltipContent>;503 | } & VariantProps<typeof sidebarMenuButtonVariants>) {504 |   const Comp = asChild ? Slot : "button";505 |   const { isMobile, state } = useSidebar();506 | 507 |   const button = (508 |     <Comp509 |       data-slot="sidebar-menu-button"510 |       data-sidebar="menu-button"511 |       data-size={size}512 |       data-active={isActive}513 |       className={cn(sidebarMenuButtonVariants({ variant, size }), className)}514 |       {...props}515 |     />516 |   );517 | 518 |   if (!tooltip) {519 |     return button;520 |   }521 | 522 |   if (typeof tooltip === "string") {523 |     tooltip = {524 |       children: tooltip,525 |     };526 |   }527 | 528 |   return (529 |     <Tooltip>530 |       <TooltipTrigger asChild>{button}</TooltipTrigger>531 |       <TooltipContent532 |         side="right"533 |         align="center"534 |         hidden={state !== "collapsed" || isMobile}535 |         {...tooltip}536 |       />537 |     </Tooltip>538 |   );539 | }540 | 541 | function SidebarMenuAction({542 |   className,543 |   asChild = false,544 |   showOnHover = false,545 |   ...props546 | }: React.ComponentProps<"button"> & {547 |   asChild?: boolean;548 |   showOnHover?: boolean;549 | }) {550 |   const Comp = asChild ? Slot : "button";551 | 552 |   return (553 |     <Comp554 |       data-slot="sidebar-menu-action"555 |       data-sidebar="menu-action"556 |       className={cn(557 |         "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",558 | 559 |         "after:absolute after:-inset-2 md:after:hidden",560 |         "peer-data-[size=sm]/menu-button:top-1",561 |         "peer-data-[size=default]/menu-button:top-1.5",562 |         "peer-data-[size=lg]/menu-button:top-2.5",563 |         "group-data-[collapsible=icon]:hidden",564 |         showOnHover &&565 |           "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",566 |         className,567 |       )}568 |       {...props}569 |     />570 |   );571 | }572 | 573 | function SidebarMenuBadge({574 |   className,575 |   ...props576 | }: React.ComponentProps<"div">) {577 |   return (578 |     <div579 |       data-slot="sidebar-menu-badge"580 |       data-sidebar="menu-badge"581 |       className={cn(582 |         "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",583 |         "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",584 |         "peer-data-[size=sm]/menu-button:top-1",585 |         "peer-data-[size=default]/menu-button:top-1.5",586 |         "peer-data-[size=lg]/menu-button:top-2.5",587 |         "group-data-[collapsible=icon]:hidden",588 |         className,589 |       )}590 |       {...props}591 |     />592 |   );593 | }594 | 595 | function SidebarMenuSkeleton({596 |   className,597 |   showIcon = false,598 |   ...props599 | }: React.ComponentProps<"div"> & {600 |   showIcon?: boolean;601 | }) {602 | 603 |   const width = React.useMemo(() => {604 |     return `${Math.floor(Math.random() * 40) + 50}%`;605 |   }, []);606 | 607 |   return (608 |     <div609 |       data-slot="sidebar-menu-skeleton"610 |       data-sidebar="menu-skeleton"611 |       className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}612 |       {...props}613 |     >614 |       {showIcon && (615 |         <Skeleton616 |           className="size-4 rounded-md"617 |           data-sidebar="menu-skeleton-icon"618 |         />619 |       )}620 |       <Skeleton621 |         className="h-4 max-w-(--skeleton-width) flex-1"622 |         data-sidebar="menu-skeleton-text"623 |         style={624 |           {625 |             "--skeleton-width": width,626 |           } as React.CSSProperties627 |         }628 |       />629 |     </div>630 |   );631 | }632 | 633 | function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {634 |   return (635 |     <ul636 |       data-slot="sidebar-menu-sub"637 |       data-sidebar="menu-sub"638 |       className={cn(639 |         "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",640 |         "group-data-[collapsible=icon]:hidden",641 |         className,642 |       )}643 |       {...props}644 |     />645 |   );646 | }647 | 648 | function SidebarMenuSubItem({649 |   className,650 |   ...props651 | }: React.ComponentProps<"li">) {652 |   return (653 |     <li654 |       data-slot="sidebar-menu-sub-item"655 |       data-sidebar="menu-sub-item"656 |       className={cn("group/menu-sub-item relative", className)}657 |       {...props}658 |     />659 |   );660 | }661 | 662 | function SidebarMenuSubButton({663 |   asChild = false,664 |   size = "md",665 |   isActive = false,666 |   className,667 |   ...props668 | }: React.ComponentProps<"a"> & {669 |   asChild?: boolean;670 |   size?: "sm" | "md";671 |   isActive?: boolean;672 | }) {673 |   const Comp = asChild ? Slot : "a";674 | 675 |   return (676 |     <Comp677 |       data-slot="sidebar-menu-sub-button"678 |       data-sidebar="menu-sub-button"679 |       data-size={size}680 |       data-active={isActive}681 |       className={cn(682 |         "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",683 |         "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",684 |         size === "sm" && "text-xs",685 |         size === "md" && "text-sm",686 |         "group-data-[collapsible=icon]:hidden",687 |         className,688 |       )}689 |       {...props}690 |     />691 |   );692 | }693 | 694 | export {695 |   Sidebar,696 |   SidebarContent,697 |   SidebarFooter,698 |   SidebarGroup,699 |   SidebarGroupAction,700 |   SidebarGroupContent,701 |   SidebarGroupLabel,702 |   SidebarHeader,703 |   SidebarInput,704 |   SidebarInset,705 |   SidebarMenu,706 |   SidebarMenuAction,707 |   SidebarMenuBadge,708 |   SidebarMenuButton,709 |   SidebarMenuItem,710 |   SidebarMenuSkeleton,711 |   SidebarMenuSub,712 |   SidebarMenuSubButton,713 |   SidebarMenuSubItem,714 |   SidebarProvider,715 |   SidebarRail,716 |   SidebarSeparator,717 |   SidebarTrigger,718 |   useSidebar,719 | };
============================================================END: frontend/components/ui/sidebar.tsx============================================================


============================================================FILE: frontend/components/ui/skeleton.tsxSIZE: 0.27 KB============================================================
  1 | import { cn } from "./utils";  2 |   3 | function Skeleton({ className, ...props }: React.ComponentProps<"div">) {  4 |   return (  5 |     <div  6 |       data-slot="skeleton"  7 |       className={cn("bg-accent animate-pulse rounded-md", className)}  8 |       {...props}  9 |     /> 10 |   ); 11 | } 12 |  13 | export { Skeleton };
============================================================END: frontend/components/ui/skeleton.tsx============================================================


============================================================FILE: frontend/components/ui/slider.tsxSIZE: 1.96 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as SliderPrimitive from "@radix-ui/react-slider";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Slider({  9 |   className, 10 |   defaultValue, 11 |   value, 12 |   min = 0, 13 |   max = 100, 14 |   ...props 15 | }: React.ComponentProps<typeof SliderPrimitive.Root>) { 16 |   const _values = React.useMemo( 17 |     () => 18 |       Array.isArray(value) 19 |         ? value 20 |         : Array.isArray(defaultValue) 21 |           ? defaultValue 22 |           : [min, max], 23 |     [value, defaultValue, min, max], 24 |   ); 25 |  26 |   return ( 27 |     <SliderPrimitive.Root 28 |       data-slot="slider" 29 |       defaultValue={defaultValue} 30 |       value={value} 31 |       min={min} 32 |       max={max} 33 |       className={cn( 34 |         "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col", 35 |         className, 36 |       )} 37 |       {...props} 38 |     > 39 |       <SliderPrimitive.Track 40 |         data-slot="slider-track" 41 |         className={cn( 42 |           "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5", 43 |         )} 44 |       > 45 |         <SliderPrimitive.Range 46 |           data-slot="slider-range" 47 |           className={cn( 48 |             "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full", 49 |           )} 50 |         /> 51 |       </SliderPrimitive.Track> 52 |       {Array.from({ length: _values.length }, (_, index) => ( 53 |         <SliderPrimitive.Thumb 54 |           data-slot="slider-thumb" 55 |           key={index} 56 |           className="border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50" 57 |         /> 58 |       ))} 59 |     </SliderPrimitive.Root> 60 |   ); 61 | } 62 |  63 | export { Slider };
============================================================END: frontend/components/ui/slider.tsx============================================================


============================================================FILE: frontend/components/ui/sonner.tsxSIZE: 0.56 KB============================================================
  1 | "use client";  2 |   3 | import { useTheme } from "next-themes";  4 | import { Toaster as Sonner, ToasterProps } from "sonner";  5 |   6 | const Toaster = ({ ...props }: ToasterProps) => {  7 |   const { theme = "system" } = useTheme();  8 |   9 |   return ( 10 |     <Sonner 11 |       theme={theme as ToasterProps["theme"]} 12 |       className="toaster group" 13 |       style={ 14 |         { 15 |           "--normal-bg": "var(--popover)", 16 |           "--normal-text": "var(--popover-foreground)", 17 |           "--normal-border": "var(--border)", 18 |         } as React.CSSProperties 19 |       } 20 |       {...props} 21 |     /> 22 |   ); 23 | }; 24 |  25 | export { Toaster };
============================================================END: frontend/components/ui/sonner.tsx============================================================


============================================================FILE: frontend/components/ui/switch.tsxSIZE: 1.15 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as SwitchPrimitive from "@radix-ui/react-switch";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Switch({  9 |   className, 10 |   ...props 11 | }: React.ComponentProps<typeof SwitchPrimitive.Root>) { 12 |   return ( 13 |     <SwitchPrimitive.Root 14 |       data-slot="switch" 15 |       className={cn( 16 |         "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50", 17 |         className, 18 |       )} 19 |       {...props} 20 |     > 21 |       <SwitchPrimitive.Thumb 22 |         data-slot="switch-thumb" 23 |         className={cn( 24 |           "bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0", 25 |         )} 26 |       /> 27 |     </SwitchPrimitive.Root> 28 |   ); 29 | } 30 |  31 | export { Switch };
============================================================END: frontend/components/ui/switch.tsx============================================================


============================================================FILE: frontend/components/ui/table.tsxSIZE: 2.40 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 |   5 | import { cn } from "./utils";  6 |   7 | function Table({ className, ...props }: React.ComponentProps<"table">) {  8 |   return (  9 |     <div 10 |       data-slot="table-container" 11 |       className="relative w-full overflow-x-auto" 12 |     > 13 |       <table 14 |         data-slot="table" 15 |         className={cn("w-full caption-bottom text-sm", className)} 16 |         {...props} 17 |       /> 18 |     </div> 19 |   ); 20 | } 21 |  22 | function TableHeader({ className, ...props }: React.ComponentProps<"thead">) { 23 |   return ( 24 |     <thead 25 |       data-slot="table-header" 26 |       className={cn("[&_tr]:border-b", className)} 27 |       {...props} 28 |     /> 29 |   ); 30 | } 31 |  32 | function TableBody({ className, ...props }: React.ComponentProps<"tbody">) { 33 |   return ( 34 |     <tbody 35 |       data-slot="table-body" 36 |       className={cn("[&_tr:last-child]:border-0", className)} 37 |       {...props} 38 |     /> 39 |   ); 40 | } 41 |  42 | function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) { 43 |   return ( 44 |     <tfoot 45 |       data-slot="table-footer" 46 |       className={cn( 47 |         "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0", 48 |         className, 49 |       )} 50 |       {...props} 51 |     /> 52 |   ); 53 | } 54 |  55 | function TableRow({ className, ...props }: React.ComponentProps<"tr">) { 56 |   return ( 57 |     <tr 58 |       data-slot="table-row" 59 |       className={cn( 60 |         "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors", 61 |         className, 62 |       )} 63 |       {...props} 64 |     /> 65 |   ); 66 | } 67 |  68 | function TableHead({ className, ...props }: React.ComponentProps<"th">) { 69 |   return ( 70 |     <th 71 |       data-slot="table-head" 72 |       className={cn( 73 |         "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]", 74 |         className, 75 |       )} 76 |       {...props} 77 |     /> 78 |   ); 79 | } 80 |  81 | function TableCell({ className, ...props }: React.ComponentProps<"td">) { 82 |   return ( 83 |     <td 84 |       data-slot="table-cell" 85 |       className={cn( 86 |         "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]", 87 |         className, 88 |       )} 89 |       {...props} 90 |     /> 91 |   ); 92 | } 93 |  94 | function TableCaption({ 95 |   className, 96 |   ...props 97 | }: React.ComponentProps<"caption">) { 98 |   return ( 99 |     <caption100 |       data-slot="table-caption"101 |       className={cn("text-muted-foreground mt-4 text-sm", className)}102 |       {...props}103 |     />104 |   );105 | }106 | 107 | export {108 |   Table,109 |   TableHeader,110 |   TableBody,111 |   TableFooter,112 |   TableHead,113 |   TableRow,114 |   TableCell,115 |   TableCaption,116 | };
============================================================END: frontend/components/ui/table.tsx============================================================


============================================================FILE: frontend/components/ui/tabs.tsxSIZE: 1.90 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as TabsPrimitive from "@radix-ui/react-tabs";  5 |   6 | import { cn } from "./utils";  7 |   8 | function Tabs({  9 |   className, 10 |   ...props 11 | }: React.ComponentProps<typeof TabsPrimitive.Root>) { 12 |   return ( 13 |     <TabsPrimitive.Root 14 |       data-slot="tabs" 15 |       className={cn("flex flex-col gap-2", className)} 16 |       {...props} 17 |     /> 18 |   ); 19 | } 20 |  21 | function TabsList({ 22 |   className, 23 |   ...props 24 | }: React.ComponentProps<typeof TabsPrimitive.List>) { 25 |   return ( 26 |     <TabsPrimitive.List 27 |       data-slot="tabs-list" 28 |       className={cn( 29 |         "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex", 30 |         className, 31 |       )} 32 |       {...props} 33 |     /> 34 |   ); 35 | } 36 |  37 | function TabsTrigger({ 38 |   className, 39 |   ...props 40 | }: React.ComponentProps<typeof TabsPrimitive.Trigger>) { 41 |   return ( 42 |     <TabsPrimitive.Trigger 43 |       data-slot="tabs-trigger" 44 |       className={cn( 45 |         "data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4", 46 |         className, 47 |       )} 48 |       {...props} 49 |     /> 50 |   ); 51 | } 52 |  53 | function TabsContent({ 54 |   className, 55 |   ...props 56 | }: React.ComponentProps<typeof TabsPrimitive.Content>) { 57 |   return ( 58 |     <TabsPrimitive.Content 59 |       data-slot="tabs-content" 60 |       className={cn("flex-1 outline-none", className)} 61 |       {...props} 62 |     /> 63 |   ); 64 | } 65 |  66 | export { Tabs, TabsList, TabsTrigger, TabsContent };
============================================================END: frontend/components/ui/tabs.tsx============================================================


============================================================FILE: frontend/components/ui/toggle-group.tsxSIZE: 1.88 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group";  5 | import { type VariantProps } from "class-variance-authority";  6 |   7 | import { cn } from "./utils";  8 | import { toggleVariants } from "./toggle";  9 |  10 | const ToggleGroupContext = React.createContext< 11 |   VariantProps<typeof toggleVariants> 12 | >({ 13 |   size: "default", 14 |   variant: "default", 15 | }); 16 |  17 | function ToggleGroup({ 18 |   className, 19 |   variant, 20 |   size, 21 |   children, 22 |   ...props 23 | }: React.ComponentProps<typeof ToggleGroupPrimitive.Root> & 24 |   VariantProps<typeof toggleVariants>) { 25 |   return ( 26 |     <ToggleGroupPrimitive.Root 27 |       data-slot="toggle-group" 28 |       data-variant={variant} 29 |       data-size={size} 30 |       className={cn( 31 |         "group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs", 32 |         className, 33 |       )} 34 |       {...props} 35 |     > 36 |       <ToggleGroupContext.Provider value={{ variant, size }}> 37 |         {children} 38 |       </ToggleGroupContext.Provider> 39 |     </ToggleGroupPrimitive.Root> 40 |   ); 41 | } 42 |  43 | function ToggleGroupItem({ 44 |   className, 45 |   children, 46 |   variant, 47 |   size, 48 |   ...props 49 | }: React.ComponentProps<typeof ToggleGroupPrimitive.Item> & 50 |   VariantProps<typeof toggleVariants>) { 51 |   const context = React.useContext(ToggleGroupContext); 52 |  53 |   return ( 54 |     <ToggleGroupPrimitive.Item 55 |       data-slot="toggle-group-item" 56 |       data-variant={context.variant || variant} 57 |       data-size={context.size || size} 58 |       className={cn( 59 |         toggleVariants({ 60 |           variant: context.variant || variant, 61 |           size: context.size || size, 62 |         }), 63 |         "min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l", 64 |         className, 65 |       )} 66 |       {...props} 67 |     > 68 |       {children} 69 |     </ToggleGroupPrimitive.Item> 70 |   ); 71 | } 72 |  73 | export { ToggleGroup, ToggleGroupItem };
============================================================END: frontend/components/ui/toggle-group.tsx============================================================


============================================================FILE: frontend/components/ui/toggle.tsxSIZE: 1.53 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as TogglePrimitive from "@radix-ui/react-toggle";  5 | import { cva, type VariantProps } from "class-variance-authority";  6 |   7 | import { cn } from "./utils";  8 |   9 | const toggleVariants = cva( 10 |   "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap", 11 |   { 12 |     variants: { 13 |       variant: { 14 |         default: "bg-transparent", 15 |         outline: 16 |           "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground", 17 |       }, 18 |       size: { 19 |         default: "h-9 px-2 min-w-9", 20 |         sm: "h-8 px-1.5 min-w-8", 21 |         lg: "h-10 px-2.5 min-w-10", 22 |       }, 23 |     }, 24 |     defaultVariants: { 25 |       variant: "default", 26 |       size: "default", 27 |     }, 28 |   }, 29 | ); 30 |  31 | function Toggle({ 32 |   className, 33 |   variant, 34 |   size, 35 |   ...props 36 | }: React.ComponentProps<typeof TogglePrimitive.Root> & 37 |   VariantProps<typeof toggleVariants>) { 38 |   return ( 39 |     <TogglePrimitive.Root 40 |       data-slot="toggle" 41 |       className={cn(toggleVariants({ variant, size, className }))} 42 |       {...props} 43 |     /> 44 |   ); 45 | } 46 |  47 | export { Toggle, toggleVariants };
============================================================END: frontend/components/ui/toggle.tsx============================================================


============================================================FILE: frontend/components/ui/tooltip.tsxSIZE: 1.85 KB============================================================
  1 | "use client";  2 |   3 | import * as React from "react";  4 | import * as TooltipPrimitive from "@radix-ui/react-tooltip";  5 |   6 | import { cn } from "./utils";  7 |   8 | function TooltipProvider({  9 |   delayDuration = 0, 10 |   ...props 11 | }: React.ComponentProps<typeof TooltipPrimitive.Provider>) { 12 |   return ( 13 |     <TooltipPrimitive.Provider 14 |       data-slot="tooltip-provider" 15 |       delayDuration={delayDuration} 16 |       {...props} 17 |     /> 18 |   ); 19 | } 20 |  21 | function Tooltip({ 22 |   ...props 23 | }: React.ComponentProps<typeof TooltipPrimitive.Root>) { 24 |   return ( 25 |     <TooltipProvider> 26 |       <TooltipPrimitive.Root data-slot="tooltip" {...props} /> 27 |     </TooltipProvider> 28 |   ); 29 | } 30 |  31 | function TooltipTrigger({ 32 |   ...props 33 | }: React.ComponentProps<typeof TooltipPrimitive.Trigger>) { 34 |   return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />; 35 | } 36 |  37 | function TooltipContent({ 38 |   className, 39 |   sideOffset = 0, 40 |   children, 41 |   ...props 42 | }: React.ComponentProps<typeof TooltipPrimitive.Content>) { 43 |   return ( 44 |     <TooltipPrimitive.Portal> 45 |       <TooltipPrimitive.Content 46 |         data-slot="tooltip-content" 47 |         sideOffset={sideOffset} 48 |         className={cn( 49 |           "bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance", 50 |           className, 51 |         )} 52 |         {...props} 53 |       > 54 |         {children} 55 |         <TooltipPrimitive.Arrow className="bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" /> 56 |       </TooltipPrimitive.Content> 57 |     </TooltipPrimitive.Portal> 58 |   ); 59 | } 60 |  61 | export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };
============================================================END: frontend/components/ui/tooltip.tsx============================================================


============================================================FILE: frontend/components/ui/use-mobile.tsSIZE: 0.57 KB============================================================
  1 | import * as React from "react";  2 |   3 | const MOBILE_BREAKPOINT = 768;  4 |   5 | export function useIsMobile() {  6 |   const [isMobile, setIsMobile] = React.useState<boolean | undefined>(  7 |     undefined,  8 |   );  9 |  10 |   React.useEffect(() => { 11 |     const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`); 12 |     const onChange = () => { 13 |       setIsMobile(window.innerWidth < MOBILE_BREAKPOINT); 14 |     }; 15 |     mql.addEventListener("change", onChange); 16 |     setIsMobile(window.innerWidth < MOBILE_BREAKPOINT); 17 |     return () => mql.removeEventListener("change", onChange); 18 |   }, []); 19 |  20 |   return !!isMobile; 21 | }
============================================================END: frontend/components/ui/use-mobile.ts============================================================


============================================================FILE: frontend/export-frontend-code.jsSIZE: 10.83 KB============================================================
  1 | #!/usr/bin/env node  2 |   3 | import fs from 'fs';  4 | import path from 'path';  5 | import { fileURLToPath } from 'url';  6 |   7 | const __filename = fileURLToPath(import.meta.url);  8 | const __dirname = path.dirname(__filename);  9 |  10 | const FRONTEND_ROOT = __dirname; 11 | const OUTPUT_FILE = path.join(FRONTEND_ROOT, 'frontend-code-analysis.txt'); 12 |  13 | const INCLUDE_PATTERNS = [ 14 |  15 |   'package.json', 16 |   'next.config.ts', 17 |   'tsconfig.json', 18 |   'tailwind.config.ts', 19 |   'postcss.config.js', 20 |  21 |   'app/layout.tsx', 22 |   'app/page.tsx', 23 |   'app/globals.css', 24 |   'app/error.tsx', 25 |   'app/loading.tsx', 26 |   'app/not-found.tsx', 27 |  28 |   'app/api/health/route.ts', 29 |   'app/api/auth*.ts', 30 |   'app/api/client*.ts', 31 |   'app/api/admin*.ts', 32 |   'app/api/stripe*.ts', 33 |   'app/api/izipay*.ts', 34 |   'app/api/chat*.ts', 35 |   'app/api/booking/route.ts', 36 |   'app/api/packages/route.ts', 37 |   'app/api/schedules/route.ts', 38 |   'app/api/schedule-slots/route.ts', 39 |   'app/api/content/route.ts', 40 |   'app/api/email*.ts', 41 |   'app/api/sms*.ts', 42 |   'app/api/telegram*.ts', 43 |   'app/api/whatsapp*.ts', 44 |  45 |   'app/(client)*.tsx', 46 |  47 |   'app/(admin)*.tsx', 48 |  49 |   'components/AdminDashboard.tsx', 50 |   'components/ClientAuthModal.tsx', 51 |   'components/CustomerDashboard.tsx', 52 |   'components/BookingSection.tsx', 53 |   'components/PackagesAndPricing.tsx', 54 |   'components/PackagePurchaseFlow.tsx', 55 |   'components/PaymentMethodManagement.tsx', 56 |   'components/ScheduleManagement.tsx', 57 |   'components/ContentManagement.tsx', 58 |   'components/EmailManagement.tsx', 59 |   'components/BugReportSystem.tsx', 60 |   'components/ChatWindow.tsx', 61 |   'components/Header.tsx', 62 |   'components/MobileMenu.tsx', 63 |   'components/LoginModal.tsx', 64 |   'components/App.tsx', 65 |   'components/MainPageClient.tsx', 66 |   'components/HeroSection.tsx', 67 |   'components/AboutSection.tsx', 68 |   'components/ApproachSection.tsx', 69 |   'components/SessionSection.tsx', 70 |   'components/BookingSectionWithReminder.tsx', 71 |   'components/CustomerBookingFlow.tsx', 72 |   'components/CalendlyBookingFlow.tsx', 73 |   'components/AstralChart.tsx', 74 |   'components/ConstellationBackground.tsx', 75 |   'components/FullPageSlider.tsx', 76 |   'components/PackageDisplay.tsx', 77 |   'components/PurchaseHistory.tsx', 78 |   'components/ErrorBoundary.tsx', 79 |   'components/DynamicSectionRenderer.tsx', 80 |   'components/ImageManagement.tsx', 81 |   'components/SeoManagement.tsx', 82 |   'components/SettingsManagement.tsx', 83 |   'components/RasaModelTuning.tsx', 84 |   'components/RasaMonitoring.tsx', 85 |   'components/BookingsManagement.tsx', 86 |   'components/ClientManagement.tsx', 87 |   'components/PaymentRecordsManagement.tsx', 88 |   'components/PurchaseHistoryManagement.tsx', 89 |   'components/LiveSessionConfigManagement.tsx', 90 |   'components/TelegramConfigManagement.tsx', 91 |   'components/ExternalAPIManagement.tsx', 92 |   'components/ContentManagementDashboard.tsx', 93 |   'components/AuthTest.tsx', 94 |   'components/BugReportButton.tsx', 95 |   'components/BugReportManagement.tsx', 96 |   'components/BugReportTrigger.tsx', 97 |  98 |   'components/cms*.tsx', 99 | 100 |   'components/communication*.tsx',101 | 102 |   'components/payment*.tsx',103 |   'components/stripe*.tsx',104 |   'components/izipay*.tsx',105 | 106 |   'components/ui*.tsx',107 |   'components/ui*.ts',108 | 109 |   'components/modals*.tsx',110 | 111 |   'components/theme*.tsx',112 | 113 |   'hooks*.tsx',114 |   'hooks*.ts',115 | 116 |   'lib*.ts',117 |   'lib*.tsx',118 | 119 |   'types*.ts',120 | 121 |   'utils*.ts',122 | 123 |   'prisma/schema.prisma',124 |   'prisma/seed.ts',125 | ];126 | 127 | const EXCLUDE_PATTERNS = [128 |   'node_modules',129 |   '.next',130 |   'build',131 |   'dist',132 |   '.git',133 |   '*.log',134 |   '*.backup',135 |   '*.bak',136 |   '*.tmp',137 |   '*.cache',138 |   'logs',139 |   'models',140 |   'results',141 |   '__pycache__',142 |   '*.pyc',143 |   '*.pyo',144 |   '*.pyd',145 |   '.env*',146 |   '*.env*',147 |   'vercel.json',148 |   'railway.json',149 |   'render*.yaml',150 |   'render*.yml',151 |   'Dockerfile*',152 |   'docker-compose*.yml',153 |   '*.md',154 |   '*.txt',155 |   '*.sql',156 |   '*.sh',157 |   '*.js',158 |   '*.mjs',159 |   '*.cjs',160 |   '*.json',161 |   '*.png',162 |   '*.jpg',163 |   '*.jpeg',164 |   '*.gif',165 |   '*.svg',166 |   '*.ico',167 |   '*.mp3',168 |   '*.wav',169 |   '*.mp4',170 |   '*.mov',171 |   '*.avi',172 |   '*.zip',173 |   '*.tar',174 |   '*.gz',175 |   '*.rar',176 |   '*.7z',177 |   '*.pdf',178 |   '*.doc',179 |   '*.docx',180 |   '*.xls',181 |   '*.xlsx',182 |   '*.ppt',183 |   '*.pptx',184 | ];185 | 186 | function shouldIncludeFile(filePath, relativePath) {187 | 188 |   for (const pattern of EXCLUDE_PATTERNS) {189 |     if (pattern.includes('*')) {190 |       const regex = new RegExp(pattern.replace(/\*/g, '.*'));191 |       if (regex.test(relativePath) || regex.test(path.basename(filePath))) {192 |         return false;193 |       }194 |     } else if (relativePath.includes(pattern) || path.basename(filePath) === pattern) {195 |       return false;196 |     }197 |   }198 | 199 |   for (const pattern of INCLUDE_PATTERNS) {200 |     if (pattern.includes('**')) {201 | 202 |       const regexPattern = pattern.replace(/\*\*/g, '.*').replace(/\*/g, '[^/]*');203 |       const regex = new RegExp('^' + regexPattern + '$');204 |       if (regex.test(relativePath)) {205 |         return true;206 |       }207 |     } else if (pattern.includes('*')) {208 |       const regex = new RegExp(pattern.replace(/\*/g, '.*'));209 |       if (regex.test(relativePath) || regex.test(path.basename(filePath))) {210 |         return true;211 |       }212 |     } else if (relativePath === pattern || path.basename(filePath) === pattern) {213 |       return true;214 |     }215 |   }216 | 217 |   return false;218 | }219 | 220 | function getAllFiles(dir, relativePath = '') {221 |   const files = [];222 | 223 |   try {224 |     const items = fs.readdirSync(dir);225 | 226 |     for (const item of items) {227 |       const fullPath = path.join(dir, item);228 |       const itemRelativePath = path.join(relativePath, item);229 |       const stat = fs.statSync(fullPath);230 | 231 |       if (stat.isDirectory()) {232 | 233 |         if (!EXCLUDE_PATTERNS.some(pattern =>234 |           pattern.includes('*') ?235 |             new RegExp(pattern.replace(/\*/g, '.*')).test(itemRelativePath) :236 |             itemRelativePath.includes(pattern) || item === pattern237 |         )) {238 |           files.push(...getAllFiles(fullPath, itemRelativePath));239 |         }240 |       } else if (stat.isFile()) {241 |         if (shouldIncludeFile(fullPath, itemRelativePath)) {242 |           files.push({243 |             fullPath,244 |             relativePath: itemRelativePath,245 |             size: stat.size246 |           });247 |         }248 |       }249 |     }250 |   } catch (error) {251 |     }252 | 253 |   return files;254 | }255 | 256 | function readFileContent(filePath) {257 |   try {258 |     return fs.readFileSync(filePath, 'utf8');259 |   } catch (error) {260 |     return `261 |   }262 | }263 | 264 | function formatFileContent(file, content) {265 |   const lines = content.split('\n');266 |   const maxLines = 1000;267 | 268 |   let formattedContent = content;269 |   if (lines.length > maxLines) {270 |     formattedContent = lines.slice(0, maxLines).join('\n') +271 |       `\n\n272 |   }273 | 274 |   return `\n${'='.repeat(80)}275 | FILE: ${file.relativePath}276 | SIZE: ${file.size} bytes277 | LINES: ${lines.length}278 | ${'='.repeat(80)}279 | 280 | ${formattedContent}281 | 282 | ${'='.repeat(80)}283 | END OF FILE: ${file.relativePath}284 | ${'='.repeat(80)}285 | 286 | `;287 | }288 | 289 | function exportFrontendCode() {290 | 291 |   const files = getAllFiles(FRONTEND_ROOT);292 | 293 |   const izipayFiles = [294 |     'components/izipay/IzipayForm.tsx',295 |     'app/api/izipay/webhook/route.ts'296 |   ];297 | 298 |   for (const izipayFile of izipayFiles) {299 |     const fullPath = path.join(FRONTEND_ROOT, izipayFile);300 |     if (fs.existsSync(fullPath)) {301 |       const stat = fs.statSync(fullPath);302 |       const existingFile = files.find(f => f.relativePath === izipayFile);303 |       if (!existingFile) {304 |         files.push({305 |           fullPath,306 |           relativePath: izipayFile,307 |           size: stat.size308 |         });309 |         }310 |     }311 |   }312 | 313 |   files.sort((a, b) => a.relativePath.localeCompare(b.relativePath));314 | 315 |   let exportContent = `FRONTEND CODE ANALYSIS EXPORT316 | Generated: ${new Date().toISOString()}317 | Frontend Root: ${FRONTEND_ROOT}318 | Total Files: ${files.length}319 | 320 | ${'='.repeat(80)}321 | TABLE OF CONTENTS322 | ${'='.repeat(80)}323 | 324 | `;325 | 326 |   files.forEach((file, index) => {327 |     exportContent += `${index + 1}. ${file.relativePath} (${file.size} bytes)\n`;328 |   });329 | 330 |   exportContent += `\n${'='.repeat(80)}331 | FILE CONTENTS332 | ${'='.repeat(80)}333 | 334 | `;335 | 336 |   let processedFiles = 0;337 |   for (const file of files) {338 |     const content = readFileContent(file.fullPath);339 |     exportContent += formatFileContent(file, content);340 |     processedFiles++;341 | 342 |     if (processedFiles % 10 === 0) {343 |       }344 |   }345 | 346 |   exportContent += `\n${'='.repeat(80)}347 | EXPORT SUMMARY348 | ${'='.repeat(80)}349 | 350 | Export completed: ${new Date().toISOString()}351 | Total files processed: ${processedFiles}352 | Total files found: ${files.length}353 | Output file: ${OUTPUT_FILE}354 | 355 | File breakdown by type:356 | ${files.reduce((acc, file) => {357 |   const ext = path.extname(file.relativePath);358 |   acc[ext] = (acc[ext] || 0) + 1;359 |   return acc;360 | }, {})}361 | 362 | Largest files:363 | ${files364 |   .sort((a, b) => b.size - a.size)365 |   .slice(0, 10)366 |   .map(f => `  ${f.relativePath}: ${f.size} bytes`)367 |   .join('\n')}368 | 369 | ${'='.repeat(80)}370 | END OF EXPORT371 | ${'='.repeat(80)}372 | `;373 | 374 |   try {375 |     fs.writeFileSync(OUTPUT_FILE, exportContent, 'utf8');376 |     .size / 1024 / 1024).toFixed(2)} MB`);377 |   } catch (error) {378 |     process.exit(1);379 |   }380 | }381 | 382 | if (import.meta.url === `file:383 |   exportFrontendCode();384 | }385 | 386 | export { exportFrontendCode };
============================================================END: frontend/export-frontend-code.js============================================================


============================================================FILE: frontend/hooks/useAuth.tsxSIZE: 4.09 KB============================================================
  1 | import { useState, useEffect } from 'react';  2 | import { safeApiCall } from '@/lib/api-utils';  3 |   4 | interface User {  5 |   id: string;  6 |   email: string;  7 |   fullName?: string;  8 |   role?: string;  9 |   access_token: string; 10 | } 11 |  12 | interface LoginApiResponse { 13 |   success: boolean; 14 |   user?: User; 15 |   message?: string; 16 |   error?: string; 17 | } 18 |  19 | interface VerifyApiResponse { 20 |   success: boolean; 21 |   user?: Omit<User, 'access_token'>; 22 |   message?: string; 23 |   error?: string; 24 | } 25 |  26 | export function useAuth() { 27 |   const [user, setUser] = useState<User | null>(null); 28 |   const [isLoading, setIsLoading] = useState(true); 29 |  30 |   const ADMIN_EMAILS = [ 31 |     'admin@soulpath.lat', 32 |     'coco@soulpath.lat', 33 |     'admin@matmax.world', 34 |     'alberto@matmax.world' 35 |   ]; 36 |  37 |   const isAdmin = Boolean(user?.email && (ADMIN_EMAILS.includes(user.email) || user.role === 'admin')); 38 |  39 |   useEffect(() => { 40 |  41 |     const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null; 42 |  43 |     if (token) { 44 |  45 |       safeApiCall<VerifyApiResponse>('/api/auth/verify', { 46 |         method: 'POST', 47 |         body: JSON.stringify({ token }) 48 |       }) 49 |       .then(response => { 50 |         if (response.success && response.data && response.data.user && typeof response.data.user === 'object') { 51 |           const userData = { 52 |             ...response.data.user, 53 |             access_token: token 54 |           } as User; 55 |           setUser(userData); 56 |           setIsLoading(false); 57 |         } else { 58 |           if (typeof window !== 'undefined') { 59 |             localStorage.removeItem('auth_token'); 60 |           } 61 |           setUser(null); 62 |           setIsLoading(false); 63 |         } 64 |       }) 65 |       .catch(error => { 66 |         if (typeof window !== 'undefined') { 67 |           localStorage.removeItem('auth_token'); 68 |         } 69 |         setUser(null); 70 |         setIsLoading(false); 71 |       }); 72 |     } else { 73 |       setUser(null); 74 |       setIsLoading(false); 75 |     } 76 |   }, []); 77 |  78 |   const signIn = async (email: string, password: string) => { 79 |     try { 80 |       const response = await safeApiCall<LoginApiResponse>('/api/auth/login', { 81 |         method: 'POST', 82 |         body: JSON.stringify({ email, password }) 83 |       }); 84 |  85 |       if (response.success && response.data && response.data.user && typeof response.data.user === 'object') { 86 |  87 |         if (typeof window !== 'undefined') { 88 |           localStorage.setItem('auth_token', response.data.user.access_token); 89 |         } 90 |  91 |         setUser(response.data.user); 92 |         setIsLoading(false); 93 |  94 |         return { data: response.data.user, error: null }; 95 |       } else { 96 |         setIsLoading(false); 97 |         return { data: null, error: { message: response.message || 'Login failed' } }; 98 |       } 99 |     } catch (error) {100 |       setIsLoading(false);101 |       return { data: null, error };102 |     }103 |   };104 | 105 |   const signOut = async () => {106 | 107 |     if (typeof window !== 'undefined') {108 |       localStorage.removeItem('auth_token');109 |     }110 |     setUser(null);111 | 112 |     return { error: null };113 |   };114 | 115 |   return {116 |     user,117 |     isLoading,118 |     signIn,119 |     signOut,120 |     isAdmin121 |   };122 | }
============================================================END: frontend/hooks/useAuth.tsx============================================================


============================================================FILE: frontend/hooks/useContentManagement.tsxSIZE: 4.06 KB============================================================
  1 | import { useState, useEffect, useCallback } from 'react';  2 | import { SectionConfig, getEnabledSections, addNewSection, updateSection, toggleSection } from '@/lib/content-config';  3 |   4 | export interface ContentManager {  5 |   sections: SectionConfig[];  6 |   currentSection: number;  7 |   totalSections: number;  8 |   addSection: (section: SectionConfig) => void;  9 |   updateSectionConfig: (sectionId: string, updates: Partial<SectionConfig>) => void; 10 |   toggleSectionVisibility: (sectionId: string) => void; 11 |   reorderSections: (sectionId: string, newOrder: number) => void; 12 |   getSectionById: (sectionId: string) => SectionConfig | undefined; 13 |   getNextSection: () => SectionConfig | undefined; 14 |   getPreviousSection: () => SectionConfig | undefined; 15 | } 16 |  17 | export const useContentManagement = (): ContentManager => { 18 |   const [sections, setSections] = useState<SectionConfig[]>([]); 19 |   const [currentSection] = useState(0); 20 |  21 |   useEffect(() => { 22 |     const loadSectionsFromDB = async () => { 23 |       try { 24 |         const response = await fetch('/api/sections'); 25 |  26 |         if (response.ok) { 27 |           const data = await response.json(); 28 |           if (data.sections && Array.isArray(data.sections)) { 29 |             setSections(data.sections); 30 |             } else { 31 |             const enabledSections = getEnabledSections(); 32 |             setSections(enabledSections); 33 |           } 34 |         } else { 35 |           const enabledSections = getEnabledSections(); 36 |           setSections(enabledSections); 37 |         } 38 |       } catch (error) { 39 |         const enabledSections = getEnabledSections(); 40 |         setSections(enabledSections); 41 |       } 42 |     }; 43 |  44 |     loadSectionsFromDB(); 45 |   }, []); 46 |  47 |   const addSection = useCallback((section: SectionConfig) => { 48 |     addNewSection(section); 49 |     const updatedSections = getEnabledSections(); 50 |     setSections(updatedSections); 51 |   }, []); 52 |  53 |   const updateSectionConfig = useCallback((sectionId: string, updates: Partial<SectionConfig>) => { 54 |     updateSection(sectionId, updates); 55 |     const updatedSections = getEnabledSections(); 56 |     setSections(updatedSections); 57 |   }, []); 58 |  59 |   const toggleSectionVisibility = useCallback((sectionId: string) => { 60 |     toggleSection(sectionId); 61 |     const updatedSections = getEnabledSections(); 62 |     setSections(updatedSections); 63 |   }, []); 64 |  65 |   const reorderSections = useCallback((sectionId: string, newOrder: number) => { 66 |     const updatedSections = sections.map(section => { 67 |       if (section.id === sectionId) { 68 |         return { ...section, order: newOrder }; 69 |       } 70 |       return section; 71 |     }); 72 |  73 |     updatedSections.sort((a, b) => a.order - b.order); 74 |  75 |     updatedSections.forEach((section, index) => { 76 |       updateSection(section.id, { order: index }); 77 |     }); 78 |  79 |     const finalSections = getEnabledSections(); 80 |     setSections(finalSections); 81 |   }, [sections]); 82 |  83 |   const getSectionById = useCallback((sectionId: string) => { 84 |     return sections.find(section => section.id === sectionId); 85 |   }, [sections]); 86 |  87 |   const getNextSection = useCallback(() => { 88 |     if (currentSection < sections.length - 1) { 89 |       return sections[currentSection + 1]; 90 |     } 91 |     return undefined; 92 |   }, [currentSection, sections]); 93 |  94 |   const getPreviousSection = useCallback(() => { 95 |     if (currentSection > 0) { 96 |       return sections[currentSection - 1]; 97 |     } 98 |     return undefined; 99 |   }, [currentSection, sections]);100 | 101 |   return {102 |     sections,103 |     currentSection,104 |     totalSections: sections.length,105 |     addSection,106 |     updateSectionConfig,107 |     toggleSectionVisibility,108 |     reorderSections,109 |     getSectionById,110 |     getNextSection,111 |     getPreviousSection,112 |   };113 | };
============================================================END: frontend/hooks/useContentManagement.tsx============================================================


============================================================FILE: frontend/hooks/useLogo.tsSIZE: 2.60 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect } from 'react';  4 |   5 | interface LogoSettings {  6 |   id: number;  7 |   type: 'text' | 'image';  8 |   text: string;  9 |   imageUrl: string | null; 10 |   isActive: boolean; 11 |   createdAt: string; 12 |   updatedAt: string; 13 | } 14 |  15 | export function useLogo() { 16 |   const [logoSettings, setLogoSettings] = useState<LogoSettings>({ 17 |     id: 1, 18 |     type: 'image', 19 |     text: 'MatMax Yoga Studio', 20 |     imageUrl: '/logo_matmax.png', 21 |     isActive: true, 22 |     createdAt: new Date().toISOString(), 23 |     updatedAt: new Date().toISOString() 24 |   }); 25 |   const [isLoading, setIsLoading] = useState(true); 26 |  27 |   useEffect(() => { 28 |     const loadLogo = async () => { 29 |       try { 30 |         const response = await fetch('/api/logo'); 31 |  32 |         if (response.ok) { 33 |           const data = await response.json(); 34 |           if (data.logoSettings) { 35 |             setLogoSettings(data.logoSettings); 36 |           } 37 |         } else { 38 |           } 39 |       } catch (error) { 40 |  41 |       } finally { 42 |         setIsLoading(false); 43 |       } 44 |     }; 45 |  46 |     loadLogo(); 47 |   }, []); 48 |  49 |   const updateLogoSettings = async (newSettings: Partial<LogoSettings>) => { 50 |     try { 51 |       const response = await fetch('/api/logo', { 52 |         method: 'POST', 53 |         headers: { 54 |           'Content-Type': 'application/json', 55 |         }, 56 |         body: JSON.stringify({ 57 |           ...logoSettings, 58 |           ...newSettings, 59 |           updatedAt: new Date().toISOString() 60 |         }), 61 |       }); 62 |  63 |       if (response.ok) { 64 |         const data = await response.json(); 65 |         setLogoSettings(data.logoSettings); 66 |         return { success: true, data: data.logoSettings }; 67 |       } else { 68 |         throw new Error('Failed to update logo settings'); 69 |       } 70 |     } catch (error) { 71 |       return { success: false, error }; 72 |     } 73 |   }; 74 |  75 |   const reloadLogoSettings = async () => { 76 |     setIsLoading(true); 77 |     try { 78 |       const response = await fetch('/api/logo'); 79 |       if (response.ok) { 80 |         const data = await response.json(); 81 |         if (data.logoSettings) { 82 |           setLogoSettings(data.logoSettings); 83 |         } 84 |       } 85 |     } catch (error) { 86 |       } finally { 87 |       setIsLoading(false); 88 |     } 89 |   }; 90 |  91 |   return { logoSettings, isLoading, updateLogoSettings, reloadLogoSettings }; 92 | }
============================================================END: frontend/hooks/useLogo.ts============================================================


============================================================FILE: frontend/hooks/usePackages.tsxSIZE: 4.25 KB============================================================
  1 | import { useState, useEffect, useCallback } from 'react';  2 | import { useAuth } from './useAuth';  3 | import { toast } from 'sonner';  4 |   5 | export interface PackagePrice {  6 |   id: number;  7 |   price: number;  8 |   packageDefinition: {  9 |     id: number; 10 |     name: string; 11 |     description: string; 12 |     sessionsCount: number; 13 |     packageType: string; 14 |     maxGroupSize?: number; 15 |     isActive: boolean; 16 |     isPopular?: boolean; 17 |     featured?: boolean; 18 |     displayOrder?: number; 19 |     sessionDuration: { 20 |       id: number; 21 |       name: string; 22 |       duration_minutes: number; 23 |       description?: string; 24 |     }; 25 |   }; 26 |   currency: { 27 |     id: number; 28 |     code: string; 29 |     symbol: string; 30 |     name: string; 31 |   }; 32 |   pricingMode: string; 33 |   isActive: boolean; 34 | } 35 |  36 | export interface UsePackagesReturn { 37 |   packages: PackagePrice[]; 38 |   loading: boolean; 39 |   error: string | null; 40 |   refetch: () => Promise<void>; 41 |   lastLoaded: Date | null; 42 | } 43 |  44 | export function usePackages(currency: string = 'PEN'): UsePackagesReturn { 45 |   const { user } = useAuth(); 46 |   const [packages, setPackages] = useState<PackagePrice[]>([]); 47 |   const [loading, setLoading] = useState(false); 48 |   const [error, setError] = useState<string | null>(null); 49 |   const [lastLoaded, setLastLoaded] = useState<Date | null>(null); 50 |  51 |   const fetchPackages = useCallback(async () => { 52 |     if (!user?.access_token) { 53 |       return; 54 |     } 55 |  56 |     try { 57 |       setLoading(true); 58 |       setError(null); 59 |  60 |       const response = await fetch(`/api/packages?currency=${currency}&active=true`, { 61 |         method: 'GET', 62 |         headers: { 63 |           'Authorization': `Bearer ${user.access_token}`, 64 |           'Content-Type': 'application/json', 65 |         }, 66 |       }); 67 |  68 |       if (!response.ok) { 69 |         throw new Error(`Failed to fetch packages: ${response.status} ${response.statusText}`); 70 |       } 71 |  72 |       const data = await response.json(); 73 |       setPackages(data); 74 |       setLastLoaded(new Date()); 75 |  76 |     } catch (err) { 77 |       const errorMessage = err instanceof Error ? err.message : 'Failed to fetch packages'; 78 |       setError(errorMessage); 79 |       toast.error(`Error loading packages: ${errorMessage}`); 80 |     } finally { 81 |       setLoading(false); 82 |     } 83 |   }, [user?.access_token, currency]); 84 |  85 |   const refetch = useCallback(async () => { 86 |     await fetchPackages(); 87 |   }, [fetchPackages]); 88 |  89 |   useEffect(() => { 90 |     if (user?.access_token) { 91 |       fetchPackages(); 92 |     } else { 93 |  94 |       setPackages([]); 95 |       setError(null); 96 |       setLastLoaded(null); 97 |     } 98 |   }, [user?.access_token, fetchPackages]); 99 | 100 |   return {101 |     packages,102 |     loading,103 |     error,104 |     refetch,105 |     lastLoaded,106 |   };107 | }108 | 109 | export function usePackagesWithCurrency() {110 |   const [selectedCurrency, setSelectedCurrency] = useState('PEN');111 |   const packagesData = usePackages(selectedCurrency);112 | 113 |   const changeCurrency = useCallback((currency: string) => {114 |     setSelectedCurrency(currency);115 |   }, []);116 | 117 |   return {118 |     ...packagesData,119 |     selectedCurrency,120 |     changeCurrency,121 |   };122 | }123 | 124 | export function usePackage(packageId: number, currency: string = 'PEN') {125 |   const { packages, loading, error, refetch } = usePackages(currency);126 | 127 |   const packageData = packages.find(pkg => pkg.id === packageId);128 | 129 |   return {130 |     package: packageData,131 |     loading,132 |     error,133 |     refetch,134 |   };135 | }136 | 137 | export function usePopularPackages(currency: string = 'PEN') {138 |   const { packages, loading, error, refetch } = usePackages(currency);139 | 140 |   const popularPackages = packages.filter(pkg => pkg.packageDefinition.isPopular);141 | 142 |   return {143 |     packages: popularPackages,144 |     loading,145 |     error,146 |     refetch,147 |   };148 | }149 | 150 | export function useFeaturedPackages(currency: string = 'PEN') {151 |   const { packages, loading, error, refetch } = usePackages(currency);152 | 153 |   const featuredPackages = packages.filter(pkg => pkg.packageDefinition.featured);154 | 155 |   return {156 |     packages: featuredPackages,157 |     loading,158 |     error,159 |     refetch,160 |   };161 | }
============================================================END: frontend/hooks/usePackages.tsx============================================================


============================================================FILE: frontend/hooks/useProfileImage.tsxSIZE: 2.08 KB============================================================
  1 | 'use client';  2 |   3 | import { useState, useEffect } from 'react';  4 |   5 | export function useProfileImage(initialImage?: string) {  6 |   const [profileImage, setProfileImage] = useState(initialImage || '/assets/cf4f95a6cc4d03023c0e98479a93fe16d4ef06f2.png');  7 |   const [isLoading, setIsLoading] = useState(false);  8 |   9 |   const fetchProfileImage = async () => { 10 |     try { 11 |       setIsLoading(true); 12 |       const response = await fetch('/api/images'); 13 |  14 |       if (response.ok) { 15 |         const result = await response.json(); 16 |         if (result.images?.profileImage) { 17 |           setProfileImage(result.images.profileImage); 18 |         } 19 |       } else { 20 |         } 21 |     } catch (error) { 22 |       } finally { 23 |       setIsLoading(false); 24 |     } 25 |   }; 26 |  27 |   useEffect(() => { 28 |     if (initialImage) { 29 |       setProfileImage(initialImage); 30 |     } else { 31 |  32 |       fetchProfileImage(); 33 |     } 34 |   }, [initialImage]); 35 |  36 |   const updateProfileImage = async (newImage: string) => { 37 |     try { 38 |       setIsLoading(true); 39 |  40 |       const response = await fetch('/api/images', { 41 |         method: 'POST', 42 |         headers: { 43 |           'Content-Type': 'application/json', 44 |         }, 45 |         body: JSON.stringify({ 46 |           profileImage: newImage 47 |         }), 48 |       }); 49 |  50 |       if (response.ok) { 51 |         const result = await response.json(); 52 |         setProfileImage(result.images?.profileImage || newImage); 53 |         return { success: true, data: result.images }; 54 |       } else { 55 |         throw new Error('Failed to update profile image'); 56 |       } 57 |     } catch (error) { 58 |       return { success: false, error }; 59 |     } finally { 60 |       setIsLoading(false); 61 |     } 62 |   }; 63 |  64 |   const reloadProfileImage = () => { 65 |     fetchProfileImage(); 66 |   }; 67 |  68 |   return { profileImage, updateProfileImage, isLoading, reloadProfileImage }; 69 | }
============================================================END: frontend/hooks/useProfileImage.tsx============================================================


============================================================FILE: frontend/hooks/useRevalidation.tsSIZE: 1.27 KB============================================================
  1 | import { useCallback } from 'react';  2 |   3 | interface RevalidationOptions {  4 |   path?: string;  5 |   secret?: string;  6 | }  7 |   8 | export const useRevalidation = () => {  9 |   const revalidatePath = useCallback(async (options: RevalidationOptions = {}) => { 10 |     try { 11 |       const { path = '/', secret = process.env.NEXT_PUBLIC_REVALIDATION_SECRET } = options; 12 |  13 |       const response = await fetch('/api/revalidate', { 14 |         method: 'POST', 15 |         headers: { 16 |           'Content-Type': 'application/json', 17 |         }, 18 |         body: JSON.stringify({ path, secret }), 19 |       }); 20 |  21 |       if (!response.ok) { 22 |         throw new Error(`Revalidation failed: ${response.statusText}`); 23 |       } 24 |  25 |       const result = await response.json(); 26 |       return result; 27 |     } catch (error) { 28 |       throw error; 29 |     } 30 |   }, []); 31 |  32 |   const revalidateHome = useCallback(() => revalidatePath({ path: '/' }), [revalidatePath]); 33 |   const revalidateAdmin = useCallback(() => revalidatePath({ path: '/admin' }), [revalidatePath]); 34 |   const revalidateContent = useCallback(() => revalidatePath({ path: '/api/content' }), [revalidatePath]); 35 |  36 |   return { 37 |     revalidatePath, 38 |     revalidateHome, 39 |     revalidateAdmin, 40 |     revalidateContent, 41 |   }; 42 | };
============================================================END: frontend/hooks/useRevalidation.ts============================================================


============================================================FILE: frontend/hooks/useTranslations.tsxSIZE: 5.91 KB============================================================
  1 | 'use client';  2 |   3 | import React, { useState, useEffect } from 'react';  4 | import { defaultTranslations } from '@/lib/data/translations';  5 |   6 | export function useLanguage() {  7 |   const [language, setLanguage] = useState<'en' | 'es'>('en');  8 |   9 |   useEffect(() => { 10 |  11 |     const savedLanguage = localStorage.getItem('language'); 12 |     if (savedLanguage && (savedLanguage === 'en' || savedLanguage === 'es')) { 13 |       setLanguage(savedLanguage as 'en' | 'es'); 14 |     } 15 |   }, []); 16 |  17 |   const changeLanguage = React.useCallback((newLanguage: 'en' | 'es') => { 18 |     setLanguage(newLanguage); 19 |     localStorage.setItem('language', newLanguage); 20 |     }, [language]); 21 |  22 |   return { language, setLanguage: changeLanguage }; 23 | } 24 |  25 | export function useTranslations(initialContent?: Record<string, unknown>, language?: 'en' | 'es') { 26 |   const [content, setContent] = useState(initialContent || defaultTranslations); 27 |   const [isLoading, setIsLoading] = useState(false); 28 |  29 |   const currentLanguage = language || 'en'; 30 |  31 |   const fetchTranslations = async () => { 32 |     try { 33 |  34 |       const response = await fetch(`/api/content?t=${Date.now()}`); 35 |  36 |       if (response.ok) { 37 |         const result = await response.json(); 38 |         if (result.content && Object.keys(result.content).length > 0) { 39 |           ); 40 |  41 |           const mergedContent = { 42 |             en: { ...defaultTranslations.en }, 43 |             es: { ...defaultTranslations.es } 44 |           }; 45 |  46 |           if (result.content.en) { 47 |             Object.keys(result.content.en).forEach(key => { 48 |               if (result.content.en[key] && typeof result.content.en[key] === 'object') { 49 |                 mergedContent.en[key as keyof typeof mergedContent.en] = { 50 |                   ...mergedContent.en[key as keyof typeof mergedContent.en], 51 |                   ...result.content.en[key] 52 |                 }; 53 |               } else { 54 |                 mergedContent.en[key as keyof typeof mergedContent.en] = result.content.en[key]; 55 |               } 56 |             }); 57 |           } 58 |  59 |           if (result.content.es) { 60 |             Object.keys(result.content.es).forEach(key => { 61 |               if (result.content.es[key] && typeof result.content.es[key] === 'object') { 62 |                 mergedContent.es[key as keyof typeof mergedContent.es] = { 63 |                   ...mergedContent.es[key as keyof typeof mergedContent.es], 64 |                   ...result.content.es[key] 65 |                 }; 66 |               } else { 67 |                 mergedContent.es[key as keyof typeof mergedContent.es] = result.content.es[key]; 68 |               } 69 |             }); 70 |           } 71 |  72 |           ); 73 |           ); 74 |  75 |           setContent(mergedContent); 76 |         } else { 77 |  78 |           '); 79 |  80 |         } 81 |       } else { 82 |  83 |       } 84 |     } catch (error) { 85 |  86 |     } 87 |   }; 88 |  89 |   useEffect(() => { 90 |  91 |     if (initialContent && Object.keys(initialContent).length > 0) { 92 |       setContent(initialContent); 93 |     } else { 94 |  95 |       setContent(defaultTranslations); 96 |  97 |       fetchTranslations(); 98 |     } 99 |   }, [initialContent, currentLanguage]);100 | 101 |   const updateContent = async (newContent: Record<string, unknown>) => {102 |     try {103 |       setIsLoading(true);104 | 105 |       const response = await fetch('/api/content', {106 |         method: 'PUT',107 |         headers: {108 |           'Content-Type': 'application/json',109 |         },110 |         body: JSON.stringify(newContent),111 |       });112 | 113 |       if (response.ok) {114 |         const result = await response.json();115 |         setContent(result.content);116 |         return { success: true, data: result.content };117 |       } else {118 |         throw new Error('Failed to update content');119 |       }120 |     } catch (error) {121 |       return { success: false, error };122 |     } finally {123 |       setIsLoading(false);124 |     }125 |   };126 | 127 |   const reloadTranslations = () => {128 |     fetchTranslations();129 |   };130 | 131 |   const t = (content?.[currentLanguage as keyof typeof content] || content?.en || defaultTranslations[currentLanguage as keyof typeof defaultTranslations] || defaultTranslations.en);132 | 133 |   return { t, updateContent, isLoading, content, reloadTranslations };134 | }
============================================================END: frontend/hooks/useTranslations.tsx============================================================


============================================================FILE: frontend/lib/api/index.tsSIZE: 12.54 KB============================================================
  1 | import { createClient } from '@/lib/supabase/client';  2 |   3 | export interface ApiResponse<T = unknown> {  4 |   success: boolean;  5 |   data?: T;  6 |   error?: string;  7 |   message?: string;  8 |   details?: unknown;  9 | } 10 |  11 | export interface ApiError { 12 |   message: string; 13 |   status: number; 14 |   details?: unknown; 15 | } 16 |  17 | export interface PaginationParams { 18 |   page?: number; 19 |   limit?: number; 20 |   offset?: number; 21 | } 22 |  23 | export interface SortParams { 24 |   field: string; 25 |   order: 'asc' | 'desc'; 26 | } 27 |  28 | export interface FilterParams { 29 |   [key: string]: string | number | boolean | undefined; 30 | } 31 |  32 | export interface ClientData { 33 |   id?: string; 34 |   name: string; 35 |   email: string; 36 |   phone?: string; 37 |   language?: string; 38 |   status?: string; 39 |   [key: string]: unknown; 40 | } 41 |  42 | export interface BookingData { 43 |   id?: string; 44 |   clientId: string; 45 |   packageId: string; 46 |   scheduleSlotId: string; 47 |   birthData?: { 48 |     date: string; 49 |     city: string; 50 |     time?: string; 51 |   }; 52 |   message?: string; 53 |   [key: string]: unknown; 54 | } 55 |  56 | export interface PackageData { 57 |   id?: string; 58 |   name: string; 59 |   description: string; 60 |   price: number; 61 |   currency: string; 62 |   duration: number; 63 |   sessionsCount: number; 64 |   [key: string]: unknown; 65 | } 66 |  67 | class ApiClient { 68 |   private supabase = createClient(); 69 |   private cache = new Map<string, { data: ApiResponse<unknown>; timestamp: number }>(); 70 |   private cacheTimeout = 5 * 60 * 1000; 71 |  72 |   protected async request<T>( 73 |     endpoint: string, 74 |     options: RequestInit = {} 75 |   ): Promise<ApiResponse<T>> { 76 |     try { 77 |  78 |       const { data: { session } } = await this.supabase.auth.getSession(); 79 |  80 |       if (!session?.access_token) { 81 |         throw new Error('No authentication token available'); 82 |       } 83 |  84 |       const response = await fetch(endpoint, { 85 |         ...options, 86 |         headers: { 87 |           'Content-Type': 'application/json', 88 |           'Authorization': `Bearer ${session.access_token}`, 89 |           ...options.headers, 90 |         }, 91 |       }); 92 |  93 |       if (!response.ok) { 94 |         const errorData = await response.json().catch(() => ({})); 95 |         throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`); 96 |       } 97 |  98 |       const data = await response.json(); 99 |       return data as ApiResponse<T>;100 |     } catch (error) {101 |       return {102 |         success: false,103 |         error: error instanceof Error ? error.message : 'Unknown error occurred',104 |         message: 'API request failed',105 |         data: undefined,106 |       } as ApiResponse<T>;107 |     }108 |   }109 | 110 |   protected async getCachedOrFetch<T>(111 |     key: string,112 |     fetcher: () => Promise<ApiResponse<T>>113 |   ): Promise<ApiResponse<T>> {114 |     const cached = this.cache.get(key);115 |     const now = Date.now();116 | 117 |     if (cached && (now - cached.timestamp) < this.cacheTimeout) {118 |       return cached.data as ApiResponse<T>;119 |     }120 | 121 |     const result = await fetcher();122 | 123 |     if (result.success) {124 |       this.cache.set(key, { data: result, timestamp: now });125 |     }126 | 127 |     return result;128 |   }129 | 130 |   clearCache(key?: string) {131 |     if (key) {132 |       this.cache.delete(key);133 |     } else {134 |       this.cache.clear();135 |     }136 |   }137 | }138 | 139 | class ClientsApi extends ApiClient {140 |   private baseUrl = '/api/admin/clients';141 | 142 |   async getAll(params?: {143 |     enhanced?: boolean;144 |     email?: string;145 |     status?: string;146 |     language?: string;147 |     hasActivePackages?: boolean;148 |   }): Promise<ApiResponse<ClientData[]>> {149 |     const searchParams = new URLSearchParams();150 | 151 |     if (params?.enhanced) searchParams.append('enhanced', 'true');152 |     if (params?.email) searchParams.append('email', params.email);153 |     if (params?.status) searchParams.append('status', params.status);154 |     if (params?.language) searchParams.append('language', params.language);155 |     if (params?.hasActivePackages !== undefined) {156 |       searchParams.append('has_active_packages', params.hasActivePackages.toString());157 |     }158 | 159 |     const url = `${this.baseUrl}?${searchParams.toString()}`;160 |     return this.getCachedOrFetch(`clients:all:${url}`, () =>161 |       this.request(url)162 |     );163 |   }164 | 165 |   async getById(id: string): Promise<ApiResponse<ClientData>> {166 |     return this.getCachedOrFetch(`clients:${id}`, () =>167 |       this.request(`${this.baseUrl}/${id}`)168 |     );169 |   }170 | 171 |   async create(clientData: Omit<ClientData, 'id'>): Promise<ApiResponse<ClientData>> {172 |     const result = await this.request(this.baseUrl, {173 |       method: 'POST',174 |       body: JSON.stringify(clientData),175 |     });176 | 177 |     if (result.success) {178 |       this.clearCache('clients:all');179 |     }180 | 181 |     return result as ApiResponse<ClientData>;182 |   }183 | 184 |   async update(id: string, clientData: Partial<ClientData>): Promise<ApiResponse<ClientData>> {185 |     const result = await this.request(`${this.baseUrl}/${id}`, {186 |       method: 'PUT',187 |       body: JSON.stringify(clientData),188 |     });189 | 190 |     if (result.success) {191 |       this.clearCache(`clients:${id}`);192 |       this.clearCache('clients:all');193 |     }194 | 195 |     return result as ApiResponse<ClientData>;196 |   }197 | 198 |   async delete(id: string): Promise<ApiResponse<unknown>> {199 |     const result = await this.request(`${this.baseUrl}?id=${id}`, {200 |       method: 'DELETE',201 |     });202 | 203 |     if (result.success) {204 |       this.clearCache(`clients:${id}`);205 |       this.clearCache('clients:all');206 |     }207 | 208 |     return result;209 |   }210 | }211 | 212 | class BookingsApi extends ApiClient {213 |   private baseUrl = '/api/admin/bookings';214 | 215 |   async getAll(params?: {216 |     clientId?: string;217 |     status?: string;218 |     dateFrom?: string;219 |     dateTo?: string;220 |   }): Promise<ApiResponse<BookingData[]>> {221 |     const searchParams = new URLSearchParams();222 | 223 |     if (params?.clientId) searchParams.append('clientId', params.clientId);224 |     if (params?.status) searchParams.append('status', params.status);225 |     if (params?.dateFrom) searchParams.append('dateFrom', params.dateFrom);226 |     if (params?.dateTo) searchParams.append('dateTo', params.dateTo);227 | 228 |     const url = `${this.baseUrl}?${searchParams.toString()}`;229 |     return this.getCachedOrFetch(`bookings:all:${url}`, () =>230 |       this.request(url)231 |     );232 |   }233 | 234 |   async create(bookingData: Omit<BookingData, 'id'>): Promise<ApiResponse<BookingData>> {235 |     const result = await this.request(this.baseUrl, {236 |       method: 'POST',237 |       body: JSON.stringify(bookingData),238 |     });239 | 240 |     if (result.success) {241 |       this.clearCache('bookings:all');242 |     }243 | 244 |     return result as ApiResponse<BookingData>;245 |   }246 | 247 |   async update(id: string, bookingData: Partial<BookingData>): Promise<ApiResponse<BookingData>> {248 |     const result = await this.request(`${this.baseUrl}/${id}`, {249 |       method: 'PUT',250 |       body: JSON.stringify(bookingData),251 |     });252 | 253 |     if (result.success) {254 |       this.clearCache(`bookings:${id}`);255 |       this.clearCache('bookings:all');256 |     }257 | 258 |     return result as ApiResponse<BookingData>;259 |   }260 | 261 |   async delete(id: string): Promise<ApiResponse<unknown>> {262 |     const result = await this.request(`${this.baseUrl}?id=${id}`, {263 |       method: 'DELETE',264 |     });265 | 266 |     if (result.success) {267 |       this.clearCache(`bookings:${id}`);268 |       this.clearCache('bookings:all');269 |     }270 | 271 |     return result;272 |   }273 | }274 | 275 | class PackagesApi extends ApiClient {276 |   private baseUrl = '/api/admin/packages';277 | 278 |   async getAll(): Promise<ApiResponse<PackageData[]>> {279 |     return this.getCachedOrFetch('packages:all', () =>280 |       this.request(this.baseUrl)281 |     );282 |   }283 | 284 |   async create(packageData: Omit<PackageData, 'id'>): Promise<ApiResponse<PackageData>> {285 |     const result = await this.request(this.baseUrl, {286 |       method: 'POST',287 |       body: JSON.stringify(packageData),288 |     });289 | 290 |     if (result.success) {291 |       this.clearCache('packages:all');292 |     }293 | 294 |     return result as ApiResponse<PackageData>;295 |   }296 | 297 |   async update(id: string, packageData: Partial<PackageData>): Promise<ApiResponse<PackageData>> {298 |     const result = await this.request(`${this.baseUrl}/${id}`, {299 |       method: 'PUT',300 |       body: JSON.stringify(packageData),301 |     });302 | 303 |     if (result.success) {304 |       this.clearCache(`packages:${id}`);305 |       this.clearCache('packages:all');306 |     }307 | 308 |     return result as ApiResponse<PackageData>;309 |   }310 | 311 |   async delete(id: string): Promise<ApiResponse<unknown>> {312 |     const result = await this.request(`${this.baseUrl}?id=${id}`, {313 |       method: 'DELETE',314 |     });315 | 316 |     if (result.success) {317 |       this.clearCache(`packages:${id}`);318 |       this.clearCache('packages:all');319 |     }320 | 321 |     return result;322 |   }323 | }324 | 325 | class DashboardApi extends ApiClient {326 |   private baseUrl = '/api/client/dashboard-stats';327 | 328 |   async getStats(): Promise<ApiResponse<Record<string, unknown>>> {329 |     return this.getCachedOrFetch('dashboard:stats', () =>330 |       this.request(this.baseUrl)331 |     );332 |   }333 | }334 | 335 | export const api = {336 |   clients: new ClientsApi(),337 |   bookings: new BookingsApi(),338 |   packages: new PackagesApi(),339 |   dashboard: new DashboardApi(),340 | };341 | 342 | export function createApiEndpoint<T>(baseUrl: string) {343 |   return {344 |     getAll: (params?: Record<string, string | number | boolean>) => {345 |       const searchParams = params ? new URLSearchParams(346 |         Object.entries(params).reduce((acc, [key, value]) => {347 |           acc[key] = String(value);348 |           return acc;349 |         }, {} as Record<string, string>)350 |       ) : new URLSearchParams();351 |       return fetch(`${baseUrl}?${searchParams}`).then(res => res.json());352 |     },353 | 354 |     getById: (id: string) =>355 |       fetch(`${baseUrl}/${id}`).then(res => res.json()),356 | 357 |     create: (data: T) =>358 |       fetch(baseUrl, {359 |         method: 'POST',360 |         headers: { 'Content-Type': 'application/json' },361 |         body: JSON.stringify(data),362 |       }).then(res => res.json()),363 | 364 |     update: (id: string, data: Partial<T>) =>365 |       fetch(`${baseUrl}/${id}`, {366 |         method: 'PUT',367 |         headers: { 'Content-Type': 'application/json' },368 |         body: JSON.stringify(data),369 |       }).then(res => res.json()),370 | 371 |     delete: (id: string) =>372 |       fetch(`${baseUrl}?id=${id}`, { method: 'DELETE' }).then(res => res.json()),373 |   };374 | }375 | 376 | export function handleApiError(error: unknown): ApiError {377 |   if (error instanceof Error) {378 |     return {379 |       message: error.message,380 |       status: 500,381 |       details: error.stack,382 |     };383 |   }384 | 385 |   if (typeof error === 'string') {386 |     return {387 |       message: error,388 |       status: 500,389 |     };390 |   }391 | 392 |   return {393 |     message: 'An unexpected error occurred',394 |     status: 500,395 |     details: error,396 |   };397 | }398 | 399 | export default api;
============================================================END: frontend/lib/api/index.ts============================================================


============================================================FILE: frontend/lib/api-utils.tsSIZE: 3.61 KB============================================================
  1 | export interface ApiResponse<T = unknown> {  2 |   success: boolean;  3 |   data?: T;  4 |   error?: string;  5 |   message?: string;  6 | }  7 |   8 | export class ApiError extends Error {  9 |   status: number; 10 |   statusText: string; 11 |   isJsonError: boolean; 12 |  13 |   constructor({ message, status, statusText, isJsonError }: { 14 |     message: string; 15 |     status: number; 16 |     statusText: string; 17 |     isJsonError: boolean; 18 |   }) { 19 |     super(message); 20 |     this.name = 'ApiError'; 21 |     this.status = status; 22 |     this.statusText = statusText; 23 |     this.isJsonError = isJsonError; 24 |   } 25 | } 26 |  27 | export async function safeJsonParse<T = unknown>(response: Response): Promise<T> { 28 |   const contentType = response.headers.get('content-type'); 29 |  30 |   if (!contentType || !contentType.includes('application/json')) { 31 |     const errorText = await response.text(); 32 |     + (errorText.length > 200 ? '...' : '') 33 |     }); 34 |  35 |     throw new ApiError({ 36 |       message: `API returned ${response.status} ${response.statusText} instead of JSON`, 37 |       status: response.status, 38 |       statusText: response.statusText, 39 |       isJsonError: true 40 |     }); 41 |   } 42 |  43 |   try { 44 |     return await response.json(); 45 |   } catch (parseError) { 46 |     throw new ApiError({ 47 |       message: `Failed to parse JSON response: ${parseError instanceof Error ? parseError.message : 'Unknown error'}`, 48 |       status: response.status, 49 |       statusText: response.statusText, 50 |       isJsonError: true 51 |     }); 52 |   } 53 | } 54 |  55 | export async function safeApiCall<T = unknown>( 56 |   url: string, 57 |   options: RequestInit = {} 58 | ): Promise<ApiResponse<T>> { 59 |   try { 60 |     const response = await fetch(url, { 61 |       headers: { 62 |         'Content-Type': 'application/json', 63 |         ...options.headers 64 |       }, 65 |       ...options 66 |     }); 67 |  68 |     const data = await safeJsonParse<T>(response); 69 |  70 |     if (!response.ok) { 71 |       return { 72 |         success: false, 73 |         error: data.error || `HTTP ${response.status}: ${response.statusText}`, 74 |         message: data.message || 'Request failed' 75 |       }; 76 |     } 77 |  78 |     return { 79 |       success: true, 80 |       data: data 81 |     }; 82 |   } catch (error) { 83 |     if (error instanceof ApiError) { 84 |       return { 85 |         success: false, 86 |         error: error.message, 87 |         message: `API call failed: ${error.status} ${error.statusText}` 88 |       }; 89 |     } 90 |  91 |     return { 92 |       success: false, 93 |       error: error instanceof Error ? error.message : 'Unknown error', 94 |       message: 'Network or parsing error occurred' 95 |     }; 96 |   } 97 | } 98 |  99 | export async function safeApiCallWithAuth<T = unknown>(100 |   url: string,101 |   token: string,102 |   options: RequestInit = {}103 | ): Promise<ApiResponse<T>> {104 |   return safeApiCall<T>(url, {105 |     ...options,106 |     headers: {107 |       'Authorization': `Bearer ${token}`,108 |       ...options.headers109 |     }110 |   });111 | }112 | 113 | export function isJsonError(error: unknown): error is ApiError {114 |   return error !== null && typeof error === 'object' && 'isJsonError' in error && (error as ApiError).isJsonError === true;115 | }
============================================================END: frontend/lib/api-utils.ts============================================================


============================================================FILE: frontend/lib/auth.tsSIZE: 2.92 KB============================================================
  1 | import jwt from 'jsonwebtoken';  2 | import { NextRequest, NextResponse } from 'next/server';  3 | import { PrismaClient } from '@prisma/client';  4 |   5 | const prisma = new PrismaClient();  6 | const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';  7 |   8 | export interface AuthenticatedUser {  9 |   id: string; 10 |   email: string; 11 |   role?: string; 12 | } 13 |  14 | export async function requireAuth(request: NextRequest): Promise<AuthenticatedUser | null> { 15 |   const authHeader = request.headers.get('Authorization'); 16 |  17 |   if (!authHeader || !authHeader.startsWith('Bearer ')) { 18 |     return null; 19 |   } 20 |  21 |   const token = authHeader.replace('Bearer ', ''); 22 |   try { 23 |  24 |     const decoded = jwt.verify(token, JWT_SECRET) as Record<string, unknown>; 25 |  26 |     if (!decoded || !decoded.userId) { 27 |       return null; 28 |     } 29 |  30 |     const user = await prisma.user.findUnique({ 31 |       where: { id: String(decoded.userId) } 32 |     }); 33 |  34 |     if (!user) { 35 |       return null; 36 |     } 37 |  38 |     const isAdminByEmail = user.email && [ 39 |       'admin@soulpath.lat', 40 |       'coco@soulpath.lat', 41 |       'admin@matmax.world', 42 |       'alberto@matmax.world' 43 |     ].includes(user.email); 44 |  45 |     const isAdminByRole = user.role === 'admin'; 46 |  47 |     if (!isAdminByEmail && !isAdminByRole) { 48 |       return null; 49 |     } 50 |  51 |     return { 52 |       id: user.id, 53 |       email: user.email, 54 |       role: user.role || 'admin' 55 |     }; 56 |   } catch (error) { 57 |     return null; 58 |   } 59 | } 60 |  61 | export async function requireAuthResponse(request: NextRequest): Promise<NextResponse | null> { 62 |   const user = await requireAuth(request); 63 |  64 |   if (!user) { 65 |     return NextResponse.json({ 66 |       code: 401, 67 |       message: 'Missing or invalid authorization', 68 |       error: 'Authorization required' 69 |     }, { status: 401 }); 70 |   } 71 |  72 |   return null; 73 | } 74 |  75 | export function createAuthMiddleware(handler: (request: NextRequest, user: AuthenticatedUser) => Promise<NextResponse>) { 76 |   return async (request: NextRequest) => { 77 |     const user = await requireAuth(request); 78 |  79 |     if (!user) { 80 |       return NextResponse.json({ 81 |         code: 401, 82 |         message: 'Missing or invalid authorization', 83 |         error: 'Authorization required' 84 |       }, { status: 401 }); 85 |     } 86 |  87 |     return handler(request, user); 88 |   }; 89 | }
============================================================END: frontend/lib/auth.ts============================================================


============================================================FILE: frontend/lib/brevo-email-service.tsSIZE: 4.25 KB============================================================
  1 | interface EmailData {  2 |   to: string;  3 |   subject: string;  4 |   html: string;  5 |   text?: string;  6 | }  7 |   8 | interface BrevoConfig {  9 |   apiKey: string; 10 |   senderEmail: string; 11 |   senderName: string; 12 | } 13 |  14 | export class BrevoEmailService { 15 |   private config: BrevoConfig; 16 |   private baseUrl = 'https: 17 |  18 |   constructor(config: BrevoConfig) { 19 |     this.config = config; 20 |   } 21 |  22 |   async sendEmail(emailData: EmailData): Promise<boolean> { 23 |     try { 24 |       const payload = { 25 |         sender: { 26 |           name: this.config.senderName, 27 |           email: this.config.senderEmail 28 |         }, 29 |         to: [ 30 |           { 31 |             email: emailData.to, 32 |             name: emailData.to.split('@')[0] 33 |           } 34 |         ], 35 |         subject: emailData.subject, 36 |         htmlContent: emailData.html, 37 |         textContent: emailData.text || this.stripHtml(emailData.html) 38 |       }; 39 |  40 |       const response = await fetch(`${this.baseUrl}/smtp/email`, { 41 |         method: 'POST', 42 |         headers: { 43 |           'Accept': 'application/json', 44 |           'Content-Type': 'application/json', 45 |           'api-key': this.config.apiKey 46 |         }, 47 |         body: JSON.stringify(payload) 48 |       }); 49 |  50 |       if (!response.ok) { 51 |         const errorData = await response.json(); 52 |         throw new Error(`Brevo API error: ${response.status} - ${errorData.message || 'Unknown error'}`); 53 |       } 54 |  55 |       const result = await response.json(); 56 |       return true; 57 |     } catch (error) { 58 |       return false; 59 |     } 60 |   } 61 |  62 |   async sendTemplateEmail( 63 |     to: string, 64 |     templateHtml: string, 65 |     templateSubject: string, 66 |     replacements: Record<string, string> 67 |   ): Promise<boolean> { 68 |  69 |     let html = templateHtml; 70 |     let subject = templateSubject; 71 |  72 |     Object.entries(replacements).forEach(([key, value]) => { 73 |       const placeholder = `{{${key}}}`; 74 |       html = html.replace(new RegExp(placeholder, 'g'), value); 75 |       subject = subject.replace(new RegExp(placeholder, 'g'), value); 76 |     }); 77 |  78 |     return this.sendEmail({ 79 |       to, 80 |       subject, 81 |       html 82 |     }); 83 |   } 84 |  85 |   private stripHtml(html: string): string { 86 |     return html.replace(/<[^>]*>/g, '') 87 |                .replace(/&nbsp;/g, ' ') 88 |                .replace(/&amp;/g, '&') 89 |                .replace(/&lt;/g, '<') 90 |                .replace(/&gt;/g, '>') 91 |                .replace(/&quot;/g, '"') 92 |                .trim(); 93 |   } 94 | } 95 |  96 | export async function createEmailService(): Promise<BrevoEmailService | null> { 97 |   try { 98 |  99 |     let config: BrevoConfig | null = null;100 | 101 |     try {102 | 103 |       const { createServerClient } = await import('@/lib/supabase/server');104 |       const supabase = await createServerClient();105 | 106 |       const { data: emailConfig, error } = await supabase107 |         .from('email_config')108 |         .select('brevo_api_key, sender_email, sender_name')109 |         .single();110 | 111 |       if (!error && emailConfig) {112 |         config = {113 |           apiKey: emailConfig.brevo_api_key || process.env.BREVO_API_KEY || '',114 |           senderEmail: emailConfig.sender_email || process.env.BREVO_SENDER_EMAIL || 'info@matmax.store',115 |           senderName: emailConfig.sender_name || process.env.BREVO_SENDER_NAME || 'MatMax Yoga Studio'116 |         };117 |       }118 |     } catch {119 |       }120 | 121 |     if (!config) {122 |       config = {123 |         apiKey: process.env.BREVO_API_KEY || '',124 |         senderEmail: process.env.BREVO_SENDER_EMAIL || 'info@matmax.store',125 |         senderName: process.env.BREVO_SENDER_NAME || 'MatMax Yoga Studio'126 |       };127 |     }128 | 129 |     if (!config.apiKey) {130 |       return null;131 |     }132 | 133 |     return new BrevoEmailService(config);134 |   } catch (error) {135 |     return null;136 |   }137 | }
============================================================END: frontend/lib/brevo-email-service.ts============================================================


============================================================FILE: frontend/lib/cache.tsSIZE: 2.62 KB============================================================
  1 | import { cacheMetrics, performanceMonitor } from './performance';  2 |   3 | interface CacheEntry<T> {  4 |   data: T;  5 |   timestamp: number;  6 |   ttl: number;  7 | }  8 |   9 | class Cache { 10 |   private cache = new Map<string, CacheEntry<unknown>>(); 11 |   private cleanupInterval: NodeJS.Timeout; 12 |  13 |   constructor() { 14 |  15 |     this.cleanupInterval = setInterval(() => { 16 |       this.cleanup(); 17 |     }, 5 * 60 * 1000); 18 |   } 19 |  20 |   get<T>(key: string): T | null { 21 |     const entry = this.cache.get(key); 22 |     if (!entry) { 23 |       cacheMetrics.recordMiss(); 24 |       return null; 25 |     } 26 |  27 |     if (Date.now() - entry.timestamp > entry.ttl) { 28 |       this.cache.delete(key); 29 |       cacheMetrics.recordMiss(); 30 |       return null; 31 |     } 32 |  33 |     cacheMetrics.recordHit(); 34 |     return entry.data as T; 35 |   } 36 |  37 |   set<T>(key: string, data: T, ttlMs: number = 5 * 60 * 1000): void { 38 |     this.cache.set(key, { 39 |       data, 40 |       timestamp: Date.now(), 41 |       ttl: ttlMs, 42 |     }); 43 |   } 44 |  45 |   delete(key: string): void { 46 |     this.cache.delete(key); 47 |   } 48 |  49 |   clear(): void { 50 |     this.cache.clear(); 51 |   } 52 |  53 |   private cleanup(): void { 54 |     const now = Date.now(); 55 |     for (const [key, entry] of this.cache.entries()) { 56 |       if (now - entry.timestamp > entry.ttl) { 57 |         this.cache.delete(key); 58 |       } 59 |     } 60 |   } 61 |  62 |   destroy(): void { 63 |     if (this.cleanupInterval) { 64 |       clearInterval(this.cleanupInterval); 65 |     } 66 |     this.clear(); 67 |   } 68 |  69 |   getStats(): { size: number; hitRate: number } { 70 |     return { 71 |       size: this.cache.size, 72 |       hitRate: cacheMetrics.getStats().hitRate 73 |     }; 74 |   } 75 | } 76 |  77 | export const apiCache = new Cache(); 78 |  79 | export async function withCache<T>( 80 |   key: string, 81 |   fetcher: () => Promise<T>, 82 |   ttlMs: number = 5 * 60 * 1000 83 | ): Promise<T> { 84 |   const endTimer = performanceMonitor.startTimer(`cache_${key}`); 85 |  86 |   try { 87 |  88 |     const cached = apiCache.get<T>(key); 89 |     if (cached) { 90 |       endTimer(); 91 |       return cached; 92 |     } 93 |  94 |     const fetchTimer = performanceMonitor.startTimer(`db_fetch_${key}`); 95 |     const data = await fetcher(); 96 |     fetchTimer(); 97 |  98 |     apiCache.set(key, data, ttlMs); 99 | 100 |     endTimer();101 |     return data;102 |   } catch (error) {103 |     endTimer();104 |     throw error;105 |   }106 | }107 | 108 | export function invalidateCache(pattern: string): void {109 | 110 |   for (const key of apiCache['cache'].keys()) {111 |     if (key.includes(pattern)) {112 |       apiCache.delete(key);113 |     }114 |   }115 | }116 | 117 | export function clearAllCache(): void {118 |   apiCache.clear();119 | }
============================================================END: frontend/lib/cache.ts============================================================


============================================================FILE: frontend/lib/config/chat-config.tsSIZE: 6.52 KB============================================================
  1 | export interface ChatConfig {  2 |   3 |   ui: {  4 |     position: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';  5 |     size: {  6 |       width: number;  7 |       height: number;  8 |       minimizedHeight: number;  9 |     }; 10 |     animations: { 11 |       enabled: boolean; 12 |       duration: number; 13 |       easing: string; 14 |     }; 15 |     theme: { 16 |       primary: string; 17 |       secondary: string; 18 |       background: string; 19 |       text: string; 20 |       accent: string; 21 |     }; 22 |   }; 23 |  24 |   behavior: { 25 |     autoOpen: boolean; 26 |     autoOpenDelay: number; 27 |     keepOpenOnNavigation: boolean; 28 |     clearOnClose: boolean; 29 |     maxMessages: number; 30 |     typingIndicator: boolean; 31 |     soundEnabled: boolean; 32 |   }; 33 |  34 |   api: { 35 |     endpoint: string; 36 |     timeout: number; 37 |     retryAttempts: number; 38 |     retryDelay: number; 39 |   }; 40 |  41 |   features: { 42 |     fileUpload: boolean; 43 |     emojiPicker: boolean; 44 |     messageHistory: boolean; 45 |     quickReplies: boolean; 46 |     userTyping: boolean; 47 |     messageReactions: boolean; 48 |   }; 49 |  50 |   content: { 51 |     welcomeMessage: { 52 |       es: string; 53 |       en: string; 54 |     }; 55 |     placeholder: { 56 |       es: string; 57 |       en: string; 58 |     }; 59 |     assistantName: { 60 |       es: string; 61 |       en: string; 62 |     }; 63 |     offlineMessage: { 64 |       es: string; 65 |       en: string; 66 |     }; 67 |   }; 68 |  69 |   businessHours: { 70 |     enabled: boolean; 71 |     timezone: string; 72 |     schedule: { 73 |       monday: { start: string; end: string; enabled: boolean }; 74 |       tuesday: { start: string; end: string; enabled: boolean }; 75 |       wednesday: { start: string; end: string; enabled: boolean }; 76 |       thursday: { start: string; end: string; enabled: boolean }; 77 |       friday: { start: string; end: string; enabled: boolean }; 78 |       saturday: { start: string; end: string; enabled: boolean }; 79 |       sunday: { start: string; end: string; enabled: boolean }; 80 |     }; 81 |     customMessage: { 82 |       es: string; 83 |       en: string; 84 |     }; 85 |   }; 86 |  87 |   analytics: { 88 |     enabled: boolean; 89 |     trackMessages: boolean; 90 |     trackUserBehavior: boolean; 91 |     trackErrors: boolean; 92 |     customEvents: string[]; 93 |   }; 94 |  95 |   accessibility: { 96 |     highContrast: boolean; 97 |     reducedMotion: boolean; 98 |     screenReaderSupport: boolean; 99 |     keyboardNavigation: boolean;100 |     fontSize: 'small' | 'medium' | 'large';101 |   };102 | }103 | 104 | export const defaultChatConfig: ChatConfig = {105 |   ui: {106 |     position: 'bottom-right',107 |     size: {108 |       width: 384,109 |       height: 500,110 |       minimizedHeight: 60111 |     },112 |     animations: {113 |       enabled: true,114 |       duration: 0.3,115 |       easing: 'cubic-bezier(0.4, 0.0, 0.2, 1)'116 |     },117 |     theme: {118 |       primary: '#FFD700',119 |       secondary: '#191970',120 |       background: '#0A0A23',121 |       text: '#EAEAEA',122 |       accent: '#FFD700'123 |     }124 |   },125 | 126 |   behavior: {127 |     autoOpen: false,128 |     autoOpenDelay: 3000,129 |     keepOpenOnNavigation: false,130 |     clearOnClose: false,131 |     maxMessages: 50,132 |     typingIndicator: true,133 |     soundEnabled: false134 |   },135 | 136 |   api: {137 |     endpoint: '/api/chat/web',138 |     timeout: 30000,139 |     retryAttempts: 3,140 |     retryDelay: 1000141 |   },142 | 143 |   features: {144 |     fileUpload: false,145 |     emojiPicker: false,146 |     messageHistory: true,147 |     quickReplies: true,148 |     userTyping: true,149 |     messageReactions: false150 |   },151 | 152 |   content: {153 |     welcomeMessage: {154 |       es: '¡Hola! Soy tu asistente de astrología. ¿En qué puedo ayudarte hoy?\n\n📅 Agendar citas\n📦 Consultar paquetes\n💳 Información de pagos\n📊 Estado de solicitudes\n❓ Preguntas generales',155 |       en: 'Hello! I\'m your astrology assistant. How can I help you today?\n\n📅 Schedule appointments\n📦 View packages\n💳 Payment information\n📊 Request status\n❓ General questions'156 |     },157 |     placeholder: {158 |       es: 'Escribe tu mensaje...',159 |       en: 'Type your message...'160 |     },161 |     assistantName: {162 |       es: 'Asistente Astrológico',163 |       en: 'Astrology Assistant'164 |     },165 |     offlineMessage: {166 |       es: 'El asistente no está disponible en este momento. Por favor intenta más tarde.',167 |       en: 'The assistant is not available at the moment. Please try again later.'168 |     }169 |   },170 | 171 |   businessHours: {172 |     enabled: true,173 |     timezone: 'America/Mexico_City',174 |     schedule: {175 |       monday: { start: '09:00', end: '18:00', enabled: true },176 |       tuesday: { start: '09:00', end: '18:00', enabled: true },177 |       wednesday: { start: '09:00', end: '18:00', enabled: true },178 |       thursday: { start: '09:00', end: '18:00', enabled: true },179 |       friday: { start: '09:00', end: '18:00', enabled: true },180 |       saturday: { start: '10:00', end: '16:00', enabled: true },181 |       sunday: { start: '10:00', end: '16:00', enabled: false }182 |     },183 |     customMessage: {184 |       es: 'Actualmente fuera del horario de atención. Nuestro horario es de lunes a sábado de 9:00 a 18:00.',185 |       en: 'Currently outside business hours. Our hours are Monday to Saturday from 9:00 AM to 6:00 PM.'186 |     }187 |   },188 | 189 |   analytics: {190 |     enabled: true,191 |     trackMessages: true,192 |     trackUserBehavior: true,193 |     trackErrors: true,194 |     customEvents: ['chat_opened', 'message_sent', 'message_received', 'chat_closed']195 |   },196 | 197 |   accessibility: {198 |     highContrast: false,199 |     reducedMotion: false,200 |     screenReaderSupport: true,201 |     keyboardNavigation: true,202 |     fontSize: 'medium'203 |   }204 | };205 | 206 | export const isBusinessHours = (config: ChatConfig): boolean => {207 |   if (!config.businessHours.enabled) return true;208 | 209 |   const now = new Date();210 |   const day = now.toLocaleDateString('en-US', { weekday: 'long' }) as keyof typeof config.businessHours.schedule;211 |   const schedule = config.businessHours.schedule[day];212 | 213 |   if (!schedule.enabled) return false;214 | 215 |   const currentTime = now.getHours() * 100 + now.getMinutes();216 |   const startTime = parseInt(schedule.start.replace(':', ''));217 |   const endTime = parseInt(schedule.end.replace(':', ''));218 | 219 |   return currentTime >= startTime && currentTime <= endTime;220 | };221 | 222 | export const getPositionClasses = (position: ChatConfig['ui']['position']): string => {223 |   switch (position) {224 |     case 'bottom-left':225 |       return 'bottom-24 left-6';226 |     case 'top-right':227 |       return 'top-24 right-6';228 |     case 'top-left':229 |       return 'top-24 left-6';230 |     case 'bottom-right':231 |     default:232 |       return 'bottom-24 right-6';233 |   }234 | };235 | 236 | export const getTogglePositionClasses = (position: ChatConfig['ui']['position']): string => {237 |   switch (position) {238 |     case 'bottom-left':239 |       return 'bottom-6 left-6';240 |     case 'top-right':241 |       return 'top-6 right-6';242 |     case 'top-left':243 |       return 'top-6 left-6';244 |     case 'bottom-right':245 |     default:246 |       return 'bottom-6 right-6';247 |   }248 | };
============================================================END: frontend/lib/config/chat-config.ts============================================================


============================================================FILE: frontend/lib/content-config.tsSIZE: 4.07 KB============================================================
  1 | export interface SectionConfig {  2 |   id: string;  3 |   type: 'hero' | 'content' | 'form' | 'gallery' | 'testimonial';  4 |   title: string;  5 |   description?: string;  6 |   icon: string;  7 |   component: string;  8 |   order: number;  9 |   enabled: boolean; 10 |   mobileConfig?: { 11 |     padding?: string; 12 |     layout?: 'stack' | 'grid' | 'center'; 13 |     imageSize?: 'small' | 'medium' | 'large'; 14 |   }; 15 |   desktopConfig?: { 16 |     padding?: string; 17 |     layout?: 'stack' | 'grid' | 'center'; 18 |     imageSize?: 'small' | 'medium' | 'large'; 19 |   }; 20 | } 21 |  22 | export interface ContentSection { 23 |   id: string; 24 |   title: string; 25 |   subtitle?: string; 26 |   content: string; 27 |   image?: string; 28 |   imageAlt?: string; 29 |   ctaText?: string; 30 |   ctaAction?: string; 31 |   order: number; 32 |   enabled: boolean; 33 | } 34 |  35 | export const DEFAULT_SECTIONS: SectionConfig[] = [ 36 |   { 37 |     id: 'invitation', 38 |     type: 'hero', 39 |     title: 'Invitation', 40 |     description: 'Main landing section with cosmic theme', 41 |     icon: 'Star', 42 |     component: 'HeroSection', 43 |     order: 0, 44 |     enabled: true, 45 |     mobileConfig: { 46 |       padding: 'pt-20 pb-12', 47 |       layout: 'center', 48 |       imageSize: 'large' 49 |     }, 50 |     desktopConfig: { 51 |       padding: 'pt-16 pb-20', 52 |       layout: 'center', 53 |       imageSize: 'large' 54 |     } 55 |   }, 56 |   { 57 |     id: 'approach', 58 |     type: 'content', 59 |     title: 'Our Approach', 60 |     description: 'How we work and our methodology', 61 |     icon: 'Compass', 62 |     component: 'ApproachSection', 63 |     order: 1, 64 |     enabled: true, 65 |     mobileConfig: { 66 |       padding: 'pt-20 pb-12', 67 |       layout: 'stack', 68 |       imageSize: 'medium' 69 |     }, 70 |     desktopConfig: { 71 |       padding: 'pt-16 pb-20', 72 |       layout: 'grid', 73 |       imageSize: 'medium' 74 |     } 75 |   }, 76 |   { 77 |     id: 'session', 78 |     type: 'content', 79 |     title: 'Sessions & Services', 80 |     description: 'Available services and session types', 81 |     icon: 'Clock', 82 |     component: 'SessionSection', 83 |     order: 2, 84 |     enabled: true, 85 |     mobileConfig: { 86 |       padding: 'pt-20 pb-12', 87 |       layout: 'stack', 88 |       imageSize: 'medium' 89 |     }, 90 |     desktopConfig: { 91 |       padding: 'pt-16 pb-20', 92 |       layout: 'grid', 93 |       imageSize: 'medium' 94 |     } 95 |   }, 96 |   { 97 |     id: 'about', 98 |     type: 'content', 99 |     title: 'About MatMax Yoga Studio',100 |     description: 'Information about MatMax Yoga Studio and our approach',101 |     icon: 'User',102 |     component: 'AboutSection',103 |     order: 3,104 |     enabled: true,105 |     mobileConfig: {106 |       padding: 'pt-20 pb-12',107 |       layout: 'stack',108 |       imageSize: 'large'109 |     },110 |     desktopConfig: {111 |       padding: 'pt-16 pb-20',112 |       layout: 'grid',113 |       imageSize: 'large'114 |     }115 |   },116 |   {117 |     id: 'apply',118 |     type: 'form',119 |     title: 'Book Your Session',120 |     description: 'Booking form and scheduling',121 |     icon: 'Calendar',122 |     component: 'BookingSection',123 |     order: 4,124 |     enabled: true,125 |     mobileConfig: {126 |       padding: 'pt-20 pb-12',127 |       layout: 'center',128 |       imageSize: 'small'129 |     },130 |     desktopConfig: {131 |       padding: 'pt-16 pb-20',132 |       layout: 'center',133 |       imageSize: 'small'134 |     }135 |   }136 | ];137 | 138 | export const getSectionConfig = (sectionId: string): SectionConfig | undefined => {139 |   return DEFAULT_SECTIONS.find(section => section.id === sectionId);140 | };141 | 142 | export const getEnabledSections = (): SectionConfig[] => {143 |   return DEFAULT_SECTIONS.filter(section => section.enabled).sort((a, b) => a.order - b.order);144 | };145 | 146 | export const addNewSection = (section: SectionConfig): void => {147 |   DEFAULT_SECTIONS.push(section);148 |   DEFAULT_SECTIONS.sort((a, b) => a.order - b.order);149 | };150 | 151 | export const updateSection = (sectionId: string, updates: Partial<SectionConfig>): void => {152 |   const index = DEFAULT_SECTIONS.findIndex(section => section.id === sectionId);153 |   if (index !== -1) {154 |     DEFAULT_SECTIONS[index] = { ...DEFAULT_SECTIONS[index], ...updates };155 |   }156 | };157 | 158 | export const toggleSection = (sectionId: string): void => {159 |   const section = DEFAULT_SECTIONS.find(section => section.id === sectionId);160 |   if (section) {161 |     section.enabled = !section.enabled;162 |   }163 | };164 | 165 | export const reorderSections = (sectionId: string, newOrder: number): void => {166 |   const index = DEFAULT_SECTIONS.findIndex(section => section.id === sectionId);167 |   if (index !== -1) {168 |     DEFAULT_SECTIONS[index] = { ...DEFAULT_SECTIONS[index], order: newOrder };169 |   }170 | };
============================================================END: frontend/lib/content-config.ts============================================================


============================================================FILE: frontend/lib/data/translations.tsSIZE: 16.84 KB============================================================
  1 | export const defaultTranslations = {  2 |   en: {  3 |     nav: {  4 |       invitation: 'Invitation',  5 |       approach: 'Approach',  6 |       session: 'Sessions',  7 |       about: 'About',  8 |       apply: 'Book Now'  9 |     }, 10 |     hero: { 11 |       title: 'MatMax Yoga Studio', 12 |       tagline: 'Transform your life through spiritual guidance and healing', 13 |       description: 'Experience profound transformation through personalized spiritual sessions, energy healing, and guidance on your journey to inner peace and self-discovery.', 14 |       ctaPrimary: 'Book Your Session', 15 |       ctaSecondary: 'Learn More' 16 |     }, 17 |     approach: { 18 |       title: 'Our Approach', 19 |       description: 'We believe in a holistic approach that addresses the mind, body, and spirit. Each session is uniquely tailored to your individual needs and spiritual journey.', 20 |       content: 'We believe in a holistic approach that addresses the mind, body, and spirit. Each session is uniquely tailored to your individual needs and spiritual journey.', 21 |       items: [ 22 |         { 23 |           title: 'Heart-Centered Healing', 24 |           text: 'Connect with your emotional core and release past traumas through compassionate guidance and energy work.' 25 |         }, 26 |         { 27 |           title: 'Mindful Transformation', 28 |           text: 'Develop mental clarity and break free from limiting beliefs that hold you back from your true potential.' 29 |         }, 30 |         { 31 |           title: 'Spiritual Awakening', 32 |           text: 'Discover your spiritual path and deepen your connection to the divine through meditation and spiritual practices.' 33 |         } 34 |       ], 35 |       heartTitle: 'Heart-Centered Healing', 36 |       heartDescription: 'Connect with your emotional core and release past traumas through compassionate guidance and energy work.', 37 |       mindTitle: 'Mindful Transformation', 38 |       mindDescription: 'Develop mental clarity and break free from limiting beliefs that hold you back from your true potential.', 39 |       spiritTitle: 'Spiritual Awakening', 40 |       spiritDescription: 'Discover your spiritual path and deepen your connection to the divine through meditation and spiritual practices.', 41 |       energyTitle: 'Energy Alignment', 42 |       energyDescription: 'Balance your chakras and energy centers to restore harmony and vitality to your entire being.', 43 |       ctaText: 'Ready to begin your transformation?' 44 |     }, 45 |     session: { 46 |       title: 'Yoga Classes', 47 |       price: '$130 USD', 48 |       description: 'A confidential, 90-minute deep-dive consultation and subsequent written analysis to provide you with profound strategic clarity.', 49 |       deliverables: [ 50 |         '90-Minute Live Consultation', 51 |         'Personalized Written Chart Analysis (PDF)', 52 |         'Full Session Audio Recording' 53 |       ], 54 |       cta: 'Begin Your Journey', 55 |       individualTitle: 'Individual Sessions', 56 |       individualDescription: 'Personalized one-on-one sessions tailored to your specific needs and spiritual journey.', 57 |       groupTitle: 'Group Sessions', 58 |       groupDescription: 'Transformative group experiences that foster community and collective healing.', 59 |       intensiveTitle: 'Intensive Programs', 60 |       intensiveDescription: 'Deep dive programs for profound transformation and spiritual breakthrough.', 61 |       benefitsTitle: 'What You\'ll Experience', 62 |       benefit1Title: 'Immediate Relief', 63 |       benefit1Description: 'Experience immediate emotional and energetic relief from the first session.', 64 |       benefit2Title: 'Long-term Transformation', 65 |       benefit2Description: 'Build lasting change through consistent practice and guidance.', 66 |       benefit3Title: 'Personal Growth', 67 |       benefit3Description: 'Develop deeper self-awareness and spiritual connection.' 68 |     }, 69 |     about: { 70 |       title: 'About MatMax Yoga Studio', 71 |       text: 'MatMax Yoga Studio is dedicated to helping people build strength, flexibility, and inner peace through mindful movement and breath. Our classes support wellbeing and balance for all levels.', 72 |       description: 'MatMax Yoga Studio is dedicated to helping people build strength, flexibility, and inner peace through mindful movement and breath. Our classes support wellbeing and balance for all levels.', 73 |       statsClients: 'Clients Helped', 74 |       statsYears: 'Years Experience', 75 |       statsSessions: 'Sessions Completed', 76 |       statsCountries: 'Countries Served', 77 |       valuesTitle: 'Our Core Values', 78 |       value1Title: 'Compassion', 79 |       value1Description: 'We approach every client with deep empathy and understanding, creating a safe space for healing and growth.', 80 |       value2Title: 'Authenticity', 81 |       value2Description: 'Our guidance comes from genuine spiritual wisdom and personal experience, not from textbooks or theories.', 82 |       value3Title: 'Transformation', 83 |       value3Description: 'We believe in the power of real change and are committed to helping you achieve lasting transformation.', 84 |       storyTitle: 'Jose\'s Story', 85 |       storyText: 'My journey began over 15 years ago when I experienced a profound spiritual awakening that changed my life forever. Since then, I\'ve dedicated myself to helping others find their own path to spiritual growth and personal transformation. Through years of study, practice, and working with clients from around the world, I\'ve developed a unique approach that combines traditional spiritual wisdom with modern understanding of human psychology and energy work.' 86 |     }, 87 |     booking: { 88 |       title: 'Book Your Session', 89 |       description: 'Ready to begin your transformation? Book a session and take the first step towards your spiritual awakening.', 90 |       dateLabel: 'Select Date', 91 |       datePlaceholder: 'Choose a date', 92 |       timeLabel: 'Select Time', 93 |       timePlaceholder: 'Choose a time', 94 |       nameLabel: 'Full Name', 95 |       namePlaceholder: 'Enter your full name', 96 |       emailLabel: 'Email *', 97 |       emailPlaceholder: 'Enter your email', 98 |       phoneLabel: 'Phone (Optional)', 99 |       phonePlaceholder: 'Enter your phone number',100 |       messageLabel: 'Message (Optional)',101 |       messagePlaceholder: 'Tell us about your intentions or any specific concerns...',102 |       submitButton: 'Book Session',103 |       submitting: 'Booking...',104 |       successMessage: 'Booking submitted successfully! We\'ll send you a confirmation email shortly.',105 |       errorMessage: 'There was an error submitting your booking. Please try again.',106 |       additionalInfo: 'All sessions are conducted online via video call. You will receive detailed instructions after booking.'107 |     },108 |     cta: {109 |       bookReading: 'Book Your Reading'110 |     },111 |     common: {112 |       login: 'Login'113 |     }114 |   },115 |   es: {116 |     nav: {117 |       invitation: 'Invitación',118 |       approach: 'Enfoque',119 |       session: 'Sesiones',120 |       about: 'Acerca de',121 |       apply: 'Reserva Ahora'122 |     },123 |     hero: {124 |       title: 'MatMax Yoga Studio',125 |       tagline: 'Transforma tu vida a través de la guía espiritual y la sanación',126 |       description: 'Experimenta una transformación profunda a través de sesiones espirituales personalizadas, sanación energética y guía en tu camino hacia la paz interior y el autodescubrimiento.',127 |       ctaPrimary: 'Reserva tu Sesión',128 |       ctaSecondary: 'Conoce Más'129 |     },130 |     approach: {131 |       title: 'Nuestro Enfoque',132 |       description: 'Creemos en un enfoque holístico que aborda la mente, el cuerpo y el espíritu. Cada sesión está únicamente adaptada a tus necesidades individuales y tu viaje espiritual.',133 |       content: 'Creemos en un enfoque holístico que aborda la mente, el cuerpo y el espíritu. Cada sesión está únicamente adaptada a tus necesidades individuales y tu viaje espiritual.',134 |       items: [135 |         {136 |           title: 'Sanación Centrada en el Corazón',137 |           text: 'Conecta con tu núcleo emocional y libera traumas pasados a través de guía compasiva y trabajo energético.'138 |         },139 |         {140 |           title: 'Transformación Consciente',141 |           text: 'Desarrolla claridad mental y libérate de creencias limitantes que te impiden alcanzar tu verdadero potencial.'142 |         },143 |         {144 |           title: 'Despertar Espiritual',145 |           text: 'Descubre tu camino espiritual y profundiza tu conexión con lo divino a través de la meditación y prácticas espirituales.'146 |         }147 |       ],148 |       heartTitle: 'Sanación Centrada en el Corazón',149 |       heartDescription: 'Conecta con tu núcleo emocional y libera traumas pasados a través de guía compasiva y trabajo energético.',150 |       mindTitle: 'Transformación Consciente',151 |       mindDescription: 'Desarrolla claridad mental y libérate de creencias limitantes que te impiden alcanzar tu verdadero potencial.',152 |       spiritTitle: 'Despertar Espiritual',153 |       spiritDescription: 'Descubre tu camino espiritual y profundiza tu conexión con lo divino a través de la meditación y prácticas espirituales.',154 |       energyTitle: 'Alineación Energética',155 |       energyDescription: 'Equilibra tus chakras y centros energéticos para restaurar la armonía y vitalidad a todo tu ser.',156 |       ctaText: '¿Listo para comenzar tu transformación?'157 |     },158 |     session: {159 |       title: 'La Sesión Brújula del Alma',160 |       price: 'S/. 500',161 |       description: 'Una consulta confidencial de 90 minutos y un posterior análisis escrito para brindarte una profunda claridad estratégica.',162 |       deliverables: [163 |         'Consulta en Vivo de 90 Minutos',164 |         'Análisis Escrito y Personalizado de tu Carta (PDF)',165 |         'Grabación Completa en Audio de la Sesión'166 |       ],167 |       cta: 'Comienza Tu Viaje',168 |       individualTitle: 'Sesiones Individuales',169 |       individualDescription: 'Sesiones personalizadas uno a uno adaptadas a tus necesidades específicas y tu viaje espiritual.',170 |       groupTitle: 'Sesiones Grupales',171 |       groupDescription: 'Experiencias grupales transformadoras que fomentan la comunidad y la sanación colectiva.',172 |       intensiveTitle: 'Programas Intensivos',173 |       intensiveDescription: 'Programas de inmersión profunda para transformación profunda y despertar espiritual.',174 |       benefitsTitle: 'Lo que Experimentarás',175 |       benefit1Title: 'Alivio Inmediato',176 |       benefit1Description: 'Experimenta alivio emocional y energético inmediato desde la primera sesión.',177 |       benefit2Title: 'Transformación a Largo Plazo',178 |       benefit2Description: 'Construye cambios duraderos a través de la práctica consistente y la guía.',179 |       benefit3Title: 'Crecimiento Personal',180 |       benefit3Description: 'Desarrolla una mayor autoconciencia y conexión espiritual.'181 |     },182 |     about: {183 |       title: 'Acerca de MatMax Yoga Studio',184 |       text: 'MatMax Yoga Studio está dedicado a ayudarte a construir fuerza, flexibilidad y paz interior a través del movimiento consciente y la respiración. Nuestras clases apoyan el bienestar y el equilibrio para todos los niveles.',185 |       description: 'MatMax Yoga Studio está dedicado a ayudarte a construir fuerza, flexibilidad y paz interior a través del movimiento consciente y la respiración. Nuestras clases apoyan el bienestar y el equilibrio para todos los niveles.',186 |       statsClients: 'Clientes Ayudados',187 |       statsYears: 'Años de Experiencia',188 |       statsSessions: 'Sesiones Completadas',189 |       statsCountries: 'Países Atendidos',190 |       valuesTitle: 'Nuestros Valores Fundamentales',191 |       value1Title: 'Compasión',192 |       value1Description: 'Nos acercamos a cada cliente con profunda empatía y comprensión, creando un espacio seguro para la sanación y el crecimiento.',193 |       value2Title: 'Autenticidad',194 |       value2Description: 'Nuestra guía proviene de la sabiduría espiritual genuina y la experiencia personal, no de libros de texto o teorías.',195 |       value3Title: 'Transformación',196 |       value3Description: 'Creemos en el poder del cambio real y estamos comprometidos a ayudarte a lograr una transformación duradera.',197 |       storyTitle: 'La Historia de Jose',198 |       storyText: 'Mi viaje comenzó hace más de 15 años cuando experimenté un profundo despertar espiritual que cambió mi vida para siempre. Desde entonces, me he dedicado a ayudar a otros a encontrar su propio camino hacia el crecimiento espiritual y la transformación personal. A través de años de estudio, práctica y trabajo con clientes de todo el mundo, he desarrollado un enfoque único que combina la sabiduría espiritual tradicional con la comprensión moderna de la psicología humana y el trabajo energético.'199 |     },200 |     booking: {201 |       title: 'Reserva tu Sesión',202 |       description: '¿Listo para comenzar tu transformación? Reserva una sesión y da el primer paso hacia tu despertar espiritual.',203 |       dateLabel: 'Seleccionar Fecha',204 |       datePlaceholder: 'Elige una fecha',205 |       timeLabel: 'Seleccionar Hora',206 |       timePlaceholder: 'Elige una hora',207 |       nameLabel: 'Nombre Completo',208 |       namePlaceholder: 'Ingresa tu nombre completo',209 |       emailLabel: 'Email *',210 |       emailPlaceholder: 'Ingresa tu email',211 |       phoneLabel: 'Teléfono (Opcional)',212 |       phonePlaceholder: 'Ingresa tu número de teléfono',213 |       messageLabel: 'Mensaje (Opcional)',214 |       messagePlaceholder: 'Cuéntanos sobre tus intenciones o cualquier preocupación específica...',215 |       submitButton: 'Reservar Sesión',216 |       submitting: 'Reservando...',217 |       successMessage: '¡Reserva enviada exitosamente! Te enviaremos un email de confirmación pronto.',218 |       errorMessage: 'Hubo un error al enviar tu reserva. Por favor intenta de nuevo.',219 |       additionalInfo: 'Todas las sesiones se realizan en línea a través de videollamada. Recibirás instrucciones detalladas después de la reserva.'220 |     },221 |     cta: {222 |       bookReading: 'Reserva tu Lectura'223 |     },224 |     common: {225 |       login: 'Iniciar Sesión'226 |     }227 |   }228 | };229 | 230 | export function getNestedValue(obj: Record<string, unknown>, path: string): unknown {231 |   return path.split('.').reduce((current: Record<string, unknown>, key: string) => current?.[key] as Record<string, unknown>, obj);232 | }233 | 234 | export function setNestedValue(obj: Record<string, unknown>, path: string, value: unknown): Record<string, unknown> {235 |   const keys = path.split('.');236 |   const lastKey = keys.pop()!;237 |   const target = keys.reduce((current: Record<string, unknown>, key: string) => {238 |     if (!current[key]) current[key] = {};239 |     return current[key] as Record<string, unknown>;240 |   }, obj);241 |   target[lastKey] = value;242 |   return obj;243 | }244 | 245 | export const translationStructure = {246 |   en: {247 |     nav: { title: '', tagline: '', description: '', ctaPrimary: '', ctaSecondary: '' },248 |     hero: { title: '', tagline: '', description: '', ctaPrimary: '', ctaSecondary: '' },249 |     approach: { title: '', description: '', heartTitle: '', heartDescription: '', mindTitle: '', mindDescription: '', spiritTitle: '', spiritDescription: '', energyTitle: '', energyDescription: '', ctaText: '' },250 |     session: { title: '', description: '', individualTitle: '', individualDescription: '', groupTitle: '', groupDescription: '', intensiveTitle: '', intensiveDescription: '', benefitsTitle: '', benefit1Title: '', benefit1Description: '', benefit2Title: '', benefit2Description: '', benefit3Title: '', benefit3Description: '' },251 |     about: { title: '', description: '', statsClients: '', statsYears: '', statsSessions: '', statsCountries: '', valuesTitle: '', value1Title: '', value1Description: '', value2Title: '', value2Description: '', value3Title: '', value3Description: '', storyTitle: '', storyText: '' },252 |     booking: { title: '', description: '', dateLabel: '', datePlaceholder: '', timeLabel: '', timePlaceholder: '', nameLabel: '', namePlaceholder: '', emailLabel: '', emailPlaceholder: '', phoneLabel: '', phonePlaceholder: '', messageLabel: '', messagePlaceholder: '', submitButton: '', submitting: '', successMessage: '', errorMessage: '', additionalInfo: '' },253 |     cta: { bookReading: '' },254 |     common: { login: '' }255 |   },256 |   es: {257 |     nav: { title: '', tagline: '', description: '', ctaPrimary: '', ctaSecondary: '' },258 |     hero: { title: '', tagline: '', description: '', ctaPrimary: '', ctaSecondary: '' },259 |     approach: { title: '', description: '', heartTitle: '', heartDescription: '', mindTitle: '', mindDescription: '', spiritTitle: '', spiritDescription: '', energyTitle: '', energyDescription: '', ctaText: '' },260 |     session: { title: '', description: '', individualTitle: '', individualDescription: '', groupTitle: '', groupDescription: '', intensiveTitle: '', intensiveDescription: '', benefitsTitle: '', benefit1Title: '', benefit1Description: '', benefit2Title: '', benefit2Description: '', benefit3Title: '', benefit3Description: '' },261 |     about: { title: '', description: '', statsClients: '', statsYears: '', statsSessions: '', statsCountries: '', valuesTitle: '', value1Title: '', value1Description: '', value2Title: '', value2Description: '', value3Title: '', value3Description: '', storyTitle: '', storyText: '' },262 |     booking: { title: '', description: '', dateLabel: '', datePlaceholder: '', timeLabel: '', timePlaceholder: '', nameLabel: '', namePlaceholder: '', emailLabel: '', emailPlaceholder: '', phoneLabel: '', phonePlaceholder: '', messageLabel: '', messagePlaceholder: '', submitButton: '', submitting: '', successMessage: '', errorMessage: '', additionalInfo: '' },263 |     cta: { bookReading: '' },264 |     common: { login: '' }265 |   }266 | };
============================================================END: frontend/lib/data/translations.ts============================================================


============================================================FILE: frontend/lib/data.tsSIZE: 5.20 KB============================================================
  1 | import { createClient } from '@supabase/supabase-js';  2 | import { z } from 'zod';  3 |   4 | const supabase = createClient(  5 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  6 |   process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!  7 | );  8 |   9 | const scheduleSchema = z.object({ 10 |   id: z.number(), 11 |   date: z.string(), 12 |   time: z.string(), 13 |   duration: z.number(), 14 |   capacity: z.number(), 15 |   is_available: z.boolean(), 16 |   created_at: z.string(), 17 |   updated_at: z.string() 18 | }); 19 |  20 | const clientSchema = z.object({ 21 |   id: z.number(), 22 |   email: z.string().email(), 23 |   name: z.string(), 24 |   phone: z.string().nullable(), 25 |   status: z.string(), 26 |   birth_date: z.string(), 27 |   birth_time: z.string().nullable(), 28 |   birth_place: z.string(), 29 |   question: z.string(), 30 |   language: z.string(), 31 |   admin_notes: z.string().nullable(), 32 |   scheduled_date: z.string().nullable(), 33 |   scheduled_time: z.string().nullable(), 34 |   session_type: z.string().nullable(), 35 |   last_reminder_sent: z.string().nullable(), 36 |   last_booking: z.string().nullable(), 37 |   created_at: z.string(), 38 |   updated_at: z.string() 39 | }); 40 |  41 | export async function getSchedules() { 42 |   try { 43 |     const { data, error } = await supabase 44 |       .from('schedules') 45 |       .select('*') 46 |       .eq('is_available', true) 47 |       .order('date', { ascending: true }) 48 |       .order('time', { ascending: true }); 49 |  50 |     if (error) { 51 |       throw new Error('Failed to fetch schedules'); 52 |     } 53 |  54 |     const validatedSchedules = data?.map(schedule => { 55 |       const validation = scheduleSchema.safeParse(schedule); 56 |       if (!validation.success) { 57 |         return null; 58 |       } 59 |       return validation.data; 60 |     }).filter(Boolean) || []; 61 |  62 |     return validatedSchedules.filter((schedule): schedule is NonNullable<typeof schedule> => schedule !== null).map(schedule => ({ 63 |       id: schedule.id, 64 |       date: schedule.date, 65 |       time: schedule.time, 66 |       duration: schedule.duration, 67 |       capacity: schedule.capacity, 68 |       isAvailable: schedule.is_available, 69 |       createdAt: schedule.created_at, 70 |       updatedAt: schedule.updated_at 71 |     })); 72 |  73 |   } catch (error) { 74 |     throw error; 75 |   } 76 | } 77 |  78 | export async function getClients() { 79 |   try { 80 |     const { data, error } = await supabase 81 |       .from('clients') 82 |       .select('*') 83 |       .order('created_at', { ascending: false }); 84 |  85 |     if (error) { 86 |       throw new Error('Failed to fetch clients'); 87 |     } 88 |  89 |     const validatedClients = data?.map(client => { 90 |       const validation = clientSchema.safeParse(client); 91 |       if (!validation.success) { 92 |         return null; 93 |       } 94 |       return validation.data; 95 |     }).filter(Boolean) || []; 96 |  97 |     return validatedClients.filter((client): client is NonNullable<typeof client> => client !== null).map(client => ({ 98 |       id: client.id, 99 |       email: client.email,100 |       name: client.name,101 |       phone: client.phone,102 |       status: client.status,103 |       birthDate: client.birth_date,104 |       birthTime: client.birth_time,105 |       birthPlace: client.birth_place,106 |       question: client.question,107 |       language: client.language,108 |       adminNotes: client.admin_notes,109 |       scheduledDate: client.scheduled_date,110 |       scheduledTime: client.scheduled_time,111 |       sessionType: client.session_type,112 |       lastReminderSent: client.last_reminder_sent,113 |       lastBooking: client.last_booking,114 |       createdAt: client.created_at,115 |       updatedAt: client.updated_at116 |     }));117 | 118 |   } catch (error) {119 |     throw error;120 |   }121 | }122 | 123 | export async function getContent() {124 |   try {125 |     const { data, error } = await supabase126 |       .from('kv_store_f839855f')127 |       .select('*')128 |       .order('key', { ascending: true });129 | 130 |     if (error) {131 |       throw new Error('Failed to fetch content');132 |     }133 | 134 |     const content = data?.reduce((acc, item) => {135 |       acc[item.key] = item.value;136 |       return acc;137 |     }, {} as Record<string, unknown>) || {};138 | 139 |     return content;140 | 141 |   } catch (error) {142 |     throw error;143 |   }144 | }145 | 146 | export async function getLogo() {147 |   try {148 |     const { data, error } = await supabase149 |       .from('logo')150 |       .select('*')151 |       .single();152 | 153 |     if (error) {154 | 155 |       return {156 |         id: 1,157 |         type: 'text',158 |         text: 'SOULPATH',159 |         imageUrl: null,160 |         isActive: true,161 |         createdAt: new Date().toISOString(),162 |         updatedAt: new Date().toISOString()163 |       };164 |     }165 | 166 |     return data;167 | 168 |   } catch (error) {169 | 170 |     return {171 |       id: 1,172 |       type: 'text',173 |       text: 'SOULPATH',174 |       imageUrl: null,175 |       isActive: true,176 |       createdAt: new Date().toISOString(),177 |       updatedAt: new Date().toISOString()178 |     };179 |   }180 | }
============================================================END: frontend/lib/data.ts============================================================


============================================================FILE: frontend/lib/design-system.tsSIZE: 9.67 KB============================================================
  1 | export const colors = {  2 |   3 |   primary: {  4 |     50: 'var(--color-primary-50)',  5 |     100: 'var(--color-primary-100)',  6 |     200: 'var(--color-primary-200)',  7 |     300: 'var(--color-primary-300)',  8 |     400: 'var(--color-primary-400)',  9 |     500: 'var(--color-primary-500)', 10 |     600: 'var(--color-primary-600)', 11 |     700: 'var(--color-primary-700)', 12 |     800: 'var(--color-primary-800)', 13 |     900: 'var(--color-primary-900)', 14 |     950: 'var(--color-primary-950)', 15 |   }, 16 |  17 |   secondary: { 18 |     50: 'var(--color-secondary-50)', 19 |     100: 'var(--color-secondary-100)', 20 |     200: 'var(--color-secondary-200)', 21 |     300: 'var(--color-secondary-300)', 22 |     400: 'var(--color-secondary-400)', 23 |     500: 'var(--color-secondary-500)', 24 |     600: 'var(--color-secondary-600)', 25 |     700: 'var(--color-secondary-700)', 26 |     800: 'var(--color-secondary-800)', 27 |     900: 'var(--color-secondary-900)', 28 |     950: 'var(--color-secondary-950)', 29 |   }, 30 |  31 |   accent: { 32 |     50: 'var(--color-accent-50)', 33 |     100: 'var(--color-accent-100)', 34 |     200: 'var(--color-accent-200)', 35 |     300: 'var(--color-accent-300)', 36 |     400: 'var(--color-accent-400)', 37 |     500: 'var(--color-accent-500)', 38 |     600: 'var(--color-accent-600)', 39 |     700: 'var(--color-accent-700)', 40 |     800: 'var(--color-accent-800)', 41 |     900: 'var(--color-accent-900)', 42 |     950: 'var(--color-accent-950)', 43 |   }, 44 |  45 |   sidebar: { 46 |     50: 'var(--color-sidebar-50)', 47 |     100: 'var(--color-sidebar-100)', 48 |     200: 'var(--color-sidebar-200)', 49 |     300: 'var(--color-sidebar-300)', 50 |     400: 'var(--color-sidebar-400)', 51 |     500: 'var(--color-sidebar-500)', 52 |     600: 'var(--color-sidebar-600)', 53 |     700: 'var(--color-sidebar-700)', 54 |     800: 'var(--color-sidebar-800)', 55 |     900: 'var(--color-sidebar-900)', 56 |     950: 'var(--color-sidebar-950)', 57 |   }, 58 |  59 |   border: { 60 |     50: 'var(--color-border-50)', 61 |     100: 'var(--color-border-100)', 62 |     200: 'var(--color-border-200)', 63 |     300: 'var(--color-border-300)', 64 |     400: 'var(--color-border-400)', 65 |     500: 'var(--color-border-500)', 66 |     600: 'var(--color-border-600)', 67 |     700: 'var(--color-border-700)', 68 |     800: 'var(--color-border-800)', 69 |     900: 'var(--color-border-900)', 70 |     950: 'var(--color-border-950)', 71 |   }, 72 |  73 |   text: { 74 |     primary: 'var(--color-text-primary)', 75 |     secondary: 'var(--color-text-secondary)', 76 |     tertiary: 'var(--color-text-tertiary)', 77 |     inverse: 'var(--color-text-inverse)', 78 |   }, 79 |  80 |   status: { 81 |     success: 'var(--color-status-success)', 82 |     warning: 'var(--color-status-warning)', 83 |     error: 'var(--color-status-error)', 84 |     info: 'var(--color-status-info)', 85 |   }, 86 |  87 |   semantic: { 88 |     surface: { 89 |       primary: 'var(--color-surface-primary)', 90 |       secondary: 'var(--color-surface-secondary)', 91 |       tertiary: 'var(--color-surface-tertiary)', 92 |       quaternary: 'var(--color-surface-quaternary)', 93 |     }, 94 |     background: { 95 |       primary: 'var(--color-background-primary)', 96 |       secondary: 'var(--color-background-secondary)', 97 |     }, 98 |   }, 99 | };100 | 101 | export const spacing = {102 |   0: 'var(--spacing-0)',103 |   1: 'var(--spacing-1)',104 |   2: 'var(--spacing-2)',105 |   3: 'var(--spacing-3)',106 |   4: 'var(--spacing-4)',107 |   5: 'var(--spacing-5)',108 |   6: 'var(--spacing-6)',109 |   8: 'var(--spacing-8)',110 |   10: 'var(--spacing-10)',111 |   12: 'var(--spacing-12)',112 |   16: 'var(--spacing-16)',113 |   20: 'var(--spacing-20)',114 |   24: 'var(--spacing-24)',115 |   32: 'var(--spacing-32)',116 |   40: 'var(--spacing-40)',117 |   48: 'var(--spacing-48)',118 |   56: 'var(--spacing-56)',119 |   64: 'var(--spacing-64)',120 | };121 | 122 | export const typography = {123 |   fontFamily: {124 |     sans: 'ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',125 |     serif: 'ui-serif, Georgia, Cambria, "Times New Roman", Times, serif',126 |     mono: 'ui-monospace, SFMono-Regular, "Menlo", Monaco, Consolas, "Liberation Mono", "Courier New", monospace',127 |   },128 |   fontSize: {129 |     xs: 'var(--font-size-xs)',130 |     sm: 'var(--font-size-sm)',131 |     base: 'var(--font-size-base)',132 |     lg: 'var(--font-size-lg)',133 |     xl: 'var(--font-size-xl)',134 |     '2xl': 'var(--font-size-2xl)',135 |     '3xl': 'var(--font-size-3xl)',136 |     '4xl': 'var(--font-size-4xl)',137 |     '5xl': 'var(--font-size-5xl)',138 |     '6xl': 'var(--font-size-6xl)',139 |     '7xl': 'var(--font-size-7xl)',140 |     '8xl': 'var(--font-size-8xl)',141 |     '9xl': 'var(--font-size-9xl)',142 |   },143 |   fontWeight: {144 |     thin: 'var(--font-weight-thin)',145 |     extralight: 'var(--font-weight-extralight)',146 |     light: 'var(--font-weight-light)',147 |     normal: 'var(--font-weight-normal)',148 |     medium: 'var(--font-weight-medium)',149 |     semibold: 'var(--font-weight-semibold)',150 |     bold: 'var(--font-weight-bold)',151 |     extrabold: 'var(--font-weight-extrabold)',152 |     black: 'var(--font-weight-black)',153 |   },154 |   lineHeight: {155 |     none: 'var(--line-height-none)',156 |     tight: 'var(--line-height-tight)',157 |     snug: 'var(--line-height-snug)',158 |     normal: 'var(--line-height-normal)',159 |     relaxed: 'var(--line-height-relaxed)',160 |     loose: 'var(--line-height-loose)',161 |   },162 |   letterSpacing: {163 |     tighter: 'var(--letter-spacing-tighter)',164 |     tight: 'var(--letter-spacing-tight)',165 |     normal: 'var(--letter-spacing-normal)',166 |     wide: 'var(--letter-spacing-wide)',167 |     wider: 'var(--letter-spacing-wider)',168 |     widest: 'var(--letter-spacing-widest)',169 |   },170 | };171 | 172 | export const borders = {173 |   radius: {174 |     none: 'var(--border-radius-none)',175 |     sm: 'var(--border-radius-sm)',176 |     base: 'var(--border-radius-base)',177 |     md: 'var(--border-radius-md)',178 |     lg: 'var(--border-radius-lg)',179 |     xl: 'var(--border-radius-xl)',180 |     '2xl': 'var(--border-radius-2xl)',181 |     '3xl': 'var(--border-radius-3xl)',182 |     full: 'var(--border-radius-full)',183 |   },184 |   width: {185 |     0: 'var(--border-width-0)',186 |     1: 'var(--border-width-1)',187 |     2: 'var(--border-width-2)',188 |     4: 'var(--border-width-4)',189 |     8: 'var(--border-width-8)',190 |   },191 | };192 | 193 | export const shadows = {194 |   sm: 'var(--shadow-sm)',195 |   base: 'var(--shadow-base)',196 |   md: 'var(--shadow-md)',197 |   lg: 'var(--shadow-lg)',198 |   xl: 'var(--shadow-xl)',199 |   '2xl': 'var(--shadow-2xl)',200 |   inner: 'var(--shadow-inner)',201 |   none: 'var(--shadow-none)',202 | };203 | 204 | export const transitions = {205 |   duration: {206 |     75: 'var(--transition-duration-75)',207 |     100: 'var(--transition-duration-100)',208 |     150: 'var(--transition-duration-150)',209 |     200: 'var(--transition-duration-200)',210 |     300: 'var(--transition-duration-300)',211 |     500: 'var(--transition-duration-500)',212 |     700: 'var(--transition-duration-700)',213 |     1000: 'var(--transition-duration-1000)',214 |   },215 |   easing: {216 |     linear: 'var(--transition-easing-linear)',217 |     in: 'var(--transition-easing-in)',218 |     out: 'var(--transition-easing-out)',219 |     'in-out': 'var(--transition-easing-in-out)',220 |   },221 |   common: {222 |     fast: 'var(--transition-duration-150) var(--transition-easing-out)',223 |     normal: 'var(--transition-duration-200) var(--transition-easing-in-out)',224 |     slow: 'var(--transition-duration-300) var(--transition-easing-in-out)',225 |   },226 | };227 | 228 | export const breakpoints = {229 |   sm: '640px',230 |   md: '768px',231 |   lg: '1024px',232 |   xl: '1280px',233 |   '2xl': '1536px',234 | };235 | 236 | export const zIndex = {237 |   dropdown: 'var(--z-index-dropdown)',238 |   sticky: 'var(--z-index-sticky)',239 |   fixed: 'var(--z-index-fixed)',240 |   modalBackdrop: 'var(--z-index-modal-backdrop)',241 |   modal: 'var(--z-index-modal)',242 |   popover: 'var(--z-index-popover)',243 |   tooltip: 'var(--z-index-tooltip)',244 |   toast: 'var(--z-index-toast)',245 | };246 | 247 | export const components = {248 |   card: {249 |     background: 'var(--color-surface-primary)',250 |     border: 'var(--color-border-500)',251 |     borderRadius: 'var(--border-radius-lg)',252 |     padding: 'var(--spacing-6)',253 |     shadow: 'var(--shadow-md)',254 |   },255 |   button: {256 |     primary: {257 |       background: 'var(--color-primary-500)',258 |       color: 'var(--color-text-inverse)',259 |       border: 'none',260 |       borderRadius: 'var(--border-radius-md)',261 |       padding: 'var(--spacing-2) var(--spacing-4)',262 |       fontWeight: 'var(--font-weight-medium)',263 |       transition: 'var(--transition-common-normal)',264 |     },265 |     outline: {266 |       background: 'transparent',267 |       color: 'var(--color-text-primary)',268 |       border: '1px solid var(--color-border-500)',269 |       borderRadius: 'var(--border-radius-md)',270 |       padding: 'var(--spacing-2) var(--spacing-4)',271 |       fontWeight: 'var(--font-weight-medium)',272 |       transition: 'var(--transition-common-normal)',273 |     },274 |     danger: {275 |       background: 'var(--color-status-error)',276 |       color: 'white',277 |       border: 'none',278 |       borderRadius: 'var(--border-radius-md)',279 |       padding: 'var(--spacing-2) var(--spacing-4)',280 |       fontWeight: 'var(--font-weight-medium)',281 |       transition: 'var(--transition-common-normal)',282 |     },283 |   },284 |   input: {285 |     background: 'var(--color-surface-secondary)',286 |     border: '1px solid var(--color-border-500)',287 |     color: 'var(--color-text-primary)',288 |     borderRadius: 'var(--border-radius-md)',289 |     padding: 'var(--spacing-2) var(--spacing-3)',290 |     transition: 'var(--transition-common-fast)',291 |   },292 |   sidebar: {293 |     background: 'var(--color-sidebar-500)',294 |     border: 'var(--color-border-500)',295 |     text: 'var(--color-text-primary)',296 |     textSecondary: 'var(--color-text-secondary)',297 |     active: 'var(--color-surface-tertiary)',298 |     hover: 'var(--color-surface-secondary)',299 |   },300 | };301 | 302 | export const withOpacity = (color: string, opacity: number) => {303 | 304 |   return `${color} / ${opacity}`;305 | };306 | 307 | export const responsive = (base: string) => {308 | 309 |   return base;310 | };311 | 312 | const designTokens = {313 |   colors,314 |   spacing,315 |   typography,316 |   borders,317 |   shadows,318 |   transitions,319 |   breakpoints,320 |   zIndex,321 |   components,322 |   withOpacity,323 |   responsive,324 | };325 | 326 | export default designTokens;
============================================================END: frontend/lib/design-system.ts============================================================


============================================================FILE: frontend/lib/email.tsSIZE: 3.55 KB============================================================
  1 | import { createClient } from '@supabase/supabase-js';  2 |   3 | const supabase = createClient(  4 |   process.env.NEXT_PUBLIC_SUPABASE_URL!,  5 |   process.env.SUPABASE_SERVICE_ROLE_KEY!  6 | );  7 |   8 | export interface EmailTemplate {  9 |   en: { 10 |     subject: string; 11 |     html: string; 12 |     videoConferenceLink?: { 13 |       isActive: boolean; 14 |       url: string; 15 |       includeInTemplate: boolean; 16 |     }; 17 |   }; 18 |   es: { 19 |     subject: string; 20 |     html: string; 21 |     videoConferenceLink?: { 22 |       isActive: boolean; 23 |       url: string; 24 |       includeInTemplate: boolean; 25 |     }; 26 |   }; 27 | } 28 |  29 | export interface EmailConfig { 30 |   smtpHost: string; 31 |   smtpPort: number; 32 |   smtpUser: string; 33 |   smtpPass: string; 34 |   fromEmail: string; 35 |   fromName: string; 36 | } 37 |  38 | export async function getEmailConfig(): Promise<EmailConfig | null> { 39 |   try { 40 |     const { data, error } = await supabase 41 |       .from('email_config') 42 |       .select('*') 43 |       .single(); 44 |  45 |     if (error) { 46 |       return null; 47 |     } 48 |  49 |     return data; 50 |   } catch (error) { 51 |     return null; 52 |   } 53 | } 54 |  55 | export async function getEmailTemplates(): Promise<EmailTemplate | null> { 56 |   try { 57 |     const { data, error } = await supabase 58 |       .from('email_templates') 59 |       .select('*') 60 |       .single(); 61 |  62 |     if (error) { 63 |       return null; 64 |     } 65 |  66 |     return data; 67 |   } catch (error) { 68 |     return null; 69 |   } 70 | } 71 |  72 | export async function sendEmail( 73 |   to: string, 74 |   subject: string, 75 |   html: string 76 | ): Promise<boolean> { 77 |   try { 78 |     const config = await getEmailConfig(); 79 |     if (!config) { 80 |       return false; 81 |     } 82 |  83 |     + '...', 84 |       config: { 85 |         smtpHost: config.smtpHost, 86 |         smtpPort: config.smtpPort, 87 |         fromEmail: config.fromEmail 88 |       } 89 |     }); 90 |  91 |     return true; 92 |   } catch (error) { 93 |     return false; 94 |   } 95 | } 96 |  97 | export async function sendBookingConfirmation( 98 |   clientEmail: string, 99 |   scheduleData: Record<string, unknown>,100 |   language: 'en' | 'es' = 'en'101 | ): Promise<boolean> {102 |   try {103 |     const templates = await getEmailTemplates();104 |     if (!templates) {105 |       return false;106 |     }107 | 108 |     const template = templates[language];109 |     const subject = template.subject;110 | 111 |     let html = template.html;112 | 113 |     html = html.replace('{{clientName}}', String(scheduleData.clientName || 'Client'));114 |     html = html.replace('{{date}}', String(scheduleData.date || ''));115 |     html = html.replace('{{time}}', String(scheduleData.time || ''));116 |     html = html.replace('{{duration}}', String(scheduleData.duration || ''));117 | 118 |     if (template.videoConferenceLink?.isActive && template.videoConferenceLink?.includeInTemplate) {119 |       html += `<p><strong>Video Conference Link:</strong> <a href="${template.videoConferenceLink.url}">${template.videoConferenceLink.url}</a></p>`;120 |     }121 | 122 |     return await sendEmail(clientEmail, subject, html);123 |   } catch (error) {124 |     return false;125 |   }126 | }
============================================================END: frontend/lib/email.ts============================================================


============================================================FILE: frontend/lib/horoscope-client.tsSIZE: 1.43 KB============================================================
  1 | import { useEffect, useState } from 'react';  2 |   3 | let Ephemeris: Record<string, unknown> | null = null;  4 | let isInitialized = false;  5 |   6 | export const useHoroscope = () => {  7 |   const [isLoading, setIsLoading] = useState(true);  8 |   const [error, setError] = useState<string | null>(null);  9 |  10 |   useEffect(() => { 11 |     const initEphemeris = async () => { 12 |       if (isInitialized) { 13 |         setIsLoading(false); 14 |         return; 15 |       } 16 |  17 |       try { 18 |  19 |         if (typeof window === 'undefined') { 20 |           throw new Error('Ephemeris can only be used in browser environment'); 21 |         } 22 |  23 |         const ephemerisModule = await import('ephemeris').catch((err) => { 24 |           throw new Error('Failed to load Ephemeris library'); 25 |         }); 26 |  27 |         Ephemeris = ephemerisModule.default || ephemerisModule; 28 |         isInitialized = true; 29 |         setIsLoading(false); 30 |       } catch (err) { 31 |         setError(err instanceof Error ? err.message : 'Failed to initialize Ephemeris'); 32 |         setIsLoading(false); 33 |       } 34 |     }; 35 |  36 |     initEphemeris(); 37 |   }, []); 38 |  39 |   return { Ephemeris, isLoading, error }; 40 | }; 41 |  42 | export const getEphemeris = () => { 43 |   if (!isInitialized) { 44 |     throw new Error('Ephemeris not initialized. Use useHoroscope hook first.'); 45 |   } 46 |   return Ephemeris; 47 | };
============================================================END: frontend/lib/horoscope-client.ts============================================================


============================================================FILE: frontend/lib/index.tsSIZE: 2.49 KB============================================================
  1 | export * from './design-system';  2 |   3 | export * from './styles/common';  4 |   5 | export * from './api';  6 |   7 | export * from './state';  8 |   9 | export * from './utils'; 10 |  11 | export * from './auth'; 12 |  13 | export * from './supabase/client'; 14 | export * from './supabase/server'; 15 |  16 | export * from './types'; 17 |  18 | export * from './validations'; 19 |  20 | export * from './email'; 21 |  22 | export * from './data'; 23 | export * from './data/translations';
============================================================END: frontend/lib/index.ts============================================================


============================================================FILE: frontend/lib/izipay/config.tsSIZE: 2.76 KB============================================================
  1 | import { createHash } from 'node:crypto'  2 |   3 | export interface IzipayConfig {  4 |   merchantId: string;  5 |   username: string;  6 |   password: string;  7 |   publicKey: string;  8 |   currency: string;  9 |   environment: 'sandbox' | 'production'; 10 |   supportedCountries: string[]; 11 |   returnUrl: string; 12 |   cancelUrl: string; 13 | } 14 |  15 | export interface IzipayCredentials { 16 |   merchantId: string; 17 |   username: string; 18 |   password: string; 19 |   publicKey: string; 20 |   environment: 'sandbox' | 'production'; 21 | } 22 |  23 | export function getIzipayConfig(): IzipayConfig | null { 24 |   const merchantId = process.env.IZIPAY_MERCHANT_ID; 25 |   const username = process.env.IZIPAY_USERNAME; 26 |   const password = process.env.IZIPAY_PASSWORD; 27 |   const publicKey = process.env.IZIPAY_PUBLIC_KEY; 28 |   const environment = (process.env.IZIPAY_ENVIRONMENT as 'sandbox' | 'production') || 'sandbox'; 29 |  30 |   if (!merchantId || !username || !password || !publicKey) { 31 |     return null; 32 |   } 33 |  34 |   const baseUrl = process.env.NEXTAUTH_URL || 'http: 35 |  36 |   return { 37 |     merchantId, 38 |     username, 39 |     password, 40 |     publicKey, 41 |     currency: 'PEN', 42 |     environment, 43 |     supportedCountries: ['PE'], 44 |     returnUrl: `${baseUrl}/payment/success`, 45 |     cancelUrl: `${baseUrl}/payment/cancel`, 46 |   }; 47 | } 48 |  49 | export function getIzipayApiUrl(environment: 'sandbox' | 'production' = 'sandbox'): string { 50 |   return environment === 'production' 51 |     ? 'https: 52 |     : 'https: 53 | } 54 |  55 | export function validateIzipayConfig(config: IzipayConfig): boolean { 56 |   const requiredFields = ['merchantId', 'username', 'password', 'publicKey']; 57 |   return requiredFields.every(field => config[field as keyof IzipayConfig]); 58 | } 59 |  60 | export function getIzipayAuthHeader(username: string, password: string): string { 61 |   const credentials = Buffer.from(`${username}:${password}`).toString('base64'); 62 |   return `Basic ${credentials}`; 63 | } 64 |  65 | export function generateIzipaySignature(data: Record<string, unknown>, key: string): string { 66 |   const sortedKeys = Object.keys(data).sort(); 67 |   const queryString = sortedKeys 68 |     .map(key => `${key}=${data[key]}`) 69 |     .join('&'); 70 |  71 |   const signatureString = `${queryString}+${key}`; 72 |  73 |   return createHash('sha256').update(signatureString).digest('base64'); 74 | } 75 |  76 | const izipayConfig = { 77 |   getIzipayConfig, 78 |   getIzipayApiUrl, 79 |   validateIzipayConfig, 80 |   getIzipayAuthHeader, 81 |   generateIzipaySignature, 82 | }; 83 |  84 | export default izipayConfig;
============================================================END: frontend/lib/izipay/config.ts============================================================


============================================================FILE: frontend/lib/izipay/index.tsSIZE: 0.57 KB============================================================
  1 | export {  2 |   getIzipayConfig,  3 |   getIzipayApiUrl,  4 |   validateIzipayConfig,  5 |   getIzipayAuthHeader,  6 |   generateIzipaySignature,  7 |   type IzipayConfig,  8 |   type IzipayCredentials  9 | } from './config'; 10 |  11 | export { 12 |   IzipayPaymentService, 13 |   type IzipayPaymentRequest, 14 |   type IzipayPaymentResponse, 15 |   type IzipayWebhookPayload, 16 |   type CreatePaymentIntentParams, 17 |   type IzipayTokenRequest, 18 |   type IzipayTokenResponse 19 | } from './payment-service'; 20 |  21 | export { IzipayPaymentService as default } from './payment-service';
============================================================END: frontend/lib/izipay/index.ts============================================================


============================================================FILE: frontend/lib/izipay/payment-service.tsSIZE: 10.52 KB============================================================
  1 | import { getIzipayConfig, getIzipayApiUrl, getIzipayAuthHeader, generateIzipaySignature, IzipayConfig } from './config';  2 |   3 | export interface IzipayPaymentRequest {  4 |   amount: number;  5 |   currency: string;  6 |   orderId: string;  7 |   customer: {  8 |     email: string;  9 |     firstName?: string; 10 |     lastName?: string; 11 |     phone?: string; 12 |   }; 13 |   returnUrl: string; 14 |   cancelUrl: string; 15 |   description?: string; 16 |   metadata?: Record<string, unknown>; 17 | } 18 |  19 | export interface IzipayPaymentResponse { 20 |   success: boolean; 21 |   paymentUrl?: string; 22 |   transactionId?: string; 23 |   error?: string; 24 |   details?: unknown; 25 | } 26 |  27 | export interface IzipayWebhookPayload { 28 |   transactionId: string; 29 |   orderId: string; 30 |   status: string; 31 |   amount: number; 32 |   currency: string; 33 |   paymentMethod: string; 34 |   timestamp: string; 35 |   signature: string; 36 | } 37 |  38 | export interface CreatePaymentIntentParams { 39 |   amount: number; 40 |   currency: string; 41 |   customerEmail: string; 42 |   customerName?: string; 43 |   orderId: string; 44 |   description?: string; 45 |   metadata?: Record<string, unknown>; 46 | } 47 |  48 | export interface IzipayTokenRequest { 49 |   amount: number; 50 |   currency: string; 51 |   orderId: string; 52 |   customer: { 53 |     email: string; 54 |     firstName?: string; 55 |     lastName?: string; 56 |   }; 57 |   returnUrl: string; 58 |   cancelUrl: string; 59 |   description?: string; 60 | } 61 |  62 | export interface IzipayTokenResponse { 63 |   success: boolean; 64 |   formToken?: string; 65 |   error?: string; 66 |   details?: unknown; 67 | } 68 |  69 | export class IzipayPaymentService { 70 |   private static config: IzipayConfig | null = null; 71 |  72 |   private static getConfig(override?: Partial<IzipayConfig>): IzipayConfig { 73 |     if (!this.config) { 74 |       this.config = getIzipayConfig(); 75 |     } 76 |     const base = this.config || ({} as IzipayConfig); 77 |     const merged: IzipayConfig = { 78 |       merchantId: override?.merchantId || base.merchantId, 79 |       username: override?.username || base.username, 80 |       password: override?.password || base.password, 81 |       publicKey: override?.publicKey || base.publicKey, 82 |       currency: override?.currency || base.currency || 'PEN', 83 |       environment: override?.environment || base.environment || 'sandbox', 84 |       supportedCountries: override?.supportedCountries || base.supportedCountries || ['PE'], 85 |       returnUrl: override?.returnUrl || base.returnUrl, 86 |       cancelUrl: override?.cancelUrl || base.cancelUrl, 87 |     }; 88 |     if (!merged.merchantId || !merged.username || !merged.password || !merged.publicKey) { 89 |       throw new Error('Izipay configuration not found. Please check environment variables or providerConfig.'); 90 |     } 91 |     return merged; 92 |   } 93 |  94 |   static async createFormToken(params: IzipayTokenRequest, overrideConfig?: Partial<IzipayConfig>): Promise<IzipayTokenResponse> { 95 |     try { 96 |       const config = this.getConfig(overrideConfig); 97 |       const apiUrl = getIzipayApiUrl(config.environment); 98 |  99 |       const requestData = {100 |         amount: params.amount,101 |         currency: params.currency,102 |         orderId: params.orderId,103 |         customer: params.customer,104 |         returnUrl: params.returnUrl,105 |         cancelUrl: params.cancelUrl,106 |         description: params.description || 'Payment for wellness services',107 |       };108 | 109 |       const authHeader = getIzipayAuthHeader(config.username, config.password);110 | 111 |       const response = await fetch(`${apiUrl}/api-payment/V4/Charge/CreatePayment`, {112 |         method: 'POST',113 |         headers: {114 |           'Authorization': authHeader,115 |           'Content-Type': 'application/json',116 |           'Accept': 'application/json',117 |         },118 |         body: JSON.stringify(requestData),119 |       });120 | 121 |       const result = await response.json();122 | 123 |       if (!response.ok) {124 |         return {125 |           success: false,126 |           error: result.errorMessage || 'Failed to create payment form token',127 |           details: result,128 |         };129 |       }130 | 131 |       return {132 |         success: true,133 |         formToken: result.answer?.formToken,134 |         details: result,135 |       };136 |     } catch (error) {137 |       return {138 |         success: false,139 |         error: error instanceof Error ? error.message : 'Unknown error',140 |       };141 |     }142 |   }143 | 144 |   static async createPaymentIntent(params: CreatePaymentIntentParams, overrideConfig?: Partial<IzipayConfig>): Promise<IzipayPaymentResponse> {145 |     try {146 |       const config = this.getConfig(overrideConfig);147 | 148 |       const tokenRequest: IzipayTokenRequest = {149 |         amount: Math.round(params.amount * 100),150 |         currency: params.currency,151 |         orderId: params.orderId,152 |         customer: {153 |           email: params.customerEmail,154 |           firstName: params.customerName?.split(' ')[0] || '',155 |           lastName: params.customerName?.split(' ').slice(1).join(' ') || '',156 |         },157 |         returnUrl: config.returnUrl,158 |         cancelUrl: config.cancelUrl,159 |         description: params.description,160 |       };161 | 162 |       const tokenResponse = await this.createFormToken(tokenRequest, overrideConfig);163 | 164 |       if (!tokenResponse.success || !tokenResponse.formToken) {165 |         return {166 |           success: false,167 |           error: tokenResponse.error || 'Failed to create payment token',168 |           details: tokenResponse.details,169 |         };170 |       }171 | 172 |       const apiUrl = getIzipayApiUrl(config.environment);173 |       const paymentUrl = `${apiUrl}/vads-payment/entry.silentInit.a?vads_form_token=${tokenResponse.formToken}`;174 | 175 |       return {176 |         success: true,177 |         paymentUrl,178 |         transactionId: tokenResponse.formToken,179 |         details: tokenResponse.details,180 |       };181 |     } catch (error) {182 |       return {183 |         success: false,184 |         error: error instanceof Error ? error.message : 'Unknown error',185 |       };186 |     }187 |   }188 | 189 |   static verifyWebhookSignature(payload: IzipayWebhookPayload): boolean {190 |     try {191 |       const config = this.getConfig();192 | 193 |       const { signature, ...signatureData } = payload;194 | 195 |       const expectedSignature = generateIzipaySignature(signatureData, config.publicKey);196 | 197 |       return signature === expectedSignature;198 |     } catch (error) {199 |       return false;200 |     }201 |   }202 | 203 |   static async processWebhook(payload: IzipayWebhookPayload): Promise<{204 |     success: boolean;205 |     status: string;206 |     orderId: string;207 |     transactionId: string;208 |   }> {209 |     try {210 | 211 |       if (!this.verifyWebhookSignature(payload)) {212 |         throw new Error('Invalid webhook signature');213 |       }214 | 215 |       let status: string;216 |       switch (payload.status) {217 |         case 'PAID':218 |         case 'AUTHORISED':219 |           status = 'completed';220 |           break;221 |         case 'REFUSED':222 |         case 'CANCELLED':223 |           status = 'failed';224 |           break;225 |         case 'PENDING':226 |         case 'WAITING_AUTHORISATION':227 |           status = 'pending';228 |           break;229 |         default:230 |           status = 'pending';231 |       }232 | 233 |       return {234 |         success: true,235 |         status,236 |         orderId: payload.orderId,237 |         transactionId: payload.transactionId,238 |       };239 |     } catch (error) {240 |       throw error;241 |     }242 |   }243 | 244 |   static async getPaymentDetails(transactionId: string): Promise<{245 |     success: boolean;246 |     status?: string;247 |     amount?: number;248 |     currency?: string;249 |     error?: string;250 |   }> {251 |     try {252 |       const config = this.getConfig();253 |       const apiUrl = getIzipayApiUrl(config.environment);254 |       const authHeader = getIzipayAuthHeader(config.username, config.password);255 | 256 |       const response = await fetch(`${apiUrl}/api-payment/V4/Transaction/Get`, {257 |         method: 'POST',258 |         headers: {259 |           'Authorization': authHeader,260 |           'Content-Type': 'application/json',261 |           'Accept': 'application/json',262 |         },263 |         body: JSON.stringify({264 |           uuid: transactionId,265 |         }),266 |       });267 | 268 |       const result = await response.json();269 | 270 |       if (!response.ok) {271 |         return {272 |           success: false,273 |           error: result.errorMessage || 'Failed to get payment details',274 |         };275 |       }276 | 277 |       const transaction = result.answer;278 | 279 |       return {280 |         success: true,281 |         status: transaction.transactionStatus,282 |         amount: transaction.amount,283 |         currency: transaction.currency,284 |       };285 |     } catch (error) {286 |       return {287 |         success: false,288 |         error: error instanceof Error ? error.message : 'Unknown error',289 |       };290 |     }291 |   }292 | 293 |   static async refundPayment(transactionId: string, amount?: number): Promise<{294 |     success: boolean;295 |     refundId?: string;296 |     error?: string;297 |   }> {298 |     try {299 |       const config = this.getConfig();300 |       const apiUrl = getIzipayApiUrl(config.environment);301 |       const authHeader = getIzipayAuthHeader(config.username, config.password);302 | 303 |       const requestData: Record<string, unknown> = {304 |         uuid: transactionId,305 |       };306 | 307 |       if (amount) {308 |         requestData.amount = Math.round(amount * 100);309 |       }310 | 311 |       const response = await fetch(`${apiUrl}/api-payment/V4/Transaction/CancelOrRefund`, {312 |         method: 'POST',313 |         headers: {314 |           'Authorization': authHeader,315 |           'Content-Type': 'application/json',316 |           'Accept': 'application/json',317 |         },318 |         body: JSON.stringify(requestData),319 |       });320 | 321 |       const result = await response.json();322 | 323 |       if (!response.ok) {324 |         return {325 |           success: false,326 |           error: result.errorMessage || 'Failed to refund payment',327 |         };328 |       }329 | 330 |       return {331 |         success: true,332 |         refundId: result.answer?.uuid,333 |       };334 |     } catch (error) {335 |       return {336 |         success: false,337 |         error: error instanceof Error ? error.message : 'Unknown error',338 |       };339 |     }340 |   }341 | }342 | 343 | export default IzipayPaymentService;
============================================================END: frontend/lib/izipay/payment-service.ts============================================================


============================================================FILE: frontend/lib/labsmobile-sms-service.tsSIZE: 7.98 KB============================================================
  1 | import { prisma } from './prisma';  2 | import { CommunicationTemplateService } from './communication/template-service';  3 |   4 | export interface LabsMobileConfig {  5 |   username: string;  6 |   tokenApi: string;  7 |   senderName?: string;  8 | }  9 |  10 | export interface LabsMobileResponse { 11 |   subid?: string; 12 |   code: string; 13 |   message: string; 14 | } 15 |  16 | export interface LabsMobileBalanceResponse { 17 |   code: number; 18 |   credits: string; 19 | } 20 |  21 | export interface LabsMobilePricesResponse { 22 |   [countryCode: string]: { 23 |     isocode: string; 24 |     prefix: string; 25 |     name: string; 26 |     credits: number; 27 |   }; 28 | } 29 |  30 | export class LabsMobileSmsService { 31 |   private config: LabsMobileConfig | null = null; 32 |   private baseUrl = 'https: 33 |  34 |   constructor() { 35 |     this.loadConfig(); 36 |   } 37 |  38 |   private async loadConfig() { 39 |     try { 40 |  41 |       const commConfig = await prisma.communicationConfig.findFirst({ 42 |         where: { sms_enabled: true } 43 |       }); 44 |  45 |       if (commConfig && commConfig.labsmobile_username && commConfig.labsmobile_token) { 46 |         this.config = { 47 |           username: commConfig.labsmobile_username, 48 |           tokenApi: commConfig.labsmobile_token, 49 |           senderName: commConfig.sms_sender_name || undefined 50 |         }; 51 |         return; 52 |       } 53 |  54 |       const smsConfig = await prisma.smsConfiguration.findFirst({ 55 |         where: { isActive: true, provider: 'labsmobile' } 56 |       }); 57 |  58 |       if (smsConfig) { 59 |         this.config = { 60 |           username: smsConfig.username, 61 |           tokenApi: smsConfig.tokenApi, 62 |           senderName: smsConfig.senderName || undefined 63 |         }; 64 |       } 65 |     } catch (error) { 66 |       } 67 |   } 68 |  69 |   private getAuthHeader(): string { 70 |     if (!this.config) { 71 |       throw new Error('SMS configuration not found'); 72 |     } 73 |     return Buffer.from(`${this.config.username}:${this.config.tokenApi}`).toString('base64'); 74 |   } 75 |  76 |   private async makeRequest<T>(endpoint: string, method: 'GET' | 'POST', body?: Record<string, unknown>): Promise<T> { 77 |     if (!this.config) { 78 |       throw new Error('SMS configuration not found'); 79 |     } 80 |  81 |     const url = `${this.baseUrl}${endpoint}`; 82 |     const headers: Record<string, string> = { 83 |       'Authorization': `Basic ${this.getAuthHeader()}`, 84 |       'Content-Type': 'application/json', 85 |     }; 86 |  87 |     const options: RequestInit = { 88 |       method, 89 |       headers, 90 |     }; 91 |  92 |     if (body && method === 'POST') { 93 |       options.body = JSON.stringify(body); 94 |     } 95 |  96 |     try { 97 |       const response = await fetch(url, options); 98 |  99 |       if (!response.ok) {100 |         throw new Error(`HTTP error! status: ${response.status}`);101 |       }102 | 103 |       const data = await response.json();104 |       return data as T;105 |     } catch (error) {106 |       throw error;107 |     }108 |   }109 | 110 |   async sendSms(phoneNumber: string, message: string): Promise<LabsMobileResponse> {111 |     const body = {112 |       message,113 |       tpoa: this.config?.senderName || 'MatMax Yoga Studio',114 |       recipient: [115 |         {116 |           msisdn: phoneNumber117 |         }118 |       ]119 |     };120 | 121 |     return this.makeRequest<LabsMobileResponse>('/send', 'POST', body);122 |   }123 | 124 |   async sendOtpSms(phoneNumber: string, otpCode: string, language: string = 'en'): Promise<LabsMobileResponse> {125 |     try {126 | 127 |       const template = await CommunicationTemplateService.getTemplate('otp_verification', language, {128 |         otpCode,129 |         expiryTime: '10 minutes'130 |       });131 | 132 |       if (template) {133 |         return this.sendSms(phoneNumber, template.content);134 |       }135 | 136 |       const defaultMessage = language === 'es'137 |         ? `Su código de verificación de MatMax Yoga Studio es: ${otpCode}. Este código expira en 10 minutos.`138 |         : `Your MatMax Yoga Studio verification code is: ${otpCode}. This code expires in 10 minutes.`;139 | 140 |       return this.sendSms(phoneNumber, defaultMessage);141 |     } catch (error) {142 | 143 |       const defaultMessage = `Your MatMax Yoga Studio verification code is: ${otpCode}. This code expires in 10 minutes.`;144 |       return this.sendSms(phoneNumber, defaultMessage);145 |     }146 |   }147 | 148 |   async sendSmsWithTemplate(149 |     phoneNumber: string,150 |     templateName: string,151 |     data: Record<string, unknown> = {},152 |     language: string = 'en'153 |   ): Promise<LabsMobileResponse> {154 |     try {155 |       const template = await CommunicationTemplateService.getTemplateByName(156 |         templateName,157 |         'sms',158 |         language,159 |         data160 |       );161 | 162 |       if (template) {163 |         return this.sendSms(phoneNumber, template.content);164 |       }165 | 166 |       throw new Error(`Template not found: ${templateName}`);167 |     } catch (error) {168 |       throw error;169 |     }170 |   }171 | 172 |   async getBalance(): Promise<LabsMobileBalanceResponse> {173 |     return this.makeRequest<LabsMobileBalanceResponse>('/balance', 'GET');174 |   }175 | 176 |   async getPrices(): Promise<LabsMobilePricesResponse> {177 |     return this.makeRequest<LabsMobilePricesResponse>('/prices', 'GET');178 |   }179 | 180 |   async sendScheduledSms(subid: string, command: 'send' | 'cancel' = 'send'): Promise<LabsMobileResponse> {181 |     const body = {182 |       cmd: command,183 |       subid184 |     };185 | 186 |     return this.makeRequest<LabsMobileResponse>('/scheduled', 'POST', body);187 |   }188 | 189 |   static validatePhoneNumber(phoneNumber: string, countryCode: string): boolean {190 | 191 |     const cleanNumber = phoneNumber.replace(/\D/g, '');192 | 193 |     const localValidations: Record<string, RegExp> = {194 |       'US': /^\d{10}$/,195 |       'CO': /^\d{10}$/,196 |       'MX': /^\d{10}$/,197 |       'ES': /^\d{9}$/,198 |       'CA': /^\d{10}$/,199 |       'BR': /^\d{10,11}$/,200 |       'AR': /^\d{10,11}$/,201 |       'CL': /^\d{8,9}$/,202 |       'PE': /^\d{7,9}$/,203 |     };204 | 205 |     const validation = localValidations[countryCode];206 |     if (!validation) {207 | 208 |       return /^\d{7,15}$/.test(cleanNumber);209 |     }210 | 211 |     const isValid = validation.test(cleanNumber);212 | 213 |     - ${isValid ? 'VALID' : 'INVALID'}`);214 | 215 |     return isValid;216 |   }217 | 218 |   static formatPhoneNumber(phoneNumber: string, countryCode: string): string {219 |     const cleanNumber = phoneNumber.replace(/\D/g, '');220 | 221 |     const countryPrefixes: Record<string, string> = {222 |       'US': '1',223 |       'CO': '57',224 |       'MX': '52',225 |       'ES': '34',226 |       'CA': '1',227 |       'BR': '55',228 |       'AR': '54',229 |       'CL': '56',230 |       'PE': '51',231 |     };232 | 233 |     const prefix = countryPrefixes[countryCode];234 |     if (prefix && !cleanNumber.startsWith(prefix)) {235 |       return prefix + cleanNumber;236 |     }237 | 238 |     return cleanNumber;239 |   }240 | 241 |   static generateOtpCode(length: number = 6): string {242 |     const digits = '0123456789';243 |     let result = '';244 |     for (let i = 0; i < length; i++) {245 |       result += digits.charAt(Math.floor(Math.random() * digits.length));246 |     }247 |     return result;248 |   }249 | }250 | 251 | export const labsMobileSmsService = new LabsMobileSmsService();
============================================================END: frontend/lib/labsmobile-sms-service.ts============================================================


============================================================FILE: frontend/lib/middleware/performance.tsSIZE: 6.51 KB============================================================
  1 | import { NextRequest, NextResponse } from 'next/server';  2 |   3 | export class PerformanceMiddleware {  4 |   private static instance: PerformanceMiddleware;  5 |   private metrics = new Map<string, {  6 |     count: number;  7 |     totalTime: number;  8 |     avgTime: number;  9 |     lastAccessed: number; 10 |   }>(); 11 |  12 |   static getInstance(): PerformanceMiddleware { 13 |     if (!PerformanceMiddleware.instance) { 14 |       PerformanceMiddleware.instance = new PerformanceMiddleware(); 15 |     } 16 |     return PerformanceMiddleware.instance; 17 |   } 18 |  19 |   static async compressResponse(response: NextResponse): Promise<NextResponse> { 20 |     const acceptEncoding = response.headers.get('accept-encoding') || ''; 21 |  22 |     if (acceptEncoding.includes('gzip')) { 23 |       response.headers.set('content-encoding', 'gzip'); 24 |     } else if (acceptEncoding.includes('deflate')) { 25 |       response.headers.set('content-encoding', 'deflate'); 26 |     } 27 |  28 |     return response; 29 |   } 30 |  31 |   static setCacheHeaders(response: NextResponse, ttl: number = 300): NextResponse { 32 |     response.headers.set('cache-control', `public, max-age=${ttl}`); 33 |     response.headers.set('x-cache-ttl', ttl.toString()); 34 |     return response; 35 |   } 36 |  37 |   private static rateLimitStore = new Map<string, { count: number; resetTime: number }>(); 38 |  39 |   static checkRateLimit( 40 |     request: NextRequest, 41 |     limit: number = 100, 42 |     windowMs: number = 15 * 60 * 1000 43 |   ): { allowed: boolean; remaining: number; resetTime: number } { 44 |     const ip = request.headers.get('x-forwarded-for') || 45 |                request.headers.get('x-real-ip') || 46 |                'unknown'; 47 |  48 |     const key = `${ip}-${request.nextUrl.pathname}`; 49 |     const now = Date.now(); 50 |     const windowStart = Math.floor(now / windowMs) * windowMs; 51 |  52 |     const current = PerformanceMiddleware.rateLimitStore.get(key); 53 |  54 |     if (!current || current.resetTime < now) { 55 |  56 |       PerformanceMiddleware.rateLimitStore.set(key, { 57 |         count: 1, 58 |         resetTime: windowStart + windowMs 59 |       }); 60 |       return { allowed: true, remaining: limit - 1, resetTime: windowStart + windowMs }; 61 |     } 62 |  63 |     if (current.count >= limit) { 64 |       return { allowed: false, remaining: 0, resetTime: current.resetTime }; 65 |     } 66 |  67 |     current.count++; 68 |     PerformanceMiddleware.rateLimitStore.set(key, current); 69 |  70 |     return { 71 |       allowed: true, 72 |       remaining: limit - current.count, 73 |       resetTime: current.resetTime 74 |     }; 75 |   } 76 |  77 |   static async optimizeApiResponse( 78 |     request: NextRequest, 79 |     response: NextResponse, 80 |     options: { 81 |       cache?: boolean; 82 |       cacheTTL?: number; 83 |       compress?: boolean; 84 |       rateLimit?: boolean; 85 |       rateLimitMax?: number; 86 |     } = {} 87 |   ): Promise<NextResponse> { 88 |     const { 89 |       cache = false, 90 |       cacheTTL = 300, 91 |       compress = true, 92 |       rateLimit = false, 93 |       rateLimitMax = 100 94 |     } = options; 95 |  96 |     if (rateLimit) { 97 |       const rateLimitResult = PerformanceMiddleware.checkRateLimit(request, rateLimitMax); 98 |  99 |       if (!rateLimitResult.allowed) {100 |         return NextResponse.json(101 |           {102 |             success: false,103 |             error: 'Rate limit exceeded',104 |             retryAfter: Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000)105 |           },106 |           {107 |             status: 429,108 |             headers: {109 |               'x-ratelimit-remaining': rateLimitResult.remaining.toString(),110 |               'x-ratelimit-reset': rateLimitResult.resetTime.toString(),111 |               'retry-after': Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000).toString()112 |             }113 |           }114 |         );115 |       }116 | 117 |       response.headers.set('x-ratelimit-remaining', rateLimitResult.remaining.toString());118 |       response.headers.set('x-ratelimit-reset', rateLimitResult.resetTime.toString());119 |     }120 | 121 |     if (cache) {122 |       response = PerformanceMiddleware.setCacheHeaders(response, cacheTTL);123 |     }124 | 125 |     if (compress) {126 |       response = await PerformanceMiddleware.compressResponse(response);127 |     }128 | 129 |     response.headers.set('x-response-time', Date.now().toString());130 |     response.headers.set('x-powered-by', 'MATMAX-API');131 | 132 |     return response;133 |   }134 | 135 |   static recordApiCall(136 |     path: string,137 |     method: string,138 |     duration: number139 |   ): void {140 |     const key = `${method}:${path}`;141 |     const instance = PerformanceMiddleware.getInstance();142 | 143 |     const current = instance.metrics.get(key) || {144 |       count: 0,145 |       totalTime: 0,146 |       avgTime: 0,147 |       lastAccessed: Date.now()148 |     };149 | 150 |     current.count++;151 |     current.totalTime += duration;152 |     current.avgTime = current.totalTime / current.count;153 |     current.lastAccessed = Date.now();154 | 155 |     instance.metrics.set(key, current);156 | 157 |     if (duration > 1000) {158 |       }159 |   }160 | 161 |   static getMetrics(): Array<{162 |     path: string;163 |     method: string;164 |     count: number;165 |     avgTime: number;166 |     totalTime: number;167 |   }> {168 |     const instance = PerformanceMiddleware.getInstance();169 |     return Array.from(instance.metrics.entries()).map(([key, data]) => {170 |       const [method, path] = key.split(':');171 |       return {172 |         path,173 |         method,174 |         count: data.count,175 |         avgTime: Math.round(data.avgTime),176 |         totalTime: Math.round(data.totalTime)177 |       };178 |     });179 |   }180 | }181 | 182 | export function withApiOptimization(183 |   handler: (request: NextRequest) => Promise<NextResponse>,184 |   options: {185 |     cache?: boolean;186 |     cacheTTL?: number;187 |     compress?: boolean;188 |     rateLimit?: boolean;189 |     rateLimitMax?: number;190 |   } = {}191 | ) {192 |   return async (request: NextRequest): Promise<NextResponse> => {193 |     const startTime = Date.now();194 | 195 |     try {196 |       const response = await handler(request);197 | 198 |       const duration = Date.now() - startTime;199 |       PerformanceMiddleware.recordApiCall(200 |         request.nextUrl.pathname,201 |         request.method,202 |         duration203 |       );204 | 205 |       return await PerformanceMiddleware.optimizeApiResponse(request, response, options);206 | 207 |     } catch (error) {208 |       const duration = Date.now() - startTime;209 |       PerformanceMiddleware.recordApiCall(210 |         request.nextUrl.pathname,211 |         request.method,212 |         duration213 |       );214 | 215 |       return NextResponse.json(216 |         { success: false, error: 'Internal server error' },217 |         { status: 500 }218 |       );219 |     }220 |   };221 | }
============================================================END: frontend/lib/middleware/performance.ts============================================================


============================================================FILE: frontend/lib/performance.tsSIZE: 3.06 KB============================================================
  1 | export class PerformanceMonitor {  2 |   private static instance: PerformanceMonitor;  3 |   private metrics: Map<string, number[]> = new Map();  4 |   5 |   static getInstance(): PerformanceMonitor {  6 |     if (!PerformanceMonitor.instance) {  7 |       PerformanceMonitor.instance = new PerformanceMonitor();  8 |     }  9 |     return PerformanceMonitor.instance; 10 |   } 11 |  12 |   startTimer(label: string): () => void { 13 |     const startTime = Date.now(); 14 |     return () => { 15 |       const duration = Date.now() - startTime; 16 |       this.recordMetric(label, duration); 17 |     }; 18 |   } 19 |  20 |   recordMetric(label: string, duration: number): void { 21 |     if (!this.metrics.has(label)) { 22 |       this.metrics.set(label, []); 23 |     } 24 |     this.metrics.get(label)!.push(duration); 25 |  26 |     const measurements = this.metrics.get(label)!; 27 |     if (measurements.length > 100) { 28 |       measurements.shift(); 29 |     } 30 |   } 31 |  32 |   getMetrics(label: string): { 33 |     avg: number; 34 |     min: number; 35 |     max: number; 36 |     count: number; 37 |     last: number; 38 |   } | null { 39 |     const measurements = this.metrics.get(label); 40 |     if (!measurements || measurements.length === 0) { 41 |       return null; 42 |     } 43 |  44 |     const sum = measurements.reduce((a, b) => a + b, 0); 45 |     return { 46 |       avg: Math.round(sum / measurements.length), 47 |       min: Math.min(...measurements), 48 |       max: Math.max(...measurements), 49 |       count: measurements.length, 50 |       last: measurements[measurements.length - 1] 51 |     }; 52 |   } 53 |  54 |   getAllMetrics(): Record<string, unknown> { 55 |     const result: Record<string, unknown> = {}; 56 |     for (const [label] of this.metrics.entries()) { 57 |       result[label] = this.getMetrics(label); 58 |     } 59 |     return result; 60 |   } 61 |  62 |   clearMetrics(label?: string): void { 63 |     if (label) { 64 |       this.metrics.delete(label); 65 |     } else { 66 |       this.metrics.clear(); 67 |     } 68 |   } 69 | } 70 |  71 | export const performanceMonitor = PerformanceMonitor.getInstance(); 72 |  73 | export function withPerformanceMonitoring<T extends unknown[]>( 74 |   fn: (...args: T) => Promise<unknown>, 75 |   label: string 76 | ) { 77 |   return async (...args: T) => { 78 |     const endTimer = performanceMonitor.startTimer(label); 79 |     try { 80 |       const result = await fn(...args); 81 |       endTimer(); 82 |       return result; 83 |     } catch (error) { 84 |       endTimer(); 85 |       throw error; 86 |     } 87 |   }; 88 | } 89 |  90 | export class CacheMetrics { 91 |   private static instance: CacheMetrics; 92 |   private hits = 0; 93 |   private misses = 0; 94 |  95 |   static getInstance(): CacheMetrics { 96 |     if (!CacheMetrics.instance) { 97 |       CacheMetrics.instance = new CacheMetrics(); 98 |     } 99 |     return CacheMetrics.instance;100 |   }101 | 102 |   recordHit(): void {103 |     this.hits++;104 |   }105 | 106 |   recordMiss(): void {107 |     this.misses++;108 |   }109 | 110 |   getStats(): { hits: number; misses: number; hitRate: number; total: number } {111 |     const total = this.hits + this.misses;112 |     return {113 |       hits: this.hits,114 |       misses: this.misses,115 |       hitRate: total > 0 ? (this.hits / total) * 100 : 0,116 |       total117 |     };118 |   }119 | 120 |   reset(): void {121 |     this.hits = 0;122 |     this.misses = 0;123 |   }124 | }125 | 126 | export const cacheMetrics = CacheMetrics.getInstance();
============================================================END: frontend/lib/performance.ts============================================================


============================================================FILE: frontend/lib/prisma.tsSIZE: 0.83 KB============================================================
  1 | import { PrismaClient } from '@prisma/client';  2 |   3 | const globalForPrisma = globalThis as unknown as {  4 |   prisma: PrismaClient | undefined;  5 | };  6 |   7 | export const prisma = globalForPrisma.prisma ?? new PrismaClient({  8 |   datasources: {  9 |     db: { 10 |       url: process.env.DATABASE_URL || "postgresql: 11 |     }, 12 |   }, 13 |  14 |   log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn', 'info'] : ['error'], 15 |   errorFormat: 'pretty', 16 | }); 17 |  18 | if (process.env.NODE_ENV !== 'production') { 19 |   globalForPrisma.prisma = prisma; 20 | } 21 |  22 | prisma.$connect().catch((error) => { 23 |   }); 24 |  25 | export default prisma;
============================================================END: frontend/lib/prisma.ts============================================================


============================================================FILE: frontend/lib/redis.tsSIZE: 5.05 KB============================================================
  1 | import { createClient, RedisClientType } from 'redis';  2 |   3 | class RedisManager {  4 |   private static instance: RedisManager;  5 |   private client: RedisClientType | null = null;  6 |   private isConnected = false;  7 |   8 |   private constructor() {}  9 |  10 |   static getInstance(): RedisManager { 11 |     if (!RedisManager.instance) { 12 |       RedisManager.instance = new RedisManager(); 13 |     } 14 |     return RedisManager.instance; 15 |   } 16 |  17 |   async connect(): Promise<RedisClientType> { 18 |     if (this.client && this.isConnected) { 19 |       return this.client; 20 |     } 21 |  22 |     try { 23 |  24 |       const redisUrl = process.env.REDIS_URL || process.env.REDISCLOUD_URL; 25 |  26 |       this.client = createClient({ 27 |         url: redisUrl || 'redis: 28 |         socket: { 29 |           connectTimeout: 60000, 30 |         } 31 |       }); 32 |  33 |       this.client.on('error', (err) => { 34 |         this.isConnected = false; 35 |       }); 36 |  37 |       this.client.on('connect', () => { 38 |         this.isConnected = true; 39 |       }); 40 |  41 |       this.client.on('disconnect', () => { 42 |         this.isConnected = false; 43 |       }); 44 |  45 |       await this.client.connect(); 46 |       return this.client; 47 |  48 |     } catch (error) { 49 |  50 |       throw error; 51 |     } 52 |   } 53 |  54 |   async disconnect(): Promise<void> { 55 |     if (this.client && this.isConnected) { 56 |       await this.client.disconnect(); 57 |       this.isConnected = false; 58 |     } 59 |   } 60 |  61 |   getClient(): RedisClientType | null { 62 |     return this.client; 63 |   } 64 |  65 |   isRedisConnected(): boolean { 66 |     return this.isConnected; 67 |   } 68 |  69 |   async set(key: string, value: string, ttl?: number): Promise<string | null> { 70 |     try { 71 |       if (!this.client || !this.isConnected) { 72 |         throw new Error('Redis client not connected'); 73 |       } 74 |  75 |       if (ttl) { 76 |         return await this.client.setEx(key, ttl, value); 77 |       } else { 78 |         return await this.client.set(key, value); 79 |       } 80 |     } catch (error) { 81 |       throw error; 82 |     } 83 |   } 84 |  85 |   async get(key: string): Promise<string | null> { 86 |     try { 87 |       if (!this.client || !this.isConnected) { 88 |         throw new Error('Redis client not connected'); 89 |       } 90 |  91 |       return await this.client.get(key); 92 |     } catch (error) { 93 |       throw error; 94 |     } 95 |   } 96 |  97 |   async del(key: string): Promise<number> { 98 |     try { 99 |       if (!this.client || !this.isConnected) {100 |         throw new Error('Redis client not connected');101 |       }102 | 103 |       return await this.client.del(key);104 |     } catch (error) {105 |       throw error;106 |     }107 |   }108 | 109 |   async exists(key: string): Promise<number> {110 |     try {111 |       if (!this.client || !this.isConnected) {112 |         throw new Error('Redis client not connected');113 |       }114 | 115 |       return await this.client.exists(key);116 |     } catch (error) {117 |       throw error;118 |     }119 |   }120 | 121 |   async expire(key: string, ttl: number): Promise<number> {122 |     try {123 |       if (!this.client || !this.isConnected) {124 |         throw new Error('Redis client not connected');125 |       }126 | 127 |       return await this.client.expire(key, ttl);128 |     } catch (error) {129 |       throw error;130 |     }131 |   }132 | 133 |   async ttl(key: string): Promise<number> {134 |     try {135 |       if (!this.client || !this.isConnected) {136 |         throw new Error('Redis client not connected');137 |       }138 | 139 |       return await this.client.ttl(key);140 |     } catch (error) {141 |       throw error;142 |     }143 |   }144 | }145 | 146 | export const redisManager = RedisManager.getInstance();147 | 148 | export async function initRedis(): Promise<RedisClientType | null> {149 |   try {150 |     return await redisManager.connect();151 |     } catch {152 |     return null;153 |   }154 | }155 | 156 | export async function closeRedis(): Promise<void> {157 |   await redisManager.disconnect();158 | }159 | 160 | export class RedisMonitor {161 |   private static operations = new Map<string, { count: number; totalTime: number }>();162 | 163 |   static recordOperation(operation: string, duration: number): void {164 |     const current = RedisMonitor.operations.get(operation) || { count: 0, totalTime: 0 };165 |     current.count++;166 |     current.totalTime += duration;167 |     RedisMonitor.operations.set(operation, current);168 |   }169 | 170 |   static getStats(): Array<{ operation: string; count: number; avgTime: number }> {171 |     return Array.from(RedisMonitor.operations.entries()).map(([operation, data]) => ({172 |       operation,173 |       count: data.count,174 |       avgTime: Math.round(data.totalTime / data.count)175 |     }));176 |   }177 | }
============================================================END: frontend/lib/redis.ts============================================================


============================================================FILE: frontend/lib/services/api-service.tsSIZE: 11.68 KB============================================================
  1 | import axios, { AxiosResponse } from 'axios';  2 | import { APICallResult, IntentActionMapping, OrchestratorConfig } from '@/lib/types/conversational-orchestrator';  3 |   4 | export class APIService {  5 |   private config: OrchestratorConfig['apis'];  6 |   private baseUrl: string;  7 |   private intentActionMapping: IntentActionMapping;  8 |   9 |   constructor(config: OrchestratorConfig['apis'], intentActionMapping: IntentActionMapping) { 10 |     this.config = config; 11 |     this.baseUrl = config.baseUrl; 12 |     this.intentActionMapping = intentActionMapping; 13 |   } 14 |  15 |   async executeAction( 16 |     intent: string, 17 |     entities: Record<string, unknown> 18 |   ): Promise<APICallResult[]> { 19 |     const actionConfig = this.intentActionMapping[intent]; 20 |  21 |     if (!actionConfig) { 22 |       return [{ 23 |         success: false, 24 |         error: `No action mapping found for intent: ${intent}`, 25 |         statusCode: 404 26 |       }]; 27 |     } 28 |  29 |     const results: APICallResult[] = []; 30 |  31 |     try { 32 |  33 |       if (actionConfig.requiredEntities) { 34 |         const missingEntities = actionConfig.requiredEntities.filter( 35 |           entity => !entities[entity] 36 |         ); 37 |  38 |         if (missingEntities.length > 0) { 39 |           return [{ 40 |             success: false, 41 |             error: `Missing required entities: ${missingEntities.join(', ')}`, 42 |             statusCode: 400 43 |           }]; 44 |         } 45 |       } 46 |  47 |       switch (actionConfig.action) { 48 |         case 'consultar_estado': 49 |           results.push(await this.consultarEstado(entities)); 50 |           break; 51 |         case 'agendar_cita': 52 |           results.push(await this.agendarCita(entities)); 53 |           break; 54 |         case 'consultar_paquetes': 55 |           results.push(await this.consultarPaquetes(entities)); 56 |           break; 57 |         case 'pagar_servicio': 58 |           results.push(await this.pagarServicio(entities)); 59 |           break; 60 |         case 'cancelar_cita': 61 |           results.push(await this.cancelarCita(entities)); 62 |           break; 63 |         case 'consultar_historial': 64 |           results.push(await this.consultarHistorial(entities)); 65 |           break; 66 |         case 'consultar_horarios': 67 |           results.push(await this.consultarHorarios(entities)); 68 |           break; 69 |         case 'actualizar_perfil': 70 |           results.push(await this.actualizarPerfil(entities)); 71 |           break; 72 |         default: 73 |           results.push({ 74 |             success: false, 75 |             error: `Unknown action: ${actionConfig.action}`, 76 |             statusCode: 400 77 |           }); 78 |       } 79 |  80 |       return results; 81 |     } catch (error) { 82 |       return [{ 83 |         success: false, 84 |         error: error instanceof Error ? error.message : 'Unknown error', 85 |         statusCode: 500 86 |       }]; 87 |     } 88 |   } 89 |  90 |   private async consultarEstado(entities: Record<string, unknown>): Promise<APICallResult> { 91 |     try { 92 |       const { solicitud_id, cita_id, email } = entities; 93 |  94 |       let endpoint = ''; 95 |       const params: Record<string, unknown> = {}; 96 |  97 |       if (solicitud_id) { 98 |         endpoint = '/admin/bookings'; 99 |         params.id = solicitud_id;100 |       } else if (cita_id) {101 |         endpoint = '/client/bookings';102 |         params.id = cita_id;103 |       } else if (email) {104 |         endpoint = '/client/my-bookings';105 |         params.email = email;106 |       } else {107 |         return {108 |           success: false,109 |           error: 'No se especificó ID de solicitud, cita o email',110 |           statusCode: 400111 |         };112 |       }113 | 114 |       const response = await this.makeAPICall('GET', endpoint, params);115 |       return response;116 |     } catch (error) {117 |       return {118 |         success: false,119 |         error: error instanceof Error ? error.message : 'Error consultando estado',120 |         statusCode: 500121 |       };122 |     }123 |   }124 | 125 |   private async agendarCita(entities: Record<string, unknown>): Promise<APICallResult> {126 |     try {127 |       const { fecha, hora, tipo_sesion, paquete_id, email } = entities;128 | 129 |       if (!fecha || !hora || !email) {130 |         return {131 |           success: false,132 |           error: 'Faltan datos requeridos: fecha, hora o email',133 |           statusCode: 400134 |         };135 |       }136 | 137 |       const bookingData = {138 |         clientEmail: email,139 |         userPackageId: paquete_id || null,140 |         sessionDate: fecha,141 |         sessionTime: hora,142 |         sessionType: tipo_sesion || 'individual',143 |         groupSize: entities.tamaño_grupo || 1,144 |         notes: entities.notas || ''145 |       };146 | 147 |       const response = await this.makeAPICall('POST', '/booking', bookingData);148 |       return response;149 |     } catch (error) {150 |       return {151 |         success: false,152 |         error: error instanceof Error ? error.message : 'Error agendando cita',153 |         statusCode: 500154 |       };155 |     }156 |   }157 | 158 |   private async consultarPaquetes(entities: Record<string, unknown>): Promise<APICallResult> {159 |     try {160 |       const { tipo_paquete, moneda, duración } = entities;161 | 162 |       const params: Record<string, unknown> = {};163 |       if (tipo_paquete) params.packageType = tipo_paquete;164 |       if (moneda) params.currency = moneda;165 |       if (duración) params.duration = duración;166 | 167 |       const response = await this.makeAPICall('GET', '/packages', params);168 |       return response;169 |     } catch (error) {170 |       return {171 |         success: false,172 |         error: error instanceof Error ? error.message : 'Error consultando paquetes',173 |         statusCode: 500174 |       };175 |     }176 |   }177 | 178 |   private async pagarServicio(entities: Record<string, unknown>): Promise<APICallResult> {179 |     try {180 |       const { monto, método_pago, cita_id, paquete_id, email } = entities;181 | 182 |       if (!monto || !método_pago || !email) {183 |         return {184 |           success: false,185 |           error: 'Faltan datos requeridos: monto, método de pago o email',186 |           statusCode: 400187 |         };188 |       }189 | 190 |       const paymentData = {191 |         clientEmail: email,192 |         amount: parseFloat(String(monto)),193 |         currencyCode: entities.moneda || 'USD',194 |         paymentMethod: método_pago,195 |         userPackageId: paquete_id || null,196 |         groupBookingId: cita_id || null,197 |         notes: entities.notas || ''198 |       };199 | 200 |       const response = await this.makeAPICall('POST', '/client/purchase', paymentData);201 |       return response;202 |     } catch (error) {203 |       return {204 |         success: false,205 |         error: error instanceof Error ? error.message : 'Error procesando pago',206 |         statusCode: 500207 |       };208 |     }209 |   }210 | 211 |   private async cancelarCita(entities: Record<string, unknown>): Promise<APICallResult> {212 |     try {213 |       const { cita_id, email } = entities;214 | 215 |       if (!cita_id || !email) {216 |         return {217 |           success: false,218 |           error: 'Faltan datos requeridos: ID de cita o email',219 |           statusCode: 400220 |         };221 |       }222 | 223 |       const updateData = {224 |         status: 'cancelled',225 |         notes: entities.motivo || 'Cancelada por el usuario'226 |       };227 | 228 |       const response = await this.makeAPICall('PUT', `/client/bookings/${cita_id}`, updateData);229 |       return response;230 |     } catch (error) {231 |       return {232 |         success: false,233 |         error: error instanceof Error ? error.message : 'Error cancelando cita',234 |         statusCode: 500235 |       };236 |     }237 |   }238 | 239 |   private async consultarHistorial(entities: Record<string, unknown>): Promise<APICallResult> {240 |     try {241 |       const { email, tipo_historial, fecha_desde, fecha_hasta } = entities;242 | 243 |       if (!email) {244 |         return {245 |           success: false,246 |           error: 'Email requerido para consultar historial',247 |           statusCode: 400248 |         };249 |       }250 | 251 |       const params: Record<string, unknown> = { email };252 |       if (tipo_historial) params.type = tipo_historial;253 |       if (fecha_desde) params.dateFrom = fecha_desde;254 |       if (fecha_hasta) params.dateTo = fecha_hasta;255 | 256 |       const response = await this.makeAPICall('GET', '/client/purchase-history', params);257 |       return response;258 |     } catch (error) {259 |       return {260 |         success: false,261 |         error: error instanceof Error ? error.message : 'Error consultando historial',262 |         statusCode: 500263 |       };264 |     }265 |   }266 | 267 |   private async consultarHorarios(entities: Record<string, unknown>): Promise<APICallResult> {268 |     try {269 |       const { fecha, duración, tipo_sesion } = entities;270 | 271 |       const params: Record<string, unknown> = {};272 |       if (fecha) params.date = fecha;273 |       if (duración) params.duration = duración;274 |       if (tipo_sesion) params.sessionType = tipo_sesion;275 | 276 |       const response = await this.makeAPICall('GET', '/schedule-slots', params);277 |       return response;278 |     } catch (error) {279 |       return {280 |         success: false,281 |         error: error instanceof Error ? error.message : 'Error consultando horarios',282 |         statusCode: 500283 |       };284 |     }285 |   }286 | 287 |   private async actualizarPerfil(entities: Record<string, unknown>): Promise<APICallResult> {288 |     try {289 |       const { email, nombre, teléfono, fecha_nacimiento, lugar_nacimiento } = entities;290 | 291 |       if (!email) {292 |         return {293 |           success: false,294 |           error: 'Email requerido para actualizar perfil',295 |           statusCode: 400296 |         };297 |       }298 | 299 |       const updateData: Record<string, unknown> = {};300 |       if (nombre) updateData.name = nombre;301 |       if (teléfono) updateData.phone = teléfono;302 |       if (fecha_nacimiento) updateData.birthDate = fecha_nacimiento;303 |       if (lugar_nacimiento) updateData.birthPlace = lugar_nacimiento;304 | 305 |       const response = await this.makeAPICall('PUT', '/client/me', updateData);306 |       return response;307 |     } catch (error) {308 |       return {309 |         success: false,310 |         error: error instanceof Error ? error.message : 'Error actualizando perfil',311 |         statusCode: 500312 |       };313 |     }314 |   }315 | 316 |   private async makeAPICall(317 |     method: 'GET' | 'POST' | 'PUT' | 'DELETE',318 |     endpoint: string,319 |     data?: Record<string, unknown>,320 |     retries: number = 0321 |   ): Promise<APICallResult> {322 |     try {323 |       const url = `${this.baseUrl}${endpoint}`;324 |       const config: Record<string, unknown> = {325 |         method,326 |         url,327 |         timeout: this.config.timeout,328 |         headers: {329 |           'Content-Type': 'application/json',330 |           'Accept': 'application/json'331 |         }332 |       };333 | 334 |       if (data && (method === 'POST' || method === 'PUT')) {335 |         config.data = data;336 |       } else if (data && method === 'GET') {337 |         config.params = data;338 |       }339 | 340 |       const response: AxiosResponse = await axios(config);341 | 342 |       return {343 |         success: true,344 |         data: response.data,345 |         statusCode: response.status346 |       };347 |     } catch (error) {348 |       if (retries < this.config.retries) {349 |         `);350 |         await this.delay(1000 * (retries + 1));351 |         return this.makeAPICall(method, endpoint, data, retries + 1);352 |       }353 | 354 |       return {355 |         success: false,356 |         error: error instanceof Error ? error.message : 'Unknown API error',357 |         statusCode: (error as { response?: { status?: number } }).response?.status || 500358 |       };359 |     }360 |   }361 | 362 |   private delay(ms: number): Promise<void> {363 |     return new Promise(resolve => setTimeout(resolve, ms));364 |   }365 | 366 |   async healthCheck(): Promise<boolean> {367 |     try {368 |       const response = await this.makeAPICall('GET', '/health');369 |       return response.success;370 |     } catch (error) {371 |       return false;372 |     }373 |   }374 | }
============================================================END: frontend/lib/services/api-service.ts============================================================


============================================================FILE: frontend/lib/services/conversational-orchestrator.tsSIZE: 18.32 KB============================================================
  1 | import { RasaService } from './rasa-service';  2 | import { OpenRouterService } from './openrouter-service';  3 | import { TwilioService } from './twilio-service';  4 | import { APIService } from './api-service';  5 | import { LoggingService } from './logging-service';  6 | import {  7 |   RasaResponse,  8 |   ConversationContext,  9 |   OrchestratorConfig, 10 |   IntentActionMapping, 11 |   OrchestratorResponse, 12 |   ErrorResponse, 13 |   SuccessResponse, 14 |   APICallResult 15 | } from '@/lib/types/conversational-orchestrator'; 16 |  17 | export class ConversationalOrchestrator { 18 |   private rasaService: RasaService; 19 |   private openRouterService: OpenRouterService; 20 |   private twilioService: TwilioService; 21 |   private apiService: APIService; 22 |   private loggingService: LoggingService; 23 |   private config: OrchestratorConfig; 24 |   private intentActionMapping: IntentActionMapping; 25 |   private conversationContexts: Map<string, ConversationContext> = new Map(); 26 |  27 |   constructor(config: OrchestratorConfig, intentActionMapping: IntentActionMapping) { 28 |     this.config = config; 29 |     this.intentActionMapping = intentActionMapping; 30 |  31 |     this.rasaService = new RasaService(config.rasa); 32 |     this.openRouterService = new OpenRouterService(config.openrouter.apiKey); 33 |     this.twilioService = new TwilioService(config.twilio); 34 |     this.apiService = new APIService(config.apis, intentActionMapping); 35 |     this.loggingService = new LoggingService(config.logging); 36 |   } 37 |  38 |   async processMessage(text: string, context: ConversationContext): Promise<OrchestratorResponse> { 39 |     const startTime = Date.now(); 40 |     let logId: string | undefined; 41 |  42 |     try { 43 |  44 |       const conversationContext = this.getOrCreateConversationContext(context.userId, context.sessionId); 45 |  46 |       const rasaResponse = await this.rasaService.parseMessage(text, context.userId); 47 |  48 |       if (!rasaResponse || !rasaResponse.intent) { 49 |         return this.createErrorResponse('RASA_ERROR', 'Failed to get intent from Rasa'); 50 |       } 51 |  52 |       const intent = rasaResponse.intent.name; 53 |       const confidence = rasaResponse.intent.confidence; 54 |  55 |       if (confidence < this.config.rasa.confidence_threshold) { 56 |         let clarificationResponse: string; 57 |         try { 58 |           clarificationResponse = await this.openRouterService.generateContextualResponse( 59 |             text, 60 |             'low_confidence', 61 |             {}, 62 |             {}, 63 |             [] 64 |           ); 65 |         } catch { 66 |  67 |           clarificationResponse = "I'm not sure I understand. Could you please rephrase your question? I'm here to help with MatMax Yoga Studio!"; 68 |         } 69 |  70 |         return this.createSuccessResponse({ 71 |           text: clarificationResponse, 72 |           intent: 'low_confidence', 73 |           confidence: confidence, 74 |           entities: rasaResponse.entities || [] 75 |         }); 76 |       } 77 |  78 |       const actionMapping = this.intentActionMapping[intent]; 79 |       if (!actionMapping) { 80 |  81 |         let generalResponse: string; 82 |         try { 83 |           generalResponse = await this.openRouterService.generateContextualResponse( 84 |             text, 85 |             intent, 86 |             this.convertEntitiesToRecord(rasaResponse.entities || []), 87 |             {}, 88 |             [] 89 |           ); 90 |         } catch { 91 |  92 |           generalResponse = this.getFallbackResponse(intent); 93 |         } 94 |  95 |         return this.createSuccessResponse({ 96 |           text: generalResponse, 97 |           intent: intent, 98 |           confidence: confidence, 99 |           entities: rasaResponse.entities || []100 |         });101 |       }102 | 103 |       let actionResult: APICallResult[] | null = null;104 |       if (actionMapping.apiEndpoint) {105 |         actionResult = await this.apiService.executeAction(actionMapping.action, this.convertEntitiesToRecord(rasaResponse.entities || []));106 |       }107 | 108 |       let finalResponse: string;109 |       if (actionMapping.description) {110 |         finalResponse = actionMapping.description;111 |         if (actionResult) {112 |           finalResponse += `\n\n${JSON.stringify(actionResult, null, 2)}`;113 |         }114 |       } else {115 |         try {116 |           finalResponse = await this.openRouterService.generateContextualResponse(117 |             text,118 |             intent,119 |             this.convertEntitiesToRecord(rasaResponse.entities || []),120 |             {},121 |             []122 |           );123 |         } catch {124 | 125 |           finalResponse = this.getFallbackResponse(intent);126 |         }127 |       }128 | 129 |       this.updateConversationContext(conversationContext, text, finalResponse, intent, this.convertEntitiesToRecord(rasaResponse.entities || []));130 | 131 |       if (this.config.logging.enabled) {132 |         logId = await this.loggingService.logConversation({133 |           sessionId: context.sessionId,134 |           userId: context.userId,135 |           message: text,136 |           userMessage: text,137 |           botResponse: finalResponse,138 |           rasaIntent: intent,139 |           rasaConfidence: rasaResponse.intent?.confidence || 0.5,140 |           rasaEntities: rasaResponse.entities || [],141 |           responseGenerator: actionMapping?.action || 'none',142 |           bookingStep: null,143 |           bookingDataSnapshot: null,144 |           modelVersion: '1.0.0',145 |           llmResponse: finalResponse,146 |           rasaResponse: JSON.stringify(rasaResponse),147 |           intent: intent,148 |           entities: rasaResponse.entities || [],149 |           action: actionMapping?.action || 'none',150 |           apiCalls: actionResult ? actionResult.map(result => ({151 |             success: result.success,152 |             data: result.data,153 |             error: result.error,154 |             statusCode: result.statusCode155 |           })) : [],156 |           processingTime: Date.now() - startTime,157 |           success: true158 |         });159 |       }160 | 161 |       return this.createSuccessResponse({162 |         text: finalResponse,163 |         intent: intent,164 |         confidence: confidence,165 |         entities: rasaResponse.entities || [],166 |         action: actionMapping.action,167 |         actionResult: actionResult,168 |         logId: logId169 |       });170 | 171 |     } catch (error) {172 | 173 |       if (this.config.logging.enabled) {174 |         await this.loggingService.logError(175 |           context.userId,176 |           error instanceof Error ? error.message : 'Unknown error',177 |           {178 |             message: text,179 |             intent: 'error',180 |             action: 'error_handling'181 |           }182 |         );183 |       }184 | 185 |       return this.createErrorResponse('PROCESSING_ERROR', 'An error occurred while processing your message');186 |     }187 |   }188 | 189 |   async processWhatsAppMessage(webhookBody: Record<string, unknown>, signature?: string): Promise<OrchestratorResponse> {190 |     const startTime = Date.now();191 |     let logId: string | undefined;192 | 193 |     try {194 | 195 |       const whatsappMessage = this.twilioService.parseWebhook(webhookBody);196 |       if (!whatsappMessage) {197 |         return this.createErrorResponse('INVALID_WEBHOOK', 'Invalid WhatsApp webhook data');198 |       }199 | 200 |       if (signature && !this.twilioService.validateWebhook(signature, this.config.twilio.webhookUrl, webhookBody)) {201 |         return this.createErrorResponse('INVALID_SIGNATURE', 'Invalid Twilio signature');202 |       }203 | 204 |       const userId = whatsappMessage.from;205 |       const userMessage = whatsappMessage.body;206 | 207 |       const context = this.getOrCreateConversationContext(userId, whatsappMessage.messageId);208 | 209 |       await this.twilioService.sendDeliveryConfirmation(userId);210 | 211 |       const rasaResponse = await this.rasaService.parseMessage(userMessage, userId);212 | 213 |       if (!this.rasaService.isIntentConfident(rasaResponse.intent)) {214 | 215 |         const clarificationResponse = await this.handleAmbiguousIntent(216 |           userMessage,217 |           rasaResponse218 |         );219 | 220 |         await this.twilioService.sendMessage(userId, clarificationResponse);221 | 222 |         return this.createSuccessResponse({223 |           message: 'Clarification requested',224 |           response: clarificationResponse225 |         });226 |       }227 | 228 |       const entities = this.extractEntities(rasaResponse.entities);229 |       const intent = rasaResponse.intent.name;230 | 231 |       const apiResults = await this.apiService.executeAction(intent, entities);232 | 233 |       const llmResponse = await this.generateLLMResponse(234 |         userMessage,235 |         intent,236 |         entities,237 |         apiResults,238 |         context239 |       );240 | 241 |       const sendResult = await this.twilioService.sendMessage(userId, llmResponse);242 | 243 |       if (!sendResult.success) {244 |         throw new Error(`Failed to send message: ${sendResult.error}`);245 |       }246 | 247 |       this.updateConversationContext(context, userMessage, llmResponse, intent, this.convertEntitiesToRecord(Array.isArray(entities) ? entities : []));248 | 249 |       const processingTime = Date.now() - startTime;250 |       logId = await this.loggingService.logConversation({251 |         sessionId: context.sessionId,252 |         userId,253 |         message: userMessage,254 |         userMessage: userMessage,255 |         botResponse: llmResponse,256 |         rasaIntent: intent,257 |         rasaConfidence: rasaResponse.intent?.confidence || 0.5,258 |         rasaEntities: rasaResponse.entities || [],259 |         responseGenerator: this.intentActionMapping[intent]?.action || 'unknown',260 |         bookingStep: null,261 |         bookingDataSnapshot: null,262 |         modelVersion: '1.0.0',263 |         llmResponse,264 |         rasaResponse: JSON.stringify(rasaResponse),265 |         intent,266 |         entities: rasaResponse.entities || [],267 |         action: this.intentActionMapping[intent]?.action || 'unknown',268 |         apiCalls: apiResults.map(result => ({269 |           success: result.success,270 |           data: result.data,271 |           error: result.error,272 |           statusCode: result.statusCode273 |         })),274 |         processingTime,275 |         success: true276 |       });277 | 278 |       return this.createSuccessResponse({279 |         message: 'Message processed successfully',280 |         response: llmResponse,281 |         logId,282 |         processingTime283 |       });284 | 285 |     } catch (error) {286 |       const processingTime = Date.now() - startTime;287 |       const errorMessage = error instanceof Error ? error.message : 'Unknown error';288 | 289 |       try {290 |         const whatsappMessage = this.twilioService.parseWebhook(webhookBody);291 |         if (whatsappMessage) {292 |           await this.twilioService.sendErrorMessage(whatsappMessage.from, 'technical');293 |         }294 |       } catch (sendError) {295 |         }296 | 297 |       try {298 |         const whatsappMessage = this.twilioService.parseWebhook(webhookBody);299 |         if (whatsappMessage) {300 |           logId = await this.loggingService.logError(whatsappMessage.from, errorMessage, {301 |             message: whatsappMessage.body302 |           });303 |         }304 |       } catch (logError) {305 |         }306 | 307 |       return this.createErrorResponse('PROCESSING_ERROR', errorMessage, { logId, processingTime });308 |     }309 |   }310 | 311 |   private async handleAmbiguousIntent(312 |     userMessage: string,313 |     rasaResponse: RasaResponse314 |   ): Promise<string> {315 |     const alternativeIntents = this.rasaService.getAlternativeIntents(rasaResponse);316 | 317 |     return await this.openRouterService.generateClarificationResponse(318 |       userMessage,319 |       alternativeIntents,320 |       this.extractEntities(rasaResponse.entities)321 |     );322 |   }323 | 324 |   private async generateLLMResponse(325 |     userMessage: string,326 |     intent: string,327 |     entities: Record<string, unknown>,328 |     apiResults: APICallResult[],329 |     context: ConversationContext330 |   ): Promise<string> {331 |     try {332 | 333 |       const apiData = apiResults334 |         .filter(result => result.success && result.data)335 |         .map(result => result.data)336 |         .filter((data): data is Record<string, unknown> => data != null && typeof data === 'object')337 |         .reduce((acc, data) => ({ ...acc, ...data }), {} as Record<string, unknown>);338 | 339 |       return await this.openRouterService.generateContextualResponse(340 |         userMessage,341 |         intent,342 |         entities,343 |         apiData as Record<string, unknown>,344 |         context.conversationHistory.map(msg => ({345 |           role: msg.role,346 |           content: msg.message,347 |           timestamp: msg.timestamp348 |         }))349 |       );350 |     } catch (error) {351 |       return await this.openRouterService.generateErrorResponse(352 |         error instanceof Error ? error.message : 'Unknown error',353 |         userMessage,354 |         intent355 |       );356 |     }357 |   }358 | 359 |   private extractEntities(entities: RasaResponse['entities']): Record<string, unknown> {360 |     const extracted: Record<string, unknown> = {};361 | 362 |     entities.forEach(entity => {363 |       if (entity.confidence >= 0.7) {364 |         extracted[entity.entity] = entity.value;365 |       }366 |     });367 | 368 |     return extracted;369 |   }370 | 371 |   private getOrCreateConversationContext(userId: string, sessionId: string): ConversationContext {372 |     if (!this.conversationContexts.has(userId)) {373 |       this.conversationContexts.set(userId, {374 |         userId,375 |         sessionId,376 |         conversationHistory: []377 |       });378 |     }379 | 380 |     return this.conversationContexts.get(userId)!;381 |   }382 | 383 |   private convertEntitiesToRecord(entities: unknown[]): Record<string, unknown> {384 |     const result: Record<string, unknown> = {};385 |     entities.forEach(entity => {386 |       if (entity && typeof entity === 'object' && entity !== null && 'entity' in entity && 'value' in entity) {387 |         const entityObj = entity as Record<string, unknown>;388 |         result[String(entityObj.entity)] = entityObj.value;389 |       }390 |     });391 |     return result;392 |   }393 | 394 |   private updateConversationContext(395 |     context: ConversationContext,396 |     userMessage: string,397 |     assistantResponse: string,398 |     intent: string,399 |     entities: Record<string, unknown>400 |   ): void {401 | 402 |     context.conversationHistory.push({403 |       role: 'user',404 |       message: userMessage,405 |       timestamp: new Date().toISOString()406 |     });407 | 408 |     context.conversationHistory.push({409 |       role: 'assistant',410 |       message: assistantResponse,411 |       timestamp: new Date().toISOString()412 |     });413 | 414 |     context.lastIntent = intent;415 |     context.lastEntities = entities;416 | 417 |     if (context.conversationHistory.length > 20) {418 |       context.conversationHistory = context.conversationHistory.slice(-20);419 |     }420 |   }421 | 422 |   private createErrorResponse(code: string, message: string, details?: unknown): ErrorResponse {423 |     return {424 |       success: false,425 |       error: message,426 |       code,427 |       details428 |     };429 |   }430 | 431 |   private createSuccessResponse(data: unknown): SuccessResponse {432 |     return {433 |       success: true,434 |       data435 |     };436 |   }437 | 438 |   private getFallbackResponse(intent: string): string {439 |     const fallbackResponses: Record<string, string> = {440 |       'greet': '¡Hola! ¿En qué puedo ayudarte?',441 |       'goodbye': '¡Hasta luego! 🌟',442 |       'book_session': 'Para reservar una sesión, contacta con nosotros. ¿Te interesa algún paquete?',443 |       'ask_packages': 'Tenemos varios paquetes. ¿Cuál te interesa?',444 |       'ask_pricing': 'Los precios varían. ¿Qué servicio necesitas?',445 |       'ask_availability': '¿Cuál es tu horario preferido?',446 |       'thank_you': '¡De nada! 😊',447 |       'default': '¿En qué puedo ayudarte?'448 |     };449 | 450 |     return fallbackResponses[intent] || fallbackResponses['default'];451 |   }452 | 453 |   async healthCheck(): Promise<{454 |     overall: boolean;455 |     services: {456 |       rasa: boolean;457 |       openrouter: boolean;458 |       twilio: boolean;459 |       api: boolean;460 |       logging: boolean;461 |     };462 |   }> {463 |     const [rasa, openrouter, twilio, api] = await Promise.all([464 |       this.rasaService.healthCheck(),465 |       this.openRouterService.healthCheck(),466 |       this.twilioService.healthCheck(),467 |       this.apiService.healthCheck()468 |     ]);469 | 470 |     const logging = this.config.logging.enabled;471 | 472 |     return {473 |       overall: rasa && openrouter && twilio && api && logging,474 |       services: {475 |         rasa,476 |         openrouter,477 |         twilio,478 |         api,479 |         logging480 |       }481 |     };482 |   }483 | 484 |   async getConversationStats(userId?: string, dateFrom?: string, dateTo?: string) {485 |     return this.loggingService.getConversationStats(userId, dateFrom, dateTo);486 |   }487 | 488 |   async getConversationLogs(userId: string, limit?: number, offset?: number) {489 |     return this.loggingService.getConversationLogs(userId, limit, offset);490 |   }491 | 492 |   async cleanOldLogs(daysToKeep?: number) {493 |     return this.loggingService.cleanOldLogs(daysToKeep);494 |   }495 | 496 |   async close(): Promise<void> {497 |     await this.loggingService.close();498 |   }499 | }
============================================================END: frontend/lib/services/conversational-orchestrator.ts============================================================


============================================================FILE: frontend/lib/services/external-api-service.tsSIZE: 16.10 KB============================================================
  1 | import { PrismaClient } from '@prisma/client';  2 | import bcrypt from 'bcryptjs';  3 |   4 | export interface ExternalAPIConfig {  5 |   id?: string;  6 |   name: string;  7 |   provider: string;  8 |   category: string;  9 |   apiKey?: string; 10 |   apiSecret?: string; 11 |   apiUrl?: string; 12 |   webhookUrl?: string; 13 |   webhookSecret?: string; 14 |   config?: Record<string, unknown>; 15 |   isActive: boolean; 16 |   testMode: boolean; 17 |   description?: string; 18 |   version?: string; 19 |   rateLimit?: number; 20 |   timeout?: number; 21 |   lastTestedAt?: Date; 22 |   lastTestResult?: Record<string, unknown>; 23 |   healthStatus?: string; 24 |   createdAt?: Date; 25 |   updatedAt?: Date; 26 |   createdBy?: string; 27 |   updatedBy?: string; 28 | } 29 |  30 | export interface APIConfigAudit { 31 |   configId: string; 32 |   action: 'create' | 'update' | 'delete' | 'test'; 33 |   oldValues?: Record<string, unknown>; 34 |   newValues?: Record<string, unknown>; 35 |   performedBy: string; 36 |   ipAddress?: string; 37 |   userAgent?: string; 38 | } 39 |  40 | export class ExternalAPIService { 41 |   private prisma: PrismaClient; 42 |  43 |   constructor() { 44 |     this.prisma = new PrismaClient(); 45 |   } 46 |  47 |   async createConfig( 48 |     configData: ExternalAPIConfig, 49 |     userId: string, 50 |     ipAddress?: string, 51 |     userAgent?: string 52 |   ): Promise<ExternalAPIConfig> { 53 |     try { 54 |  55 |       const processedData = await this.processCredentials(configData, 'encrypt'); 56 |  57 |       const config = await this.prisma.externalAPIConfig.create({ 58 |         data: { 59 |           name: processedData.name || '', 60 |           provider: processedData.provider || '', 61 |           category: processedData.category || '', 62 |           apiKey: processedData.apiKey || '', 63 |           apiSecret: processedData.apiSecret || '', 64 |           apiUrl: processedData.apiUrl || '', 65 |           description: processedData.description || '', 66 |           isActive: processedData.isActive ?? true, 67 |           timeout: processedData.timeout || 30000, 68 |           createdBy: userId, 69 |           updatedBy: userId, 70 |         }, 71 |       }); 72 |  73 |       await this.createAuditLog({ 74 |         configId: config.id, 75 |         action: 'create', 76 |         newValues: config, 77 |         performedBy: userId, 78 |         ipAddress, 79 |         userAgent, 80 |       }); 81 |  82 |       return this.formatConfig(config); 83 |     } catch (error) { 84 |       throw new Error('Failed to create API configuration'); 85 |     } 86 |   } 87 |  88 |   async getAllConfigs(): Promise<ExternalAPIConfig[]> { 89 |     try { 90 |       const configs = await this.prisma.externalAPIConfig.findMany({ 91 |         orderBy: { updatedAt: 'desc' }, 92 |       }); 93 |  94 |       return configs.map(config => this.formatConfig(config)); 95 |     } catch (error) { 96 |       throw new Error('Failed to fetch API configurations'); 97 |     } 98 |   } 99 | 100 |   async getConfigById(id: string): Promise<ExternalAPIConfig | null> {101 |     try {102 |       const config = await this.prisma.externalAPIConfig.findUnique({103 |         where: { id },104 |       });105 | 106 |       return config ? this.formatConfig(config) : null;107 |     } catch (error) {108 |       throw new Error('Failed to fetch API configuration');109 |     }110 |   }111 | 112 |   async getConfigByName(name: string): Promise<ExternalAPIConfig | null> {113 |     try {114 |       const config = await this.prisma.externalAPIConfig.findUnique({115 |         where: { name },116 |       });117 | 118 |       return config ? this.formatConfig(config) : null;119 |     } catch (error) {120 |       throw new Error('Failed to fetch API configuration');121 |     }122 |   }123 | 124 |   async updateConfig(125 |     id: string,126 |     updateData: Partial<ExternalAPIConfig>,127 |     userId: string,128 |     ipAddress?: string,129 |     userAgent?: string130 |   ): Promise<ExternalAPIConfig> {131 |     try {132 | 133 |       const currentConfig = await this.prisma.externalAPIConfig.findUnique({134 |         where: { id },135 |       });136 | 137 |       if (!currentConfig) {138 |         throw new Error('Configuration not found');139 |       }140 | 141 |       const processedData = await this.processCredentials(updateData, 'encrypt');142 | 143 |       const updatedConfig = await this.prisma.externalAPIConfig.update({144 |         where: { id },145 |         data: {146 |           ...processedData,147 |           updatedBy: userId,148 |           config: processedData.config as any,149 |         },150 |       });151 | 152 |       await this.createAuditLog({153 |         configId: id,154 |         action: 'update',155 |         oldValues: this.formatConfig(currentConfig) as any,156 |         newValues: this.formatConfig(updatedConfig) as any,157 |         performedBy: userId,158 |         ipAddress,159 |         userAgent,160 |       });161 | 162 |       return this.formatConfig(updatedConfig);163 |     } catch (error) {164 |       throw new Error('Failed to update API configuration');165 |     }166 |   }167 | 168 |   async deleteConfig(169 |     id: string,170 |     userId: string,171 |     ipAddress?: string,172 |     userAgent?: string173 |   ): Promise<void> {174 |     try {175 | 176 |       const currentConfig = await this.prisma.externalAPIConfig.findUnique({177 |         where: { id },178 |       });179 | 180 |       if (!currentConfig) {181 |         throw new Error('Configuration not found');182 |       }183 | 184 |       await this.prisma.externalAPIConfig.delete({185 |         where: { id },186 |       });187 | 188 |       await this.createAuditLog({189 |         configId: id,190 |         action: 'delete',191 |         oldValues: this.formatConfig(currentConfig) as any,192 |         performedBy: userId,193 |         ipAddress,194 |         userAgent,195 |       });196 |     } catch (error) {197 |       throw new Error('Failed to delete API configuration');198 |     }199 |   }200 | 201 |   async testConfig(202 |     id: string,203 |     userId: string,204 |     ipAddress?: string,205 |     userAgent?: string206 |   ): Promise<{ success: boolean; message: string; details?: unknown }> {207 |     try {208 |       const config = await this.prisma.externalAPIConfig.findUnique({209 |         where: { id },210 |       });211 | 212 |       if (!config) {213 |         throw new Error('Configuration not found');214 |       }215 | 216 |       const result = await this.performAPITest(config);217 | 218 |       await this.prisma.externalAPIConfig.update({219 |         where: { id },220 |         data: {221 |           lastTestedAt: new Date(),222 |           lastTestResult: result.message,223 |           healthStatus: result.success ? 'healthy' : 'unhealthy',224 |         },225 |       });226 | 227 |       await this.createAuditLog({228 |         configId: id,229 |         action: 'test',230 |         performedBy: userId,231 |         ipAddress,232 |         userAgent,233 |       });234 | 235 |       return result;236 |     } catch (error) {237 |       return {238 |         success: false,239 |         message: `Test failed: ${error instanceof Error ? error.message : 'Unknown error'}`,240 |       };241 |     }242 |   }243 | 244 |   async getAuditLogs(245 |     configId?: string,246 |     limit: number = 50,247 |     offset: number = 0248 |   ): Promise<APIConfigAudit[]> {249 |     try {250 |       const where = configId ? { configId } : {};251 | 252 |       const logs = await this.prisma.aPIConfigAudit.findMany({253 |         where,254 |         orderBy: { createdAt: 'desc' },255 |         take: limit,256 |         skip: offset,257 |       });258 | 259 |       return logs.map(log => ({260 |         ...log,261 |         action: log.action as 'create' | 'update' | 'delete' | 'test',262 |         ipAddress: log.ipAddress || undefined,263 |         userAgent: log.userAgent || undefined,264 |         oldValues: log.oldValues as Record<string, unknown> | undefined,265 |         newValues: log.newValues as Record<string, unknown> | undefined266 |       }));267 |     } catch (error) {268 |       throw new Error('Failed to fetch audit logs');269 |     }270 |   }271 | 272 |   private async processCredentials(273 |     data: Partial<ExternalAPIConfig>,274 |     action: 'encrypt' | 'decrypt'275 |   ): Promise<Partial<ExternalAPIConfig>> {276 |     const processed: Partial<ExternalAPIConfig> = { ...data };277 | 278 |     const sensitiveFields = ['apiKey', 'apiSecret', 'webhookSecret'];279 | 280 |     for (const field of sensitiveFields) {281 |       const fieldValue = (processed as Record<string, unknown>)[field];282 |       if (fieldValue) {283 |         if (action === 'encrypt') {284 | 285 |           (processed as Record<string, unknown>)[field] = await bcrypt.hash(fieldValue as string, 12);286 |         }287 | 288 |       }289 |     }290 | 291 |     return processed;292 |   }293 | 294 |   private formatConfig(config: Record<string, unknown>): ExternalAPIConfig {295 | 296 |     return {297 |       id: config.id as string,298 |       name: config.name as string,299 |       provider: config.provider as string,300 |       category: config.category as string,301 |       apiUrl: config.apiUrl as string | undefined,302 |       webhookUrl: config.webhookUrl as string | undefined,303 |       config: config.config as Record<string, unknown> | undefined,304 |       isActive: config.isActive as boolean,305 |       testMode: config.testMode as boolean,306 |       description: config.description as string | undefined,307 |       version: config.version as string | undefined,308 |       rateLimit: config.rateLimit as number | undefined,309 |       timeout: config.timeout as number | undefined,310 |       lastTestedAt: config.lastTestedAt as Date | undefined,311 |       lastTestResult: config.lastTestResult as Record<string, unknown> | undefined,312 |       healthStatus: config.healthStatus as string | undefined,313 |       createdAt: config.createdAt as Date | undefined,314 |       updatedAt: config.updatedAt as Date | undefined,315 |       createdBy: config.createdBy as string | undefined,316 |       updatedBy: config.updatedBy as string | undefined,317 |     };318 |   }319 | 320 |   private async performAPITest(config: Record<string, unknown>): Promise<{ success: boolean; message: string; details?: unknown }> {321 |     try {322 |       switch (String(config.name).toLowerCase()) {323 |         case 'openrouter':324 |           return await this.testOpenRouter(config);325 |         case 'twilio':326 |           return await this.testTwilio(config);327 |         case 'telegram':328 |           return await this.testTelegram(config);329 |         default:330 |           return {331 |             success: false,332 |             message: `Test not implemented for provider: ${config.provider}`,333 |           };334 |       }335 |     } catch (error) {336 |       return {337 |         success: false,338 |         message: `Test failed: ${error instanceof Error ? error.message : 'Unknown error'}`,339 |       };340 |     }341 |   }342 | 343 |   private async testOpenRouter(config: Record<string, unknown>): Promise<{ success: boolean; message: string; details?: unknown }> {344 |     try {345 |       const controller = new AbortController();346 |       const timeoutId = setTimeout(() => controller.abort(), Number(config.timeout) || 30000);347 | 348 |       const response = await fetch(`${config.apiUrl || 'https:349 |         headers: {350 |           'Authorization': `Bearer ${config.apiKey}`,351 |           'Content-Type': 'application/json',352 |         },353 |         signal: controller.signal,354 |       });355 | 356 |       clearTimeout(timeoutId);357 | 358 |       if (response.ok) {359 |         const data = await response.json();360 |         return {361 |           success: true,362 |           message: 'OpenRouter connection successful',363 |           details: { modelsCount: data.data?.length || 0 },364 |         };365 |       } else {366 |         return {367 |           success: false,368 |           message: `OpenRouter API error: ${response.status} ${response.statusText}`,369 |         };370 |       }371 |     } catch (error) {372 |       return {373 |         success: false,374 |         message: `OpenRouter connection failed: ${error instanceof Error ? error.message : 'Unknown error'}`,375 |       };376 |     }377 |   }378 | 379 |   private async testTwilio(config: Record<string, unknown>): Promise<{ success: boolean; message: string; details?: unknown }> {380 |     try {381 | 382 |       const auth = Buffer.from(`${config.apiKey}:${config.apiSecret}`).toString('base64');383 | 384 |       const controller = new AbortController();385 |       const timeoutId = setTimeout(() => controller.abort(), Number(config.timeout) || 30000);386 | 387 |       const response = await fetch('https:388 |         headers: {389 |           'Authorization': `Basic ${auth}`,390 |           'Content-Type': 'application/json',391 |         },392 |         signal: controller.signal,393 |       });394 | 395 |       clearTimeout(timeoutId);396 | 397 |       if (response.ok) {398 |         const data = await response.json();399 |         return {400 |           success: true,401 |           message: 'Twilio connection successful',402 |           details: { accountSid: data.accounts?.[0]?.sid },403 |         };404 |       } else {405 |         return {406 |           success: false,407 |           message: `Twilio API error: ${response.status} ${response.statusText}`,408 |         };409 |       }410 |     } catch (error) {411 |       return {412 |         success: false,413 |         message: `Twilio connection failed: ${error instanceof Error ? error.message : 'Unknown error'}`,414 |       };415 |     }416 |   }417 | 418 |   private async testTelegram(config: Record<string, unknown>): Promise<{ success: boolean; message: string; details?: unknown }> {419 |     try {420 |       const controller = new AbortController();421 |       const timeoutId = setTimeout(() => controller.abort(), Number(config.timeout) || 30000);422 | 423 |       const response = await fetch(`https:424 |         signal: controller.signal,425 |       });426 | 427 |       clearTimeout(timeoutId);428 | 429 |       if (response.ok) {430 |         const data = await response.json();431 |         if (data.ok) {432 |           return {433 |             success: true,434 |             message: 'Telegram connection successful',435 |             details: { botName: data.result?.first_name },436 |           };437 |         } else {438 |           return {439 |             success: false,440 |             message: `Telegram API error: ${data.description || 'Unknown error'}`,441 |           };442 |         }443 |       } else {444 |         return {445 |           success: false,446 |           message: `Telegram HTTP error: ${response.status} ${response.statusText}`,447 |         };448 |       }449 |     } catch (error) {450 |       return {451 |         success: false,452 |         message: `Telegram connection failed: ${error instanceof Error ? error.message : 'Unknown error'}`,453 |       };454 |     }455 |   }456 | 457 |   private async createAuditLog(auditData: APIConfigAudit): Promise<void> {458 |     try {459 |       await this.prisma.aPIConfigAudit.create({460 |         data: {461 |           ...auditData,462 |           oldValues: auditData.oldValues as any,463 |           newValues: auditData.newValues as any,464 |         },465 |       });466 |     } catch (error) {467 | 468 |     }469 |   }470 | 471 |   async disconnect(): Promise<void> {472 |     await this.prisma.$disconnect();473 |   }474 | }
============================================================END: frontend/lib/services/external-api-service.ts============================================================


============================================================FILE: frontend/lib/services/logging-service.tsSIZE: 10.86 KB============================================================
  1 | import { ConversationLog, OrchestratorConfig } from '@/lib/types/conversational-orchestrator';  2 | import { PrismaClient } from '@prisma/client';  3 |   4 | export class LoggingService {  5 |   private config: OrchestratorConfig['logging'];  6 |   private prisma: PrismaClient;  7 |   8 |   constructor(config: OrchestratorConfig['logging']) {  9 |     this.config = config; 10 |     this.prisma = new PrismaClient({ 11 |       log: ['query', 'info', 'warn', 'error'], 12 |     }); 13 |   } 14 |  15 |   async logConversation(logData: Omit<ConversationLog, 'id' | 'timestamp'>): Promise<string> { 16 |     if (!this.config.enabled) { 17 |       return 'logging-disabled'; 18 |     } 19 |  20 |     const logId = this.generateLogId(); 21 |     const timestamp = new Date().toISOString(); 22 |  23 |     const fullLog: ConversationLog = { 24 |       id: logId, 25 |       timestamp, 26 |       ...logData 27 |     }; 28 |  29 |     try { 30 |       switch (this.config.storage) { 31 |         case 'database': 32 |           await this.logToDatabase(fullLog); 33 |           break; 34 |         case 'file': 35 |           await this.logToFile(fullLog); 36 |           break; 37 |         case 'console': 38 |           this.logToConsole(fullLog); 39 |           break; 40 |       } 41 |  42 |       return logId; 43 |     } catch (error) { 44 |  45 |       this.logToConsole(fullLog); 46 |       return logId; 47 |     } 48 |   } 49 |  50 |   async logError( 51 |     userId: string, 52 |     error: string, 53 |     context: { 54 |       message?: string; 55 |       intent?: string; 56 |       action?: string; 57 |       apiCalls?: Record<string, unknown>[]; 58 |     } 59 |   ): Promise<string> { 60 |     const logData: Omit<ConversationLog, 'id' | 'timestamp'> = { 61 |       sessionId: `error_${Date.now()}`, 62 |       userId, 63 |       message: context.message || 'Error occurred', 64 |       userMessage: context.message || 'Error occurred', 65 |       botResponse: 'Error response generated', 66 |       rasaIntent: context.intent || 'error', 67 |       rasaConfidence: 0, 68 |       rasaEntities: [], 69 |       responseGenerator: context.action || 'error_handling', 70 |       bookingStep: null, 71 |       bookingDataSnapshot: null, 72 |       modelVersion: '1.0.0', 73 |       intent: context.intent || 'error', 74 |       entities: [], 75 |       action: context.action || 'error_handling', 76 |       rasaResponse: 'Error in processing', 77 |       llmResponse: 'Error response generated', 78 |       apiCalls: context.apiCalls || [], 79 |       processingTime: 0, 80 |       success: false, 81 |       error 82 |     }; 83 |  84 |     return this.logConversation(logData); 85 |   } 86 |  87 |   async getConversationLogs( 88 |     userId: string, 89 |     limit: number = 50, 90 |     offset: number = 0 91 |   ): Promise<ConversationLog[]> { 92 |     if (this.config.storage !== 'database') { 93 |       return []; 94 |     } 95 |  96 |     try { 97 |  98 |       const logs = await this.prisma.$queryRaw` 99 |         SELECT * FROM conversation_logs100 |         WHERE user_id = ${userId}101 |         ORDER BY timestamp DESC102 |         LIMIT ${limit} OFFSET ${offset}103 |       `;104 | 105 |       return logs as ConversationLog[];106 |     } catch (error) {107 |       return [];108 |     }109 |   }110 | 111 |   async getConversationStats(112 |     userId?: string,113 |     dateFrom?: string,114 |     dateTo?: string115 |   ): Promise<{116 |     totalConversations: number;117 |     successfulConversations: number;118 |     failedConversations: number;119 |     averageProcessingTime: number;120 |     topIntents: Array<{intent: string, count: number}>;121 |     topErrors: Array<{error: string, count: number}>;122 |   }> {123 |     if (this.config.storage !== 'database') {124 |       return {125 |         totalConversations: 0,126 |         successfulConversations: 0,127 |         failedConversations: 0,128 |         averageProcessingTime: 0,129 |         topIntents: [],130 |         topErrors: []131 |       };132 |     }133 | 134 |     try {135 |       const whereClause = this.buildWhereClause(userId, dateFrom, dateTo);136 | 137 |       const stats = await this.prisma.$queryRaw`138 |         SELECT139 |           COUNT(*) as total_conversations,140 |           SUM(CASE WHEN success = true THEN 1 ELSE 0 END) as successful_conversations,141 |           SUM(CASE WHEN success = false THEN 1 ELSE 0 END) as failed_conversations,142 |           AVG(processing_time) as average_processing_time143 |         FROM conversation_logs144 |         ${whereClause}145 |       `;146 | 147 |       const topIntents = await this.prisma.$queryRaw`148 |         SELECT intent, COUNT(*) as count149 |         FROM conversation_logs150 |         ${whereClause}151 |         GROUP BY intent152 |         ORDER BY count DESC153 |         LIMIT 10154 |       `;155 | 156 |       const topErrors = await this.prisma.$queryRaw`157 |         SELECT error, COUNT(*) as count158 |         FROM conversation_logs159 |         WHERE success = false AND error IS NOT NULL160 |         ${userId ? `AND user_id = ${userId}` : ''}161 |         ${dateFrom ? `AND timestamp >= ${dateFrom}` : ''}162 |         ${dateTo ? `AND timestamp <= ${dateTo}` : ''}163 |         GROUP BY error164 |         ORDER BY count DESC165 |         LIMIT 10166 |       `;167 | 168 |       return {169 |         totalConversations: Number((stats as Record<string, unknown>[])[0]?.total_conversations || 0),170 |         successfulConversations: Number((stats as Record<string, unknown>[])[0]?.successful_conversations || 0),171 |         failedConversations: Number((stats as Record<string, unknown>[])[0]?.failed_conversations || 0),172 |         averageProcessingTime: Number((stats as Record<string, unknown>[])[0]?.average_processing_time || 0),173 |         topIntents: topIntents as Array<{intent: string, count: number}>,174 |         topErrors: topErrors as Array<{error: string, count: number}>175 |       };176 |     } catch (error) {177 |       return {178 |         totalConversations: 0,179 |         successfulConversations: 0,180 |         failedConversations: 0,181 |         averageProcessingTime: 0,182 |         topIntents: [],183 |         topErrors: []184 |       };185 |     }186 |   }187 | 188 |   async cleanOldLogs(daysToKeep: number = 30): Promise<number> {189 |     if (this.config.storage !== 'database') {190 |       return 0;191 |     }192 | 193 |     try {194 |       const cutoffDate = new Date();195 |       cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);196 | 197 |       const result = await this.prisma.$executeRaw`198 |         DELETE FROM conversation_logs199 |         WHERE timestamp < ${cutoffDate.toISOString()}200 |       `;201 | 202 |       return result;203 |     } catch (error) {204 |       return 0;205 |     }206 |   }207 | 208 |   private async logToDatabase(log: ConversationLog): Promise<void> {209 |     try {210 | 211 |       const userId = null;212 | 213 |       }`,214 |         userId: userId,215 |         userMessage: log.userMessage || log.message || 'No message',216 |         botResponse: log.botResponse || log.llmResponse || log.rasaResponse || 'No response generated',217 |         rasaIntent: log.rasaIntent || log.intent,218 |         rasaConfidence: log.rasaConfidence || log.confidence || 0.5,219 |         responseGenerator: log.responseGenerator || log.action || 'unknown'220 |       });221 | 222 |       const result = await this.prisma.conversationLog.create({223 |         data: {224 |           sessionId: log.sessionId || `session_${Date.now()}`,225 |           userId: userId,226 |           userMessage: log.userMessage || log.message || 'No message',227 |           botResponse: log.botResponse || log.llmResponse || log.rasaResponse || 'No response generated',228 |           rasaIntent: log.rasaIntent || log.intent,229 |           rasaConfidence: log.rasaConfidence || log.confidence || 0.5,230 |           rasaEntities: (log.rasaEntities || log.entities || []) as any,231 |           responseGenerator: log.responseGenerator || log.action || 'unknown',232 |           bookingStep: log.bookingStep || null,233 |           bookingDataSnapshot: (log.bookingDataSnapshot || log.bookingData || null) as any,234 |           modelVersion: log.modelVersion || '1.0.0'235 |         }236 |       });237 | 238 |       } catch (error) {239 | 240 |       }241 |   }242 | 243 |   private async logToFile(log: ConversationLog): Promise<void> {244 |     const fs = await import('fs/promises');245 |     const path = await import('path');246 | 247 |     const logDir = path.join(process.cwd(), 'logs');248 |     const logFile = path.join(logDir, `conversations-${new Date().toISOString().split('T')[0]}.jsonl`);249 | 250 |     await fs.mkdir(logDir, { recursive: true });251 | 252 |     const logLine = JSON.stringify(log) + '\n';253 |     await fs.appendFile(logFile, logLine);254 |   }255 | 256 |   private logToConsole(log: ConversationLog): void {257 |     const logLevel = this.config.level;258 | 259 |     if (logLevel === 'debug' || logLevel === 'info') {260 |       }`);261 |     } else if (logLevel === 'warn' && !log.success) {262 |       }`);263 |     } else if (logLevel === 'error' && !log.success) {264 |       }`);265 |     }266 |   }267 | 268 |   private generateLogId(): string {269 |     return `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;270 |   }271 | 272 |   private buildWhereClause(userId?: string, dateFrom?: string, dateTo?: string): string {273 |     const conditions = [];274 | 275 |     if (userId) {276 |       conditions.push(`user_id = '${userId}'`);277 |     }278 | 279 |     if (dateFrom) {280 |       conditions.push(`timestamp >= '${dateFrom}'`);281 |     }282 | 283 |     if (dateTo) {284 |       conditions.push(`timestamp <= '${dateTo}'`);285 |     }286 | 287 |     return conditions.length > 0 ? `WHERE ${conditions.join(' AND ')}` : '';288 |   }289 | 290 |   async close(): Promise<void> {291 |     await this.prisma.$disconnect();292 |   }293 | }
============================================================END: frontend/lib/services/logging-service.ts============================================================


============================================================FILE: frontend/lib/services/ml-pipeline-service.tsSIZE: 9.56 KB============================================================
  1 | import { prisma } from '@/lib/prisma';  2 | import OpenRouterService from './openrouter-service';  3 |   4 | interface TrainingDataPoint {  5 |   text: string;  6 |   intent: string;  7 |   entities: Array<{  8 |     entity: string;  9 |     value: string; 10 |     start: number; 11 |     end: number; 12 |   }>; 13 | } 14 |  15 | interface ModelPerformance { 16 |   modelVersion: string; 17 |   evaluationResults: { 18 |     accuracy: number; 19 |     precision: Record<string, number>; 20 |     recall: Record<string, number>; 21 |     f1Score: Record<string, number>; 22 |   }; 23 |   bookingSuccessRate: number; 24 |   avgConversationTurns: number; 25 | } 26 |  27 | export class MLPipelineService { 28 |   private prisma: typeof prisma; 29 |   private openRouter: OpenRouterService; 30 |  31 |   constructor(prismaInstance: typeof prisma, openRouter: OpenRouterService) { 32 |     this.prisma = prismaInstance; 33 |     this.openRouter = openRouter; 34 |   } 35 |  36 |   async generateTrainingData(options: { 37 |     minConfidence?: number; 38 |     includeNegativeFeedback?: boolean; 39 |     includeFallbackCases?: boolean; 40 |     limit?: number; 41 |   } = {}): Promise<TrainingDataPoint[]> { 42 |     const { 43 |       minConfidence = 0.6, 44 |       includeNegativeFeedback = true, 45 |       includeFallbackCases = true, 46 |       limit = 100 47 |     } = options; 48 |  49 |     const logs = await this.prisma.conversationLog.findMany({ 50 |       where: { 51 |         OR: [ 52 |  53 |           { rasaConfidence: { lt: minConfidence } }, 54 |  55 |           ...(includeNegativeFeedback ? [{ 56 |             feedback: { 57 |               some: { rating: 1 } 58 |             } 59 |           }] : []), 60 |  61 |           ...(includeFallbackCases ? [{ 62 |             responseGenerator: 'openrouter' 63 |           }] : []) 64 |         ] 65 |       }, 66 |       include: { 67 |         feedback: true 68 |       }, 69 |       orderBy: { timestamp: 'desc' }, 70 |       take: limit 71 |     }); 72 |  73 |     const trainingData: TrainingDataPoint[] = []; 74 |  75 |     for (const log of logs) { 76 |       try { 77 |  78 |         const variations = await this.openRouter.generateTrainingVariations( 79 |           log.userMessage, 80 |           log.rasaIntent || 'nlu_fallback' 81 |         ); 82 |  83 |         for (const variation of variations) { 84 |  85 |           const entityExtraction = await this.openRouter.extractEntitiesFromFallback({ 86 |             userMessage: variation, 87 |             conversationHistory: [], 88 |             requiredEntities: ['person_name', 'email_address', 'phone_number', 'birth_date', 'birth_time', 'birth_place', 'question_text', 'language_preference'] 89 |           }); 90 |  91 |           const entities = Object.entries(entityExtraction.entities) 92 |             .filter(([, value]) => value && typeof value === 'string') 93 |             .map(([entity, value]) => ({ 94 |               entity, 95 |               value: value as string, 96 |               start: variation.indexOf(value as string), 97 |               end: variation.indexOf(value as string) + (value as string).length 98 |             })); 99 | 100 |           trainingData.push({101 |             text: variation,102 |             intent: entityExtraction.intent,103 |             entities104 |           });105 |         }106 |       } catch (error) {107 |         }108 |     }109 | 110 |     return trainingData;111 |   }112 | 113 |   async evaluateModel(modelVersion: string): Promise<ModelPerformance> {114 | 115 |     const testLogs = await this.prisma.conversationLog.findMany({116 |       where: {117 |         timestamp: {118 |           gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)119 |         },120 |         modelVersion: modelVersion121 |       },122 |       include: {123 |         feedback: true124 |       }125 |     });126 | 127 |     const totalLogs = testLogs.length;128 |     const correctPredictions = testLogs.filter(log =>129 |       log.rasaConfidence && Number(log.rasaConfidence) > 0.7130 |     ).length;131 | 132 |     const accuracy = totalLogs > 0 ? correctPredictions / totalLogs : 0;133 | 134 |     const bookingLogs = testLogs.filter(log =>135 |       log.bookingStep === 'booking_complete' ||136 |       log.bookingStep === 'selecting_timeslot'137 |     );138 |     const successfulBookings = bookingLogs.filter(log =>139 |       log.bookingStep === 'booking_complete'140 |     ).length;141 |     const bookingSuccessRate = bookingLogs.length > 0 ? successfulBookings / bookingLogs.length : 0;142 | 143 |     const sessionTurns = await this.prisma.conversationLog.groupBy({144 |       by: ['sessionId'],145 |       where: {146 |         modelVersion: modelVersion,147 |         timestamp: {148 |           gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)149 |         }150 |       },151 |       _count: { id: true }152 |     });153 | 154 |     const avgConversationTurns = sessionTurns.length > 0155 |       ? sessionTurns.reduce((sum, session) => sum + session._count.id, 0) / sessionTurns.length156 |       : 0;157 | 158 |     const intentMetrics = await this.calculateIntentMetrics(testLogs);159 | 160 |     const performance: ModelPerformance = {161 |       modelVersion,162 |       evaluationResults: {163 |         accuracy,164 |         precision: intentMetrics.precision,165 |         recall: intentMetrics.recall,166 |         f1Score: intentMetrics.f1Score167 |       },168 |       bookingSuccessRate,169 |       avgConversationTurns170 |     };171 | 172 |     await this.prisma.mlModelPerformance.upsert({173 |       where: { modelVersion },174 |       update: {175 |         evaluationResults: performance.evaluationResults,176 |         bookingSuccessRate: performance.bookingSuccessRate,177 |         avgConversationTurns: performance.avgConversationTurns178 |       },179 |       create: {180 |         modelVersion,181 |         evaluationResults: performance.evaluationResults,182 |         bookingSuccessRate: performance.bookingSuccessRate,183 |         avgConversationTurns: performance.avgConversationTurns,184 |         deploymentDate: new Date(),185 |         isActiveProduction: false186 |       }187 |     });188 | 189 |     return performance;190 |   }191 | 192 |   async createABTest(options: {193 |     experimentName: string;194 |     modelAVersion: string;195 |     modelBVersion: string;196 |     trafficSplit?: number;197 |     successMetric: string;198 |   }) {199 |     const { trafficSplit = 0.5, ...rest } = options;200 | 201 |     return await this.prisma.abTestExperiment.create({202 |       data: {203 |         ...rest,204 |         trafficSplit,205 |         status: 'active'206 |       }207 |     });208 |   }209 | 210 |   async assignToABTest(sessionId: string, experimentId: number): Promise<'A' | 'B'> {211 | 212 |     const existing = await this.prisma.abTestAssignment.findUnique({213 |       where: {214 |         experimentId_sessionId: {215 |           experimentId,216 |           sessionId217 |         }218 |       }219 |     });220 | 221 |     if (existing) {222 |       return existing.assignedModel as 'A' | 'B';223 |     }224 | 225 |     const experiment = await this.prisma.abTestExperiment.findUnique({226 |       where: { id: experimentId }227 |     });228 | 229 |     if (!experiment || experiment.status !== 'active') {230 |       return 'A';231 |     }232 | 233 |     const random = Math.random();234 |     const assignedModel = random < Number(experiment.trafficSplit) ? 'A' : 'B';235 | 236 |     await this.prisma.abTestAssignment.create({237 |       data: {238 |         experimentId,239 |         sessionId,240 |         assignedModel241 |       }242 |     });243 | 244 |     return assignedModel;245 |   }246 | 247 |   async getModelForSession(sessionId: string): Promise<string> {248 | 249 |     const activeExperiments = await this.prisma.abTestExperiment.findMany({250 |       where: { status: 'active' }251 |     });252 | 253 |     for (const experiment of activeExperiments) {254 |       const assignment = await this.assignToABTest(sessionId, experiment.id);255 |       return assignment === 'A' ? experiment.modelAVersion : experiment.modelBVersion;256 |     }257 | 258 |     const productionModel = await this.prisma.mlModelPerformance.findFirst({259 |       where: { isActiveProduction: true },260 |       orderBy: { deploymentDate: 'desc' }261 |     });262 | 263 |     return productionModel?.modelVersion || 'default';264 |   }265 | 266 |   async markFeedbackAsReviewed(feedbackIds: number[]) {267 |     await this.prisma.userFeedback.updateMany({268 |       where: { id: { in: feedbackIds } },269 |       data: { reviewedForTraining: true }270 |     });271 |   }272 | 273 |   private async calculateIntentMetrics(logs: Record<string, unknown>[]): Promise<{274 |     precision: Record<string, number>;275 |     recall: Record<string, number>;276 |     f1Score: Record<string, number>;277 |   }> {278 | 279 |     const intents = [...new Set(logs.map(log => log.rasaIntent).filter(Boolean))];280 | 281 |     const metrics = {282 |       precision: {} as Record<string, number>,283 |       recall: {} as Record<string, number>,284 |       f1Score: {} as Record<string, number>285 |     };286 | 287 |     for (const intent of intents) {288 |       const intentLogs = logs.filter(log => log.rasaIntent === intent);289 |       const highConfidenceLogs = intentLogs.filter(log => log.rasaConfidence && Number(log.rasaConfidence) > 0.7);290 | 291 |       const precision = intentLogs.length > 0 ? highConfidenceLogs.length / intentLogs.length : 0;292 |       const recall = precision;293 |       const f1Score = precision > 0 ? 2 * (precision * recall) / (precision + recall) : 0;294 | 295 |       metrics.precision[intent as string] = precision;296 |       metrics.recall[intent as string] = recall;297 |       metrics.f1Score[intent as string] = f1Score;298 |     }299 | 300 |     return metrics;301 |   }302 | }303 | 304 | export default MLPipelineService;
============================================================END: frontend/lib/services/ml-pipeline-service.ts============================================================


============================================================FILE: frontend/lib/services/openrouter-service.tsSIZE: 12.97 KB============================================================
  1 | interface OpenRouterResponse {  2 |   id: string;  3 |   object: string;  4 |   created: number;  5 |   model: string;  6 |   choices: Array<{  7 |     index: number;  8 |     message: {  9 |       role: string; 10 |       content: string; 11 |     }; 12 |     finish_reason: string; 13 |   }>; 14 |   usage: { 15 |     prompt_tokens: number; 16 |     completion_tokens: number; 17 |     total_tokens: number; 18 |   }; 19 | } 20 |  21 | interface OpenRouterRequest { 22 |   model: string; 23 |   messages: Array<{ 24 |     role: 'system' | 'user' | 'assistant'; 25 |     content: string; 26 |   }>; 27 |   max_tokens?: number; 28 |   temperature?: number; 29 |   top_p?: number; 30 | } 31 |  32 | export class OpenRouterService { 33 |   private apiKey: string; 34 |   private baseUrl: string = 'https: 35 |   private defaultModel: string = 'meta-llama/llama-3.3-8b-instruct:free'; 36 |  37 |   constructor(apiKey?: string) { 38 |     this.apiKey = apiKey || process.env.OPENROUTER_API_KEY || ''; 39 |     if (!this.apiKey) { 40 |       } 41 |   } 42 |  43 |   async generateBookingResponse(context: { 44 |     userMessage: string; 45 |     bookingState: Record<string, unknown>; 46 |     missingDetails: string[]; 47 |     emotionalTone?: 'urgent' | 'calm' | 'confused' | 'excited'; 48 |     persona: 'empathetic' | 'professional' | 'spiritual'; 49 |   }): Promise<string> { 50 |     if (!this.apiKey) { 51 |       return "I'd be happy to help you with your booking. Please let me know what type of session you're interested in."; 52 |     } 53 |     const systemPrompt = this.buildSystemPrompt(context); 54 |     const userPrompt = this.buildUserPrompt(context); 55 |  56 |     const response = await this.makeRequest({ 57 |       model: this.defaultModel, 58 |       messages: [ 59 |         { role: 'system', content: systemPrompt }, 60 |         { role: 'user', content: userPrompt } 61 |       ], 62 |       max_tokens: 300, 63 |       temperature: 0.7 64 |     }); 65 |  66 |     return response.choices[0]?.message?.content || 'I apologize, but I had trouble generating a response. Could you please try again?'; 67 |   } 68 |  69 |   async extractEntitiesFromFallback(context: { 70 |     userMessage: string; 71 |     conversationHistory: Array<{ role: string; content: string }>; 72 |     requiredEntities: string[]; 73 |   }): Promise<{ 74 |     intent: string; 75 |     confidence: number; 76 |     entities: Record<string, unknown>; 77 |   }> { 78 |     const systemPrompt = `You are an expert at extracting structured information from natural language. 79 |     Extract booking-related entities from user messages and return them in JSON format. 80 |  81 |     Required entities: ${context.requiredEntities.join(', ')} 82 |  83 |     Return format: 84 |     { 85 |       "intent": "book_reading" | "provide_info" | "chitchat" | "nlu_fallback", 86 |       "confidence": 0.0-1.0, 87 |       "entities": { 88 |         "person_name": "extracted name", 89 |         "email_address": "extracted email", 90 |         "phone_number": "extracted phone", 91 |         "birth_date": "extracted birth date", 92 |         "birth_time": "extracted birth time", 93 |         "birth_place": "extracted birth place", 94 |         "question_text": "extracted question", 95 |         "language_preference": "extracted language" 96 |       } 97 |     }`; 98 |  99 |     const userPrompt = `Extract entities from this message: "${context.userMessage}"100 | 101 |     Conversation history:102 |     ${context.conversationHistory.map(msg => `${msg.role}: ${msg.content}`).join('\n')}`;103 | 104 |     const response = await this.makeRequest({105 |       model: this.defaultModel,106 |       messages: [107 |         { role: 'system', content: systemPrompt },108 |         { role: 'user', content: userPrompt }109 |       ],110 |       max_tokens: 500,111 |       temperature: 0.3112 |     });113 | 114 |     try {115 |       const extracted = JSON.parse(response.choices[0]?.message?.content || '{}');116 |       return {117 |         intent: extracted.intent || 'nlu_fallback',118 |         confidence: extracted.confidence || 0.5,119 |         entities: extracted.entities || {}120 |       };121 |     } catch (error) {122 |       return {123 |         intent: 'nlu_fallback',124 |         confidence: 0.3,125 |         entities: {}126 |       };127 |     }128 |   }129 | 130 |   async handleChitchat(context: {131 |     userMessage: string;132 |     conversationHistory: Array<{ role: string; content: string }>;133 |     brandContext: {134 |       astrologerName: string;135 |       services: string[];136 |       specialties: string[];137 |     };138 |   }): Promise<string> {139 |     const systemPrompt = `You are a knowledgeable and empathetic assistant for MatMax Yoga Studio.140 | 141 |     About our services:142 |     - ${context.brandContext.services.join('\n- ')}143 | 144 |     Our specialties:145 |     - ${context.brandContext.specialties.join('\n- ')}146 | 147 |     Keep responses SHORT and CONCISE (1-2 sentences max). Be warm and helpful.148 | 149 |     IMPORTANT: If the user introduces themselves or mentions their name (in Spanish or English), acknowledge it warmly and ask how you can help them.150 | 151 |     If you don't know something specific, gently guide the user to book a reading for personalized answers.`;152 | 153 |     const userPrompt = `User question: "${context.userMessage}"154 | 155 |     Conversation context:156 |     ${context.conversationHistory.map(msg => `${msg.role}: ${msg.content}`).join('\n')}`;157 | 158 |     const response = await this.makeRequest({159 |       model: this.defaultModel,160 |       messages: [161 |         { role: 'system', content: systemPrompt },162 |         { role: 'user', content: userPrompt }163 |       ],164 |       max_tokens: 150,165 |       temperature: 0.8166 |     });167 | 168 |     return response.choices[0]?.message?.content || 'I\'d be happy to help you with that! Would you like to book a reading to get personalized insights?';169 |   }170 | 171 |   async generateTrainingVariations(originalMessage: string, intent: string): Promise<string[]> {172 |     const systemPrompt = `Generate 5 different ways to express the same intent as the given message.173 |     Keep the same meaning but use different words, phrasing, and style. Make them sound natural and conversational.174 | 175 |     Intent: ${intent}176 |     Original message: "${originalMessage}"`;177 | 178 |     const response = await this.makeRequest({179 |       model: this.defaultModel,180 |       messages: [181 |         { role: 'system', content: systemPrompt },182 |         { role: 'user', content: `Generate variations for: "${originalMessage}"` }183 |       ],184 |       max_tokens: 300,185 |       temperature: 0.9186 |     });187 | 188 |     const content = response.choices[0]?.message?.content || '';189 |     return content.split('\n')190 |       .map(line => line.trim())191 |       .filter(line => line.length > 0 && !line.startsWith('-'))192 |       .slice(0, 5);193 |   }194 | 195 |   private buildSystemPrompt(context: Record<string, unknown>): string {196 |     const basePrompt = `You are an empathetic, welcoming yoga studio assistant for MatMax Yoga Studio.197 |     You help users book yoga classes and find the right offerings.198 | 199 |     Your personality:200 |     - Warm and welcoming201 |     - Patient and understanding202 |     - Spiritually aware and intuitive203 |     - Professional yet personal204 |     - Encouraging and supportive205 | 206 |     Current booking state: ${JSON.stringify(context.bookingState, null, 2)}207 |     Missing details: ${Array.isArray(context.missingDetails) ? context.missingDetails.join(', ') : 'None'}208 | 209 |     Your goal is to gently guide the user through the booking process while maintaining a spiritual,210 |     empathetic tone that reflects the benefits of yoga practice.`;211 | 212 |     if (context.persona === 'spiritual') {213 |       return basePrompt + `\n\nEmphasize the spiritual and transformative aspects of the reading.214 |       Use language that speaks to the soul and personal growth.`;215 |     } else if (context.persona === 'professional') {216 |       return basePrompt + `\n\nMaintain a professional yet warm tone. Focus on the practical aspects217 |       of the booking while being helpful and efficient.`;218 |     }219 | 220 |     return basePrompt;221 |   }222 | 223 |   private buildUserPrompt(context: Record<string, unknown>): string {224 |     let prompt = `User message: "${context.userMessage}"\n\n`;225 | 226 |     if (Array.isArray(context.missingDetails) && context.missingDetails.length > 0) {227 |       prompt += `The user still needs to provide: ${context.missingDetails.join(', ')}\n\n`;228 |     }229 | 230 |     if (context.emotionalTone) {231 |       prompt += `Emotional tone detected: ${context.emotionalTone}\n\n`;232 |     }233 | 234 |     prompt += `Please respond in a way that moves the conversation forward while being empathetic and helpful.`;235 | 236 |     return prompt;237 |   }238 | 239 |   async generateErrorResponse(240 |     errorMessage: string,241 |     userMessage: string,242 |     intent: string243 |   ): Promise<string> {244 |     const systemPrompt = `You are a helpful astrology booking assistant. Something went wrong, but be helpful and guide them toward booking a reading.245 | 246 | Error: ${errorMessage}247 | User: "${userMessage}"248 | Intent: ${intent}249 | 250 | Keep response SHORT (1-2 sentences).`;251 | 252 |     const response = await this.makeRequest({253 |       model: this.defaultModel,254 |       messages: [255 |         { role: 'system', content: systemPrompt },256 |         { role: 'user', content: userMessage }257 |       ],258 |       max_tokens: 200,259 |       temperature: 0.7260 |     });261 | 262 |     return response.choices[0]?.message?.content || 'I apologize, but I encountered an issue. Please try again or contact support for assistance.';263 |   }264 | 265 |   async generateClarificationResponse(266 |     userMessage: string,267 |     alternativeIntents: Array<{ name: string; confidence: number }>,268 |     entities: Record<string, unknown>269 |   ): Promise<string> {270 |     const systemPrompt = `You are a helpful astrology booking assistant. The user's message was unclear, and you need to ask for clarification.271 | 272 | User's message: "${userMessage}"273 | Possible intents: ${alternativeIntents.map(i => i.name).join(', ')}274 | Extracted entities: ${JSON.stringify(entities)}275 | 276 | Please ask a clarifying question to help the user get the assistance they need.`;277 | 278 |     const response = await this.makeRequest({279 |       model: this.defaultModel,280 |       messages: [281 |         { role: 'system', content: systemPrompt },282 |         { role: 'user', content: userMessage }283 |       ],284 |       max_tokens: 200,285 |       temperature: 0.7286 |     });287 | 288 |     return response.choices[0]?.message?.content || 'I want to make sure I understand you correctly. Could you please clarify what you need help with?';289 |   }290 | 291 |   async generateContextualResponse(292 |     userMessage: string,293 |     intent: string,294 |     entities: Record<string, unknown>,295 |     apiData: Record<string, unknown>,296 |     conversationHistory: Array<{ role: string; content: string; timestamp?: string }>297 |   ): Promise<string> {298 |     const systemPrompt = `You are a helpful assistant for MatMax Yoga Studio. Help users book yoga classes and find the right offerings.299 | 300 | Intent: ${intent}301 | Entities: ${JSON.stringify(entities)}302 | API Data: ${JSON.stringify(apiData)}303 | 304 | IMPORTANT: Keep responses SHORT and CONCISE (1-2 sentences max). Be warm but brief.`;305 | 306 |     const messages: Array<{ role: 'user' | 'assistant' | 'system'; content: string }> = [307 |       { role: 'system', content: systemPrompt }308 |     ];309 | 310 |     conversationHistory.slice(-10).forEach(msg => {311 |       messages.push({312 |         role: (msg.role === 'user' ? 'user' : 'assistant') as 'user' | 'assistant' | 'system',313 |         content: String((msg as Record<string, unknown>).message || msg.content || '')314 |       });315 |     });316 | 317 |     messages.push({ role: 'user', content: userMessage });318 | 319 |     const response = await this.makeRequest({320 |       model: this.defaultModel,321 |       messages,322 |       max_tokens: 300,323 |       temperature: 0.7324 |     });325 | 326 |     return response.choices[0]?.message?.content || 'I\'m here to help you with yoga classes at MatMax. How can I assist you today?';327 |   }328 | 329 |   async healthCheck(): Promise<boolean> {330 |     try {331 |       const response = await this.makeRequest({332 |         model: this.defaultModel,333 |         messages: [334 |           { role: 'system', content: 'You are a helpful assistant.' },335 |           { role: 'user', content: 'Hello' }336 |         ],337 |         max_tokens: 10,338 |         temperature: 0.1339 |       });340 |       return response.choices && response.choices.length > 0;341 |     } catch (error) {342 |       return false;343 |     }344 |   }345 | 346 |   private async makeRequest(request: OpenRouterRequest): Promise<OpenRouterResponse> {347 |     if (!this.apiKey) {348 |       throw new Error('OpenRouter API key is not configured');349 |     }350 |     const response = await fetch(`${this.baseUrl}/chat/completions`, {351 |       method: 'POST',352 |       headers: {353 |         'Authorization': `Bearer ${this.apiKey}`,354 |         'Content-Type': 'application/json',355 |         'HTTP-Referer': process.env.NEXT_PUBLIC_BASE_URL || `http:356 |         'X-Title': 'MatMax Yoga Studio Platform'357 |       },358 |       body: JSON.stringify(request)359 |     });360 | 361 |     if (!response.ok) {362 |       if (response.status === 401) {363 |         throw new Error('OpenRouter API key invalid or missing');364 |       }365 |       throw new Error(`OpenRouter API error: ${response.status} ${response.statusText}`);366 |     }367 | 368 |     return response.json();369 |   }370 | }371 | 372 | export default OpenRouterService;
============================================================END: frontend/lib/services/openrouter-service.ts============================================================


============================================================FILE: frontend/lib/services/rasa-service.tsSIZE: 4.13 KB============================================================
  1 | import axios from 'axios';  2 | import { RasaResponse, RasaAction, OrchestratorConfig } from '@/lib/types/conversational-orchestrator';  3 |   4 | export class RasaService {  5 |   private config: OrchestratorConfig['rasa'];  6 |   private baseUrl: string;  7 |   8 |   constructor(config: OrchestratorConfig['rasa']) {  9 |     this.config = config; 10 |     this.baseUrl = config.url; 11 |   } 12 |  13 |   async parseMessage(message: string, senderId: string): Promise<RasaResponse> { 14 |     try { 15 |       await axios.post( 16 |         `${this.baseUrl}/webhooks/rest/webhook`, 17 |         { 18 |           sender: senderId, 19 |           message: message 20 |         }, 21 |         { 22 |           headers: { 23 |             'Content-Type': 'application/json', 24 |           }, 25 |           timeout: 10000 26 |         } 27 |       ); 28 |  29 |       return { 30 |         intent: { 31 |           name: 'greet', 32 |           confidence: 0.8 33 |         }, 34 |         entities: [], 35 |         text: message, 36 |         intent_ranking: [] 37 |       }; 38 |     } catch (error) { 39 |       throw new Error(`Rasa API error: ${error instanceof Error ? error.message : 'Unknown error'}`); 40 |     } 41 |   } 42 |  43 |   async getAction(message: string, senderId: string): Promise<RasaAction> { 44 |     try { 45 |       await axios.post( 46 |         `${this.baseUrl}/webhooks/rest/webhook`, 47 |         { 48 |           sender: senderId, 49 |           message: message 50 |         }, 51 |         { 52 |           headers: { 53 |             'Content-Type': 'application/json', 54 |           }, 55 |           timeout: 10000 56 |         } 57 |       ); 58 |  59 |       return { 60 |         action: 'utter_greet', 61 |         confidence: 0.8, 62 |         response: 'Hello! How can I help you?' 63 |       }; 64 |     } catch (error) { 65 |       throw new Error(`Rasa action error: ${error instanceof Error ? error.message : 'Unknown error'}`); 66 |     } 67 |   } 68 |  69 |   isIntentConfident(intent: RasaResponse['intent']): boolean { 70 |     return intent && intent.confidence >= this.config.confidence_threshold; 71 |   } 72 |  73 |   getEntityByType(entities: RasaResponse['entities'], entityType: string): string | null { 74 |     const entity = entities.find(e => e.entity === entityType); 75 |     return entity && entity.confidence >= 0.7 ? entity.value : null; 76 |   } 77 |  78 |   getEntitiesByType(entities: RasaResponse['entities'], entityType: string): Array<{value: string, confidence: number}> { 79 |     return entities 80 |       .filter(e => e.entity === entityType) 81 |       .map(e => ({ value: e.value, confidence: e.confidence })); 82 |   } 83 |  84 |   validateRequiredEntities(entities: RasaResponse['entities'], requiredEntities: string[]): { 85 |     isValid: boolean; 86 |     missing: string[]; 87 |   } { 88 |     const foundEntities = entities.map(e => e.entity); 89 |     const missing = requiredEntities.filter(req => !foundEntities.includes(req)); 90 |  91 |     return { 92 |       isValid: missing.length === 0, 93 |       missing 94 |     }; 95 |   } 96 |  97 |   getAlternativeIntents(rasaResponse: RasaResponse): Array<{name: string, confidence: number}> { 98 |     if (!rasaResponse.intent_ranking) { 99 |       return [];100 |     }101 | 102 |     return rasaResponse.intent_ranking103 |       .filter(intent => intent.name !== rasaResponse.intent.name)104 |       .slice(0, 3);105 |   }106 | 107 |   async healthCheck(): Promise<boolean> {108 |     try {109 |       const response = await axios.get(`${this.baseUrl}/`, {110 |         timeout: 5000111 |       });112 |       return response.status === 200;113 |     } catch (error) {114 |       return false;115 |     }116 |   }117 | }
============================================================END: frontend/lib/services/rasa-service.ts============================================================


============================================================FILE: frontend/lib/services/telegram-service.tsSIZE: 8.47 KB============================================================
  1 | export interface TelegramBotInfo {  2 |   id: number;  3 |   is_bot: boolean;  4 |   first_name: string;  5 |   username?: string;  6 |   can_join_groups: boolean;  7 |   can_read_all_group_messages: boolean;  8 |   supports_inline_queries: boolean;  9 | } 10 |  11 | export interface TelegramWebhookInfo { 12 |   url: string; 13 |   has_custom_certificate: boolean; 14 |   pending_update_count: number; 15 |   last_error_date?: number; 16 |   last_error_message?: string; 17 |   max_connections?: number; 18 |   allowed_updates?: string[]; 19 | } 20 |  21 | export interface TelegramMessage { 22 |   message_id: number; 23 |   from: { 24 |     id: number; 25 |     is_bot: boolean; 26 |     first_name: string; 27 |     last_name?: string; 28 |     username?: string; 29 |     language_code?: string; 30 |   }; 31 |   chat: { 32 |     id: number; 33 |     first_name?: string; 34 |     last_name?: string; 35 |     username?: string; 36 |     type: string; 37 |   }; 38 |   date: number; 39 |   text?: string; 40 | } 41 |  42 | export interface TelegramUpdate { 43 |   update_id: number; 44 |   message?: TelegramMessage; 45 |   callback_query?: { 46 |     id: string; 47 |     from: TelegramMessage['from']; 48 |     message?: TelegramMessage; 49 |     data?: string; 50 |   }; 51 | } 52 |  53 | export interface TelegramInlineKeyboard { 54 |   text: string; 55 |   callback_data: string; 56 | } 57 |  58 | export interface TelegramReplyMarkup { 59 |   inline_keyboard: TelegramInlineKeyboard[][]; 60 | } 61 |  62 | export class TelegramService { 63 |   private baseUrl: string; 64 |  65 |   constructor(botToken: string) { 66 |     this.baseUrl = `https: 67 |   } 68 |  69 |   async getBotInfo(): Promise<TelegramBotInfo | null> { 70 |     try { 71 |       const response = await fetch(`${this.baseUrl}/getMe`); 72 |       const data = await response.json(); 73 |  74 |       if (data.ok) { 75 |         return data.result; 76 |       } else { 77 |         return null; 78 |       } 79 |     } catch (error) { 80 |       return null; 81 |     } 82 |   } 83 |  84 |   async setWebhook(webhookUrl: string, allowedUpdates: string[] = ['message', 'callback_query']): Promise<boolean> { 85 |     try { 86 |       const response = await fetch(`${this.baseUrl}/setWebhook`, { 87 |         method: 'POST', 88 |         headers: { 89 |           'Content-Type': 'application/json', 90 |         }, 91 |         body: JSON.stringify({ 92 |           url: webhookUrl, 93 |           allowed_updates: allowedUpdates, 94 |         }), 95 |       }); 96 |  97 |       const data = await response.json(); 98 |  99 |       if (data.ok) {100 |         return true;101 |       } else {102 |         return false;103 |       }104 |     } catch (error) {105 |       return false;106 |     }107 |   }108 | 109 |   async getWebhookInfo(): Promise<TelegramWebhookInfo | null> {110 |     try {111 |       const response = await fetch(`${this.baseUrl}/getWebhookInfo`);112 |       const data = await response.json();113 | 114 |       if (data.ok) {115 |         return data.result;116 |       } else {117 |         return null;118 |       }119 |     } catch (error) {120 |       return null;121 |     }122 |   }123 | 124 |   async deleteWebhook(): Promise<boolean> {125 |     try {126 |       const response = await fetch(`${this.baseUrl}/deleteWebhook`, {127 |         method: 'POST',128 |       });129 | 130 |       const data = await response.json();131 | 132 |       if (data.ok) {133 |         return true;134 |       } else {135 |         return false;136 |       }137 |     } catch (error) {138 |       return false;139 |     }140 |   }141 | 142 |   async sendMessage(143 |     chatId: string | number,144 |     text: string,145 |     options: {146 |       parseMode?: 'HTML' | 'Markdown' | 'MarkdownV2';147 |       replyMarkup?: TelegramReplyMarkup;148 |       disableWebPagePreview?: boolean;149 |     } = {}150 |   ): Promise<boolean> {151 |     try {152 |       const response = await fetch(`${this.baseUrl}/sendMessage`, {153 |         method: 'POST',154 |         headers: {155 |           'Content-Type': 'application/json',156 |         },157 |         body: JSON.stringify({158 |           chat_id: chatId,159 |           text: text,160 |           parse_mode: options.parseMode || 'HTML',161 |           reply_markup: options.replyMarkup,162 |           disable_web_page_preview: options.disableWebPagePreview,163 |         }),164 |       });165 | 166 |       const data = await response.json();167 | 168 |       if (data.ok) {169 |         return true;170 |       } else {171 |         return false;172 |       }173 |     } catch (error) {174 |       return false;175 |     }176 |   }177 | 178 |   async sendPhoto(179 |     chatId: string | number,180 |     photo: string,181 |     caption?: string,182 |     options: {183 |       parseMode?: 'HTML' | 'Markdown' | 'MarkdownV2';184 |       replyMarkup?: TelegramReplyMarkup;185 |     } = {}186 |   ): Promise<boolean> {187 |     try {188 |       const response = await fetch(`${this.baseUrl}/sendPhoto`, {189 |         method: 'POST',190 |         headers: {191 |           'Content-Type': 'application/json',192 |         },193 |         body: JSON.stringify({194 |           chat_id: chatId,195 |           photo: photo,196 |           caption: caption,197 |           parse_mode: options.parseMode || 'HTML',198 |           reply_markup: options.replyMarkup,199 |         }),200 |       });201 | 202 |       const data = await response.json();203 | 204 |       if (data.ok) {205 |         return true;206 |       } else {207 |         return false;208 |       }209 |     } catch (error) {210 |       return false;211 |     }212 |   }213 | 214 |   async answerCallbackQuery(215 |     callbackQueryId: string,216 |     text?: string,217 |     showAlert: boolean = false218 |   ): Promise<boolean> {219 |     try {220 |       const response = await fetch(`${this.baseUrl}/answerCallbackQuery`, {221 |         method: 'POST',222 |         headers: {223 |           'Content-Type': 'application/json',224 |         },225 |         body: JSON.stringify({226 |           callback_query_id: callbackQueryId,227 |           text: text,228 |           show_alert: showAlert,229 |         }),230 |       });231 | 232 |       const data = await response.json();233 | 234 |       if (data.ok) {235 |         return true;236 |       } else {237 |         return false;238 |       }239 |     } catch (error) {240 |       return false;241 |     }242 |   }243 | 244 |   createInlineKeyboard(buttons: { text: string; callbackData: string }[][]): TelegramReplyMarkup {245 |     return {246 |       inline_keyboard: buttons.map(row =>247 |         row.map(button => ({248 |           text: button.text,249 |           callback_data: button.callbackData,250 |         }))251 |       ),252 |     };253 |   }254 | 255 |   async testConnection(): Promise<{ success: boolean; message: string; botInfo?: TelegramBotInfo }> {256 |     try {257 |       const botInfo = await this.getBotInfo();258 | 259 |       if (botInfo) {260 |         return {261 |           success: true,262 |           message: `Bot connected successfully! Bot name: ${botInfo.first_name} (@${botInfo.username || 'no_username'})`,263 |           botInfo,264 |         };265 |       } else {266 |         return {267 |           success: false,268 |           message: 'Failed to connect to Telegram bot. Please check your bot token.',269 |         };270 |       }271 |     } catch (error) {272 |       return {273 |         success: false,274 |         message: `Connection test failed: ${error instanceof Error ? error.message : 'Unknown error'}`,275 |       };276 |     }277 |   }278 | 279 |   async getUpdates(offset?: number, limit: number = 100): Promise<TelegramUpdate[]> {280 |     try {281 |       const response = await fetch(`${this.baseUrl}/getUpdates?offset=${offset || ''}&limit=${limit}`);282 |       const data = await response.json();283 | 284 |       if (data.ok) {285 |         return data.result;286 |       } else {287 |         return [];288 |       }289 |     } catch (error) {290 |       return [];291 |     }292 |   }293 | }294 | 295 | export function createTelegramService(botToken: string): TelegramService {296 |   return new TelegramService(botToken);297 | }
============================================================END: frontend/lib/services/telegram-service.ts============================================================


============================================================FILE: frontend/lib/services/twilio-service.tsSIZE: 7.34 KB============================================================
  1 | import twilio from 'twilio';  2 | import { WhatsAppMessage, OrchestratorConfig } from '@/lib/types/conversational-orchestrator';  3 |   4 | export class TwilioService {  5 |   private client: twilio.Twilio;  6 |   private config: OrchestratorConfig['twilio'];  7 |   private phoneNumber: string;  8 |   9 |   constructor(config: OrchestratorConfig['twilio']) { 10 |     this.config = config || {}; 11 |     this.phoneNumber = config?.phoneNumber || ''; 12 |  13 |     if (config?.accountSid && config?.authToken) { 14 |       this.client = twilio(config.accountSid, config.authToken); 15 |     } else { 16 |       this.client = null as any; 17 |     } 18 |   } 19 |  20 |   async sendMessage(to: string, message: string): Promise<{success: boolean, messageId?: string, error?: string}> { 21 |     try { 22 |       if (!this.client) { 23 |         return { 24 |           success: false, 25 |           error: 'Twilio not configured' 26 |         }; 27 |       } 28 |  29 |       const response = await this.client.messages.create({ 30 |         body: message, 31 |         from: `whatsapp:${this.phoneNumber}`, 32 |         to: `whatsapp:${to}` 33 |       }); 34 |  35 |       return { 36 |         success: true, 37 |         messageId: response.sid 38 |       }; 39 |     } catch (error) { 40 |       return { 41 |         success: false, 42 |         error: error instanceof Error ? error.message : 'Unknown error' 43 |       }; 44 |     } 45 |   } 46 |  47 |   async sendMediaMessage( 48 |     to: string, 49 |     message: string, 50 |     mediaUrl: string 51 |   ): Promise<{success: boolean, messageId?: string, error?: string}> { 52 |     try { 53 |       const response = await this.client.messages.create({ 54 |         body: message, 55 |         from: `whatsapp:${this.phoneNumber}`, 56 |         to: `whatsapp:${to}`, 57 |         mediaUrl: [mediaUrl] 58 |       }); 59 |  60 |       return { 61 |         success: true, 62 |         messageId: response.sid 63 |       }; 64 |     } catch (error) { 65 |       return { 66 |         success: false, 67 |         error: error instanceof Error ? error.message : 'Unknown error' 68 |       }; 69 |     } 70 |   } 71 |  72 |   parseWebhook(body: Record<string, unknown>): WhatsAppMessage | null { 73 |     try { 74 |  75 |       const message = body.Body; 76 |       const from = body.From; 77 |       const to = body.To; 78 |       const messageId = body.MessageSid; 79 |       const timestamp = body.Timestamp; 80 |       const profileName = body.ProfileName; 81 |  82 |       if (!message || !from || !to || !messageId) { 83 |         return null; 84 |       } 85 |  86 |       return { 87 |         from: String(from).replace('whatsapp:', ''), 88 |         to: String(to).replace('whatsapp:', ''), 89 |         body: String(message), 90 |         messageId: String(messageId), 91 |         timestamp: String(timestamp), 92 |         profileName: String(profileName || '') 93 |       }; 94 |     } catch (error) { 95 |       return null; 96 |     } 97 |   } 98 |  99 |   validateWebhook(signature: string, url: string, params: Record<string, unknown>): boolean {100 |     try {101 |       return twilio.validateRequest(this.config.authToken, signature, url, params);102 |     } catch (error) {103 |       return false;104 |     }105 |   }106 | 107 |   async sendDeliveryConfirmation(to: string): Promise<void> {108 |     try {109 |       await this.sendMessage(to, '✅ Mensaje recibido. Te ayudo en un momento...');110 |     } catch (error) {111 |       }112 |   }113 | 114 |   async sendErrorMessage(to: string, errorType: 'technical' | 'validation' | 'timeout' = 'technical'): Promise<void> {115 |     const errorMessages = {116 |       technical: '⚠️ Disculpa, hay un problema técnico temporal. Por favor intenta de nuevo en unos minutos.',117 |       validation: '❓ No pude entender tu mensaje. ¿Podrías ser más específico?',118 |       timeout: '⏰ La consulta está tomando más tiempo del esperado. Te responderé pronto.'119 |     };120 | 121 |     try {122 |       await this.sendMessage(to, errorMessages[errorType]);123 |     } catch (error) {124 |       }125 |   }126 | 127 |   async sendWelcomeMessage(to: string, userName?: string): Promise<void> {128 |     const welcomeMessage = `🌟 ¡Hola${userName ? ` ${userName}` : ''}!129 | 130 | Bienvenido a nuestro servicio de consultas astrológicas. Estoy aquí para ayudarte con:131 | 132 | • 📅 Agendar citas133 | • 📦 Consultar paquetes disponibles134 | • 💳 Información de pagos135 | • 📊 Estado de tus solicitudes136 | • ❓ Cualquier consulta137 | 138 | ¿En qué puedo ayudarte hoy?`;139 | 140 |     try {141 |       await this.sendMessage(to, welcomeMessage);142 |     } catch (error) {143 |       }144 |   }145 | 146 |   async sendGoodbyeMessage(to: string): Promise<void> {147 |     const goodbyeMessage = `👋 ¡Gracias por contactarnos!148 | 149 | Si tienes más preguntas, no dudes en escribirnos.150 | 151 | ¡Que tengas un excelente día! ✨`;152 | 153 |     try {154 |       await this.sendMessage(to, goodbyeMessage);155 |     } catch (error) {156 |       }157 |   }158 | 159 |   async getMessageInfo(messageId: string): Promise<Record<string, unknown>> {160 |     try {161 |       const message = await this.client.messages(messageId).fetch();162 |       return {163 |         sid: message.sid,164 |         status: message.status,165 |         direction: message.direction,166 |         from: message.from,167 |         to: message.to,168 |         body: message.body,169 |         dateCreated: message.dateCreated,170 |         dateUpdated: message.dateUpdated,171 |         errorCode: message.errorCode,172 |         errorMessage: message.errorMessage173 |       };174 |     } catch (error) {175 |       throw error;176 |     }177 |   }178 | 179 |   async healthCheck(): Promise<boolean> {180 |     try {181 | 182 |       await this.client.api.accounts(this.config.accountSid).fetch();183 |       return true;184 |     } catch (error) {185 |       return false;186 |     }187 |   }188 | 189 |   formatPhoneNumber(phoneNumber: string): string {190 | 191 |     const cleaned = phoneNumber.replace(/\D/g, '');192 | 193 |     if (cleaned.length === 10) {194 |       return `+1${cleaned}`;195 |     }196 | 197 |     if (cleaned.length > 10) {198 |       return `+${cleaned}`;199 |     }200 | 201 |     return phoneNumber;202 |   }203 | 204 |   isValidPhoneNumber(phoneNumber: string): boolean {205 |     const cleaned = phoneNumber.replace(/\D/g, '');206 |     return cleaned.length >= 10 && cleaned.length <= 15;207 |   }208 | }
============================================================END: frontend/lib/services/twilio-service.ts============================================================


============================================================FILE: frontend/lib/state/index.tsSIZE: 11.48 KB============================================================
  1 | import { useState, useEffect, useCallback } from 'react';  2 | import { api, ApiResponse } from '@/lib/api';  3 |   4 | export interface UseApiState<T> {  5 |   data: T | null;  6 |   loading: boolean;  7 |   error: string | null;  8 |   refetch: () => Promise<void>;  9 | } 10 |  11 | export interface UseApiOptions { 12 |   immediate?: boolean; 13 |   cache?: boolean; 14 |   onSuccess?: (data: unknown) => void; 15 |   onError?: (error: string) => void; 16 | } 17 |  18 | export function useApi<T>( 19 |   apiCall: () => Promise<ApiResponse<T>>, 20 |   options: UseApiOptions = {} 21 | ): UseApiState<T> { 22 |   const { immediate = true, onSuccess, onError } = options; 23 |  24 |   const [data, setData] = useState<T | null>(null); 25 |   const [loading, setLoading] = useState(false); 26 |   const [error, setError] = useState<string | null>(null); 27 |   const [isInitialized, setIsInitialized] = useState(false); 28 |  29 |   const fetchData = useCallback(async () => { 30 |     try { 31 |       setLoading(true); 32 |       setError(null); 33 |  34 |       const response = await apiCall(); 35 |  36 |       if (response.success && response.data) { 37 |         setData(response.data); 38 |         onSuccess?.(response.data); 39 |       } else { 40 |         const errorMessage = response.error || response.message || 'Failed to fetch data'; 41 |         setError(errorMessage); 42 |         onError?.(errorMessage); 43 |       } 44 |     } catch (err) { 45 |       const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred'; 46 |       setError(errorMessage); 47 |       onError?.(errorMessage); 48 |     } finally { 49 |       setLoading(false); 50 |       setIsInitialized(true); 51 |     } 52 |   }, [apiCall, onSuccess, onError]); 53 |  54 |   useEffect(() => { 55 |     if (immediate && !isInitialized) { 56 |       fetchData(); 57 |     } 58 |   }, [immediate, isInitialized, fetchData]); 59 |  60 |   return { 61 |     data, 62 |     loading, 63 |     error, 64 |     refetch: fetchData, 65 |   }; 66 | } 67 |  68 | export function useClients(options: UseApiOptions = {}) { 69 |   return useApi(() => api.clients.getAll({ enhanced: true }), options); 70 | } 71 |  72 | export function useClient(id: string, options: UseApiOptions = {}) { 73 |   return useApi(() => api.clients.getById(id), options); 74 | } 75 |  76 | export function useCreateClient() { 77 |   const [loading, setLoading] = useState(false); 78 |   const [error, setError] = useState<string | null>(null); 79 |  80 |   const createClient = useCallback(async (clientData: Record<string, unknown>) => { 81 |     try { 82 |       setLoading(true); 83 |       setError(null); 84 |  85 |       const response = await api.clients.create(clientData); 86 |  87 |       if (response.success) { 88 |         return response.data; 89 |       } else { 90 |         const errorMessage = response.error || response.message || 'Failed to create client'; 91 |         setError(errorMessage); 92 |         throw new Error(errorMessage); 93 |       } 94 |     } catch (err) { 95 |       const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred'; 96 |       setError(errorMessage); 97 |       throw err; 98 |     } finally { 99 |       setLoading(false);100 |     }101 |   }, []);102 | 103 |   return {104 |     createClient,105 |     loading,106 |     error,107 |   };108 | }109 | 110 | export function useUpdateClient() {111 |   const [loading, setLoading] = useState(false);112 |   const [error, setError] = useState<string | null>(null);113 | 114 |   const updateClient = useCallback(async (id: string, clientData: Record<string, unknown>) => {115 |     try {116 |       setLoading(true);117 |       setError(null);118 | 119 |       const response = await api.clients.update(id, clientData);120 | 121 |       if (response.success) {122 |         return response.data;123 |       } else {124 |         const errorMessage = response.error || response.message || 'Failed to update client';125 |         setError(errorMessage);126 |         throw new Error(errorMessage);127 |       }128 |     } catch (err) {129 |       const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';130 |       setError(errorMessage);131 |       throw err;132 |     } finally {133 |       setLoading(false);134 |     }135 |   }, []);136 | 137 |   return {138 |     updateClient,139 |     loading,140 |     error,141 |   };142 | }143 | 144 | export function useDeleteClient() {145 |   const [loading, setLoading] = useState(false);146 |   const [error, setError] = useState<string | null>(null);147 | 148 |   const deleteClient = useCallback(async (id: string) => {149 |     try {150 |       setLoading(true);151 |       setError(null);152 | 153 |       const response = await api.clients.delete(id);154 | 155 |       if (response.success) {156 |         return true;157 |       } else {158 |         const errorMessage = response.error || response.message || 'Failed to delete client';159 |         setError(errorMessage);160 |         throw new Error(errorMessage);161 |       }162 |     } catch (err) {163 |       const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';164 |       setError(errorMessage);165 |       throw err;166 |     } finally {167 |       setLoading(false);168 |     }169 |   }, []);170 | 171 |   return {172 |     deleteClient,173 |     loading,174 |     error,175 |   };176 | }177 | 178 | export function useBookings(params?: Record<string, unknown>, options: UseApiOptions = {}) {179 |   return useApi(() => api.bookings.getAll(params), options);180 | }181 | 182 | export function useCreateBooking() {183 |   const [loading, setLoading] = useState(false);184 |   const [error, setError] = useState<string | null>(null);185 | 186 |   const createBooking = useCallback(async (bookingData: Record<string, unknown>) => {187 |     try {188 |       setLoading(true);189 |       setError(null);190 | 191 |       const response = await api.bookings.create(bookingData);192 | 193 |       if (response.success) {194 |         return response.data;195 |       } else {196 |         const errorMessage = response.error || response.message || 'Failed to create booking';197 |         setError(errorMessage);198 |         throw new Error(errorMessage);199 |       }200 |     } catch (err) {201 |       const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';202 |       setError(errorMessage);203 |       throw err;204 |     } finally {205 |       setLoading(false);206 |     }207 |   }, []);208 | 209 |   return {210 |     createBooking,211 |     loading,212 |     error,213 |   };214 | }215 | 216 | export function usePackages(options: UseApiOptions = {}) {217 |   return useApi(() => api.packages.getAll(), options);218 | }219 | 220 | export function useCreatePackage() {221 |   const [loading, setLoading] = useState(false);222 |   const [error, setError] = useState<string | null>(null);223 | 224 |   const createPackage = useCallback(async (packageData: Record<string, unknown>) => {225 |     try {226 |       setLoading(true);227 |       setError(null);228 | 229 |       const response = await api.packages.create(packageData);230 | 231 |       if (response.success) {232 |         return response.data;233 |       } else {234 |         const errorMessage = response.error || response.message || 'Failed to create package';235 |         setError(errorMessage);236 |         throw new Error(errorMessage);237 |       }238 |     } catch (err) {239 |       const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';240 |       setError(errorMessage);241 |       throw err;242 |     } finally {243 |       setLoading(false);244 |     }245 |   }, []);246 | 247 |   return {248 |     createPackage,249 |     loading,250 |     error,251 |   };252 | }253 | 254 | export function useDashboardStats(options: UseApiOptions = {}) {255 |   return useApi(() => api.dashboard.getStats(), options);256 | }257 | 258 | export interface GlobalState {259 |   theme: 'light' | 'dark';260 |   language: 'en' | 'es';261 |   sidebarCollapsed: boolean;262 |   notifications: Notification[];263 | }264 | 265 | export interface Notification {266 |   id: string;267 |   type: 'success' | 'warning' | 'error' | 'info';268 |   title: string;269 |   message: string;270 |   timestamp: Date;271 |   read: boolean;272 | }273 | 274 | const initialState: GlobalState = {275 |   theme: 'dark',276 |   language: 'en',277 |   sidebarCollapsed: false,278 |   notifications: [],279 | };280 | 281 | export function useGlobalState() {282 |   const [state, setState] = useState<GlobalState>(initialState);283 | 284 |   const updateState = useCallback((updates: Partial<GlobalState>) => {285 |     setState(prev => ({ ...prev, ...updates }));286 |   }, []);287 | 288 |   const toggleTheme = useCallback(() => {289 |     setState(prev => ({290 |       ...prev,291 |       theme: prev.theme === 'light' ? 'dark' : 'light',292 |     }));293 |   }, []);294 | 295 |   const toggleSidebar = useCallback(() => {296 |     setState(prev => ({297 |       ...prev,298 |       sidebarCollapsed: !prev.sidebarCollapsed,299 |     }));300 |   }, []);301 | 302 |   const addNotification = useCallback((notification: Omit<Notification, 'id' | 'timestamp' | 'read'>) => {303 |     const newNotification: Notification = {304 |       ...notification,305 |       id: Math.random().toString(36).substr(2, 9),306 |       timestamp: new Date(),307 |       read: false,308 |     };309 | 310 |     setState(prev => ({311 |       ...prev,312 |       notifications: [newNotification, ...prev.notifications],313 |     }));314 |   }, []);315 | 316 |   const markNotificationAsRead = useCallback((id: string) => {317 |     setState(prev => ({318 |       ...prev,319 |       notifications: prev.notifications.map(notification =>320 |         notification.id === id ? { ...notification, read: true } : notification321 |       ),322 |     }));323 |   }, []);324 | 325 |   const clearNotifications = useCallback(() => {326 |     setState(prev => ({327 |       ...prev,328 |       notifications: [],329 |     }));330 |   }, []);331 | 332 |   return {333 |     ...state,334 |     updateState,335 |     toggleTheme,336 |     toggleSidebar,337 |     addNotification,338 |     markNotificationAsRead,339 |     clearNotifications,340 |   };341 | }342 | 343 | export function useCache() {344 |   const clearAllCache = useCallback(() => {345 |     api.clients.clearCache();346 |     api.bookings.clearCache();347 |     api.packages.clearCache();348 |     api.dashboard.clearCache();349 |   }, []);350 | 351 |   const clearCacheByKey = useCallback((key: string) => {352 |     if (key.startsWith('clients:')) {353 |       api.clients.clearCache(key);354 |     } else if (key.startsWith('bookings:')) {355 |       api.bookings.clearCache(key);356 |     } else if (key.startsWith('packages:')) {357 |       api.packages.clearCache(key);358 |     } else if (key.startsWith('dashboard:')) {359 |       api.dashboard.clearCache(key);360 |     }361 |   }, []);362 | 363 |   return {364 |     clearAllCache,365 |     clearCacheByKey,366 |   };367 | }368 | 369 | const stateHooks = {370 | 371 |   useApi,372 | 373 |   useClients,374 |   useClient,375 |   useCreateClient,376 |   useUpdateClient,377 |   useDeleteClient,378 | 379 |   useBookings,380 |   useCreateBooking,381 | 382 |   usePackages,383 |   useCreatePackage,384 | 385 |   useDashboardStats,386 | 387 |   useGlobalState,388 |   useCache,389 | };390 | 391 | export default stateHooks;
============================================================END: frontend/lib/state/index.ts============================================================


============================================================FILE: frontend/lib/stripe/config.tsSIZE: 1.86 KB============================================================
  1 | import Stripe from 'stripe';  2 | import { loadStripe } from '@stripe/stripe-js';  3 |   4 | export const stripeConfig = {  5 |   publishableKey: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!,  6 |   secretKey: process.env.STRIPE_SECRET_KEY!,  7 |   webhookSecret: process.env.STRIPE_WEBHOOK_SECRET!,  8 |   currency: 'usd',  9 |   mode: 'payment', 10 | }; 11 |  12 | let stripeInstance: Stripe | null = null; 13 |  14 | export const getStripe = (): Stripe | null => { 15 |   if (!stripeInstance) { 16 |     if (!stripeConfig.secretKey) { 17 |       return null; 18 |     } 19 |     stripeInstance = new Stripe(stripeConfig.secretKey, { 20 |       apiVersion: '2025-08-27.basil', 21 |       typescript: true, 22 |     }); 23 |   } 24 |   return stripeInstance; 25 | }; 26 |  27 | export const stripe = getStripe(); 28 |  29 | export const getStripeClient = () => { 30 |   if (typeof window !== 'undefined') { 31 |     return loadStripe(stripeConfig.publishableKey); 32 |   } 33 |   return null; 34 | }; 35 |  36 | export const STRIPE_PAYMENT_METHODS = { 37 |   CREDIT_CARD: 'card', 38 |   BANK_TRANSFER: 'bank_transfer', 39 |   WALLET: 'wallet', 40 | }; 41 |  42 | export const STRIPE_PAYMENT_STATUS = { 43 |   PENDING: 'pending', 44 |   SUCCEEDED: 'succeeded', 45 |   FAILED: 'failed', 46 |   CANCELED: 'canceled', 47 |   PROCESSING: 'processing', 48 |   REQUIRES_ACTION: 'requires_action', 49 |   REQUIRES_CONFIRMATION: 'requires_confirmation', 50 |   REQUIRES_PAYMENT_METHOD: 'requires_payment_method', 51 | }; 52 |  53 | export const STRIPE_ERROR_CODES = { 54 |   CARD_DECLINED: 'card_declined', 55 |   INSUFFICIENT_FUNDS: 'insufficient_funds', 56 |   EXPIRED_CARD: 'expired_card', 57 |   INCORRECT_CVC: 'incorrect_cvc', 58 |   PROCESSING_ERROR: 'processing_error', 59 |   INVALID_REQUEST: 'invalid_request', 60 | };
============================================================END: frontend/lib/stripe/config.ts============================================================


============================================================FILE: frontend/lib/stripe/index.tsSIZE: 0.30 KB============================================================
  1 | export * from './config';  2 |   3 | export * from './payment-service';  4 |   5 | export { default as StripeCheckout } from '@/components/stripe/StripeCheckout';  6 | export { default as StripePaymentMethod } from '@/components/payment/StripePaymentMethod';
============================================================END: frontend/lib/stripe/index.ts============================================================


============================================================FILE: frontend/lib/stripe/payment-service.tsSIZE: 11.88 KB============================================================
  1 | import { getStripe } from './config';  2 |   3 | export interface CreateCheckoutSessionParams {  4 |   customerId?: string;  5 |   customerEmail?: string;  6 |   lineItems: Array<{  7 |     price_data: {  8 |       currency: string;  9 |       product_data: { 10 |         name: string; 11 |         description?: string; 12 |         images?: string[]; 13 |       }; 14 |       unit_amount: number; 15 |     }; 16 |     quantity: number; 17 |   }>; 18 |   successUrl: string; 19 |   cancelUrl: string; 20 |   metadata?: Record<string, string>; 21 |   mode?: 'payment' | 'subscription'; 22 |   paymentMethodTypes?: ('card' | 'sepa_debit' | 'sofort' | 'ideal' | 'bancontact' | 'eps' | 'giropay' | 'p24')[]; 23 | } 24 |  25 | export interface CreatePaymentIntentParams { 26 |   amount: number; 27 |   currency: string; 28 |   customerId?: string; 29 |   customerEmail?: string; 30 |   metadata?: Record<string, string>; 31 |   paymentMethodTypes?: ('card' | 'sepa_debit' | 'sofort' | 'ideal' | 'bancontact' | 'eps' | 'giropay' | 'p24')[]; 32 |   description?: string; 33 | } 34 |  35 | export interface PaymentMethodData { 36 |   type: string; 37 |   card?: { 38 |     brand: string; 39 |     last4: string; 40 |     exp_month: number; 41 |     exp_year: number; 42 |   }; 43 |   billing_details?: { 44 |     name?: string; 45 |     email?: string; 46 |     phone?: string; 47 |     address?: { 48 |       country?: string; 49 |       state?: string; 50 |       city?: string; 51 |       line1?: string; 52 |       line2?: string; 53 |       postal_code?: string; 54 |     }; 55 |   }; 56 | } 57 |  58 | export class StripePaymentService { 59 |  60 |   static async createCheckoutSession(params: CreateCheckoutSessionParams) { 61 |     try { 62 |       const stripe = getStripe(); 63 |       if (!stripe) { 64 |         throw new Error('Stripe not initialized'); 65 |       } 66 |       const session = await stripe.checkout.sessions.create({ 67 |         customer: params.customerId, 68 |         customer_email: params.customerEmail, 69 |         line_items: params.lineItems, 70 |         mode: params.mode || 'payment', 71 |         success_url: params.successUrl, 72 |         cancel_url: params.cancelUrl, 73 |         metadata: params.metadata, 74 |         payment_method_types: params.paymentMethodTypes || ['card'], 75 |         billing_address_collection: 'required', 76 |         shipping_address_collection: { 77 |           allowed_countries: ['US', 'CA', 'GB', 'DE', 'FR', 'ES', 'IT'], 78 |         }, 79 |         allow_promotion_codes: true, 80 |         automatic_tax: { 81 |           enabled: true, 82 |         }, 83 |       }); 84 |  85 |       return { 86 |         success: true, 87 |         sessionId: session.id, 88 |         url: session.url, 89 |         data: session, 90 |       }; 91 |     } catch (error) { 92 |       return { 93 |         success: false, 94 |         error: error instanceof Error ? error.message : 'Unknown error', 95 |       }; 96 |     } 97 |   } 98 |  99 |   static async createPaymentIntent(params: CreatePaymentIntentParams) {100 |     try {101 |       const stripe = getStripe();102 |       if (!stripe) {103 |         throw new Error('Stripe not initialized');104 |       }105 |       const paymentIntent = await stripe.paymentIntents.create({106 |         amount: params.amount,107 |         currency: params.currency,108 |         customer: params.customerId,109 |         receipt_email: params.customerEmail,110 |         metadata: params.metadata,111 |         payment_method_types: params.paymentMethodTypes || ['card'],112 |         description: params.description,113 |         automatic_payment_methods: {114 |           enabled: true,115 |         },116 |       });117 | 118 |       return {119 |         success: true,120 |         clientSecret: paymentIntent.client_secret,121 |         paymentIntentId: paymentIntent.id,122 |         data: paymentIntent,123 |       };124 |     } catch (error) {125 |       return {126 |         success: false,127 |         error: error instanceof Error ? error.message : 'Unknown error',128 |       };129 |     }130 |   }131 | 132 |   static async getCheckoutSession(sessionId: string) {133 |     try {134 |       const stripe = getStripe();135 |       if (!stripe) {136 |         throw new Error('Stripe not initialized');137 |       }138 |       const session = await stripe.checkout.sessions.retrieve(sessionId);139 |       return {140 |         success: true,141 |         data: session,142 |       };143 |     } catch (error) {144 |       return {145 |         success: false,146 |         error: error instanceof Error ? error.message : 'Unknown error',147 |       };148 |     }149 |   }150 | 151 |   static async getPaymentIntent(paymentIntentId: string) {152 |     try {153 |       const stripe = getStripe();154 |       if (!stripe) {155 |         throw new Error('Stripe not initialized');156 |       }157 |       const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);158 |       return {159 |         success: true,160 |         data: paymentIntent,161 |       };162 |     } catch (error) {163 |       return {164 |         success: false,165 |         error: error instanceof Error ? error.message : 'Unknown error',166 |       };167 |     }168 |   }169 | 170 |   static async confirmPaymentIntent(paymentIntentId: string, paymentMethodId: string) {171 |     try {172 |       const stripe = getStripe();173 |       if (!stripe) {174 |         throw new Error('Stripe not initialized');175 |       }176 |       const paymentIntent = await stripe.paymentIntents.confirm(paymentIntentId, {177 |         payment_method: paymentMethodId,178 |       });179 | 180 |       return {181 |         success: true,182 |         data: paymentIntent,183 |       };184 |     } catch (error) {185 |       return {186 |         success: false,187 |         error: error instanceof Error ? error.message : 'Unknown error',188 |       };189 |     }190 |   }191 | 192 |   static async cancelPaymentIntent(paymentIntentId: string) {193 |     try {194 |       const stripe = getStripe();195 |       if (!stripe) {196 |         throw new Error('Stripe not initialized');197 |       }198 |       const paymentIntent = await stripe.paymentIntents.cancel(paymentIntentId);199 | 200 |       return {201 |         success: true,202 |         data: paymentIntent,203 |       };204 |     } catch (error) {205 |       return {206 |         success: false,207 |         error: error instanceof Error ? error.message : 'Unknown error',208 |       };209 |     }210 |   }211 | 212 |   static async createCustomer(params: {213 |     email: string;214 |     name?: string;215 |     phone?: string;216 |     metadata?: Record<string, string>;217 |   }) {218 |     try {219 |       const stripe = getStripe();220 |       if (!stripe) {221 |         throw new Error('Stripe not initialized');222 |       }223 |       const customer = await stripe.customers.create({224 |         email: params.email,225 |         name: params.name,226 |         phone: params.phone,227 |         metadata: params.metadata,228 |       });229 | 230 |       return {231 |         success: true,232 |         customerId: customer.id,233 |         data: customer,234 |       };235 |     } catch (error) {236 |       return {237 |         success: false,238 |         error: error instanceof Error ? error.message : 'Unknown error',239 |       };240 |     }241 |   }242 | 243 |   static async getCustomer(customerId: string) {244 |     try {245 |       const stripe = getStripe();246 |       if (!stripe) {247 |         throw new Error('Stripe not initialized');248 |       }249 |       const customer = await stripe.customers.retrieve(customerId);250 | 251 |       return {252 |         success: true,253 |         data: customer,254 |       };255 |     } catch (error) {256 |       return {257 |         success: false,258 |         error: error instanceof Error ? error.message : 'Unknown error',259 |       };260 |     }261 |   }262 | 263 |   static async updateCustomer(customerId: string, params: {264 |     email?: string;265 |     name?: string;266 |     phone?: string;267 |     metadata?: Record<string, string>;268 |   }) {269 |     try {270 |       const stripe = getStripe();271 |       if (!stripe) {272 |         throw new Error('Stripe not initialized');273 |       }274 |       const customer = await stripe.customers.update(customerId, params);275 | 276 |       return {277 |         success: true,278 |         data: customer,279 |       };280 |     } catch (error) {281 |       return {282 |         success: false,283 |         error: error instanceof Error ? error.message : 'Unknown error',284 |       };285 |     }286 |   }287 | 288 |   static async deleteCustomer(customerId: string) {289 |     try {290 |       const stripe = getStripe();291 |       if (!stripe) {292 |         throw new Error('Stripe not initialized');293 |       }294 |       const customer = await stripe.customers.del(customerId);295 | 296 |       return {297 |         success: true,298 |         data: customer,299 |       };300 |     } catch (error) {301 |       return {302 |         success: false,303 |         error: error instanceof Error ? error.message : 'Unknown error',304 |       };305 |     }306 |   }307 | 308 |   static async createPaymentMethod(params: {309 |     type: 'card' | 'sepa_debit' | 'sofort' | 'ideal' | 'bancontact' | 'eps' | 'giropay' | 'p24';310 |     card?: {311 |       token: string;312 |     };313 |     billing_details?: {314 |       name?: string;315 |       email?: string;316 |       phone?: string;317 |       address?: {318 |         country?: string;319 |         state?: string;320 |         city?: string;321 |         line1?: string;322 |         line2?: string;323 |         postal_code?: string;324 |       };325 |     };326 |   }) {327 |     try {328 |       const stripe = getStripe();329 |       if (!stripe) {330 |         throw new Error('Stripe not initialized');331 |       }332 |       const paymentMethod = await stripe.paymentMethods.create(params);333 | 334 |       return {335 |         success: true,336 |         paymentMethodId: paymentMethod.id,337 |         data: paymentMethod,338 |       };339 |     } catch (error) {340 |       return {341 |         success: false,342 |         error: error instanceof Error ? error.message : 'Unknown error',343 |       };344 |     }345 |   }346 | 347 |   static async attachPaymentMethod(paymentMethodId: string, customerId: string) {348 |     try {349 |       const stripe = getStripe();350 |       if (!stripe) {351 |         throw new Error('Stripe not initialized');352 |       }353 |       const paymentMethod = await stripe.paymentMethods.attach(paymentMethodId, {354 |         customer: customerId,355 |       });356 | 357 |       return {358 |         success: true,359 |         data: paymentMethod,360 |       };361 |     } catch (error) {362 |       return {363 |         success: false,364 |         error: error instanceof Error ? error.message : 'Unknown error',365 |       };366 |     }367 |   }368 | 369 |   static async detachPaymentMethod(paymentMethodId: string) {370 |     try {371 |       const stripe = getStripe();372 |       if (!stripe) {373 |         throw new Error('Stripe not initialized');374 |       }375 |       const paymentMethod = await stripe.paymentMethods.detach(paymentMethodId);376 | 377 |       return {378 |         success: true,379 |         data: paymentMethod,380 |       };381 |     } catch (error) {382 |       return {383 |         success: false,384 |         error: error instanceof Error ? error.message : 'Unknown error',385 |       };386 |     }387 |   }388 | 389 |   static async listPaymentMethods(customerId: string, params?: {390 |     type?: 'card' | 'sepa_debit' | 'sofort' | 'ideal' | 'bancontact' | 'eps' | 'giropay' | 'p24';391 |     limit?: number;392 |     starting_after?: string;393 |     ending_before?: string;394 |   }) {395 |     try {396 |       const stripe = getStripe();397 |       if (!stripe) {398 |         throw new Error('Stripe not initialized');399 |       }400 |       const paymentMethods = await stripe.paymentMethods.list({401 |         customer: customerId,402 |         type: params?.type || 'card',403 |         limit: params?.limit || 10,404 |         starting_after: params?.starting_after,405 |         ending_before: params?.ending_before,406 |       });407 | 408 |       return {409 |         success: true,410 |         data: paymentMethods,411 |       };412 |     } catch (error) {413 |       return {414 |         success: false,415 |         error: error instanceof Error ? error.message : 'Unknown error',416 |       };417 |     }418 |   }419 | }
============================================================END: frontend/lib/stripe/payment-service.ts============================================================


============================================================FILE: frontend/lib/styles/common.tsSIZE: 12.02 KB============================================================
  1 | export const cardStyles = {  2 |   base: 'bg-[var(--color-surface-primary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-lg)]',  3 |   variants: {  4 |     default: 'bg-[var(--color-surface-primary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-lg)]',  5 |     elevated: 'bg-[var(--color-surface-primary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-lg)] shadow-[var(--shadow-md)]',  6 |     interactive: 'bg-[var(--color-surface-primary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-lg)] hover:bg-[var(--color-surface-secondary)] transition-all duration-200',  7 |     ghost: 'bg-transparent border-none',  8 |     outlined: 'bg-transparent border border-[var(--color-border-500)] rounded-[var(--border-radius-lg)]',  9 |   }, 10 |   sizes: { 11 |     sm: 'p-[var(--spacing-3)]', 12 |     md: 'p-[var(--spacing-4)]', 13 |     lg: 'p-[var(--spacing-6)]', 14 |     xl: 'p-[var(--spacing-8)]', 15 |   }, 16 |   states: { 17 |     hover: 'hover:bg-[var(--color-surface-secondary)]', 18 |     focus: 'focus:ring-2 focus:ring-[var(--color-accent-500)] focus:ring-offset-2', 19 |     active: 'active:scale-95', 20 |   }, 21 | }; 22 |  23 | export const buttonStyles = { 24 |   base: 'inline-flex items-center justify-center font-[var(--font-weight-medium)] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-500)] focus:ring-offset-2 focus:ring-offset-[var(--color-background-primary)] disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 active:scale-95', 25 |   variants: { 26 |     primary: 'bg-[#6ea058] text-white hover:bg-[#5a8a4a] active:bg-[#5a8a4a] border-2 border-[#6ea058] rounded-[var(--border-radius-md)] shadow-lg shadow-[#6ea058]/30 font-[var(--font-weight-semibold)] hover:shadow-xl hover:shadow-[#6ea058]/40 focus:ring-4 focus:ring-[#6ea058]/30 focus:border-[#6ea058]', 27 |     secondary: 'bg-[var(--color-surface-secondary)] text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-md)]', 28 |     outline: 'bg-transparent text-[var(--color-text-primary)] hover:bg-[var(--color-surface-secondary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-md)]', 29 |     danger: 'bg-[var(--color-status-error)] text-white hover:bg-red-600 border-none rounded-[var(--border-radius-md)]', 30 |     success: 'bg-[var(--color-status-success)] text-white hover:bg-green-600 border-none rounded-[var(--border-radius-md)]', 31 |     warning: 'bg-[var(--color-status-warning)] text-white hover:bg-yellow-600 border-none rounded-[var(--border-radius-md)]', 32 |     info: 'bg-[var(--color-status-info)] text-white hover:bg-blue-600 border-none rounded-[var(--border-radius-md)]', 33 |     ghost: 'bg-transparent text-[var(--color-text-primary)] hover:bg-[var(--color-surface-secondary)] border-none rounded-[var(--border-radius-md)]', 34 |   }, 35 |   sizes: { 36 |     xs: 'px-[var(--spacing-1)] py-[var(--spacing-0.5)] text-[var(--font-size-xs)]', 37 |     sm: 'px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-sm)]', 38 |     md: 'px-[var(--spacing-4)] py-[var(--spacing-2)] text-[var(--font-size-base)]', 39 |     lg: 'px-[var(--spacing-6)] py-[var(--spacing-3)] text-[var(--font-size-lg)]', 40 |     xl: 'px-[var(--spacing-8)] py-[var(--spacing-4)] text-[var(--font-size-xl)]', 41 |     login: 'px-[var(--spacing-6)] py-[var(--spacing-4)] text-[var(--font-size-lg)]', 42 |   }, 43 |   states: { 44 |     loading: 'opacity-75 cursor-wait', 45 |     disabled: 'opacity-50 cursor-not-allowed', 46 |   }, 47 | }; 48 |  49 | export const sidebarButtonStyles = { 50 |   base: 'w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors', 51 |   variants: { 52 |     active: 'bg-[var(--color-accent-500)] text-[var(--color-text-inverse)]', 53 |     inactive: 'text-[var(--color-text-secondary)] hover:bg-[var(--color-sidebar-700)] hover:text-[var(--color-text-primary)]', 54 |   }, 55 |   icon: 'w-5 h-5', 56 |   label: 'font-medium', 57 | }; 58 |  59 | export const headerButtonStyles = { 60 |   base: 'inline-flex items-center justify-center font-[var(--font-weight-medium)] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-500)] focus:ring-offset-2 focus:ring-offset-[var(--color-background-primary)] disabled:opacity-50 disabled:cursor-not-allowed', 61 |   variants: { 62 |     primary: 'bg-[var(--color-accent-500)] text-black hover:bg-[var(--color-accent-500)]/90 active:bg-[var(--color-accent-500)]/80 border-2 border-[var(--color-accent-500)] rounded-[var(--border-radius-md)] shadow-lg shadow-[var(--color-accent-500)]/30 font-[var(--font-weight-semibold)] hover:shadow-xl hover:shadow-[var(--color-accent-500)]/40 focus:ring-4 focus:ring-[var(--color-accent-500)]/30 focus:border-[var(--color-accent-500)]', 63 |     secondary: 'bg-[var(--color-surface-secondary)] text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-md)]', 64 |     outline: 'bg-transparent text-[var(--color-text-primary)] hover:bg-[var(--color-surface-secondary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-md)]', 65 |     danger: 'bg-[var(--color-status-error)] text-white hover:bg-red-600 border-none rounded-[var(--border-radius-md)]', 66 |     success: 'bg-[var(--color-status-success)] text-white hover:bg-green-600 border-none rounded-[var(--border-radius-md)]', 67 |     warning: 'bg-[var(--color-status-warning)] text-white hover:bg-yellow-600 border-none rounded-[var(--border-radius-md)]', 68 |     info: 'bg-[var(--color-status-info)] text-white hover:bg-blue-600 border-none rounded-[var(--border-radius-md)]', 69 |     ghost: 'bg-transparent text-[var(--color-text-primary)] hover:bg-[var(--color-surface-secondary)] border-none rounded-[var(--border-radius-md)]', 70 |   }, 71 |   sizes: { 72 |     xs: 'px-[var(--spacing-1)] py-[var(--spacing-0.5)] text-[var(--font-size-xs)]', 73 |     sm: 'px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-sm)]', 74 |     md: 'px-[var(--spacing-4)] py-[var(--spacing-2)] text-[var(--font-size-base)]', 75 |     lg: 'px-[var(--spacing-6)] py-[var(--spacing-3)] text-[var(--font-size-lg)]', 76 |     xl: 'px-[var(--spacing-8)] py-[var(--spacing-4)] text-[var(--font-size-xl)]', 77 |     login: 'px-[var(--spacing-6)] py-[var(--spacing-4)] text-[var(--font-size-lg)]', 78 |   }, 79 |   states: { 80 |     loading: 'opacity-75 cursor-wait', 81 |     disabled: 'opacity-50 cursor-not-allowed', 82 |   }, 83 | }; 84 |  85 | export const inputStyles = { 86 |   base: 'bg-[var(--color-surface-secondary)] border border-[var(--color-border-500)] text-[var(--color-text-primary)] rounded-[var(--border-radius-md)] px-[var(--spacing-3)] py-[var(--spacing-2)] transition-all duration-200', 87 |   variants: { 88 |     default: 'bg-[var(--color-surface-secondary)] border border-[var(--color-border-500)] text-[var(--color-text-primary)] rounded-[var(--border-radius-md)]', 89 |     focus: 'bg-[var(--color-surface-secondary)] border border-[var(--color-accent-500)] text-[var(--color-text-primary)] rounded-[var(--border-radius-md)]', 90 |     success: 'bg-[var(--color-surface-secondary)] border border-[var(--color-status-success)] text-[var(--color-text-primary)] rounded-[var(--border-radius-md)]', 91 |     error: 'bg-[var(--color-surface-secondary)] border border-[var(--color-status-error)] text-[var(--color-text-primary)] rounded-[var(--border-radius-md)]', 92 |     disabled: 'bg-[var(--color-surface-quaternary)] border border-[var(--color-border-400)] text-[var(--color-text-tertiary)] rounded-[var(--border-radius-md)] cursor-not-allowed', 93 |   }, 94 |   sizes: { 95 |     sm: 'px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-sm)]', 96 |     md: 'px-[var(--spacing-3)] py-[var(--spacing-2)] text-[var(--font-size-base)]', 97 |     lg: 'px-[var(--spacing-4)] py-[var(--spacing-3)] text-[var(--font-size-lg)]', 98 |   }, 99 | };100 | 101 | export const selectStyles = {102 |   trigger: 'bg-[var(--color-surface-secondary)] border border-[var(--color-border-500)] text-[var(--color-text-primary)] rounded-[var(--border-radius-md)] px-[var(--spacing-3)] py-[var(--spacing-2)] transition-all duration-200',103 |   content: 'bg-[var(--color-surface-secondary)] border border-[var(--color-border-500)] rounded-[var(--border-radius-md)]',104 |   item: 'text-[var(--color-text-primary)] hover:bg-[var(--color-surface-tertiary)] px-[var(--spacing-3)] py-[var(--spacing-2)]',105 | };106 | 107 | export const badgeStyles = {108 |   default: 'bg-[var(--color-surface-secondary)] text-[var(--color-text-secondary)] rounded-[var(--border-radius-full)] px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-xs)] font-[var(--font-weight-medium)]',109 |   success: 'bg-[var(--color-status-success)] text-white rounded-[var(--border-radius-full)] px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-xs)] font-[var(--font-weight-medium)]',110 |   warning: 'bg-[var(--color-status-warning)] text-white rounded-[var(--border-radius-full)] px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-xs)] font-[var(--font-weight-medium)]',111 |   error: 'bg-[var(--color-status-error)] text-white rounded-[var(--border-radius-full)] px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-xs)] font-[var(--font-weight-medium)]',112 |   info: 'bg-[var(--color-status-info)] text-white rounded-[var(--border-radius-full)] px-[var(--spacing-2)] py-[var(--spacing-1)] text-[var(--font-size-xs)] font-[var(--font-weight-medium)]',113 | };114 | 115 | export const layoutStyles = {116 |   container: 'max-w-7xl mx-auto px-[var(--spacing-4)] sm:px-[var(--spacing-6)] lg:px-[var(--spacing-8)]',117 |   section: 'py-[var(--spacing-12)] sm:py-[var(--spacing-16)] lg:py-[var(--spacing-20)]',118 |   grid: {119 |     cols: {120 |       1: 'grid-cols-1',121 |       2: 'grid-cols-2',122 |       3: 'grid-cols-3',123 |       4: 'grid-cols-4',124 |       5: 'grid-cols-5',125 |       6: 'grid-cols-6',126 |       7: 'grid-cols-7',127 |       8: 'grid-cols-8',128 |       9: 'grid-cols-9',129 |       10: 'grid-cols-10',130 |       11: 'grid-cols-11',131 |       12: 'grid-cols-12',132 |     },133 |     gaps: {134 |       sm: 'gap-[var(--spacing-2)]',135 |       md: 'gap-[var(--spacing-4)]',136 |       lg: 'gap-[var(--spacing-6)]',137 |       xl: 'gap-[var(--spacing-8)]',138 |     },139 |   },140 |   flex: {141 |     center: 'flex items-center justify-center',142 |     between: 'flex items-center justify-between',143 |     start: 'flex items-center justify-start',144 |     end: 'flex items-center justify-end',145 |     col: 'flex flex-col',146 |     row: 'flex flex-row',147 |   },148 |   spacing: {149 |     stack: {150 |       sm: 'space-y-[var(--spacing-2)]',151 |       md: 'space-y-[var(--spacing-4)]',152 |       lg: 'space-y-[var(--spacing-6)]',153 |       xl: 'space-y-[var(--spacing-8)]',154 |     },155 |     inline: {156 |       sm: 'space-x-[var(--spacing-2)]',157 |       md: 'space-x-[var(--spacing-4)]',158 |       lg: 'space-x-[var(--spacing-6)]',159 |       xl: 'space-x-[var(--spacing-8)]',160 |     },161 |   },162 | };163 | 164 | export const animationStyles = {165 |   fadeIn: 'animate-in fade-in duration-300',166 |   slideIn: 'animate-in slide-in-from-bottom-4 duration-300',167 |   scaleIn: 'animate-in zoom-in-95 duration-200',168 |   slideUp: 'animate-in slide-in-from-top-4 duration-300',169 |   slideDown: 'animate-in slide-in-from-bottom-4 duration-300',170 |   slideLeft: 'animate-in slide-in-from-right-4 duration-300',171 |   slideRight: 'animate-in slide-in-from-left-4 duration-300',172 | };173 | 174 | export const combineStyles = (...styles: (string | undefined | null | false)[]): string => {175 |   return styles.filter(Boolean).join(' ');176 | };177 | 178 | export const conditionalStyles = (condition: boolean, trueStyle: string, falseStyle: string = ''): string => {179 |   return condition ? trueStyle : falseStyle;180 | };181 | 182 | export const responsiveStyles = (base: string): string => {183 | 184 |   return base;185 | };186 | 187 | const commonStyles = {188 |   cardStyles,189 |   buttonStyles,190 |   inputStyles,191 |   selectStyles,192 |   badgeStyles,193 |   layoutStyles,194 |   animationStyles,195 |   combineStyles,196 |   conditionalStyles,197 |   responsiveStyles,198 | };199 | 200 | export default commonStyles;
============================================================END: frontend/lib/styles/common.ts============================================================


============================================================FILE: frontend/lib/theme/ThemeProvider.tsxSIZE: 3.18 KB============================================================
  1 | 'use client';  2 |   3 | import React, { createContext, useContext, useEffect, useState, useMemo } from 'react';  4 | import { ThemeColors, currentTheme, darkTheme, applyTheme } from './theme-config';  5 |   6 | export type ThemeName = 'light' | 'dark' | 'custom';  7 |   8 | interface ThemeContextType {  9 |   theme: ThemeColors; 10 |   themeName: ThemeName; 11 |   setTheme: (theme: ThemeColors, name?: ThemeName) => void; 12 |   switchToTheme: (name: ThemeName) => void; 13 |   availableThemes: Record<ThemeName, ThemeColors>; 14 | } 15 |  16 | const ThemeContext = createContext<ThemeContextType | undefined>(undefined); 17 |  18 | interface ThemeProviderProps { 19 |   children: React.ReactNode; 20 |   initialTheme?: ThemeName; 21 | } 22 |  23 | export function ThemeProvider({ children, initialTheme = 'light' }: ThemeProviderProps) { 24 |   const availableThemes: Record<ThemeName, ThemeColors> = useMemo(() => ({ 25 |     light: currentTheme, 26 |     dark: darkTheme, 27 |     custom: currentTheme, 28 |   }), []); 29 |  30 |   const [theme, setThemeState] = useState<ThemeColors>(availableThemes[initialTheme]); 31 |   const [themeName, setThemeName] = useState<ThemeName>(initialTheme); 32 |  33 |   useEffect(() => { 34 |     applyTheme(theme); 35 |   }, [theme]); 36 |  37 |   useEffect(() => { 38 |     if (typeof window !== 'undefined') { 39 |       const savedTheme = localStorage.getItem('app-theme') as ThemeName; 40 |       if (savedTheme && availableThemes[savedTheme]) { 41 |         setThemeState(availableThemes[savedTheme]); 42 |         setThemeName(savedTheme); 43 |       } 44 |     } 45 |   }, [availableThemes]); 46 |  47 |   const setTheme = (newTheme: ThemeColors, name: ThemeName = 'custom') => { 48 |     setThemeState(newTheme); 49 |     setThemeName(name); 50 |  51 |     if (typeof window !== 'undefined') { 52 |       localStorage.setItem('app-theme', name); 53 |       if (name === 'custom') { 54 |         localStorage.setItem('custom-theme', JSON.stringify(newTheme)); 55 |       } 56 |     } 57 |   }; 58 |  59 |   const switchToTheme = (name: ThemeName) => { 60 |     let themeToApply = availableThemes[name]; 61 |  62 |     if (name === 'custom' && typeof window !== 'undefined') { 63 |       const savedCustomTheme = localStorage.getItem('custom-theme'); 64 |       if (savedCustomTheme) { 65 |         try { 66 |           themeToApply = JSON.parse(savedCustomTheme); 67 |         } catch { 68 |           } 69 |       } 70 |     } 71 |  72 |     setTheme(themeToApply, name); 73 |   }; 74 |  75 |   const value: ThemeContextType = { 76 |     theme, 77 |     themeName, 78 |     setTheme, 79 |     switchToTheme, 80 |     availableThemes, 81 |   }; 82 |  83 |   return ( 84 |     <ThemeContext.Provider value={value}> 85 |       {children} 86 |     </ThemeContext.Provider> 87 |   ); 88 | } 89 |  90 | export function useTheme() { 91 |   const context = useContext(ThemeContext); 92 |   if (context === undefined) { 93 |     throw new Error('useTheme must be used within a ThemeProvider'); 94 |   } 95 |   return context; 96 | } 97 |  98 | export function useThemeColors() { 99 |   const { theme } = useTheme();100 |   return theme;101 | }102 | 103 | export function useThemeSwitcher() {104 |   const { switchToTheme, themeName, availableThemes } = useTheme();105 |   return { switchToTheme, currentTheme: themeName, availableThemes };106 | }
============================================================END: frontend/lib/theme/ThemeProvider.tsx============================================================


============================================================FILE: frontend/lib/theme/index.tsSIZE: 0.68 KB============================================================
  1 | export * from './theme-config';  2 | export * from './ThemeProvider';  3 | export * from './theme-utils';  4 |   5 | export { ThemeManager } from '../../components/theme/ThemeManager';  6 |   7 | export {  8 |   currentTheme as defaultTheme,  9 |   darkTheme, 10 |   type ThemeColors, 11 |   themeToCSSVariables, 12 |   applyTheme 13 | } from './theme-config'; 14 |  15 | export { 16 |   useTheme, 17 |   useThemeColors, 18 |   useThemeSwitcher, 19 |   ThemeProvider 20 | } from './ThemeProvider'; 21 |  22 | export { 23 |   themeClasses, 24 |   combineThemeClasses, 25 |   getCSSVariable, 26 |   setCSSVariable, 27 |   generateColorVariants 28 | } from './theme-utils';
============================================================END: frontend/lib/theme/index.ts============================================================


============================================================FILE: frontend/lib/theme/theme-config.tsSIZE: 5.03 KB============================================================
  1 | export interface ThemeColors {  2 |   3 |   primary: {  4 |     main: string;  5 |     hover: string;  6 |     light: string;  7 |     dark: string;  8 |     contrast: string;  9 |   }; 10 |  11 |   background: { 12 |     primary: string; 13 |     secondary: string; 14 |     tertiary: string; 15 |     surface: string; 16 |   }; 17 |  18 |   text: { 19 |     primary: string; 20 |     secondary: string; 21 |     tertiary: string; 22 |     inverse: string; 23 |   }; 24 |  25 |   accent: { 26 |     main: string; 27 |     hover: string; 28 |     light: string; 29 |     dark: string; 30 |     contrast: string; 31 |   }; 32 |  33 |   status: { 34 |     success: string; 35 |     warning: string; 36 |     error: string; 37 |     info: string; 38 |   }; 39 |  40 |   border: { 41 |     light: string; 42 |     medium: string; 43 |     dark: string; 44 |   }; 45 | } 46 |  47 | export const currentTheme: ThemeColors = { 48 |   primary: { 49 |     main: '#6ea058', 50 |     hover: '#5a8a47', 51 |     light: '#8bb570', 52 |     dark: '#4f7c41', 53 |     contrast: '#ffffff', 54 |   }, 55 |  56 |   background: { 57 |     primary: '#f4eeed', 58 |     secondary: '#ede6e5', 59 |     tertiary: '#e0d6d4', 60 |     surface: '#ffffff', 61 |   }, 62 |  63 |   text: { 64 |     primary: '#383838', 65 |     secondary: '#666666', 66 |     tertiary: '#888888', 67 |     inverse: '#ffffff', 68 |   }, 69 |  70 |   accent: { 71 |     main: '#f4a556', 72 |     hover: '#e07c2f', 73 |     light: '#f5b369', 74 |     dark: '#bb5f25', 75 |     contrast: '#383838', 76 |   }, 77 |  78 |   status: { 79 |     success: '#6ea058', 80 |     warning: '#f4a556', 81 |     error: '#dc2626', 82 |     info: '#3b82f6', 83 |   }, 84 |  85 |   border: { 86 |     light: '#e0d6d4', 87 |     medium: '#c7b8b5', 88 |     dark: '#a89490', 89 |   }, 90 | }; 91 |  92 | export const darkTheme: ThemeColors = { 93 |   primary: { 94 |     main: '#6ea058', 95 |     hover: '#5a8a47', 96 |     light: '#8bb570', 97 |     dark: '#4f7c41', 98 |     contrast: '#ffffff', 99 |   },100 | 101 |   background: {102 |     primary: '#0a0a23',103 |     secondary: '#1a1a2e',104 |     tertiary: '#16213e',105 |     surface: '#1a1a2e',106 |   },107 | 108 |   text: {109 |     primary: '#ffffff',110 |     secondary: '#c0c0c0',111 |     tertiary: '#94a3b8',112 |     inverse: '#0a0a23',113 |   },114 | 115 |   accent: {116 |     main: '#f4a556',117 |     hover: '#e07c2f',118 |     light: '#f5b369',119 |     dark: '#bb5f25',120 |     contrast: '#ffffff',121 |   },122 | 123 |   status: {124 |     success: '#10b981',125 |     warning: '#f59e0b',126 |     error: '#ef4444',127 |     info: '#3b82f6',128 |   },129 | 130 |   border: {131 |     light: '#2a2a4a',132 |     medium: '#475569',133 |     dark: '#334155',134 |   },135 | };136 | 137 | export function themeToCSSVariables(theme: ThemeColors): Record<string, string> {138 |   return {139 | 140 |     '--color-primary-main': theme.primary.main,141 |     '--color-primary-hover': theme.primary.hover,142 |     '--color-primary-light': theme.primary.light,143 |     '--color-primary-dark': theme.primary.dark,144 |     '--color-primary-contrast': theme.primary.contrast,145 | 146 |     '--color-background-primary': theme.background.primary,147 |     '--color-background-secondary': theme.background.secondary,148 |     '--color-background-tertiary': theme.background.tertiary,149 |     '--color-background-surface': theme.background.surface,150 | 151 |     '--color-text-primary': theme.text.primary,152 |     '--color-text-secondary': theme.text.secondary,153 |     '--color-text-tertiary': theme.text.tertiary,154 |     '--color-text-inverse': theme.text.inverse,155 | 156 |     '--color-accent-main': theme.accent.main,157 |     '--color-accent-hover': theme.accent.hover,158 |     '--color-accent-light': theme.accent.light,159 |     '--color-accent-dark': theme.accent.dark,160 |     '--color-accent-contrast': theme.accent.contrast,161 | 162 |     '--color-status-success': theme.status.success,163 |     '--color-status-warning': theme.status.warning,164 |     '--color-status-error': theme.status.error,165 |     '--color-status-info': theme.status.info,166 | 167 |     '--color-border-light': theme.border.light,168 |     '--color-border-medium': theme.border.medium,169 |     '--color-border-dark': theme.border.dark,170 |   };171 | }172 | 173 | export function applyTheme(theme: ThemeColors) {174 |   if (typeof document === 'undefined') return;175 | 176 |   const cssVars = themeToCSSVariables(theme);177 |   const root = document.documentElement;178 | 179 |   Object.entries(cssVars).forEach(([property, value]) => {180 |     root.style.setProperty(property, value);181 |   });182 | }183 | 184 | export default currentTheme;
============================================================END: frontend/lib/theme/theme-config.ts============================================================


============================================================FILE: frontend/lib/theme/theme-utils.tsSIZE: 4.70 KB============================================================
  1 | export const themeClasses = {  2 |   3 |   button: {  4 |     primary: 'bg-[var(--color-primary-main)] text-[var(--color-primary-contrast)] hover:bg-[var(--color-primary-hover)] focus:ring-[var(--color-primary-main)]/50 shadow-lg transition-all duration-200',  5 |     secondary: 'bg-[var(--color-background-surface)] text-[var(--color-text-primary)] hover:bg-[var(--color-background-tertiary)] focus:ring-[var(--color-primary-main)]/50 border border-[var(--color-border-medium)] transition-all duration-200',  6 |     accent: 'bg-[var(--color-accent-main)] text-[var(--color-accent-contrast)] hover:bg-[var(--color-accent-hover)] focus:ring-[var(--color-accent-main)]/50 shadow-lg transition-all duration-200',  7 |     outline: 'bg-transparent text-[var(--color-text-primary)] hover:bg-[var(--color-background-secondary)] focus:ring-[var(--color-primary-main)]/50 border border-[var(--color-border-medium)] transition-all duration-200',  8 |     ghost: 'bg-transparent text-[var(--color-text-primary)] hover:bg-[var(--color-background-secondary)] focus:ring-[var(--color-primary-main)]/50 transition-all duration-200',  9 |   }, 10 |  11 |   background: { 12 |     primary: 'bg-[var(--color-background-primary)]', 13 |     secondary: 'bg-[var(--color-background-secondary)]', 14 |     tertiary: 'bg-[var(--color-background-tertiary)]', 15 |     surface: 'bg-[var(--color-background-surface)]', 16 |   }, 17 |  18 |   text: { 19 |     primary: 'text-[var(--color-text-primary)]', 20 |     secondary: 'text-[var(--color-text-secondary)]', 21 |     tertiary: 'text-[var(--color-text-tertiary)]', 22 |     inverse: 'text-[var(--color-text-inverse)]', 23 |     accent: 'text-[var(--color-accent-main)]', 24 |   }, 25 |  26 |   border: { 27 |     light: 'border-[var(--color-border-light)]', 28 |     medium: 'border-[var(--color-border-medium)]', 29 |     dark: 'border-[var(--color-border-dark)]', 30 |   }, 31 |  32 |   card: { 33 |     default: 'bg-[var(--color-background-surface)] border border-[var(--color-border-light)] rounded-xl shadow-lg', 34 |     elevated: 'bg-[var(--color-background-surface)] border border-[var(--color-border-light)] rounded-xl shadow-xl', 35 |     flat: 'bg-[var(--color-background-surface)] border border-[var(--color-border-light)] rounded-lg', 36 |   }, 37 |  38 |   input: { 39 |     default: 'w-full px-4 py-3 bg-[var(--color-background-surface)] border border-[var(--color-border-medium)] rounded-lg text-[var(--color-text-primary)] placeholder-[var(--color-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-main)]/50 focus:border-[var(--color-primary-main)] transition-all duration-200', 40 |     error: 'border-[var(--color-status-error)] focus:ring-[var(--color-status-error)]/50 focus:border-[var(--color-status-error)]', 41 |   }, 42 | }; 43 |  44 | export function combineThemeClasses(...classes: string[]): string { 45 |   return classes.filter(Boolean).join(' '); 46 | } 47 |  48 | export function getCSSVariable(variable: string): string { 49 |   if (typeof document === 'undefined') return ''; 50 |   return getComputedStyle(document.documentElement).getPropertyValue(variable).trim(); 51 | } 52 |  53 | export function setCSSVariable(variable: string, value: string): void { 54 |   if (typeof document === 'undefined') return; 55 |   document.documentElement.style.setProperty(variable, value); 56 | } 57 |  58 | export function hexToRgb(hex: string): { r: number; g: number; b: number } | null { 59 |   const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); 60 |   return result ? { 61 |     r: parseInt(result[1], 16), 62 |     g: parseInt(result[2], 16), 63 |     b: parseInt(result[3], 16) 64 |   } : null; 65 | } 66 |  67 | export function rgbToHex(r: number, g: number, b: number): string { 68 |   return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1); 69 | } 70 |  71 | export function lightenColor(hex: string, percent: number): string { 72 |   const rgb = hexToRgb(hex); 73 |   if (!rgb) return hex; 74 |  75 |   const { r, g, b } = rgb; 76 |   const amount = Math.round(2.55 * percent); 77 |  78 |   return rgbToHex( 79 |     Math.min(255, r + amount), 80 |     Math.min(255, g + amount), 81 |     Math.min(255, b + amount) 82 |   ); 83 | } 84 |  85 | export function darkenColor(hex: string, percent: number): string { 86 |   const rgb = hexToRgb(hex); 87 |   if (!rgb) return hex; 88 |  89 |   const { r, g, b } = rgb; 90 |   const amount = Math.round(2.55 * percent); 91 |  92 |   return rgbToHex( 93 |     Math.max(0, r - amount), 94 |     Math.max(0, g - amount), 95 |     Math.max(0, b - amount) 96 |   ); 97 | } 98 |  99 | export function generateColorVariants(baseColor: string) {100 |   return {101 |     main: baseColor,102 |     light: lightenColor(baseColor, 20),103 |     dark: darkenColor(baseColor, 20),104 |     hover: darkenColor(baseColor, 10),105 |   };106 | }
============================================================END: frontend/lib/theme/theme-utils.ts============================================================


============================================================FILE: frontend/lib/utils.tsSIZE: 3.59 KB============================================================
  1 | import { type ClassValue, clsx } from "clsx"  2 | import { twMerge } from "tailwind-merge"  3 |   4 | export function cn(...inputs: ClassValue[]) {  5 |   return twMerge(clsx(inputs))  6 | }  7 |   8 | export function formatDate(date: string | Date | null | undefined, options?: Intl.DateTimeFormatOptions): string {  9 |   if (!date) return "N/A"; 10 |  11 |   try { 12 |     const dateObj = typeof date === 'string' ? new Date(date) : date; 13 |  14 |     if (isNaN(dateObj.getTime())) { 15 |       return "N/A"; 16 |     } 17 |  18 |     const defaultOptions: Intl.DateTimeFormatOptions = { 19 |       year: 'numeric', 20 |       month: 'short', 21 |       day: 'numeric', 22 |       ...options 23 |     }; 24 |  25 |     return dateObj.toLocaleDateString(undefined, defaultOptions); 26 |   } catch (error) { 27 |     return "N/A"; 28 |   } 29 | } 30 |  31 | export function formatTime(time: string | null | undefined): string { 32 |   if (!time) return "N/A"; 33 |  34 |   try { 35 |  36 |     if (typeof time === 'string' && /^\d{2}:\d{2}$/.test(time)) { 37 |       const [hours, minutes] = time.split(':'); 38 |       const date = new Date(); 39 |       date.setHours(parseInt(hours), parseInt(minutes)); 40 |       return date.toLocaleTimeString(undefined, { 41 |         hour: '2-digit', 42 |         minute: '2-digit', 43 |         hour12: true 44 |       }); 45 |     } 46 |  47 |     const timeObj = new Date(`2000-01-01T${time}`); 48 |     if (isNaN(timeObj.getTime())) { 49 |       return "N/A"; 50 |     } 51 |  52 |     return timeObj.toLocaleTimeString(undefined, { 53 |       hour: '2-digit', 54 |       minute: '2-digit', 55 |       hour12: true 56 |     }); 57 |   } catch (error) { 58 |     return "N/A"; 59 |   } 60 | } 61 |  62 | export function formatDateTime(datetime: string | Date | null | undefined): string { 63 |   if (!datetime) return "N/A"; 64 |  65 |   try { 66 |     const dateObj = typeof datetime === 'string' ? new Date(datetime) : datetime; 67 |  68 |     if (isNaN(dateObj.getTime())) { 69 |       return "N/A"; 70 |     } 71 |  72 |     return dateObj.toLocaleString(undefined, { 73 |       year: 'numeric', 74 |       month: 'short', 75 |       day: 'numeric', 76 |       hour: '2-digit', 77 |       minute: '2-digit', 78 |       hour12: true 79 |     }); 80 |   } catch (error) { 81 |     return "N/A"; 82 |   } 83 | } 84 |  85 | export function formatCurrency(amount: number | null | undefined, currency: string = 'USD'): string { 86 |   if (amount === null || amount === undefined || isNaN(amount)) { 87 |     return "N/A"; 88 |   } 89 |  90 |   try { 91 |     return new Intl.NumberFormat('en-US', { 92 |       style: 'currency', 93 |       currency: currency, 94 |       minimumFractionDigits: 2, 95 |       maximumFractionDigits: 2 96 |     }).format(amount); 97 |   } catch (error) { 98 |     return `$${amount.toFixed(2)}`; 99 |   }100 | }101 | 102 | export function generateId(): string {103 |   return Math.random().toString(36).substr(2, 9);104 | }105 | 106 | export function debounce<T extends (...args: unknown[]) => unknown>(107 |   func: T,108 |   wait: number109 | ): (...args: Parameters<T>) => void {110 |   let timeout: NodeJS.Timeout;111 |   return (...args: Parameters<T>) => {112 |     clearTimeout(timeout);113 |     timeout = setTimeout(() => func(...args), wait);114 |   };115 | }
============================================================END: frontend/lib/utils.ts============================================================


============================================================FILE: frontend/lib/validations.tsSIZE: 8.94 KB============================================================
  1 | import { z } from 'zod';  2 |   3 | export const clientSchema = z.object({  4 |   name: z.string().min(1, 'Name is required').max(100, 'Name must be less than 100 characters'),  5 |   email: z.string().email('Invalid email address'),  6 |   phone: z.string().optional(),  7 |   status: z.enum(['active', 'inactive', 'pending', 'confirmed', 'completed', 'cancelled', 'no-show']).default('active'),  8 |   birthDate: z.string().min(1, 'Birth date is required'),  9 |   birthTime: z.string().optional(), 10 |   birthPlace: z.string().min(1, 'Birth place is required'), 11 |   question: z.string().min(1, 'Question/focus areas are required'), 12 |   language: z.enum(['en', 'es']).default('en'), 13 |   adminNotes: z.string().optional(), 14 | }); 15 |  16 | export const clientCreateSchema = clientSchema.extend({ 17 |   email: z.string().email('Invalid email address'), 18 | }); 19 |  20 | export const clientUpdateSchema = clientSchema.partial(); 21 |  22 | export const scheduleSchema = z.object({ 23 |   dayOfWeek: z.string().min(1, 'Day of week is required'), 24 |   startTime: z.string().min(1, 'Start time is required'), 25 |   endTime: z.string().min(1, 'End time is required'), 26 |   isAvailable: z.boolean().default(true), 27 | }); 28 |  29 | export const scheduleCreateSchema = scheduleSchema; 30 | export const scheduleUpdateSchema = scheduleSchema.partial(); 31 |  32 | export const bookingSchema = z.object({ 33 |   clientEmail: z.string().email('Invalid client email'), 34 |   sessionDate: z.string().min(1, 'Session date is required'), 35 |   sessionTime: z.string().min(1, 'Session time is required'), 36 |   sessionType: z.string().min(1, 'Session type is required'), 37 |   status: z.enum(['pending', 'confirmed', 'completed', 'cancelled', 'no-show']).default('pending'), 38 |   notes: z.string().optional(), 39 | }); 40 |  41 | export const bookingCreateSchema = bookingSchema; 42 | export const bookingUpdateSchema = bookingSchema.partial(); 43 |  44 | export const contentSchema = z.object({ 45 |   heroTitleEn: z.string().min(1, 'English hero title is required'), 46 |   heroTitleEs: z.string().min(1, 'Spanish hero title is required'), 47 |   heroSubtitleEn: z.string().min(1, 'English hero subtitle is required'), 48 |   heroSubtitleEs: z.string().min(1, 'Spanish hero subtitle is required'), 49 |   aboutTitleEn: z.string().min(1, 'English about title is required'), 50 |   aboutTitleEs: z.string().min(1, 'Spanish about title is required'), 51 |   aboutContentEn: z.string().min(1, 'English about content is required'), 52 |   aboutContentEs: z.string().min(1, 'Spanish about content is required'), 53 |   approachTitleEn: z.string().min(1, 'English approach title is required'), 54 |   approachTitleEs: z.string().min(1, 'Spanish approach title is required'), 55 |   approachContentEn: z.string().min(1, 'English approach content is required'), 56 |   approachContentEs: z.string().min(1, 'Spanish approach content is required'), 57 |   servicesTitleEn: z.string().min(1, 'English services title is required'), 58 |   servicesTitleEs: z.string().min(1, 'Spanish services title is required'), 59 |   servicesContentEn: z.string().min(1, 'English services content is required'), 60 |   servicesContentEs: z.string().min(1, 'Spanish services content is required'), 61 | }); 62 |  63 | export const contentUpdateSchema = contentSchema.partial(); 64 |  65 | export const emailConfigSchema = z.object({ 66 |   smtpHost: z.string().min(1, 'SMTP host is required'), 67 |   smtpPort: z.number().min(1, 'SMTP port must be greater than 0').max(65535, 'SMTP port must be less than 65536'), 68 |   smtpUser: z.string().min(1, 'SMTP user is required'), 69 |   smtpPass: z.string().min(1, 'SMTP password is required'), 70 |   fromEmail: z.string().email('Invalid from email address'), 71 |   fromName: z.string().min(1, 'From name is required'), 72 | }); 73 |  74 | export const emailConfigUpdateSchema = emailConfigSchema.partial(); 75 |  76 | export const emailTemplateSchema = z.object({ 77 |   templateKey: z.string().min(1, 'Template key is required'), 78 |   subject: z.string().min(1, 'Subject is required'), 79 |   body: z.string().min(1, 'Body is required'), 80 |   language: z.enum(['en', 'es']).default('en'), 81 | }); 82 |  83 | export const emailTemplateCreateSchema = emailTemplateSchema; 84 | export const emailTemplateUpdateSchema = emailTemplateSchema.partial(); 85 |  86 | export const logoSettingsSchema = z.object({ 87 |   type: z.enum(['text', 'image']).default('text'), 88 |   text: z.string().min(1, 'Logo text is required when type is text'), 89 |   imageUrl: z.string().url('Invalid image URL').optional(), 90 | }); 91 |  92 | export const logoSettingsUpdateSchema = logoSettingsSchema.partial(); 93 |  94 | export const seoSchema = z.object({ 95 |   title: z.string().min(1, 'SEO title is required'), 96 |   description: z.string().min(1, 'SEO description is required'), 97 |   keywords: z.string().min(1, 'SEO keywords are required'), 98 |   ogImage: z.string().url('Invalid OG image URL').optional(), 99 | });100 | 101 | export const seoUpdateSchema = seoSchema.partial();102 | 103 | export const imageSchema = z.object({104 |   name: z.string().min(1, 'Image name is required'),105 |   url: z.string().url('Invalid image URL'),106 |   altText: z.string().optional(),107 |   category: z.string().default('general'),108 | });109 | 110 | export const imageCreateSchema = imageSchema;111 | export const imageUpdateSchema = imageSchema.partial();112 | 113 | export const profileImageSchema = z.object({114 |   key: z.string().min(1, 'Profile image key is required'),115 |   url: z.string().url('Invalid image URL'),116 |   altText: z.string().optional(),117 | });118 | 119 | export const profileImageCreateSchema = profileImageSchema;120 | export const profileImageUpdateSchema = profileImageSchema.partial();121 | 122 | export const adminUserSchema = z.object({123 |   email: z.string().email('Invalid email address'),124 |   password: z.string().min(8, 'Password must be at least 8 characters'),125 |   fullName: z.string().min(1, 'Full name is required'),126 |   role: z.enum(['admin', 'user']).default('admin'),127 | });128 | 129 | export const adminUserCreateSchema = adminUserSchema;130 | 131 | export const successResponseSchema = z.object({132 |   success: z.boolean(),133 |   message: z.string(),134 |   data: z.any().optional(),135 | });136 | 137 | export const errorResponseSchema = z.object({138 |   success: z.boolean().default(false),139 |   error: z.string(),140 |   details: z.string().optional(),141 |   code: z.number().optional(),142 | });143 | 144 | export const paginationSchema = z.object({145 |   page: z.number().min(1, 'Page must be greater than 0').default(1),146 |   limit: z.number().min(1, 'Limit must be greater than 0').max(100, 'Limit must be less than 100').default(20),147 |   search: z.string().optional(),148 |   sortBy: z.string().optional(),149 |   sortOrder: z.enum(['asc', 'desc']).default('desc'),150 | });151 | 152 | export const clientFilterSchema = z.object({153 |   status: z.enum(['all', 'active', 'inactive', 'pending']).default('all'),154 |   language: z.enum(['all', 'en', 'es']).default('all'),155 |   dateFilter: z.enum(['all', 'today', 'week', 'month']).default('all'),156 |   searchQuery: z.string().optional(),157 | });158 | 159 | export const scheduleFilterSchema = z.object({160 |   dayOfWeek: z.string().optional(),161 |   isAvailable: z.boolean().optional(),162 |   dateRange: z.object({163 |     start: z.string().optional(),164 |     end: z.string().optional(),165 |   }).optional(),166 | });167 | 168 | export type ClientCreate = z.infer<typeof clientCreateSchema>;169 | export type ClientUpdate = z.infer<typeof clientUpdateSchema>;170 | 171 | export type ScheduleCreate = z.infer<typeof scheduleCreateSchema>;172 | export type ScheduleUpdate = z.infer<typeof scheduleUpdateSchema>;173 | 174 | export type Booking = z.infer<typeof bookingSchema>;175 | export type BookingCreate = z.infer<typeof bookingCreateSchema>;176 | export type BookingUpdate = z.infer<typeof bookingUpdateSchema>;177 | 178 | export type Content = z.infer<typeof contentSchema>;179 | export type ContentUpdate = z.infer<typeof contentUpdateSchema>;180 | 181 | export type EmailConfigUpdate = z.infer<typeof emailConfigUpdateSchema>;182 | 183 | export type EmailTemplateCreate = z.infer<typeof emailTemplateCreateSchema>;184 | export type EmailTemplateUpdate = z.infer<typeof emailTemplateUpdateSchema>;185 | 186 | export type LogoSettings = z.infer<typeof logoSettingsSchema>;187 | export type LogoSettingsUpdate = z.infer<typeof logoSettingsUpdateSchema>;188 | 189 | export type Seo = z.infer<typeof seoSchema>;190 | export type SeoUpdate = z.infer<typeof seoUpdateSchema>;191 | 192 | export type Image = z.infer<typeof imageSchema>;193 | export type ImageCreate = z.infer<typeof imageCreateSchema>;194 | export type ImageUpdate = z.infer<typeof imageUpdateSchema>;195 | 196 | export type ProfileImage = z.infer<typeof profileImageSchema>;197 | export type ProfileImageCreate = z.infer<typeof profileImageCreateSchema>;198 | export type ProfileImageUpdate = z.infer<typeof profileImageUpdateSchema>;199 | 200 | export type AdminUser = z.infer<typeof adminUserSchema>;201 | export type AdminUserCreate = z.infer<typeof adminUserCreateSchema>;202 | 203 | export type Pagination = z.infer<typeof paginationSchema>;204 | export type ClientFilter = z.infer<typeof clientFilterSchema>;205 | export type ScheduleFilter = z.infer<typeof scheduleFilterSchema>;
============================================================END: frontend/lib/validations.ts============================================================


============================================================FILE: frontend/next.config.jsSIZE: 1.10 KB============================================================
  1 | import path from 'path';  2 | import { fileURLToPath } from 'url';  3 |   4 | const __filename = fileURLToPath(import.meta.url);  5 | const __dirname = path.dirname(__filename);  6 |   7 | const nextConfig = {  8 |   outputFileTracingRoot: path.resolve(__dirname),  9 |   experimental: { 10 |  11 |   }, 12 |   images: { 13 |     remotePatterns: [ 14 |       { 15 |         protocol: 'https', 16 |         hostname: 'images.unsplash.com', 17 |         port: '', 18 |         pathname: '/**', 19 |       }, 20 |       { 21 |         protocol: 'https', 22 |         hostname: 'unsplash.com', 23 |         port: '', 24 |         pathname: '/**', 25 |       }, 26 |       { 27 |         protocol: 'https', 28 |         hostname: 'via.placeholder.com', 29 |         port: '', 30 |         pathname: '/**', 31 |       }, 32 |       { 33 |         protocol: 'https', 34 |         hostname: 'picsum.photos', 35 |         port: '', 36 |         pathname: '/**', 37 |       }, 38 |     ], 39 |   }, 40 |   webpack: (config) => { 41 |  42 |     config.resolve.alias = { 43 |       ...config.resolve.alias, 44 |       '@': path.resolve(__dirname), 45 |     }; 46 |     return config; 47 |   }, 48 | }; 49 |  50 | export default nextConfig;
============================================================END: frontend/next.config.js============================================================


============================================================FILE: frontend/next.config.tsSIZE: 1.74 KB============================================================
  1 | import type { NextConfig } from 'next'  2 | import webpack from 'webpack'  3 |   4 | const nextConfig: NextConfig = {  5 |   6 |   outputFileTracingRoot: process.cwd(),  7 |   webpack: (config) => {  8 |   9 |     config.experiments = { 10 |       ...config.experiments, 11 |       asyncWebAssembly: true, 12 |     } 13 |  14 |     config.module.rules.push({ 15 |       test: /\.wasm$/, 16 |       type: 'webassembly/async', 17 |     }) 18 |  19 |     config.resolve.fallback = { 20 |       ...config.resolve.fallback, 21 |       fs: false, 22 |       path: false, 23 |       crypto: false, 24 |       stream: false, 25 |       util: false, 26 |       buffer: false, 27 |       process: false, 28 |       os: false, 29 |       url: false, 30 |       querystring: false, 31 |       zlib: false, 32 |       http: false, 33 |       https: false, 34 |       assert: false, 35 |       constants: false, 36 |       events: false, 37 |       domain: false, 38 |       punycode: false, 39 |       string_decoder: false, 40 |       timers: false, 41 |       tty: false, 42 |       vm: false, 43 |       worker_threads: false, 44 |       child_process: false, 45 |       cluster: false, 46 |       dgram: false, 47 |       dns: false, 48 |       net: false, 49 |       readline: false, 50 |       repl: false, 51 |     } 52 |  53 |     config.plugins.push( 54 |       new webpack.DefinePlugin({ 55 |         'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV), 56 |       }) 57 |     ) 58 |  59 |     return config 60 |   }, 61 |   images: { 62 |     remotePatterns: [ 63 |       { 64 |         protocol: 'https', 65 |         hostname: 'hwxrstqeuouefyrwjsjt.supabase.co', 66 |       }, 67 |       { 68 |         protocol: 'https', 69 |         hostname: 'localhost', 70 |       }, 71 |     ], 72 |   }, 73 | } 74 |  75 | export default nextConfig
============================================================END: frontend/next.config.ts============================================================


============================================================FILE: frontend/prisma/schema.prismaSIZE: 34.63 KB============================================================
  1 | generator client {  2 |   provider = "prisma-client-js"  3 | }  4 |   5 | datasource db {  6 |   provider  = "postgresql"  7 |   url       = env("DATABASE_URL")  8 |   directUrl = env("DIRECT_URL")  9 | } 10 |  11 | model User { 12 |   id               String            @id @default(cuid()) 13 |   email            String            @unique 14 |   password         String? 15 |   fullName         String?           @map("full_name") 16 |   avatarUrl        String?           @map("avatar_url") 17 |   role             String?           @default("user") 18 |   phone            String? 19 |   status           String?           @default("active") 20 |   birthDate        DateTime?         @map("birth_date") @db.Date 21 |   birthTime        DateTime?         @map("birth_time") @db.Time(6) 22 |   birthPlace       String?           @map("birth_place") 23 |   question         String? 24 |   language         String?           @default("en") 25 |   adminNotes       String?           @map("admin_notes") 26 |   scheduledDate    DateTime?         @map("scheduled_date") @db.Date 27 |   scheduledTime    DateTime?         @map("scheduled_time") @db.Time(6) 28 |   sessionType      String?           @map("session_type") 29 |   lastReminderSent DateTime?         @map("last_reminder_sent") @db.Timestamptz(6) 30 |   lastBooking      DateTime?         @map("last_booking") @db.Timestamptz(6) 31 |   notes            String? 32 |   createdAt        DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6) 33 |   updatedAt        DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6) 34 |   bookings         Booking[] 35 |   bugComments      BugComment[]      @relation("BugCommentAuthor") 36 |   assignedBugs     BugReport[]       @relation("BugReportAssignee") 37 |   reportedBugs     BugReport[]       @relation("BugReportReporter") 38 |   conversationLogs ConversationLog[] 39 |   otpVerifications OtpVerification[] 40 |   paymentRecords   PaymentRecord[] 41 |   purchases        Purchase[] 42 |   userPackages     UserPackage[] 43 |  44 |   @@index([email], map: "idx_users_email") 45 |   @@index([status], map: "idx_users_status") 46 |   @@index([createdAt], map: "idx_users_created_at") 47 |   @@index([role], map: "idx_users_role") 48 |   @@index([phone], map: "idx_users_phone") 49 |   @@index([language], map: "idx_users_language") 50 |   @@map("users") 51 | } 52 |  53 | model PackageDefinition { 54 |   id                Int             @id @default(autoincrement()) 55 |   name              String          @db.VarChar(255) 56 |   description       String? 57 |   sessionsCount     Int             @map("sessions_count") 58 |   sessionDurationId Int             @map("session_duration_id") 59 |   packageType       String          @map("package_type") @db.VarChar(20) 60 |   maxGroupSize      Int?            @map("max_group_size") 61 |   isActive          Boolean?        @default(true) @map("is_active") 62 |   isPopular         Boolean?        @default(false) @map("is_popular") 63 |   displayOrder      Int?            @default(0) @map("display_order") 64 |   featured          Boolean?        @default(false) @map("featured") 65 |   createdAt         DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6) 66 |   updatedAt         DateTime?       @default(now()) @map("updated_at") @db.Timestamptz(6) 67 |   sessionDuration   SessionDuration @relation("PackageDefinitionSessionDuration", fields: [sessionDurationId], references: [id], onDelete: Cascade, onUpdate: Restrict) 68 |   packagePrices     PackagePrice[] 69 |  70 |   @@index([isActive], map: "idx_package_definitions_active") 71 |   @@index([isPopular], map: "idx_package_definitions_popular") 72 |   @@index([displayOrder], map: "idx_package_definitions_order") 73 |   @@index([featured], map: "idx_package_definitions_featured") 74 |   @@map("package_definitions") 75 | } 76 |  77 | model PackagePrice { 78 |   id                  Int               @id @default(autoincrement()) 79 |   packageDefinitionId Int               @map("package_definition_id") 80 |   currencyId          Int               @map("currency_id") 81 |   price               Decimal           @db.Decimal(10, 2) 82 |   pricingMode         String            @map("pricing_mode") @db.VarChar(20) 83 |   isActive            Boolean?          @default(true) @map("is_active") 84 |   createdAt           DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6) 85 |   updatedAt           DateTime?         @default(now()) @map("updated_at") @db.Timestamptz(6) 86 |   currency            Currency          @relation("PackagePriceCurrency", fields: [currencyId], references: [id], onDelete: Cascade, onUpdate: Restrict) 87 |   packageDefinition   PackageDefinition @relation(fields: [packageDefinitionId], references: [id], onDelete: Cascade, onUpdate: Restrict) 88 |   userPackages        UserPackage[] 89 |  90 |   @@unique([packageDefinitionId, currencyId]) 91 |   @@index([currencyId], map: "idx_package_prices_currency") 92 |   @@map("package_prices") 93 | } 94 |  95 | model ScheduleTemplate { 96 |   id                Int              @id @default(autoincrement()) 97 |   dayOfWeek         String           @map("day_of_week") @db.VarChar(20) 98 |   startTime         String           @map("start_time") @db.VarChar(10) 99 |   endTime           String           @map("end_time") @db.VarChar(10)100 |   capacity          Int?             @default(3)101 |   isAvailable       Boolean?         @default(true) @map("is_available")102 |   sessionDurationId Int?             @map("session_duration_id")103 |   autoAvailable     Boolean?         @default(true) @map("auto_available")104 |   createdAt         DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)105 |   updatedAt         DateTime?        @default(now()) @map("updated_at") @db.Timestamptz(6)106 |   scheduleSlots     ScheduleSlot[]107 |   sessionDuration   SessionDuration? @relation("ScheduleTemplateSessionDuration", fields: [sessionDurationId], references: [id], onDelete: Restrict, onUpdate: Restrict)108 | 109 |   @@index([dayOfWeek], map: "idx_schedule_templates_day")110 |   @@map("schedule_templates")111 | }112 | 113 | model ScheduleSlot {114 |   id                 Int              @id @default(autoincrement())115 |   scheduleTemplateId Int              @map("schedule_template_id")116 |   startTime          DateTime         @map("start_time") @db.Timestamptz(6)117 |   endTime            DateTime         @map("end_time") @db.Timestamptz(6)118 |   capacity           Int?             @default(3)119 |   bookedCount        Int?             @default(0) @map("booked_count")120 |   isAvailable        Boolean?         @default(true) @map("is_available")121 |   createdAt          DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)122 |   updatedAt          DateTime?        @default(now()) @map("updated_at") @db.Timestamptz(6)123 |   bookings           Booking[]124 |   scheduleTemplate   ScheduleTemplate @relation(fields: [scheduleTemplateId], references: [id], onDelete: Cascade, onUpdate: Restrict)125 | 126 |   @@index([startTime], map: "idx_schedule_slots_start_time")127 |   @@index([isAvailable, startTime], map: "idx_schedule_slots_available_start_time")128 |   @@index([endTime], map: "idx_schedule_slots_end_time")129 |   @@index([isAvailable], map: "idx_schedule_slots_available")130 |   @@index([bookedCount], map: "idx_schedule_slots_booked_count")131 |   @@map("schedule_slots")132 | }133 | 134 | model Purchase {135 |   id             Int             @id @default(autoincrement())136 |   userId         String          @map("user_id")137 |   totalAmount    Decimal         @map("total_amount") @db.Decimal(10, 2)138 |   currencyCode   String          @map("currency_code") @db.VarChar(3)139 |   paymentMethod  String          @map("payment_method") @db.VarChar(50)140 |   paymentStatus  String?         @default("pending") @map("payment_status") @db.VarChar(20)141 |   transactionId  String?         @map("transaction_id") @db.VarChar(255)142 |   notes          String?143 |   purchasedAt    DateTime?       @default(now()) @map("purchased_at") @db.Timestamptz(6)144 |   confirmedAt    DateTime?       @map("confirmed_at") @db.Timestamptz(6)145 |   createdAt      DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6)146 |   updatedAt      DateTime?       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)147 |   paymentRecords PaymentRecord[]148 |   user           User            @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Restrict)149 |   userPackages   UserPackage[]150 | 151 |   @@index([userId], map: "idx_purchases_user_id")152 |   @@index([paymentStatus], map: "idx_purchases_payment_status")153 |   @@index([purchasedAt], map: "idx_purchases_purchased_at")154 |   @@index([userId, paymentStatus], map: "idx_purchases_user_status")155 |   @@index([userId, purchasedAt], map: "idx_purchases_user_date")156 |   @@map("purchases")157 | }158 | 159 | model UserPackage {160 |   id             Int          @id @default(autoincrement())161 |   userId         String       @map("user_id")162 |   purchaseId     Int          @map("purchase_id")163 |   packagePriceId Int          @map("package_price_id")164 |   quantity       Int?         @default(1)165 |   sessionsUsed   Int?         @default(0) @map("sessions_used")166 |   isActive       Boolean?     @default(true) @map("is_active")167 |   expiresAt      DateTime?    @map("expires_at") @db.Timestamptz(6)168 |   createdAt      DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)169 |   updatedAt      DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)170 |   bookings       Booking[]171 |   packagePrice   PackagePrice @relation(fields: [packagePriceId], references: [id], onDelete: Cascade, onUpdate: Restrict)172 |   purchase       Purchase     @relation(fields: [purchaseId], references: [id], onDelete: Cascade, onUpdate: Restrict)173 |   user           User         @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Restrict)174 | 175 |   @@index([userId], map: "idx_user_packages_user_id")176 |   @@index([purchaseId], map: "idx_user_packages_purchase_id")177 |   @@index([isActive], map: "idx_user_packages_active")178 |   @@index([userId, isActive], map: "idx_user_packages_user_active")179 |   @@index([expiresAt], map: "idx_user_packages_expires")180 |   @@map("user_packages")181 | }182 | 183 | model Booking {184 |   id              Int          @id @default(autoincrement())185 |   userId          String       @map("user_id")186 |   userPackageId   Int          @map("user_package_id")187 |   scheduleSlotId  Int          @map("schedule_slot_id")188 |   sessionType     String       @map("session_type")189 |   status          String?      @default("confirmed")190 |   notes           String?191 |   cancelledAt     DateTime?    @map("cancelled_at") @db.Timestamptz(6)192 |   cancelledReason String?      @map("cancelled_reason")193 |   reminderSent    Boolean?     @default(false) @map("reminder_sent")194 |   reminderSentAt  DateTime?    @map("reminder_sent_at") @db.Timestamptz(6)195 |   createdAt       DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)196 |   updatedAt       DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)197 |   scheduleSlot    ScheduleSlot @relation(fields: [scheduleSlotId], references: [id], onDelete: Cascade, onUpdate: Restrict)198 |   user            User         @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Restrict)199 |   userPackage     UserPackage  @relation(fields: [userPackageId], references: [id], onDelete: Cascade, onUpdate: Restrict)200 | 201 |   @@index([userId], map: "idx_bookings_user_id")202 |   @@index([userPackageId], map: "idx_bookings_user_package_id")203 |   @@index([scheduleSlotId], map: "idx_bookings_schedule_slot_id")204 |   @@index([status], map: "idx_bookings_status")205 |   @@index([createdAt], map: "idx_bookings_created_at")206 |   @@index([userId, status], map: "idx_bookings_user_status")207 |   @@index([userId, createdAt], map: "idx_bookings_user_created")208 |   @@map("bookings")209 | }210 | 211 | model PaymentRecord {212 |   id            Int       @id @default(autoincrement())213 |   userId        String    @map("user_id")214 |   purchaseId    Int       @map("purchase_id")215 |   amount        Decimal   @db.Decimal(10, 2)216 |   currencyCode  String    @map("currency_code") @db.VarChar(3)217 |   paymentMethod String    @map("payment_method") @db.VarChar(50)218 |   paymentStatus String?   @default("pending") @map("payment_status") @db.VarChar(20)219 |   transactionId String?   @map("transaction_id") @db.VarChar(255)220 |   notes         String?221 |   paymentDate   DateTime? @map("payment_date") @db.Date222 |   confirmedAt   DateTime? @map("confirmed_at") @db.Timestamptz(6)223 |   createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)224 |   updatedAt     DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)225 |   purchase      Purchase  @relation(fields: [purchaseId], references: [id], onDelete: Cascade, onUpdate: Restrict)226 |   user          User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Restrict)227 | 228 |   @@index([userId], map: "idx_payment_records_user_id")229 |   @@index([purchaseId], map: "idx_payment_records_purchase_id")230 |   @@index([paymentStatus], map: "idx_payment_records_payment_status")231 |   @@index([paymentMethod], map: "idx_payment_records_payment_method")232 |   @@index([createdAt], map: "idx_payment_records_created_at")233 |   @@map("payment_records")234 | }235 | 236 | model Currency {237 |   id             Int               @id @default(autoincrement())238 |   code           String            @unique @db.VarChar(3)239 |   name           String            @db.VarChar(50)240 |   symbol         String            @db.VarChar(5)241 |   is_default     Boolean?          @default(false)242 |   exchange_rate  Decimal?          @default(1.000000) @db.Decimal(10, 6)243 |   createdAt      DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)244 |   updatedAt      DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)245 |   packagePrices  PackagePrice[]    @relation("PackagePriceCurrency")246 |   paymentMethods payment_methods[]247 |   rates          Rate[]248 | 249 |   @@map("currencies")250 | }251 | 252 | model SessionDuration {253 |   id                 Int                 @id @default(autoincrement())254 |   name               String              @db.VarChar(100)255 |   duration_minutes   Int256 |   description        String?257 |   isActive           Boolean?            @default(true) @map("is_active")258 |   createdAt          DateTime?           @default(now()) @map("created_at") @db.Timestamptz(6)259 |   updatedAt          DateTime?           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)260 |   packageDefinitions PackageDefinition[] @relation("PackageDefinitionSessionDuration")261 |   rates              Rate[]262 |   scheduleTemplates  ScheduleTemplate[]  @relation("ScheduleTemplateSessionDuration")263 | 264 |   @@map("session_durations")265 | }266 | 267 | model Rate {268 |   id                     Int             @id @default(autoincrement())269 |   currencyId             Int             @map("currency_id")270 |   sessionDurationId      Int             @map("session_duration_id")271 |   sessionType            String          @map("session_type") @db.VarChar(50)272 |   base_price             Decimal         @db.Decimal(10, 2)273 |   group_discount_percent Decimal?        @default(0) @db.Decimal(5, 2)274 |   min_group_size         Int?            @default(1)275 |   max_group_size         Int?            @default(10)276 |   isActive               Boolean?        @default(true) @map("is_active")277 |   createdAt              DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6)278 |   updatedAt              DateTime?       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)279 |   currency               Currency        @relation(fields: [currencyId], references: [id], onDelete: Cascade, onUpdate: Restrict)280 |   sessionDuration        SessionDuration @relation(fields: [sessionDurationId], references: [id], onDelete: Cascade, onUpdate: Restrict)281 | 282 |   @@unique([currencyId, sessionDurationId, sessionType])283 |   @@map("rates")284 | }285 | 286 | model PaymentMethodConfig {287 |   id                   Int       @id @default(autoincrement())288 |   name                 String    @db.VarChar(100)289 |   type                 String?   @default("custom") @db.VarChar(50)290 |   description          String?291 |   icon                 String?   @db.VarChar(100)292 |   requiresConfirmation Boolean?  @default(false) @map("requires_confirmation")293 |   autoAssignPackage    Boolean?  @default(true) @map("auto_assign_package")294 |   isActive             Boolean?  @default(true) @map("is_active")295 |   createdAt            DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)296 |   updatedAt            DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)297 |   providerConfig       Json?     @map("provider_config")298 | 299 |   @@index([isActive], map: "idx_payment_method_configs_active")300 |   @@index([name], map: "idx_payment_method_configs_name")301 |   @@index([type], map: "idx_payment_method_configs_type")302 |   @@map("payment_method_configs")303 | }304 | 305 | model EmailTemplate {306 |   id          Int       @id @default(autoincrement())307 |   templateKey String    @unique @map("template_key")308 |   subject     String309 |   body        String310 |   language    String?   @default("en")311 |   createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)312 |   updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)313 | 314 |   @@index([templateKey], map: "idx_email_templates_key")315 |   @@map("email_templates")316 | }317 | 318 | model LogoSettings {319 |   id        Int       @id @default(autoincrement())320 |   type      String?   @default("text")321 |   text      String?   @default("SOULPATH")322 |   imageUrl  String?   @map("image_url")323 |   createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)324 |   updatedAt DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)325 | 326 |   @@map("logo_settings")327 | }328 | 329 | model Seo {330 |   id          Int       @id @default(autoincrement())331 |   title       String?   @default("SOULPATH - Wellness & Healing")332 |   description String?   @default("Your journey to wellness starts here. Professional wellness services in a peaceful environment.")333 |   keywords    String?   @default("wellness, healing, therapy, meditation, soulpath")334 |   ogImage     String?   @map("og_image")335 |   createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)336 |   updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)337 | 338 |   @@map("seo")339 | }340 | 341 | model Image {342 |   id        Int       @id @default(autoincrement())343 |   name      String344 |   url       String345 |   altText   String?   @map("alt_text")346 |   category  String?   @default("general")347 |   createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)348 |   updatedAt DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)349 | 350 |   @@map("images")351 | }352 | 353 | model ProfileImage {354 |   id        Int       @id @default(autoincrement())355 |   key       String    @unique356 |   url       String357 |   altText   String?   @map("alt_text")358 |   createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)359 |   updatedAt DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)360 | 361 |   @@map("profile_images")362 | }363 | 364 | model Content {365 |   id                Int       @id @default(autoincrement())366 |   heroTitleEn       String?   @default("Welcome to SOULPATH") @map("hero_title_en")367 |   heroTitleEs       String?   @default("Bienvenido a SOULPATH") @map("hero_title_es")368 |   heroSubtitleEn    String?   @default("Your journey to wellness starts here") @map("hero_subtitle_en")369 |   heroSubtitleEs    String?   @default("Tu camino al bienestar comienza aquí") @map("hero_subtitle_es")370 |   aboutTitleEn      String?   @default("About Us") @map("about_title_en")371 |   aboutTitleEs      String?   @default("Sobre Nosotros") @map("about_title_es")372 |   aboutContentEn    String?   @default("We are dedicated to helping you achieve your wellness goals.") @map("about_content_en")373 |   aboutContentEs    String?   @default("Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.") @map("about_content_es")374 |   approachTitleEn   String?   @default("Our Approach") @map("approach_title_en")375 |   approachTitleEs   String?   @default("Nuestro Enfoque") @map("approach_title_es")376 |   approachContentEn String?   @default("We use a holistic approach to wellness.") @map("approach_content_en")377 |   approachContentEs String?   @default("Usamos un enfoque holístico para el bienestar.") @map("approach_content_es")378 |   servicesTitleEn   String?   @default("Our Services") @map("services_title_en")379 |   servicesTitleEs   String?   @default("Nuestros Servicios") @map("services_title_es")380 |   servicesContentEn String?   @default("Professional wellness services in a peaceful environment.") @map("services_content_en")381 |   servicesContentEs String?   @default("Servicios profesionales de bienestar en un ambiente pacífico.") @map("services_content_es")382 |   createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)383 |   updatedAt         DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)384 | 385 |   @@map("content")386 | }387 | 388 | model Section {389 |   id            Int       @id @default(autoincrement())390 |   sectionId     String    @unique @map("section_id")391 |   type          String    @default("content") @db.VarChar(50)392 |   title         String    @db.VarChar(255)393 |   description   String?394 |   icon          String    @default("Circle") @db.VarChar(50)395 |   component     String    @db.VarChar(100)396 |   order         Int       @default(0)397 |   enabled       Boolean   @default(true)398 |   mobileConfig  Json?     @map("mobile_config")399 |   desktopConfig Json?     @map("desktop_config")400 |   createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)401 |   updatedAt     DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)402 | 403 |   @@index([enabled, order], map: "idx_sections_enabled_order")404 |   @@map("sections")405 | }406 | 407 | model CommunicationConfig {408 |   id                  Int       @id @default(autoincrement())409 |   createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)410 |   updatedAt           DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)411 |   email_enabled       Boolean?  @default(true) @map("email_enabled")412 |   brevo_api_key       String?   @default("") @map("brevo_api_key")413 |   sender_email        String?   @default("noreply@soulpath.lat") @map("sender_email")414 |   sender_name         String?   @default("SOULPATH") @map("sender_name")415 |   admin_email         String?   @default("admin@soulpath.lat") @map("admin_email")416 |   sms_enabled         Boolean?  @default(false) @map("sms_enabled")417 |   sms_provider        String?   @default("labsmobile") @map("sms_provider")418 |   labsmobile_username String?   @default("") @map("labsmobile_username")419 |   labsmobile_token    String?   @default("") @map("labsmobile_token")420 |   sms_sender_name     String?   @default("SoulPath") @map("sms_sender_name")421 | 422 |   @@map("communication_config")423 | }424 | 425 | model CommunicationTemplate {426 |   id           Int                                @id @default(autoincrement())427 |   templateKey  String                             @unique @map("template_key")428 |   name         String429 |   description  String?430 |   type         String431 |   category     String?432 |   isActive     Boolean                            @default(true) @map("is_active")433 |   isDefault    Boolean                            @default(false) @map("is_default")434 |   createdAt    DateTime?                          @default(now()) @map("created_at") @db.Timestamptz(6)435 |   updatedAt    DateTime?                          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)436 |   translations CommunicationTemplateTranslation[]437 | 438 |   @@index([type], map: "idx_communication_templates_type")439 |   @@index([category], map: "idx_communication_templates_category")440 |   @@index([isActive], map: "idx_communication_templates_active")441 |   @@map("communication_templates")442 | }443 | 444 | model CommunicationTemplateTranslation {445 |   id         Int                   @id @default(autoincrement())446 |   templateId Int                   @map("template_id")447 |   language   String448 |   subject    String?449 |   content    String450 |   createdAt  DateTime?             @default(now()) @map("created_at") @db.Timestamptz(6)451 |   updatedAt  DateTime?             @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)452 |   template   CommunicationTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)453 | 454 |   @@unique([templateId, language], map: "idx_template_translations_unique")455 |   @@index([language], map: "idx_template_translations_language")456 |   @@map("communication_template_translations")457 | }458 | 459 | model BugReport {460 |   id          String          @id @default(dbgenerated("(gen_random_uuid())::text"))461 |   title       String          @db.VarChar(255)462 |   description String463 |   screenshot  String?464 |   annotations Json?465 |   status      bug_status?     @default(OPEN)466 |   priority    priority_level? @default(MEDIUM)467 |   category    String?         @db.VarChar(100)468 |   reporterId  String?         @map("reporter_id")469 |   assignedTo  String?         @map("assigned_to")470 |   createdAt   DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6)471 |   updatedAt   DateTime?       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)472 |   resolvedAt  DateTime?       @map("resolved_at") @db.Timestamptz(6)473 |   archivedAt  DateTime?       @map("archived_at") @db.Timestamptz(6)474 |   comments    BugComment[]475 |   assignee    User?           @relation("BugReportAssignee", fields: [assignedTo], references: [id], onUpdate: Restrict)476 |   reporter    User?           @relation("BugReportReporter", fields: [reporterId], references: [id], onUpdate: Restrict)477 | 478 |   @@index([status], map: "idx_bug_reports_status")479 |   @@index([priority], map: "idx_bug_reports_priority")480 |   @@index([reporterId], map: "idx_bug_reports_reporter")481 |   @@index([assignedTo], map: "idx_bug_reports_assignee")482 |   @@index([createdAt], map: "idx_bug_reports_created")483 |   @@map("bug_reports")484 | }485 | 486 | model BugComment {487 |   id          String    @id @default(dbgenerated("(gen_random_uuid())::text"))488 |   content     String489 |   authorId    String    @map("author_id")490 |   bugReportId String    @map("bug_report_id")491 |   createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)492 |   updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)493 |   author      User      @relation("BugCommentAuthor", fields: [authorId], references: [id], onDelete: Cascade, onUpdate: Restrict)494 |   bugReport   BugReport @relation(fields: [bugReportId], references: [id], onDelete: Cascade, onUpdate: Restrict)495 | 496 |   @@index([bugReportId], map: "idx_bug_comments_bug_report")497 |   @@index([authorId], map: "idx_bug_comments_author")498 |   @@map("bug_comments")499 | }500 | 501 | model group_booking_tiers {502 |   id               Int       @id @default(autoincrement())503 |   name             String    @db.VarChar(100)504 |   min_participants Int505 |   max_participants Int506 |   discount_percent Decimal?  @default(0) @db.Decimal(5, 2)507 |   description      String?508 |   is_active        Boolean?  @default(true)509 |   created_at       DateTime? @default(now()) @db.Timestamptz(6)510 |   updated_at       DateTime? @default(now()) @db.Timestamptz(6)511 | }512 | 513 | model kv_store_f839855f {514 |   key   String @id515 |   value Json516 | }517 | 518 | model MatMax {519 |   id         BigInt    @id @default(autoincrement())520 |   created_at DateTime? @default(now()) @db.Timestamptz(6)521 | }522 | 523 | model payment_methods {524 |   id          Int       @id @default(autoincrement())525 |   name        String    @db.VarChar(100)526 |   description String?527 |   currency_id Int528 |   is_active   Boolean?  @default(true)529 |   created_at  DateTime? @default(now()) @db.Timestamptz(6)530 |   updated_at  DateTime? @default(now()) @db.Timestamptz(6)531 |   currencies  Currency  @relation(fields: [currency_id], references: [id], onDelete: Cascade, onUpdate: Restrict)532 | }533 | 534 | model SmsConfiguration {535 |   id         Int      @id @default(autoincrement())536 |   provider   String   @default("labsmobile")537 |   username   String538 |   tokenApi   String   @map("token_api")539 |   senderName String?  @map("sender_name")540 |   isActive   Boolean  @default(true) @map("is_active")541 |   createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)542 |   updatedAt  DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)543 | 544 |   @@map("sms_configurations")545 | }546 | 547 | model OtpVerification {548 |   id          Int      @id @default(autoincrement())549 |   userId      String?  @map("user_id")550 |   phoneNumber String   @map("phone_number")551 |   countryCode String   @map("country_code")552 |   otpCode     String   @map("otp_code")553 |   isVerified  Boolean  @default(false) @map("is_verified")554 |   expiresAt   DateTime @map("expires_at") @db.Timestamptz(6)555 |   attempts    Int      @default(0)556 |   maxAttempts Int      @default(3) @map("max_attempts")557 |   createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)558 |   updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)559 |   user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Restrict)560 | 561 |   @@index([phoneNumber], map: "idx_otp_verifications_phone")562 |   @@index([userId], map: "idx_otp_verifications_user")563 |   @@index([expiresAt], map: "idx_otp_verifications_expires")564 |   @@map("otp_verifications")565 | }566 | 567 | model ExternalAPIConfig {568 |   id             String    @id @default(cuid())569 |   name           String    @unique570 |   provider       String571 |   category       String572 |   apiKey         String?   @map("api_key")573 |   apiSecret      String?   @map("api_secret")574 |   apiUrl         String?   @map("api_url")575 |   webhookUrl     String?   @map("webhook_url")576 |   webhookSecret  String?   @map("webhook_secret")577 |   config         Json?578 |   isActive       Boolean   @default(false) @map("is_active")579 |   testMode       Boolean   @default(true) @map("test_mode")580 |   description    String?581 |   version        String?582 |   rateLimit      Int?      @map("rate_limit")583 |   timeout        Int?      @default(30000)584 |   lastTestedAt   DateTime? @map("last_tested_at") @db.Timestamptz(6)585 |   lastTestResult String?   @map("last_test_result")586 |   healthStatus   String?   @default("unknown") @map("health_status")587 |   createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)588 |   updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)589 |   createdBy      String?   @map("created_by")590 |   updatedBy      String?   @map("updated_by")591 | 592 |   @@index([name], map: "idx_external_api_configs_name")593 |   @@index([category], map: "idx_external_api_configs_category")594 |   @@index([isActive], map: "idx_external_api_configs_active")595 |   @@map("external_api_configs")596 | }597 | 598 | model APIConfigAudit {599 |   id          String   @id @default(cuid())600 |   configId    String   @map("config_id")601 |   action      String602 |   oldValues   Json?    @map("old_values")603 |   newValues   Json?    @map("new_values")604 |   performedBy String   @map("performed_by")605 |   ipAddress   String?  @map("ip_address")606 |   userAgent   String?  @map("user_agent")607 |   createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)608 | 609 |   @@index([configId], map: "idx_api_config_audit_config_id")610 |   @@index([performedBy], map: "idx_api_config_audit_performed_by")611 |   @@index([createdAt], map: "idx_api_config_audit_created_at")612 |   @@map("api_config_audits")613 | }614 | 615 | model ConversationLog {616 |   id                  Int            @id @default(autoincrement())617 |   sessionId           String         @map("session_id")618 |   userId              String?        @map("user_id")619 |   userMessage         String         @map("user_message")620 |   botResponse         String?        @map("bot_response")621 |   timestamp           DateTime       @default(now()) @map("timestamp") @db.Timestamptz(6)622 |   rasaIntent          String?        @map("rasa_intent")623 |   rasaConfidence      Decimal?       @map("rasa_confidence") @db.Decimal(5, 4)624 |   rasaEntities        Json?          @map("rasa_entities")625 |   responseGenerator   String         @map("response_generator")626 |   bookingStep         String?        @map("booking_step")627 |   bookingDataSnapshot Json?          @map("booking_data_snapshot")628 |   modelVersion        String?        @map("model_version")629 |   user                User?          @relation(fields: [userId], references: [id])630 |   feedback            UserFeedback[]631 | 632 |   @@index([sessionId], map: "idx_conversation_logs_session_id")633 |   @@index([rasaIntent], map: "idx_conversation_logs_rasa_intent")634 |   @@index([timestamp], map: "idx_conversation_logs_timestamp")635 |   @@map("conversation_logs")636 | }637 | 638 | model UserFeedback {639 |   id                  Int             @id @default(autoincrement())640 |   conversationLogId   Int             @map("conversation_log_id")641 |   sessionId           String          @map("session_id")642 |   rating              Int643 |   comment             String?644 |   createdAt           DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)645 |   reviewedForTraining Boolean         @default(false) @map("reviewed_for_training")646 |   conversationLog     ConversationLog @relation(fields: [conversationLogId], references: [id], onDelete: Cascade)647 | 648 |   @@index([sessionId], map: "idx_user_feedback_session_id")649 |   @@index([rating], map: "idx_user_feedback_rating")650 |   @@map("user_feedback")651 | }652 | 653 | model MlModelPerformance {654 |   id                   Int       @id @default(autoincrement())655 |   modelVersion         String    @unique @map("model_version")656 |   evaluationResults    Json?     @map("evaluation_results")657 |   bookingSuccessRate   Decimal?  @map("booking_success_rate") @db.Decimal(5, 4)658 |   avgConversationTurns Decimal?  @map("avg_conversation_turns") @db.Decimal(5, 2)659 |   deploymentDate       DateTime? @map("deployment_date") @db.Timestamptz(6)660 |   isActiveProduction   Boolean   @default(false) @map("is_active_production")661 |   isActiveAbTest       Boolean   @default(false) @map("is_active_ab_test")662 |   createdAt            DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)663 | 664 |   @@index([modelVersion], map: "idx_ml_model_performance_model_version")665 |   @@map("ml_model_performance")666 | }667 | 668 | model AbTestExperiment {669 |   id                  Int                @id @default(autoincrement())670 |   experimentName      String             @map("experiment_name")671 |   modelAVersion       String             @map("model_a_version")672 |   modelBVersion       String             @map("model_b_version")673 |   trafficSplit        Decimal            @default(0.50) @map("traffic_split") @db.Decimal(3, 2)674 |   startDate           DateTime           @default(now()) @map("start_date") @db.Timestamptz(6)675 |   endDate             DateTime?          @map("end_date") @db.Timestamptz(6)676 |   status              String             @default("active")677 |   successMetric       String             @map("success_metric")678 |   winningModelVersion String?            @map("winning_model_version")679 |   finalResults        Json?              @map("final_results")680 |   assignments         AbTestAssignment[]681 | 682 |   @@index([status], map: "idx_ab_test_experiments_status")683 |   @@map("ab_test_experiments")684 | }685 | 686 | model AbTestAssignment {687 |   id            Int              @id @default(autoincrement())688 |   experimentId  Int              @map("experiment_id")689 |   sessionId     String           @map("session_id")690 |   assignedModel String           @map("assigned_model")691 |   createdAt     DateTime         @default(now()) @map("created_at") @db.Timestamptz(6)692 |   experiment    AbTestExperiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)693 | 694 |   @@unique([experimentId, sessionId], map: "idx_ab_test_assignments_unique")695 |   @@index([sessionId], map: "idx_ab_test_assignments_session_id")696 |   @@map("ab_test_assignments")697 | }698 | 699 | enum bug_status {700 |   OPEN701 |   IN_PROGRESS702 |   RESOLVED703 |   CLOSED704 |   ARCHIVED705 | }706 | 707 | enum priority {708 |   LOW709 |   MEDIUM710 |   HIGH711 |   CRITICAL712 | }713 | 714 | enum priority_level {715 |   LOW716 |   MEDIUM717 |   HIGH718 |   CRITICAL719 | }
============================================================END: frontend/prisma/schema.prisma============================================================


============================================================FILE: frontend/prisma/seed.tsSIZE: 39.66 KB============================================================
  1 | import { PrismaClient } from '@prisma/client';  2 | import bcrypt from 'bcryptjs';  3 |   4 | const prisma = new PrismaClient();  5 |   6 | async function main() {  7 |   8 |   const communicationConfig = await prisma.communicationConfig.upsert({  9 |     where: { id: 1 }, 10 |     update: {}, 11 |     create: { 12 |       email_enabled: true, 13 |       brevo_api_key: '', 14 |       sender_email: 'noreply@matmax.store', 15 |       sender_name: 'MatMax Yoga Studio', 16 |       admin_email: 'admin@matmax.store', 17 |       sms_enabled: false, 18 |       sms_provider: 'labsmobile', 19 |       labsmobile_username: '', 20 |       labsmobile_token: '', 21 |       sms_sender_name: 'MatMax Yoga Studio' 22 |     } 23 |   }); 24 |  25 |   const communicationTemplates = await Promise.all([ 26 |  27 |     prisma.communicationTemplate.upsert({ 28 |       where: { templateKey: 'booking_confirmation' }, 29 |       update: {}, 30 |       create: { 31 |         templateKey: 'booking_confirmation', 32 |         name: 'Booking Confirmation', 33 |         description: 'Sent when a booking is confirmed', 34 |         type: 'email', 35 |         category: 'booking', 36 |         isActive: true, 37 |         isDefault: true, 38 |         translations: { 39 |           create: [ 40 |             { 41 |               language: 'en', 42 |               subject: 'Booking Confirmation - MatMax Yoga Studio', 43 |               content: '<h1>Your class has been confirmed!</h1><p>Dear {{clientName}},</p><p>Your {{sessionType}} class is scheduled for {{sessionDate}} at {{sessionTime}}.</p><p>We look forward to seeing you at MatMax Yoga Studio!</p><p>Best regards,<br>MatMax Yoga Studio Team</p>' 44 |             }, 45 |             { 46 |               language: 'es', 47 |               subject: 'Confirmación de Reserva - MatMax Yoga Studio', 48 |               content: '<h1>¡Tu clase ha sido confirmada!</h1><p>Estimado {{clientName}},</p><p>Tu clase de {{sessionType}} está programada para el {{sessionDate}} a las {{sessionTime}}.</p><p>¡Esperamos verte en MatMax Yoga Studio!</p><p>Atentamente,<br>Equipo MatMax Yoga Studio</p>' 49 |             } 50 |           ] 51 |         } 52 |       } 53 |     }), 54 |  55 |     prisma.communicationTemplate.upsert({ 56 |       where: { templateKey: 'session_reminder' }, 57 |       update: {}, 58 |       create: { 59 |         templateKey: 'session_reminder', 60 |         name: 'Session Reminder', 61 |         description: 'Sent before upcoming sessions', 62 |         type: 'email', 63 |         category: 'booking', 64 |         isActive: true, 65 |         isDefault: true, 66 |         translations: { 67 |           create: [ 68 |             { 69 |               language: 'en', 70 |               subject: 'Reminder: Your MatMax Yoga Class', 71 |               content: '<h1>Class Reminder</h1><p>Dear {{clientName}},</p><p>This is a reminder for your {{sessionType}} class tomorrow at {{sessionTime}}.</p><p>Please arrive 10 minutes early.</p><p>Best regards,<br>MatMax Yoga Studio Team</p>' 72 |             }, 73 |             { 74 |               language: 'es', 75 |               subject: 'Recordatorio: Tu Clase en MatMax Yoga Studio', 76 |               content: '<h1>Recordatorio de Clase</h1><p>Estimado {{clientName}},</p><p>Este es un recordatorio para tu clase de {{sessionType}} mañana a las {{sessionTime}}.</p><p>Por favor llega 10 minutos antes.</p><p>Atentamente,<br>Equipo MatMax Yoga Studio</p>' 77 |             } 78 |           ] 79 |         } 80 |       } 81 |     }), 82 |  83 |     prisma.communicationTemplate.upsert({ 84 |       where: { templateKey: 'welcome_email' }, 85 |       update: {}, 86 |       create: { 87 |         templateKey: 'welcome_email', 88 |         name: 'Welcome Email', 89 |         description: 'Sent to new clients after registration', 90 |         type: 'email', 91 |         category: 'welcome', 92 |         isActive: true, 93 |         isDefault: true, 94 |         translations: { 95 |           create: [ 96 |             { 97 |               language: 'en', 98 |               subject: 'Welcome to MatMax Yoga Studio', 99 |               content: '<h1>Welcome to MatMax Yoga Studio!</h1><p>Dear {{clientName}},</p><p>Thank you for choosing MatMax. We are excited to support your yoga journey.</p><p>Explore our classes and book your first session today.</p><p>Best regards,<br>MatMax Yoga Studio Team</p>'100 |             },101 |             {102 |               language: 'es',103 |               subject: 'Bienvenido a MatMax Yoga Studio',104 |               content: '<h1>¡Bienvenido a MatMax Yoga Studio!</h1><p>Estimado {{clientName}},</p><p>Gracias por elegir MatMax. Estamos emocionados de acompañarte en tu práctica de yoga.</p><p>Explora nuestras clases y reserva tu primera sesión hoy.</p><p>Atentamente,<br>Equipo MatMax Yoga Studio</p>'105 |             }106 |           ]107 |         }108 |       }109 |     }),110 | 111 |     prisma.communicationTemplate.upsert({112 |       where: { templateKey: 'otp_verification' },113 |       update: {},114 |       create: {115 |         templateKey: 'otp_verification',116 |         name: 'OTP Verification',117 |         description: 'SMS sent for phone number verification',118 |         type: 'sms',119 |         category: 'verification',120 |         isActive: true,121 |         isDefault: true,122 |         translations: {123 |           create: [124 |             {125 |               language: 'en',126 |               content: 'Your MatMax Yoga Studio verification code is {{otpCode}}. This code expires in {{expiryTime}} minutes.'127 |             },128 |             {129 |               language: 'es',130 |               content: 'Tu código de verificación de MatMax Yoga Studio es {{otpCode}}. Este código expira en {{expiryTime}} minutos.'131 |             }132 |           ]133 |         }134 |       }135 |     }),136 | 137 |     prisma.communicationTemplate.upsert({138 |       where: { templateKey: 'payment_confirmation' },139 |       update: {},140 |       create: {141 |         templateKey: 'payment_confirmation',142 |         name: 'Payment Confirmation',143 |         description: 'SMS sent after successful payment',144 |         type: 'sms',145 |         category: 'payment',146 |         isActive: true,147 |         isDefault: true,148 |         translations: {149 |           create: [150 |             {151 |               language: 'en',152 |               content: 'Payment confirmed! Your {{packageName}} has been activated. Amount: ${{amount}}. Thank you for choosing MatMax Yoga Studio!'153 |             },154 |             {155 |               language: 'es',156 |               content: '¡Pago confirmado! Tu {{packageName}} ha sido activado. Monto: ${{amount}}. ¡Gracias por elegir MatMax Yoga Studio!'157 |             }158 |           ]159 |         }160 |       }161 |     }),162 | 163 |     prisma.communicationTemplate.upsert({164 |       where: { templateKey: 'appointment_cancelled' },165 |       update: {},166 |       create: {167 |         templateKey: 'appointment_cancelled',168 |         name: 'Appointment Cancelled',169 |         description: 'Sent when an appointment is cancelled',170 |         type: 'email',171 |         category: 'booking',172 |         isActive: true,173 |         isDefault: true,174 |         translations: {175 |           create: [176 |             {177 |               language: 'en',178 |               subject: 'Class Cancelled - MatMax Yoga Studio',179 |               content: '<h1>Class Cancelled</h1><p>Dear {{clientName}},</p><p>Your {{sessionType}} class scheduled for {{sessionDate}} at {{sessionTime}} has been cancelled.</p><p>You can reschedule at any time through your dashboard.</p><p>Best regards,<br>MatMax Yoga Studio Team</p>'180 |             },181 |             {182 |               language: 'es',183 |               subject: 'Clase Cancelada - MatMax Yoga Studio',184 |               content: '<h1>Clase Cancelada</h1><p>Estimado {{clientName}},</p><p>Tu clase de {{sessionType}} programada para el {{sessionDate}} a las {{sessionTime}} ha sido cancelada.</p><p>Puedes reprogramar en cualquier momento a través de tu panel.</p><p>Atentamente,<br>Equipo MatMax Yoga Studio</p>'185 |             }186 |           ]187 |         }188 |       }189 |     })190 |   ]);191 | 192 |   const content = await prisma.content.upsert({193 |     where: { id: 1 },194 |     update: {},195 |     create: {196 |       heroTitleEn: 'MatMax Yoga Studio',197 |       heroTitleEs: 'MatMax Yoga Studio',198 |       heroSubtitleEn: 'Your journey to wellness starts here',199 |       heroSubtitleEs: 'Tu camino al bienestar comienza aquí',200 |       aboutTitleEn: 'About Us',201 |       aboutTitleEs: 'Sobre Nosotros',202 |       aboutContentEn: 'We are dedicated to helping you achieve your wellness goals.',203 |       aboutContentEs: 'Estamos dedicados a ayudarte a alcanzar tus metas de bienestar.',204 |       approachTitleEn: 'Our Approach',205 |       approachTitleEs: 'Nuestro Enfoque',206 |       approachContentEn: 'We use a holistic approach to wellness.',207 |       approachContentEs: 'Usamos un enfoque holístico para el bienestar.',208 |       servicesTitleEn: 'Our Services',209 |       servicesTitleEs: 'Nuestros Servicios',210 |       servicesContentEn: 'Professional wellness services in a peaceful environment.',211 |       servicesContentEs: 'Servicios profesionales de bienestar en un ambiente pacífico.'212 |     }213 |   });214 | 215 |   const logoSettings = await prisma.logoSettings.upsert({216 |     where: { id: 1 },217 |     update: {},218 |     create: {219 |       type: 'image',220 |       text: 'MatMax Yoga Studio',221 |       imageUrl: '/logo_matmax.png'222 |     }223 |   });224 | 225 |   const seo = await prisma.seo.upsert({226 |     where: { id: 1 },227 |     update: {},228 |     create: {229 |       title: 'MatMax Yoga Studio',230 |       description: 'Yoga classes for all levels. Build strength, flexibility, and inner peace.',231 |       keywords: 'yoga, wellness, meditation, flexibility, strength, balance',232 |       ogImage: null233 |     }234 |   });235 | 236 |   const currencies = await Promise.all([237 |     prisma.currency.upsert({238 |       where: { code: 'USD' },239 |       update: {},240 |       create: {241 |         code: 'USD',242 |         name: 'US Dollar',243 |         symbol: '$',244 |         is_default: true,245 |         exchange_rate: 1.000000246 |       }247 |     }),248 |     prisma.currency.upsert({249 |       where: { code: 'EUR' },250 |       update: {},251 |       create: {252 |         code: 'EUR',253 |         name: 'Euro',254 |         symbol: '€',255 |         is_default: false,256 |         exchange_rate: 0.850000257 |       }258 |     }),259 |     prisma.currency.upsert({260 |       where: { code: 'MXN' },261 |       update: {},262 |       create: {263 |         code: 'MXN',264 |         name: 'Mexican Peso',265 |         symbol: 'MXN$',266 |         is_default: false,267 |         exchange_rate: 18.500000268 |       }269 |     }),270 |     prisma.currency.upsert({271 |       where: { code: 'CAD' },272 |       update: {},273 |       create: {274 |         code: 'CAD',275 |         name: 'Canadian Dollar',276 |         symbol: 'C$',277 |         is_default: false,278 |         exchange_rate: 1.350000279 |       }280 |     }),281 |     prisma.currency.upsert({282 |       where: { code: 'PEN' },283 |       update: {},284 |       create: {285 |         code: 'PEN',286 |         name: 'Peruvian Sol',287 |         symbol: 'S/',288 |         is_default: false,289 |         exchange_rate: 3.750000290 |       }291 |     })292 |   ]);293 | 294 |   const sessionDurations = await Promise.all([295 |     prisma.sessionDuration.upsert({296 |       where: { id: 1 },297 |       update: {},298 |       create: {299 |         name: '30 Minutes',300 |         duration_minutes: 30,301 |         description: 'Quick wellness session',302 |         isActive: true303 |       }304 |     }),305 |     prisma.sessionDuration.upsert({306 |       where: { id: 2 },307 |       update: {},308 |       create: {309 |         name: '60 Minutes',310 |         duration_minutes: 60,311 |         description: 'Standard wellness session',312 |         isActive: true313 |       }314 |     }),315 |     prisma.sessionDuration.upsert({316 |       where: { id: 3 },317 |       update: {},318 |       create: {319 |         name: '90 Minutes',320 |         duration_minutes: 90,321 |         description: 'Extended wellness session',322 |         isActive: true323 |       }324 |     }),325 |     prisma.sessionDuration.upsert({326 |       where: { id: 4 },327 |       update: {},328 |       create: {329 |         name: '120 Minutes',330 |         duration_minutes: 120,331 |         description: 'Comprehensive wellness session',332 |         isActive: true333 |       }334 |     })335 |   ]);336 | 337 |   const rates = await Promise.all([338 | 339 |     prisma.rate.upsert({340 |       where: { id: 1 },341 |       update: {},342 |       create: {343 |         currencyId: 1,344 |         sessionDurationId: 1,345 |         sessionType: 'individual',346 |         base_price: 50.00,347 |         group_discount_percent: 0,348 |         min_group_size: 1,349 |         max_group_size: 1,350 |         isActive: true351 |       }352 |     }),353 |     prisma.rate.upsert({354 |       where: { id: 2 },355 |       update: {},356 |       create: {357 |         currencyId: 1,358 |         sessionDurationId: 2,359 |         sessionType: 'individual',360 |         base_price: 80.00,361 |         group_discount_percent: 0,362 |         min_group_size: 1,363 |         max_group_size: 1,364 |         isActive: true365 |       }366 |     }),367 |     prisma.rate.upsert({368 |       where: { id: 3 },369 |       update: {},370 |       create: {371 |         currencyId: 1,372 |         sessionDurationId: 3,373 |         sessionType: 'individual',374 |         base_price: 120.00,375 |         group_discount_percent: 0,376 |         min_group_size: 1,377 |         max_group_size: 1,378 |         isActive: true379 |       }380 |     }),381 | 382 |     prisma.rate.upsert({383 |       where: { id: 4 },384 |       update: {},385 |       create: {386 |         currencyId: 1,387 |         sessionDurationId: 2,388 |         sessionType: 'group',389 |         base_price: 60.00,390 |         group_discount_percent: 25.00,391 |         min_group_size: 2,392 |         max_group_size: 5,393 |         isActive: true394 |       }395 |     })396 |   ]);397 | 398 |   const packageDefinitions = await Promise.all([399 |     prisma.packageDefinition.upsert({400 |       where: { id: 1 },401 |       update: {402 |         name: '01 MATPASS',403 |         description: 'All classes are 60 minutes',404 |         sessionsCount: 1,405 |         sessionDurationId: 2,406 |         packageType: 'individual',407 |         maxGroupSize: 1,408 |         isActive: true409 |       },410 |       create: {411 |         name: '01 MATPASS',412 |         description: 'All classes are 60 minutes',413 |         sessionsCount: 1,414 |         sessionDurationId: 2,415 |         packageType: 'individual',416 |         maxGroupSize: 1,417 |         isActive: true418 |       }419 |     }),420 |     prisma.packageDefinition.upsert({421 |       where: { id: 2 },422 |       update: {423 |         name: '04 MATPASS',424 |         description: 'All classes are 60 minutes',425 |         sessionsCount: 4,426 |         sessionDurationId: 2,427 |         packageType: 'individual',428 |         maxGroupSize: 1,429 |         isActive: true430 |       },431 |       create: {432 |         name: '04 MATPASS',433 |         description: 'All classes are 60 minutes',434 |         sessionsCount: 4,435 |         sessionDurationId: 2,436 |         packageType: 'individual',437 |         maxGroupSize: 1,438 |         isActive: true439 |       }440 |     }),441 |     prisma.packageDefinition.upsert({442 |       where: { id: 3 },443 |       update: {444 |         name: '08 MATPASS',445 |         description: 'All classes are 60 minutes',446 |         sessionsCount: 8,447 |         sessionDurationId: 2,448 |         packageType: 'individual',449 |         maxGroupSize: 1,450 |         isActive: true451 |       },452 |       create: {453 |         name: '08 MATPASS',454 |         description: 'All classes are 60 minutes',455 |         sessionsCount: 8,456 |         sessionDurationId: 2,457 |         packageType: 'individual',458 |         maxGroupSize: 1,459 |         isActive: true460 |       }461 |     }),462 |     prisma.packageDefinition.upsert({463 |       where: { id: 4 },464 |       update: {465 |         name: '12 MATPASS',466 |         description: 'All classes are 60 minutes',467 |         sessionsCount: 12,468 |         sessionDurationId: 2,469 |         packageType: 'individual',470 |         maxGroupSize: 1,471 |         isActive: true472 |       },473 |       create: {474 |         name: '12 MATPASS',475 |         description: 'All classes are 60 minutes',476 |         sessionsCount: 12,477 |         sessionDurationId: 2,478 |         packageType: 'individual',479 |         maxGroupSize: 1,480 |         isActive: true481 |       }482 |     }),483 |     prisma.packageDefinition.upsert({484 |       where: { id: 5 },485 |       update: {486 |         name: '24 MATPASS',487 |         description: 'All classes are 60 minutes',488 |         sessionsCount: 24,489 |         sessionDurationId: 2,490 |         packageType: 'individual',491 |         maxGroupSize: 1,492 |         isActive: true493 |       },494 |       create: {495 |         name: '24 MATPASS',496 |         description: 'All classes are 60 minutes',497 |         sessionsCount: 24,498 |         sessionDurationId: 2,499 |         packageType: 'individual',500 |         maxGroupSize: 1,501 |         isActive: true502 |       }503 |     })504 |   ]);505 | 506 |   const penCurrency = await prisma.currency.findUnique({ where: { code: 'PEN' } });507 |   const penCurrencyId = penCurrency?.id ?? 5;508 |   const packagePrices = await Promise.all([509 |     prisma.packagePrice.upsert({510 |       where: { id: 1 },511 |       update: {512 |         packageDefinitionId: 1,513 |         currencyId: penCurrencyId,514 |         price: 50.00,515 |         pricingMode: 'custom',516 |         isActive: true517 |       },518 |       create: {519 |         packageDefinitionId: 1,520 |         currencyId: penCurrencyId,521 |         price: 50.00,522 |         pricingMode: 'custom',523 |         isActive: true524 |       }525 |     }),526 |     prisma.packagePrice.upsert({527 |       where: { id: 2 },528 |       update: {529 |         packageDefinitionId: 2,530 |         currencyId: penCurrencyId,531 |         price: 210.00,532 |         pricingMode: 'custom',533 |         isActive: true534 |       },535 |       create: {536 |         packageDefinitionId: 2,537 |         currencyId: penCurrencyId,538 |         price: 210.00,539 |         pricingMode: 'custom',540 |         isActive: true541 |       }542 |     }),543 |     prisma.packagePrice.upsert({544 |       where: { id: 3 },545 |       update: {546 |         packageDefinitionId: 3,547 |         currencyId: penCurrencyId,548 |         price: 320.00,549 |         pricingMode: 'custom',550 |         isActive: true551 |       },552 |       create: {553 |         packageDefinitionId: 3,554 |         currencyId: penCurrencyId,555 |         price: 320.00,556 |         pricingMode: 'custom',557 |         isActive: true558 |       }559 |     }),560 |     prisma.packagePrice.upsert({561 |       where: { id: 4 },562 |       update: {563 |         packageDefinitionId: 4,564 |         currencyId: penCurrencyId,565 |         price: 400.00,566 |         pricingMode: 'custom',567 |         isActive: true568 |       },569 |       create: {570 |         packageDefinitionId: 4,571 |         currencyId: penCurrencyId,572 |         price: 400.00,573 |         pricingMode: 'custom',574 |         isActive: true575 |       }576 |     }),577 |     prisma.packagePrice.upsert({578 |       where: { id: 5 },579 |       update: {580 |         packageDefinitionId: 5,581 |         currencyId: penCurrencyId,582 |         price: 900.00,583 |         pricingMode: 'custom',584 |         isActive: true585 |       },586 |       create: {587 |         packageDefinitionId: 5,588 |         currencyId: penCurrencyId,589 |         price: 900.00,590 |         pricingMode: 'custom',591 |         isActive: true592 |       }593 |     })594 |   ]);595 | 596 |   const scheduleTemplates = await Promise.all([597 |     prisma.scheduleTemplate.upsert({598 |       where: { id: 1 },599 |       update: {},600 |       create: {601 |         dayOfWeek: 'Monday',602 |         startTime: '09:00',603 |         endTime: '17:00',604 |         capacity: 3,605 |         isAvailable: true,606 |         sessionDurationId: 2,607 |         autoAvailable: true608 |       }609 |     }),610 |     prisma.scheduleTemplate.upsert({611 |       where: { id: 2 },612 |       update: {},613 |       create: {614 |         dayOfWeek: 'Tuesday',615 |         startTime: '09:00',616 |         endTime: '17:00',617 |         capacity: 3,618 |         isAvailable: true,619 |         sessionDurationId: 2,620 |         autoAvailable: true621 |       }622 |     }),623 |     prisma.scheduleTemplate.upsert({624 |       where: { id: 3 },625 |       update: {},626 |       create: {627 |         dayOfWeek: 'Wednesday',628 |         startTime: '09:00',629 |         endTime: '17:00',630 |         capacity: 3,631 |         isAvailable: true,632 |         sessionDurationId: 2,633 |         autoAvailable: true634 |       }635 |     }),636 |     prisma.scheduleTemplate.upsert({637 |       where: { id: 4 },638 |       update: {},639 |       create: {640 |         dayOfWeek: 'Thursday',641 |         startTime: '09:00',642 |         endTime: '17:00',643 |         capacity: 3,644 |         isAvailable: true,645 |         sessionDurationId: 2,646 |         autoAvailable: true647 |       }648 |     }),649 |     prisma.scheduleTemplate.upsert({650 |       where: { id: 5 },651 |       update: {},652 |       create: {653 |         dayOfWeek: 'Friday',654 |         startTime: '09:00',655 |         endTime: '17:00',656 |         capacity: 3,657 |         isAvailable: true,658 |         sessionDurationId: 2,659 |         autoAvailable: true660 |       }661 |     }),662 |     prisma.scheduleTemplate.upsert({663 |       where: { id: 6 },664 |       update: {},665 |       create: {666 |         dayOfWeek: 'Saturday',667 |         startTime: '10:00',668 |         endTime: '16:00',669 |         capacity: 3,670 |         isAvailable: true,671 |         sessionDurationId: 2,672 |         autoAvailable: true673 |       }674 |     })675 |   ]);676 | 677 |   const scheduleSlots = await Promise.all([678 |     prisma.scheduleSlot.upsert({679 |       where: { id: 1 },680 |       update: {},681 |       create: {682 |         scheduleTemplateId: 1,683 |         startTime: new Date('2024-01-01T09:00:00Z'),684 |         endTime: new Date('2024-01-01T17:00:00Z'),685 |         capacity: 3,686 |         bookedCount: 0,687 |         isAvailable: true688 |       }689 |     }),690 |     prisma.scheduleSlot.upsert({691 |       where: { id: 2 },692 |       update: {},693 |       create: {694 |         scheduleTemplateId: 2,695 |         startTime: new Date('2024-01-02T09:00:00Z'),696 |         endTime: new Date('2024-01-02T17:00:00Z'),697 |         capacity: 3,698 |         bookedCount: 0,699 |         isAvailable: true700 |       }701 |     })702 |   ]);703 | 704 |   const paymentMethods = await Promise.all([705 |     prisma.paymentMethodConfig.upsert({706 |       where: { id: 1 },707 |       update: {},708 |       create: {709 |         name: 'Stripe',710 |         type: 'stripe',711 |         isActive: true,712 |         description: 'Credit card payments via Stripe',713 |         icon: 'credit-card',714 |         requiresConfirmation: false,715 |         autoAssignPackage: true716 |       }717 |     }),718 |     prisma.paymentMethodConfig.upsert({719 |       where: { id: 2 },720 |       update: {},721 |       create: {722 |         name: 'Cash',723 |         type: 'cash',724 |         isActive: true,725 |         description: 'Cash payments',726 |         icon: 'dollar-sign',727 |         requiresConfirmation: true,728 |         autoAssignPackage: false729 |       }730 |     }),731 |     prisma.paymentMethodConfig.upsert({732 |       where: { id: 3 },733 |       update: {},734 |       create: {735 |         name: 'Bank Transfer',736 |         type: 'bank_transfer',737 |         isActive: true,738 |         description: 'Bank transfer payments',739 |         icon: 'building',740 |         requiresConfirmation: true,741 |         autoAssignPackage: false742 |       }743 |     })744 |   ]);745 | 746 |   const paymentMethodsData = await Promise.all([747 |     prisma.payment_methods.upsert({748 |       where: { id: 1 },749 |       update: {},750 |       create: {751 |         name: 'Stripe Credit Card',752 |         description: 'Secure online credit card payments via Stripe',753 |         currency_id: 1,754 |         is_active: true755 |       }756 |     }),757 |     prisma.payment_methods.upsert({758 |       where: { id: 2 },759 |       update: {},760 |       create: {761 |         name: 'Cash Payment',762 |         description: 'In-person cash payments',763 |         currency_id: 1,764 |         is_active: true765 |       }766 |     }),767 |     prisma.payment_methods.upsert({768 |       where: { id: 3 },769 |       update: {},770 |       create: {771 |         name: 'Bank Transfer',772 |         description: 'Direct bank transfer payments',773 |         currency_id: 1,774 |         is_active: true775 |       }776 |     }),777 |     prisma.payment_methods.upsert({778 |       where: { id: 4 },779 |       update: {},780 |       create: {781 |         name: 'PayPal',782 |         description: 'PayPal online payments',783 |         currency_id: 1,784 |         is_active: true785 |       }786 |     }),787 |     prisma.payment_methods.upsert({788 |       where: { id: 5 },789 |       update: {},790 |       create: {791 |         name: 'Mexican Peso Cash',792 |         description: 'Cash payments in Mexican Peso',793 |         currency_id: 3,794 |         is_active: true795 |       }796 |     })797 |   ]);798 | 799 |   const groupBookingTiers = await Promise.all([800 |     prisma.group_booking_tiers.upsert({801 |       where: { id: 1 },802 |       update: {},803 |       create: {804 |         name: 'Small Group (2-3 people)',805 |         min_participants: 2,806 |         max_participants: 3,807 |         discount_percent: 15.00,808 |         description: 'Small group discount',809 |         is_active: true810 |       }811 |     }),812 |     prisma.group_booking_tiers.upsert({813 |       where: { id: 2 },814 |       update: {},815 |       create: {816 |         name: 'Medium Group (4-6 people)',817 |         min_participants: 4,818 |         max_participants: 6,819 |         discount_percent: 25.00,820 |         description: 'Medium group discount',821 |         is_active: true822 |       }823 |     }),824 |     prisma.group_booking_tiers.upsert({825 |       where: { id: 3 },826 |       update: {},827 |       create: {828 |         name: 'Large Group (7+ people)',829 |         min_participants: 7,830 |         max_participants: 10,831 |         discount_percent: 35.00,832 |         description: 'Large group discount',833 |         is_active: true834 |       }835 |     })836 |   ]);837 | 838 |   const clients = await Promise.all([839 |     prisma.user.upsert({840 |       where: { email: 'john.doe@example.com' },841 |       update: {},842 |       create: {843 |         email: 'john.doe@example.com',844 |         fullName: 'John Doe',845 |         phone: '+1234567890',846 |         status: 'active',847 |         birthDate: new Date('1990-01-15'),848 |         birthTime: new Date('1990-01-15T10:30:00'),849 |         birthPlace: 'New York, USA',850 |         question: 'How can I improve my overall wellness?',851 |         language: 'en'852 |       }853 |     }),854 |     prisma.user.upsert({855 |       where: { email: 'maria.garcia@example.com' },856 |       update: {},857 |       create: {858 |         email: 'maria.garcia@example.com',859 |         fullName: 'Maria Garcia',860 |         phone: '+1234567891',861 |         status: 'active',862 |         birthDate: new Date('1985-06-20'),863 |         birthTime: new Date('1985-06-20T14:15:00'),864 |         birthPlace: 'Madrid, Spain',865 |         question: '¿Cómo puedo manejar mejor el estrés?',866 |         language: 'es'867 |       }868 |     }),869 |     prisma.user.upsert({870 |       where: { email: 'test@example.com' },871 |       update: {},872 |       create: {873 |         email: 'test@example.com',874 |         fullName: 'Test Client',875 |         phone: '+1234567892',876 |         status: 'active',877 |         birthDate: new Date('1995-03-10'),878 |         birthTime: new Date('1995-03-10T09:00:00'),879 |         birthPlace: 'Toronto, Canada',880 |         question: 'What wellness services do you offer?',881 |         language: 'en'882 |       }883 |     })884 |   ]);885 | 886 |   const adminClient = await prisma.user.upsert({887 |     where: { email: 'coco@matmax.store' },888 |     update: {},889 |     create: {890 |       email: 'coco@matmax.store',891 |       fullName: 'Coco Admin',892 |       phone: '+1234567890',893 |       status: 'active',894 |       birthDate: new Date('1990-01-15'),895 |       birthTime: new Date('1990-01-15T10:30:00'),896 |       birthPlace: 'New York, USA',897 |       question: 'How can I help manage the MatMax Yoga Studio system?',898 |       language: 'en'899 |     }900 |   });901 | 902 |   ...');903 |   const hashedPassword = await bcrypt.hash('soulpath', 12);904 |   const newAdminUser = await prisma.user.upsert({905 |     where: { email: 'admin@matmax.store' },906 |     update: {},907 |     create: {908 |       email: 'admin@matmax.store',909 |       password: hashedPassword,910 |       fullName: 'MatMax Admin',911 |       role: 'admin',912 |       phone: '+1234567890',913 |       status: 'active',914 |       birthDate: new Date('1990-01-15'),915 |       birthTime: new Date('1990-01-15T10:30:00'),916 |       birthPlace: 'New York, USA',917 |       question: 'How can I help manage the MatMax Yoga Studio system?',918 |       language: 'en',919 |       adminNotes: 'System administrator with full access'920 |     }921 |   });922 | 923 |   const purchases = await Promise.all([924 |     prisma.purchase.upsert({925 |       where: { id: 1 },926 |       update: {},927 |       create: {928 |         userId: clients[0].id,929 |         totalAmount: 50.00,930 |         currencyCode: 'PEN',931 |         paymentMethod: 'stripe',932 |         paymentStatus: 'confirmed',933 |         transactionId: 'txn_test_123',934 |         notes: 'Test purchase for John Doe - 01 MATPASS',935 |         purchasedAt: new Date(),936 |         confirmedAt: new Date()937 |       }938 |     }),939 |     prisma.purchase.upsert({940 |       where: { id: 2 },941 |       update: {},942 |       create: {943 |         userId: clients[1].id,944 |         totalAmount: 210.00,945 |         currencyCode: 'PEN',946 |         paymentMethod: 'cash',947 |         paymentStatus: 'confirmed',948 |         transactionId: 'txn_test_456',949 |         notes: 'Test purchase for Maria Garcia - 04 MATPASS',950 |         purchasedAt: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),951 |         confirmedAt: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)952 |       }953 |     })954 |   ]);955 | 956 |   const userPackages = await Promise.all([957 |     prisma.userPackage.upsert({958 |       where: { id: 1 },959 |       update: {},960 |       create: {961 |         userId: clients[0].id,962 |         purchaseId: 1,963 |         packagePriceId: 1,964 |         quantity: 1,965 |         sessionsUsed: 0,966 |         isActive: true,967 |         expiresAt: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000)968 |       }969 |     }),970 |     prisma.userPackage.upsert({971 |       where: { id: 2 },972 |       update: {},973 |       create: {974 |         userId: clients[1].id,975 |         purchaseId: 2,976 |         packagePriceId: 2,977 |         quantity: 1,978 |         sessionsUsed: 1,979 |         isActive: true,980 |         expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000)981 |       }982 |     })983 |   ]);984 | 985 |   const bookings = await Promise.all([986 |     prisma.booking.upsert({987 |       where: { id: 1 },988 |       update: {},989 |       create: {990 |         userId: clients[0].id,991 |         userPackageId: 1,992 |         scheduleSlotId: 1,993 |         sessionType: 'Wellness Session',994 |         status: 'confirmed',995 |         notes: 'Test booking for development'996 |       }997 |     }),998 |     prisma.booking.upsert({999 |       where: { id: 2 },1000 |       update: {},1001 |       create: {1002 |         userId: clients[1].id,1003 |         userPackageId: 2,1004 |         scheduleSlotId: 2,1005 |         sessionType: 'Wellness Session',1006 |         status: 'confirmed',1007 |         notes: 'Sesión en español'1008 |       }1009 |     })1010 |   ]);1011 | 1012 |   const paymentRecords = await Promise.all([1013 | 1014 |     prisma.paymentRecord.upsert({1015 |       where: { id: 1 },1016 |       update: {},1017 |       create: {1018 |         userId: clients[0].id,1019 |         purchaseId: 1,1020 |         amount: 50.00,1021 |         currencyCode: 'PEN',1022 |         paymentMethod: 'stripe',1023 |         paymentStatus: 'confirmed',1024 |         transactionId: 'txn_123456789',1025 |         notes: '01 MATPASS payment - Credit card',1026 |         paymentDate: new Date(),1027 |         confirmedAt: new Date()1028 |       }1029 |     }),1030 | 1031 |     prisma.paymentRecord.upsert({1032 |       where: { id: 2 },1033 |       update: {},1034 |       create: {1035 |         userId: clients[1].id,1036 |         purchaseId: 2,1037 |         amount: 210.00,1038 |         currencyCode: 'PEN',1039 |         paymentMethod: 'cash',1040 |         paymentStatus: 'confirmed',1041 |         transactionId: null,1042 |         notes: '04 MATPASS payment - Cash',1043 |         paymentDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),1044 |         confirmedAt: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)1045 |       }1046 |     })1047 |   ]);1048 | 1049 |   const profileImage = await prisma.profileImage.upsert({1050 |     where: { key: 'hero_profile' },1051 |     update: {},1052 |     create: {1053 |       key: 'hero_profile',1054 |       url: 'https:1055 |       altText: 'Jose Profile - MatMax Yoga Studio'1056 |     }1057 |   });1058 | 1059 |   const images = await Promise.all([1060 |     prisma.image.upsert({1061 |       where: { id: 1 },1062 |       update: {},1063 |       create: {1064 |         name: 'Wellness Center',1065 |         url: 'https:1066 |         altText: 'Peaceful wellness center environment',1067 |         category: 'facility'1068 |       }1069 |     }),1070 |     prisma.image.upsert({1071 |       where: { id: 2 },1072 |       update: {},1073 |       create: {1074 |         name: 'Meditation Room',1075 |         url: 'https:1076 |         altText: 'Tranquil meditation room',1077 |         category: 'facility'1078 |       }1079 |     }),1080 |     prisma.image.upsert({1081 |       where: { id: 3 },1082 |       update: {},1083 |       create: {1084 |         name: 'Wellness Session',1085 |         url: 'https:1086 |         altText: 'Professional wellness session',1087 |         category: 'service'1088 |       }1089 |     })1090 |   ]);1091 | 1092 |   const bugReports = await Promise.all([1093 |     prisma.bugReport.upsert({1094 |       where: { id: 'bug-001' },1095 |       update: {},1096 |       create: {1097 |         id: 'bug-001',1098 |         title: 'Payment form not working',1099 |         description: 'The Stripe payment form is not loading properly on mobile devices.',1100 |         screenshot: null,1101 |         status: 'OPEN',1102 |         priority: 'HIGH',1103 |         category: 'Payment System',1104 |         reporterId: clients[0].id,1105 |         assignedTo: null1106 |       }1107 |     }),1108 |     prisma.bugReport.upsert({1109 |       where: { id: 'bug-002' },1110 |       update: {},1111 |       create: {1112 |         id: 'bug-002',1113 |         title: 'Email notifications not sending',1114 |         description: 'Booking confirmation emails are not being sent to clients.',1115 |         screenshot: null,1116 |         status: 'IN_PROGRESS',1117 |         priority: 'MEDIUM',1118 |         category: 'Email System',1119 |         reporterId: clients[1].id,1120 |         assignedTo: adminClient.id1121 |       }1122 |     })1123 |   ]);1124 | 1125 |   const bugComments = await Promise.all([1126 |     prisma.bugComment.upsert({1127 |       where: { id: 'comment-001' },1128 |       update: {},1129 |       create: {1130 |         id: 'comment-001',1131 |         content: 'This issue has been reported by multiple users. Need to investigate the mobile payment flow.',1132 |         authorId: adminClient.id,1133 |         bugReportId: 'bug-001'1134 |       }1135 |     }),1136 |     prisma.bugComment.upsert({1137 |       where: { id: 'comment-002' },1138 |       update: {},1139 |       create: {1140 |         id: 'comment-002',1141 |         content: 'Working on fixing the email configuration. Should be resolved by tomorrow.',1142 |         authorId: adminClient.id,1143 |         bugReportId: 'bug-002'1144 |       }1145 |     })1146 |   ]);1147 |   `);1148 |   ');1149 |   ');1150 |   }1151 | 1152 | main()1153 |   .catch((e) => {1154 |     process.exit(1);1155 |   })1156 |   .finally(async () => {1157 |     await prisma.$disconnect();1158 |   });
============================================================END: frontend/prisma/seed.ts============================================================


============================================================FILE: frontend/tailwind.config.tsSIZE: 1.71 KB============================================================
  1 | import type { Config } from 'tailwindcss'  2 |   3 | const config: Config = {  4 |   content: [  5 |     './pages*.{js,ts,jsx,tsx,mdx}',  6 |     './components*.{js,ts,jsx,tsx,mdx}',  7 |     './app*.{js,ts,jsx,tsx,mdx}',  8 |   ],  9 |   theme: { 10 |     extend: { 11 |       colors: { 12 |         background: 'var(--background)', 13 |         foreground: 'var(--foreground)', 14 |         card: { 15 |           DEFAULT: 'var(--card)', 16 |           foreground: 'var(--card-foreground)', 17 |         }, 18 |         popover: { 19 |           DEFAULT: 'var(--popover)', 20 |           foreground: 'var(--popover-foreground)', 21 |         }, 22 |         primary: { 23 |           DEFAULT: 'var(--primary)', 24 |           foreground: 'var(--primary-foreground)', 25 |         }, 26 |         secondary: { 27 |           DEFAULT: 'var(--secondary)', 28 |           foreground: 'var(--secondary-foreground)', 29 |         }, 30 |         muted: { 31 |           DEFAULT: 'var(--muted)', 32 |           foreground: 'var(--muted-foreground)', 33 |         }, 34 |         accent: { 35 |           DEFAULT: 'var(--accent)', 36 |           foreground: 'var(--accent-foreground)', 37 |         }, 38 |         destructive: { 39 |           DEFAULT: 'var(--destructive)', 40 |           foreground: 'var(--destructive-foreground)', 41 |         }, 42 |         border: 'var(--border)', 43 |         input: 'var(--input)', 44 |         ring: 'var(--ring)', 45 |         chart: { 46 |           '1': 'var(--chart-1)', 47 |           '2': 'var(--chart-2)', 48 |           '3': 'var(--chart-3)', 49 |           '4': 'var(--chart-4)', 50 |           '5': 'var(--chart-5)', 51 |         }, 52 |       }, 53 |       borderRadius: { 54 |         lg: 'var(--radius)', 55 |         md: 'calc(var(--radius) - 2px)', 56 |         sm: 'calc(var(--radius) - 4px)', 57 |       }, 58 |       fontFamily: { 59 |         heading: 'var(--font-heading)', 60 |         body: 'var(--font-body)', 61 |       }, 62 |     }, 63 |   }, 64 |   plugins: [], 65 | } 66 |  67 | export default config
============================================================END: frontend/tailwind.config.ts============================================================



============================================================
# END OF SUPER ESSENTIAL CODE
============================================================

# EXPORT SUMMARY:
# - Files Processed: 315
# - Files Excluded: 156
# - Total Size: 2.54 MB
# - Directories Processed: 193
# - Export Date: 2025-09-15T17:30:13.615Z

# FILE TYPE BREAKDOWN:
#   .ts: 158 files
#   .tsx: 153 files
#   .js: 3 files
#   .prisma: 1 files

# DIRECTORIES INCLUDED:
#   frontend
#   frontend/app
#   frontend/app/(admin)
#   frontend/app/(admin)/admin
#   frontend/app/(admin)/admin/live-session-config
#   frontend/app/(admin)/admin/payment-methods
#   frontend/app/(admin)/admin/telegram-config
#   frontend/app/(client)
#   frontend/app/(client)/account
#   frontend/app/(client)/account/book
#   frontend/app/(client)/account/live-session
#   frontend/app/(client)/account/my-packages
#   frontend/app/(client)/account/packages
#   frontend/app/(client)/account/profile
#   frontend/app/(client)/account/purchase
#   frontend/app/(client)/account/purchase-history
#   frontend/app/(client)/account/sessions
#   frontend/app/api
#   frontend/app/api/admin
#   frontend/app/api/admin/bookings
#   frontend/app/api/admin/bookings/[id]
#   frontend/app/api/admin/bookings/[id]/report
#   frontend/app/api/admin/bookings/stats
#   frontend/app/api/admin/bug-reports
#   frontend/app/api/admin/bug-reports/[id]
#   frontend/app/api/admin/bug-reports/[id]/archive
#   frontend/app/api/admin/bug-reports/[id]/assign
#   frontend/app/api/admin/bug-reports/[id]/comments
#   frontend/app/api/admin/bug-reports/[id]/status
#   frontend/app/api/admin/communication
#   frontend/app/api/admin/communication/config
#   frontend/app/api/admin/communication/templates
#   frontend/app/api/admin/communication/templates/[id]
#   frontend/app/api/admin/communication/test
#   frontend/app/api/admin/content
#   frontend/app/api/admin/content/seed
#   frontend/app/api/admin/conversation-logs
#   frontend/app/api/admin/conversation-logs/test
#   frontend/app/api/admin/currencies
#   frontend/app/api/admin/debug
#   frontend/app/api/admin/email
#   frontend/app/api/admin/email/config
#   frontend/app/api/admin/email/templates
#   frontend/app/api/admin/email/test
#   frontend/app/api/admin/email/test-brevo
#   frontend/app/api/admin/external-apis
#   frontend/app/api/admin/health
#   frontend/app/api/admin/images
#   frontend/app/api/admin/images/[imageKey]
#   frontend/app/api/admin/live-session-config
#   frontend/app/api/admin/live-session-config/test
#   frontend/app/api/admin/package-definitions
#   frontend/app/api/admin/package-prices
#   frontend/app/api/admin/payment-methods
#   frontend/app/api/admin/payment-methods/[id]
#   frontend/app/api/admin/purchases
#   frontend/app/api/admin/schedule-slots
#   frontend/app/api/admin/schedule-templates
#   frontend/app/api/admin/schedules
#   frontend/app/api/admin/schedules/[id]
#   frontend/app/api/admin/schedules/bulk
#   frontend/app/api/admin/sections
#   frontend/app/api/admin/seed
#   frontend/app/api/admin/seed/admin
#   frontend/app/api/admin/seed/clients
#   frontend/app/api/admin/seed/content
#   frontend/app/api/admin/seed/schedules
#   frontend/app/api/admin/seed/seo
#   frontend/app/api/admin/session-durations
#   frontend/app/api/admin/sms-config
#   frontend/app/api/admin/sms-config/test
#   frontend/app/api/admin/sms-config/test-sms
#   frontend/app/api/admin/sms-templates
#   frontend/app/api/admin/telegram-config
#   frontend/app/api/admin/user-packages
#   frontend/app/api/admin/users
#   frontend/app/api/analytics
#   frontend/app/api/analytics/performance
#   frontend/app/api/auth
#   frontend/app/api/auth/login
#   frontend/app/api/auth/reset-password
#   frontend/app/api/auth/test-db
#   frontend/app/api/auth/verify
#   frontend/app/api/booking
#   frontend/app/api/bug-reports
#   frontend/app/api/calendly-booking
#   frontend/app/api/chat
#   frontend/app/api/chat/hybrid
#   frontend/app/api/chat/main
#   frontend/app/api/chat/schedule-slots
#   frontend/app/api/chat/simple
#   frontend/app/api/chat/web
#   frontend/app/api/client
#   frontend/app/api/client/bookings
#   frontend/app/api/client/bookings/[id]
#   frontend/app/api/client/bookings/[id]/report
#   frontend/app/api/client/dashboard-stats
#   frontend/app/api/client/live-session
#   frontend/app/api/client/live-session/config
#   frontend/app/api/client/live-session/create-meeting
#   frontend/app/api/client/live-session/upcoming
#   frontend/app/api/client/me
#   frontend/app/api/client/my-bookings
#   frontend/app/api/client/my-packages
#   frontend/app/api/client/packages
#   frontend/app/api/client/payment-methods
#   frontend/app/api/client/purchase
#   frontend/app/api/client/purchase-history
#   frontend/app/api/client/schedule-slots
#   frontend/app/api/content
#   frontend/app/api/debug
#   frontend/app/api/debug/schedule-slots
#   frontend/app/api/email
#   frontend/app/api/email/templates
#   frontend/app/api/feedback
#   frontend/app/api/health
#   frontend/app/api/images
#   frontend/app/api/izipay
#   frontend/app/api/izipay/create-payment-intent
#   frontend/app/api/izipay/webhook
#   frontend/app/api/logo
#   frontend/app/api/ml
#   frontend/app/api/ml/retrain
#   frontend/app/api/orchestrator
#   frontend/app/api/orchestrator/test
#   frontend/app/api/otp
#   frontend/app/api/otp/send
#   frontend/app/api/otp/verify
#   frontend/app/api/packages
#   frontend/app/api/payment-methods
#   frontend/app/api/payment-methods-test
#   frontend/app/api/performance
#   frontend/app/api/redis
#   frontend/app/api/redis-test
#   frontend/app/api/revalidate
#   frontend/app/api/schedule-slots
#   frontend/app/api/schedules
#   frontend/app/api/sections
#   frontend/app/api/seo
#   frontend/app/api/stripe
#   frontend/app/api/stripe/create-checkout-session
#   frontend/app/api/stripe/create-payment-intent
#   frontend/app/api/stripe/webhook
#   frontend/app/api/telegram
#   frontend/app/api/telegram/test
#   frontend/app/api/telegram/webhook
#   frontend/app/api/test
#   frontend/app/api/test/db
#   frontend/app/api/test/logging
#   frontend/app/api/test/openrouter
#   frontend/app/api/test/prisma
#   frontend/app/api/test-db
#   frontend/app/api/test-env
#   frontend/app/api/test-openrouter
#   frontend/app/api/test-packages
#   frontend/app/api/test-payment-methods
#   frontend/app/api/whatsapp
#   frontend/app/api/whatsapp/webhook
#   frontend/app/api/whatsapp-business
#   frontend/app/api/whatsapp-business/webhook
#   frontend/app/izipay-demo
#   frontend/app/login
#   frontend/app/packages
#   frontend/app/payment
#   frontend/app/payment/cancel
#   frontend/app/payment/success
#   frontend/app/payment-demo
#   frontend/app/slider
#   frontend/components
#   frontend/components/admin
#   frontend/components/cms
#   frontend/components/communication
#   frontend/components/figma
#   frontend/components/izipay
#   frontend/components/modals
#   frontend/components/payment
#   frontend/components/stripe
#   frontend/components/theme
#   frontend/components/ui
#   frontend/hooks
#   frontend/lib
#   frontend/lib/api
#   frontend/lib/communication
#   frontend/lib/config
#   frontend/lib/data
#   frontend/lib/izipay
#   frontend/lib/middleware
#   frontend/lib/services
#   frontend/lib/state
#   frontend/lib/stripe
#   frontend/lib/styles
#   frontend/lib/theme
#   frontend/prisma

# This file contains only the most essential, core business logic.
# Perfect for focused code analysis and architecture review.
